<hr />

<h2 id="quick-summary">Quick Summary</h2>
<p><br /> Waldo was a great box and what makes it special is its unique way in getting the root flag. Every step with this box was very fun and I liked this box too much. 
<br /> It’s a linux box and its ip is 10.10.10.87 so let’s jump right in
<img src="/images/hackthebox/waldo/0.png" alt="" />
<br /></p>
<hr />

<h2 id="nmap">Nmap</h2>
<p><br /> Starting with nmap to scan for open TCP ports and services.
<code class="highlighter-rouge">nmap -sV -sT 10.10.10.87 </code>
<img src="/images/hackthebox/waldo/1.png" alt="" />
<br /> We only see http on port 80 and ssh on port 22.
<br /> On port 80 there’s a web application called List Manager.
<img src="/images/hackthebox/waldo/2.png" alt="" /></p>
<hr />

<h2 id="path-traversal">Path Traversal</h2>
<p><br /> We will intercept the traffic with Burp then we will start to perform actions on the application like creating a list , editing it , deleteing it etc..
<img src="/images/hackthebox/waldo/3.png" alt="" />
<br /> By looking at the requests we will find two interesting requests.
<br /> The POST request to fileRead.php and the POST request to dirRead.php.
<br />
<br /> Let’s send them to the repeater and play with them.
<br /> We will notice that dirRead.php lists the contents of a directory by giving the path in a POST request so we might have a path traversal vulnerability here.
<br /> 
<br /> If we tried to go up one directory it works
<img src="/images/hackthebox/waldo/4.png" alt="" />
<img src="/images/hackthebox/waldo/5.png" alt="" />
<br /> But going up 2 directories doesn’t work so there might be a filter that prevents that.
<br /> We can try to bypass the filter by adding another <code class="highlighter-rouge">../</code>. And it worked
<img src="/images/hackthebox/waldo/6.png" alt="" />
<img src="/images/hackthebox/waldo/7.png" alt="" /></p>
<hr />

<h2 id="ssh-key-for-monitor">SSH key for monitor</h2>
<p><br /> Then after enumerating in home directory we will find out that we can read the ssh key of a user called nobody <code class="highlighter-rouge">/home/nobody/.ssh</code> but the ssh key  is called .monitor 
<img src="/images/hackthebox/waldo/8.png" alt="" />
<br />
<br /> But we can only read directories with dirRead.php. 
<br /> If we check fileRead.php we will find a path traversal there too.
<img src="/images/hackthebox/waldo/9.png" alt="" />
<img src="/images/hackthebox/waldo/10.png" alt="" />
<br />
<br /> Now we have the key but it’s json decoded. We can use any online json decoder.
<img src="/images/hackthebox/waldo/11.png" alt="" />
<img src="/images/hackthebox/waldo/12.png" alt="" />
<img src="/images/hackthebox/waldo/13.png" alt="" />
<br /></p>
<hr />

<h2 id="ssh-as-nobody">SSH as nobody</h2>
<p><br /> Now will change permissions to 600 then try ssh with nobody. If we try monitor it will give us permission denied.
<code class="highlighter-rouge">chmod 600 monitor.key</code>
<br />
<code class="highlighter-rouge">ssh -i monitor.key nobody@10.10.10.87</code>
<img src="/images/hackthebox/waldo/14.png" alt="" />
<img src="/images/hackthebox/waldo/15.png" alt="" />
<br /> And we got user !
<br /></p>
<hr />

<h2 id="privilege-escalation-to-monitor">Privilege Escalation to monitor</h2>

<p><br /> After we login as nobody we need to elevate to a higher privileged user.
<br /> Since we couldn’t ssh as monitor before let’s try again but this time locally.
<img src="/images/hackthebox/waldo/16.png" alt="" />
<img src="/images/hackthebox/waldo/17.png" alt="" />
<br /> And We’re in as monitor .
<br /> But we are in a restricted shell and can’t run commands .
<img src="/images/hackthebox/waldo/18.png" alt="" />
<br />
<br /> We can try some commands and ls will work . 
<img src="/images/hackthebox/waldo/19.png" alt="" />
<br />
<br /> We see two directories app-dev and bin .
<br /> Let’s ls bin and see what commands can we run .
<img src="/images/hackthebox/waldo/20.png" alt="" />
<br /> We can run ls , most , red , rnano
<br /> rnano and red are restricted versions of the text editors nano and ed
<br /></p>
<hr />

<h2 id="escaping-the-restricted-shell">Escaping the restricted shell</h2>
<p><br /> We can use red to escape.
<br /> We will run it first .
<code class="highlighter-rouge">red</code>
<br /> Then we will execute sh from the editor .
<code class="highlighter-rouge">!'/bin/sh'</code>
<br /> And we cd to /bin and execute bash .
<br /> And we escaped the shell !
<img src="/images/hackthebox/waldo/21.png" alt="" />
<img src="/images/hackthebox/waldo/22.png" alt="" />
<br /></p>
<hr />

<h2 id="exploiting-capabilities-and-getting-roottxt">Exploiting Capabilities and getting root.txt</h2>
<p><br />
<br /> This is where the awesome part comes. For me it was the first time to deal with linux capabilities.
<br /> If we look at the bins in /sbin we will see getcap.
<img src="/images/hackthebox/waldo/23.png" alt="" />
<br /> So If we run getcap on the bin folders. 
<img src="/images/hackthebox/waldo/24.png" alt="" />
<img src="/images/hackthebox/waldo/25.png" alt="" />
<br /> We will find under <code class="highlighter-rouge">/usr/bin</code> that a binary named tac has the <code class="highlighter-rouge">cap_dac read_search+ei</code> capability 
<br /> This allows it to read files as root .
<br /> And tac does exactly the same as cat but the name is reversed . 
<br /> We can simply read root.txt 
<code class="highlighter-rouge">tac /root/root.txt </code>
<img src="/images/hackthebox/waldo/26.png" alt="" />
<br />
<br />
<br /> That’s it , Feedback is appreciated !
<br /> Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham">@Ahm3d_H3sham</a>
<br /> Thanks for reading.
<br />
<br />
<br /> Previous Hack The Box write-up : <a href="/hack-the-box/active/">Hack The Box - Active</a>
<br /> Next Hack The Box write-up : <a href="/hack-the-box/oz/">Hack The Box - Oz</a></p>
<hr />

